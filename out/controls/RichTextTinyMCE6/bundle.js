/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
var pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad;
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./RichTextTinyMCE6/index.ts":
/*!***********************************!*\
  !*** ./RichTextTinyMCE6/index.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", ({\n  value: true\n}));\nexports.RichTextTinyMCE6 = void 0;\n//import { TinyMCE } from \"tinymce\";\nvar RichTextTinyMCE6 = /** @class */function () {\n  /**\r\n   * Sets up all TinyMCE plugins, themes, icons, etc. and loads the TinyMCE library\r\n   */\n  function RichTextTinyMCE6() {\n    //Load TinyMCE library\n    this._tinymce = __webpack_require__(/*! tinymce/tinymce */ \"./node_modules/tinymce/tinymce.js\");\n    __webpack_require__(/*! tinymce/models/dom */ \"./node_modules/tinymce/models/dom/index.js\");\n    //require('tinymce/skins/ui/oxide/skin.min.css');\n    //require('tinymce/skins/ui/oxide/content.min.css');\n    //require('tinymce/skins/content/default/content.css');\n    //Load Themes and Icons\n    //TODO: change to dynamically load themes, icons and plugins based on the input parameters (or just use the default ones)\n    __webpack_require__(/*! tinymce/themes/silver */ \"./node_modules/tinymce/themes/silver/index.js\");\n    __webpack_require__(/*! tinymce/icons/default */ \"./node_modules/tinymce/icons/default/index.js\");\n    // Any plugins you want to use have to be imported\n    __webpack_require__(/*! tinymce/plugins/link */ \"./node_modules/tinymce/plugins/link/index.js\");\n    __webpack_require__(/*! tinymce/plugins/code */ \"./node_modules/tinymce/plugins/code/index.js\");\n    __webpack_require__(/*! tinymce/plugins/quickbars */ \"./node_modules/tinymce/plugins/quickbars/index.js\");\n    __webpack_require__(/*! tinymce/plugins/lists */ \"./node_modules/tinymce/plugins/lists/index.js\");\n    __webpack_require__(/*! tinymce/plugins/codesample */ \"./node_modules/tinymce/plugins/codesample/index.js\");\n    __webpack_require__(/*! tinymce/plugins/image */ \"./node_modules/tinymce/plugins/image/index.js\");\n  }\n  /**\r\n   * Generates a unique ID string.\r\n   * @returns {string} A unique ID string.\r\n   */\n  RichTextTinyMCE6.prototype.uniqueId = function () {\n    // Math.random should be unique because of its seeding algorithm.\n    // Convert it to base 36 (numbers + letters), and grab the first 9 characters\n    // after the decimal.\n    return '_' + Math.random().toString(36).substr(2, 9);\n    //todo: replace substr function with current / non-deprecated method\n  };\n\n  RichTextTinyMCE6.prototype.loadTinyMCE = function () {\n    var _this = this;\n    this._tinymce.init({\n      selector: '#text_editor' + this._domId,\n      width: 400,\n      height: 240,\n      //skin: 'oxide-dark', //TODO: not working; figure it out\n      //content_css: 'dark', //TODO: not working; figure it out\n      //icons: 'oxide-dark', //TODO: not working; figure it out\n      content_style: \"body { font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; }\",\n      //todo: change to full set of formats - font_formats: \"Segoe='Segoe UI',sans-serif;Arial=arial,helvetica,sans-serif; Courier New=courier new,courier,monospace; AkrutiKndPadmini=Akpdmi-n\",\n      //REFERENCE: AzureDevOps uses the folloing style in their rich text editor: \"Segoe UI VSS (Regular)\",\"Segoe UI\",\"-apple-system\",BlinkMacSystemFont,Roboto,\"Helvetica Neue\",Helvetica,Ubuntu,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\"\n      //font-size: 14px\n      readonly: this._context.mode.isControlDisabled,\n      //inline: true, //todo: if using inline need to figure out how to show scrollbar / fixed height/width\n      mobile: {\n        //toolbar: [ 'undo', 'bold', 'italic', 'styles' ],\n        plugins: ['lists']\n      },\n      //toolbar_location: 'bottom',\n      toolbar: 'formatting color alignment font | insert | options ',\n      toolbar_groups: {\n        formatting: {\n          icon: 'bold',\n          tooltip: 'Formatting',\n          items: 'bold italic underline | superscript subscript | bullist numlist'\n        },\n        color: {\n          icon: 'color-picker',\n          tooltip: 'Color',\n          items: 'backcolor forecolor'\n        },\n        alignment: {\n          icon: 'align-left',\n          tooltip: 'Alignment',\n          items: 'alignleft aligncenter alignright alignjustify indent outdent'\n        },\n        font: {\n          icon: 'format',\n          tooltip: 'Font',\n          items: 'styles fontfamily fontsize removeformat'\n        },\n        insert: {\n          icon: 'plus',\n          tooltip: 'Insert',\n          items: 'link quickimage codesample' //todo: add table or other things\n        },\n\n        options: {\n          icon: 'more-drawer',\n          tooltip: 'Other Options',\n          items: 'quicklink code' //REMOVED built-in MCE: fullscreen AND custom:  pcffullscreen'\n        }\n      },\n\n      menubar: false,\n      resize: false,\n      //TODO: load plugins dynamically\n      plugins: ['quickbars', 'link', 'code', 'lists', 'codesample', 'image'],\n      quickbars_selection_toolbar: false,\n      quickbars_insert_toolbar: false,\n      link_context_toolbar: true,\n      list_indent_on_tab: true,\n      statusbar: false,\n      placeholder: \"Enter text here...\",\n      setup: function setup(ed) {\n        //TODO: review if this needs to monitor for dirty event instead of change due to v6 modification https://www.tiny.cloud/docs/tinymce/6/migration-from-5x/#change-editor-event\n        ed.on('change', function (e) {\n          _this._textValue = ed.getContent();\n          _this._notifyOutputChanged();\n        });\n        ed.on('focus', function (e) {\n          //On Focus Event (click in the text area) show the toolbar\n          console.log('focus event triggered');\n          var editorInstance = _this._tinymce.get(\"text_editor\" + _this._domId);\n          var activeContainer = editorInstance.getContainer();\n          var toolbarDiv = activeContainer.getElementsByClassName(\"tox-editor-header\")[0];\n          toolbarDiv.style.display = \"block\";\n        });\n        ed.on('blur', function (e) {\n          //On Blur Event (click outside the text area) hide the toolbar\n          console.log('blur event triggered');\n          var editorInstance = _this._tinymce.get(\"text_editor\" + _this._domId);\n          var activeContainer = editorInstance.getContainer();\n          var toolbarDiv = activeContainer.getElementsByClassName(\"tox-editor-header\")[0];\n          toolbarDiv.style.display = \"none\";\n        });\n        ed.on('PreInit', function (e) {\n          //On Init Event (default) hide the toolbar\n          console.log('init event triggered');\n          var editorInstance = _this._tinymce.get(\"text_editor\" + _this._domId);\n          var activeContainer = editorInstance.getContainer();\n          var toolbarDiv = activeContainer.getElementsByClassName(\"tox-editor-header\")[0];\n          toolbarDiv.style.display = \"none\";\n        });\n      }\n    });\n    // https://stackoverflow.com/questions/21665974/tinymce-v3-or-v4-show-hide-toolbar-on-focus-blur\n  };\n  /**\r\n   * Used to initialize the control instance. Controls can kick off remote server calls and other initialization actions here.\r\n   * Data-set values are not initialized here, use updateView.\r\n   * @param context The entire property bag available to control via Context Object; It contains values as set up by the customizer mapped to property names defined in the manifest, as well as utility functions.\r\n   * @param notifyOutputChanged A callback method to alert the framework that the control has new outputs ready to be retrieved asynchronously.\r\n   * @param state A piece of data that persists in one session for a single user. Can be set at any point in a controls life cycle by calling 'setControlState' in the Mode interface.\r\n   * @param container If a control is marked control-type='standard', it will receive an empty div element within which it can render its content.\r\n   */\n  RichTextTinyMCE6.prototype.init = function (context, notifyOutputChanged, state, container) {\n    // Control initialization code\n    this._context = context;\n    this._notifyOutputChanged = notifyOutputChanged;\n    this._textValue = this._context.parameters.Text.raw || \"\";\n    this._container = container;\n    this._domId = this.uniqueId();\n    //this._textEditor = document.createElement(\"textarea\");\t// no longer used since DIV is used for INLINE mode (and also works with toolbar?)\t\n    this._textEditor = document.createElement(\"div\");\n    this._textEditor.setAttribute(\"id\", \"text_editor\" + this._domId);\n    this._textEditor.innerHTML = this._textValue;\n    this._container.appendChild(this._textEditor);\n    container = this._container;\n    //Track Property Changes (including size) for updating TinyMCE control\n    this._context.mode.trackContainerResize(true);\n    // Add control initialization code\n    this.loadTinyMCE();\n  };\n  /**\r\n   * Sets the text value of the text editor and reloads the TinyMCE editor with the next text.\r\n   * @param text - The new text value to set.\r\n   */\n  RichTextTinyMCE6.prototype.setText = function (text) {\n    //only update the text if it has changed\n    if (this._textValue !== text) {\n      this._textValue = text;\n      this._textEditor.innerHTML = text;\n      //TODO: make sure this still works in v6: https://www.tiny.cloud/docs/tinymce/6/migration-from-5x/#setcontent-editor-event\n      //get MCE Editor and set its content\n      //TODO: confirm that this works with multiple editors on a page in PowerApps (or use ID())\n      var editorInstance = this._tinymce.get(\"text_editor\" + this._domId);\n      //check existing cursor/caret location from selection\n      var selection = editorInstance === null || editorInstance === void 0 ? void 0 : editorInstance.selection;\n      editorInstance === null || editorInstance === void 0 ? void 0 : editorInstance.load();\n    }\n  };\n  /**\r\n   * Called when any value in the property bag has changed. This includes field values, data-sets, global values such as container height and width, offline status, control metadata values such as label, visible, etc.\r\n   * @param context The entire property bag available to control via Context Object; It contains values as set up by the customizer mapped to names defined in the manifest, as well as utility functions\r\n   */\n  RichTextTinyMCE6.prototype.updateView = function (context) {\n    var _a;\n    // store the latest context\n    this._context = context;\n    var text = (_a = this._context.parameters.Text.raw) !== null && _a !== void 0 ? _a : \"\";\n    var textValueChanged = this._context.updatedProperties.indexOf(\"Text\") > -1;\n    if (textValueChanged) {\n      //Set text (if it has changed)\n      this.setText(text);\n    }\n    var editorInstance = this._tinymce.get(\"text_editor\" + this._domId);\n    if (editorInstance) {\n      //Set the Height & Width based on the configured properties for\n      editorInstance.editorContainer.style.height = this._context.mode.allocatedHeight + 'px';\n      editorInstance.editorContainer.style.width = this._context.mode.allocatedWidth + 'px';\n    }\n    //todo: implement 'settings' property object and a method to check/update the settings if they've changed\n  };\n  /**\r\n   * It is called by the framework prior to a control receiving new data.\r\n   * @returns an object based on nomenclature defined in manifest, expecting object[s] for property marked as “bound” or “output”\r\n   */\n  RichTextTinyMCE6.prototype.getOutputs = function () {\n    return {\n      Text: this._textValue\n    };\n  };\n  /**\r\n   * Called when the control is to be removed from the DOM tree. Controls should use this call for cleanup.\r\n   * i.e. cancelling any pending remote calls, removing listeners, etc.\r\n   */\n  RichTextTinyMCE6.prototype.destroy = function () {\n    //TODO: consider whether a destroy is needed for TinyMCE\n    var editorInstance = this._tinymce.get(\"text_editor\" + this._domId);\n    editorInstance === null || editorInstance === void 0 ? void 0 : editorInstance.destroy();\n  };\n  return RichTextTinyMCE6;\n}();\nexports.RichTextTinyMCE6 = RichTextTinyMCE6;\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./RichTextTinyMCE6/index.ts?");

/***/ }),

/***/ "./node_modules/tinymce/icons/default/icons.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/icons/default/icons.js ***!
  \*****************************************************/
/***/ (() => {

eval("tinymce.IconManager.add('default', {\n  icons: {\n    'accessibility-check': '<svg width=\"24\" height=\"24\"><path d=\"M12 2a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2c0-1.1.9-2 2-2Zm8 7h-5v12c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-5c0-.6-.4-1-1-1a1 1 0 0 0-1 1v5c0 .6-.4 1-1 1a1 1 0 0 1-1-1V9H4a1 1 0 1 1 0-2h16c.6 0 1 .4 1 1s-.4 1-1 1Z\" fill-rule=\"nonzero\"/></svg>',\n    'accordion-toggle': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 15c0-.6.4-1 1-1h6c.6 0 1 .4 1 1s-.4 1-1 1h-6a1 1 0 0 1-1-1Z\"/><path opacity=\".2\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4 15c0-.6.4-1 1-1h6c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1-1-1Z\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 19c0-.6.4-1 1-1h6c.6 0 1 .4 1 1s-.4 1-1 1h-6a1 1 0 0 1-1-1Z\"/><path opacity=\".2\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4 19c0-.6.4-1 1-1h6c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1-1-1Z\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12.3 7.3a1 1 0 0 1 1.4 0L16 9.6l2.3-2.3a1 1 0 1 1 1.4 1.4L16 12.4l-3.7-3.7a1 1 0 0 1 0-1.4ZM4.3 11.7a1 1 0 0 1 0-1.4L6.6 8 4.3 5.7a1 1 0 0 1 1.4-1.4L9.4 8l-3.7 3.7a1 1 0 0 1-1.4 0Z\"/></svg>',\n    'accordion': '<svg width=\"24\" height=\"24\"><rect x=\"12\" y=\"7\" width=\"10\" height=\"2\" rx=\"1\"/><rect x=\"12\" y=\"11\" width=\"10\" height=\"2\" rx=\"1\"/><rect x=\"12\" y=\"15\" width=\"6\" height=\"2\" rx=\"1\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.3 7.3a1 1 0 0 1 1.4 0L6 9.6l2.3-2.3a1 1 0 0 1 1.4 1.4L6 12.4 2.3 8.7a1 1 0 0 1 0-1.4Z\"/></svg>',\n    'action-next': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M5.7 7.3a1 1 0 0 0-1.4 1.4l7.7 7.7 7.7-7.7a1 1 0 1 0-1.4-1.4L12 13.6 5.7 7.3Z\"/></svg>',\n    'action-prev': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M18.3 15.7a1 1 0 0 0 1.4-1.4L12 6.6l-7.7 7.7a1 1 0 0 0 1.4 1.4L12 9.4l6.3 6.3Z\"/></svg>',\n    'addtag': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15 5a2 2 0 0 1 1.6.8L21 12l-4.4 6.2a2 2 0 0 1-1.6.8h-3v-2h3l3.5-5L15 7H5v3H3V7c0-1.1.9-2 2-2h10Z\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M6 12a1 1 0 0 0-1 1v2H3a1 1 0 1 0 0 2h2v2a1 1 0 1 0 2 0v-2h2a1 1 0 1 0 0-2H7v-2c0-.6-.4-1-1-1Z\"/></svg>',\n    'ai-prompt': '<svg width=\"24\" height=\"24\"><g clip-path=\"url(#a)\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15 6.7a1 1 0 0 0-1.4 0l-9.9 10a1 1 0 0 0 0 1.3l2.1 2.1c.4.4 1 .4 1.4 0l10-9.9c.3-.3.3-1 0-1.4l-2.2-2Zm1.4 2.8-2-2-3 2.7 2.2 2.2 2.8-2.9Z\"/><path d=\"m18.5 7.3-.7-1.5-1.5-.8 1.5-.7.7-1.5.7 1.5 1.5.7-1.5.8-.7 1.5ZM18.5 16.5l-.7-1.6-1.5-.7 1.5-.7.7-1.6.7 1.6 1.5.7-1.5.7-.7 1.6ZM9.7 7.3 9 5.8 7.5 5 9 4.3l.7-1.5.7 1.5L12 5l-1.5.8-.7 1.5Z\"/></g><defs><clipPath id=\"a\"><path d=\"M0 0h24v24H0z\"/></clipPath></defs></svg>',\n    'ai': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3H5Zm6.8 11.5.5 1.2a68.3 68.3 0 0 0 .7 1.1l.4.1c.3 0 .5 0 .7-.3.2-.1.3-.3.3-.6l-.3-1-2.6-6.2a20.4 20.4 0 0 0-.5-1.3l-.5-.4-.7-.2c-.2 0-.5 0-.6.2-.2 0-.4.2-.5.4l-.3.6-.3.7L5.7 15l-.2.6-.1.4c0 .3 0 .5.3.7l.6.2c.3 0 .5 0 .7-.2l.4-1 .5-1.2h3.9ZM9.8 9l1.5 4h-3l1.5-4Zm5.6-.9v7.6c0 .4 0 .7.2 1l.7.2c.3 0 .6 0 .8-.3l.2-.9V8.1c0-.4 0-.7-.2-.9a1 1 0 0 0-.8-.3c-.2 0-.5.1-.7.3l-.2 1Z\"/></svg>',\n    'align-center': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2Zm3 4h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 1 1 0-2Zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2Zm-3-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'align-justify': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2Zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2Zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2Zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'align-left': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2Zm0 4h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2Zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2Zm0-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'align-none': '<svg width=\"24\" height=\"24\"><path d=\"M14.2 5 13 7H5a1 1 0 1 1 0-2h9.2Zm4 0h.8a1 1 0 0 1 0 2h-2l1.2-2Zm-6.4 4-1.2 2H5a1 1 0 0 1 0-2h6.8Zm4 0H19a1 1 0 0 1 0 2h-4.4l1.2-2Zm-6.4 4-1.2 2H5a1 1 0 0 1 0-2h4.4Zm4 0H19a1 1 0 0 1 0 2h-6.8l1.2-2ZM7 17l-1.2 2H5a1 1 0 0 1 0-2h2Zm4 0h8a1 1 0 0 1 0 2H9.8l1.2-2Zm5.2-13.5 1.3.7-9.7 16.3-1.3-.7 9.7-16.3Z\" fill-rule=\"evenodd\"/></svg>',\n    'align-right': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2Zm6 4h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm-6-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'arrow-left': '<svg width=\"24\" height=\"24\"><path d=\"m5.6 13 12 6a1 1 0 0 0 1.4-1V6a1 1 0 0 0-1.4-.9l-12 6a1 1 0 0 0 0 1.8Z\" fill-rule=\"evenodd\"/></svg>',\n    'arrow-right': '<svg width=\"24\" height=\"24\"><path d=\"m18.5 13-12 6A1 1 0 0 1 5 18V6a1 1 0 0 1 1.4-.9l12 6a1 1 0 0 1 0 1.8Z\" fill-rule=\"evenodd\"/></svg>',\n    'bold': '<svg width=\"24\" height=\"24\"><path d=\"M7.8 19c-.3 0-.5 0-.6-.2l-.2-.5V5.7c0-.2 0-.4.2-.5l.6-.2h5c1.5 0 2.7.3 3.5 1 .7.6 1.1 1.4 1.1 2.5a3 3 0 0 1-.6 1.9c-.4.6-1 1-1.6 1.2.4.1.9.3 1.3.6s.8.7 1 1.2c.4.4.5 1 .5 1.6 0 1.3-.4 2.3-1.3 3-.8.7-2.1 1-3.8 1H7.8Zm5-8.3c.6 0 1.2-.1 1.6-.5.4-.3.6-.7.6-1.3 0-1.1-.8-1.7-2.3-1.7H9.3v3.5h3.4Zm.5 6c.7 0 1.3-.1 1.7-.4.4-.4.6-.9.6-1.5s-.2-1-.7-1.4c-.4-.3-1-.4-2-.4H9.4v3.8h4Z\" fill-rule=\"evenodd\"/></svg>',\n    'bookmark': '<svg width=\"24\" height=\"24\"><path d=\"M6 4v17l6-4 6 4V4c0-.6-.4-1-1-1H7a1 1 0 0 0-1 1Z\" fill-rule=\"nonzero\"/></svg>',\n    'border-style': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><rect width=\"18\" height=\"2\" x=\"3\" y=\"6\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"3\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"6.8\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"10.6\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"14.4\" y=\"16\" rx=\"1\"/><rect width=\"2.8\" height=\"2\" x=\"18.2\" y=\"16\" rx=\"1\"/><rect width=\"8\" height=\"2\" x=\"3\" y=\"11\" rx=\"1\"/><rect width=\"8\" height=\"2\" x=\"13\" y=\"11\" rx=\"1\"/></g></svg>',\n    'border-width': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><rect width=\"18\" height=\"5\" x=\"3\" y=\"5\" rx=\"1\"/><rect width=\"18\" height=\"3.5\" x=\"3\" y=\"11.5\" rx=\"1\"/><rect width=\"18\" height=\"2\" x=\"3\" y=\"17\" rx=\"1\"/></g></svg>',\n    'brightness': '<svg width=\"24\" height=\"24\"><path d=\"M12 17c.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3 1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7v-1c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3Zm0-10a1 1 0 0 1-.7-.3A1 1 0 0 1 11 6V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3Zm7 4c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 0 1-.7.3h-1a1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1ZM7 12c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3H5a1 1 0 0 1-.7-.3A1 1 0 0 1 4 12c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1c.3 0 .5.1.7.3.2.2.3.4.3.7Zm10 3.5.7.8c.2.1.3.4.3.6 0 .3-.1.6-.3.8a1 1 0 0 1-.8.3 1 1 0 0 1-.6-.3l-.8-.7a1 1 0 0 1-.3-.8c0-.2.1-.5.3-.7a1 1 0 0 1 1.4 0Zm-10-7-.7-.8a1 1 0 0 1-.3-.6c0-.3.1-.6.3-.8.2-.2.5-.3.8-.3.2 0 .5.1.7.3l.7.7c.2.2.3.5.3.8 0 .2-.1.5-.3.7a1 1 0 0 1-.7.3 1 1 0 0 1-.8-.3Zm10 0a1 1 0 0 1-.8.3 1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7c0-.3.1-.6.3-.8l.8-.7c.1-.2.4-.3.6-.3.3 0 .6.1.8.3.2.2.3.5.3.8 0 .2-.1.5-.3.7l-.7.7Zm-10 7c.2-.2.5-.3.8-.3.2 0 .5.1.7.3a1 1 0 0 1 0 1.4l-.8.8a1 1 0 0 1-.6.3 1 1 0 0 1-.8-.3 1 1 0 0 1-.3-.8c0-.2.1-.5.3-.6l.7-.8ZM12 8a4 4 0 0 1 3.7 2.4 4 4 0 0 1 0 3.2A4 4 0 0 1 12 16a4 4 0 0 1-3.7-2.4 4 4 0 0 1 0-3.2A4 4 0 0 1 12 8Zm0 6.5c.7 0 1.3-.2 1.8-.7.5-.5.7-1.1.7-1.8s-.2-1.3-.7-1.8c-.5-.5-1.1-.7-1.8-.7s-1.3.2-1.8.7c-.5.5-.7 1.1-.7 1.8s.2 1.3.7 1.8c.5.5 1.1.7 1.8.7Z\" fill-rule=\"evenodd\"/></svg>',\n    'browse': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-4v-2h4V8H5v10h4v2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm-8 9.4-2.3 2.3a1 1 0 1 1-1.4-1.4l4-4a1 1 0 0 1 1.4 0l4 4a1 1 0 0 1-1.4 1.4L13 13.4V20a1 1 0 0 1-2 0v-6.6Z\" fill-rule=\"nonzero\"/></svg>',\n    'cancel': '<svg width=\"24\" height=\"24\"><path d=\"M12 4.6a7.4 7.4 0 1 1 0 14.8 7.4 7.4 0 0 1 0-14.8ZM12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18Zm0 8L14.8 8l1 1.1-2.7 2.8 2.7 2.7-1.1 1.1-2.7-2.7-2.7 2.7-1-1.1 2.6-2.7-2.7-2.7 1-1.1 2.8 2.7Z\" fill-rule=\"nonzero\"/></svg>',\n    'cell-background-color': '<svg width=\"24\" height=\"24\"><path d=\"m15.7 2 1.6 1.6-2.7 2.6 5.9 5.8c.7.7.7 1.7 0 2.4l-6.3 6.1a1.7 1.7 0 0 1-2.4 0l-6.3-6.1c-.7-.7-.7-1.7 0-2.4L15.7 2ZM18 12l-4.5-4L9 12h9ZM4 16s2 2.4 2 3.8C6 21 5.1 22 4 22s-2-1-2-2.2C2 18.4 4 16 4 16Z\"/></svg>',\n    'cell-border-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M5 13v5h2v2H5a2 2 0 0 1-2-2v-5h2zm8-7V4h6a2 2 0 0 1 2 2h-8z\" opacity=\".2\"/><path fill-rule=\"nonzero\" d=\"M13 4v2H5v7H3V6c0-1.1.9-2 2-2h8zm-2.6 14.1.1-.1.1.1.2.3.2.2.2.2c.4.6.8 1.2.8 1.7 0 .8-.7 1.5-1.5 1.5S9 21.3 9 20.5c0-.5.4-1.1.8-1.7l.2-.2.2-.2.2-.3z\"/><path d=\"m13 11-2 2H5v-2h6V6h2z\"/><path fill-rule=\"nonzero\" d=\"m18.4 8 1 1-1.8 1.9 4 4c.5.4.5 1.1 0 1.6l-4.3 4.2a1.2 1.2 0 0 1-1.6 0l-4.4-4.2c-.4-.5-.4-1.2 0-1.7l7-6.8Zm1.6 7-3-3-3 3h6Z\"/></g></svg>',\n    'change-case': '<svg width=\"24\" height=\"24\"><path d=\"M18.4 18.2v-.6c-.5.8-1.3 1.2-2.4 1.2-2.2 0-3.3-1.6-3.3-4.8 0-3.1 1-4.7 3.3-4.7 1.1 0 1.8.3 2.4 1.1v-.6c0-.5.4-.8.8-.8s.8.3.8.8v8.4c0 .5-.4.8-.8.8a.8.8 0 0 1-.8-.8zm-2-7.4c-1.3 0-1.8.9-1.8 3.2 0 2.4.5 3.3 1.7 3.3 1.3 0 1.8-.9 1.8-3.2 0-2.4-.5-3.3-1.7-3.3zM10 15.7H5.5l-.8 2.6a1 1 0 0 1-1 .7h-.2a.7.7 0 0 1-.7-1l4-12a1 1 0 0 1 2 0l4 12a.7.7 0 0 1-.8 1h-.2a1 1 0 0 1-1-.7l-.8-2.6zm-.3-1.5-2-6.5-1.9 6.5h3.9z\" fill-rule=\"evenodd\"/></svg>',\n    'character-count': '<svg width=\"24\" height=\"24\"><path d=\"M4 11.5h16v1H4v-1Zm4.8-6.8V10H7.7V5.8h-1v-1h2ZM11 8.3V9h2v1h-3V7.7l2-1v-.9h-2v-1h3v2.4l-2 1Zm6.3-3.4V10h-3.1V9h2.1V8h-2.1V6.8h2.1v-1h-2.1v-1h3.1ZM5.8 16.4c0-.5.2-.8.5-1 .2-.2.6-.3 1.2-.3l.8.1c.2 0 .4.2.5.3l.4.4v2.8l.2.3H8.2V18.7l-.6.3H7c-.4 0-.7 0-1-.2a1 1 0 0 1-.3-.9c0-.3 0-.6.3-.8.3-.2.7-.4 1.2-.4l.6-.2h.3v-.2l-.1-.2a.8.8 0 0 0-.5-.1 1 1 0 0 0-.4 0l-.3.4h-1Zm2.3.8h-.2l-.2.1-.4.1a1 1 0 0 0-.4.2l-.2.2.1.3.5.1h.4l.4-.4v-.6Zm2-3.4h1.2v1.7l.5-.3h.5c.5 0 .9.1 1.2.5.3.4.5.8.5 1.4 0 .6-.2 1.1-.5 1.5-.3.4-.7.6-1.3.6l-.6-.1-.4-.4v.4h-1.1v-5.4Zm1.1 3.3c0 .3 0 .6.2.8a.7.7 0 0 0 1.2 0l.2-.8c0-.4 0-.6-.2-.8a.7.7 0 0 0-.6-.3l-.6.3-.2.8Zm6.1-.5c0-.2 0-.3-.2-.4a.8.8 0 0 0-.5-.2c-.3 0-.5.1-.6.3l-.2.9c0 .3 0 .6.2.8.1.2.3.3.6.3.2 0 .4 0 .5-.2l.2-.4h1.1c0 .5-.3.8-.6 1.1a2 2 0 0 1-1.3.4c-.5 0-1-.2-1.3-.6a2 2 0 0 1-.5-1.4c0-.6.1-1.1.5-1.5.3-.4.8-.5 1.4-.5.5 0 1 0 1.2.3.4.3.5.7.5 1.2h-1v-.1Z\" fill-rule=\"evenodd\"/></svg>',\n    'checklist-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M5 17h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm14.2 11c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 8c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z\" fill-rule=\"evenodd\"/></svg>',\n    'checklist': '<svg width=\"24\" height=\"24\"><path d=\"M11 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0-6h8a1 1 0 0 1 0 2h-8a1 1 0 0 1 0-2ZM7.2 16c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8Zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8Zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 8c-.2.3-.7.4-1 0L3.8 6.9a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8Z\" fill-rule=\"evenodd\"/></svg>',\n    'checkmark': '<svg width=\"24\" height=\"24\"><path d=\"M18.2 5.4a1 1 0 0 1 1.6 1.2l-8 12a1 1 0 0 1-1.5.1l-5-5a1 1 0 1 1 1.4-1.4l4.1 4.1 7.4-11Z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-down': '<svg width=\"10\" height=\"10\"><path d=\"M8.7 2.2c.3-.3.8-.3 1 0 .4.4.4.9 0 1.2L5.7 7.8c-.3.3-.9.3-1.2 0L.2 3.4a.8.8 0 0 1 0-1.2c.3-.3.8-.3 1.1 0L5 6l3.7-3.8Z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-left': '<svg width=\"10\" height=\"10\"><path d=\"M7.8 1.3 4 5l3.8 3.7c.3.3.3.8 0 1-.4.4-.9.4-1.2 0L2.2 5.7a.8.8 0 0 1 0-1.2L6.6.2C7 0 7.4 0 7.8.2c.3.3.3.8 0 1.1Z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-right': '<svg width=\"10\" height=\"10\"><path d=\"M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3Z\" fill-rule=\"nonzero\"/></svg>',\n    'chevron-up': '<svg width=\"10\" height=\"10\"><path d=\"M8.7 7.8 5 4 1.3 7.8c-.3.3-.8.3-1 0a.8.8 0 0 1 0-1.2l4.1-4.4c.3-.3.9-.3 1.2 0l4.2 4.4c.3.3.3.9 0 1.2-.3.3-.8.3-1.1 0Z\" fill-rule=\"nonzero\"/></svg>',\n    'close': '<svg width=\"24\" height=\"24\"><path d=\"M17.3 8.2 13.4 12l3.9 3.8a1 1 0 0 1-1.5 1.5L12 13.4l-3.8 3.9a1 1 0 0 1-1.5-1.5l3.9-3.8-3.9-3.8a1 1 0 0 1 1.5-1.5l3.8 3.9 3.8-3.9a1 1 0 0 1 1.5 1.5Z\" fill-rule=\"evenodd\"/></svg>',\n    'code-sample': '<svg width=\"24\" height=\"26\"><path d=\"M7.1 11a2.8 2.8 0 0 1-.8 2 2.8 2.8 0 0 1 .8 2v1.7c0 .3.1.6.4.8.2.3.5.4.8.4.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.7 0-1.4-.3-2-.8-.5-.6-.8-1.3-.8-2V15c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 0 1-.4-.4v-.8c0-.2.2-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V9.3c0-.7.3-1.4.8-2 .6-.5 1.3-.8 2-.8.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8V11Zm9.8 0V9.3c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 0 1-.4-.4V7c0-.2.1-.4.4-.4.7 0 1.4.3 2 .8.5.6.8 1.3.8 2V11c0 .3.1.6.4.8.2.3.5.4.8.4.2 0 .4.2.4.4v.8c0 .2-.2.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8v1.7c0 .7-.3 1.4-.8 2-.6.5-1.3.8-2 .8a.4.4 0 0 1-.4-.4v-.8c0-.2.1-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V15a2.8 2.8 0 0 1 .8-2 2.8 2.8 0 0 1-.8-2Zm-3.3-.4c0 .4-.1.8-.5 1.1-.3.3-.7.5-1.1.5-.4 0-.8-.2-1.1-.5-.4-.3-.5-.7-.5-1.1 0-.5.1-.9.5-1.2.3-.3.7-.4 1.1-.4.4 0 .8.1 1.1.4.4.3.5.7.5 1.2ZM12 13c.4 0 .8.1 1.1.5.4.3.5.7.5 1.1 0 1-.1 1.6-.5 2a3 3 0 0 1-1.1 1c-.4.3-.8.4-1.1.4a.5.5 0 0 1-.5-.5V17a3 3 0 0 0 1-.2l.6-.6c-.6 0-1-.2-1.3-.5-.2-.3-.3-.7-.3-1 0-.5.1-1 .5-1.2.3-.4.7-.5 1.1-.5Z\" fill-rule=\"evenodd\"/></svg>',\n    'color-levels': '<svg width=\"24\" height=\"24\"><path d=\"M17.5 11.4A9 9 0 0 1 18 14c0 .5 0 1-.2 1.4 0 .4-.3.9-.5 1.3a6.2 6.2 0 0 1-3.7 3 5.7 5.7 0 0 1-3.2 0A5.9 5.9 0 0 1 7.6 18a6.2 6.2 0 0 1-1.4-2.6 6.7 6.7 0 0 1 0-2.8c0-.4.1-.9.3-1.3a13.6 13.6 0 0 1 2.3-4A20 20 0 0 1 12 4a26.4 26.4 0 0 1 3.2 3.4 18.2 18.2 0 0 1 2.3 4Zm-2 4.5c.4-.7.5-1.4.5-2a7.3 7.3 0 0 0-1-3.2c.2.6.2 1.2.2 1.9a4.5 4.5 0 0 1-1.3 3 5.3 5.3 0 0 1-2.3 1.5 4.9 4.9 0 0 1-2 .1 4.3 4.3 0 0 0 2.4.8 4 4 0 0 0 2-.6 4 4 0 0 0 1.5-1.5Z\" fill-rule=\"evenodd\"/></svg>',\n    'color-picker': '<svg width=\"24\" height=\"24\"><path d=\"M12 3a9 9 0 0 0 0 18 1.5 1.5 0 0 0 1.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 0 0 5-5c0-4.4-4-8-9-8Zm-5.5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm3-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm3 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Z\" fill-rule=\"nonzero\"/></svg>',\n    'color-swatch-remove-color': '<svg width=\"24\" height=\"24\"><path stroke=\"#000\" stroke-width=\"2\" d=\"M21 3 3 21\" fill-rule=\"evenodd\"/></svg>',\n    'color-swatch': '<svg width=\"24\" height=\"24\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"1\" fill-rule=\"evenodd\"/></svg>',\n    'comment-add': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"m9 19 3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h4v2Zm-2 4v-4H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3h-6.4L7 23Z\"/><path d=\"M13 10h2a1 1 0 0 1 0 2h-2v2a1 1 0 0 1-2 0v-2H9a1 1 0 0 1 0-2h2V8a1 1 0 0 1 2 0v2Z\"/></g></svg>',\n    'comment': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"m9 19 3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h4v2Zm-2 4v-4H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3h-6.4L7 23Z\"/></svg>',\n    'contrast': '<svg width=\"24\" height=\"24\"><path d=\"M12 4a7.8 7.8 0 0 1 5.7 2.3A8 8 0 1 1 12 4Zm-6 8a6 6 0 0 0 6 6V6a6 6 0 0 0-6 6Z\" fill-rule=\"evenodd\"/></svg>',\n    'copy': '<svg width=\"24\" height=\"24\"><path d=\"M16 3H6a2 2 0 0 0-2 2v11h2V5h10V3Zm1 4a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V9c0-1.2.9-2 2-2h7Zm0 12V9h-7v10h7Z\" fill-rule=\"nonzero\"/></svg>',\n    'crop': '<svg width=\"24\" height=\"24\"><path d=\"M17 8v7h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v2c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-2H7V9H5a1 1 0 1 1 0-2h2V5c0-.6.4-1 1-1s1 .4 1 1v2h7l3-3 1 1-3 3ZM9 9v5l5-5H9Zm1 6h5v-5l-5 5Z\" fill-rule=\"evenodd\"/></svg>',\n    'cut-column': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M7.2 4.5c.9 0 1.6.4 2.2 1A3.7 3.7 0 0 1 10.5 8v.5l1 1 4-4 1-.5a3.3 3.3 0 0 1 2 0c.4 0 .7.3 1 .5L17 8h4v13h-6V10l-1.5 1.5.5.5v4l-2.5-2.5-1 1v.5c0 .4 0 .8-.3 1.2-.2.5-.4.9-.8 1.2-.6.7-1.3 1-2.2 1-.8.2-1.5 0-2-.6l-.5-.8-.2-1c0-.4 0-.8.3-1.2A3.9 3.9 0 0 1 7 12.7c.5-.2 1-.3 1.5-.2l1-1-1-1c-.5 0-1 0-1.5-.2-.5-.1-1-.4-1.4-.9-.4-.3-.6-.7-.8-1.2L4.5 7c0-.4 0-.7.2-1 0-.3.3-.6.5-.8.5-.5 1.2-.8 2-.7Zm12.3 5h-3v10h3v-10ZM8 13.8h-.3l-.4.2a2.8 2.8 0 0 0-.7.4v.1a2.8 2.8 0 0 0-.6.8l-.1.4v.7l.2.5.5.2h.7a2.6 2.6 0 0 0 .8-.3 2.4 2.4 0 0 0 .7-.7 2.5 2.5 0 0 0 .3-.8 1.5 1.5 0 0 0 0-.8 1 1 0 0 0-.2-.4 1 1 0 0 0-.5-.2H8Zm3.5-3.7c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4s.7-.1 1-.4c.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4ZM7 5.8h-.4a1 1 0 0 0-.5.3 1 1 0 0 0-.2.5v.7a2.5 2.5 0 0 0 .3.8l.2.3h.1l.4.4.4.2.4.1h.7L9 9l.2-.4a1.6 1.6 0 0 0 0-.8 2.6 2.6 0 0 0-.3-.8A2.5 2.5 0 0 0 7.7 6l-.4-.1H7Z\"/></svg>',\n    'cut-row': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M22 3v5H9l3 3 2-2h4l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8.7.6 1 1.3 1 2.2.2.8 0 1.5-.6 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 0 1-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 0 1 8.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 0 1 0-2c0-.4.3-.7.5-1l2 2V3h14ZM8.5 15.3h-.3a2.6 2.6 0 0 0-.8.4 2.5 2.5 0 0 0-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 0 0 .8-.3L9 18V18l.4-.4.2-.4.1-.4v-.7a1 1 0 0 0-.2-.5 1 1 0 0 0-.4-.2h-.5Zm7 0H15a1 1 0 0 0-.4.3 1 1 0 0 0-.2.5 1.5 1.5 0 0 0 0 .7v.4a2.8 2.8 0 0 0 .5.7h.1a2.8 2.8 0 0 0 .8.6l.4.1h.7l.5-.2.2-.5v-.7a2.6 2.6 0 0 0-.3-.8 2.4 2.4 0 0 0-.7-.7 2.5 2.5 0 0 0-.8-.3h-.3ZM12 11.6c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4s.7-.1 1-.4c.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4Zm8.5-7.1h-11v2h11v-2Z\"/></svg>',\n    'cut': '<svg width=\"24\" height=\"24\"><path d=\"M18 15c.6.7 1 1.4 1 2.3 0 .8-.2 1.5-.7 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 0 1-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 0 1 8.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 0 1 0-2c0-.4.3-.7.5-1l6 6 6-6 .5 1a3.3 3.3 0 0 1 0 2c0 .4-.3.7-.5 1l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8Zm-8.5 2.2.1-.4v-.7a1 1 0 0 0-.2-.5 1 1 0 0 0-.4-.2 1.6 1.6 0 0 0-.8 0 2.6 2.6 0 0 0-.8.3 2.5 2.5 0 0 0-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 0 0 .8-.3 2.8 2.8 0 0 0 1-1Zm2.5-2.8c.4 0 .7-.1 1-.4.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4s-.7.1-1 .4c-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4Zm5.4 4 .2-.5v-.7a2.6 2.6 0 0 0-.3-.8 2.4 2.4 0 0 0-.7-.7 2.5 2.5 0 0 0-.8-.3 1.5 1.5 0 0 0-.8 0 1 1 0 0 0-.4.2 1 1 0 0 0-.2.5 1.5 1.5 0 0 0 0 .7v.4l.3.4.3.4a2.8 2.8 0 0 0 .8.5l.4.1h.7l.5-.2Z\" fill-rule=\"evenodd\"/></svg>',\n    'document-properties': '<svg width=\"24\" height=\"24\"><path d=\"M14.4 3H7a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V7.6L14.4 3ZM17 19H7V5h6v4h4v10Z\" fill-rule=\"nonzero\"/></svg>',\n    'drag': '<svg width=\"24\" height=\"24\"><path d=\"M13 5h2v2h-2V5Zm0 4h2v2h-2V9ZM9 9h2v2H9V9Zm4 4h2v2h-2v-2Zm-4 0h2v2H9v-2Zm0 4h2v2H9v-2Zm4 0h2v2h-2v-2ZM9 5h2v2H9V5Z\" fill-rule=\"evenodd\"/></svg>',\n    'duplicate-column': '<svg width=\"24\" height=\"24\"><path d=\"M17 6v16h-7V6h7Zm-2 2h-3v12h3V8Zm-2-6v2H8v15H6V2h7Z\"/></svg>',\n    'duplicate-row': '<svg width=\"24\" height=\"24\"><path d=\"M22 11v7H6v-7h16Zm-2 2H8v3h12v-3Zm-1-6v2H4v5H2V7h17Z\"/></svg>',\n    'duplicate': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M16 3v2H6v11H4V5c0-1.1.9-2 2-2h10Zm3 8h-2V9h-7v10h9a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V9c0-1.2.9-2 2-2h7a2 2 0 0 1 2 2v2Z\"/><path d=\"M17 14h1a1 1 0 0 1 0 2h-1v1a1 1 0 0 1-2 0v-1h-1a1 1 0 0 1 0-2h1v-1a1 1 0 0 1 2 0v1Z\"/></g></svg>',\n    'edit-block': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"m19.8 8.8-9.4 9.4c-.2.2-.5.4-.9.4l-5.4 1.2 1.2-5.4.5-.8 9.4-9.4c.7-.7 1.8-.7 2.5 0l2.1 2.1c.7.7.7 1.8 0 2.5Zm-2-.2 1-.9v-.3l-2.2-2.2a.3.3 0 0 0-.3 0l-1 1L18 8.5Zm-1 1-2.5-2.4-6 6 2.5 2.5 6-6Zm-7 7.1-2.6-2.4-.3.3-.1.2-.7 3 3.1-.6h.1l.4-.5Z\"/></svg>',\n    'edit-image': '<svg width=\"24\" height=\"24\"><path d=\"M18 16h2V7a2 2 0 0 0-2-2H7v2h11v9ZM6 17h15a1 1 0 0 1 0 2h-1v1a1 1 0 0 1-2 0v-1H6a2 2 0 0 1-2-2V7H3a1 1 0 1 1 0-2h1V4a1 1 0 1 1 2 0v13Zm3-5.3 1.3 2 3-4.7 3.7 6H7l2-3.3Z\" fill-rule=\"nonzero\"/></svg>',\n    'embed-page': '<svg width=\"24\" height=\"24\"><path d=\"M19 6V5H5v14h2A13 13 0 0 1 19 6Zm0 1.4c-.8.8-1.6 2.4-2.2 4.6H19V7.4Zm0 5.6h-2.4c-.4 1.8-.6 3.8-.6 6h3v-6Zm-4 6c0-2.2.2-4.2.6-6H13c-.7 1.8-1.1 3.8-1.1 6h3Zm-4 0c0-2.2.4-4.2 1-6H9.6A12 12 0 0 0 8 19h3ZM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1Zm11.8 9c.4-1.9 1-3.4 1.8-4.5a9.2 9.2 0 0 0-4 4.5h2.2Zm-3.4 0a12 12 0 0 1 2.8-4 12 12 0 0 0-5 4h2.2Z\" fill-rule=\"nonzero\"/></svg>',\n    'embed': '<svg width=\"24\" height=\"24\"><path d=\"M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1Zm1 2v14h14V5H5Zm4.8 2.6 5.6 4a.5.5 0 0 1 0 .8l-5.6 4A.5.5 0 0 1 9 16V8a.5.5 0 0 1 .8-.4Z\" fill-rule=\"nonzero\"/></svg>',\n    'emoji': '<svg width=\"24\" height=\"24\"><path d=\"M9 11c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 0 0-1 1c0 .6.4 1 1 1Zm6 0c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 0 0-1 1c0 .6.4 1 1 1Zm-3 5.5c2.1 0 4-1.5 4.4-3.5H7.6c.5 2 2.3 3.5 4.4 3.5ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm0 14.5a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13Z\" fill-rule=\"nonzero\"/></svg>',\n    'export': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M14.4 3 18 7v1h-5V5H7v14h9a1 1 0 0 1 2 0c0 1-.8 2-1.9 2H7c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2h7.5Z\"/><path d=\"M18.1 12c.5 0 .9.4.9 1 0 .5-.3 1-.8 1h-7.3c-.5 0-.9-.4-.9-1 0-.5.3-1 .8-1h7.3Z\"/><path d=\"M16.4 9.2a1 1 0 0 1 1.4.2l2.4 3.6-2.4 3.6a1 1 0 0 1-1.7-1v-.2l1.7-2.4-1.6-2.4a1 1 0 0 1 .2-1.4Z\"/></g></svg>',\n    'fill': '<svg width=\"24\" height=\"26\"><path d=\"m16.6 12-9-9-1.4 1.4 2.4 2.4-5.2 5.1c-.5.6-.5 1.6 0 2.2L9 19.6a1.5 1.5 0 0 0 2.2 0l5.5-5.5c.5-.6.5-1.6 0-2.2ZM5.2 13 10 8.2l4.8 4.8H5.2ZM19 14.5s-2 2.2-2 3.5c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.3-2-3.5-2-3.5Z\" fill-rule=\"nonzero\"/></svg>',\n    'flip-horizontally': '<svg width=\"24\" height=\"24\"><path d=\"M14 19h2v-2h-2v2Zm4-8h2V9h-2v2ZM4 7v10c0 1.1.9 2 2 2h3v-2H6V7h3V5H6a2 2 0 0 0-2 2Zm14-2v2h2a2 2 0 0 0-2-2Zm-7 16h2V3h-2v18Zm7-6h2v-2h-2v2Zm-4-8h2V5h-2v2Zm4 12a2 2 0 0 0 2-2h-2v2Z\" fill-rule=\"nonzero\"/></svg>',\n    'flip-vertically': '<svg width=\"24\" height=\"24\"><path d=\"M5 14v2h2v-2H5Zm8 4v2h2v-2h-2Zm4-14H7a2 2 0 0 0-2 2v3h2V6h10v3h2V6a2 2 0 0 0-2-2Zm2 14h-2v2a2 2 0 0 0 2-2ZM3 11v2h18v-2H3Zm6 7v2h2v-2H9Zm8-4v2h2v-2h-2ZM5 18c0 1.1.9 2 2 2v-2H5Z\" fill-rule=\"nonzero\"/></svg>',\n    'footnote': '<svg width=\"24\" height=\"24\"><path d=\"M19 13c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2h14Z\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M19 4v6h-1V5h-1.5V4h2.6Z\"/><path d=\"M12 18c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2h7ZM14 8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2h9Z\"/></svg>',\n    'format-painter': '<svg width=\"24\" height=\"24\"><path d=\"M18 5V4c0-.5-.4-1-1-1H5a1 1 0 0 0-1 1v4c0 .6.5 1 1 1h12c.6 0 1-.4 1-1V7h1v4H9v9c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-7h8V5h-3Z\" fill-rule=\"nonzero\"/></svg>',\n    'format': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M17 5a1 1 0 0 1 0 2h-4v11a1 1 0 0 1-2 0V7H7a1 1 0 1 1 0-2h10Z\"/></svg>',\n    'fullscreen': '<svg width=\"24\" height=\"24\"><path d=\"m15.3 10-1.2-1.3 2.9-3h-2.3a.9.9 0 1 1 0-1.7H19c.5 0 .9.4.9.9v4.4a.9.9 0 1 1-1.8 0V7l-2.9 3Zm0 4 3 3v-2.3a.9.9 0 1 1 1.7 0V19c0 .5-.4.9-.9.9h-4.4a.9.9 0 1 1 0-1.8H17l-3-2.9 1.3-1.2ZM10 15.4l-2.9 3h2.3a.9.9 0 1 1 0 1.7H5a.9.9 0 0 1-.9-.9v-4.4a.9.9 0 1 1 1.8 0V17l2.9-3 1.2 1.3ZM8.7 10 5.7 7v2.3a.9.9 0 0 1-1.7 0V5c0-.5.4-.9.9-.9h4.4a.9.9 0 0 1 0 1.8H7l3 2.9-1.3 1.2Z\" fill-rule=\"nonzero\"/></svg>',\n    'gallery': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"m5 15.7 2.3-2.2c.3-.3.7-.3 1 0L11 16l5.1-5c.3-.4.8-.4 1 0l2 1.9V8H5v7.7ZM5 18V19h3l1.8-1.9-2-2L5 17.9Zm14-3-2.5-2.4-6.4 6.5H19v-4ZM4 6h16c.6 0 1 .4 1 1v13c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V7c0-.6.4-1 1-1Zm6 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4ZM4.5 4h15a.5.5 0 1 1 0 1h-15a.5.5 0 0 1 0-1Zm2-2h11a.5.5 0 1 1 0 1h-11a.5.5 0 0 1 0-1Z\"/></svg>',\n    'gamma': '<svg width=\"24\" height=\"24\"><path d=\"M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1Zm1 2v14h14V5H5Zm6.5 11.8V14L9.2 8.7a5.1 5.1 0 0 0-.4-.8l-.1-.2H8v-1l.3-.1.3-.1h.7a1 1 0 0 1 .6.5l.1.3a8.5 8.5 0 0 1 .3.6l1.9 4.6 2-5.2a1 1 0 0 1 1-.6.5.5 0 0 1 .5.6L13 14v2.8a.7.7 0 0 1-1.4 0Z\" fill-rule=\"nonzero\"/></svg>',\n    'help': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M12 5.5a6.5 6.5 0 0 0-6 9 6.3 6.3 0 0 0 1.4 2l1 1a6.3 6.3 0 0 0 3.6 1 6.5 6.5 0 0 0 6-9 6.3 6.3 0 0 0-1.4-2l-1-1a6.3 6.3 0 0 0-3.6-1ZM12 4a7.8 7.8 0 0 1 5.7 2.3A8 8 0 1 1 12 4Z\"/><path d=\"M9.6 9.7a.7.7 0 0 1-.7-.8c0-1.1 1.5-1.8 3.2-1.8 1.8 0 3.2.8 3.2 2.4 0 1.4-.4 2.1-1.5 2.8-.2 0-.3.1-.3.2a2 2 0 0 0-.8.8.8.8 0 0 1-1.4-.6c.3-.7.8-1 1.3-1.5l.4-.2c.7-.4.8-.6.8-1.5 0-.5-.6-.9-1.7-.9-.5 0-1 .1-1.4.3-.2 0-.3.1-.3.2v-.2c0 .4-.4.8-.8.8Z\" fill-rule=\"nonzero\"/><circle cx=\"12\" cy=\"16\" r=\"1\"/></g></svg>',\n    'highlight-bg-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path class=\"tox-icon-highlight-bg-color__color\" d=\"M3 18h18v3H3z\"/><path fill-rule=\"nonzero\" d=\"M7.7 16.7H3l3.3-3.3-.7-.8L10.2 8l4 4.1-4 4.2c-.2.2-.6.2-.8 0l-.6-.7-1.1 1.1zm5-7.5L11 7.4l3-2.9a2 2 0 0 1 2.6 0L18 6c.7.7.7 2 0 2.7l-2.9 2.9-1.8-1.8-.5-.6\"/></g></svg>',\n    'home': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"/></svg>',\n    'horizontal-rule': '<svg width=\"24\" height=\"24\"><path d=\"M4 11h16v2H4z\" fill-rule=\"evenodd\"/></svg>',\n    'image-options': '<svg width=\"24\" height=\"24\"><path d=\"M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2Zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2Zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2Z\" fill-rule=\"nonzero\"/></svg>',\n    'image': '<svg width=\"24\" height=\"24\"><path d=\"m5 15.7 3.3-3.2c.3-.3.7-.3 1 0L12 15l4.1-4c.3-.4.8-.4 1 0l2 1.9V5H5v10.7ZM5 18V19h3l2.8-2.9-2-2L5 17.9Zm14-3-2.5-2.4-6.4 6.5H19v-4ZM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1Zm6 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z\" fill-rule=\"nonzero\"/></svg>',\n    'indent': '<svg width=\"24\" height=\"24\"><path d=\"M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 1 1 0-2Zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm-5 4h12a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2Zm-2.6-3.8L6.2 12l-1.8-1.2a1 1 0 0 1 1.2-1.6l3 2a1 1 0 0 1 0 1.6l-3 2a1 1 0 1 1-1.2-1.6Z\" fill-rule=\"evenodd\"/></svg>',\n    'info': '<svg width=\"24\" height=\"24\"><path d=\"M12 4a7.8 7.8 0 0 1 5.7 2.3A8 8 0 1 1 12 4Zm-1 3v2h2V7h-2Zm3 10v-1h-1v-5h-3v1h1v4h-1v1h4Z\" fill-rule=\"evenodd\"/></svg>',\n    'insert-character': '<svg width=\"24\" height=\"24\"><path d=\"M15 18h4l1-2v4h-6v-3.3l1.4-1a6 6 0 0 0 1.8-2.9 6.3 6.3 0 0 0-.1-4.1 5.8 5.8 0 0 0-3-3.2c-.6-.3-1.3-.5-2.1-.5a5.1 5.1 0 0 0-3.9 1.8 6.3 6.3 0 0 0-1.3 6 6.2 6.2 0 0 0 1.8 3l1.4.9V20H4v-4l1 2h4v-.5l-2-1L5.4 15A6.5 6.5 0 0 1 4 11c0-1 .2-1.9.6-2.7A7 7 0 0 1 6.3 6C7.1 5.4 8 5 9 4.5c1-.3 2-.5 3.1-.5a8.8 8.8 0 0 1 5.7 2 7 7 0 0 1 1.7 2.3 6 6 0 0 1 .2 4.8c-.2.7-.6 1.3-1 1.9a7.6 7.6 0 0 1-3.6 2.5v.5Z\" fill-rule=\"evenodd\"/></svg>',\n    'insert-time': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M12 19a7 7 0 1 0 0-14 7 7 0 0 0 0 14Zm0 2a9 9 0 1 1 0-18 9 9 0 0 1 0 18Z\"/><path d=\"M16 12h-3V7c0-.6-.4-1-1-1a1 1 0 0 0-1 1v7h5c.6 0 1-.4 1-1s-.4-1-1-1Z\"/></g></svg>',\n    'invert': '<svg width=\"24\" height=\"24\"><path d=\"M18 19.3 16.5 18a5.8 5.8 0 0 1-3.1 1.9 6.1 6.1 0 0 1-5.5-1.6A5.8 5.8 0 0 1 6 14v-.3l.1-1.2A13.9 13.9 0 0 1 7.7 9l-3-3 .7-.8 2.8 2.9 9 8.9 1.5 1.6-.7.6Zm0-5.5v.3l-.1 1.1-.4 1-1.2-1.2a4.3 4.3 0 0 0 .2-1v-.2c0-.4 0-.8-.2-1.3l-.5-1.4a14.8 14.8 0 0 0-3-4.2L12 6a26.1 26.1 0 0 0-2.2 2.5l-1-1a20.9 20.9 0 0 1 2.9-3.3L12 4l1 .8a22.2 22.2 0 0 1 4 5.4c.6 1.2 1 2.4 1 3.6Z\" fill-rule=\"evenodd\"/></svg>',\n    'italic': '<svg width=\"24\" height=\"24\"><path d=\"m16.7 4.7-.1.9h-.3c-.6 0-1 0-1.4.3-.3.3-.4.6-.5 1.1l-2.1 9.8v.6c0 .5.4.8 1.4.8h.2l-.2.8H8l.2-.8h.2c1.1 0 1.8-.5 2-1.5l2-9.8.1-.5c0-.6-.4-.8-1.4-.8h-.3l.2-.9h5.8Z\" fill-rule=\"evenodd\"/></svg>',\n    'language': '<svg width=\"24\" height=\"24\"><path d=\"M12 3a9 9 0 1 1 0 18 9 9 0 0 1 0-18Zm4.3 13.3c-.5 1-1.2 2-2 2.9a7.5 7.5 0 0 0 3.2-2.1l-.2-.2a6 6 0 0 0-1-.6Zm-8.6 0c-.5.2-.9.5-1.2.8.9 1 2 1.7 3.2 2a10 10 0 0 1-2-2.8Zm3.6-.8c-.8 0-1.6.1-2.2.3.5 1 1.2 1.9 2.1 2.7Zm1.5 0v3c.9-.8 1.6-1.7 2.1-2.7-.6-.2-1.4-.3-2.1-.3Zm-6-2.7H4.5c.2 1 .5 2.1 1 3h.3l1.3-1a10 10 0 0 1-.3-2Zm12.7 0h-2.3c0 .7-.1 1.4-.3 2l1.6 1.1c.5-1 .9-2 1-3.1Zm-3.8 0h-3V14c1 0 2 .1 2.7.4.2-.5.3-1 .3-1.6Zm-4.4 0h-3l.3 1.6c.8-.3 1.7-.4 2.7-.4v-1.3Zm-5.5-5c-.7 1-1.1 2.2-1.3 3.5h2.3c0-1 .2-1.8.5-2.6l-1.5-1Zm2.9 1.4v.1c-.2.6-.4 1.3-.4 2h3V9.4c-1 0-1.8-.1-2.6-.3Zm6.6 0h-.1l-2.4.3v1.8h3l-.5-2.1Zm3-1.4-.3.1-1.3.8c.3.8.5 1.6.5 2.6h2.3a7.5 7.5 0 0 0-1.3-3.5Zm-9 0 2 .2V5.5a9 9 0 0 0-2 2.2Zm3.5-2.3V8c.6 0 1.3 0 1.9-.2a9 9 0 0 0-2-2.3Zm-3-.7h-.1c-1.1.4-2.1 1-3 1.8l1.2.7a10 10 0 0 1 1.9-2.5Zm4.4 0 .1.1a10 10 0 0 1 1.8 2.4l1.1-.7a7.5 7.5 0 0 0-3-1.8Z\"/></svg>',\n    'line-height': '<svg width=\"24\" height=\"24\"><path d=\"M21 5a1 1 0 0 1 .1 2H13a1 1 0 0 1-.1-2H21zm0 4a1 1 0 0 1 .1 2H13a1 1 0 0 1-.1-2H21zm0 4a1 1 0 0 1 .1 2H13a1 1 0 0 1-.1-2H21zm0 4a1 1 0 0 1 .1 2H13a1 1 0 0 1-.1-2H21zM7 3.6l3.7 3.7a1 1 0 0 1-1.3 1.5h-.1L8 7.3v9.2l1.3-1.3a1 1 0 0 1 1.3 0h.1c.4.4.4 1 0 1.3v.1L7 20.4l-3.7-3.7a1 1 0 0 1 1.3-1.5h.1L6 16.7V7.4L4.7 8.7a1 1 0 0 1-1.3 0h-.1a1 1 0 0 1 0-1.3v-.1L7 3.6z\"/></svg>',\n    'line': '<svg width=\"24\" height=\"24\"><path d=\"m15 9-8 8H4v-3l8-8 3 3Zm1-1-3-3 1-1h1c-.2 0 0 0 0 0l2 2s0 .2 0 0v1l-1 1ZM4 18h16v2H4v-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'link': '<svg width=\"24\" height=\"24\"><path d=\"M6.2 12.3a1 1 0 0 1 1.4 1.4l-2 2a2 2 0 1 0 2.6 2.8l4.8-4.8a1 1 0 0 0 0-1.4 1 1 0 1 1 1.4-1.3 2.9 2.9 0 0 1 0 4L9.6 20a3.9 3.9 0 0 1-5.5-5.5l2-2Zm11.6-.6a1 1 0 0 1-1.4-1.4l2-2a2 2 0 1 0-2.6-2.8L11 10.3a1 1 0 0 0 0 1.4A1 1 0 1 1 9.6 13a2.9 2.9 0 0 1 0-4L14.4 4a3.9 3.9 0 0 1 5.5 5.5l-2 2Z\" fill-rule=\"nonzero\"/></svg>',\n    'list-bull-circle': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path d=\"M11 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 1a3 3 0 1 1 0-6 3 3 0 0 1 0 6ZM11 26a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 1a3 3 0 1 1 0-6 3 3 0 0 1 0 6ZM11 36a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 1a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z\" fill-rule=\"nonzero\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\n    'list-bull-default': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><circle cx=\"11\" cy=\"14\" r=\"3\"/><circle cx=\"11\" cy=\"24\" r=\"3\"/><circle cx=\"11\" cy=\"34\" r=\"3\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\n    'list-bull-square': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path d=\"M8 11h6v6H8zM8 21h6v6H8zM8 31h6v6H8z\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\n    'list-num-default-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M37.4 17v-4.8h-.1l-1.5 1v-1.1l1.6-1.1h1.2v6zM33.3 17.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm1.7 5.7c0-1.2 1-2 2.2-2 1.3 0 2.1.8 2.1 1.8 0 .7-.3 1.2-1.3 2.2l-1.2 1v.2h2.6v1h-4.3v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H35zm-1.7 4.3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm3.2 7.3v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H35c0-1.1 1-1.8 2.2-1.8 1.2 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.7.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .6 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm-3.3 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z\"/></g></svg>',\n    'list-num-default': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10 17v-4.8l-1.5 1v-1.1l1.6-1h1.2V17h-1.2Zm3.6.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7Zm-5 5.7c0-1.2.8-2 2.1-2s2.1.8 2.1 1.8c0 .7-.3 1.2-1.4 2.2l-1.1 1v.2h2.6v1H8.6v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H8.5Zm6.3 4.3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7ZM10 34.4v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H8.6c0-1.1 1-1.8 2.2-1.8 1.3 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.8.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .7 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7Zm4.7 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7Z\"/></g></svg>',\n    'list-num-lower-alpha-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M36.5 16c-.9 0-1.5-.5-1.5-1.3s.6-1.3 1.8-1.4h1v-.4c0-.4-.2-.6-.7-.6-.4 0-.7.1-.8.4h-1.1c0-.8.8-1.4 2-1.4S39 12 39 13V16h-1.2v-.6c-.3.4-.8.7-1.4.7Zm.4-.8c.6 0 1-.4 1-.9V14h-1c-.5.1-.7.3-.7.6 0 .4.3.6.7.6ZM33.1 16.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7ZM37.7 26c-.7 0-1.2-.2-1.5-.7v.7H35v-6.3h1.2v2.5c.3-.5.8-.9 1.5-.9 1.1 0 1.8 1 1.8 2.4 0 1.5-.7 2.4-1.8 2.4Zm-.5-3.6c-.6 0-1 .5-1 1.3s.4 1.4 1 1.4c.7 0 1-.6 1-1.4 0-.8-.3-1.3-1-1.3ZM33.2 26.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm6 7h-1c-.1-.5-.4-.8-1-.8s-1 .5-1 1.4c0 1 .4 1.4 1 1.4.5 0 .9-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm-6.1 3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\n    'list-num-lower-alpha': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10.3 15.2c.5 0 1-.4 1-.9V14h-1c-.5.1-.8.3-.8.6 0 .4.3.6.8.6Zm-.4.9c-1 0-1.5-.6-1.5-1.4 0-.8.6-1.3 1.7-1.4h1.1v-.4c0-.4-.2-.6-.7-.6-.5 0-.8.1-.9.4h-1c0-.8.8-1.4 2-1.4 1.1 0 1.8.6 1.8 1.6V16h-1.1v-.6h-.1c-.2.4-.7.7-1.3.7Zm4.6 0c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Zm-3.2 10c-.6 0-1.2-.3-1.4-.8v.7H8.5v-6.3H10v2.5c.3-.5.8-.9 1.4-.9 1.2 0 1.9 1 1.9 2.4 0 1.5-.7 2.4-1.9 2.4Zm-.4-3.7c-.7 0-1 .5-1 1.3s.3 1.4 1 1.4c.6 0 1-.6 1-1.4 0-.8-.4-1.3-1-1.3Zm4 3.7c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Zm-2.2 7h-1.2c0-.5-.4-.8-.9-.8-.6 0-1 .5-1 1.4 0 1 .4 1.4 1 1.4.5 0 .8-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7Zm1.8 3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Z\"/></g></svg>',\n    'list-num-lower-greek-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M37.4 16c-1.2 0-2-.8-2-2.3 0-1.5.8-2.4 2-2.4.6 0 1 .4 1.3 1v-.9H40v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1-.7h-.2c-.2.4-.7.8-1.3.8Zm.3-1c.6 0 1-.5 1-1.3s-.4-1.3-1-1.3-1 .5-1 1.3.4 1.4 1 1.4ZM33.3 16.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7ZM36 21.9c0-1.5.8-2.3 2.1-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.9 1.3.9.3 1.3.8 1.3 1.7 0 1.2-.7 1.9-1.8 1.9-.6 0-1.1-.3-1.4-.8v2.2H36V22Zm1.8 1.2v-1h.3c.5 0 .9-.2.9-.7 0-.5-.3-.8-.9-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1 1.3s1-.4 1-1-.4-1-1.2-1h-.3ZM33.3 26.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7ZM37.1 34.6 34.8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.2.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2Zm.7 1a2 2 0 0 0-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1ZM33.3 36.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Z\"/></g></svg>',\n    'list-num-lower-greek': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10.5 15c.7 0 1-.5 1-1.3s-.3-1.3-1-1.3c-.5 0-.9.5-.9 1.3s.4 1.4 1 1.4Zm-.3 1c-1.1 0-1.8-.8-1.8-2.3 0-1.5.7-2.4 1.8-2.4.7 0 1.1.4 1.3 1h.1v-.9h1.2v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1.1-.7h-.1c-.2.4-.7.8-1.4.8Zm5 .1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7Zm-4.9 7v-1h.3c.6 0 1-.2 1-.7 0-.5-.4-.8-1-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1.1 1.3.6 0 1-.4 1-1s-.5-1-1.3-1h-.3ZM8.6 22c0-1.5.7-2.3 2-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.8 1.3.8.3 1.3.8 1.3 1.7 0 1.2-.8 1.9-1.9 1.9-.6 0-1.1-.3-1.3-.8v2.2H8.5V22Zm6.2 4.2c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7Zm-4.5 8.5L8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.1.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2Zm.7 1a2 2 0 0 0-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1Zm4.5.5c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Z\"/></g></svg>',\n    'list-num-lower-roman-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M32.9 16v-1.2h-1.3V16H33Zm0 10v-1.2h-1.3V26H33Zm0 10v-1.2h-1.3V36H33Z\"/><path fill-rule=\"nonzero\" d=\"M36 21h-1.5v5H36zM36 31h-1.5v5H36zM39 21h-1.5v5H39zM39 31h-1.5v5H39zM42 31h-1.5v5H42zM36 11h-1.5v5H36zM36 19h-1.5v1H36zM36 29h-1.5v1H36zM39 19h-1.5v1H39zM39 29h-1.5v1H39zM42 29h-1.5v1H42zM36 9h-1.5v1H36z\"/></g></svg>',\n    'list-num-lower-roman': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M15.1 16v-1.2h1.3V16H15Zm0 10v-1.2h1.3V26H15Zm0 10v-1.2h1.3V36H15Z\"/><path fill-rule=\"nonzero\" d=\"M12 21h1.5v5H12zM12 31h1.5v5H12zM9 21h1.5v5H9zM9 31h1.5v5H9zM6 31h1.5v5H6zM12 11h1.5v5H12zM12 19h1.5v1H12zM12 29h1.5v1H12zM9 19h1.5v1H9zM9 29h1.5v1H9zM6 29h1.5v1H6zM12 9h1.5v1H12z\"/></g></svg>',\n    'list-num-upper-alpha-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"m39.3 17-.5-1.4h-2l-.5 1.4H35l2-6h1.6l2 6h-1.3Zm-1.6-4.7-.7 2.3h1.6l-.8-2.3ZM33.4 17c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7Zm4.7 9.9h-2.7v-6H38c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7Zm-1.4-5v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1Zm0 4h1.1c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9h-1.1V26ZM33 27.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Zm4.9 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2Zm-4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Z\"/></g></svg>',\n    'list-num-upper-alpha': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"m12.6 17-.5-1.4h-2L9.5 17H8.3l2-6H12l2 6h-1.3ZM11 12.3l-.7 2.3h1.6l-.8-2.3Zm4.7 4.8c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7ZM11.4 27H8.7v-6h2.6c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7ZM10 22v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1Zm0 4H11c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9H10V26Zm5.4 1.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Zm-4.1 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2Zm4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7Z\"/></g></svg>',\n    'list-num-upper-roman-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M31.6 17v-1.2H33V17h-1.3Zm0 10v-1.2H33V27h-1.3Zm0 10v-1.2H33V37h-1.3Z\"/><path fill-rule=\"nonzero\" d=\"M34.5 20H36v7h-1.5zM34.5 30H36v7h-1.5zM37.5 20H39v7h-1.5zM37.5 30H39v7h-1.5zM40.5 30H42v7h-1.5zM34.5 10H36v7h-1.5z\"/></g></svg>',\n    'list-num-upper-roman': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M15.1 17v-1.2h1.3V17H15Zm0 10v-1.2h1.3V27H15Zm0 10v-1.2h1.3V37H15Z\"/><path fill-rule=\"nonzero\" d=\"M12 20h1.5v7H12zM12 30h1.5v7H12zM9 20h1.5v7H9zM9 30h1.5v7H9zM6 30h1.5v7H6zM12 10h1.5v7H12z\"/></g></svg>',\n    'lock': '<svg width=\"24\" height=\"24\"><path d=\"M16.3 11c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H8V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h.3ZM10 8v3h4V8a1 1 0 0 0-.3-.7A1 1 0 0 0 13 7h-2a1 1 0 0 0-.7.3 1 1 0 0 0-.3.7Z\" fill-rule=\"evenodd\"/></svg>',\n    'ltr': '<svg width=\"24\" height=\"24\"><path d=\"M11 5h7a1 1 0 0 1 0 2h-1v11a1 1 0 0 1-2 0V7h-2v11a1 1 0 0 1-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 7.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L11 5ZM4.4 16.2 6.2 15l-1.8-1.2a1 1 0 0 1 1.2-1.6l3 2a1 1 0 0 1 0 1.6l-3 2a1 1 0 1 1-1.2-1.6Z\" fill-rule=\"evenodd\"/></svg>',\n    'minus': '<svg width=\"24\" height=\"24\"><path d=\"M19 11a1 1 0 0 1 .1 2H5a1 1 0 0 1-.1-2H19Z\"/></svg>',\n    'more-drawer': '<svg width=\"24\" height=\"24\"><path d=\"M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2Zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2Zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2Z\" fill-rule=\"nonzero\"/></svg>',\n    'new-document': '<svg width=\"24\" height=\"24\"><path d=\"M14.4 3H7a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V7.6L14.4 3ZM17 19H7V5h6v4h4v10Z\" fill-rule=\"nonzero\"/></svg>',\n    'new-tab': '<svg width=\"24\" height=\"24\"><path d=\"m15 13 2-2v8H5V7h8l-2 2H7v8h8v-4Zm4-8v5.5l-2-2-5.6 5.5H10v-1.4L15.5 7l-2-2H19Z\" fill-rule=\"evenodd\"/></svg>',\n    'non-breaking': '<svg width=\"24\" height=\"24\"><path d=\"M11 11H8a1 1 0 1 1 0-2h3V6c0-.6.4-1 1-1s1 .4 1 1v3h3c.6 0 1 .4 1 1s-.4 1-1 1h-3v3c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-3Zm10 4v5H3v-5c0-.6.4-1 1-1s1 .4 1 1v3h14v-3c0-.6.4-1 1-1s1 .4 1 1Z\" fill-rule=\"evenodd\"/></svg>',\n    'notice': '<svg width=\"24\" height=\"24\"><path d=\"M15.5 4 20 8.5v7L15.5 20h-7L4 15.5v-7L8.5 4h7ZM13 17v-2h-2v2h2Zm0-4V7h-2v6h2Z\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"/></svg>',\n    'ordered-list-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M6 17h8a1 1 0 0 1 0 2H6a1 1 0 0 1 0-2Zm0-6h8a1 1 0 0 1 0 2H6a1 1 0 0 1 0-2Zm0-6h8a1 1 0 0 1 0 2H6a1 1 0 1 1 0-2Zm13-1v3.5a.5.5 0 1 1-1 0V5h-.5a.5.5 0 1 1 0-1H19Zm-1 8.8.2.2h1.3a.5.5 0 1 1 0 1h-1.6a1 1 0 0 1-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 0 0-.2-.2h-1.3a.5.5 0 0 1-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3Zm2 4.2v2c0 .6-.4 1-1 1h-1.5a.5.5 0 0 1 0-1h1.2a.3.3 0 1 0 0-.6h-1.3a.4.4 0 1 1 0-.8h1.3a.3.3 0 0 0 0-.6h-1.2a.5.5 0 1 1 0-1H19c.6 0 1 .4 1 1Z\" fill-rule=\"evenodd\"/></svg>',\n    'ordered-list': '<svg width=\"24\" height=\"24\"><path d=\"M10 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 1 1 0-2ZM6 4v3.5c0 .3-.2.5-.5.5a.5.5 0 0 1-.5-.5V5h-.5a.5.5 0 0 1 0-1H6Zm-1 8.8.2.2h1.3c.3 0 .5.2.5.5s-.2.5-.5.5H4.9a1 1 0 0 1-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 0 0-.2-.2H4.5a.5.5 0 0 1-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3ZM7 17v2c0 .6-.4 1-1 1H4.5a.5.5 0 0 1 0-1h1.2c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.4a.4.4 0 1 1 0-.8h1.3c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.5a.5.5 0 1 1 0-1H6c.6 0 1 .4 1 1Z\" fill-rule=\"evenodd\"/></svg>',\n    'orientation': '<svg width=\"24\" height=\"24\"><path d=\"M7.3 6.4 1 13l6.4 6.5 6.5-6.5-6.5-6.5ZM3.7 13l3.6-3.7L11 13l-3.7 3.7-3.6-3.7ZM12 6l2.8 2.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0L9.2 5.7a.8.8 0 0 1 0-1.2L13.6.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L12 4h1a9 9 0 1 1-4.3 16.9l1.5-1.5A7 7 0 1 0 13 6h-1Z\" fill-rule=\"nonzero\"/></svg>',\n    'outdent': '<svg width=\"24\" height=\"24\"><path d=\"M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 1 1 0-2Zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm-5 4h12a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2Zm1.6-3.8a1 1 0 0 1-1.2 1.6l-3-2a1 1 0 0 1 0-1.6l3-2a1 1 0 0 1 1.2 1.6L6.8 12l1.8 1.2Z\" fill-rule=\"evenodd\"/></svg>',\n    'page-break': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M5 11c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2Zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2Zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2Zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1h-1a1 1 0 0 1 0-2Zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2ZM7 3v5h10V3c0-.6.4-1 1-1s1 .4 1 1v7H5V3c0-.6.4-1 1-1s1 .4 1 1ZM6 22a1 1 0 0 1-1-1v-7h14v7c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-5H7v5c0 .6-.4 1-1 1Z\"/></g></svg>',\n    'paragraph': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M10 5h7a1 1 0 0 1 0 2h-1v11a1 1 0 0 1-2 0V7h-2v11a1 1 0 0 1-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 6.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L10 5Z\"/></svg>',\n    'paste-column-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 0 1 2.8 2H18c1 0 2 .8 2 1.9V7h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h7v2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0 1 12 1Zm8 7v12h-6V8h6Zm-1.5 1.5h-3v9h3v-9ZM12 3a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z\"/></svg>',\n    'paste-column-before': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 0 1 2.8 2H18c1 0 2 .8 2 1.9V18c0 1-.8 2-1.9 2H11v-2h7V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v2H4V5c0-1 .8-2 1.9-2H9.2A3 3 0 0 1 12 1Zm-2 7v12H4V8h6ZM8.5 9.5h-3v9h3v-9ZM12 3a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z\"/></svg>',\n    'paste-row-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 0 1 2.8 2H18c1 0 2 .8 2 1.9V11h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h14c0 1-.8 2-1.9 2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0 1 12 1Zm10 11v5H8v-5h14Zm-1.5 1.5h-11v2h11v-2ZM12 3a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z\"/></svg>',\n    'paste-row-before': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" d=\"M12 1a3 3 0 0 1 2.8 2H18c1 0 2 .8 2 1.9V7h-2V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h12v-4h2v4c0 1-.8 2-1.9 2H6c-1 0-2-.8-2-1.9V5c0-1 .8-2 1.9-2H9.2A3 3 0 0 1 12 1Zm10 7v5H8V8h14Zm-1.5 1.5h-11v2h11v-2ZM12 3a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z\"/></svg>',\n    'paste-text': '<svg width=\"24\" height=\"24\"><path d=\"M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h3V9h9ZM9 20H6a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0 1 12 1a3 3 0 0 1 2.8 2H18a2 2 0 0 1 2 2v4h1v12H9v-1Zm1.5-9.5v9h9v-9h-9ZM12 3a1 1 0 0 0-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1Zm0 9h6v2h-.5l-.5-1h-1v4h.8v1h-3.6v-1h.8v-4h-1l-.5 1H12v-2Z\" fill-rule=\"nonzero\"/></svg>',\n    'paste': '<svg width=\"24\" height=\"24\"><path d=\"M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h3V9h9ZM9 20H6a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0 1 12 1a3 3 0 0 1 2.8 2H18a2 2 0 0 1 2 2v4h1v12H9v-1Zm1.5-9.5v9h9v-9h-9ZM12 3a1 1 0 0 0-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1Z\" fill-rule=\"nonzero\"/></svg>',\n    'permanent-pen': '<svg width=\"24\" height=\"24\"><path d=\"M10.5 17.5 8 20H3v-3l3.5-3.5a2 2 0 0 1 0-3L14 3l1 1-7.3 7.3a1 1 0 0 0 0 1.4l3.6 3.6c.4.4 1 .4 1.4 0L20 9l1 1-7.6 7.6a2 2 0 0 1-2.8 0l-.1-.1Z\" fill-rule=\"nonzero\"/></svg>',\n    'plus': '<svg width=\"24\" height=\"24\"><path d=\"M12 4c.5 0 1 .4 1 .9V11h6a1 1 0 0 1 .1 2H13v6a1 1 0 0 1-2 .1V13H5a1 1 0 0 1-.1-2H11V5c0-.6.4-1 1-1Z\"/></svg>',\n    'preferences': '<svg width=\"24\" height=\"24\"><path d=\"m20.1 13.5-1.9.2a5.8 5.8 0 0 1-.6 1.5l1.2 1.5c.4.4.3 1 0 1.4l-.7.7a1 1 0 0 1-1.4 0l-1.5-1.2a6.2 6.2 0 0 1-1.5.6l-.2 1.9c0 .5-.5.9-1 .9h-1a1 1 0 0 1-1-.9l-.2-1.9a5.8 5.8 0 0 1-1.5-.6l-1.5 1.2a1 1 0 0 1-1.4 0l-.7-.7a1 1 0 0 1 0-1.4l1.2-1.5a6.2 6.2 0 0 1-.6-1.5l-1.9-.2a1 1 0 0 1-.9-1v-1c0-.5.4-1 .9-1l1.9-.2a5.8 5.8 0 0 1 .6-1.5L5.2 7.3a1 1 0 0 1 0-1.4l.7-.7a1 1 0 0 1 1.4 0l1.5 1.2a6.2 6.2 0 0 1 1.5-.6l.2-1.9c0-.5.5-.9 1-.9h1c.5 0 1 .4 1 .9l.2 1.9a5.8 5.8 0 0 1 1.5.6l1.5-1.2a1 1 0 0 1 1.4 0l.7.7c.3.4.4 1 0 1.4l-1.2 1.5a6.2 6.2 0 0 1 .6 1.5l1.9.2c.5 0 .9.5.9 1v1c0 .5-.4 1-.9 1ZM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z\" fill-rule=\"evenodd\"/></svg>',\n    'preview': '<svg width=\"24\" height=\"24\"><path d=\"M3.5 12.5c.5.8 1.1 1.6 1.8 2.3 2 2 4.2 3.2 6.7 3.2s4.7-1.2 6.7-3.2a16.2 16.2 0 0 0 2.1-2.8 15.7 15.7 0 0 0-2.1-2.8c-2-2-4.2-3.2-6.7-3.2a9.3 9.3 0 0 0-6.7 3.2A16.2 16.2 0 0 0 3.2 12c0 .2.2.3.3.5Zm-2.4-1 .7-1.2L4 7.8C6.2 5.4 8.9 4 12 4c3 0 5.8 1.4 8.1 3.8a18.2 18.2 0 0 1 2.8 3.7v1l-.7 1.2-2.1 2.5c-2.3 2.4-5 3.8-8.1 3.8-3 0-5.8-1.4-8.1-3.8a18.2 18.2 0 0 1-2.8-3.7 1 1 0 0 1 0-1Zm12-3.3a2 2 0 1 0 2.7 2.6 4 4 0 1 1-2.6-2.6Z\" fill-rule=\"nonzero\"/></svg>',\n    'print': '<svg width=\"24\" height=\"24\"><path d=\"M18 8H6a3 3 0 0 0-3 3v6h2v3h14v-3h2v-6a3 3 0 0 0-3-3Zm-1 10H7v-4h10v4Zm.5-5c-.8 0-1.5-.7-1.5-1.5s.7-1.5 1.5-1.5 1.5.7 1.5 1.5-.7 1.5-1.5 1.5Zm.5-8H6v2h12V5Z\" fill-rule=\"nonzero\"/></svg>',\n    'quote': '<svg width=\"24\" height=\"24\"><path d=\"M7.5 17h.9c.4 0 .7-.2.9-.6L11 13V8c0-.6-.4-1-1-1H6a1 1 0 0 0-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 0 0 .8 1.3Zm8 0h.9c.4 0 .7-.2.9-.6L19 13V8c0-.6-.4-1-1-1h-4a1 1 0 0 0-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 0 0 .8 1.3Z\" fill-rule=\"nonzero\"/></svg>',\n    'redo': '<svg width=\"24\" height=\"24\"><path d=\"M17.6 10H12c-2.8 0-4.4 1.4-4.9 3.5-.4 2 .3 4 1.4 4.6a1 1 0 1 1-1 1.8c-2-1.2-2.9-4.1-2.3-6.8.6-3 3-5.1 6.8-5.1h5.6l-3.3-3.3a1 1 0 1 1 1.4-1.4l5 5a1 1 0 0 1 0 1.4l-5 5a1 1 0 0 1-1.4-1.4l3.3-3.3Z\" fill-rule=\"nonzero\"/></svg>',\n    'reload': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"m5 22.1-1.2-4.7v-.2a1 1 0 0 1 1-1l5 .4a1 1 0 1 1-.2 2l-2.2-.2a7.8 7.8 0 0 0 8.4.2 7.5 7.5 0 0 0 3.5-6.4 1 1 0 1 1 2 0 9.5 9.5 0 0 1-4.5 8 9.9 9.9 0 0 1-10.2 0l.4 1.4a1 1 0 1 1-2 .5ZM13.6 7.4c0-.5.5-1 1-.9l2.8.2a8 8 0 0 0-9.5-1 7.5 7.5 0 0 0-3.6 7 1 1 0 0 1-2 0 9.5 9.5 0 0 1 4.5-8.6 10 10 0 0 1 10.9.3l-.3-1a1 1 0 0 1 2-.5l1.1 4.8a1 1 0 0 1-1 1.2l-5-.4a1 1 0 0 1-.9-1Z\"/></g></svg>',\n    'remove-formatting': '<svg width=\"24\" height=\"24\"><path d=\"M13.2 6a1 1 0 0 1 0 .2l-2.6 10a1 1 0 0 1-1 .8h-.2a.8.8 0 0 1-.8-1l2.6-10H8a1 1 0 1 1 0-2h9a1 1 0 0 1 0 2h-3.8ZM5 18h7a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Zm13 1.5L16.5 18 15 19.5a.7.7 0 0 1-1-1l1.5-1.5-1.5-1.5a.7.7 0 0 1 1-1l1.5 1.5 1.5-1.5a.7.7 0 0 1 1 1L17.5 17l1.5 1.5a.7.7 0 0 1-1 1Z\" fill-rule=\"evenodd\"/></svg>',\n    'remove': '<svg width=\"24\" height=\"24\"><path d=\"M16 7h3a1 1 0 0 1 0 2h-1v9a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3V9H5a1 1 0 1 1 0-2h3V6a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3v1Zm-2 0V6c0-.6-.4-1-1-1h-2a1 1 0 0 0-1 1v1h4Zm2 2H8v9c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V9Zm-7 3a1 1 0 0 1 2 0v4a1 1 0 0 1-2 0v-4Zm4 0a1 1 0 0 1 2 0v4a1 1 0 0 1-2 0v-4Z\" fill-rule=\"nonzero\"/></svg>',\n    'resize-handle': '<svg width=\"10\" height=\"10\"><g fill-rule=\"nonzero\"><path d=\"M8.1 1.1A.5.5 0 1 1 9 2l-7 7A.5.5 0 1 1 1 8l7-7ZM8.1 5.1A.5.5 0 1 1 9 6l-3 3A.5.5 0 1 1 5 8l3-3Z\"/></g></svg>',\n    'resize': '<svg width=\"24\" height=\"24\"><path d=\"M4 5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h6c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 0 1-.7.3H7.4L18 16.6V13c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v6c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3h-6a1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3.6L6 7.4V11c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3 1 1 0 0 1-.7-.3A1 1 0 0 1 4 11V5Z\" fill-rule=\"evenodd\"/></svg>',\n    'restore-draft': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M17 13c0 .6-.4 1-1 1h-4V8c0-.6.4-1 1-1s1 .4 1 1v4h2c.6 0 1 .4 1 1Z\"/><path d=\"M4.7 10H9a1 1 0 0 1 0 2H3a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v3l2.5-2.4a9.2 9.2 0 0 1 10.8-1.5A9 9 0 0 1 13.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 1 1 1.3-1.5 7.2 7.2 0 0 0 11.6-3.7 7 7 0 0 0-3.5-7.7A7.2 7.2 0 0 0 8 7L4.7 10Z\" fill-rule=\"nonzero\"/></g></svg>',\n    'rotate-left': '<svg width=\"24\" height=\"24\"><path d=\"M4.7 10H9a1 1 0 0 1 0 2H3a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v3l2.5-2.4a9.2 9.2 0 0 1 10.8-1.5A9 9 0 0 1 13.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 1 1 1.3-1.5 7.2 7.2 0 0 0 11.6-3.7 7 7 0 0 0-3.5-7.7A7.2 7.2 0 0 0 8 7L4.7 10Z\" fill-rule=\"nonzero\"/></svg>',\n    'rotate-right': '<svg width=\"24\" height=\"24\"><path d=\"M20 8V5a1 1 0 0 1 2 0v6c0 .6-.4 1-1 1h-6a1 1 0 0 1 0-2h4.3L16 7A7.2 7.2 0 0 0 7.7 6a7 7 0 0 0 3 13.1c1.9.1 3.7-.5 5-1.7a1 1 0 0 1 1.4 1.5A9.2 9.2 0 0 1 2.2 14c-.9-3.9 1-8 4.5-9.9 3.5-1.9 8-1.3 10.8 1.5L20 8Z\" fill-rule=\"nonzero\"/></svg>',\n    'rtl': '<svg width=\"24\" height=\"24\"><path d=\"M8 5h8v2h-2v12h-2V7h-2v12H8v-7c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 4.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L8 5Zm12 11.2a1 1 0 1 1-1 1.6l-3-2a1 1 0 0 1 0-1.6l3-2a1 1 0 1 1 1 1.6L18.4 15l1.8 1.2Z\" fill-rule=\"evenodd\"/></svg>',\n    'save': '<svg width=\"24\" height=\"24\"><path d=\"M5 16h14a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2c0-1.1.9-2 2-2Zm0 2v2h14v-2H5Zm10 0h2v2h-2v-2Zm-4-6.4L8.7 9.3a1 1 0 1 0-1.4 1.4l4 4c.4.4 1 .4 1.4 0l4-4a1 1 0 1 0-1.4-1.4L13 11.6V4a1 1 0 0 0-2 0v7.6Z\" fill-rule=\"nonzero\"/></svg>',\n    'search': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 1 1 1.4-1.4l4.3 4.4a1 1 0 0 1-1.4 1.4l-4.4-4.3Zm-5-.3a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z\" fill-rule=\"nonzero\"/></svg>',\n    'select-all': '<svg width=\"24\" height=\"24\"><path d=\"M3 5h2V3a2 2 0 0 0-2 2Zm0 8h2v-2H3v2Zm4 8h2v-2H7v2ZM3 9h2V7H3v2Zm10-6h-2v2h2V3Zm6 0v2h2a2 2 0 0 0-2-2ZM5 21v-2H3c0 1.1.9 2 2 2Zm-2-4h2v-2H3v2ZM9 3H7v2h2V3Zm2 18h2v-2h-2v2Zm8-8h2v-2h-2v2Zm0 8a2 2 0 0 0 2-2h-2v2Zm0-12h2V7h-2v2Zm0 8h2v-2h-2v2Zm-4 4h2v-2h-2v2Zm0-16h2V3h-2v2ZM7 17h10V7H7v10Zm2-8h6v6H9V9Z\" fill-rule=\"nonzero\"/></svg>',\n    'selected': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2Zm3.6 10.9L7 12.3a.7.7 0 0 0-1 1L9.6 17 18 8.6a.7.7 0 0 0 0-1 .7.7 0 0 0-1 0l-7.4 7.3Z\"/></svg>',\n    'send': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"m13.3 22 7-18.3-18.3 7L9 15l4.3 7ZM18 6.8l-.7-.7L9.4 14l.7.7L18 6.8Z\"/></svg>',\n    'settings': '<svg width=\"24\" height=\"24\"><path d=\"M11 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6V8H5a1 1 0 1 1 0-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.5V6ZM8 8h2V6H8v2Zm9 2.8v.2h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v.3c0 .2 0 .3-.2.5l-.6.2h-2.4c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6V13H5a1 1 0 0 1 0-2h8v-.3c0-.2 0-.3.2-.5l.6-.2h2.4c.3 0 .4 0 .6.2l.2.6ZM14 13h2v-2h-2v2Zm-3 2.8v.2h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6V18H5a1 1 0 0 1 0-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.6ZM8 18h2v-2H8v2Z\" fill-rule=\"evenodd\"/></svg>',\n    'sharpen': '<svg width=\"24\" height=\"24\"><path d=\"m16 6 4 4-8 9-8-9 4-4h8Zm-4 10.2 5.5-6.2-.1-.1H12v-.3h5.1l-.2-.2H12V9h4.6l-.2-.2H12v-.3h4.1l-.2-.2H12V8h3.6l-.2-.2H8.7L6.5 10l.1.1H12v.3H6.9l.2.2H12v.3H7.3l.2.2H12v.3H7.7l.3.2h4v.3H8.2l.2.2H12v.3H8.6l.3.2H12v.3H9l.3.2H12v.3H9.5l.2.2H12v.3h-2l.2.2H12v.3h-1.6l.2.2H12v.3h-1.1l.2.2h.9v.3h-.7l.2.2h.5v.3h-.3l.3.2Z\" fill-rule=\"evenodd\"/></svg>',\n    'sourcecode': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M9.8 15.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0l-4.4-4.1a.8.8 0 0 1 0-1.2l4.4-4.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L6 12l3.8 3.7ZM14.2 15.7c-.3.3-.3.8 0 1 .4.4.9.4 1.2 0l4.4-4.1c.3-.3.3-.9 0-1.2l-4.4-4.2a.8.8 0 0 0-1.2 0c-.3.3-.3.8 0 1.1L18 12l-3.8 3.7Z\"/></g></svg>',\n    'spell-check': '<svg width=\"24\" height=\"24\"><path d=\"M6 8v3H5V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h2c.3 0 .5.1.7.3.2.2.3.4.3.7v6H8V8H6Zm0-3v2h2V5H6Zm13 0h-3v5h3v1h-3a1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3v1Zm-5 1.5-.1.7c-.1.2-.3.3-.6.3.3 0 .5.1.6.3l.1.7V10c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3h-3V4h3c.3 0 .5.1.7.3.2.2.3.4.3.7v1.5ZM13 10V8h-2v2h2Zm0-3V5h-2v2h2Zm3 5 1 1-6.5 7L7 15.5l1.3-1 2.2 2.2L16 12Z\" fill-rule=\"evenodd\"/></svg>',\n    'strike-through': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M15.6 8.5c-.5-.7-1-1.1-1.3-1.3-.6-.4-1.3-.6-2-.6-2.7 0-2.8 1.7-2.8 2.1 0 1.6 1.8 2 3.2 2.3 4.4.9 4.6 2.8 4.6 3.9 0 1.4-.7 4.1-5 4.1A6.2 6.2 0 0 1 7 16.4l1.5-1.1c.4.6 1.6 2 3.7 2 1.6 0 2.5-.4 3-1.2.4-.8.3-2-.8-2.6-.7-.4-1.6-.7-2.9-1-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1Z\"/><path d=\"M5 11h14a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z\" fill-rule=\"nonzero\"/></g></svg>',\n    'subscript': '<svg width=\"24\" height=\"24\"><path d=\"m10.4 10 4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10ZM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 0 0-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 0 1-1.3 1.3l-.6.6h2.6V19Z\" fill-rule=\"nonzero\"/></svg>',\n    'superscript': '<svg width=\"24\" height=\"24\"><path d=\"M15 9.4 10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4Zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11Z\" fill-rule=\"nonzero\"/></svg>',\n    'table-caption': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><rect width=\"12\" height=\"2\" x=\"3\" y=\"4\" rx=\"1\"/><path d=\"M19 8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-8c0-1.1.9-2 2-2h14ZM5 15v3h6v-3H5Zm14 0h-6v3h6v-3Zm0-5h-6v3h6v-3ZM5 13h6v-3H5v3Z\"/></g></svg>',\n    'table-cell-classes': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M13 4v9H3V6c0-1.1.9-2 2-2h8Zm-2 2H5v5h6V6Z\"/><path fill-rule=\"nonzero\" d=\"M13 4h6a2 2 0 0 1 2 2v7h-8v-2h6V6h-6V4Z\" opacity=\".2\"/><path d=\"m18 20-2.6 1.6.7-3-2.4-2 3.1-.2 1.2-2.9 1.2 2.9 3.1.2-2.4 2 .7 3z\"/><path fill-rule=\"nonzero\" d=\"M3 13v5c0 1.1.9 2 2 2h8v-7h-2v5H5v-5H3Z\" opacity=\".2\"/></g></svg>',\n    'table-cell-properties': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm-8 9H5v5h6v-5Zm8 0h-6v5h6v-5Zm-8-7H5v5h6V6Z\"/></svg>',\n    'table-cell-select-all': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm0 2H5v12h14V6Z\"/><path d=\"M13 6v5h6v2h-6v5h-2v-5H5v-2h6V6h2Z\" opacity=\".2\"/></g></svg>',\n    'table-cell-select-inner': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm0 2H5v12h14V6Z\" opacity=\".2\"/><path d=\"M13 6v5h6v2h-6v5h-2v-5H5v-2h6V6h2Z\"/></g></svg>',\n    'table-classes': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v7h-8v7H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm-8 9H5v5h6v-5Zm8-7h-6v5h6V6Zm-8 0H5v5h6V6Z\"/><path d=\"m18 20-2.6 1.6.7-3-2.4-2 3.1-.2 1.2-2.9 1.2 2.9 3.1.2-2.4 2 .7 3z\"/></g></svg>',\n    'table-delete-column': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm-4 4h-2V6h-2v2H9V6H5v12h4v-2h2v2h2v-2h2v2h4V6h-4v2Zm.3.5 1 1.2-3 2.3 3 2.3-1 1.2L12 13l-3.3 2.6-1-1.2 3-2.3-3-2.3 1-1.2L12 11l3.3-2.5Z\"/></svg>',\n    'table-delete-row': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm0 2H5v3h2.5v2H5v2h2.5v2H5v3h14v-3h-2.5v-2H19v-2h-2.5V9H19V6Zm-4.7 1.8 1.2 1L13 12l2.6 3.3-1.2 1-2.3-3-2.3 3-1.2-1L11 12 8.5 8.7l1.2-1 2.3 3 2.3-3Z\"/></svg>',\n    'table-delete-table': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14ZM5 6v12h14V6H5Z\"/><path d=\"m14.4 8.6 1.1 1-2.4 2.4 2.4 2.4-1.1 1.1-2.4-2.4-2.4 2.4-1-1.1 2.3-2.4-2.3-2.4 1-1 2.4 2.3z\"/></g></svg>',\n    'table-insert-column-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M20 4c.6 0 1 .4 1 1v2a1 1 0 0 1-2 0V6h-8v12h8v-1a1 1 0 0 1 2 0v2c0 .5-.4 1-.9 1H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h15ZM9 13H5v5h4v-5Zm7-5c.5 0 1 .4 1 .9V11h2a1 1 0 0 1 .1 2H17v2a1 1 0 0 1-2 .1V13h-2a1 1 0 0 1-.1-2H15V9c0-.6.4-1 1-1ZM9 6H5v5h4V6Z\"/></svg>',\n    'table-insert-column-before': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a1 1 0 0 1-1-1v-2a1 1 0 0 1 2 0v1h8V6H5v1a1 1 0 1 1-2 0V5c0-.6.4-1 1-1h15Zm0 9h-4v5h4v-5ZM8 8c.5 0 1 .4 1 .9V11h2a1 1 0 0 1 .1 2H9v2a1 1 0 0 1-2 .1V13H5a1 1 0 0 1-.1-2H7V9c0-.6.4-1 1-1Zm11-2h-4v5h4V6Z\"/></svg>',\n    'table-insert-row-above': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4a1 1 0 1 1 0 2H5v6h14V6h-1a1 1 0 0 1 0-2h2c.6 0 1 .4 1 1v13a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5c0-.6.4-1 1-1h2Zm5 10H5v4h6v-4Zm8 0h-6v4h6v-4ZM12 3c.5 0 1 .4 1 .9V6h2a1 1 0 0 1 0 2h-2v2a1 1 0 0 1-2 .1V8H9a1 1 0 0 1 0-2h2V4c0-.6.4-1 1-1Z\"/></svg>',\n    'table-insert-row-after': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M12 13c.5 0 1 .4 1 .9V16h2a1 1 0 0 1 .1 2H13v2a1 1 0 0 1-2 .1V18H9a1 1 0 0 1-.1-2H11v-2c0-.6.4-1 1-1Zm6 7a1 1 0 0 1 0-2h1v-6H5v6h1a1 1 0 0 1 0 2H4a1 1 0 0 1-1-1V6c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v13c0 .5-.4 1-.9 1H18ZM11 6H5v4h6V6Zm8 0h-6v4h6V6Z\"/></svg>',\n    'table-left-header': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm0 9h-4v5h4v-5Zm-6 0H9v5h4v-5Zm0-7H9v5h4V6Zm6 0h-4v5h4V6Z\"/></svg>',\n    'table-merge-cells': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14ZM5 15.5V18h3v-2.5H5Zm14-5h-9V18h9v-7.5ZM19 6h-4v2.5h4V6ZM8 6H5v2.5h3V6Zm5 0h-3v2.5h3V6Zm-8 7.5h3v-3H5v3Z\"/></svg>',\n    'table-row-numbering-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M6 4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H6Zm0 12h8v3H6v-3Zm11 0c.6 0 1 .4 1 1v1a1 1 0 0 1-2 0v-1c0-.6.4-1 1-1ZM6 11h8v3H6v-3Zm11 0c.6 0 1 .4 1 1v1a1 1 0 0 1-2 0v-1c0-.6.4-1 1-1ZM6 6h8v3H6V6Zm11 0c.6 0 1 .4 1 1v1a1 1 0 1 1-2 0V7c0-.6.4-1 1-1Z\"/></svg>',\n    'table-row-numbering': '<svg width=\"24\" height=\"24\"><path d=\"M18 4a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h12Zm0 12h-8v3h8v-3ZM7 16a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1c0-.6-.4-1-1-1Zm11-5h-8v3h8v-3ZM7 11a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1c0-.6-.4-1-1-1Zm11-5h-8v3h8V6ZM7 6a1 1 0 0 0-1 1v1a1 1 0 1 0 2 0V7c0-.6-.4-1-1-1Z\"/></svg>',\n    'table-row-properties': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14ZM5 15v3h6v-3H5Zm14 0h-6v3h6v-3Zm0-9h-6v3h6V6ZM5 9h6V6H5v3Z\"/></svg>',\n    'table-split-cells': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14ZM8 15.5H5V18h3v-2.5Zm11-5h-9V18h9v-7.5Zm-2.5 1 1 1-2 2 2 2-1 1-2-2-2 2-1-1 2-2-2-2 1-1 2 2 2-2Zm-8.5-1H5v3h3v-3ZM19 6h-4v2.5h4V6ZM8 6H5v2.5h3V6Zm5 0h-3v2.5h3V6Z\"/></svg>',\n    'table-top-header': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14Zm-8 11H5v3h6v-3Zm8 0h-6v3h6v-3Zm0-5h-6v3h6v-3ZM5 13h6v-3H5v3Z\"/></svg>',\n    'table': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14ZM5 14v4h6v-4H5Zm14 0h-6v4h6v-4Zm0-6h-6v4h6V8ZM5 12h6V8H5v4Z\"/></svg>',\n    'template-add': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9 12v4H5a2 2 0 0 0-2 2v3h9.3a6 6 0 0 1-.3-2H5v-1h7a6 6 0 0 1 .8-2H11v-5l-.8-.6a3 3 0 1 1 3.6 0l-.8.6v4.7a6 6 0 0 1 2-1.9V12a5 5 0 1 0-6 0Z\"/><path d=\"M18 15c.5 0 1 .4 1 .9V18h2a1 1 0 0 1 .1 2H19v2a1 1 0 0 1-2 .1V20h-2a1 1 0 0 1-.1-2H17v-2c0-.6.4-1 1-1Z\"/></svg>',\n    'template': '<svg width=\"24\" height=\"24\"><path d=\"M19 19v-1H5v1h14ZM9 16v-4a5 5 0 1 1 6 0v4h4a2 2 0 0 1 2 2v3H3v-3c0-1.1.9-2 2-2h4Zm4 0v-5l.8-.6a3 3 0 1 0-3.6 0l.8.6v5h2Z\" fill-rule=\"nonzero\"/></svg>',\n    'temporary-placeholder': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M9 7.6V6h2.5V4.5a.5.5 0 1 1 1 0V6H15v1.6a8 8 0 1 1-6 0Zm-2.6 5.3a.5.5 0 0 0 .3.6c.3 0 .6 0 .6-.3l.1-.2a5 5 0 0 1 3.3-2.8c.3-.1.4-.4.4-.6-.1-.3-.4-.5-.6-.4a6 6 0 0 0-4.1 3.7Z\"/><circle cx=\"14\" cy=\"4\" r=\"1\"/><circle cx=\"12\" cy=\"2\" r=\"1\"/><circle cx=\"10\" cy=\"4\" r=\"1\"/></g></svg>',\n    'text-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path class=\"tox-icon-text-color__color\" d=\"M3 18h18v3H3z\"/><path d=\"M8.7 16h-.8a.5.5 0 0 1-.5-.6l2.7-9c.1-.3.3-.4.5-.4h2.8c.2 0 .4.1.5.4l2.7 9a.5.5 0 0 1-.5.6h-.8a.5.5 0 0 1-.4-.4l-.7-2.2c0-.3-.3-.4-.5-.4h-3.4c-.2 0-.4.1-.5.4l-.7 2.2c0 .3-.2.4-.4.4Zm2.6-7.6-.6 2a.5.5 0 0 0 .5.6h1.6a.5.5 0 0 0 .5-.6l-.6-2c0-.3-.3-.4-.5-.4h-.4c-.2 0-.4.1-.5.4Z\"/></g></svg>',\n    'text-size-decrease': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 5a1 1 0 1 1 0 2h-4v11a1 1 0 1 1-2 0V7H4a1 1 0 0 1 0-2h10ZM14 12a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-6Z\"/></svg>',\n    'text-size-increase': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 5a1 1 0 1 1 0 2h-4v11a1 1 0 1 1-2 0V7H4a1 1 0 0 1 0-2h10ZM17 9a1 1 0 0 0-1 1v2h-2a1 1 0 1 0 0 2h2v2a1 1 0 1 0 2 0v-2h2a1 1 0 1 0 0-2h-2v-2c0-.6-.4-1-1-1Z\"/></svg>',\n    'toc': '<svg width=\"24\" height=\"24\"><path d=\"M5 5c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 1 1 0-2Zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 1 1 0-2Zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2Zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2Zm0-4c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 1 1 0-2Zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2Zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'translate': '<svg width=\"24\" height=\"24\"><path d=\"m12.7 14.3-.3.7-.4.7-2.2-2.2-3.1 3c-.3.4-.8.4-1 0a.7.7 0 0 1 0-1l3.1-3A12.4 12.4 0 0 1 6.7 9H8a10.1 10.1 0 0 0 1.7 2.4c.5-.5 1-1.1 1.4-1.8l.9-2H4.7a.7.7 0 1 1 0-1.5h4.4v-.7c0-.4.3-.8.7-.8.4 0 .7.4.7.8v.7H15c.4 0 .8.3.8.7 0 .4-.4.8-.8.8h-1.4a12.3 12.3 0 0 1-1 2.4 13.5 13.5 0 0 1-1.7 2.3l1.9 1.8Zm4.3-3 2.7 7.3a.5.5 0 0 1-.4.7 1 1 0 0 1-1-.7l-.6-1.5h-3.4l-.6 1.5a1 1 0 0 1-1 .7.5.5 0 0 1-.4-.7l2.7-7.4a1 1 0 0 1 2 0Zm-2.2 4.4h2.4L16 12.5l-1.2 3.2Z\" fill-rule=\"evenodd\"/></svg>',\n    'typography': '<svg width=\"24\" height=\"24\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M17 5a1 1 0 1 1 0 2h-4v11a1 1 0 1 1-2 0V7H7a1 1 0 0 1 0-2h10Z\"/><path d=\"m17.5 14 .8-1.7 1.7-.8-1.7-.8-.8-1.7-.8 1.7-1.7.8 1.7.8.8 1.7ZM7 14l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2Z\"/></svg>',\n    'underline': '<svg width=\"24\" height=\"24\"><path d=\"M16 5c.6 0 1 .4 1 1v5.5a4 4 0 0 1-.4 1.8l-1 1.4a5.3 5.3 0 0 1-5.5 1 5 5 0 0 1-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 0 1-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 0 0 2.2.8 3.4 3.4 0 0 0 2.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1ZM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2Z\" fill-rule=\"evenodd\"/></svg>',\n    'undo': '<svg width=\"24\" height=\"24\"><path d=\"M6.4 8H12c3.7 0 6.2 2 6.8 5.1.6 2.7-.4 5.6-2.3 6.8a1 1 0 0 1-1-1.8c1.1-.6 1.8-2.7 1.4-4.6-.5-2.1-2.1-3.5-4.9-3.5H6.4l3.3 3.3a1 1 0 1 1-1.4 1.4l-5-5a1 1 0 0 1 0-1.4l5-5a1 1 0 0 1 1.4 1.4L6.4 8Z\" fill-rule=\"nonzero\"/></svg>',\n    'unlink': '<svg width=\"24\" height=\"24\"><path d=\"M6.2 12.3a1 1 0 0 1 1.4 1.4l-2 2a2 2 0 1 0 2.6 2.8l4.8-4.8a1 1 0 0 0 0-1.4 1 1 0 1 1 1.4-1.3 2.9 2.9 0 0 1 0 4L9.6 20a3.9 3.9 0 0 1-5.5-5.5l2-2Zm11.6-.6a1 1 0 0 1-1.4-1.4l2.1-2a2 2 0 1 0-2.7-2.8L11 10.3a1 1 0 0 0 0 1.4A1 1 0 1 1 9.6 13a2.9 2.9 0 0 1 0-4L14.4 4a3.9 3.9 0 0 1 5.5 5.5l-2 2ZM7.6 6.3a.8.8 0 0 1-1 1.1L3.3 4.2a.7.7 0 1 1 1-1l3.2 3.1ZM5.1 8.6a.8.8 0 0 1 0 1.5H3a.8.8 0 0 1 0-1.5H5Zm5-3.5a.8.8 0 0 1-1.5 0V3a.8.8 0 0 1 1.5 0V5Zm6 11.8a.8.8 0 0 1 1-1l3.2 3.2a.8.8 0 0 1-1 1L16 17Zm-2.2 2a.8.8 0 0 1 1.5 0V21a.8.8 0 0 1-1.5 0V19Zm5-3.5a.7.7 0 1 1 0-1.5H21a.8.8 0 0 1 0 1.5H19Z\" fill-rule=\"nonzero\"/></svg>',\n    'unlock': '<svg width=\"24\" height=\"24\"><path d=\"M16 5c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h-2V8a1 1 0 0 0-.3-.7A1 1 0 0 0 16 7h-2a1 1 0 0 0-.7.3 1 1 0 0 0-.3.7v3h.3c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H4.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H11V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2Z\" fill-rule=\"evenodd\"/></svg>',\n    'unordered-list': '<svg width=\"24\" height=\"24\"><path d=\"M11 5h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2Zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2ZM4.5 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1Zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1Zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1Z\" fill-rule=\"evenodd\"/></svg>',\n    'unselected': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2Zm0 1a1 1 0 0 0-1 1v12c0 .6.4 1 1 1h12c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H6Z\"/></svg>',\n    'upload': '<svg width=\"24\" height=\"24\"><path d=\"M18 19v-2a1 1 0 0 1 2 0v3c0 .6-.4 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 2 0v2h12ZM11 6.4 8.7 8.7a1 1 0 0 1-1.4-1.4l4-4a1 1 0 0 1 1.4 0l4 4a1 1 0 1 1-1.4 1.4L13 6.4V16a1 1 0 0 1-2 0V6.4Z\" fill-rule=\"nonzero\"/></svg>',\n    'user': '<svg width=\"24\" height=\"24\"><path d=\"M12 24a12 12 0 1 1 0-24 12 12 0 0 1 0 24Zm-8.7-5.3a11 11 0 0 0 17.4 0C19.4 16.3 14.6 15 12 15c-2.6 0-7.4 1.3-8.7 3.7ZM12 13c2.2 0 4-2 4-4.5S14.2 4 12 4 8 6 8 8.5 9.8 13 12 13Z\" fill-rule=\"nonzero\"/></svg>',\n    'vertical-align': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><rect width=\"18\" height=\"2\" x=\"3\" y=\"11\" rx=\"1\"/><path d=\"M12 2c.6 0 1 .4 1 1v4l2-1.3a1 1 0 0 1 1.2 1.5l-.1.1-4.1 3-4-3a1 1 0 0 1 1-1.7l2 1.5V3c0-.6.4-1 1-1zm0 11.8 4 2.9a1 1 0 0 1-1 1.7l-2-1.5V21c0 .5-.4 1-.9 1H12a1 1 0 0 1-1-1v-4l-2 1.3a1 1 0 0 1-1.2-.1l-.1-.1a1 1 0 0 1 .1-1.3l.1-.1 4.1-3z\"/></g></svg>',\n    'visualblocks': '<svg width=\"24\" height=\"24\"><path d=\"M9 19v2H7v-2h2Zm-4 0v2a2 2 0 0 1-2-2h2Zm8 0v2h-2v-2h2Zm8 0a2 2 0 0 1-2 2v-2h2Zm-4 0v2h-2v-2h2ZM15 7a1 1 0 0 1 0 2v7a1 1 0 0 1-2 0V9h-1v7a1 1 0 0 1-2 0v-4a2.5 2.5 0 0 1-.2-5H15ZM5 15v2H3v-2h2Zm16 0v2h-2v-2h2ZM5 11v2H3v-2h2Zm16 0v2h-2v-2h2ZM5 7v2H3V7h2Zm16 0v2h-2V7h2ZM5 3v2H3c0-1.1.9-2 2-2Zm8 0v2h-2V3h2Zm6 0a2 2 0 0 1 2 2h-2V3ZM9 3v2H7V3h2Zm8 0v2h-2V3h2Z\" fill-rule=\"evenodd\"/></svg>',\n    'visualchars': '<svg width=\"24\" height=\"24\"><path d=\"M10 5h7a1 1 0 0 1 0 2h-1v11a1 1 0 0 1-2 0V7h-2v11a1 1 0 0 1-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 6.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L10 5Z\" fill-rule=\"evenodd\"/></svg>',\n    'warning': '<svg width=\"24\" height=\"24\"><path d=\"M19.8 18.3c.2.5.3.9 0 1.2-.1.3-.5.5-1 .5H5.2c-.5 0-.9-.2-1-.5-.3-.3-.2-.7 0-1.2L11 4.7l.5-.5.5-.2c.2 0 .3 0 .5.2.2 0 .3.3.5.5l6.8 13.6ZM12 18c.3 0 .5-.1.7-.3.2-.2.3-.4.3-.7a1 1 0 0 0-.3-.7 1 1 0 0 0-.7-.3 1 1 0 0 0-.7.3 1 1 0 0 0-.3.7c0 .3.1.5.3.7.2.2.4.3.7.3Zm.7-3 .3-4a1 1 0 0 0-.3-.7 1 1 0 0 0-.7-.3 1 1 0 0 0-.7.3 1 1 0 0 0-.3.7l.3 4h1.4Z\" fill-rule=\"evenodd\"/></svg>',\n    'zoom-in': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 1 1 1.4-1.4l4.3 4.4a1 1 0 0 1-1.4 1.4l-4.4-4.3Zm-5-.3a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm-1-9a1 1 0 0 1 2 0v6a1 1 0 0 1-2 0V8Zm-2 4a1 1 0 0 1 0-2h6a1 1 0 0 1 0 2H8Z\" fill-rule=\"nonzero\"/></svg>',\n    'zoom-out': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 1 1 1.4-1.4l4.3 4.4a1 1 0 0 1-1.4 1.4l-4.4-4.3Zm-5-.3a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm-3-5a1 1 0 0 1 0-2h6a1 1 0 0 1 0 2H8Z\" fill-rule=\"nonzero\"/></svg>'\n  }\n});\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/icons/default/icons.js?");

/***/ }),

/***/ "./node_modules/tinymce/icons/default/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/icons/default/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"default\" icons for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/icons/default')\n//   ES2015:\n//     import 'tinymce/icons/default'\n__webpack_require__(/*! ./icons.js */ \"./node_modules/tinymce/icons/default/icons.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/icons/default/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/models/dom/index.js":
/*!**************************************************!*\
  !*** ./node_modules/tinymce/models/dom/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"dom\" model for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/models/dom')\n//   ES2015:\n//     import 'tinymce/models/dom'\n__webpack_require__(/*! ./model.js */ \"./node_modules/tinymce/models/dom/model.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/models/dom/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/models/dom/model.js":
/*!**************************************************!*\
  !*** ./node_modules/tinymce/models/dom/model.js ***!
  \**************************************************/
/***/ (() => {

eval("function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global$1 = tinymce.util.Tools.resolve('tinymce.ModelManager');\n  var hasProto = (v, constructor, predicate) => {\n    var _a;\n    if (predicate(v, constructor.prototype)) {\n      return true;\n    } else {\n      return ((_a = v.constructor) === null || _a === void 0 ? void 0 : _a.name) === constructor.name;\n    }\n  };\n  var typeOf = x => {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && Array.isArray(x)) {\n      return 'array';\n    } else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType$1 = type => value => typeOf(value) === type;\n  var isSimpleType = type => value => typeof value === type;\n  var eq$2 = t => a => t === a;\n  var isString = isType$1('string');\n  var isObject = isType$1('object');\n  var isArray = isType$1('array');\n  var isNull = eq$2(null);\n  var isBoolean = isSimpleType('boolean');\n  var isUndefined = eq$2(undefined);\n  var isNullable = a => a === null || a === undefined;\n  var isNonNullable = a => !isNullable(a);\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var noop = () => {};\n  var compose = (fa, fb) => {\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      return fa(fb.apply(null, args));\n    };\n  };\n  var compose1 = (fbc, fab) => a => fbc(fab(a));\n  var constant = value => {\n    return () => {\n      return value;\n    };\n  };\n  var identity = x => {\n    return x;\n  };\n  var tripleEquals = (a, b) => {\n    return a === b;\n  };\n  function curry(fn) {\n    for (var _len2 = arguments.length, initialArgs = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      initialArgs[_key2 - 1] = arguments[_key2];\n    }\n    return function () {\n      for (var _len3 = arguments.length, restArgs = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        restArgs[_key3] = arguments[_key3];\n      }\n      var all = initialArgs.concat(restArgs);\n      return fn.apply(null, all);\n    };\n  }\n  var not = f => t => !f(t);\n  var die = msg => {\n    return () => {\n      throw new Error(msg);\n    };\n  };\n  var apply = f => {\n    return f();\n  };\n  var never = constant(false);\n  var always = constant(true);\n  class Optional {\n    constructor(tag, value) {\n      this.tag = tag;\n      this.value = value;\n    }\n    static some(value) {\n      return new Optional(true, value);\n    }\n    static none() {\n      return Optional.singletonNone;\n    }\n    fold(onNone, onSome) {\n      if (this.tag) {\n        return onSome(this.value);\n      } else {\n        return onNone();\n      }\n    }\n    isSome() {\n      return this.tag;\n    }\n    isNone() {\n      return !this.tag;\n    }\n    map(mapper) {\n      if (this.tag) {\n        return Optional.some(mapper(this.value));\n      } else {\n        return Optional.none();\n      }\n    }\n    bind(binder) {\n      if (this.tag) {\n        return binder(this.value);\n      } else {\n        return Optional.none();\n      }\n    }\n    exists(predicate) {\n      return this.tag && predicate(this.value);\n    }\n    forall(predicate) {\n      return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n      if (!this.tag || predicate(this.value)) {\n        return this;\n      } else {\n        return Optional.none();\n      }\n    }\n    getOr(replacement) {\n      return this.tag ? this.value : replacement;\n    }\n    or(replacement) {\n      return this.tag ? this : replacement;\n    }\n    getOrThunk(thunk) {\n      return this.tag ? this.value : thunk();\n    }\n    orThunk(thunk) {\n      return this.tag ? this : thunk();\n    }\n    getOrDie(message) {\n      if (!this.tag) {\n        throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n      } else {\n        return this.value;\n      }\n    }\n    static from(value) {\n      return isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    getOrNull() {\n      return this.tag ? this.value : null;\n    }\n    getOrUndefined() {\n      return this.value;\n    }\n    each(worker) {\n      if (this.tag) {\n        worker(this.value);\n      }\n    }\n    toArray() {\n      return this.tag ? [this.value] : [];\n    }\n    toString() {\n      return this.tag ? \"some(\".concat(this.value, \")\") : 'none()';\n    }\n  }\n  Optional.singletonNone = new Optional(false);\n  var nativeSlice = Array.prototype.slice;\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n  var rawIndexOf = (ts, t) => nativeIndexOf.call(ts, t);\n  var contains$2 = (xs, x) => rawIndexOf(xs, x) > -1;\n  var exists = (xs, pred) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n    return false;\n  };\n  var range$1 = (num, f) => {\n    var r = [];\n    for (var i = 0; i < num; i++) {\n      r.push(f(i));\n    }\n    return r;\n  };\n  var map$1 = (xs, f) => {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each$2 = (xs, f) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var eachr = (xs, f) => {\n    for (var i = xs.length - 1; i >= 0; i--) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var partition = (xs, pred) => {\n    var pass = [];\n    var fail = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      var arr = pred(x, i) ? pass : fail;\n      arr.push(x);\n    }\n    return {\n      pass,\n      fail\n    };\n  };\n  var filter$2 = (xs, pred) => {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n    return r;\n  };\n  var foldr = (xs, f, acc) => {\n    eachr(xs, (x, i) => {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var foldl = (xs, f, acc) => {\n    each$2(xs, (x, i) => {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var findUntil = (xs, pred, until) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var find$1 = (xs, pred) => {\n    return findUntil(xs, pred, never);\n  };\n  var findIndex = (xs, pred) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return Optional.some(i);\n      }\n    }\n    return Optional.none();\n  };\n  var flatten = xs => {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind$2 = (xs, f) => flatten(map$1(xs, f));\n  var forall = (xs, pred) => {\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      var x = xs[i];\n      if (pred(x, i) !== true) {\n        return false;\n      }\n    }\n    return true;\n  };\n  var reverse = xs => {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n  var mapToObject = (xs, f) => {\n    var r = {};\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      r[String(x)] = f(x, i);\n    }\n    return r;\n  };\n  var sort$1 = (xs, comparator) => {\n    var copy = nativeSlice.call(xs, 0);\n    copy.sort(comparator);\n    return copy;\n  };\n  var get$d = (xs, i) => i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  var head = xs => get$d(xs, 0);\n  var last$2 = xs => get$d(xs, xs.length - 1);\n  var findMap = (arr, f) => {\n    for (var i = 0; i < arr.length; i++) {\n      var _r = f(arr[i], i);\n      if (_r.isSome()) {\n        return _r;\n      }\n    }\n    return Optional.none();\n  };\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n  var each$1 = (obj, f) => {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var map = (obj, f) => {\n    return tupleMap(obj, (x, i) => ({\n      k: i,\n      v: f(x, i)\n    }));\n  };\n  var tupleMap = (obj, f) => {\n    var r = {};\n    each$1(obj, (x, i) => {\n      var tuple = f(x, i);\n      r[tuple.k] = tuple.v;\n    });\n    return r;\n  };\n  var objAcc = r => (x, i) => {\n    r[i] = x;\n  };\n  var internalFilter = (obj, pred, onTrue, onFalse) => {\n    each$1(obj, (x, i) => {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n  };\n  var filter$1 = (obj, pred) => {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  var mapToArray = (obj, f) => {\n    var r = [];\n    each$1(obj, (value, name) => {\n      r.push(f(value, name));\n    });\n    return r;\n  };\n  var values = obj => {\n    return mapToArray(obj, identity);\n  };\n  var get$c = (obj, key) => {\n    return has$1(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n  var has$1 = (obj, key) => hasOwnProperty.call(obj, key);\n  var hasNonNullableKey = (obj, key) => has$1(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  var isEmpty = r => {\n    for (var x in r) {\n      if (hasOwnProperty.call(r, x)) {\n        return false;\n      }\n    }\n    return true;\n  };\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n  var path = (parts, scope) => {\n    var o = scope !== undefined && scope !== null ? scope : Global;\n    for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i) {\n      o = o[parts[i]];\n    }\n    return o;\n  };\n  var resolve$2 = (p, scope) => {\n    var parts = p.split('.');\n    return path(parts, scope);\n  };\n  var unsafe = (name, scope) => {\n    return resolve$2(name, scope);\n  };\n  var getOrDie = (name, scope) => {\n    var actual = unsafe(name, scope);\n    if (actual === undefined || actual === null) {\n      throw new Error(name + ' not available on this browser');\n    }\n    return actual;\n  };\n  var getPrototypeOf = Object.getPrototypeOf;\n  var sandHTMLElement = scope => {\n    return getOrDie('HTMLElement', scope);\n  };\n  var isPrototypeOf = x => {\n    var scope = resolve$2('ownerDocument.defaultView', x);\n    return isObject(x) && (sandHTMLElement(scope).prototype.isPrototypeOf(x) || /^HTML\\w*Element$/.test(getPrototypeOf(x).constructor.name));\n  };\n  var COMMENT = 8;\n  var DOCUMENT = 9;\n  var DOCUMENT_FRAGMENT = 11;\n  var ELEMENT = 1;\n  var TEXT = 3;\n  var name = element => {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n  var type = element => element.dom.nodeType;\n  var isType = t => element => type(element) === t;\n  var isComment = element => type(element) === COMMENT || name(element) === '#comment';\n  var isHTMLElement = element => isElement(element) && isPrototypeOf(element.dom);\n  var isElement = isType(ELEMENT);\n  var isText = isType(TEXT);\n  var isDocument = isType(DOCUMENT);\n  var isDocumentFragment = isType(DOCUMENT_FRAGMENT);\n  var isTag = tag => e => isElement(e) && name(e) === tag;\n  var rawSet = (dom, key, value) => {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n  var set$2 = (element, key, value) => {\n    rawSet(element.dom, key, value);\n  };\n  var setAll$1 = (element, attrs) => {\n    var dom = element.dom;\n    each$1(attrs, (v, k) => {\n      rawSet(dom, k, v);\n    });\n  };\n  var setOptions = (element, attrs) => {\n    each$1(attrs, (v, k) => {\n      v.fold(() => {\n        remove$7(element, k);\n      }, value => {\n        rawSet(element.dom, k, value);\n      });\n    });\n  };\n  var get$b = (element, key) => {\n    var v = element.dom.getAttribute(key);\n    return v === null ? undefined : v;\n  };\n  var getOpt = (element, key) => Optional.from(get$b(element, key));\n  var remove$7 = (element, key) => {\n    element.dom.removeAttribute(key);\n  };\n  var clone$2 = element => foldl(element.dom.attributes, (acc, attr) => {\n    acc[attr.name] = attr.value;\n    return acc;\n  }, {});\n  var fromHtml$1 = (html, scope) => {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      var message = 'HTML does not have a single root node';\n      console.error(message, html);\n      throw new Error(message);\n    }\n    return fromDom$1(div.childNodes[0]);\n  };\n  var fromTag = (tag, scope) => {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom$1(node);\n  };\n  var fromText = (text, scope) => {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom$1(node);\n  };\n  var fromDom$1 = node => {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n    return {\n      dom: node\n    };\n  };\n  var fromPoint$1 = (docElm, x, y) => Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom$1);\n  var SugarElement = {\n    fromHtml: fromHtml$1,\n    fromTag,\n    fromText,\n    fromDom: fromDom$1,\n    fromPoint: fromPoint$1\n  };\n  var is$2 = (element, selector) => {\n    var dom = element.dom;\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n  var bypassSelector = dom => dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n  var all$1 = (selector, scope) => {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? [] : map$1(base.querySelectorAll(selector), SugarElement.fromDom);\n  };\n  var one = (selector, scope) => {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n  };\n  var eq$1 = (e1, e2) => e1.dom === e2.dom;\n  var contains$1 = (e1, e2) => {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n  var is$1 = is$2;\n  var owner = element => SugarElement.fromDom(element.dom.ownerDocument);\n  var documentOrOwner = dos => isDocument(dos) ? dos : owner(dos);\n  var documentElement = element => SugarElement.fromDom(documentOrOwner(element).dom.documentElement);\n  var defaultView = element => SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n  var parent = element => Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  var parentElement = element => Optional.from(element.dom.parentElement).map(SugarElement.fromDom);\n  var parents = (element, isRoot) => {\n    var stop = isFunction(isRoot) ? isRoot : never;\n    var dom = element.dom;\n    var ret = [];\n    while (dom.parentNode !== null && dom.parentNode !== undefined) {\n      var rawParent = dom.parentNode;\n      var p = SugarElement.fromDom(rawParent);\n      ret.push(p);\n      if (stop(p) === true) {\n        break;\n      } else {\n        dom = rawParent;\n      }\n    }\n    return ret;\n  };\n  var prevSibling = element => Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n  var nextSibling = element => Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n  var children$2 = element => map$1(element.dom.childNodes, SugarElement.fromDom);\n  var child$2 = (element, index) => {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n  var firstChild = element => child$2(element, 0);\n  var before$3 = (marker, element) => {\n    var parent$1 = parent(marker);\n    parent$1.each(v => {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n  var after$5 = (marker, element) => {\n    var sibling = nextSibling(marker);\n    sibling.fold(() => {\n      var parent$1 = parent(marker);\n      parent$1.each(v => {\n        append$1(v, element);\n      });\n    }, v => {\n      before$3(v, element);\n    });\n  };\n  var prepend = (parent, element) => {\n    var firstChild$1 = firstChild(parent);\n    firstChild$1.fold(() => {\n      append$1(parent, element);\n    }, v => {\n      parent.dom.insertBefore(element.dom, v.dom);\n    });\n  };\n  var append$1 = (parent, element) => {\n    parent.dom.appendChild(element.dom);\n  };\n  var appendAt = (parent, element, index) => {\n    child$2(parent, index).fold(() => {\n      append$1(parent, element);\n    }, v => {\n      before$3(v, element);\n    });\n  };\n  var wrap = (element, wrapper) => {\n    before$3(element, wrapper);\n    append$1(wrapper, element);\n  };\n  var after$4 = (marker, elements) => {\n    each$2(elements, (x, i) => {\n      var e = i === 0 ? marker : elements[i - 1];\n      after$5(e, x);\n    });\n  };\n  var append = (parent, elements) => {\n    each$2(elements, x => {\n      append$1(parent, x);\n    });\n  };\n  var empty = element => {\n    element.dom.textContent = '';\n    each$2(children$2(element), rogue => {\n      remove$6(rogue);\n    });\n  };\n  var remove$6 = element => {\n    var dom = element.dom;\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n  var unwrap = wrapper => {\n    var children = children$2(wrapper);\n    if (children.length > 0) {\n      after$4(wrapper, children);\n    }\n    remove$6(wrapper);\n  };\n  var clone$1 = (original, isDeep) => SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  var shallow = original => clone$1(original, false);\n  var deep = original => clone$1(original, true);\n  var shallowAs = (original, tag) => {\n    var nu = SugarElement.fromTag(tag);\n    var attributes = clone$2(original);\n    setAll$1(nu, attributes);\n    return nu;\n  };\n  var copy$2 = (original, tag) => {\n    var nu = shallowAs(original, tag);\n    var cloneChildren = children$2(deep(original));\n    append(nu, cloneChildren);\n    return nu;\n  };\n  var mutate$1 = (original, tag) => {\n    var nu = shallowAs(original, tag);\n    after$5(original, nu);\n    var children = children$2(original);\n    append(nu, children);\n    remove$6(original);\n    return nu;\n  };\n  var validSectionList = ['tfoot', 'thead', 'tbody', 'colgroup'];\n  var isValidSection = parentName => contains$2(validSectionList, parentName);\n  var grid = (rows, columns) => ({\n    rows,\n    columns\n  });\n  var address = (row, column) => ({\n    row,\n    column\n  });\n  var detail = (element, rowspan, colspan) => ({\n    element,\n    rowspan,\n    colspan\n  });\n  var detailnew = (element, rowspan, colspan, isNew) => ({\n    element,\n    rowspan,\n    colspan,\n    isNew\n  });\n  var extended = (element, rowspan, colspan, row, column, isLocked) => ({\n    element,\n    rowspan,\n    colspan,\n    row,\n    column,\n    isLocked\n  });\n  var rowdetail = (element, cells, section) => ({\n    element,\n    cells,\n    section\n  });\n  var rowdetailnew = (element, cells, section, isNew) => ({\n    element,\n    cells,\n    section,\n    isNew\n  });\n  var elementnew = (element, isNew, isLocked) => ({\n    element,\n    isNew,\n    isLocked\n  });\n  var rowcells = (element, cells, section, isNew) => ({\n    element,\n    cells,\n    section,\n    isNew\n  });\n  var bounds = (startRow, startCol, finishRow, finishCol) => ({\n    startRow,\n    startCol,\n    finishRow,\n    finishCol\n  });\n  var columnext = (element, colspan, column) => ({\n    element,\n    colspan,\n    column\n  });\n  var colgroup = (element, columns) => ({\n    element,\n    columns\n  });\n  var isShadowRoot = dos => isDocumentFragment(dos) && isNonNullable(dos.dom.host);\n  var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n  var isSupported$1 = constant(supported);\n  var getRootNode = supported ? e => SugarElement.fromDom(e.dom.getRootNode()) : documentOrOwner;\n  var getShadowRoot = e => {\n    var r = getRootNode(e);\n    return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n  };\n  var getShadowHost = e => SugarElement.fromDom(e.dom.host);\n  var getOriginalEventTarget = event => {\n    if (isSupported$1() && isNonNullable(event.target)) {\n      var el = SugarElement.fromDom(event.target);\n      if (isElement(el) && isOpenShadowHost(el)) {\n        if (event.composed && event.composedPath) {\n          var composedPath = event.composedPath();\n          if (composedPath) {\n            return head(composedPath);\n          }\n        }\n      }\n    }\n    return Optional.from(event.target);\n  };\n  var isOpenShadowHost = element => isNonNullable(element.dom.shadowRoot);\n  var inBody = element => {\n    var dom = isText(element) ? element.dom.parentNode : element.dom;\n    if (dom === undefined || dom === null || dom.ownerDocument === null) {\n      return false;\n    }\n    var doc = dom.ownerDocument;\n    return getShadowRoot(SugarElement.fromDom(dom)).fold(() => doc.body.contains(dom), compose1(inBody, getShadowHost));\n  };\n  var body$1 = () => getBody$1(SugarElement.fromDom(document));\n  var getBody$1 = doc => {\n    var b = doc.dom.body;\n    if (b === null || b === undefined) {\n      throw new Error('Body is not available yet');\n    }\n    return SugarElement.fromDom(b);\n  };\n  var ancestors$4 = (scope, predicate, isRoot) => filter$2(parents(scope, isRoot), predicate);\n  var children$1 = (scope, predicate) => filter$2(children$2(scope), predicate);\n  var descendants$1 = (scope, predicate) => {\n    var result = [];\n    each$2(children$2(scope), x => {\n      if (predicate(x)) {\n        result = result.concat([x]);\n      }\n      result = result.concat(descendants$1(x, predicate));\n    });\n    return result;\n  };\n  var ancestors$3 = (scope, selector, isRoot) => ancestors$4(scope, e => is$2(e, selector), isRoot);\n  var children = (scope, selector) => children$1(scope, e => is$2(e, selector));\n  var descendants = (scope, selector) => all$1(selector, scope);\n  var ClosestOrAncestor = (is, ancestor, scope, a, isRoot) => {\n    if (is(scope, a)) {\n      return Optional.some(scope);\n    } else if (isFunction(isRoot) && isRoot(scope)) {\n      return Optional.none();\n    } else {\n      return ancestor(scope, a, isRoot);\n    }\n  };\n  var ancestor$2 = (scope, predicate, isRoot) => {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var closest$2 = (scope, predicate, isRoot) => {\n    var is = (s, test) => test(s);\n    return ClosestOrAncestor(is, ancestor$2, scope, predicate, isRoot);\n  };\n  var child$1 = (scope, predicate) => {\n    var pred = node => predicate(SugarElement.fromDom(node));\n    var result = find$1(scope.dom.childNodes, pred);\n    return result.map(SugarElement.fromDom);\n  };\n  var descendant$1 = (scope, predicate) => {\n    var descend = node => {\n      for (var i = 0; i < node.childNodes.length; i++) {\n        var _child = SugarElement.fromDom(node.childNodes[i]);\n        if (predicate(_child)) {\n          return Optional.some(_child);\n        }\n        var res = descend(node.childNodes[i]);\n        if (res.isSome()) {\n          return res;\n        }\n      }\n      return Optional.none();\n    };\n    return descend(scope.dom);\n  };\n  var ancestor$1 = (scope, selector, isRoot) => ancestor$2(scope, e => is$2(e, selector), isRoot);\n  var child = (scope, selector) => child$1(scope, e => is$2(e, selector));\n  var descendant = (scope, selector) => one(selector, scope);\n  var closest$1 = (scope, selector, isRoot) => {\n    var is = (element, selector) => is$2(element, selector);\n    return ClosestOrAncestor(is, ancestor$1, scope, selector, isRoot);\n  };\n  var is = function is(lhs, rhs) {\n    var comparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : tripleEquals;\n    return lhs.exists(left => comparator(left, rhs));\n  };\n  var cat = arr => {\n    var r = [];\n    var push = x => {\n      r.push(x);\n    };\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n    return r;\n  };\n  var bindFrom = (a, f) => a !== undefined && a !== null ? f(a) : Optional.none();\n  var someIf = (b, a) => b ? Optional.some(a) : Optional.none();\n  var checkRange = (str, substr, start) => substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n  var contains = function contains(str, substr) {\n    var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var end = arguments.length > 3 ? arguments[3] : undefined;\n    var idx = str.indexOf(substr, start);\n    if (idx !== -1) {\n      return isUndefined(end) ? true : idx + substr.length <= end;\n    } else {\n      return false;\n    }\n  };\n  var startsWith = (str, prefix) => {\n    return checkRange(str, prefix, 0);\n  };\n  var endsWith = (str, suffix) => {\n    return checkRange(str, suffix, str.length - suffix.length);\n  };\n  var blank = r => s => s.replace(r, '');\n  var trim = blank(/^\\s+|\\s+$/g);\n  var isNotEmpty = s => s.length > 0;\n  var toFloat = value => {\n    var num = parseFloat(value);\n    return isNaN(num) ? Optional.none() : Optional.some(num);\n  };\n  var isSupported = dom => dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  var internalSet = (dom, property, value) => {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n    if (isSupported(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n  var internalRemove = (dom, property) => {\n    if (isSupported(dom)) {\n      dom.style.removeProperty(property);\n    }\n  };\n  var set$1 = (element, property, value) => {\n    var dom = element.dom;\n    internalSet(dom, property, value);\n  };\n  var setAll = (element, css) => {\n    var dom = element.dom;\n    each$1(css, (v, k) => {\n      internalSet(dom, k, v);\n    });\n  };\n  var get$a = (element, property) => {\n    var dom = element.dom;\n    var styles = window.getComputedStyle(dom);\n    var r = styles.getPropertyValue(property);\n    return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n  };\n  var getUnsafeProperty = (dom, property) => isSupported(dom) ? dom.style.getPropertyValue(property) : '';\n  var getRaw$2 = (element, property) => {\n    var dom = element.dom;\n    var raw = getUnsafeProperty(dom, property);\n    return Optional.from(raw).filter(r => r.length > 0);\n  };\n  var remove$5 = (element, property) => {\n    var dom = element.dom;\n    internalRemove(dom, property);\n    if (is(getOpt(element, 'style').map(trim), '')) {\n      remove$7(element, 'style');\n    }\n  };\n  var copy$1 = (source, target) => {\n    var sourceDom = source.dom;\n    var targetDom = target.dom;\n    if (isSupported(sourceDom) && isSupported(targetDom)) {\n      targetDom.style.cssText = sourceDom.style.cssText;\n    }\n  };\n  var getAttrValue = function getAttrValue(cell, name) {\n    var fallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    return getOpt(cell, name).map(value => parseInt(value, 10)).getOr(fallback);\n  };\n  var getSpan = (cell, type) => getAttrValue(cell, type, 1);\n  var hasColspan = cellOrCol => {\n    if (isTag('col')(cellOrCol)) {\n      return getAttrValue(cellOrCol, 'span', 1) > 1;\n    } else {\n      return getSpan(cellOrCol, 'colspan') > 1;\n    }\n  };\n  var hasRowspan = cell => getSpan(cell, 'rowspan') > 1;\n  var getCssValue = (element, property) => parseInt(get$a(element, property), 10);\n  var minWidth = constant(10);\n  var minHeight = constant(10);\n  var firstLayer = (scope, selector) => {\n    return filterFirstLayer(scope, selector, always);\n  };\n  var filterFirstLayer = (scope, selector, predicate) => {\n    return bind$2(children$2(scope), x => {\n      if (is$2(x, selector)) {\n        return predicate(x) ? [x] : [];\n      } else {\n        return filterFirstLayer(x, selector, predicate);\n      }\n    });\n  };\n  var lookup = function lookup(tags, element) {\n    var isRoot = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : never;\n    if (isRoot(element)) {\n      return Optional.none();\n    }\n    if (contains$2(tags, name(element))) {\n      return Optional.some(element);\n    }\n    var isRootOrUpperTable = elm => is$2(elm, 'table') || isRoot(elm);\n    return ancestor$1(element, tags.join(','), isRootOrUpperTable);\n  };\n  var cell = (element, isRoot) => lookup(['td', 'th'], element, isRoot);\n  var cells$1 = ancestor => firstLayer(ancestor, 'th,td');\n  var columns$1 = ancestor => {\n    if (is$2(ancestor, 'colgroup')) {\n      return children(ancestor, 'col');\n    } else {\n      return bind$2(columnGroups(ancestor), columnGroup => children(columnGroup, 'col'));\n    }\n  };\n  var table = (element, isRoot) => closest$1(element, 'table', isRoot);\n  var rows$1 = ancestor => firstLayer(ancestor, 'tr');\n  var columnGroups = ancestor => table(ancestor).fold(constant([]), table => children(table, 'colgroup'));\n  var fromRowsOrColGroups = (elems, getSection) => map$1(elems, row => {\n    if (name(row) === 'colgroup') {\n      var _cells = map$1(columns$1(row), column => {\n        var colspan = getAttrValue(column, 'span', 1);\n        return detail(column, 1, colspan);\n      });\n      return rowdetail(row, _cells, 'colgroup');\n    } else {\n      var _cells2 = map$1(cells$1(row), cell => {\n        var rowspan = getAttrValue(cell, 'rowspan', 1);\n        var colspan = getAttrValue(cell, 'colspan', 1);\n        return detail(cell, rowspan, colspan);\n      });\n      return rowdetail(row, _cells2, getSection(row));\n    }\n  });\n  var getParentSection = group => parent(group).map(parent => {\n    var parentName = name(parent);\n    return isValidSection(parentName) ? parentName : 'tbody';\n  }).getOr('tbody');\n  var fromTable$1 = table => {\n    var rows = rows$1(table);\n    var columnGroups$1 = columnGroups(table);\n    var elems = [...columnGroups$1, ...rows];\n    return fromRowsOrColGroups(elems, getParentSection);\n  };\n  var fromPastedRows = (elems, section) => fromRowsOrColGroups(elems, () => section);\n  var cached = f => {\n    var called = false;\n    var r;\n    return function () {\n      if (!called) {\n        called = true;\n        for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n          args[_key4] = arguments[_key4];\n        }\n        r = f.apply(null, args);\n      }\n      return r;\n    };\n  };\n  var DeviceType = (os, browser, userAgent, mediaMatch) => {\n    var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n    var isiPhone = os.isiOS() && !isiPad;\n    var isMobile = os.isiOS() || os.isAndroid();\n    var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n    var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n    var isPhone = isiPhone || isMobile && !isTablet;\n    var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n    var isDesktop = !isPhone && !isTablet && !iOSwebview;\n    return {\n      isiPad: constant(isiPad),\n      isiPhone: constant(isiPhone),\n      isTablet: constant(isTablet),\n      isPhone: constant(isPhone),\n      isTouch: constant(isTouch),\n      isAndroid: os.isAndroid,\n      isiOS: os.isiOS,\n      isWebView: constant(iOSwebview),\n      isDesktop: constant(isDesktop)\n    };\n  };\n  var firstMatch = (regexes, s) => {\n    for (var i = 0; i < regexes.length; i++) {\n      var x = regexes[i];\n      if (x.test(s)) {\n        return x;\n      }\n    }\n    return undefined;\n  };\n  var find = (regexes, agent) => {\n    var r = firstMatch(regexes, agent);\n    if (!r) {\n      return {\n        major: 0,\n        minor: 0\n      };\n    }\n    var group = i => {\n      return Number(agent.replace(r, '$' + i));\n    };\n    return nu$2(group(1), group(2));\n  };\n  var detect$5 = (versionRegexes, agent) => {\n    var cleanedAgent = String(agent).toLowerCase();\n    if (versionRegexes.length === 0) {\n      return unknown$2();\n    }\n    return find(versionRegexes, cleanedAgent);\n  };\n  var unknown$2 = () => {\n    return nu$2(0, 0);\n  };\n  var nu$2 = (major, minor) => {\n    return {\n      major,\n      minor\n    };\n  };\n  var Version = {\n    nu: nu$2,\n    detect: detect$5,\n    unknown: unknown$2\n  };\n  var detectBrowser$1 = (browsers, userAgentData) => {\n    return findMap(userAgentData.brands, uaBrand => {\n      var lcBrand = uaBrand.brand.toLowerCase();\n      return find$1(browsers, browser => {\n        var _a;\n        return lcBrand === ((_a = browser.brand) === null || _a === void 0 ? void 0 : _a.toLowerCase());\n      }).map(info => ({\n        current: info.name,\n        version: Version.nu(parseInt(uaBrand.version, 10), 0)\n      }));\n    });\n  };\n  var detect$4 = (candidates, userAgent) => {\n    var agent = String(userAgent).toLowerCase();\n    return find$1(candidates, candidate => {\n      return candidate.search(agent);\n    });\n  };\n  var detectBrowser = (browsers, userAgent) => {\n    return detect$4(browsers, userAgent).map(browser => {\n      var version = Version.detect(browser.versionRegexes, userAgent);\n      return {\n        current: browser.name,\n        version\n      };\n    });\n  };\n  var detectOs = (oses, userAgent) => {\n    return detect$4(oses, userAgent).map(os => {\n      var version = Version.detect(os.versionRegexes, userAgent);\n      return {\n        current: os.name,\n        version\n      };\n    });\n  };\n  var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n  var checkContains = target => {\n    return uastring => {\n      return contains(uastring, target);\n    };\n  };\n  var browsers = [{\n    name: 'Edge',\n    versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n    search: uastring => {\n      return contains(uastring, 'edge/') && contains(uastring, 'chrome') && contains(uastring, 'safari') && contains(uastring, 'applewebkit');\n    }\n  }, {\n    name: 'Chromium',\n    brand: 'Chromium',\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/, normalVersionRegex],\n    search: uastring => {\n      return contains(uastring, 'chrome') && !contains(uastring, 'chromeframe');\n    }\n  }, {\n    name: 'IE',\n    versionRegexes: [/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/, /.*?rv:([0-9]+)\\.([0-9]+).*/],\n    search: uastring => {\n      return contains(uastring, 'msie') || contains(uastring, 'trident');\n    }\n  }, {\n    name: 'Opera',\n    versionRegexes: [normalVersionRegex, /.*?opera\\/([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('opera')\n  }, {\n    name: 'Firefox',\n    versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('firefox')\n  }, {\n    name: 'Safari',\n    versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],\n    search: uastring => {\n      return (contains(uastring, 'safari') || contains(uastring, 'mobile/')) && contains(uastring, 'applewebkit');\n    }\n  }];\n  var oses = [{\n    name: 'Windows',\n    search: checkContains('win'),\n    versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'iOS',\n    search: uastring => {\n      return contains(uastring, 'iphone') || contains(uastring, 'ipad');\n    },\n    versionRegexes: [/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Android',\n    search: checkContains('android'),\n    versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'macOS',\n    search: checkContains('mac os x'),\n    versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Linux',\n    search: checkContains('linux'),\n    versionRegexes: []\n  }, {\n    name: 'Solaris',\n    search: checkContains('sunos'),\n    versionRegexes: []\n  }, {\n    name: 'FreeBSD',\n    search: checkContains('freebsd'),\n    versionRegexes: []\n  }, {\n    name: 'ChromeOS',\n    search: checkContains('cros'),\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n  }];\n  var PlatformInfo = {\n    browsers: constant(browsers),\n    oses: constant(oses)\n  };\n  var edge = 'Edge';\n  var chromium = 'Chromium';\n  var ie = 'IE';\n  var opera = 'Opera';\n  var firefox = 'Firefox';\n  var safari = 'Safari';\n  var unknown$1 = () => {\n    return nu$1({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n  var nu$1 = info => {\n    var current = info.current;\n    var version = info.version;\n    var isBrowser = name => () => current === name;\n    return {\n      current,\n      version,\n      isEdge: isBrowser(edge),\n      isChromium: isBrowser(chromium),\n      isIE: isBrowser(ie),\n      isOpera: isBrowser(opera),\n      isFirefox: isBrowser(firefox),\n      isSafari: isBrowser(safari)\n    };\n  };\n  var Browser = {\n    unknown: unknown$1,\n    nu: nu$1,\n    edge: constant(edge),\n    chromium: constant(chromium),\n    ie: constant(ie),\n    opera: constant(opera),\n    firefox: constant(firefox),\n    safari: constant(safari)\n  };\n  var windows = 'Windows';\n  var ios = 'iOS';\n  var android = 'Android';\n  var linux = 'Linux';\n  var macos = 'macOS';\n  var solaris = 'Solaris';\n  var freebsd = 'FreeBSD';\n  var chromeos = 'ChromeOS';\n  var unknown = () => {\n    return nu({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n  var nu = info => {\n    var current = info.current;\n    var version = info.version;\n    var isOS = name => () => current === name;\n    return {\n      current,\n      version,\n      isWindows: isOS(windows),\n      isiOS: isOS(ios),\n      isAndroid: isOS(android),\n      isMacOS: isOS(macos),\n      isLinux: isOS(linux),\n      isSolaris: isOS(solaris),\n      isFreeBSD: isOS(freebsd),\n      isChromeOS: isOS(chromeos)\n    };\n  };\n  var OperatingSystem = {\n    unknown,\n    nu,\n    windows: constant(windows),\n    ios: constant(ios),\n    android: constant(android),\n    linux: constant(linux),\n    macos: constant(macos),\n    solaris: constant(solaris),\n    freebsd: constant(freebsd),\n    chromeos: constant(chromeos)\n  };\n  var detect$3 = (userAgent, userAgentDataOpt, mediaMatch) => {\n    var browsers = PlatformInfo.browsers();\n    var oses = PlatformInfo.oses();\n    var browser = userAgentDataOpt.bind(userAgentData => detectBrowser$1(browsers, userAgentData)).orThunk(() => detectBrowser(browsers, userAgent)).fold(Browser.unknown, Browser.nu);\n    var os = detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n    var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n    return {\n      browser,\n      os,\n      deviceType\n    };\n  };\n  var PlatformDetection = {\n    detect: detect$3\n  };\n  var mediaMatch = query => window.matchMedia(query).matches;\n  var platform = cached(() => PlatformDetection.detect(navigator.userAgent, Optional.from(navigator.userAgentData), mediaMatch));\n  var detect$2 = () => platform();\n  var Dimension = (name, getOffset) => {\n    var set = (element, h) => {\n      if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n        throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n      }\n      var dom = element.dom;\n      if (isSupported(dom)) {\n        dom.style[name] = h + 'px';\n      }\n    };\n    var get = element => {\n      var r = getOffset(element);\n      if (r <= 0 || r === null) {\n        var _css = get$a(element, name);\n        return parseFloat(_css) || 0;\n      }\n      return r;\n    };\n    var getOuter = get;\n    var aggregate = (element, properties) => foldl(properties, (acc, property) => {\n      var val = get$a(element, property);\n      var value = val === undefined ? 0 : parseInt(val, 10);\n      return isNaN(value) ? acc : acc + value;\n    }, 0);\n    var max = (element, value, properties) => {\n      var cumulativeInclusions = aggregate(element, properties);\n      var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n      return absoluteMax;\n    };\n    return {\n      set,\n      get,\n      getOuter,\n      aggregate,\n      max\n    };\n  };\n  var toNumber = (px, fallback) => toFloat(px).getOr(fallback);\n  var getProp = (element, name, fallback) => toNumber(get$a(element, name), fallback);\n  var calcContentBoxSize = (element, size, upper, lower) => {\n    var paddingUpper = getProp(element, \"padding-\".concat(upper), 0);\n    var paddingLower = getProp(element, \"padding-\".concat(lower), 0);\n    var borderUpper = getProp(element, \"border-\".concat(upper, \"-width\"), 0);\n    var borderLower = getProp(element, \"border-\".concat(lower, \"-width\"), 0);\n    return size - paddingUpper - paddingLower - borderUpper - borderLower;\n  };\n  var getCalculatedWidth = (element, boxSizing) => {\n    var dom = element.dom;\n    var width = dom.getBoundingClientRect().width || dom.offsetWidth;\n    return boxSizing === 'border-box' ? width : calcContentBoxSize(element, width, 'left', 'right');\n  };\n  var getHeight$1 = element => getProp(element, 'height', element.dom.offsetHeight);\n  var getWidth = element => getProp(element, 'width', element.dom.offsetWidth);\n  var getInnerWidth = element => getCalculatedWidth(element, 'content-box');\n  var api$2 = Dimension('width', element => element.dom.offsetWidth);\n  var get$9 = element => api$2.get(element);\n  var getOuter$2 = element => api$2.getOuter(element);\n  var getInner = getInnerWidth;\n  var getRuntime$1 = getWidth;\n  var addCells = (gridRow, index, cells) => {\n    var existingCells = gridRow.cells;\n    var before = existingCells.slice(0, index);\n    var after = existingCells.slice(index);\n    var newCells = before.concat(cells).concat(after);\n    return setCells(gridRow, newCells);\n  };\n  var addCell = (gridRow, index, cell) => addCells(gridRow, index, [cell]);\n  var mutateCell = (gridRow, index, cell) => {\n    var cells = gridRow.cells;\n    cells[index] = cell;\n  };\n  var setCells = (gridRow, cells) => rowcells(gridRow.element, cells, gridRow.section, gridRow.isNew);\n  var mapCells = (gridRow, f) => {\n    var cells = gridRow.cells;\n    var r = map$1(cells, f);\n    return rowcells(gridRow.element, r, gridRow.section, gridRow.isNew);\n  };\n  var getCell = (gridRow, index) => gridRow.cells[index];\n  var getCellElement = (gridRow, index) => getCell(gridRow, index).element;\n  var cellLength = gridRow => gridRow.cells.length;\n  var extractGridDetails = grid => {\n    var result = partition(grid, row => row.section === 'colgroup');\n    return {\n      rows: result.fail,\n      cols: result.pass\n    };\n  };\n  var clone = (gridRow, cloneRow, cloneCell) => {\n    var newCells = map$1(gridRow.cells, cloneCell);\n    return rowcells(cloneRow(gridRow.element), newCells, gridRow.section, true);\n  };\n  var LOCKED_COL_ATTR = 'data-snooker-locked-cols';\n  var getLockedColumnsFromTable = table => getOpt(table, LOCKED_COL_ATTR).bind(lockedColStr => Optional.from(lockedColStr.match(/\\d+/g))).map(lockedCols => mapToObject(lockedCols, always));\n  var getLockedColumnsFromGrid = grid => {\n    var locked = foldl(extractGridDetails(grid).rows, (acc, row) => {\n      each$2(row.cells, (cell, idx) => {\n        if (cell.isLocked) {\n          acc[idx] = true;\n        }\n      });\n      return acc;\n    }, {});\n    var lockedArr = mapToArray(locked, (_val, key) => parseInt(key, 10));\n    return sort$1(lockedArr);\n  };\n  var key = (row, column) => {\n    return row + ',' + column;\n  };\n  var getAt = (warehouse, row, column) => Optional.from(warehouse.access[key(row, column)]);\n  var findItem = (warehouse, item, comparator) => {\n    var filtered = filterItems(warehouse, detail => {\n      return comparator(item, detail.element);\n    });\n    return filtered.length > 0 ? Optional.some(filtered[0]) : Optional.none();\n  };\n  var filterItems = (warehouse, predicate) => {\n    var all = bind$2(warehouse.all, r => {\n      return r.cells;\n    });\n    return filter$2(all, predicate);\n  };\n  var generateColumns = rowData => {\n    var columnsGroup = {};\n    var index = 0;\n    each$2(rowData.cells, column => {\n      var colspan = column.colspan;\n      range$1(colspan, columnIndex => {\n        var colIndex = index + columnIndex;\n        columnsGroup[colIndex] = columnext(column.element, colspan, colIndex);\n      });\n      index += colspan;\n    });\n    return columnsGroup;\n  };\n  var generate$1 = list => {\n    var access = {};\n    var cells = [];\n    var tableOpt = head(list).map(rowData => rowData.element).bind(table);\n    var lockedColumns = tableOpt.bind(getLockedColumnsFromTable).getOr({});\n    var maxRows = 0;\n    var maxColumns = 0;\n    var rowCount = 0;\n    var {\n      pass: colgroupRows,\n      fail: rows\n    } = partition(list, rowData => rowData.section === 'colgroup');\n    each$2(rows, rowData => {\n      var currentRow = [];\n      each$2(rowData.cells, rowCell => {\n        var start = 0;\n        while (access[key(rowCount, start)] !== undefined) {\n          start++;\n        }\n        var isLocked = hasNonNullableKey(lockedColumns, start.toString());\n        var current = extended(rowCell.element, rowCell.rowspan, rowCell.colspan, rowCount, start, isLocked);\n        for (var occupiedColumnPosition = 0; occupiedColumnPosition < rowCell.colspan; occupiedColumnPosition++) {\n          for (var occupiedRowPosition = 0; occupiedRowPosition < rowCell.rowspan; occupiedRowPosition++) {\n            var rowPosition = rowCount + occupiedRowPosition;\n            var columnPosition = start + occupiedColumnPosition;\n            var newpos = key(rowPosition, columnPosition);\n            access[newpos] = current;\n            maxColumns = Math.max(maxColumns, columnPosition + 1);\n          }\n        }\n        currentRow.push(current);\n      });\n      maxRows++;\n      cells.push(rowdetail(rowData.element, currentRow, rowData.section));\n      rowCount++;\n    });\n    var {\n      columns,\n      colgroups\n    } = last$2(colgroupRows).map(rowData => {\n      var columns = generateColumns(rowData);\n      var colgroup$1 = colgroup(rowData.element, values(columns));\n      return {\n        colgroups: [colgroup$1],\n        columns\n      };\n    }).getOrThunk(() => ({\n      colgroups: [],\n      columns: {}\n    }));\n    var grid$1 = grid(maxRows, maxColumns);\n    return {\n      grid: grid$1,\n      access,\n      all: cells,\n      columns,\n      colgroups\n    };\n  };\n  var fromTable = table => {\n    var list = fromTable$1(table);\n    return generate$1(list);\n  };\n  var justCells = warehouse => bind$2(warehouse.all, w => w.cells);\n  var justColumns = warehouse => values(warehouse.columns);\n  var hasColumns = warehouse => keys(warehouse.columns).length > 0;\n  var getColumnAt = (warehouse, columnIndex) => Optional.from(warehouse.columns[columnIndex]);\n  var Warehouse = {\n    fromTable,\n    generate: generate$1,\n    getAt,\n    findItem,\n    filterItems,\n    justCells,\n    justColumns,\n    hasColumns,\n    getColumnAt\n  };\n  var columns = function columns(warehouse) {\n    var isValidCell = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : always;\n    var grid = warehouse.grid;\n    var cols = range$1(grid.columns, identity);\n    var rowsArr = range$1(grid.rows, identity);\n    return map$1(cols, col => {\n      var getBlock = () => bind$2(rowsArr, r => Warehouse.getAt(warehouse, r, col).filter(detail => detail.column === col).toArray());\n      var isValid = detail => detail.colspan === 1 && isValidCell(detail.element);\n      var getFallback = () => Warehouse.getAt(warehouse, 0, col);\n      return decide(getBlock, isValid, getFallback);\n    });\n  };\n  var decide = (getBlock, isValid, getFallback) => {\n    var inBlock = getBlock();\n    var validInBlock = find$1(inBlock, isValid);\n    var detailOption = validInBlock.orThunk(() => Optional.from(inBlock[0]).orThunk(getFallback));\n    return detailOption.map(detail => detail.element);\n  };\n  var rows = warehouse => {\n    var grid = warehouse.grid;\n    var rowsArr = range$1(grid.rows, identity);\n    var cols = range$1(grid.columns, identity);\n    return map$1(rowsArr, row => {\n      var getBlock = () => bind$2(cols, c => Warehouse.getAt(warehouse, row, c).filter(detail => detail.row === row).fold(constant([]), detail => [detail]));\n      var isSingle = detail => detail.rowspan === 1;\n      var getFallback = () => Warehouse.getAt(warehouse, row, 0);\n      return decide(getBlock, isSingle, getFallback);\n    });\n  };\n  var deduce = (xs, index) => {\n    if (index < 0 || index >= xs.length - 1) {\n      return Optional.none();\n    }\n    var current = xs[index].fold(() => {\n      var rest = reverse(xs.slice(0, index));\n      return findMap(rest, (a, i) => a.map(aa => ({\n        value: aa,\n        delta: i + 1\n      })));\n    }, c => Optional.some({\n      value: c,\n      delta: 0\n    }));\n    var next = xs[index + 1].fold(() => {\n      var rest = xs.slice(index + 1);\n      return findMap(rest, (a, i) => a.map(aa => ({\n        value: aa,\n        delta: i + 1\n      })));\n    }, n => Optional.some({\n      value: n,\n      delta: 1\n    }));\n    return current.bind(c => next.map(n => {\n      var extras = n.delta + c.delta;\n      return Math.abs(n.value - c.value) / extras;\n    }));\n  };\n  var onDirection = (isLtr, isRtl) => element => getDirection(element) === 'rtl' ? isRtl : isLtr;\n  var getDirection = element => get$a(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';\n  var api$1 = Dimension('height', element => {\n    var dom = element.dom;\n    return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n  });\n  var get$8 = element => api$1.get(element);\n  var getOuter$1 = element => api$1.getOuter(element);\n  var getRuntime = getHeight$1;\n  var r = (left, top) => {\n    var translate = (x, y) => r(left + x, top + y);\n    return {\n      left,\n      top,\n      translate\n    };\n  };\n  var SugarPosition = r;\n  var boxPosition = dom => {\n    var box = dom.getBoundingClientRect();\n    return SugarPosition(box.left, box.top);\n  };\n  var firstDefinedOrZero = (a, b) => {\n    if (a !== undefined) {\n      return a;\n    } else {\n      return b !== undefined ? b : 0;\n    }\n  };\n  var absolute = element => {\n    var doc = element.dom.ownerDocument;\n    var body = doc.body;\n    var win = doc.defaultView;\n    var html = doc.documentElement;\n    if (body === element.dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n    var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n    var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n    var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n    var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n    return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n  };\n  var viewport = element => {\n    var dom = element.dom;\n    var doc = dom.ownerDocument;\n    var body = doc.body;\n    if (body === dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n    if (!inBody(element)) {\n      return SugarPosition(0, 0);\n    }\n    return boxPosition(dom);\n  };\n  var rowInfo = (row, y) => ({\n    row,\n    y\n  });\n  var colInfo = (col, x) => ({\n    col,\n    x\n  });\n  var rtlEdge = cell => {\n    var pos = absolute(cell);\n    return pos.left + getOuter$2(cell);\n  };\n  var ltrEdge = cell => {\n    return absolute(cell).left;\n  };\n  var getLeftEdge = (index, cell) => {\n    return colInfo(index, ltrEdge(cell));\n  };\n  var getRightEdge = (index, cell) => {\n    return colInfo(index, rtlEdge(cell));\n  };\n  var getTop$1 = cell => {\n    return absolute(cell).top;\n  };\n  var getTopEdge = (index, cell) => {\n    return rowInfo(index, getTop$1(cell));\n  };\n  var getBottomEdge = (index, cell) => {\n    return rowInfo(index, getTop$1(cell) + getOuter$1(cell));\n  };\n  var findPositions = (getInnerEdge, getOuterEdge, array) => {\n    if (array.length === 0) {\n      return [];\n    }\n    var lines = map$1(array.slice(1), (cellOption, index) => {\n      return cellOption.map(cell => {\n        return getInnerEdge(index, cell);\n      });\n    });\n    var lastLine = array[array.length - 1].map(cell => {\n      return getOuterEdge(array.length - 1, cell);\n    });\n    return lines.concat([lastLine]);\n  };\n  var negate = step => {\n    return -step;\n  };\n  var height = {\n    delta: identity,\n    positions: optElements => findPositions(getTopEdge, getBottomEdge, optElements),\n    edge: getTop$1\n  };\n  var ltr$1 = {\n    delta: identity,\n    edge: ltrEdge,\n    positions: optElements => findPositions(getLeftEdge, getRightEdge, optElements)\n  };\n  var rtl$1 = {\n    delta: negate,\n    edge: rtlEdge,\n    positions: optElements => findPositions(getRightEdge, getLeftEdge, optElements)\n  };\n  var detect$1 = onDirection(ltr$1, rtl$1);\n  var width = {\n    delta: (amount, table) => detect$1(table).delta(amount, table),\n    positions: (cols, table) => detect$1(table).positions(cols, table),\n    edge: cell => detect$1(cell).edge(cell)\n  };\n  var units = {\n    unsupportedLength: ['em', 'ex', 'cap', 'ch', 'ic', 'rem', 'lh', 'rlh', 'vw', 'vh', 'vi', 'vb', 'vmin', 'vmax', 'cm', 'mm', 'Q', 'in', 'pc', 'pt', 'px'],\n    fixed: ['px', 'pt'],\n    relative: ['%'],\n    empty: ['']\n  };\n  var pattern = (() => {\n    var decimalDigits = '[0-9]+';\n    var signedInteger = '[+-]?' + decimalDigits;\n    var exponentPart = '[eE]' + signedInteger;\n    var dot = '\\\\.';\n    var opt = input => \"(?:\".concat(input, \")?\");\n    var unsignedDecimalLiteral = ['Infinity', decimalDigits + dot + opt(decimalDigits) + opt(exponentPart), dot + decimalDigits + opt(exponentPart), decimalDigits + opt(exponentPart)].join('|');\n    var float = \"[+-]?(?:\".concat(unsignedDecimalLiteral, \")\");\n    return new RegExp(\"^(\".concat(float, \")(.*)$\"));\n  })();\n  var isUnit = (unit, accepted) => exists(accepted, acc => exists(units[acc], check => unit === check));\n  var parse = (input, accepted) => {\n    var match = Optional.from(pattern.exec(input));\n    return match.bind(array => {\n      var value = Number(array[1]);\n      var unitRaw = array[2];\n      if (isUnit(unitRaw, accepted)) {\n        return Optional.some({\n          value,\n          unit: unitRaw\n        });\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n  var rPercentageBasedSizeRegex = /(\\d+(\\.\\d+)?)%/;\n  var rPixelBasedSizeRegex = /(\\d+(\\.\\d+)?)px|em/;\n  var isCol$2 = isTag('col');\n  var getPercentSize = (elm, outerGetter, innerGetter) => {\n    var relativeParent = parentElement(elm).getOrThunk(() => getBody$1(owner(elm)));\n    return outerGetter(elm) / innerGetter(relativeParent) * 100;\n  };\n  var setPixelWidth = (cell, amount) => {\n    set$1(cell, 'width', amount + 'px');\n  };\n  var setPercentageWidth = (cell, amount) => {\n    set$1(cell, 'width', amount + '%');\n  };\n  var setHeight = (cell, amount) => {\n    set$1(cell, 'height', amount + 'px');\n  };\n  var getHeightValue = cell => getRuntime(cell) + 'px';\n  var convert = (cell, number, getter, setter) => {\n    var newSize = table(cell).map(table => {\n      var total = getter(table);\n      return Math.floor(number / 100 * total);\n    }).getOr(number);\n    setter(cell, newSize);\n    return newSize;\n  };\n  var normalizePixelSize = (value, cell, getter, setter) => {\n    var number = parseFloat(value);\n    return endsWith(value, '%') && name(cell) !== 'table' ? convert(cell, number, getter, setter) : number;\n  };\n  var getTotalHeight = cell => {\n    var value = getHeightValue(cell);\n    if (!value) {\n      return get$8(cell);\n    }\n    return normalizePixelSize(value, cell, get$8, setHeight);\n  };\n  var get$7 = (cell, type, f) => {\n    var v = f(cell);\n    var span = getSpan(cell, type);\n    return v / span;\n  };\n  var getRaw$1 = (element, prop) => {\n    return getRaw$2(element, prop).orThunk(() => {\n      return getOpt(element, prop).map(val => val + 'px');\n    });\n  };\n  var getRawWidth$1 = element => getRaw$1(element, 'width');\n  var getRawHeight = element => getRaw$1(element, 'height');\n  var getPercentageWidth = cell => getPercentSize(cell, get$9, getInner);\n  var getPixelWidth$1 = cell => isCol$2(cell) ? get$9(cell) : getRuntime$1(cell);\n  var getHeight = cell => {\n    return get$7(cell, 'rowspan', getTotalHeight);\n  };\n  var getGenericWidth = cell => {\n    var width = getRawWidth$1(cell);\n    return width.bind(w => parse(w, ['fixed', 'relative', 'empty']));\n  };\n  var setGenericWidth = (cell, amount, unit) => {\n    set$1(cell, 'width', amount + unit);\n  };\n  var getPixelTableWidth = table => get$9(table) + 'px';\n  var getPercentTableWidth = table => getPercentSize(table, get$9, getInner) + '%';\n  var isPercentSizing$1 = table => getRawWidth$1(table).exists(size => rPercentageBasedSizeRegex.test(size));\n  var isPixelSizing$1 = table => getRawWidth$1(table).exists(size => rPixelBasedSizeRegex.test(size));\n  var isNoneSizing$1 = table => getRawWidth$1(table).isNone();\n  var percentageBasedSizeRegex = constant(rPercentageBasedSizeRegex);\n  var isCol$1 = isTag('col');\n  var getRawW = cell => {\n    return getRawWidth$1(cell).getOrThunk(() => getPixelWidth$1(cell) + 'px');\n  };\n  var getRawH = cell => {\n    return getRawHeight(cell).getOrThunk(() => getHeight(cell) + 'px');\n  };\n  var justCols = warehouse => map$1(Warehouse.justColumns(warehouse), column => Optional.from(column.element));\n  var isValidColumn = cell => {\n    var browser = detect$2().browser;\n    var supportsColWidths = browser.isChromium() || browser.isFirefox();\n    return isCol$1(cell) ? supportsColWidths : true;\n  };\n  var getDimension = (cellOpt, index, backups, filter, getter, fallback) => cellOpt.filter(filter).fold(() => fallback(deduce(backups, index)), cell => getter(cell));\n  var getWidthFrom = (warehouse, table, getWidth, fallback) => {\n    var columnCells = columns(warehouse);\n    var columns$1 = Warehouse.hasColumns(warehouse) ? justCols(warehouse) : columnCells;\n    var backups = [Optional.some(width.edge(table))].concat(map$1(width.positions(columnCells, table), pos => pos.map(p => p.x)));\n    var colFilter = not(hasColspan);\n    return map$1(columns$1, (cellOption, c) => {\n      return getDimension(cellOption, c, backups, colFilter, column => {\n        if (isValidColumn(column)) {\n          return getWidth(column);\n        } else {\n          var _cell2 = bindFrom(columnCells[c], identity);\n          return getDimension(_cell2, c, backups, colFilter, cell => fallback(Optional.some(get$9(cell))), fallback);\n        }\n      }, fallback);\n    });\n  };\n  var getDeduced = deduced => {\n    return deduced.map(d => {\n      return d + 'px';\n    }).getOr('');\n  };\n  var getRawWidths = (warehouse, table) => {\n    return getWidthFrom(warehouse, table, getRawW, getDeduced);\n  };\n  var getPercentageWidths = (warehouse, table, tableSize) => {\n    return getWidthFrom(warehouse, table, getPercentageWidth, deduced => {\n      return deduced.fold(() => {\n        return tableSize.minCellWidth();\n      }, cellWidth => {\n        return cellWidth / tableSize.pixelWidth() * 100;\n      });\n    });\n  };\n  var getPixelWidths = (warehouse, table, tableSize) => {\n    return getWidthFrom(warehouse, table, getPixelWidth$1, deduced => {\n      return deduced.getOrThunk(tableSize.minCellWidth);\n    });\n  };\n  var getHeightFrom = (warehouse, table, direction, getHeight, fallback) => {\n    var rows$1 = rows(warehouse);\n    var backups = [Optional.some(direction.edge(table))].concat(map$1(direction.positions(rows$1, table), pos => pos.map(p => p.y)));\n    return map$1(rows$1, (cellOption, c) => {\n      return getDimension(cellOption, c, backups, not(hasRowspan), getHeight, fallback);\n    });\n  };\n  var getPixelHeights = (warehouse, table, direction) => {\n    return getHeightFrom(warehouse, table, direction, getHeight, deduced => {\n      return deduced.getOrThunk(minHeight);\n    });\n  };\n  var getRawHeights = (warehouse, table, direction) => {\n    return getHeightFrom(warehouse, table, direction, getRawH, getDeduced);\n  };\n  var widthLookup = (table, getter) => () => {\n    if (inBody(table)) {\n      return getter(table);\n    } else {\n      return parseFloat(getRaw$2(table, 'width').getOr('0'));\n    }\n  };\n  var noneSize = table => {\n    var getWidth = widthLookup(table, get$9);\n    var zero = constant(0);\n    var getWidths = (warehouse, tableSize) => getPixelWidths(warehouse, table, tableSize);\n    return {\n      width: getWidth,\n      pixelWidth: getWidth,\n      getWidths,\n      getCellDelta: zero,\n      singleColumnWidth: constant([0]),\n      minCellWidth: zero,\n      setElementWidth: noop,\n      adjustTableWidth: noop,\n      isRelative: true,\n      label: 'none'\n    };\n  };\n  var percentageSize = table => {\n    var getFloatWidth = widthLookup(table, elem => parseFloat(getPercentTableWidth(elem)));\n    var getWidth = widthLookup(table, get$9);\n    var getCellDelta = delta => delta / getWidth() * 100;\n    var singleColumnWidth = (w, _delta) => [100 - w];\n    var minCellWidth = () => minWidth() / getWidth() * 100;\n    var adjustTableWidth = delta => {\n      var currentWidth = getFloatWidth();\n      var change = delta / 100 * currentWidth;\n      var newWidth = currentWidth + change;\n      setPercentageWidth(table, newWidth);\n    };\n    var getWidths = (warehouse, tableSize) => getPercentageWidths(warehouse, table, tableSize);\n    return {\n      width: getFloatWidth,\n      pixelWidth: getWidth,\n      getWidths,\n      getCellDelta,\n      singleColumnWidth,\n      minCellWidth,\n      setElementWidth: setPercentageWidth,\n      adjustTableWidth,\n      isRelative: true,\n      label: 'percent'\n    };\n  };\n  var pixelSize = table => {\n    var getWidth = widthLookup(table, get$9);\n    var getCellDelta = identity;\n    var singleColumnWidth = (w, delta) => {\n      var newNext = Math.max(minWidth(), w + delta);\n      return [newNext - w];\n    };\n    var adjustTableWidth = delta => {\n      var newWidth = getWidth() + delta;\n      setPixelWidth(table, newWidth);\n    };\n    var getWidths = (warehouse, tableSize) => getPixelWidths(warehouse, table, tableSize);\n    return {\n      width: getWidth,\n      pixelWidth: getWidth,\n      getWidths,\n      getCellDelta,\n      singleColumnWidth,\n      minCellWidth: minWidth,\n      setElementWidth: setPixelWidth,\n      adjustTableWidth,\n      isRelative: false,\n      label: 'pixel'\n    };\n  };\n  var chooseSize = (element, width) => {\n    var percentMatch = percentageBasedSizeRegex().exec(width);\n    if (percentMatch !== null) {\n      return percentageSize(element);\n    } else {\n      return pixelSize(element);\n    }\n  };\n  var getTableSize = table => {\n    var width = getRawWidth$1(table);\n    return width.fold(() => noneSize(table), w => chooseSize(table, w));\n  };\n  var TableSize = {\n    getTableSize,\n    pixelSize,\n    percentageSize,\n    noneSize\n  };\n  var statsStruct = (minRow, minCol, maxRow, maxCol, allCells, selectedCells) => ({\n    minRow,\n    minCol,\n    maxRow,\n    maxCol,\n    allCells,\n    selectedCells\n  });\n  var findSelectedStats = (house, isSelected) => {\n    var totalColumns = house.grid.columns;\n    var totalRows = house.grid.rows;\n    var minRow = totalRows;\n    var minCol = totalColumns;\n    var maxRow = 0;\n    var maxCol = 0;\n    var allCells = [];\n    var selectedCells = [];\n    each$1(house.access, detail => {\n      allCells.push(detail);\n      if (isSelected(detail)) {\n        selectedCells.push(detail);\n        var startRow = detail.row;\n        var endRow = startRow + detail.rowspan - 1;\n        var startCol = detail.column;\n        var endCol = startCol + detail.colspan - 1;\n        if (startRow < minRow) {\n          minRow = startRow;\n        } else if (endRow > maxRow) {\n          maxRow = endRow;\n        }\n        if (startCol < minCol) {\n          minCol = startCol;\n        } else if (endCol > maxCol) {\n          maxCol = endCol;\n        }\n      }\n    });\n    return statsStruct(minRow, minCol, maxRow, maxCol, allCells, selectedCells);\n  };\n  var makeCell = (list, seenSelected, rowIndex) => {\n    var row = list[rowIndex].element;\n    var td = SugarElement.fromTag('td');\n    append$1(td, SugarElement.fromTag('br'));\n    var f = seenSelected ? append$1 : prepend;\n    f(row, td);\n  };\n  var fillInGaps = (list, house, stats, isSelected) => {\n    var rows = filter$2(list, row => row.section !== 'colgroup');\n    var totalColumns = house.grid.columns;\n    var totalRows = house.grid.rows;\n    for (var i = 0; i < totalRows; i++) {\n      var seenSelected = false;\n      for (var j = 0; j < totalColumns; j++) {\n        if (!(i < stats.minRow || i > stats.maxRow || j < stats.minCol || j > stats.maxCol)) {\n          var needCell = Warehouse.getAt(house, i, j).filter(isSelected).isNone();\n          if (needCell) {\n            makeCell(rows, seenSelected, i);\n          } else {\n            seenSelected = true;\n          }\n        }\n      }\n    }\n  };\n  var clean = (replica, stats, house, widthDelta) => {\n    each$1(house.columns, col => {\n      if (col.column < stats.minCol || col.column > stats.maxCol) {\n        remove$6(col.element);\n      }\n    });\n    var emptyRows = filter$2(firstLayer(replica, 'tr'), row => row.dom.childElementCount === 0);\n    each$2(emptyRows, remove$6);\n    if (stats.minCol === stats.maxCol || stats.minRow === stats.maxRow) {\n      each$2(firstLayer(replica, 'th,td'), cell => {\n        remove$7(cell, 'rowspan');\n        remove$7(cell, 'colspan');\n      });\n    }\n    remove$7(replica, LOCKED_COL_ATTR);\n    remove$7(replica, 'data-snooker-col-series');\n    var tableSize = TableSize.getTableSize(replica);\n    tableSize.adjustTableWidth(widthDelta);\n  };\n  var getTableWidthDelta = (table, warehouse, tableSize, stats) => {\n    if (stats.minCol === 0 && warehouse.grid.columns === stats.maxCol + 1) {\n      return 0;\n    }\n    var colWidths = getPixelWidths(warehouse, table, tableSize);\n    var allColsWidth = foldl(colWidths, (acc, width) => acc + width, 0);\n    var selectedColsWidth = foldl(colWidths.slice(stats.minCol, stats.maxCol + 1), (acc, width) => acc + width, 0);\n    var newWidth = selectedColsWidth / allColsWidth * tableSize.pixelWidth();\n    var delta = newWidth - tableSize.pixelWidth();\n    return tableSize.getCellDelta(delta);\n  };\n  var extract$1 = (table, selectedSelector) => {\n    var isSelected = detail => is$2(detail.element, selectedSelector);\n    var replica = deep(table);\n    var list = fromTable$1(replica);\n    var tableSize = TableSize.getTableSize(table);\n    var replicaHouse = Warehouse.generate(list);\n    var replicaStats = findSelectedStats(replicaHouse, isSelected);\n    var selector = 'th:not(' + selectedSelector + ')' + ',td:not(' + selectedSelector + ')';\n    var unselectedCells = filterFirstLayer(replica, 'th,td', cell => is$2(cell, selector));\n    each$2(unselectedCells, remove$6);\n    fillInGaps(list, replicaHouse, replicaStats, isSelected);\n    var house = Warehouse.fromTable(table);\n    var widthDelta = getTableWidthDelta(table, house, tableSize, replicaStats);\n    clean(replica, replicaStats, replicaHouse, widthDelta);\n    return replica;\n  };\n  var nbsp = '\\xA0';\n  var NodeValue = (is, name) => {\n    var get = element => {\n      if (!is(element)) {\n        throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n      }\n      return getOption(element).getOr('');\n    };\n    var getOption = element => is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n    var set = (element, value) => {\n      if (!is(element)) {\n        throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n      }\n      element.dom.nodeValue = value;\n    };\n    return {\n      get,\n      getOption,\n      set\n    };\n  };\n  var api = NodeValue(isText, 'text');\n  var get$6 = element => api.get(element);\n  var getOption = element => api.getOption(element);\n  var set = (element, value) => api.set(element, value);\n  var getEnd = element => name(element) === 'img' ? 1 : getOption(element).fold(() => children$2(element).length, v => v.length);\n  var isTextNodeWithCursorPosition = el => getOption(el).filter(text => text.trim().length !== 0 || text.indexOf(nbsp) > -1).isSome();\n  var isContentEditableFalse = elem => isHTMLElement(elem) && get$b(elem, 'contenteditable') === 'false';\n  var elementsWithCursorPosition = ['img', 'br'];\n  var isCursorPosition = elem => {\n    var hasCursorPosition = isTextNodeWithCursorPosition(elem);\n    return hasCursorPosition || contains$2(elementsWithCursorPosition, name(elem)) || isContentEditableFalse(elem);\n  };\n  var first = element => descendant$1(element, isCursorPosition);\n  var last$1 = element => descendantRtl(element, isCursorPosition);\n  var descendantRtl = (scope, predicate) => {\n    var descend = element => {\n      var children = children$2(element);\n      for (var i = children.length - 1; i >= 0; i--) {\n        var _child2 = children[i];\n        if (predicate(_child2)) {\n          return Optional.some(_child2);\n        }\n        var res = descend(_child2);\n        if (res.isSome()) {\n          return res;\n        }\n      }\n      return Optional.none();\n    };\n    return descend(scope);\n  };\n  var transferableAttributes = {\n    scope: ['row', 'col']\n  };\n  var createCell = doc => () => {\n    var td = SugarElement.fromTag('td', doc.dom);\n    append$1(td, SugarElement.fromTag('br', doc.dom));\n    return td;\n  };\n  var createCol = doc => () => {\n    return SugarElement.fromTag('col', doc.dom);\n  };\n  var createColgroup = doc => () => {\n    return SugarElement.fromTag('colgroup', doc.dom);\n  };\n  var createRow$1 = doc => () => {\n    return SugarElement.fromTag('tr', doc.dom);\n  };\n  var replace$1 = (cell, tag, attrs) => {\n    var replica = copy$2(cell, tag);\n    each$1(attrs, (v, k) => {\n      if (v === null) {\n        remove$7(replica, k);\n      } else {\n        set$2(replica, k, v);\n      }\n    });\n    return replica;\n  };\n  var pasteReplace = cell => {\n    return cell;\n  };\n  var cloneFormats = (oldCell, newCell, formats) => {\n    var first$1 = first(oldCell);\n    return first$1.map(firstText => {\n      var formatSelector = formats.join(',');\n      var parents = ancestors$3(firstText, formatSelector, element => {\n        return eq$1(element, oldCell);\n      });\n      return foldr(parents, (last, parent) => {\n        var clonedFormat = shallow(parent);\n        append$1(last, clonedFormat);\n        return clonedFormat;\n      }, newCell);\n    }).getOr(newCell);\n  };\n  var cloneAppropriateAttributes = (original, clone) => {\n    each$1(transferableAttributes, (validAttributes, attributeName) => getOpt(original, attributeName).filter(attribute => contains$2(validAttributes, attribute)).each(attribute => set$2(clone, attributeName, attribute)));\n  };\n  var cellOperations = (mutate, doc, formatsToClone) => {\n    var cloneCss = (prev, clone) => {\n      copy$1(prev.element, clone);\n      remove$5(clone, 'height');\n      if (prev.colspan !== 1) {\n        remove$5(clone, 'width');\n      }\n    };\n    var newCell = prev => {\n      var td = SugarElement.fromTag(name(prev.element), doc.dom);\n      var formats = formatsToClone.getOr(['strong', 'em', 'b', 'i', 'span', 'font', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div']);\n      var lastNode = formats.length > 0 ? cloneFormats(prev.element, td, formats) : td;\n      append$1(lastNode, SugarElement.fromTag('br'));\n      cloneCss(prev, td);\n      cloneAppropriateAttributes(prev.element, td);\n      mutate(prev.element, td);\n      return td;\n    };\n    var newCol = prev => {\n      var col = SugarElement.fromTag(name(prev.element), doc.dom);\n      cloneCss(prev, col);\n      mutate(prev.element, col);\n      return col;\n    };\n    return {\n      col: newCol,\n      colgroup: createColgroup(doc),\n      row: createRow$1(doc),\n      cell: newCell,\n      replace: replace$1,\n      colGap: createCol(doc),\n      gap: createCell(doc)\n    };\n  };\n  var paste$1 = doc => {\n    return {\n      col: createCol(doc),\n      colgroup: createColgroup(doc),\n      row: createRow$1(doc),\n      cell: createCell(doc),\n      replace: pasteReplace,\n      colGap: createCol(doc),\n      gap: createCell(doc)\n    };\n  };\n  var fromHtml = (html, scope) => {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    return children$2(SugarElement.fromDom(div));\n  };\n  var fromDom = nodes => map$1(nodes, SugarElement.fromDom);\n  var option = name => editor => editor.options.get(name);\n  var defaultWidth = '100%';\n  var getPixelForcedWidth = editor => {\n    var _a;\n    var dom = editor.dom;\n    var parentBlock = (_a = dom.getParent(editor.selection.getStart(), dom.isBlock)) !== null && _a !== void 0 ? _a : editor.getBody();\n    return getInner(SugarElement.fromDom(parentBlock)) + 'px';\n  };\n  var determineDefaultTableStyles = (editor, defaultStyles) => {\n    if (isTableResponsiveForced(editor) || !shouldStyleWithCss(editor)) {\n      return defaultStyles;\n    } else if (isTablePixelsForced(editor)) {\n      return _objectSpread(_objectSpread({}, defaultStyles), {}, {\n        width: getPixelForcedWidth(editor)\n      });\n    } else {\n      return _objectSpread(_objectSpread({}, defaultStyles), {}, {\n        width: defaultWidth\n      });\n    }\n  };\n  var determineDefaultTableAttributes = (editor, defaultAttributes) => {\n    if (isTableResponsiveForced(editor) || shouldStyleWithCss(editor)) {\n      return defaultAttributes;\n    } else if (isTablePixelsForced(editor)) {\n      return _objectSpread(_objectSpread({}, defaultAttributes), {}, {\n        width: getPixelForcedWidth(editor)\n      });\n    } else {\n      return _objectSpread(_objectSpread({}, defaultAttributes), {}, {\n        width: defaultWidth\n      });\n    }\n  };\n  var register = editor => {\n    var registerOption = editor.options.register;\n    registerOption('table_clone_elements', {\n      processor: 'string[]'\n    });\n    registerOption('table_use_colgroups', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('table_header_type', {\n      processor: value => {\n        var valid = contains$2(['section', 'cells', 'sectionCells', 'auto'], value);\n        return valid ? {\n          value,\n          valid\n        } : {\n          valid: false,\n          message: 'Must be one of: section, cells, sectionCells or auto.'\n        };\n      },\n      default: 'section'\n    });\n    registerOption('table_sizing_mode', {\n      processor: 'string',\n      default: 'auto'\n    });\n    registerOption('table_default_attributes', {\n      processor: 'object',\n      default: {\n        border: '1'\n      }\n    });\n    registerOption('table_default_styles', {\n      processor: 'object',\n      default: {\n        'border-collapse': 'collapse'\n      }\n    });\n    registerOption('table_column_resizing', {\n      processor: value => {\n        var valid = contains$2(['preservetable', 'resizetable'], value);\n        return valid ? {\n          value,\n          valid\n        } : {\n          valid: false,\n          message: 'Must be preservetable, or resizetable.'\n        };\n      },\n      default: 'preservetable'\n    });\n    registerOption('table_resize_bars', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('table_style_by_css', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('table_merge_content_on_paste', {\n      processor: 'boolean',\n      default: true\n    });\n  };\n  var getTableCloneElements = editor => {\n    return Optional.from(editor.options.get('table_clone_elements'));\n  };\n  var hasTableObjectResizing = editor => {\n    var objectResizing = editor.options.get('object_resizing');\n    return contains$2(objectResizing.split(','), 'table');\n  };\n  var getTableHeaderType = option('table_header_type');\n  var getTableColumnResizingBehaviour = option('table_column_resizing');\n  var isPreserveTableColumnResizing = editor => getTableColumnResizingBehaviour(editor) === 'preservetable';\n  var isResizeTableColumnResizing = editor => getTableColumnResizingBehaviour(editor) === 'resizetable';\n  var getTableSizingMode = option('table_sizing_mode');\n  var isTablePercentagesForced = editor => getTableSizingMode(editor) === 'relative';\n  var isTablePixelsForced = editor => getTableSizingMode(editor) === 'fixed';\n  var isTableResponsiveForced = editor => getTableSizingMode(editor) === 'responsive';\n  var hasTableResizeBars = option('table_resize_bars');\n  var shouldStyleWithCss = option('table_style_by_css');\n  var shouldMergeContentOnPaste = option('table_merge_content_on_paste');\n  var getTableDefaultAttributes = editor => {\n    var options = editor.options;\n    var defaultAttributes = options.get('table_default_attributes');\n    return options.isSet('table_default_attributes') ? defaultAttributes : determineDefaultTableAttributes(editor, defaultAttributes);\n  };\n  var getTableDefaultStyles = editor => {\n    var options = editor.options;\n    var defaultStyles = options.get('table_default_styles');\n    return options.isSet('table_default_styles') ? defaultStyles : determineDefaultTableStyles(editor, defaultStyles);\n  };\n  var tableUseColumnGroup = option('table_use_colgroups');\n  var closest = target => closest$1(target, '[contenteditable]');\n  var isEditable$1 = function isEditable$1(element) {\n    var assumeEditable = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    if (inBody(element)) {\n      return element.dom.isContentEditable;\n    } else {\n      return closest(element).fold(constant(assumeEditable), editable => getRaw(editable) === 'true');\n    }\n  };\n  var getRaw = element => element.dom.contentEditable;\n  var getBody = editor => SugarElement.fromDom(editor.getBody());\n  var getIsRoot = editor => element => eq$1(element, getBody(editor));\n  var removeDataStyle = table => {\n    remove$7(table, 'data-mce-style');\n    var removeStyleAttribute = element => remove$7(element, 'data-mce-style');\n    each$2(cells$1(table), removeStyleAttribute);\n    each$2(columns$1(table), removeStyleAttribute);\n    each$2(rows$1(table), removeStyleAttribute);\n  };\n  var getSelectionStart = editor => SugarElement.fromDom(editor.selection.getStart());\n  var getPixelWidth = elm => elm.getBoundingClientRect().width;\n  var getPixelHeight = elm => elm.getBoundingClientRect().height;\n  var getRawWidth = (editor, elm) => {\n    var raw = editor.dom.getStyle(elm, 'width') || editor.dom.getAttrib(elm, 'width');\n    return Optional.from(raw).filter(isNotEmpty);\n  };\n  var isPercentage$1 = value => /^(\\d+(\\.\\d+)?)%$/.test(value);\n  var isPixel = value => /^(\\d+(\\.\\d+)?)px$/.test(value);\n  var isInEditableContext$1 = cell => closest$2(cell, isTag('table')).exists(isEditable$1);\n  var inSelection = (bounds, detail) => {\n    var leftEdge = detail.column;\n    var rightEdge = detail.column + detail.colspan - 1;\n    var topEdge = detail.row;\n    var bottomEdge = detail.row + detail.rowspan - 1;\n    return leftEdge <= bounds.finishCol && rightEdge >= bounds.startCol && topEdge <= bounds.finishRow && bottomEdge >= bounds.startRow;\n  };\n  var isWithin = (bounds, detail) => {\n    return detail.column >= bounds.startCol && detail.column + detail.colspan - 1 <= bounds.finishCol && detail.row >= bounds.startRow && detail.row + detail.rowspan - 1 <= bounds.finishRow;\n  };\n  var isRectangular = (warehouse, bounds) => {\n    var isRect = true;\n    var detailIsWithin = curry(isWithin, bounds);\n    for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n      for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n        isRect = isRect && Warehouse.getAt(warehouse, i, j).exists(detailIsWithin);\n      }\n    }\n    return isRect ? Optional.some(bounds) : Optional.none();\n  };\n  var getBounds = (detailA, detailB) => {\n    return bounds(Math.min(detailA.row, detailB.row), Math.min(detailA.column, detailB.column), Math.max(detailA.row + detailA.rowspan - 1, detailB.row + detailB.rowspan - 1), Math.max(detailA.column + detailA.colspan - 1, detailB.column + detailB.colspan - 1));\n  };\n  var getAnyBox = (warehouse, startCell, finishCell) => {\n    var startCoords = Warehouse.findItem(warehouse, startCell, eq$1);\n    var finishCoords = Warehouse.findItem(warehouse, finishCell, eq$1);\n    return startCoords.bind(sc => {\n      return finishCoords.map(fc => {\n        return getBounds(sc, fc);\n      });\n    });\n  };\n  var getBox$1 = (warehouse, startCell, finishCell) => {\n    return getAnyBox(warehouse, startCell, finishCell).bind(bounds => {\n      return isRectangular(warehouse, bounds);\n    });\n  };\n  var moveBy$1 = (warehouse, cell, row, column) => {\n    return Warehouse.findItem(warehouse, cell, eq$1).bind(detail => {\n      var startRow = row > 0 ? detail.row + detail.rowspan - 1 : detail.row;\n      var startCol = column > 0 ? detail.column + detail.colspan - 1 : detail.column;\n      var dest = Warehouse.getAt(warehouse, startRow + row, startCol + column);\n      return dest.map(d => {\n        return d.element;\n      });\n    });\n  };\n  var intercepts$1 = (warehouse, start, finish) => {\n    return getAnyBox(warehouse, start, finish).map(bounds => {\n      var inside = Warehouse.filterItems(warehouse, curry(inSelection, bounds));\n      return map$1(inside, detail => {\n        return detail.element;\n      });\n    });\n  };\n  var parentCell = (warehouse, innerCell) => {\n    var isContainedBy = (c1, c2) => {\n      return contains$1(c2, c1);\n    };\n    return Warehouse.findItem(warehouse, innerCell, isContainedBy).map(detail => {\n      return detail.element;\n    });\n  };\n  var moveBy = (cell, deltaRow, deltaColumn) => {\n    return table(cell).bind(table => {\n      var warehouse = getWarehouse(table);\n      return moveBy$1(warehouse, cell, deltaRow, deltaColumn);\n    });\n  };\n  var intercepts = (table, first, last) => {\n    var warehouse = getWarehouse(table);\n    return intercepts$1(warehouse, first, last);\n  };\n  var nestedIntercepts = (table, first, firstTable, last, lastTable) => {\n    var warehouse = getWarehouse(table);\n    var optStartCell = eq$1(table, firstTable) ? Optional.some(first) : parentCell(warehouse, first);\n    var optLastCell = eq$1(table, lastTable) ? Optional.some(last) : parentCell(warehouse, last);\n    return optStartCell.bind(startCell => optLastCell.bind(lastCell => intercepts$1(warehouse, startCell, lastCell)));\n  };\n  var getBox = (table, first, last) => {\n    var warehouse = getWarehouse(table);\n    return getBox$1(warehouse, first, last);\n  };\n  var getWarehouse = Warehouse.fromTable;\n  var TagBoundaries = ['body', 'p', 'div', 'article', 'aside', 'figcaption', 'figure', 'footer', 'header', 'nav', 'section', 'ol', 'ul', 'li', 'table', 'thead', 'tbody', 'tfoot', 'caption', 'tr', 'td', 'th', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'address'];\n  var DomUniverse = () => {\n    var clone = element => {\n      return SugarElement.fromDom(element.dom.cloneNode(false));\n    };\n    var document = element => documentOrOwner(element).dom;\n    var isBoundary = element => {\n      if (!isElement(element)) {\n        return false;\n      }\n      if (name(element) === 'body') {\n        return true;\n      }\n      return contains$2(TagBoundaries, name(element));\n    };\n    var isEmptyTag = element => {\n      if (!isElement(element)) {\n        return false;\n      }\n      return contains$2(['br', 'img', 'hr', 'input'], name(element));\n    };\n    var isNonEditable = element => isElement(element) && get$b(element, 'contenteditable') === 'false';\n    var comparePosition = (element, other) => {\n      return element.dom.compareDocumentPosition(other.dom);\n    };\n    var copyAttributesTo = (source, destination) => {\n      var as = clone$2(source);\n      setAll$1(destination, as);\n    };\n    var isSpecial = element => {\n      var tag = name(element);\n      return contains$2(['script', 'noscript', 'iframe', 'noframes', 'noembed', 'title', 'style', 'textarea', 'xmp'], tag);\n    };\n    var getLanguage = element => isElement(element) ? getOpt(element, 'lang') : Optional.none();\n    return {\n      up: constant({\n        selector: ancestor$1,\n        closest: closest$1,\n        predicate: ancestor$2,\n        all: parents\n      }),\n      down: constant({\n        selector: descendants,\n        predicate: descendants$1\n      }),\n      styles: constant({\n        get: get$a,\n        getRaw: getRaw$2,\n        set: set$1,\n        remove: remove$5\n      }),\n      attrs: constant({\n        get: get$b,\n        set: set$2,\n        remove: remove$7,\n        copyTo: copyAttributesTo\n      }),\n      insert: constant({\n        before: before$3,\n        after: after$5,\n        afterAll: after$4,\n        append: append$1,\n        appendAll: append,\n        prepend: prepend,\n        wrap: wrap\n      }),\n      remove: constant({\n        unwrap: unwrap,\n        remove: remove$6\n      }),\n      create: constant({\n        nu: SugarElement.fromTag,\n        clone,\n        text: SugarElement.fromText\n      }),\n      query: constant({\n        comparePosition,\n        prevSibling: prevSibling,\n        nextSibling: nextSibling\n      }),\n      property: constant({\n        children: children$2,\n        name: name,\n        parent: parent,\n        document,\n        isText: isText,\n        isComment: isComment,\n        isElement: isElement,\n        isSpecial,\n        getLanguage,\n        getText: get$6,\n        setText: set,\n        isBoundary,\n        isEmptyTag,\n        isNonEditable\n      }),\n      eq: eq$1,\n      is: is$1\n    };\n  };\n  var all = (universe, look, elements, f) => {\n    var head = elements[0];\n    var tail = elements.slice(1);\n    return f(universe, look, head, tail);\n  };\n  var oneAll = (universe, look, elements) => {\n    return elements.length > 0 ? all(universe, look, elements, unsafeOne) : Optional.none();\n  };\n  var unsafeOne = (universe, look, head, tail) => {\n    var start = look(universe, head);\n    return foldr(tail, (b, a) => {\n      var current = look(universe, a);\n      return commonElement(universe, b, current);\n    }, start);\n  };\n  var commonElement = (universe, start, end) => {\n    return start.bind(s => {\n      return end.filter(curry(universe.eq, s));\n    });\n  };\n  var eq = (universe, item) => {\n    return curry(universe.eq, item);\n  };\n  var ancestors$2 = function ancestors$2(universe, start, end) {\n    var isRoot = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : never;\n    var ps1 = [start].concat(universe.up().all(start));\n    var ps2 = [end].concat(universe.up().all(end));\n    var prune = path => {\n      var index = findIndex(path, isRoot);\n      return index.fold(() => {\n        return path;\n      }, ind => {\n        return path.slice(0, ind + 1);\n      });\n    };\n    var pruned1 = prune(ps1);\n    var pruned2 = prune(ps2);\n    var shared = find$1(pruned1, x => {\n      return exists(pruned2, eq(universe, x));\n    });\n    return {\n      firstpath: pruned1,\n      secondpath: pruned2,\n      shared\n    };\n  };\n  var sharedOne$1 = oneAll;\n  var ancestors$1 = ancestors$2;\n  var universe$3 = DomUniverse();\n  var sharedOne = (look, elements) => {\n    return sharedOne$1(universe$3, (_universe, element) => {\n      return look(element);\n    }, elements);\n  };\n  var ancestors = (start, finish, isRoot) => {\n    return ancestors$1(universe$3, start, finish, isRoot);\n  };\n  var lookupTable = container => {\n    return ancestor$1(container, 'table');\n  };\n  var identify = (start, finish, isRoot) => {\n    var getIsRoot = rootTable => {\n      return element => {\n        return isRoot !== undefined && isRoot(element) || eq$1(element, rootTable);\n      };\n    };\n    if (eq$1(start, finish)) {\n      return Optional.some({\n        boxes: Optional.some([start]),\n        start,\n        finish\n      });\n    } else {\n      return lookupTable(start).bind(startTable => {\n        return lookupTable(finish).bind(finishTable => {\n          if (eq$1(startTable, finishTable)) {\n            return Optional.some({\n              boxes: intercepts(startTable, start, finish),\n              start,\n              finish\n            });\n          } else if (contains$1(startTable, finishTable)) {\n            var ancestorCells = ancestors$3(finish, 'td,th', getIsRoot(startTable));\n            var finishCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : finish;\n            return Optional.some({\n              boxes: nestedIntercepts(startTable, start, startTable, finish, finishTable),\n              start,\n              finish: finishCell\n            });\n          } else if (contains$1(finishTable, startTable)) {\n            var _ancestorCells = ancestors$3(start, 'td,th', getIsRoot(finishTable));\n            var startCell = _ancestorCells.length > 0 ? _ancestorCells[_ancestorCells.length - 1] : start;\n            return Optional.some({\n              boxes: nestedIntercepts(finishTable, start, startTable, finish, finishTable),\n              start,\n              finish: startCell\n            });\n          } else {\n            return ancestors(start, finish).shared.bind(lca => {\n              return closest$1(lca, 'table', isRoot).bind(lcaTable => {\n                var finishAncestorCells = ancestors$3(finish, 'td,th', getIsRoot(lcaTable));\n                var finishCell = finishAncestorCells.length > 0 ? finishAncestorCells[finishAncestorCells.length - 1] : finish;\n                var startAncestorCells = ancestors$3(start, 'td,th', getIsRoot(lcaTable));\n                var startCell = startAncestorCells.length > 0 ? startAncestorCells[startAncestorCells.length - 1] : start;\n                return Optional.some({\n                  boxes: nestedIntercepts(lcaTable, start, startTable, finish, finishTable),\n                  start: startCell,\n                  finish: finishCell\n                });\n              });\n            });\n          }\n        });\n      });\n    }\n  };\n  var retrieve$1 = (container, selector) => {\n    var sels = descendants(container, selector);\n    return sels.length > 0 ? Optional.some(sels) : Optional.none();\n  };\n  var getLast = (boxes, lastSelectedSelector) => {\n    return find$1(boxes, box => {\n      return is$2(box, lastSelectedSelector);\n    });\n  };\n  var getEdges = (container, firstSelectedSelector, lastSelectedSelector) => {\n    return descendant(container, firstSelectedSelector).bind(first => {\n      return descendant(container, lastSelectedSelector).bind(last => {\n        return sharedOne(lookupTable, [first, last]).map(table => {\n          return {\n            first,\n            last,\n            table\n          };\n        });\n      });\n    });\n  };\n  var expandTo = (finish, firstSelectedSelector) => {\n    return ancestor$1(finish, 'table').bind(table => {\n      return descendant(table, firstSelectedSelector).bind(start => {\n        return identify(start, finish).bind(identified => {\n          return identified.boxes.map(boxes => {\n            return {\n              boxes,\n              start: identified.start,\n              finish: identified.finish\n            };\n          });\n        });\n      });\n    });\n  };\n  var shiftSelection = (boxes, deltaRow, deltaColumn, firstSelectedSelector, lastSelectedSelector) => {\n    return getLast(boxes, lastSelectedSelector).bind(last => {\n      return moveBy(last, deltaRow, deltaColumn).bind(finish => {\n        return expandTo(finish, firstSelectedSelector);\n      });\n    });\n  };\n  var retrieve = (container, selector) => {\n    return retrieve$1(container, selector);\n  };\n  var retrieveBox = (container, firstSelectedSelector, lastSelectedSelector) => {\n    return getEdges(container, firstSelectedSelector, lastSelectedSelector).bind(edges => {\n      var isRoot = ancestor => {\n        return eq$1(container, ancestor);\n      };\n      var sectionSelector = 'thead,tfoot,tbody,table';\n      var firstAncestor = ancestor$1(edges.first, sectionSelector, isRoot);\n      var lastAncestor = ancestor$1(edges.last, sectionSelector, isRoot);\n      return firstAncestor.bind(fA => {\n        return lastAncestor.bind(lA => {\n          return eq$1(fA, lA) ? getBox(edges.table, edges.first, edges.last) : Optional.none();\n        });\n      });\n    });\n  };\n  var selection = identity;\n  var unmergable = selectedCells => {\n    var hasSpan = (elem, type) => getOpt(elem, type).exists(span => parseInt(span, 10) > 1);\n    var hasRowOrColSpan = elem => hasSpan(elem, 'rowspan') || hasSpan(elem, 'colspan');\n    return selectedCells.length > 0 && forall(selectedCells, hasRowOrColSpan) ? Optional.some(selectedCells) : Optional.none();\n  };\n  var mergable = (table, selectedCells, ephemera) => {\n    if (selectedCells.length <= 1) {\n      return Optional.none();\n    } else {\n      return retrieveBox(table, ephemera.firstSelectedSelector, ephemera.lastSelectedSelector).map(bounds => ({\n        bounds,\n        cells: selectedCells\n      }));\n    }\n  };\n  var strSelected = 'data-mce-selected';\n  var strSelectedSelector = 'td[' + strSelected + '],th[' + strSelected + ']';\n  var strAttributeSelector = '[' + strSelected + ']';\n  var strFirstSelected = 'data-mce-first-selected';\n  var strFirstSelectedSelector = 'td[' + strFirstSelected + '],th[' + strFirstSelected + ']';\n  var strLastSelected = 'data-mce-last-selected';\n  var strLastSelectedSelector = 'td[' + strLastSelected + '],th[' + strLastSelected + ']';\n  var attributeSelector = strAttributeSelector;\n  var ephemera = {\n    selected: strSelected,\n    selectedSelector: strSelectedSelector,\n    firstSelected: strFirstSelected,\n    firstSelectedSelector: strFirstSelectedSelector,\n    lastSelected: strLastSelected,\n    lastSelectedSelector: strLastSelectedSelector\n  };\n  var forMenu = (selectedCells, table, cell) => ({\n    element: cell,\n    mergable: mergable(table, selectedCells, ephemera),\n    unmergable: unmergable(selectedCells),\n    selection: selection(selectedCells)\n  });\n  var paste = (element, clipboard, generators) => ({\n    element,\n    clipboard,\n    generators\n  });\n  var pasteRows = (selectedCells, _cell, clipboard, generators) => ({\n    selection: selection(selectedCells),\n    clipboard,\n    generators\n  });\n  var getSelectionCellFallback = element => table(element).bind(table => retrieve(table, ephemera.firstSelectedSelector)).fold(constant(element), cells => cells[0]);\n  var getSelectionFromSelector = selector => (initCell, isRoot) => {\n    var cellName = name(initCell);\n    var cell = cellName === 'col' || cellName === 'colgroup' ? getSelectionCellFallback(initCell) : initCell;\n    return closest$1(cell, selector, isRoot);\n  };\n  var getSelectionCellOrCaption = getSelectionFromSelector('th,td,caption');\n  var getSelectionCell = getSelectionFromSelector('th,td');\n  var getCellsFromSelection = editor => fromDom(editor.model.table.getSelectedCells());\n  var getCellsFromFakeSelection = editor => filter$2(getCellsFromSelection(editor), cell => is$2(cell, ephemera.selectedSelector));\n  var extractSelected = cells => {\n    return table(cells[0]).map(table => {\n      var replica = extract$1(table, attributeSelector);\n      removeDataStyle(replica);\n      return [replica];\n    });\n  };\n  var serializeElements = (editor, elements) => map$1(elements, elm => editor.selection.serializer.serialize(elm.dom, {})).join('');\n  var getTextContent = elements => map$1(elements, element => element.dom.innerText).join('');\n  var registerEvents = (editor, actions) => {\n    editor.on('BeforeGetContent', e => {\n      var multiCellContext = cells => {\n        e.preventDefault();\n        extractSelected(cells).each(elements => {\n          e.content = e.format === 'text' ? getTextContent(elements) : serializeElements(editor, elements);\n        });\n      };\n      if (e.selection === true) {\n        var _cells3 = getCellsFromFakeSelection(editor);\n        if (_cells3.length >= 1) {\n          multiCellContext(_cells3);\n        }\n      }\n    });\n    editor.on('BeforeSetContent', e => {\n      if (e.selection === true && e.paste === true) {\n        var selectedCells = getCellsFromSelection(editor);\n        head(selectedCells).each(cell => {\n          table(cell).each(table => {\n            var elements = filter$2(fromHtml(e.content), content => {\n              return name(content) !== 'meta';\n            });\n            var isTable = isTag('table');\n            if (shouldMergeContentOnPaste(editor) && elements.length === 1 && isTable(elements[0])) {\n              e.preventDefault();\n              var doc = SugarElement.fromDom(editor.getDoc());\n              var generators = paste$1(doc);\n              var targets = paste(cell, elements[0], generators);\n              actions.pasteCells(table, targets).each(() => {\n                editor.focus();\n              });\n            }\n          });\n        });\n      }\n    });\n  };\n  var point = (element, offset) => ({\n    element,\n    offset\n  });\n  var scan$1 = (universe, element, direction) => {\n    if (universe.property().isText(element) && universe.property().getText(element).trim().length === 0 || universe.property().isComment(element)) {\n      return direction(element).bind(elem => {\n        return scan$1(universe, elem, direction).orThunk(() => {\n          return Optional.some(elem);\n        });\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n  var toEnd = (universe, element) => {\n    if (universe.property().isText(element)) {\n      return universe.property().getText(element).length;\n    }\n    var children = universe.property().children(element);\n    return children.length;\n  };\n  var freefallRtl$2 = (universe, element) => {\n    var candidate = scan$1(universe, element, universe.query().prevSibling).getOr(element);\n    if (universe.property().isText(candidate)) {\n      return point(candidate, toEnd(universe, candidate));\n    }\n    var children = universe.property().children(candidate);\n    return children.length > 0 ? freefallRtl$2(universe, children[children.length - 1]) : point(candidate, toEnd(universe, candidate));\n  };\n  var freefallRtl$1 = freefallRtl$2;\n  var universe$2 = DomUniverse();\n  var freefallRtl = element => {\n    return freefallRtl$1(universe$2, element);\n  };\n  var halve = (main, other) => {\n    if (!hasColspan(main)) {\n      var _width = getGenericWidth(main);\n      _width.each(w => {\n        var newWidth = w.value / 2;\n        setGenericWidth(main, newWidth, w.unit);\n        setGenericWidth(other, newWidth, w.unit);\n      });\n    }\n  };\n  var zero = array => map$1(array, constant(0));\n  var surround = (sizes, startIndex, endIndex, results, f) => f(sizes.slice(0, startIndex)).concat(results).concat(f(sizes.slice(endIndex)));\n  var clampDeltaHelper = predicate => (sizes, index, delta, minCellSize) => {\n    if (!predicate(delta)) {\n      return delta;\n    } else {\n      var newSize = Math.max(minCellSize, sizes[index] - Math.abs(delta));\n      var diff = Math.abs(newSize - sizes[index]);\n      return delta >= 0 ? diff : -diff;\n    }\n  };\n  var clampNegativeDelta = clampDeltaHelper(delta => delta < 0);\n  var clampDelta = clampDeltaHelper(always);\n  var resizeTable = () => {\n    var calcFixedDeltas = (sizes, index, next, delta, minCellSize) => {\n      var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n      return surround(sizes, index, next + 1, [clampedDelta, 0], zero);\n    };\n    var calcRelativeDeltas = (sizes, index, delta, minCellSize) => {\n      var ratio = (100 + delta) / 100;\n      var newThis = Math.max(minCellSize, (sizes[index] + delta) / ratio);\n      return map$1(sizes, (size, idx) => {\n        var newSize = idx === index ? newThis : size / ratio;\n        return newSize - size;\n      });\n    };\n    var calcLeftEdgeDeltas = (sizes, index, next, delta, minCellSize, isRelative) => {\n      if (isRelative) {\n        return calcRelativeDeltas(sizes, index, delta, minCellSize);\n      } else {\n        return calcFixedDeltas(sizes, index, next, delta, minCellSize);\n      }\n    };\n    var calcMiddleDeltas = (sizes, _prev, index, next, delta, minCellSize, isRelative) => calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize, isRelative);\n    var resizeTable = (resizer, delta) => resizer(delta);\n    var calcRightEdgeDeltas = (sizes, _prev, index, delta, minCellSize, isRelative) => {\n      if (isRelative) {\n        return calcRelativeDeltas(sizes, index, delta, minCellSize);\n      } else {\n        var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n        return zero(sizes.slice(0, index)).concat([clampedDelta]);\n      }\n    };\n    var calcRedestributedWidths = (sizes, totalWidth, pixelDelta, isRelative) => {\n      if (isRelative) {\n        var tableWidth = totalWidth + pixelDelta;\n        var ratio = tableWidth / totalWidth;\n        var newSizes = map$1(sizes, size => size / ratio);\n        return {\n          delta: ratio * 100 - 100,\n          newSizes\n        };\n      } else {\n        return {\n          delta: pixelDelta,\n          newSizes: sizes\n        };\n      }\n    };\n    return {\n      resizeTable,\n      clampTableDelta: clampNegativeDelta,\n      calcLeftEdgeDeltas,\n      calcMiddleDeltas,\n      calcRightEdgeDeltas,\n      calcRedestributedWidths\n    };\n  };\n  var preserveTable = () => {\n    var calcLeftEdgeDeltas = (sizes, index, next, delta, minCellSize) => {\n      var idx = delta >= 0 ? next : index;\n      var clampedDelta = clampDelta(sizes, idx, delta, minCellSize);\n      return surround(sizes, index, next + 1, [clampedDelta, -clampedDelta], zero);\n    };\n    var calcMiddleDeltas = (sizes, _prev, index, next, delta, minCellSize) => calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize);\n    var resizeTable = (resizer, delta, isLastColumn) => {\n      if (isLastColumn) {\n        resizer(delta);\n      }\n    };\n    var calcRightEdgeDeltas = (sizes, _prev, _index, delta, _minCellSize, isRelative) => {\n      if (isRelative) {\n        return zero(sizes);\n      } else {\n        var diff = delta / sizes.length;\n        return map$1(sizes, constant(diff));\n      }\n    };\n    var clampTableDelta = (sizes, index, delta, minCellSize, isLastColumn) => {\n      if (isLastColumn) {\n        if (delta >= 0) {\n          return delta;\n        } else {\n          var maxDelta = foldl(sizes, (a, b) => a + b - minCellSize, 0);\n          return Math.max(-maxDelta, delta);\n        }\n      } else {\n        return clampNegativeDelta(sizes, index, delta, minCellSize);\n      }\n    };\n    var calcRedestributedWidths = (sizes, _totalWidth, _pixelDelta, _isRelative) => ({\n      delta: 0,\n      newSizes: sizes\n    });\n    return {\n      resizeTable,\n      clampTableDelta,\n      calcLeftEdgeDeltas,\n      calcMiddleDeltas,\n      calcRightEdgeDeltas,\n      calcRedestributedWidths\n    };\n  };\n  var getGridSize = table => {\n    var warehouse = Warehouse.fromTable(table);\n    return warehouse.grid;\n  };\n  var isHeaderCell = isTag('th');\n  var isHeaderCells = cells => forall(cells, cell => isHeaderCell(cell.element));\n  var getRowHeaderType = (isHeaderRow, isHeaderCells) => {\n    if (isHeaderRow && isHeaderCells) {\n      return 'sectionCells';\n    } else if (isHeaderRow) {\n      return 'section';\n    } else {\n      return 'cells';\n    }\n  };\n  var getRowType = row => {\n    var isHeaderRow = row.section === 'thead';\n    var isHeaderCells = is(findCommonCellType(row.cells), 'th');\n    if (row.section === 'tfoot') {\n      return {\n        type: 'footer'\n      };\n    } else if (isHeaderRow || isHeaderCells) {\n      return {\n        type: 'header',\n        subType: getRowHeaderType(isHeaderRow, isHeaderCells)\n      };\n    } else {\n      return {\n        type: 'body'\n      };\n    }\n  };\n  var findCommonCellType = cells => {\n    var headerCells = filter$2(cells, cell => isHeaderCell(cell.element));\n    if (headerCells.length === 0) {\n      return Optional.some('td');\n    } else if (headerCells.length === cells.length) {\n      return Optional.some('th');\n    } else {\n      return Optional.none();\n    }\n  };\n  var findCommonRowType = rows => {\n    var rowTypes = map$1(rows, row => getRowType(row).type);\n    var hasHeader = contains$2(rowTypes, 'header');\n    var hasFooter = contains$2(rowTypes, 'footer');\n    if (!hasHeader && !hasFooter) {\n      return Optional.some('body');\n    } else {\n      var hasBody = contains$2(rowTypes, 'body');\n      if (hasHeader && !hasBody && !hasFooter) {\n        return Optional.some('header');\n      } else if (!hasHeader && !hasBody && hasFooter) {\n        return Optional.some('footer');\n      } else {\n        return Optional.none();\n      }\n    }\n  };\n  var findTableRowHeaderType = warehouse => findMap(warehouse.all, row => {\n    var rowType = getRowType(row);\n    return rowType.type === 'header' ? Optional.from(rowType.subType) : Optional.none();\n  });\n  var transformCell = (cell, comparator, substitution) => elementnew(substitution(cell.element, comparator), true, cell.isLocked);\n  var _transformRow = (row, section) => row.section !== section ? rowcells(row.element, row.cells, section, row.isNew) : row;\n  var section = () => ({\n    transformRow: _transformRow,\n    transformCell: (cell, comparator, substitution) => {\n      var newCell = substitution(cell.element, comparator);\n      var fixedCell = name(newCell) !== 'td' ? mutate$1(newCell, 'td') : newCell;\n      return elementnew(fixedCell, cell.isNew, cell.isLocked);\n    }\n  });\n  var sectionCells = () => ({\n    transformRow: _transformRow,\n    transformCell\n  });\n  var cells = () => ({\n    transformRow: (row, section) => {\n      var newSection = section === 'thead' ? 'tbody' : section;\n      return _transformRow(row, newSection);\n    },\n    transformCell\n  });\n  var fallback = () => ({\n    transformRow: identity,\n    transformCell\n  });\n  var getTableSectionType = (table, fallback) => {\n    var warehouse = Warehouse.fromTable(table);\n    var type = findTableRowHeaderType(warehouse).getOr(fallback);\n    switch (type) {\n      case 'section':\n        return section();\n      case 'sectionCells':\n        return sectionCells();\n      case 'cells':\n        return cells();\n    }\n  };\n  var TableSection = {\n    getTableSectionType,\n    section,\n    sectionCells,\n    cells,\n    fallback\n  };\n  var setIfNot = (element, property, value, ignore) => {\n    if (value === ignore) {\n      remove$7(element, property);\n    } else {\n      set$2(element, property, value);\n    }\n  };\n  var insert$1 = (table, selector, element) => {\n    last$2(children(table, selector)).fold(() => prepend(table, element), child => after$5(child, element));\n  };\n  var generateSection = (table, sectionName) => {\n    var section = child(table, sectionName).getOrThunk(() => {\n      var newSection = SugarElement.fromTag(sectionName, owner(table).dom);\n      if (sectionName === 'thead') {\n        insert$1(table, 'caption,colgroup', newSection);\n      } else if (sectionName === 'colgroup') {\n        insert$1(table, 'caption', newSection);\n      } else {\n        append$1(table, newSection);\n      }\n      return newSection;\n    });\n    empty(section);\n    return section;\n  };\n  var render$1 = (table, grid) => {\n    var newRows = [];\n    var newCells = [];\n    var syncRows = gridSection => map$1(gridSection, row => {\n      if (row.isNew) {\n        newRows.push(row.element);\n      }\n      var tr = row.element;\n      empty(tr);\n      each$2(row.cells, cell => {\n        if (cell.isNew) {\n          newCells.push(cell.element);\n        }\n        setIfNot(cell.element, 'colspan', cell.colspan, 1);\n        setIfNot(cell.element, 'rowspan', cell.rowspan, 1);\n        append$1(tr, cell.element);\n      });\n      return tr;\n    });\n    var syncColGroup = gridSection => bind$2(gridSection, colGroup => map$1(colGroup.cells, col => {\n      setIfNot(col.element, 'span', col.colspan, 1);\n      return col.element;\n    }));\n    var renderSection = (gridSection, sectionName) => {\n      var section = generateSection(table, sectionName);\n      var sync = sectionName === 'colgroup' ? syncColGroup : syncRows;\n      var sectionElems = sync(gridSection);\n      append(section, sectionElems);\n    };\n    var removeSection = sectionName => {\n      child(table, sectionName).each(remove$6);\n    };\n    var renderOrRemoveSection = (gridSection, sectionName) => {\n      if (gridSection.length > 0) {\n        renderSection(gridSection, sectionName);\n      } else {\n        removeSection(sectionName);\n      }\n    };\n    var headSection = [];\n    var bodySection = [];\n    var footSection = [];\n    var columnGroupsSection = [];\n    each$2(grid, row => {\n      switch (row.section) {\n        case 'thead':\n          headSection.push(row);\n          break;\n        case 'tbody':\n          bodySection.push(row);\n          break;\n        case 'tfoot':\n          footSection.push(row);\n          break;\n        case 'colgroup':\n          columnGroupsSection.push(row);\n          break;\n      }\n    });\n    renderOrRemoveSection(columnGroupsSection, 'colgroup');\n    renderOrRemoveSection(headSection, 'thead');\n    renderOrRemoveSection(bodySection, 'tbody');\n    renderOrRemoveSection(footSection, 'tfoot');\n    return {\n      newRows,\n      newCells\n    };\n  };\n  var copy = grid => map$1(grid, row => {\n    var tr = shallow(row.element);\n    each$2(row.cells, cell => {\n      var clonedCell = deep(cell.element);\n      setIfNot(clonedCell, 'colspan', cell.colspan, 1);\n      setIfNot(clonedCell, 'rowspan', cell.rowspan, 1);\n      append$1(tr, clonedCell);\n    });\n    return tr;\n  });\n  var getColumn = (grid, index) => {\n    return map$1(grid, row => {\n      return getCell(row, index);\n    });\n  };\n  var getRow = (grid, index) => {\n    return grid[index];\n  };\n  var findDiff = (xs, comp) => {\n    if (xs.length === 0) {\n      return 0;\n    }\n    var first = xs[0];\n    var index = findIndex(xs, x => {\n      return !comp(first.element, x.element);\n    });\n    return index.getOr(xs.length);\n  };\n  var subgrid = (grid, row, column, comparator) => {\n    var gridRow = getRow(grid, row);\n    var isColRow = gridRow.section === 'colgroup';\n    var colspan = findDiff(gridRow.cells.slice(column), comparator);\n    var rowspan = isColRow ? 1 : findDiff(getColumn(grid.slice(row), column), comparator);\n    return {\n      colspan,\n      rowspan\n    };\n  };\n  var toDetails = (grid, comparator) => {\n    var seen = map$1(grid, row => map$1(row.cells, never));\n    var updateSeen = (rowIndex, columnIndex, rowspan, colspan) => {\n      for (var _row = rowIndex; _row < rowIndex + rowspan; _row++) {\n        for (var column = columnIndex; column < columnIndex + colspan; column++) {\n          seen[_row][column] = true;\n        }\n      }\n    };\n    return map$1(grid, (row, rowIndex) => {\n      var details = bind$2(row.cells, (cell, columnIndex) => {\n        if (seen[rowIndex][columnIndex] === false) {\n          var result = subgrid(grid, rowIndex, columnIndex, comparator);\n          updateSeen(rowIndex, columnIndex, result.rowspan, result.colspan);\n          return [detailnew(cell.element, result.rowspan, result.colspan, cell.isNew)];\n        } else {\n          return [];\n        }\n      });\n      return rowdetailnew(row.element, details, row.section, row.isNew);\n    });\n  };\n  var toGrid = (warehouse, generators, isNew) => {\n    var grid = [];\n    each$2(warehouse.colgroups, colgroup => {\n      var colgroupCols = [];\n      for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {\n        var element = Warehouse.getColumnAt(warehouse, columnIndex).map(column => elementnew(column.element, isNew, false)).getOrThunk(() => elementnew(generators.colGap(), true, false));\n        colgroupCols.push(element);\n      }\n      grid.push(rowcells(colgroup.element, colgroupCols, 'colgroup', isNew));\n    });\n    for (var rowIndex = 0; rowIndex < warehouse.grid.rows; rowIndex++) {\n      var rowCells = [];\n      for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {\n        var element = Warehouse.getAt(warehouse, rowIndex, columnIndex).map(item => elementnew(item.element, isNew, item.isLocked)).getOrThunk(() => elementnew(generators.gap(), true, false));\n        rowCells.push(element);\n      }\n      var rowDetail = warehouse.all[rowIndex];\n      var _row2 = rowcells(rowDetail.element, rowCells, rowDetail.section, isNew);\n      grid.push(_row2);\n    }\n    return grid;\n  };\n  var fromWarehouse = (warehouse, generators) => toGrid(warehouse, generators, false);\n  var toDetailList = grid => toDetails(grid, eq$1);\n  var findInWarehouse = (warehouse, element) => findMap(warehouse.all, r => find$1(r.cells, e => eq$1(element, e.element)));\n  var extractCells = (warehouse, target, predicate) => {\n    var details = map$1(target.selection, cell$1 => {\n      return cell(cell$1).bind(lc => findInWarehouse(warehouse, lc)).filter(predicate);\n    });\n    var cells = cat(details);\n    return someIf(cells.length > 0, cells);\n  };\n  var run = (operation, extract, adjustment, postAction, genWrappers) => (table, target, generators, behaviours) => {\n    var warehouse = Warehouse.fromTable(table);\n    var tableSection = Optional.from(behaviours === null || behaviours === void 0 ? void 0 : behaviours.section).getOrThunk(TableSection.fallback);\n    var output = extract(warehouse, target).map(info => {\n      var model = fromWarehouse(warehouse, generators);\n      var result = operation(model, info, eq$1, genWrappers(generators), tableSection);\n      var lockedColumns = getLockedColumnsFromGrid(result.grid);\n      var grid = toDetailList(result.grid);\n      return {\n        info,\n        grid,\n        cursor: result.cursor,\n        lockedColumns\n      };\n    });\n    return output.bind(out => {\n      var newElements = render$1(table, out.grid);\n      var tableSizing = Optional.from(behaviours === null || behaviours === void 0 ? void 0 : behaviours.sizing).getOrThunk(() => TableSize.getTableSize(table));\n      var resizing = Optional.from(behaviours === null || behaviours === void 0 ? void 0 : behaviours.resize).getOrThunk(preserveTable);\n      adjustment(table, out.grid, out.info, {\n        sizing: tableSizing,\n        resize: resizing,\n        section: tableSection\n      });\n      postAction(table);\n      remove$7(table, LOCKED_COL_ATTR);\n      if (out.lockedColumns.length > 0) {\n        set$2(table, LOCKED_COL_ATTR, out.lockedColumns.join(','));\n      }\n      return Optional.some({\n        cursor: out.cursor,\n        newRows: newElements.newRows,\n        newCells: newElements.newCells\n      });\n    });\n  };\n  var onPaste = (warehouse, target) => cell(target.element).bind(cell => findInWarehouse(warehouse, cell).map(details => {\n    var value = _objectSpread(_objectSpread({}, details), {}, {\n      generators: target.generators,\n      clipboard: target.clipboard\n    });\n    return value;\n  }));\n  var onPasteByEditor = (warehouse, target) => extractCells(warehouse, target, always).map(cells => ({\n    cells,\n    generators: target.generators,\n    clipboard: target.clipboard\n  }));\n  var onMergable = (_warehouse, target) => target.mergable;\n  var onUnmergable = (_warehouse, target) => target.unmergable;\n  var onCells = (warehouse, target) => extractCells(warehouse, target, always);\n  var onUnlockedCells = (warehouse, target) => extractCells(warehouse, target, detail => !detail.isLocked);\n  var isUnlockedTableCell = (warehouse, cell) => findInWarehouse(warehouse, cell).exists(detail => !detail.isLocked);\n  var allUnlocked = (warehouse, cells) => forall(cells, cell => isUnlockedTableCell(warehouse, cell));\n  var onUnlockedMergable = (warehouse, target) => onMergable(warehouse, target).filter(mergeable => allUnlocked(warehouse, mergeable.cells));\n  var onUnlockedUnmergable = (warehouse, target) => onUnmergable(warehouse, target).filter(cells => allUnlocked(warehouse, cells));\n  var merge$2 = (grid, bounds, comparator, substitution) => {\n    var rows = extractGridDetails(grid).rows;\n    if (rows.length === 0) {\n      return grid;\n    }\n    for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n      for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n        var _row3 = rows[i];\n        var isLocked = getCell(_row3, j).isLocked;\n        mutateCell(_row3, j, elementnew(substitution(), false, isLocked));\n      }\n    }\n    return grid;\n  };\n  var unmerge = (grid, target, comparator, substitution) => {\n    var rows = extractGridDetails(grid).rows;\n    var first = true;\n    for (var i = 0; i < rows.length; i++) {\n      for (var j = 0; j < cellLength(rows[0]); j++) {\n        var _row4 = rows[i];\n        var currentCell = getCell(_row4, j);\n        var currentCellElm = currentCell.element;\n        var isToReplace = comparator(currentCellElm, target);\n        if (isToReplace && !first) {\n          mutateCell(_row4, j, elementnew(substitution(), true, currentCell.isLocked));\n        } else if (isToReplace) {\n          first = false;\n        }\n      }\n    }\n    return grid;\n  };\n  var uniqueCells = (row, comparator) => {\n    return foldl(row, (rest, cell) => {\n      return exists(rest, currentCell => {\n        return comparator(currentCell.element, cell.element);\n      }) ? rest : rest.concat([cell]);\n    }, []);\n  };\n  var splitCols = (grid, index, comparator, substitution) => {\n    if (index > 0 && index < grid[0].cells.length) {\n      each$2(grid, row => {\n        var prevCell = row.cells[index - 1];\n        var offset = 0;\n        var substitute = substitution();\n        while (row.cells.length > index + offset && comparator(prevCell.element, row.cells[index + offset].element)) {\n          mutateCell(row, index + offset, elementnew(substitute, true, row.cells[index + offset].isLocked));\n          offset++;\n        }\n      });\n    }\n    return grid;\n  };\n  var splitRows = (grid, index, comparator, substitution) => {\n    var rows = extractGridDetails(grid).rows;\n    if (index > 0 && index < rows.length) {\n      var rowPrevCells = rows[index - 1].cells;\n      var _cells4 = uniqueCells(rowPrevCells, comparator);\n      each$2(_cells4, cell => {\n        var replacement = Optional.none();\n        for (var i = index; i < rows.length; i++) {\n          var _loop = function _loop(j) {\n            var row = rows[i];\n            var current = getCell(row, j);\n            var isToReplace = comparator(current.element, cell.element);\n            if (isToReplace) {\n              if (replacement.isNone()) {\n                replacement = Optional.some(substitution());\n              }\n              replacement.each(sub => {\n                mutateCell(row, j, elementnew(sub, true, current.isLocked));\n              });\n            }\n          };\n          for (var j = 0; j < cellLength(rows[0]); j++) {\n            _loop(j);\n          }\n        }\n      });\n    }\n    return grid;\n  };\n  var value$1 = value => {\n    var applyHelper = fn => fn(value);\n    var constHelper = constant(value);\n    var outputHelper = () => output;\n    var output = {\n      tag: true,\n      inner: value,\n      fold: (_onError, onValue) => onValue(value),\n      isValue: always,\n      isError: never,\n      map: mapper => Result.value(mapper(value)),\n      mapError: outputHelper,\n      bind: applyHelper,\n      exists: applyHelper,\n      forall: applyHelper,\n      getOr: constHelper,\n      or: outputHelper,\n      getOrThunk: constHelper,\n      orThunk: outputHelper,\n      getOrDie: constHelper,\n      each: fn => {\n        fn(value);\n      },\n      toOptional: () => Optional.some(value)\n    };\n    return output;\n  };\n  var error = error => {\n    var outputHelper = () => output;\n    var output = {\n      tag: false,\n      inner: error,\n      fold: (onError, _onValue) => onError(error),\n      isValue: never,\n      isError: always,\n      map: outputHelper,\n      mapError: mapper => Result.error(mapper(error)),\n      bind: outputHelper,\n      exists: never,\n      forall: always,\n      getOr: identity,\n      or: identity,\n      getOrThunk: apply,\n      orThunk: apply,\n      getOrDie: die(String(error)),\n      each: noop,\n      toOptional: Optional.none\n    };\n    return output;\n  };\n  var fromOption = (optional, err) => optional.fold(() => error(err), value$1);\n  var Result = {\n    value: value$1,\n    error,\n    fromOption\n  };\n  var measure = (startAddress, gridA, gridB) => {\n    if (startAddress.row >= gridA.length || startAddress.column > cellLength(gridA[0])) {\n      return Result.error('invalid start address out of table bounds, row: ' + startAddress.row + ', column: ' + startAddress.column);\n    }\n    var rowRemainder = gridA.slice(startAddress.row);\n    var colRemainder = rowRemainder[0].cells.slice(startAddress.column);\n    var colRequired = cellLength(gridB[0]);\n    var rowRequired = gridB.length;\n    return Result.value({\n      rowDelta: rowRemainder.length - rowRequired,\n      colDelta: colRemainder.length - colRequired\n    });\n  };\n  var measureWidth = (gridA, gridB) => {\n    var colLengthA = cellLength(gridA[0]);\n    var colLengthB = cellLength(gridB[0]);\n    return {\n      rowDelta: 0,\n      colDelta: colLengthA - colLengthB\n    };\n  };\n  var measureHeight = (gridA, gridB) => {\n    var rowLengthA = gridA.length;\n    var rowLengthB = gridB.length;\n    return {\n      rowDelta: rowLengthA - rowLengthB,\n      colDelta: 0\n    };\n  };\n  var generateElements = (amount, row, generators, isLocked) => {\n    var generator = row.section === 'colgroup' ? generators.col : generators.cell;\n    return range$1(amount, idx => elementnew(generator(), true, isLocked(idx)));\n  };\n  var rowFill = (grid, amount, generators, lockedColumns) => {\n    var exampleRow = grid[grid.length - 1];\n    return grid.concat(range$1(amount, () => {\n      var generator = exampleRow.section === 'colgroup' ? generators.colgroup : generators.row;\n      var row = clone(exampleRow, generator, identity);\n      var elements = generateElements(row.cells.length, row, generators, idx => has$1(lockedColumns, idx.toString()));\n      return setCells(row, elements);\n    }));\n  };\n  var colFill = (grid, amount, generators, startIndex) => map$1(grid, row => {\n    var newChildren = generateElements(amount, row, generators, never);\n    return addCells(row, startIndex, newChildren);\n  });\n  var lockedColFill = (grid, generators, lockedColumns) => map$1(grid, row => {\n    return foldl(lockedColumns, (acc, colNum) => {\n      var newChild = generateElements(1, row, generators, always)[0];\n      return addCell(acc, colNum, newChild);\n    }, row);\n  });\n  var tailor = (gridA, delta, generators) => {\n    var fillCols = delta.colDelta < 0 ? colFill : identity;\n    var fillRows = delta.rowDelta < 0 ? rowFill : identity;\n    var lockedColumns = getLockedColumnsFromGrid(gridA);\n    var gridWidth = cellLength(gridA[0]);\n    var isLastColLocked = exists(lockedColumns, locked => locked === gridWidth - 1);\n    var modifiedCols = fillCols(gridA, Math.abs(delta.colDelta), generators, isLastColLocked ? gridWidth - 1 : gridWidth);\n    var newLockedColumns = getLockedColumnsFromGrid(modifiedCols);\n    return fillRows(modifiedCols, Math.abs(delta.rowDelta), generators, mapToObject(newLockedColumns, always));\n  };\n  var isSpanning = (grid, row, col, comparator) => {\n    var candidate = getCell(grid[row], col);\n    var matching = curry(comparator, candidate.element);\n    var currentRow = grid[row];\n    return grid.length > 1 && cellLength(currentRow) > 1 && (col > 0 && matching(getCellElement(currentRow, col - 1)) || col < currentRow.cells.length - 1 && matching(getCellElement(currentRow, col + 1)) || row > 0 && matching(getCellElement(grid[row - 1], col)) || row < grid.length - 1 && matching(getCellElement(grid[row + 1], col)));\n  };\n  var mergeTables = (startAddress, gridA, gridBRows, generator, comparator, lockedColumns) => {\n    var startRow = startAddress.row;\n    var startCol = startAddress.column;\n    var mergeHeight = gridBRows.length;\n    var mergeWidth = cellLength(gridBRows[0]);\n    var endRow = startRow + mergeHeight;\n    var endCol = startCol + mergeWidth + lockedColumns.length;\n    var lockedColumnObj = mapToObject(lockedColumns, always);\n    for (var _r2 = startRow; _r2 < endRow; _r2++) {\n      var skippedCol = 0;\n      for (var c = startCol; c < endCol; c++) {\n        if (lockedColumnObj[c]) {\n          skippedCol++;\n          continue;\n        }\n        if (isSpanning(gridA, _r2, c, comparator)) {\n          unmerge(gridA, getCellElement(gridA[_r2], c), comparator, generator.cell);\n        }\n        var gridBColIndex = c - startCol - skippedCol;\n        var newCell = getCell(gridBRows[_r2 - startRow], gridBColIndex);\n        var newCellElm = newCell.element;\n        var replacement = generator.replace(newCellElm);\n        mutateCell(gridA[_r2], c, elementnew(replacement, true, newCell.isLocked));\n      }\n    }\n    return gridA;\n  };\n  var getValidStartAddress = (currentStartAddress, grid, lockedColumns) => {\n    var gridColLength = cellLength(grid[0]);\n    var adjustedRowAddress = extractGridDetails(grid).cols.length + currentStartAddress.row;\n    var possibleColAddresses = range$1(gridColLength - currentStartAddress.column, num => num + currentStartAddress.column);\n    var validColAddress = find$1(possibleColAddresses, num => forall(lockedColumns, col => col !== num)).getOr(gridColLength - 1);\n    return {\n      row: adjustedRowAddress,\n      column: validColAddress\n    };\n  };\n  var getLockedColumnsWithinBounds = (startAddress, rows, lockedColumns) => filter$2(lockedColumns, colNum => colNum >= startAddress.column && colNum <= cellLength(rows[0]) + startAddress.column);\n  var merge$1 = (startAddress, gridA, gridB, generator, comparator) => {\n    var lockedColumns = getLockedColumnsFromGrid(gridA);\n    var validStartAddress = getValidStartAddress(startAddress, gridA, lockedColumns);\n    var gridBRows = extractGridDetails(gridB).rows;\n    var lockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, lockedColumns);\n    var result = measure(validStartAddress, gridA, gridBRows);\n    return result.map(diff => {\n      var delta = _objectSpread(_objectSpread({}, diff), {}, {\n        colDelta: diff.colDelta - lockedColumnsWithinBounds.length\n      });\n      var fittedGrid = tailor(gridA, delta, generator);\n      var newLockedColumns = getLockedColumnsFromGrid(fittedGrid);\n      var newLockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, newLockedColumns);\n      return mergeTables(validStartAddress, fittedGrid, gridBRows, generator, comparator, newLockedColumnsWithinBounds);\n    });\n  };\n  var insertCols = (index, gridA, gridB, generator, comparator) => {\n    splitCols(gridA, index, comparator, generator.cell);\n    var delta = measureHeight(gridB, gridA);\n    var fittedNewGrid = tailor(gridB, delta, generator);\n    var secondDelta = measureHeight(gridA, fittedNewGrid);\n    var fittedOldGrid = tailor(gridA, secondDelta, generator);\n    return map$1(fittedOldGrid, (gridRow, i) => {\n      return addCells(gridRow, index, fittedNewGrid[i].cells);\n    });\n  };\n  var insertRows = (index, gridA, gridB, generator, comparator) => {\n    splitRows(gridA, index, comparator, generator.cell);\n    var locked = getLockedColumnsFromGrid(gridA);\n    var diff = measureWidth(gridA, gridB);\n    var delta = _objectSpread(_objectSpread({}, diff), {}, {\n      colDelta: diff.colDelta - locked.length\n    });\n    var fittedOldGrid = tailor(gridA, delta, generator);\n    var {\n      cols: oldCols,\n      rows: oldRows\n    } = extractGridDetails(fittedOldGrid);\n    var newLocked = getLockedColumnsFromGrid(fittedOldGrid);\n    var secondDiff = measureWidth(gridB, gridA);\n    var secondDelta = _objectSpread(_objectSpread({}, secondDiff), {}, {\n      colDelta: secondDiff.colDelta + newLocked.length\n    });\n    var fittedGridB = lockedColFill(gridB, generator, newLocked);\n    var fittedNewGrid = tailor(fittedGridB, secondDelta, generator);\n    return [...oldCols, ...oldRows.slice(0, index), ...fittedNewGrid, ...oldRows.slice(index, oldRows.length)];\n  };\n  var cloneRow = (row, cloneCell, comparator, substitution) => clone(row, elem => substitution(elem, comparator), cloneCell);\n  var insertRowAt = (grid, index, example, comparator, substitution) => {\n    var {\n      rows,\n      cols\n    } = extractGridDetails(grid);\n    var before = rows.slice(0, index);\n    var after = rows.slice(index);\n    var newRow = cloneRow(rows[example], (ex, c) => {\n      var withinSpan = index > 0 && index < rows.length && comparator(getCellElement(rows[index - 1], c), getCellElement(rows[index], c));\n      var ret = withinSpan ? getCell(rows[index], c) : elementnew(substitution(ex.element, comparator), true, ex.isLocked);\n      return ret;\n    }, comparator, substitution);\n    return [...cols, ...before, newRow, ...after];\n  };\n  var getElementFor = (row, column, section, withinSpan, example, comparator, substitution) => {\n    if (section === 'colgroup' || !withinSpan) {\n      var _cell3 = getCell(row, example);\n      return elementnew(substitution(_cell3.element, comparator), true, false);\n    } else {\n      return getCell(row, column);\n    }\n  };\n  var insertColumnAt = (grid, index, example, comparator, substitution) => map$1(grid, row => {\n    var withinSpan = index > 0 && index < cellLength(row) && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n    var sub = getElementFor(row, index, row.section, withinSpan, example, comparator, substitution);\n    return addCell(row, index, sub);\n  });\n  var deleteColumnsAt = (grid, columns) => bind$2(grid, row => {\n    var existingCells = row.cells;\n    var cells = foldr(columns, (acc, column) => column >= 0 && column < acc.length ? acc.slice(0, column).concat(acc.slice(column + 1)) : acc, existingCells);\n    return cells.length > 0 ? [rowcells(row.element, cells, row.section, row.isNew)] : [];\n  });\n  var deleteRowsAt = (grid, start, finish) => {\n    var {\n      rows,\n      cols\n    } = extractGridDetails(grid);\n    return [...cols, ...rows.slice(0, start), ...rows.slice(finish + 1)];\n  };\n  var notInStartRow = (grid, rowIndex, colIndex, comparator) => getCellElement(grid[rowIndex], colIndex) !== undefined && rowIndex > 0 && comparator(getCellElement(grid[rowIndex - 1], colIndex), getCellElement(grid[rowIndex], colIndex));\n  var notInStartColumn = (row, index, comparator) => index > 0 && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n  var isDuplicatedCell = (grid, rowIndex, colIndex, comparator) => notInStartRow(grid, rowIndex, colIndex, comparator) || notInStartColumn(grid[rowIndex], colIndex, comparator);\n  var rowReplacerPredicate = (targetRow, columnHeaders) => {\n    var entireTableIsHeader = forall(columnHeaders, identity) && isHeaderCells(targetRow.cells);\n    return entireTableIsHeader ? always : (cell, _rowIndex, colIndex) => {\n      var type = name(cell.element);\n      return !(type === 'th' && columnHeaders[colIndex]);\n    };\n  };\n  var columnReplacePredicate = (targetColumn, rowHeaders) => {\n    var entireTableIsHeader = forall(rowHeaders, identity) && isHeaderCells(targetColumn);\n    return entireTableIsHeader ? always : (cell, rowIndex, _colIndex) => {\n      var type = name(cell.element);\n      return !(type === 'th' && rowHeaders[rowIndex]);\n    };\n  };\n  var determineScope = (applyScope, cell, newScope, isInHeader) => {\n    var hasSpan = scope => scope === 'row' ? hasRowspan(cell) : hasColspan(cell);\n    var getScope = scope => hasSpan(scope) ? \"\".concat(scope, \"group\") : scope;\n    if (applyScope) {\n      return isHeaderCell(cell) ? getScope(newScope) : null;\n    } else if (isInHeader && isHeaderCell(cell)) {\n      var oppositeScope = newScope === 'row' ? 'col' : 'row';\n      return getScope(oppositeScope);\n    } else {\n      return null;\n    }\n  };\n  var rowScopeGenerator = (applyScope, columnHeaders) => (cell, rowIndex, columnIndex) => Optional.some(determineScope(applyScope, cell.element, 'col', columnHeaders[columnIndex]));\n  var columnScopeGenerator = (applyScope, rowHeaders) => (cell, rowIndex) => Optional.some(determineScope(applyScope, cell.element, 'row', rowHeaders[rowIndex]));\n  var replace = (cell, comparator, substitute) => elementnew(substitute(cell.element, comparator), true, cell.isLocked);\n  var replaceIn = (grid, targets, comparator, substitute, replacer, genScope, shouldReplace) => {\n    var isTarget = cell => {\n      return exists(targets, target => {\n        return comparator(cell.element, target.element);\n      });\n    };\n    return map$1(grid, (row, rowIndex) => {\n      return mapCells(row, (cell, colIndex) => {\n        if (isTarget(cell)) {\n          var newCell = shouldReplace(cell, rowIndex, colIndex) ? replacer(cell, comparator, substitute) : cell;\n          genScope(newCell, rowIndex, colIndex).each(scope => {\n            setOptions(newCell.element, {\n              scope: Optional.from(scope)\n            });\n          });\n          return newCell;\n        } else {\n          return cell;\n        }\n      });\n    });\n  };\n  var getColumnCells = (rows, columnIndex, comparator) => bind$2(rows, (row, i) => {\n    return isDuplicatedCell(rows, i, columnIndex, comparator) ? [] : [getCell(row, columnIndex)];\n  });\n  var getRowCells = (rows, rowIndex, comparator) => {\n    var targetRow = rows[rowIndex];\n    return bind$2(targetRow.cells, (item, i) => {\n      return isDuplicatedCell(rows, rowIndex, i, comparator) ? [] : [item];\n    });\n  };\n  var replaceColumns = (grid, indexes, applyScope, comparator, substitution) => {\n    var rows = extractGridDetails(grid).rows;\n    var targets = bind$2(indexes, index => getColumnCells(rows, index, comparator));\n    var rowHeaders = map$1(rows, row => isHeaderCells(row.cells));\n    var shouldReplaceCell = columnReplacePredicate(targets, rowHeaders);\n    var scopeGenerator = columnScopeGenerator(applyScope, rowHeaders);\n    return replaceIn(grid, targets, comparator, substitution, replace, scopeGenerator, shouldReplaceCell);\n  };\n  var replaceRows = (grid, indexes, section, applyScope, comparator, substitution, tableSection) => {\n    var {\n      cols,\n      rows\n    } = extractGridDetails(grid);\n    var targetRow = rows[indexes[0]];\n    var targets = bind$2(indexes, index => getRowCells(rows, index, comparator));\n    var columnHeaders = map$1(targetRow.cells, (_cell, index) => isHeaderCells(getColumnCells(rows, index, comparator)));\n    var newRows = [...rows];\n    each$2(indexes, index => {\n      newRows[index] = tableSection.transformRow(rows[index], section);\n    });\n    var newGrid = [...cols, ...newRows];\n    var shouldReplaceCell = rowReplacerPredicate(targetRow, columnHeaders);\n    var scopeGenerator = rowScopeGenerator(applyScope, columnHeaders);\n    return replaceIn(newGrid, targets, comparator, substitution, tableSection.transformCell, scopeGenerator, shouldReplaceCell);\n  };\n  var replaceCells = (grid, details, comparator, substitution) => {\n    var rows = extractGridDetails(grid).rows;\n    var targetCells = map$1(details, detail => getCell(rows[detail.row], detail.column));\n    return replaceIn(grid, targetCells, comparator, substitution, replace, Optional.none, always);\n  };\n  var generate = cases => {\n    if (!isArray(cases)) {\n      throw new Error('cases must be an array');\n    }\n    if (cases.length === 0) {\n      throw new Error('there must be at least one case');\n    }\n    var constructors = [];\n    var adt = {};\n    each$2(cases, (acase, count) => {\n      var keys$1 = keys(acase);\n      if (keys$1.length !== 1) {\n        throw new Error('one and only one name per case');\n      }\n      var key = keys$1[0];\n      var value = acase[key];\n      if (adt[key] !== undefined) {\n        throw new Error('duplicate key detected:' + key);\n      } else if (key === 'cata') {\n        throw new Error('cannot have a case named cata (sorry)');\n      } else if (!isArray(value)) {\n        throw new Error('case arguments must be an array');\n      }\n      constructors.push(key);\n      adt[key] = function () {\n        for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n          args[_key5] = arguments[_key5];\n        }\n        var argLength = args.length;\n        if (argLength !== value.length) {\n          throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n        }\n        var match = branches => {\n          var branchKeys = keys(branches);\n          if (constructors.length !== branchKeys.length) {\n            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n          }\n          var allReqd = forall(constructors, reqKey => {\n            return contains$2(branchKeys, reqKey);\n          });\n          if (!allReqd) {\n            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n          }\n          return branches[key].apply(null, args);\n        };\n        return {\n          fold: function fold() {\n            for (var _len6 = arguments.length, foldArgs = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n              foldArgs[_key6] = arguments[_key6];\n            }\n            if (foldArgs.length !== cases.length) {\n              throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + foldArgs.length);\n            }\n            var target = foldArgs[count];\n            return target.apply(null, args);\n          },\n          match,\n          log: label => {\n            console.log(label, {\n              constructors,\n              constructor: key,\n              params: args\n            });\n          }\n        };\n      };\n    });\n    return adt;\n  };\n  var Adt = {\n    generate\n  };\n  var adt$6 = Adt.generate([{\n    none: []\n  }, {\n    only: ['index']\n  }, {\n    left: ['index', 'next']\n  }, {\n    middle: ['prev', 'index', 'next']\n  }, {\n    right: ['prev', 'index']\n  }]);\n  var ColumnContext = _objectSpread({}, adt$6);\n  var neighbours = (input, index) => {\n    if (input.length === 0) {\n      return ColumnContext.none();\n    }\n    if (input.length === 1) {\n      return ColumnContext.only(0);\n    }\n    if (index === 0) {\n      return ColumnContext.left(0, 1);\n    }\n    if (index === input.length - 1) {\n      return ColumnContext.right(index - 1, index);\n    }\n    if (index > 0 && index < input.length - 1) {\n      return ColumnContext.middle(index - 1, index, index + 1);\n    }\n    return ColumnContext.none();\n  };\n  var determine = (input, column, step, tableSize, resize) => {\n    var result = input.slice(0);\n    var context = neighbours(input, column);\n    var onNone = constant(map$1(result, constant(0)));\n    var onOnly = index => tableSize.singleColumnWidth(result[index], step);\n    var onLeft = (index, next) => resize.calcLeftEdgeDeltas(result, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n    var onMiddle = (prev, index, next) => resize.calcMiddleDeltas(result, prev, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n    var onRight = (prev, index) => resize.calcRightEdgeDeltas(result, prev, index, step, tableSize.minCellWidth(), tableSize.isRelative);\n    return context.fold(onNone, onOnly, onLeft, onMiddle, onRight);\n  };\n  var total = (start, end, measures) => {\n    var r = 0;\n    for (var i = start; i < end; i++) {\n      r += measures[i] !== undefined ? measures[i] : 0;\n    }\n    return r;\n  };\n  var recalculateWidthForCells = (warehouse, widths) => {\n    var all = Warehouse.justCells(warehouse);\n    return map$1(all, cell => {\n      var width = total(cell.column, cell.column + cell.colspan, widths);\n      return {\n        element: cell.element,\n        width,\n        colspan: cell.colspan\n      };\n    });\n  };\n  var recalculateWidthForColumns = (warehouse, widths) => {\n    var groups = Warehouse.justColumns(warehouse);\n    return map$1(groups, (column, index) => ({\n      element: column.element,\n      width: widths[index],\n      colspan: column.colspan\n    }));\n  };\n  var recalculateHeightForCells = (warehouse, heights) => {\n    var all = Warehouse.justCells(warehouse);\n    return map$1(all, cell => {\n      var height = total(cell.row, cell.row + cell.rowspan, heights);\n      return {\n        element: cell.element,\n        height,\n        rowspan: cell.rowspan\n      };\n    });\n  };\n  var matchRowHeight = (warehouse, heights) => {\n    return map$1(warehouse.all, (row, i) => {\n      return {\n        element: row.element,\n        height: heights[i]\n      };\n    });\n  };\n  var sumUp = newSize => foldr(newSize, (b, a) => b + a, 0);\n  var recalculate = (warehouse, widths) => {\n    if (Warehouse.hasColumns(warehouse)) {\n      return recalculateWidthForColumns(warehouse, widths);\n    } else {\n      return recalculateWidthForCells(warehouse, widths);\n    }\n  };\n  var recalculateAndApply = (warehouse, widths, tableSize) => {\n    var newSizes = recalculate(warehouse, widths);\n    each$2(newSizes, cell => {\n      tableSize.setElementWidth(cell.element, cell.width);\n    });\n  };\n  var adjustWidth = (table, delta, index, resizing, tableSize) => {\n    var warehouse = Warehouse.fromTable(table);\n    var step = tableSize.getCellDelta(delta);\n    var widths = tableSize.getWidths(warehouse, tableSize);\n    var isLastColumn = index === warehouse.grid.columns - 1;\n    var clampedStep = resizing.clampTableDelta(widths, index, step, tableSize.minCellWidth(), isLastColumn);\n    var deltas = determine(widths, index, clampedStep, tableSize, resizing);\n    var newWidths = map$1(deltas, (dx, i) => dx + widths[i]);\n    recalculateAndApply(warehouse, newWidths, tableSize);\n    resizing.resizeTable(tableSize.adjustTableWidth, clampedStep, isLastColumn);\n  };\n  var adjustHeight = (table, delta, index, direction) => {\n    var warehouse = Warehouse.fromTable(table);\n    var heights = getPixelHeights(warehouse, table, direction);\n    var newHeights = map$1(heights, (dy, i) => index === i ? Math.max(delta + dy, minHeight()) : dy);\n    var newCellSizes = recalculateHeightForCells(warehouse, newHeights);\n    var newRowSizes = matchRowHeight(warehouse, newHeights);\n    each$2(newRowSizes, row => {\n      setHeight(row.element, row.height);\n    });\n    each$2(newCellSizes, cell => {\n      setHeight(cell.element, cell.height);\n    });\n    var total = sumUp(newHeights);\n    setHeight(table, total);\n  };\n  var adjustAndRedistributeWidths$1 = (_table, list, details, tableSize, resizeBehaviour) => {\n    var warehouse = Warehouse.generate(list);\n    var sizes = tableSize.getWidths(warehouse, tableSize);\n    var tablePixelWidth = tableSize.pixelWidth();\n    var {\n      newSizes,\n      delta\n    } = resizeBehaviour.calcRedestributedWidths(sizes, tablePixelWidth, details.pixelDelta, tableSize.isRelative);\n    recalculateAndApply(warehouse, newSizes, tableSize);\n    tableSize.adjustTableWidth(delta);\n  };\n  var adjustWidthTo = (_table, list, _info, tableSize) => {\n    var warehouse = Warehouse.generate(list);\n    var widths = tableSize.getWidths(warehouse, tableSize);\n    recalculateAndApply(warehouse, widths, tableSize);\n  };\n  var uniqueColumns = details => {\n    var uniqueCheck = (rest, detail) => {\n      var columnExists = exists(rest, currentDetail => currentDetail.column === detail.column);\n      return columnExists ? rest : rest.concat([detail]);\n    };\n    return foldl(details, uniqueCheck, []).sort((detailA, detailB) => detailA.column - detailB.column);\n  };\n  var isCol = isTag('col');\n  var isColgroup = isTag('colgroup');\n  var isRow$1 = element => name(element) === 'tr' || isColgroup(element);\n  var elementToData = element => {\n    var colspan = getAttrValue(element, 'colspan', 1);\n    var rowspan = getAttrValue(element, 'rowspan', 1);\n    return {\n      element,\n      colspan,\n      rowspan\n    };\n  };\n  var modification = function modification(generators) {\n    var toData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : elementToData;\n    var nuCell = data => isCol(data.element) ? generators.col(data) : generators.cell(data);\n    var nuRow = data => isColgroup(data.element) ? generators.colgroup(data) : generators.row(data);\n    var add = element => {\n      if (isRow$1(element)) {\n        return nuRow({\n          element\n        });\n      } else {\n        var _cell4 = element;\n        var replacement = nuCell(toData(_cell4));\n        recent = Optional.some({\n          item: _cell4,\n          replacement\n        });\n        return replacement;\n      }\n    };\n    var recent = Optional.none();\n    var getOrInit = (element, comparator) => {\n      return recent.fold(() => {\n        return add(element);\n      }, p => {\n        return comparator(element, p.item) ? p.replacement : add(element);\n      });\n    };\n    return {\n      getOrInit\n    };\n  };\n  var transform$1 = tag => {\n    return generators => {\n      var list = [];\n      var find = (element, comparator) => {\n        return find$1(list, x => {\n          return comparator(x.item, element);\n        });\n      };\n      var makeNew = element => {\n        var attrs = tag === 'td' ? {\n          scope: null\n        } : {};\n        var cell = generators.replace(element, tag, attrs);\n        list.push({\n          item: element,\n          sub: cell\n        });\n        return cell;\n      };\n      var replaceOrInit = (element, comparator) => {\n        if (isRow$1(element) || isCol(element)) {\n          return element;\n        } else {\n          var _cell5 = element;\n          return find(_cell5, comparator).fold(() => {\n            return makeNew(_cell5);\n          }, p => {\n            return comparator(element, p.item) ? p.sub : makeNew(_cell5);\n          });\n        }\n      };\n      return {\n        replaceOrInit\n      };\n    };\n  };\n  var getScopeAttribute = cell => getOpt(cell, 'scope').map(attribute => attribute.substr(0, 3));\n  var merging = generators => {\n    var unmerge = cell => {\n      var scope = getScopeAttribute(cell);\n      scope.each(attribute => set$2(cell, 'scope', attribute));\n      return () => {\n        var raw = generators.cell({\n          element: cell,\n          colspan: 1,\n          rowspan: 1\n        });\n        remove$5(raw, 'width');\n        remove$5(cell, 'width');\n        scope.each(attribute => set$2(raw, 'scope', attribute));\n        return raw;\n      };\n    };\n    var merge = cells => {\n      var getScopeProperty = () => {\n        var stringAttributes = cat(map$1(cells, getScopeAttribute));\n        if (stringAttributes.length === 0) {\n          return Optional.none();\n        } else {\n          var baseScope = stringAttributes[0];\n          var scopes = ['row', 'col'];\n          var isMixed = exists(stringAttributes, attribute => {\n            return attribute !== baseScope && contains$2(scopes, attribute);\n          });\n          return isMixed ? Optional.none() : Optional.from(baseScope);\n        }\n      };\n      remove$5(cells[0], 'width');\n      getScopeProperty().fold(() => remove$7(cells[0], 'scope'), attribute => set$2(cells[0], 'scope', attribute + 'group'));\n      return constant(cells[0]);\n    };\n    return {\n      unmerge,\n      merge\n    };\n  };\n  var Generators = {\n    modification,\n    transform: transform$1,\n    merging\n  };\n  var blockList = ['body', 'p', 'div', 'article', 'aside', 'figcaption', 'figure', 'footer', 'header', 'nav', 'section', 'ol', 'ul', 'table', 'thead', 'tfoot', 'tbody', 'caption', 'tr', 'td', 'th', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'address'];\n  var isList$1 = (universe, item) => {\n    var tagName = universe.property().name(item);\n    return contains$2(['ol', 'ul'], tagName);\n  };\n  var isBlock$1 = (universe, item) => {\n    var tagName = universe.property().name(item);\n    return contains$2(blockList, tagName);\n  };\n  var isEmptyTag$1 = (universe, item) => {\n    return contains$2(['br', 'img', 'hr', 'input'], universe.property().name(item));\n  };\n  var universe$1 = DomUniverse();\n  var isBlock = element => {\n    return isBlock$1(universe$1, element);\n  };\n  var isList = element => {\n    return isList$1(universe$1, element);\n  };\n  var isEmptyTag = element => {\n    return isEmptyTag$1(universe$1, element);\n  };\n  var merge = cells => {\n    var isBr = isTag('br');\n    var advancedBr = children => {\n      return forall(children, c => {\n        return isBr(c) || isText(c) && get$6(c).trim().length === 0;\n      });\n    };\n    var isListItem = el => {\n      return name(el) === 'li' || ancestor$2(el, isList).isSome();\n    };\n    var siblingIsBlock = el => {\n      return nextSibling(el).map(rightSibling => {\n        if (isBlock(rightSibling)) {\n          return true;\n        }\n        if (isEmptyTag(rightSibling)) {\n          return name(rightSibling) === 'img' ? false : true;\n        }\n        return false;\n      }).getOr(false);\n    };\n    var markCell = cell => {\n      return last$1(cell).bind(rightEdge => {\n        var rightSiblingIsBlock = siblingIsBlock(rightEdge);\n        return parent(rightEdge).map(parent => {\n          return rightSiblingIsBlock === true || isListItem(parent) || isBr(rightEdge) || isBlock(parent) && !eq$1(cell, parent) ? [] : [SugarElement.fromTag('br')];\n        });\n      }).getOr([]);\n    };\n    var markContent = () => {\n      var content = bind$2(cells, cell => {\n        var children = children$2(cell);\n        return advancedBr(children) ? [] : children.concat(markCell(cell));\n      });\n      return content.length === 0 ? [SugarElement.fromTag('br')] : content;\n    };\n    var contents = markContent();\n    empty(cells[0]);\n    append(cells[0], contents);\n  };\n  var isEditable = elem => isEditable$1(elem, true);\n  var prune = table => {\n    var cells = cells$1(table);\n    if (cells.length === 0) {\n      remove$6(table);\n    }\n  };\n  var outcome = (grid, cursor) => ({\n    grid,\n    cursor\n  });\n  var findEditableCursorPosition = rows => findMap(rows, row => findMap(row.cells, cell => {\n    var elem = cell.element;\n    return someIf(isEditable(elem), elem);\n  }));\n  var elementFromGrid = (grid, row, column) => {\n    var _a, _b;\n    var rows = extractGridDetails(grid).rows;\n    return Optional.from((_b = (_a = rows[row]) === null || _a === void 0 ? void 0 : _a.cells[column]) === null || _b === void 0 ? void 0 : _b.element).filter(isEditable).orThunk(() => findEditableCursorPosition(rows));\n  };\n  var bundle = (grid, row, column) => {\n    var cursorElement = elementFromGrid(grid, row, column);\n    return outcome(grid, cursorElement);\n  };\n  var uniqueRows = details => {\n    var rowCompilation = (rest, detail) => {\n      var rowExists = exists(rest, currentDetail => currentDetail.row === detail.row);\n      return rowExists ? rest : rest.concat([detail]);\n    };\n    return foldl(details, rowCompilation, []).sort((detailA, detailB) => detailA.row - detailB.row);\n  };\n  var opInsertRowsBefore = (grid, details, comparator, genWrappers) => {\n    var targetIndex = details[0].row;\n    var rows = uniqueRows(details);\n    var newGrid = foldr(rows, (acc, row) => {\n      var newG = insertRowAt(acc.grid, targetIndex, row.row + acc.delta, comparator, genWrappers.getOrInit);\n      return {\n        grid: newG,\n        delta: acc.delta + 1\n      };\n    }, {\n      grid,\n      delta: 0\n    }).grid;\n    return bundle(newGrid, targetIndex, details[0].column);\n  };\n  var opInsertRowsAfter = (grid, details, comparator, genWrappers) => {\n    var rows = uniqueRows(details);\n    var target = rows[rows.length - 1];\n    var targetIndex = target.row + target.rowspan;\n    var newGrid = foldr(rows, (newG, row) => {\n      return insertRowAt(newG, targetIndex, row.row, comparator, genWrappers.getOrInit);\n    }, grid);\n    return bundle(newGrid, targetIndex, details[0].column);\n  };\n  var opInsertColumnsBefore = (grid, extractDetail, comparator, genWrappers) => {\n    var details = extractDetail.details;\n    var columns = uniqueColumns(details);\n    var targetIndex = columns[0].column;\n    var newGrid = foldr(columns, (acc, col) => {\n      var newG = insertColumnAt(acc.grid, targetIndex, col.column + acc.delta, comparator, genWrappers.getOrInit);\n      return {\n        grid: newG,\n        delta: acc.delta + 1\n      };\n    }, {\n      grid,\n      delta: 0\n    }).grid;\n    return bundle(newGrid, details[0].row, targetIndex);\n  };\n  var opInsertColumnsAfter = (grid, extractDetail, comparator, genWrappers) => {\n    var details = extractDetail.details;\n    var target = details[details.length - 1];\n    var targetIndex = target.column + target.colspan;\n    var columns = uniqueColumns(details);\n    var newGrid = foldr(columns, (newG, col) => {\n      return insertColumnAt(newG, targetIndex, col.column, comparator, genWrappers.getOrInit);\n    }, grid);\n    return bundle(newGrid, details[0].row, targetIndex);\n  };\n  var opMakeColumnsHeader = (initialGrid, details, comparator, genWrappers) => {\n    var columns = uniqueColumns(details);\n    var columnIndexes = map$1(columns, detail => detail.column);\n    var newGrid = replaceColumns(initialGrid, columnIndexes, true, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opMakeCellsHeader = (initialGrid, details, comparator, genWrappers) => {\n    var newGrid = replaceCells(initialGrid, details, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opUnmakeColumnsHeader = (initialGrid, details, comparator, genWrappers) => {\n    var columns = uniqueColumns(details);\n    var columnIndexes = map$1(columns, detail => detail.column);\n    var newGrid = replaceColumns(initialGrid, columnIndexes, false, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opUnmakeCellsHeader = (initialGrid, details, comparator, genWrappers) => {\n    var newGrid = replaceCells(initialGrid, details, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var makeRowsSection = (section, applyScope) => (initialGrid, details, comparator, genWrappers, tableSection) => {\n    var rows = uniqueRows(details);\n    var rowIndexes = map$1(rows, detail => detail.row);\n    var newGrid = replaceRows(initialGrid, rowIndexes, section, applyScope, comparator, genWrappers.replaceOrInit, tableSection);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n  var opMakeRowsHeader = makeRowsSection('thead', true);\n  var opMakeRowsBody = makeRowsSection('tbody', false);\n  var opMakeRowsFooter = makeRowsSection('tfoot', false);\n  var opEraseColumns = (grid, extractDetail, _comparator, _genWrappers) => {\n    var columns = uniqueColumns(extractDetail.details);\n    var newGrid = deleteColumnsAt(grid, map$1(columns, column => column.column));\n    var maxColIndex = newGrid.length > 0 ? newGrid[0].cells.length - 1 : 0;\n    return bundle(newGrid, columns[0].row, Math.min(columns[0].column, maxColIndex));\n  };\n  var opEraseRows = (grid, details, _comparator, _genWrappers) => {\n    var rows = uniqueRows(details);\n    var newGrid = deleteRowsAt(grid, rows[0].row, rows[rows.length - 1].row);\n    var maxRowIndex = newGrid.length > 0 ? newGrid.length - 1 : 0;\n    return bundle(newGrid, Math.min(details[0].row, maxRowIndex), details[0].column);\n  };\n  var opMergeCells = (grid, mergable, comparator, genWrappers) => {\n    var cells = mergable.cells;\n    merge(cells);\n    var newGrid = merge$2(grid, mergable.bounds, comparator, genWrappers.merge(cells));\n    return outcome(newGrid, Optional.from(cells[0]));\n  };\n  var opUnmergeCells = (grid, unmergable, comparator, genWrappers) => {\n    var unmerge$1 = (b, cell) => unmerge(b, cell, comparator, genWrappers.unmerge(cell));\n    var newGrid = foldr(unmergable, unmerge$1, grid);\n    return outcome(newGrid, Optional.from(unmergable[0]));\n  };\n  var opPasteCells = (grid, pasteDetails, comparator, _genWrappers) => {\n    var gridify = (table, generators) => {\n      var wh = Warehouse.fromTable(table);\n      return toGrid(wh, generators, true);\n    };\n    var gridB = gridify(pasteDetails.clipboard, pasteDetails.generators);\n    var startAddress = address(pasteDetails.row, pasteDetails.column);\n    var mergedGrid = merge$1(startAddress, grid, gridB, pasteDetails.generators, comparator);\n    return mergedGrid.fold(() => outcome(grid, Optional.some(pasteDetails.element)), newGrid => {\n      return bundle(newGrid, pasteDetails.row, pasteDetails.column);\n    });\n  };\n  var gridifyRows = (rows, generators, context) => {\n    var pasteDetails = fromPastedRows(rows, context.section);\n    var wh = Warehouse.generate(pasteDetails);\n    return toGrid(wh, generators, true);\n  };\n  var opPasteColsBefore = (grid, pasteDetails, comparator, _genWrappers) => {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[0].column;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opPasteColsAfter = (grid, pasteDetails, comparator, _genWrappers) => {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[pasteDetails.cells.length - 1].column + pasteDetails.cells[pasteDetails.cells.length - 1].colspan;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opPasteRowsBefore = (grid, pasteDetails, comparator, _genWrappers) => {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[0].row;\n    var context = rows[index];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opPasteRowsAfter = (grid, pasteDetails, comparator, _genWrappers) => {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[pasteDetails.cells.length - 1].row + pasteDetails.cells[pasteDetails.cells.length - 1].rowspan;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n    return bundle(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n  };\n  var opGetColumnsType = (table, target) => {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(selectedCells => {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minColRange = selectedCells[0].column;\n      var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n      var selectedColumnCells = flatten(map$1(house.all, row => filter$2(row.cells, cell => cell.column >= minColRange && cell.column < maxColRange)));\n      return findCommonCellType(selectedColumnCells);\n    }).getOr('');\n  };\n  var opGetCellsType = (table, target) => {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(findCommonCellType).getOr('');\n  };\n  var opGetRowsType = (table, target) => {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(selectedCells => {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minRowRange = selectedCells[0].row;\n      var maxRowRange = lastSelectedCell.row + lastSelectedCell.rowspan;\n      var selectedRows = house.all.slice(minRowRange, maxRowRange);\n      return findCommonRowType(selectedRows);\n    }).getOr('');\n  };\n  var resize = (table, list, details, behaviours) => adjustWidthTo(table, list, details, behaviours.sizing);\n  var adjustAndRedistributeWidths = (table, list, details, behaviours) => adjustAndRedistributeWidths$1(table, list, details, behaviours.sizing, behaviours.resize);\n  var firstColumnIsLocked = (_warehouse, details) => exists(details, detail => detail.column === 0 && detail.isLocked);\n  var lastColumnIsLocked = (warehouse, details) => exists(details, detail => detail.column + detail.colspan >= warehouse.grid.columns && detail.isLocked);\n  var getColumnsWidth = (warehouse, details) => {\n    var columns$1 = columns(warehouse);\n    var uniqueCols = uniqueColumns(details);\n    return foldl(uniqueCols, (acc, detail) => {\n      var column = columns$1[detail.column];\n      var colWidth = column.map(getOuter$2).getOr(0);\n      return acc + colWidth;\n    }, 0);\n  };\n  var insertColumnsExtractor = before => (warehouse, target) => onCells(warehouse, target).filter(details => {\n    var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n    return !checkLocked(warehouse, details);\n  }).map(details => ({\n    details,\n    pixelDelta: getColumnsWidth(warehouse, details)\n  }));\n  var eraseColumnsExtractor = (warehouse, target) => onUnlockedCells(warehouse, target).map(details => ({\n    details,\n    pixelDelta: -getColumnsWidth(warehouse, details)\n  }));\n  var pasteColumnsExtractor = before => (warehouse, target) => onPasteByEditor(warehouse, target).filter(details => {\n    var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n    return !checkLocked(warehouse, details.cells);\n  });\n  var headerCellGenerator = Generators.transform('th');\n  var bodyCellGenerator = Generators.transform('td');\n  var insertRowsBefore = run(opInsertRowsBefore, onCells, noop, noop, Generators.modification);\n  var insertRowsAfter = run(opInsertRowsAfter, onCells, noop, noop, Generators.modification);\n  var insertColumnsBefore = run(opInsertColumnsBefore, insertColumnsExtractor(true), adjustAndRedistributeWidths, noop, Generators.modification);\n  var insertColumnsAfter = run(opInsertColumnsAfter, insertColumnsExtractor(false), adjustAndRedistributeWidths, noop, Generators.modification);\n  var eraseColumns = run(opEraseColumns, eraseColumnsExtractor, adjustAndRedistributeWidths, prune, Generators.modification);\n  var eraseRows = run(opEraseRows, onCells, noop, prune, Generators.modification);\n  var makeColumnsHeader = run(opMakeColumnsHeader, onUnlockedCells, noop, noop, headerCellGenerator);\n  var unmakeColumnsHeader = run(opUnmakeColumnsHeader, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var makeRowsHeader = run(opMakeRowsHeader, onUnlockedCells, noop, noop, headerCellGenerator);\n  var makeRowsBody = run(opMakeRowsBody, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var makeRowsFooter = run(opMakeRowsFooter, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var makeCellsHeader = run(opMakeCellsHeader, onUnlockedCells, noop, noop, headerCellGenerator);\n  var unmakeCellsHeader = run(opUnmakeCellsHeader, onUnlockedCells, noop, noop, bodyCellGenerator);\n  var mergeCells = run(opMergeCells, onUnlockedMergable, resize, noop, Generators.merging);\n  var unmergeCells = run(opUnmergeCells, onUnlockedUnmergable, resize, noop, Generators.merging);\n  var pasteCells = run(opPasteCells, onPaste, resize, noop, Generators.modification);\n  var pasteColsBefore = run(opPasteColsBefore, pasteColumnsExtractor(true), noop, noop, Generators.modification);\n  var pasteColsAfter = run(opPasteColsAfter, pasteColumnsExtractor(false), noop, noop, Generators.modification);\n  var pasteRowsBefore = run(opPasteRowsBefore, onPasteByEditor, noop, noop, Generators.modification);\n  var pasteRowsAfter = run(opPasteRowsAfter, onPasteByEditor, noop, noop, Generators.modification);\n  var getColumnsType = opGetColumnsType;\n  var getCellsType = opGetCellsType;\n  var getRowsType = opGetRowsType;\n  var fireNewRow = (editor, row) => editor.dispatch('NewRow', {\n    node: row\n  });\n  var fireNewCell = (editor, cell) => editor.dispatch('NewCell', {\n    node: cell\n  });\n  var fireTableModified = (editor, table, data) => {\n    editor.dispatch('TableModified', _objectSpread(_objectSpread({}, data), {}, {\n      table\n    }));\n  };\n  var fireTableSelectionChange = (editor, cells, start, finish, otherCells) => {\n    editor.dispatch('TableSelectionChange', {\n      cells,\n      start,\n      finish,\n      otherCells\n    });\n  };\n  var fireTableSelectionClear = editor => {\n    editor.dispatch('TableSelectionClear');\n  };\n  var fireObjectResizeStart = (editor, target, width, height, origin) => {\n    editor.dispatch('ObjectResizeStart', {\n      target,\n      width,\n      height,\n      origin\n    });\n  };\n  var fireObjectResized = (editor, target, width, height, origin) => {\n    editor.dispatch('ObjectResized', {\n      target,\n      width,\n      height,\n      origin\n    });\n  };\n  var styleModified = {\n    structure: false,\n    style: true\n  };\n  var structureModified = {\n    structure: true,\n    style: false\n  };\n  var styleAndStructureModified = {\n    structure: true,\n    style: true\n  };\n  var get$5 = (editor, table) => {\n    if (isTablePercentagesForced(editor)) {\n      return TableSize.percentageSize(table);\n    } else if (isTablePixelsForced(editor)) {\n      return TableSize.pixelSize(table);\n    } else {\n      return TableSize.getTableSize(table);\n    }\n  };\n  var TableActions = (editor, resizeHandler, cellSelectionHandler) => {\n    var isTableBody = editor => name(getBody(editor)) === 'table';\n    var lastRowGuard = table => !isTableBody(editor) || getGridSize(table).rows > 1;\n    var lastColumnGuard = table => !isTableBody(editor) || getGridSize(table).columns > 1;\n    var cloneFormats = getTableCloneElements(editor);\n    var colMutationOp = isResizeTableColumnResizing(editor) ? noop : halve;\n    var getTableSectionType = table => {\n      switch (getTableHeaderType(editor)) {\n        case 'section':\n          return TableSection.section();\n        case 'sectionCells':\n          return TableSection.sectionCells();\n        case 'cells':\n          return TableSection.cells();\n        default:\n          return TableSection.getTableSectionType(table, 'section');\n      }\n    };\n    var setSelectionFromAction = (table, result) => result.cursor.fold(() => {\n      var cells = cells$1(table);\n      return head(cells).filter(inBody).map(firstCell => {\n        cellSelectionHandler.clearSelectedCells(table.dom);\n        var rng = editor.dom.createRng();\n        rng.selectNode(firstCell.dom);\n        editor.selection.setRng(rng);\n        set$2(firstCell, 'data-mce-selected', '1');\n        return rng;\n      });\n    }, cell => {\n      var des = freefallRtl(cell);\n      var rng = editor.dom.createRng();\n      rng.setStart(des.element.dom, des.offset);\n      rng.setEnd(des.element.dom, des.offset);\n      editor.selection.setRng(rng);\n      cellSelectionHandler.clearSelectedCells(table.dom);\n      return Optional.some(rng);\n    });\n    var execute = (operation, guard, mutate, effect) => function (table, target) {\n      var noEvents = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      removeDataStyle(table);\n      var doc = SugarElement.fromDom(editor.getDoc());\n      var generators = cellOperations(mutate, doc, cloneFormats);\n      var behaviours = {\n        sizing: get$5(editor, table),\n        resize: isResizeTableColumnResizing(editor) ? resizeTable() : preserveTable(),\n        section: getTableSectionType(table)\n      };\n      return guard(table) ? operation(table, target, generators, behaviours).bind(result => {\n        resizeHandler.refresh(table.dom);\n        each$2(result.newRows, row => {\n          fireNewRow(editor, row.dom);\n        });\n        each$2(result.newCells, cell => {\n          fireNewCell(editor, cell.dom);\n        });\n        var range = setSelectionFromAction(table, result);\n        if (inBody(table)) {\n          removeDataStyle(table);\n          if (!noEvents) {\n            fireTableModified(editor, table.dom, effect);\n          }\n        }\n        return range.map(rng => ({\n          rng,\n          effect\n        }));\n      }) : Optional.none();\n    };\n    var deleteRow = execute(eraseRows, lastRowGuard, noop, structureModified);\n    var deleteColumn = execute(eraseColumns, lastColumnGuard, noop, structureModified);\n    var insertRowsBefore$1 = execute(insertRowsBefore, always, noop, structureModified);\n    var insertRowsAfter$1 = execute(insertRowsAfter, always, noop, structureModified);\n    var insertColumnsBefore$1 = execute(insertColumnsBefore, always, colMutationOp, structureModified);\n    var insertColumnsAfter$1 = execute(insertColumnsAfter, always, colMutationOp, structureModified);\n    var mergeCells$1 = execute(mergeCells, always, noop, structureModified);\n    var unmergeCells$1 = execute(unmergeCells, always, noop, structureModified);\n    var pasteColsBefore$1 = execute(pasteColsBefore, always, noop, structureModified);\n    var pasteColsAfter$1 = execute(pasteColsAfter, always, noop, structureModified);\n    var pasteRowsBefore$1 = execute(pasteRowsBefore, always, noop, structureModified);\n    var pasteRowsAfter$1 = execute(pasteRowsAfter, always, noop, structureModified);\n    var pasteCells$1 = execute(pasteCells, always, noop, styleAndStructureModified);\n    var makeCellsHeader$1 = execute(makeCellsHeader, always, noop, structureModified);\n    var unmakeCellsHeader$1 = execute(unmakeCellsHeader, always, noop, structureModified);\n    var makeColumnsHeader$1 = execute(makeColumnsHeader, always, noop, structureModified);\n    var unmakeColumnsHeader$1 = execute(unmakeColumnsHeader, always, noop, structureModified);\n    var makeRowsHeader$1 = execute(makeRowsHeader, always, noop, structureModified);\n    var makeRowsBody$1 = execute(makeRowsBody, always, noop, structureModified);\n    var makeRowsFooter$1 = execute(makeRowsFooter, always, noop, structureModified);\n    var getTableCellType = getCellsType;\n    var getTableColType = getColumnsType;\n    var getTableRowType = getRowsType;\n    return {\n      deleteRow,\n      deleteColumn,\n      insertRowsBefore: insertRowsBefore$1,\n      insertRowsAfter: insertRowsAfter$1,\n      insertColumnsBefore: insertColumnsBefore$1,\n      insertColumnsAfter: insertColumnsAfter$1,\n      mergeCells: mergeCells$1,\n      unmergeCells: unmergeCells$1,\n      pasteColsBefore: pasteColsBefore$1,\n      pasteColsAfter: pasteColsAfter$1,\n      pasteRowsBefore: pasteRowsBefore$1,\n      pasteRowsAfter: pasteRowsAfter$1,\n      pasteCells: pasteCells$1,\n      makeCellsHeader: makeCellsHeader$1,\n      unmakeCellsHeader: unmakeCellsHeader$1,\n      makeColumnsHeader: makeColumnsHeader$1,\n      unmakeColumnsHeader: unmakeColumnsHeader$1,\n      makeRowsHeader: makeRowsHeader$1,\n      makeRowsBody: makeRowsBody$1,\n      makeRowsFooter: makeRowsFooter$1,\n      getTableRowType,\n      getTableCellType,\n      getTableColType\n    };\n  };\n  var constrainSpan = (element, property, value) => {\n    var currentColspan = getAttrValue(element, property, 1);\n    if (value === 1 || currentColspan <= 1) {\n      remove$7(element, property);\n    } else {\n      set$2(element, property, Math.min(value, currentColspan));\n    }\n  };\n  var isColInRange = (minColRange, maxColRange) => cell => {\n    var endCol = cell.column + cell.colspan - 1;\n    var startCol = cell.column;\n    return endCol >= minColRange && startCol < maxColRange;\n  };\n  var generateColGroup = (house, minColRange, maxColRange) => {\n    if (Warehouse.hasColumns(house)) {\n      var colsToCopy = filter$2(Warehouse.justColumns(house), isColInRange(minColRange, maxColRange));\n      var copiedCols = map$1(colsToCopy, c => {\n        var clonedCol = deep(c.element);\n        constrainSpan(clonedCol, 'span', maxColRange - minColRange);\n        return clonedCol;\n      });\n      var fakeColgroup = SugarElement.fromTag('colgroup');\n      append(fakeColgroup, copiedCols);\n      return [fakeColgroup];\n    } else {\n      return [];\n    }\n  };\n  var generateRows = (house, minColRange, maxColRange) => map$1(house.all, row => {\n    var cellsToCopy = filter$2(row.cells, isColInRange(minColRange, maxColRange));\n    var copiedCells = map$1(cellsToCopy, cell => {\n      var clonedCell = deep(cell.element);\n      constrainSpan(clonedCell, 'colspan', maxColRange - minColRange);\n      return clonedCell;\n    });\n    var fakeTR = SugarElement.fromTag('tr');\n    append(fakeTR, copiedCells);\n    return fakeTR;\n  });\n  var copyCols = (table, target) => {\n    var house = Warehouse.fromTable(table);\n    var details = onUnlockedCells(house, target);\n    return details.map(selectedCells => {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minColRange = selectedCells[0].column;\n      var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n      var fakeColGroups = generateColGroup(house, minColRange, maxColRange);\n      var fakeRows = generateRows(house, minColRange, maxColRange);\n      return [...fakeColGroups, ...fakeRows];\n    });\n  };\n  var copyRows = (table, target, generators) => {\n    var warehouse = Warehouse.fromTable(table);\n    var details = onCells(warehouse, target);\n    return details.bind(selectedCells => {\n      var grid = toGrid(warehouse, generators, false);\n      var rows = extractGridDetails(grid).rows;\n      var slicedGrid = rows.slice(selectedCells[0].row, selectedCells[selectedCells.length - 1].row + selectedCells[selectedCells.length - 1].rowspan);\n      var filteredGrid = bind$2(slicedGrid, row => {\n        var newCells = filter$2(row.cells, cell => !cell.isLocked);\n        return newCells.length > 0 ? [_objectSpread(_objectSpread({}, row), {}, {\n          cells: newCells\n        })] : [];\n      });\n      var slicedDetails = toDetailList(filteredGrid);\n      return someIf(slicedDetails.length > 0, slicedDetails);\n    }).map(slicedDetails => copy(slicedDetails));\n  };\n  var adt$5 = Adt.generate([{\n    invalid: ['raw']\n  }, {\n    pixels: ['value']\n  }, {\n    percent: ['value']\n  }]);\n  var validateFor = (suffix, type, value) => {\n    var rawAmount = value.substring(0, value.length - suffix.length);\n    var amount = parseFloat(rawAmount);\n    return rawAmount === amount.toString() ? type(amount) : adt$5.invalid(value);\n  };\n  var from = value => {\n    if (endsWith(value, '%')) {\n      return validateFor('%', adt$5.percent, value);\n    }\n    if (endsWith(value, 'px')) {\n      return validateFor('px', adt$5.pixels, value);\n    }\n    return adt$5.invalid(value);\n  };\n  var Size = _objectSpread(_objectSpread({}, adt$5), {}, {\n    from\n  });\n  var redistributeToPercent = (widths, totalWidth) => {\n    return map$1(widths, w => {\n      var colType = Size.from(w);\n      return colType.fold(() => {\n        return w;\n      }, px => {\n        var ratio = px / totalWidth * 100;\n        return ratio + '%';\n      }, pc => {\n        return pc + '%';\n      });\n    });\n  };\n  var redistributeToPx = (widths, totalWidth, newTotalWidth) => {\n    var scale = newTotalWidth / totalWidth;\n    return map$1(widths, w => {\n      var colType = Size.from(w);\n      return colType.fold(() => {\n        return w;\n      }, px => {\n        return px * scale + 'px';\n      }, pc => {\n        return pc / 100 * newTotalWidth + 'px';\n      });\n    });\n  };\n  var redistributeEmpty = (newWidthType, columns) => {\n    var f = newWidthType.fold(() => constant(''), pixels => {\n      var num = pixels / columns;\n      return constant(num + 'px');\n    }, () => {\n      var num = 100 / columns;\n      return constant(num + '%');\n    });\n    return range$1(columns, f);\n  };\n  var redistributeValues = (newWidthType, widths, totalWidth) => {\n    return newWidthType.fold(() => {\n      return widths;\n    }, px => {\n      return redistributeToPx(widths, totalWidth, px);\n    }, _pc => {\n      return redistributeToPercent(widths, totalWidth);\n    });\n  };\n  var redistribute$1 = (widths, totalWidth, newWidth) => {\n    var newType = Size.from(newWidth);\n    var floats = forall(widths, s => {\n      return s === '0px';\n    }) ? redistributeEmpty(newType, widths.length) : redistributeValues(newType, widths, totalWidth);\n    return normalize(floats);\n  };\n  var sum = (values, fallback) => {\n    if (values.length === 0) {\n      return fallback;\n    }\n    return foldr(values, (rest, v) => {\n      return Size.from(v).fold(constant(0), identity, identity) + rest;\n    }, 0);\n  };\n  var roundDown = (num, unit) => {\n    var floored = Math.floor(num);\n    return {\n      value: floored + unit,\n      remainder: num - floored\n    };\n  };\n  var add$3 = (value, amount) => {\n    return Size.from(value).fold(constant(value), px => {\n      return px + amount + 'px';\n    }, pc => {\n      return pc + amount + '%';\n    });\n  };\n  var normalize = values => {\n    if (values.length === 0) {\n      return values;\n    }\n    var scan = foldr(values, (rest, value) => {\n      var info = Size.from(value).fold(() => ({\n        value,\n        remainder: 0\n      }), num => roundDown(num, 'px'), num => ({\n        value: num + '%',\n        remainder: 0\n      }));\n      return {\n        output: [info.value].concat(rest.output),\n        remainder: rest.remainder + info.remainder\n      };\n    }, {\n      output: [],\n      remainder: 0\n    });\n    var r = scan.output;\n    return r.slice(0, r.length - 1).concat([add$3(r[r.length - 1], Math.round(scan.remainder))]);\n  };\n  var validate = Size.from;\n  var redistributeToW = (newWidths, cells, unit) => {\n    each$2(cells, cell => {\n      var widths = newWidths.slice(cell.column, cell.colspan + cell.column);\n      var w = sum(widths, minWidth());\n      set$1(cell.element, 'width', w + unit);\n    });\n  };\n  var redistributeToColumns = (newWidths, columns, unit) => {\n    each$2(columns, (column, index) => {\n      var width = sum([newWidths[index]], minWidth());\n      set$1(column.element, 'width', width + unit);\n    });\n  };\n  var redistributeToH = (newHeights, rows, cells, unit) => {\n    each$2(cells, cell => {\n      var heights = newHeights.slice(cell.row, cell.rowspan + cell.row);\n      var h = sum(heights, minHeight());\n      set$1(cell.element, 'height', h + unit);\n    });\n    each$2(rows, (row, i) => {\n      set$1(row.element, 'height', newHeights[i]);\n    });\n  };\n  var getUnit = newSize => {\n    return validate(newSize).fold(constant('px'), constant('px'), constant('%'));\n  };\n  var redistribute = (table, optWidth, optHeight) => {\n    var warehouse = Warehouse.fromTable(table);\n    var rows = warehouse.all;\n    var cells = Warehouse.justCells(warehouse);\n    var columns = Warehouse.justColumns(warehouse);\n    optWidth.each(newWidth => {\n      var widthUnit = getUnit(newWidth);\n      var totalWidth = get$9(table);\n      var oldWidths = getRawWidths(warehouse, table);\n      var nuWidths = redistribute$1(oldWidths, totalWidth, newWidth);\n      if (Warehouse.hasColumns(warehouse)) {\n        redistributeToColumns(nuWidths, columns, widthUnit);\n      } else {\n        redistributeToW(nuWidths, cells, widthUnit);\n      }\n      set$1(table, 'width', newWidth);\n    });\n    optHeight.each(newHeight => {\n      var hUnit = getUnit(newHeight);\n      var totalHeight = get$8(table);\n      var oldHeights = getRawHeights(warehouse, table, height);\n      var nuHeights = redistribute$1(oldHeights, totalHeight, newHeight);\n      redistributeToH(nuHeights, rows, cells, hUnit);\n      set$1(table, 'height', newHeight);\n    });\n  };\n  var isPercentSizing = isPercentSizing$1;\n  var isPixelSizing = isPixelSizing$1;\n  var isNoneSizing = isNoneSizing$1;\n  var cleanupLegacyAttributes = element => {\n    remove$7(element, 'width');\n  };\n  var convertToPercentSize = table => {\n    var newWidth = getPercentTableWidth(table);\n    redistribute(table, Optional.some(newWidth), Optional.none());\n    cleanupLegacyAttributes(table);\n  };\n  var convertToPixelSize = table => {\n    var newWidth = getPixelTableWidth(table);\n    redistribute(table, Optional.some(newWidth), Optional.none());\n    cleanupLegacyAttributes(table);\n  };\n  var convertToNoneSize = table => {\n    remove$5(table, 'width');\n    var columns = columns$1(table);\n    var rowElements = columns.length > 0 ? columns : cells$1(table);\n    each$2(rowElements, cell => {\n      remove$5(cell, 'width');\n      cleanupLegacyAttributes(cell);\n    });\n    cleanupLegacyAttributes(table);\n  };\n  var DefaultRenderOptions = {\n    styles: {\n      'border-collapse': 'collapse',\n      'width': '100%'\n    },\n    attributes: {\n      border: '1'\n    },\n    colGroups: false\n  };\n  var tableHeaderCell = () => SugarElement.fromTag('th');\n  var tableCell = () => SugarElement.fromTag('td');\n  var tableColumn = () => SugarElement.fromTag('col');\n  var createRow = (columns, rowHeaders, columnHeaders, rowIndex) => {\n    var tr = SugarElement.fromTag('tr');\n    for (var j = 0; j < columns; j++) {\n      var td = rowIndex < rowHeaders || j < columnHeaders ? tableHeaderCell() : tableCell();\n      if (j < columnHeaders) {\n        set$2(td, 'scope', 'row');\n      }\n      if (rowIndex < rowHeaders) {\n        set$2(td, 'scope', 'col');\n      }\n      append$1(td, SugarElement.fromTag('br'));\n      append$1(tr, td);\n    }\n    return tr;\n  };\n  var createGroupRow = columns => {\n    var columnGroup = SugarElement.fromTag('colgroup');\n    range$1(columns, () => append$1(columnGroup, tableColumn()));\n    return columnGroup;\n  };\n  var createRows = (rows, columns, rowHeaders, columnHeaders) => range$1(rows, r => createRow(columns, rowHeaders, columnHeaders, r));\n  var render = function render(rows, columns, rowHeaders, columnHeaders, headerType) {\n    var renderOpts = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : DefaultRenderOptions;\n    var table = SugarElement.fromTag('table');\n    var rowHeadersGoInThead = headerType !== 'cells';\n    setAll(table, renderOpts.styles);\n    setAll$1(table, renderOpts.attributes);\n    if (renderOpts.colGroups) {\n      append$1(table, createGroupRow(columns));\n    }\n    var actualRowHeaders = Math.min(rows, rowHeaders);\n    if (rowHeadersGoInThead && rowHeaders > 0) {\n      var thead = SugarElement.fromTag('thead');\n      append$1(table, thead);\n      var theadRowHeaders = headerType === 'sectionCells' ? actualRowHeaders : 0;\n      var theadRows = createRows(rowHeaders, columns, theadRowHeaders, columnHeaders);\n      append(thead, theadRows);\n    }\n    var tbody = SugarElement.fromTag('tbody');\n    append$1(table, tbody);\n    var numRows = rowHeadersGoInThead ? rows - actualRowHeaders : rows;\n    var numRowHeaders = rowHeadersGoInThead ? 0 : rowHeaders;\n    var tbodyRows = createRows(numRows, columns, numRowHeaders, columnHeaders);\n    append(tbody, tbodyRows);\n    return table;\n  };\n  var get$4 = element => element.dom.innerHTML;\n  var getOuter = element => {\n    var container = SugarElement.fromTag('div');\n    var clone = SugarElement.fromDom(element.dom.cloneNode(true));\n    append$1(container, clone);\n    return get$4(container);\n  };\n  var placeCaretInCell = (editor, cell) => {\n    editor.selection.select(cell.dom, true);\n    editor.selection.collapse(true);\n  };\n  var selectFirstCellInTable = (editor, tableElm) => {\n    descendant(tableElm, 'td,th').each(curry(placeCaretInCell, editor));\n  };\n  var fireEvents = (editor, table) => {\n    each$2(descendants(table, 'tr'), row => {\n      fireNewRow(editor, row.dom);\n      each$2(descendants(row, 'th,td'), cell => {\n        fireNewCell(editor, cell.dom);\n      });\n    });\n  };\n  var isPercentage = width => isString(width) && width.indexOf('%') !== -1;\n  var insert = (editor, columns, rows, colHeaders, rowHeaders) => {\n    var defaultStyles = getTableDefaultStyles(editor);\n    var options = {\n      styles: defaultStyles,\n      attributes: getTableDefaultAttributes(editor),\n      colGroups: tableUseColumnGroup(editor)\n    };\n    editor.undoManager.ignore(() => {\n      var table = render(rows, columns, rowHeaders, colHeaders, getTableHeaderType(editor), options);\n      set$2(table, 'data-mce-id', '__mce');\n      var html = getOuter(table);\n      editor.insertContent(html);\n      editor.addVisual();\n    });\n    return descendant(getBody(editor), 'table[data-mce-id=\"__mce\"]').map(table => {\n      if (isTablePixelsForced(editor)) {\n        convertToPixelSize(table);\n      } else if (isTableResponsiveForced(editor)) {\n        convertToNoneSize(table);\n      } else if (isTablePercentagesForced(editor) || isPercentage(defaultStyles.width)) {\n        convertToPercentSize(table);\n      }\n      removeDataStyle(table);\n      remove$7(table, 'data-mce-id');\n      fireEvents(editor, table);\n      selectFirstCellInTable(editor, table);\n      return table.dom;\n    }).getOrNull();\n  };\n  var insertTable = function insertTable(editor, rows, columns) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var checkInput = val => isNumber(val) && val > 0;\n    if (checkInput(rows) && checkInput(columns)) {\n      var headerRows = options.headerRows || 0;\n      var headerColumns = options.headerColumns || 0;\n      return insert(editor, columns, rows, headerColumns, headerRows);\n    } else {\n      console.error('Invalid values for mceInsertTable - rows and columns values are required to insert a table.');\n      return null;\n    }\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.FakeClipboard');\n  var tableTypeBase = 'x-tinymce/dom-table-';\n  var tableTypeRow = tableTypeBase + 'rows';\n  var tableTypeColumn = tableTypeBase + 'columns';\n  var setData = items => {\n    var fakeClipboardItem = global.FakeClipboardItem(items);\n    global.write([fakeClipboardItem]);\n  };\n  var getData = type => {\n    var _a;\n    var items = (_a = global.read()) !== null && _a !== void 0 ? _a : [];\n    return findMap(items, item => Optional.from(item.getType(type)));\n  };\n  var clearData = type => {\n    if (getData(type).isSome()) {\n      global.clear();\n    }\n  };\n  var setRows = rowsOpt => {\n    rowsOpt.fold(clearRows, rows => setData({\n      [tableTypeRow]: rows\n    }));\n  };\n  var getRows = () => getData(tableTypeRow);\n  var clearRows = () => clearData(tableTypeRow);\n  var setColumns = columnsOpt => {\n    columnsOpt.fold(clearColumns, columns => setData({\n      [tableTypeColumn]: columns\n    }));\n  };\n  var getColumns = () => getData(tableTypeColumn);\n  var clearColumns = () => clearData(tableTypeColumn);\n  var getSelectionStartCellOrCaption = editor => getSelectionCellOrCaption(getSelectionStart(editor), getIsRoot(editor)).filter(isInEditableContext$1);\n  var getSelectionStartCell = editor => getSelectionCell(getSelectionStart(editor), getIsRoot(editor)).filter(isInEditableContext$1);\n  var registerCommands = (editor, actions) => {\n    var isRoot = getIsRoot(editor);\n    var eraseTable = () => getSelectionStartCellOrCaption(editor).each(cellOrCaption => {\n      table(cellOrCaption, isRoot).filter(not(isRoot)).each(table => {\n        var cursor = SugarElement.fromText('');\n        after$5(table, cursor);\n        remove$6(table);\n        if (editor.dom.isEmpty(editor.getBody())) {\n          editor.setContent('');\n          editor.selection.setCursorLocation();\n        } else {\n          var rng = editor.dom.createRng();\n          rng.setStart(cursor.dom, 0);\n          rng.setEnd(cursor.dom, 0);\n          editor.selection.setRng(rng);\n          editor.nodeChanged();\n        }\n      });\n    });\n    var setSizingMode = sizing => getSelectionStartCellOrCaption(editor).each(cellOrCaption => {\n      var isForcedSizing = isTableResponsiveForced(editor) || isTablePixelsForced(editor) || isTablePercentagesForced(editor);\n      if (!isForcedSizing) {\n        table(cellOrCaption, isRoot).each(table => {\n          if (sizing === 'relative' && !isPercentSizing(table)) {\n            convertToPercentSize(table);\n          } else if (sizing === 'fixed' && !isPixelSizing(table)) {\n            convertToPixelSize(table);\n          } else if (sizing === 'responsive' && !isNoneSizing(table)) {\n            convertToNoneSize(table);\n          }\n          removeDataStyle(table);\n          fireTableModified(editor, table.dom, structureModified);\n        });\n      }\n    });\n    var getTableFromCell = cell => table(cell, isRoot);\n    var performActionOnSelection = action => getSelectionStartCell(editor).bind(cell => getTableFromCell(cell).map(table => action(table, cell)));\n    var toggleTableClass = (_ui, clazz) => {\n      performActionOnSelection(table => {\n        editor.formatter.toggle('tableclass', {\n          value: clazz\n        }, table.dom);\n        fireTableModified(editor, table.dom, styleModified);\n      });\n    };\n    var toggleTableCellClass = (_ui, clazz) => {\n      performActionOnSelection(table => {\n        var selectedCells = getCellsFromSelection(editor);\n        var allHaveClass = forall(selectedCells, cell => editor.formatter.match('tablecellclass', {\n          value: clazz\n        }, cell.dom));\n        var formatterAction = allHaveClass ? editor.formatter.remove : editor.formatter.apply;\n        each$2(selectedCells, cell => formatterAction('tablecellclass', {\n          value: clazz\n        }, cell.dom));\n        fireTableModified(editor, table.dom, styleModified);\n      });\n    };\n    var toggleCaption = () => {\n      getSelectionStartCellOrCaption(editor).each(cellOrCaption => {\n        table(cellOrCaption, isRoot).each(table => {\n          child(table, 'caption').fold(() => {\n            var caption = SugarElement.fromTag('caption');\n            append$1(caption, SugarElement.fromText('Caption'));\n            appendAt(table, caption, 0);\n            editor.selection.setCursorLocation(caption.dom, 0);\n          }, caption => {\n            if (isTag('caption')(cellOrCaption)) {\n              one('td', table).each(td => editor.selection.setCursorLocation(td.dom, 0));\n            }\n            remove$6(caption);\n          });\n          fireTableModified(editor, table.dom, structureModified);\n        });\n      });\n    };\n    var postExecute = _data => {\n      editor.focus();\n    };\n    var actOnSelection = function actOnSelection(execute) {\n      var noEvents = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      return performActionOnSelection((table, startCell) => {\n        var targets = forMenu(getCellsFromSelection(editor), table, startCell);\n        execute(table, targets, noEvents).each(postExecute);\n      });\n    };\n    var copyRowSelection = () => performActionOnSelection((table, startCell) => {\n      var targets = forMenu(getCellsFromSelection(editor), table, startCell);\n      var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), Optional.none());\n      return copyRows(table, targets, generators);\n    });\n    var copyColSelection = () => performActionOnSelection((table, startCell) => {\n      var targets = forMenu(getCellsFromSelection(editor), table, startCell);\n      return copyCols(table, targets);\n    });\n    var pasteOnSelection = (execute, getRows) => getRows().each(rows => {\n      var clonedRows = map$1(rows, row => deep(row));\n      performActionOnSelection((table, startCell) => {\n        var generators = paste$1(SugarElement.fromDom(editor.getDoc()));\n        var targets = pasteRows(getCellsFromSelection(editor), startCell, clonedRows, generators);\n        execute(table, targets).each(postExecute);\n      });\n    });\n    var actOnType = getAction => (_ui, args) => get$c(args, 'type').each(type => {\n      actOnSelection(getAction(type), args.no_events);\n    });\n    each$1({\n      mceTableSplitCells: () => actOnSelection(actions.unmergeCells),\n      mceTableMergeCells: () => actOnSelection(actions.mergeCells),\n      mceTableInsertRowBefore: () => actOnSelection(actions.insertRowsBefore),\n      mceTableInsertRowAfter: () => actOnSelection(actions.insertRowsAfter),\n      mceTableInsertColBefore: () => actOnSelection(actions.insertColumnsBefore),\n      mceTableInsertColAfter: () => actOnSelection(actions.insertColumnsAfter),\n      mceTableDeleteCol: () => actOnSelection(actions.deleteColumn),\n      mceTableDeleteRow: () => actOnSelection(actions.deleteRow),\n      mceTableCutCol: () => copyColSelection().each(selection => {\n        setColumns(selection);\n        actOnSelection(actions.deleteColumn);\n      }),\n      mceTableCutRow: () => copyRowSelection().each(selection => {\n        setRows(selection);\n        actOnSelection(actions.deleteRow);\n      }),\n      mceTableCopyCol: () => copyColSelection().each(selection => setColumns(selection)),\n      mceTableCopyRow: () => copyRowSelection().each(selection => setRows(selection)),\n      mceTablePasteColBefore: () => pasteOnSelection(actions.pasteColsBefore, getColumns),\n      mceTablePasteColAfter: () => pasteOnSelection(actions.pasteColsAfter, getColumns),\n      mceTablePasteRowBefore: () => pasteOnSelection(actions.pasteRowsBefore, getRows),\n      mceTablePasteRowAfter: () => pasteOnSelection(actions.pasteRowsAfter, getRows),\n      mceTableDelete: eraseTable,\n      mceTableCellToggleClass: toggleTableCellClass,\n      mceTableToggleClass: toggleTableClass,\n      mceTableToggleCaption: toggleCaption,\n      mceTableSizingMode: (_ui, sizing) => setSizingMode(sizing),\n      mceTableCellType: actOnType(type => type === 'th' ? actions.makeCellsHeader : actions.unmakeCellsHeader),\n      mceTableColType: actOnType(type => type === 'th' ? actions.makeColumnsHeader : actions.unmakeColumnsHeader),\n      mceTableRowType: actOnType(type => {\n        switch (type) {\n          case 'header':\n            return actions.makeRowsHeader;\n          case 'footer':\n            return actions.makeRowsFooter;\n          default:\n            return actions.makeRowsBody;\n        }\n      })\n    }, (func, name) => editor.addCommand(name, func));\n    editor.addCommand('mceInsertTable', (_ui, args) => {\n      insertTable(editor, args.rows, args.columns, args.options);\n    });\n    editor.addCommand('mceTableApplyCellStyle', (_ui, args) => {\n      var getFormatName = style => 'tablecell' + style.toLowerCase().replace('-', '');\n      if (!isObject(args)) {\n        return;\n      }\n      var cells = filter$2(getCellsFromSelection(editor), isInEditableContext$1);\n      if (cells.length === 0) {\n        return;\n      }\n      var validArgs = filter$1(args, (value, style) => editor.formatter.has(getFormatName(style)) && isString(value));\n      if (isEmpty(validArgs)) {\n        return;\n      }\n      each$1(validArgs, (value, style) => {\n        var formatName = getFormatName(style);\n        each$2(cells, cell => {\n          if (value === '') {\n            editor.formatter.remove(formatName, {\n              value: null\n            }, cell.dom, true);\n          } else {\n            editor.formatter.apply(formatName, {\n              value\n            }, cell.dom);\n          }\n        });\n      });\n      getTableFromCell(cells[0]).each(table => fireTableModified(editor, table.dom, styleModified));\n    });\n  };\n  var registerQueryCommands = (editor, actions) => {\n    var isRoot = getIsRoot(editor);\n    var lookupOnSelection = action => getSelectionCell(getSelectionStart(editor)).bind(cell => table(cell, isRoot).map(table => {\n      var targets = forMenu(getCellsFromSelection(editor), table, cell);\n      return action(table, targets);\n    })).getOr('');\n    each$1({\n      mceTableRowType: () => lookupOnSelection(actions.getTableRowType),\n      mceTableCellType: () => lookupOnSelection(actions.getTableCellType),\n      mceTableColType: () => lookupOnSelection(actions.getTableColType)\n    }, (func, name) => editor.addQueryValueHandler(name, func));\n  };\n  var adt$4 = Adt.generate([{\n    before: ['element']\n  }, {\n    on: ['element', 'offset']\n  }, {\n    after: ['element']\n  }]);\n  var cata$1 = (subject, onBefore, onOn, onAfter) => subject.fold(onBefore, onOn, onAfter);\n  var getStart$1 = situ => situ.fold(identity, identity, identity);\n  var before$2 = adt$4.before;\n  var on = adt$4.on;\n  var after$3 = adt$4.after;\n  var Situ = {\n    before: before$2,\n    on,\n    after: after$3,\n    cata: cata$1,\n    getStart: getStart$1\n  };\n  var create$4 = (selection, kill) => ({\n    selection,\n    kill\n  });\n  var Response = {\n    create: create$4\n  };\n  var selectNode = (win, element) => {\n    var rng = win.document.createRange();\n    rng.selectNode(element.dom);\n    return rng;\n  };\n  var selectNodeContents = (win, element) => {\n    var rng = win.document.createRange();\n    selectNodeContentsUsing(rng, element);\n    return rng;\n  };\n  var selectNodeContentsUsing = (rng, element) => rng.selectNodeContents(element.dom);\n  var setStart = (rng, situ) => {\n    situ.fold(e => {\n      rng.setStartBefore(e.dom);\n    }, (e, o) => {\n      rng.setStart(e.dom, o);\n    }, e => {\n      rng.setStartAfter(e.dom);\n    });\n  };\n  var setFinish = (rng, situ) => {\n    situ.fold(e => {\n      rng.setEndBefore(e.dom);\n    }, (e, o) => {\n      rng.setEnd(e.dom, o);\n    }, e => {\n      rng.setEndAfter(e.dom);\n    });\n  };\n  var relativeToNative = (win, startSitu, finishSitu) => {\n    var range = win.document.createRange();\n    setStart(range, startSitu);\n    setFinish(range, finishSitu);\n    return range;\n  };\n  var exactToNative = (win, start, soffset, finish, foffset) => {\n    var rng = win.document.createRange();\n    rng.setStart(start.dom, soffset);\n    rng.setEnd(finish.dom, foffset);\n    return rng;\n  };\n  var toRect = rect => ({\n    left: rect.left,\n    top: rect.top,\n    right: rect.right,\n    bottom: rect.bottom,\n    width: rect.width,\n    height: rect.height\n  });\n  var getFirstRect$1 = rng => {\n    var rects = rng.getClientRects();\n    var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();\n    return rect.width > 0 || rect.height > 0 ? Optional.some(rect).map(toRect) : Optional.none();\n  };\n  var adt$3 = Adt.generate([{\n    ltr: ['start', 'soffset', 'finish', 'foffset']\n  }, {\n    rtl: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n  var fromRange = (win, type, range) => type(SugarElement.fromDom(range.startContainer), range.startOffset, SugarElement.fromDom(range.endContainer), range.endOffset);\n  var getRanges = (win, selection) => selection.match({\n    domRange: rng => {\n      return {\n        ltr: constant(rng),\n        rtl: Optional.none\n      };\n    },\n    relative: (startSitu, finishSitu) => {\n      return {\n        ltr: cached(() => relativeToNative(win, startSitu, finishSitu)),\n        rtl: cached(() => Optional.some(relativeToNative(win, finishSitu, startSitu)))\n      };\n    },\n    exact: (start, soffset, finish, foffset) => {\n      return {\n        ltr: cached(() => exactToNative(win, start, soffset, finish, foffset)),\n        rtl: cached(() => Optional.some(exactToNative(win, finish, foffset, start, soffset)))\n      };\n    }\n  });\n  var doDiagnose = (win, ranges) => {\n    var rng = ranges.ltr();\n    if (rng.collapsed) {\n      var reversed = ranges.rtl().filter(rev => rev.collapsed === false);\n      return reversed.map(rev => adt$3.rtl(SugarElement.fromDom(rev.endContainer), rev.endOffset, SugarElement.fromDom(rev.startContainer), rev.startOffset)).getOrThunk(() => fromRange(win, adt$3.ltr, rng));\n    } else {\n      return fromRange(win, adt$3.ltr, rng);\n    }\n  };\n  var diagnose = (win, selection) => {\n    var ranges = getRanges(win, selection);\n    return doDiagnose(win, ranges);\n  };\n  var asLtrRange = (win, selection) => {\n    var diagnosis = diagnose(win, selection);\n    return diagnosis.match({\n      ltr: (start, soffset, finish, foffset) => {\n        var rng = win.document.createRange();\n        rng.setStart(start.dom, soffset);\n        rng.setEnd(finish.dom, foffset);\n        return rng;\n      },\n      rtl: (start, soffset, finish, foffset) => {\n        var rng = win.document.createRange();\n        rng.setStart(finish.dom, foffset);\n        rng.setEnd(start.dom, soffset);\n        return rng;\n      }\n    });\n  };\n  adt$3.ltr;\n  adt$3.rtl;\n  var create$3 = (start, soffset, finish, foffset) => ({\n    start,\n    soffset,\n    finish,\n    foffset\n  });\n  var SimRange = {\n    create: create$3\n  };\n  var create$2 = (start, soffset, finish, foffset) => {\n    return {\n      start: Situ.on(start, soffset),\n      finish: Situ.on(finish, foffset)\n    };\n  };\n  var Situs = {\n    create: create$2\n  };\n  var convertToRange = (win, selection) => {\n    var rng = asLtrRange(win, selection);\n    return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n  };\n  var makeSitus = Situs.create;\n  var sync = (container, isRoot, start, soffset, finish, foffset, selectRange) => {\n    if (!(eq$1(start, finish) && soffset === foffset)) {\n      return closest$1(start, 'td,th', isRoot).bind(s => {\n        return closest$1(finish, 'td,th', isRoot).bind(f => {\n          return detect(container, isRoot, s, f, selectRange);\n        });\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n  var detect = (container, isRoot, start, finish, selectRange) => {\n    if (!eq$1(start, finish)) {\n      return identify(start, finish, isRoot).bind(cellSel => {\n        var boxes = cellSel.boxes.getOr([]);\n        if (boxes.length > 1) {\n          selectRange(container, boxes, cellSel.start, cellSel.finish);\n          return Optional.some(Response.create(Optional.some(makeSitus(start, 0, start, getEnd(start))), true));\n        } else {\n          return Optional.none();\n        }\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n  var update = (rows, columns, container, selected, annotations) => {\n    var updateSelection = newSels => {\n      annotations.clearBeforeUpdate(container);\n      annotations.selectRange(container, newSels.boxes, newSels.start, newSels.finish);\n      return newSels.boxes;\n    };\n    return shiftSelection(selected, rows, columns, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(updateSelection);\n  };\n  var traverse = (item, mode) => ({\n    item,\n    mode\n  });\n  var backtrack = function backtrack(universe, item, _direction) {\n    var transition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : sidestep;\n    return universe.property().parent(item).map(p => {\n      return traverse(p, transition);\n    });\n  };\n  var sidestep = function sidestep(universe, item, direction) {\n    var transition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : advance;\n    return direction.sibling(universe, item).map(p => {\n      return traverse(p, transition);\n    });\n  };\n  var advance = function advance(universe, item, direction) {\n    var transition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : advance;\n    var children = universe.property().children(item);\n    var result = direction.first(children);\n    return result.map(r => {\n      return traverse(r, transition);\n    });\n  };\n  var successors = [{\n    current: backtrack,\n    next: sidestep,\n    fallback: Optional.none()\n  }, {\n    current: sidestep,\n    next: advance,\n    fallback: Optional.some(backtrack)\n  }, {\n    current: advance,\n    next: advance,\n    fallback: Optional.some(sidestep)\n  }];\n  var go = function go(universe, item, mode, direction) {\n    var rules = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : successors;\n    var ruleOpt = find$1(rules, succ => {\n      return succ.current === mode;\n    });\n    return ruleOpt.bind(rule => {\n      return rule.current(universe, item, direction, rule.next).orThunk(() => {\n        return rule.fallback.bind(fb => {\n          return go(universe, item, fb, direction);\n        });\n      });\n    });\n  };\n  var left$1 = () => {\n    var sibling = (universe, item) => {\n      return universe.query().prevSibling(item);\n    };\n    var first = children => {\n      return children.length > 0 ? Optional.some(children[children.length - 1]) : Optional.none();\n    };\n    return {\n      sibling,\n      first\n    };\n  };\n  var right$1 = () => {\n    var sibling = (universe, item) => {\n      return universe.query().nextSibling(item);\n    };\n    var first = children => {\n      return children.length > 0 ? Optional.some(children[0]) : Optional.none();\n    };\n    return {\n      sibling,\n      first\n    };\n  };\n  var Walkers = {\n    left: left$1,\n    right: right$1\n  };\n  var hone = (universe, item, predicate, mode, direction, isRoot) => {\n    var next = go(universe, item, mode, direction);\n    return next.bind(n => {\n      if (isRoot(n.item)) {\n        return Optional.none();\n      } else {\n        return predicate(n.item) ? Optional.some(n.item) : hone(universe, n.item, predicate, n.mode, direction, isRoot);\n      }\n    });\n  };\n  var left = (universe, item, predicate, isRoot) => {\n    return hone(universe, item, predicate, sidestep, Walkers.left(), isRoot);\n  };\n  var right = (universe, item, predicate, isRoot) => {\n    return hone(universe, item, predicate, sidestep, Walkers.right(), isRoot);\n  };\n  var isLeaf = universe => element => universe.property().children(element).length === 0;\n  var before$1 = (universe, item, isRoot) => {\n    return seekLeft$1(universe, item, isLeaf(universe), isRoot);\n  };\n  var after$2 = (universe, item, isRoot) => {\n    return seekRight$1(universe, item, isLeaf(universe), isRoot);\n  };\n  var seekLeft$1 = left;\n  var seekRight$1 = right;\n  var universe = DomUniverse();\n  var before = (element, isRoot) => {\n    return before$1(universe, element, isRoot);\n  };\n  var after$1 = (element, isRoot) => {\n    return after$2(universe, element, isRoot);\n  };\n  var seekLeft = (element, predicate, isRoot) => {\n    return seekLeft$1(universe, element, predicate, isRoot);\n  };\n  var seekRight = (element, predicate, isRoot) => {\n    return seekRight$1(universe, element, predicate, isRoot);\n  };\n  var ancestor = (scope, predicate, isRoot) => ancestor$2(scope, predicate, isRoot).isSome();\n  var adt$2 = Adt.generate([{\n    none: ['message']\n  }, {\n    success: []\n  }, {\n    failedUp: ['cell']\n  }, {\n    failedDown: ['cell']\n  }]);\n  var isOverlapping = (bridge, before, after) => {\n    var beforeBounds = bridge.getRect(before);\n    var afterBounds = bridge.getRect(after);\n    return afterBounds.right > beforeBounds.left && afterBounds.left < beforeBounds.right;\n  };\n  var isRow = elem => {\n    return closest$1(elem, 'tr');\n  };\n  var verify = (bridge, before, beforeOffset, after, afterOffset, failure, isRoot) => {\n    return closest$1(after, 'td,th', isRoot).bind(afterCell => {\n      return closest$1(before, 'td,th', isRoot).map(beforeCell => {\n        if (!eq$1(afterCell, beforeCell)) {\n          return sharedOne(isRow, [afterCell, beforeCell]).fold(() => {\n            return isOverlapping(bridge, beforeCell, afterCell) ? adt$2.success() : failure(beforeCell);\n          }, _sharedRow => {\n            return failure(beforeCell);\n          });\n        } else {\n          return eq$1(after, afterCell) && getEnd(afterCell) === afterOffset ? failure(beforeCell) : adt$2.none('in same cell');\n        }\n      });\n    }).getOr(adt$2.none('default'));\n  };\n  var cata = (subject, onNone, onSuccess, onFailedUp, onFailedDown) => {\n    return subject.fold(onNone, onSuccess, onFailedUp, onFailedDown);\n  };\n  var BeforeAfter = _objectSpread(_objectSpread({}, adt$2), {}, {\n    verify,\n    cata\n  });\n  var inParent = (parent, children, element, index) => ({\n    parent,\n    children,\n    element,\n    index\n  });\n  var indexInParent = element => parent(element).bind(parent => {\n    var children = children$2(parent);\n    return indexOf(children, element).map(index => inParent(parent, children, element, index));\n  });\n  var indexOf = (elements, element) => findIndex(elements, curry(eq$1, element));\n  var isBr = isTag('br');\n  var gatherer = (cand, gather, isRoot) => {\n    return gather(cand, isRoot).bind(target => {\n      return isText(target) && get$6(target).trim().length === 0 ? gatherer(target, gather, isRoot) : Optional.some(target);\n    });\n  };\n  var handleBr = (isRoot, element, direction) => {\n    return direction.traverse(element).orThunk(() => {\n      return gatherer(element, direction.gather, isRoot);\n    }).map(direction.relative);\n  };\n  var findBr = (element, offset) => {\n    return child$2(element, offset).filter(isBr).orThunk(() => {\n      return child$2(element, offset - 1).filter(isBr);\n    });\n  };\n  var handleParent = (isRoot, element, offset, direction) => {\n    return findBr(element, offset).bind(br => {\n      return direction.traverse(br).fold(() => {\n        return gatherer(br, direction.gather, isRoot).map(direction.relative);\n      }, adjacent => {\n        return indexInParent(adjacent).map(info => {\n          return Situ.on(info.parent, info.index);\n        });\n      });\n    });\n  };\n  var tryBr = (isRoot, element, offset, direction) => {\n    var target = isBr(element) ? handleBr(isRoot, element, direction) : handleParent(isRoot, element, offset, direction);\n    return target.map(tgt => {\n      return {\n        start: tgt,\n        finish: tgt\n      };\n    });\n  };\n  var process = analysis => {\n    return BeforeAfter.cata(analysis, _message => {\n      return Optional.none();\n    }, () => {\n      return Optional.none();\n    }, cell => {\n      return Optional.some(point(cell, 0));\n    }, cell => {\n      return Optional.some(point(cell, getEnd(cell)));\n    });\n  };\n  var moveDown = (caret, amount) => {\n    return {\n      left: caret.left,\n      top: caret.top + amount,\n      right: caret.right,\n      bottom: caret.bottom + amount\n    };\n  };\n  var moveUp = (caret, amount) => {\n    return {\n      left: caret.left,\n      top: caret.top - amount,\n      right: caret.right,\n      bottom: caret.bottom - amount\n    };\n  };\n  var translate = (caret, xDelta, yDelta) => {\n    return {\n      left: caret.left + xDelta,\n      top: caret.top + yDelta,\n      right: caret.right + xDelta,\n      bottom: caret.bottom + yDelta\n    };\n  };\n  var getTop = caret => {\n    return caret.top;\n  };\n  var getBottom = caret => {\n    return caret.bottom;\n  };\n  var getPartialBox = (bridge, element, offset) => {\n    if (offset >= 0 && offset < getEnd(element)) {\n      return bridge.getRangedRect(element, offset, element, offset + 1);\n    } else if (offset > 0) {\n      return bridge.getRangedRect(element, offset - 1, element, offset);\n    }\n    return Optional.none();\n  };\n  var toCaret = rect => ({\n    left: rect.left,\n    top: rect.top,\n    right: rect.right,\n    bottom: rect.bottom\n  });\n  var getElemBox = (bridge, element) => {\n    return Optional.some(bridge.getRect(element));\n  };\n  var getBoxAt = (bridge, element, offset) => {\n    if (isElement(element)) {\n      return getElemBox(bridge, element).map(toCaret);\n    } else if (isText(element)) {\n      return getPartialBox(bridge, element, offset).map(toCaret);\n    } else {\n      return Optional.none();\n    }\n  };\n  var getEntireBox = (bridge, element) => {\n    if (isElement(element)) {\n      return getElemBox(bridge, element).map(toCaret);\n    } else if (isText(element)) {\n      return bridge.getRangedRect(element, 0, element, getEnd(element)).map(toCaret);\n    } else {\n      return Optional.none();\n    }\n  };\n  var JUMP_SIZE = 5;\n  var NUM_RETRIES = 100;\n  var adt$1 = Adt.generate([{\n    none: []\n  }, {\n    retry: ['caret']\n  }]);\n  var isOutside = (caret, box) => {\n    return caret.left < box.left || Math.abs(box.right - caret.left) < 1 || caret.left > box.right;\n  };\n  var inOutsideBlock = (bridge, element, caret) => {\n    return closest$2(element, isBlock).fold(never, cell => {\n      return getEntireBox(bridge, cell).exists(box => {\n        return isOutside(caret, box);\n      });\n    });\n  };\n  var adjustDown = (bridge, element, guessBox, original, caret) => {\n    var lowerCaret = moveDown(caret, JUMP_SIZE);\n    if (Math.abs(guessBox.bottom - original.bottom) < 1) {\n      return adt$1.retry(lowerCaret);\n    } else if (guessBox.top > caret.bottom) {\n      return adt$1.retry(lowerCaret);\n    } else if (guessBox.top === caret.bottom) {\n      return adt$1.retry(moveDown(caret, 1));\n    } else {\n      return inOutsideBlock(bridge, element, caret) ? adt$1.retry(translate(lowerCaret, JUMP_SIZE, 0)) : adt$1.none();\n    }\n  };\n  var adjustUp = (bridge, element, guessBox, original, caret) => {\n    var higherCaret = moveUp(caret, JUMP_SIZE);\n    if (Math.abs(guessBox.top - original.top) < 1) {\n      return adt$1.retry(higherCaret);\n    } else if (guessBox.bottom < caret.top) {\n      return adt$1.retry(higherCaret);\n    } else if (guessBox.bottom === caret.top) {\n      return adt$1.retry(moveUp(caret, 1));\n    } else {\n      return inOutsideBlock(bridge, element, caret) ? adt$1.retry(translate(higherCaret, JUMP_SIZE, 0)) : adt$1.none();\n    }\n  };\n  var upMovement = {\n    point: getTop,\n    adjuster: adjustUp,\n    move: moveUp,\n    gather: before\n  };\n  var downMovement = {\n    point: getBottom,\n    adjuster: adjustDown,\n    move: moveDown,\n    gather: after$1\n  };\n  var isAtTable = (bridge, x, y) => {\n    return bridge.elementFromPoint(x, y).filter(elm => {\n      return name(elm) === 'table';\n    }).isSome();\n  };\n  var adjustForTable = (bridge, movement, original, caret, numRetries) => {\n    return adjustTil(bridge, movement, original, movement.move(caret, JUMP_SIZE), numRetries);\n  };\n  var adjustTil = (bridge, movement, original, caret, numRetries) => {\n    if (numRetries === 0) {\n      return Optional.some(caret);\n    }\n    if (isAtTable(bridge, caret.left, movement.point(caret))) {\n      return adjustForTable(bridge, movement, original, caret, numRetries - 1);\n    }\n    return bridge.situsFromPoint(caret.left, movement.point(caret)).bind(guess => {\n      return guess.start.fold(Optional.none, element => {\n        return getEntireBox(bridge, element).bind(guessBox => {\n          return movement.adjuster(bridge, element, guessBox, original, caret).fold(Optional.none, newCaret => {\n            return adjustTil(bridge, movement, original, newCaret, numRetries - 1);\n          });\n        }).orThunk(() => {\n          return Optional.some(caret);\n        });\n      }, Optional.none);\n    });\n  };\n  var checkScroll = (movement, adjusted, bridge) => {\n    if (movement.point(adjusted) > bridge.getInnerHeight()) {\n      return Optional.some(movement.point(adjusted) - bridge.getInnerHeight());\n    } else if (movement.point(adjusted) < 0) {\n      return Optional.some(-movement.point(adjusted));\n    } else {\n      return Optional.none();\n    }\n  };\n  var retry = (movement, bridge, caret) => {\n    var moved = movement.move(caret, JUMP_SIZE);\n    var adjusted = adjustTil(bridge, movement, caret, moved, NUM_RETRIES).getOr(moved);\n    return checkScroll(movement, adjusted, bridge).fold(() => {\n      return bridge.situsFromPoint(adjusted.left, movement.point(adjusted));\n    }, delta => {\n      bridge.scrollBy(0, delta);\n      return bridge.situsFromPoint(adjusted.left, movement.point(adjusted) - delta);\n    });\n  };\n  var Retries = {\n    tryUp: curry(retry, upMovement),\n    tryDown: curry(retry, downMovement),\n    getJumpSize: constant(JUMP_SIZE)\n  };\n  var MAX_RETRIES = 20;\n  var findSpot = (bridge, isRoot, direction) => {\n    return bridge.getSelection().bind(sel => {\n      return tryBr(isRoot, sel.finish, sel.foffset, direction).fold(() => {\n        return Optional.some(point(sel.finish, sel.foffset));\n      }, brNeighbour => {\n        var range = bridge.fromSitus(brNeighbour);\n        var analysis = BeforeAfter.verify(bridge, sel.finish, sel.foffset, range.finish, range.foffset, direction.failure, isRoot);\n        return process(analysis);\n      });\n    });\n  };\n  var scan = (bridge, isRoot, element, offset, direction, numRetries) => {\n    if (numRetries === 0) {\n      return Optional.none();\n    }\n    return tryCursor(bridge, isRoot, element, offset, direction).bind(situs => {\n      var range = bridge.fromSitus(situs);\n      var analysis = BeforeAfter.verify(bridge, element, offset, range.finish, range.foffset, direction.failure, isRoot);\n      return BeforeAfter.cata(analysis, () => {\n        return Optional.none();\n      }, () => {\n        return Optional.some(situs);\n      }, cell => {\n        if (eq$1(element, cell) && offset === 0) {\n          return tryAgain(bridge, element, offset, moveUp, direction);\n        } else {\n          return scan(bridge, isRoot, cell, 0, direction, numRetries - 1);\n        }\n      }, cell => {\n        if (eq$1(element, cell) && offset === getEnd(cell)) {\n          return tryAgain(bridge, element, offset, moveDown, direction);\n        } else {\n          return scan(bridge, isRoot, cell, getEnd(cell), direction, numRetries - 1);\n        }\n      });\n    });\n  };\n  var tryAgain = (bridge, element, offset, move, direction) => {\n    return getBoxAt(bridge, element, offset).bind(box => {\n      return tryAt(bridge, direction, move(box, Retries.getJumpSize()));\n    });\n  };\n  var tryAt = (bridge, direction, box) => {\n    var browser = detect$2().browser;\n    if (browser.isChromium() || browser.isSafari() || browser.isFirefox()) {\n      return direction.retry(bridge, box);\n    } else {\n      return Optional.none();\n    }\n  };\n  var tryCursor = (bridge, isRoot, element, offset, direction) => {\n    return getBoxAt(bridge, element, offset).bind(box => {\n      return tryAt(bridge, direction, box);\n    });\n  };\n  var handle$1 = (bridge, isRoot, direction) => {\n    return findSpot(bridge, isRoot, direction).bind(spot => {\n      return scan(bridge, isRoot, spot.element, spot.offset, direction, MAX_RETRIES).map(bridge.fromSitus);\n    });\n  };\n  var inSameTable = (elem, table) => {\n    return ancestor(elem, e => {\n      return parent(e).exists(p => {\n        return eq$1(p, table);\n      });\n    });\n  };\n  var simulate = (bridge, isRoot, direction, initial, anchor) => {\n    return closest$1(initial, 'td,th', isRoot).bind(start => {\n      return closest$1(start, 'table', isRoot).bind(table => {\n        if (!inSameTable(anchor, table)) {\n          return Optional.none();\n        }\n        return handle$1(bridge, isRoot, direction).bind(range => {\n          return closest$1(range.finish, 'td,th', isRoot).map(finish => {\n            return {\n              start,\n              finish,\n              range\n            };\n          });\n        });\n      });\n    });\n  };\n  var navigate = (bridge, isRoot, direction, initial, anchor, precheck) => {\n    return precheck(initial, isRoot).orThunk(() => {\n      return simulate(bridge, isRoot, direction, initial, anchor).map(info => {\n        var range = info.range;\n        return Response.create(Optional.some(makeSitus(range.start, range.soffset, range.finish, range.foffset)), true);\n      });\n    });\n  };\n  var firstUpCheck = (initial, isRoot) => {\n    return closest$1(initial, 'tr', isRoot).bind(startRow => {\n      return closest$1(startRow, 'table', isRoot).bind(table => {\n        var rows = descendants(table, 'tr');\n        if (eq$1(startRow, rows[0])) {\n          return seekLeft(table, element => {\n            return last$1(element).isSome();\n          }, isRoot).map(last => {\n            var lastOffset = getEnd(last);\n            return Response.create(Optional.some(makeSitus(last, lastOffset, last, lastOffset)), true);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    });\n  };\n  var lastDownCheck = (initial, isRoot) => {\n    return closest$1(initial, 'tr', isRoot).bind(startRow => {\n      return closest$1(startRow, 'table', isRoot).bind(table => {\n        var rows = descendants(table, 'tr');\n        if (eq$1(startRow, rows[rows.length - 1])) {\n          return seekRight(table, element => {\n            return first(element).isSome();\n          }, isRoot).map(first => {\n            return Response.create(Optional.some(makeSitus(first, 0, first, 0)), true);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    });\n  };\n  var select = (bridge, container, isRoot, direction, initial, anchor, selectRange) => {\n    return simulate(bridge, isRoot, direction, initial, anchor).bind(info => {\n      return detect(container, isRoot, info.start, info.finish, selectRange);\n    });\n  };\n  var Cell = initial => {\n    var value = initial;\n    var get = () => {\n      return value;\n    };\n    var set = v => {\n      value = v;\n    };\n    return {\n      get,\n      set\n    };\n  };\n  var singleton = doRevoke => {\n    var subject = Cell(Optional.none());\n    var revoke = () => subject.get().each(doRevoke);\n    var clear = () => {\n      revoke();\n      subject.set(Optional.none());\n    };\n    var isSet = () => subject.get().isSome();\n    var get = () => subject.get();\n    var set = s => {\n      revoke();\n      subject.set(Optional.some(s));\n    };\n    return {\n      clear,\n      isSet,\n      get,\n      set\n    };\n  };\n  var value = () => {\n    var subject = singleton(noop);\n    var on = f => subject.get().each(f);\n    return _objectSpread(_objectSpread({}, subject), {}, {\n      on\n    });\n  };\n  var findCell = (target, isRoot) => closest$1(target, 'td,th', isRoot);\n  var isInEditableContext = cell => parentElement(cell).exists(isEditable$1);\n  var MouseSelection = (bridge, container, isRoot, annotations) => {\n    var cursor = value();\n    var clearstate = cursor.clear;\n    var applySelection = event => {\n      cursor.on(start => {\n        annotations.clearBeforeUpdate(container);\n        findCell(event.target, isRoot).each(finish => {\n          identify(start, finish, isRoot).each(cellSel => {\n            var boxes = cellSel.boxes.getOr([]);\n            if (boxes.length === 1) {\n              var singleCell = boxes[0];\n              var isNonEditableCell = getRaw(singleCell) === 'false';\n              var isCellClosestContentEditable = is(closest(event.target), singleCell, eq$1);\n              if (isNonEditableCell && isCellClosestContentEditable) {\n                annotations.selectRange(container, boxes, singleCell, singleCell);\n                bridge.selectContents(singleCell);\n              }\n            } else if (boxes.length > 1) {\n              annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n              bridge.selectContents(finish);\n            }\n          });\n        });\n      });\n    };\n    var mousedown = event => {\n      annotations.clear(container);\n      findCell(event.target, isRoot).filter(isInEditableContext).each(cursor.set);\n    };\n    var mouseover = event => {\n      applySelection(event);\n    };\n    var mouseup = event => {\n      applySelection(event);\n      clearstate();\n    };\n    return {\n      clearstate,\n      mousedown,\n      mouseover,\n      mouseup\n    };\n  };\n  var down = {\n    traverse: nextSibling,\n    gather: after$1,\n    relative: Situ.before,\n    retry: Retries.tryDown,\n    failure: BeforeAfter.failedDown\n  };\n  var up = {\n    traverse: prevSibling,\n    gather: before,\n    relative: Situ.before,\n    retry: Retries.tryUp,\n    failure: BeforeAfter.failedUp\n  };\n  var isKey = key => {\n    return keycode => {\n      return keycode === key;\n    };\n  };\n  var isUp = isKey(38);\n  var isDown = isKey(40);\n  var isNavigation = keycode => {\n    return keycode >= 37 && keycode <= 40;\n  };\n  var ltr = {\n    isBackward: isKey(37),\n    isForward: isKey(39)\n  };\n  var rtl = {\n    isBackward: isKey(39),\n    isForward: isKey(37)\n  };\n  var get$3 = _DOC => {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n    var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n    return SugarPosition(x, y);\n  };\n  var by = (x, y, _DOC) => {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var win = doc.defaultView;\n    if (win) {\n      win.scrollBy(x, y);\n    }\n  };\n  var adt = Adt.generate([{\n    domRange: ['rng']\n  }, {\n    relative: ['startSitu', 'finishSitu']\n  }, {\n    exact: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n  var exactFromRange = simRange => adt.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n  var getStart = selection => selection.match({\n    domRange: rng => SugarElement.fromDom(rng.startContainer),\n    relative: (startSitu, _finishSitu) => Situ.getStart(startSitu),\n    exact: (start, _soffset, _finish, _foffset) => start\n  });\n  var domRange = adt.domRange;\n  var relative = adt.relative;\n  var exact = adt.exact;\n  var getWin = selection => {\n    var start = getStart(selection);\n    return defaultView(start);\n  };\n  var range = SimRange.create;\n  var SimSelection = {\n    domRange,\n    relative,\n    exact,\n    exactFromRange,\n    getWin,\n    range\n  };\n  var caretPositionFromPoint = (doc, x, y) => {\n    var _a, _b;\n    return Optional.from((_b = (_a = doc.dom).caretPositionFromPoint) === null || _b === void 0 ? void 0 : _b.call(_a, x, y)).bind(pos => {\n      if (pos.offsetNode === null) {\n        return Optional.none();\n      }\n      var r = doc.dom.createRange();\n      r.setStart(pos.offsetNode, pos.offset);\n      r.collapse();\n      return Optional.some(r);\n    });\n  };\n  var caretRangeFromPoint = (doc, x, y) => {\n    var _a, _b;\n    return Optional.from((_b = (_a = doc.dom).caretRangeFromPoint) === null || _b === void 0 ? void 0 : _b.call(_a, x, y));\n  };\n  var availableSearch = (() => {\n    if (document.caretPositionFromPoint) {\n      return caretPositionFromPoint;\n    } else if (document.caretRangeFromPoint) {\n      return caretRangeFromPoint;\n    } else {\n      return Optional.none;\n    }\n  })();\n  var fromPoint = (win, x, y) => {\n    var doc = SugarElement.fromDom(win.document);\n    return availableSearch(doc, x, y).map(rng => SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset));\n  };\n  var beforeSpecial = (element, offset) => {\n    var name$1 = name(element);\n    if ('input' === name$1) {\n      return Situ.after(element);\n    } else if (!contains$2(['br', 'img'], name$1)) {\n      return Situ.on(element, offset);\n    } else {\n      return offset === 0 ? Situ.before(element) : Situ.after(element);\n    }\n  };\n  var preprocessRelative = (startSitu, finishSitu) => {\n    var start = startSitu.fold(Situ.before, beforeSpecial, Situ.after);\n    var finish = finishSitu.fold(Situ.before, beforeSpecial, Situ.after);\n    return SimSelection.relative(start, finish);\n  };\n  var preprocessExact = (start, soffset, finish, foffset) => {\n    var startSitu = beforeSpecial(start, soffset);\n    var finishSitu = beforeSpecial(finish, foffset);\n    return SimSelection.relative(startSitu, finishSitu);\n  };\n  var makeRange = (start, soffset, finish, foffset) => {\n    var doc = owner(start);\n    var rng = doc.dom.createRange();\n    rng.setStart(start.dom, soffset);\n    rng.setEnd(finish.dom, foffset);\n    return rng;\n  };\n  var after = (start, soffset, finish, foffset) => {\n    var r = makeRange(start, soffset, finish, foffset);\n    var same = eq$1(start, finish) && soffset === foffset;\n    return r.collapsed && !same;\n  };\n  var getNativeSelection = win => Optional.from(win.getSelection());\n  var doSetNativeRange = (win, rng) => {\n    getNativeSelection(win).each(selection => {\n      selection.removeAllRanges();\n      selection.addRange(rng);\n    });\n  };\n  var doSetRange = (win, start, soffset, finish, foffset) => {\n    var rng = exactToNative(win, start, soffset, finish, foffset);\n    doSetNativeRange(win, rng);\n  };\n  var setLegacyRtlRange = (win, selection, start, soffset, finish, foffset) => {\n    selection.collapse(start.dom, soffset);\n    selection.extend(finish.dom, foffset);\n  };\n  var setRangeFromRelative = (win, relative) => diagnose(win, relative).match({\n    ltr: (start, soffset, finish, foffset) => {\n      doSetRange(win, start, soffset, finish, foffset);\n    },\n    rtl: (start, soffset, finish, foffset) => {\n      getNativeSelection(win).each(selection => {\n        if (selection.setBaseAndExtent) {\n          selection.setBaseAndExtent(start.dom, soffset, finish.dom, foffset);\n        } else if (selection.extend) {\n          try {\n            setLegacyRtlRange(win, selection, start, soffset, finish, foffset);\n          } catch (e) {\n            doSetRange(win, finish, foffset, start, soffset);\n          }\n        } else {\n          doSetRange(win, finish, foffset, start, soffset);\n        }\n      });\n    }\n  });\n  var setExact = (win, start, soffset, finish, foffset) => {\n    var relative = preprocessExact(start, soffset, finish, foffset);\n    setRangeFromRelative(win, relative);\n  };\n  var setRelative = (win, startSitu, finishSitu) => {\n    var relative = preprocessRelative(startSitu, finishSitu);\n    setRangeFromRelative(win, relative);\n  };\n  var readRange = selection => {\n    if (selection.rangeCount > 0) {\n      var firstRng = selection.getRangeAt(0);\n      var lastRng = selection.getRangeAt(selection.rangeCount - 1);\n      return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer), firstRng.startOffset, SugarElement.fromDom(lastRng.endContainer), lastRng.endOffset));\n    } else {\n      return Optional.none();\n    }\n  };\n  var doGetExact = selection => {\n    if (selection.anchorNode === null || selection.focusNode === null) {\n      return readRange(selection);\n    } else {\n      var anchor = SugarElement.fromDom(selection.anchorNode);\n      var focus = SugarElement.fromDom(selection.focusNode);\n      return after(anchor, selection.anchorOffset, focus, selection.focusOffset) ? Optional.some(SimRange.create(anchor, selection.anchorOffset, focus, selection.focusOffset)) : readRange(selection);\n    }\n  };\n  var setToElement = function setToElement(win, element) {\n    var selectNodeContents$1 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    var rngGetter = selectNodeContents$1 ? selectNodeContents : selectNode;\n    var rng = rngGetter(win, element);\n    doSetNativeRange(win, rng);\n  };\n  var getExact = win => getNativeSelection(win).filter(sel => sel.rangeCount > 0).bind(doGetExact);\n  var get$2 = win => getExact(win).map(range => SimSelection.exact(range.start, range.soffset, range.finish, range.foffset));\n  var getFirstRect = (win, selection) => {\n    var rng = asLtrRange(win, selection);\n    return getFirstRect$1(rng);\n  };\n  var getAtPoint = (win, x, y) => fromPoint(win, x, y);\n  var clear = win => {\n    getNativeSelection(win).each(selection => selection.removeAllRanges());\n  };\n  var WindowBridge = win => {\n    var elementFromPoint = (x, y) => {\n      return SugarElement.fromPoint(SugarElement.fromDom(win.document), x, y);\n    };\n    var getRect = element => {\n      return element.dom.getBoundingClientRect();\n    };\n    var getRangedRect = (start, soffset, finish, foffset) => {\n      var sel = SimSelection.exact(start, soffset, finish, foffset);\n      return getFirstRect(win, sel);\n    };\n    var getSelection = () => {\n      return get$2(win).map(exactAdt => {\n        return convertToRange(win, exactAdt);\n      });\n    };\n    var fromSitus = situs => {\n      var relative = SimSelection.relative(situs.start, situs.finish);\n      return convertToRange(win, relative);\n    };\n    var situsFromPoint = (x, y) => {\n      return getAtPoint(win, x, y).map(exact => {\n        return Situs.create(exact.start, exact.soffset, exact.finish, exact.foffset);\n      });\n    };\n    var clearSelection = () => {\n      clear(win);\n    };\n    var collapseSelection = function collapseSelection() {\n      var toStart = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      get$2(win).each(sel => sel.fold(rng => rng.collapse(toStart), (startSitu, finishSitu) => {\n        var situ = toStart ? startSitu : finishSitu;\n        setRelative(win, situ, situ);\n      }, (start, soffset, finish, foffset) => {\n        var node = toStart ? start : finish;\n        var offset = toStart ? soffset : foffset;\n        setExact(win, node, offset, node, offset);\n      }));\n    };\n    var selectNode = element => {\n      setToElement(win, element, false);\n    };\n    var selectContents = element => {\n      setToElement(win, element);\n    };\n    var setSelection = sel => {\n      setExact(win, sel.start, sel.soffset, sel.finish, sel.foffset);\n    };\n    var setRelativeSelection = (start, finish) => {\n      setRelative(win, start, finish);\n    };\n    var getInnerHeight = () => {\n      return win.innerHeight;\n    };\n    var getScrollY = () => {\n      var pos = get$3(SugarElement.fromDom(win.document));\n      return pos.top;\n    };\n    var scrollBy = (x, y) => {\n      by(x, y, SugarElement.fromDom(win.document));\n    };\n    return {\n      elementFromPoint,\n      getRect,\n      getRangedRect,\n      getSelection,\n      fromSitus,\n      situsFromPoint,\n      clearSelection,\n      collapseSelection,\n      setSelection,\n      setRelativeSelection,\n      selectNode,\n      selectContents,\n      getInnerHeight,\n      getScrollY,\n      scrollBy\n    };\n  };\n  var rc = (rows, cols) => ({\n    rows,\n    cols\n  });\n  var mouse = (win, container, isRoot, annotations) => {\n    var bridge = WindowBridge(win);\n    var handlers = MouseSelection(bridge, container, isRoot, annotations);\n    return {\n      clearstate: handlers.clearstate,\n      mousedown: handlers.mousedown,\n      mouseover: handlers.mouseover,\n      mouseup: handlers.mouseup\n    };\n  };\n  var isEditableNode = node => closest$2(node, isHTMLElement).exists(isEditable$1);\n  var isEditableSelection = (start, finish) => isEditableNode(start) || isEditableNode(finish);\n  var keyboard = (win, container, isRoot, annotations) => {\n    var bridge = WindowBridge(win);\n    var clearToNavigate = () => {\n      annotations.clear(container);\n      return Optional.none();\n    };\n    var keydown = (event, start, soffset, finish, foffset, direction) => {\n      var realEvent = event.raw;\n      var keycode = realEvent.which;\n      var shiftKey = realEvent.shiftKey === true;\n      var handler = retrieve$1(container, annotations.selectedSelector).fold(() => {\n        if (isNavigation(keycode) && !shiftKey) {\n          annotations.clearBeforeUpdate(container);\n        }\n        if (isNavigation(keycode) && shiftKey && !isEditableSelection(start, finish)) {\n          return Optional.none;\n        } else if (isDown(keycode) && shiftKey) {\n          return curry(select, bridge, container, isRoot, down, finish, start, annotations.selectRange);\n        } else if (isUp(keycode) && shiftKey) {\n          return curry(select, bridge, container, isRoot, up, finish, start, annotations.selectRange);\n        } else if (isDown(keycode)) {\n          return curry(navigate, bridge, isRoot, down, finish, start, lastDownCheck);\n        } else if (isUp(keycode)) {\n          return curry(navigate, bridge, isRoot, up, finish, start, firstUpCheck);\n        } else {\n          return Optional.none;\n        }\n      }, selected => {\n        var update$1 = attempts => {\n          return () => {\n            var navigation = findMap(attempts, delta => {\n              return update(delta.rows, delta.cols, container, selected, annotations);\n            });\n            return navigation.fold(() => {\n              return getEdges(container, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(edges => {\n                var relative = isDown(keycode) || direction.isForward(keycode) ? Situ.after : Situ.before;\n                bridge.setRelativeSelection(Situ.on(edges.first, 0), relative(edges.table));\n                annotations.clear(container);\n                return Response.create(Optional.none(), true);\n              });\n            }, _ => {\n              return Optional.some(Response.create(Optional.none(), true));\n            });\n          };\n        };\n        if (isNavigation(keycode) && shiftKey && !isEditableSelection(start, finish)) {\n          return Optional.none;\n        } else if (isDown(keycode) && shiftKey) {\n          return update$1([rc(+1, 0)]);\n        } else if (isUp(keycode) && shiftKey) {\n          return update$1([rc(-1, 0)]);\n        } else if (direction.isBackward(keycode) && shiftKey) {\n          return update$1([rc(0, -1), rc(-1, 0)]);\n        } else if (direction.isForward(keycode) && shiftKey) {\n          return update$1([rc(0, +1), rc(+1, 0)]);\n        } else if (isNavigation(keycode) && !shiftKey) {\n          return clearToNavigate;\n        } else {\n          return Optional.none;\n        }\n      });\n      return handler();\n    };\n    var keyup = (event, start, soffset, finish, foffset) => {\n      return retrieve$1(container, annotations.selectedSelector).fold(() => {\n        var realEvent = event.raw;\n        var keycode = realEvent.which;\n        var shiftKey = realEvent.shiftKey === true;\n        if (!shiftKey) {\n          return Optional.none();\n        }\n        if (isNavigation(keycode) && isEditableSelection(start, finish)) {\n          return sync(container, isRoot, start, soffset, finish, foffset, annotations.selectRange);\n        } else {\n          return Optional.none();\n        }\n      }, Optional.none);\n    };\n    return {\n      keydown,\n      keyup\n    };\n  };\n  var external = (win, container, isRoot, annotations) => {\n    var bridge = WindowBridge(win);\n    return (start, finish) => {\n      annotations.clearBeforeUpdate(container);\n      identify(start, finish, isRoot).each(cellSel => {\n        var boxes = cellSel.boxes.getOr([]);\n        annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n        bridge.selectContents(finish);\n        bridge.collapseSelection();\n      });\n    };\n  };\n  var read = (element, attr) => {\n    var value = get$b(element, attr);\n    return value === undefined || value === '' ? [] : value.split(' ');\n  };\n  var add$2 = (element, attr, id) => {\n    var old = read(element, attr);\n    var nu = old.concat([id]);\n    set$2(element, attr, nu.join(' '));\n    return true;\n  };\n  var remove$4 = (element, attr, id) => {\n    var nu = filter$2(read(element, attr), v => v !== id);\n    if (nu.length > 0) {\n      set$2(element, attr, nu.join(' '));\n    } else {\n      remove$7(element, attr);\n    }\n    return false;\n  };\n  var supports = element => element.dom.classList !== undefined;\n  var get$1 = element => read(element, 'class');\n  var add$1 = (element, clazz) => add$2(element, 'class', clazz);\n  var remove$3 = (element, clazz) => remove$4(element, 'class', clazz);\n  var add = (element, clazz) => {\n    if (supports(element)) {\n      element.dom.classList.add(clazz);\n    } else {\n      add$1(element, clazz);\n    }\n  };\n  var cleanClass = element => {\n    var classList = supports(element) ? element.dom.classList : get$1(element);\n    if (classList.length === 0) {\n      remove$7(element, 'class');\n    }\n  };\n  var remove$2 = (element, clazz) => {\n    if (supports(element)) {\n      var classList = element.dom.classList;\n      classList.remove(clazz);\n    } else {\n      remove$3(element, clazz);\n    }\n    cleanClass(element);\n  };\n  var has = (element, clazz) => supports(element) && element.dom.classList.contains(clazz);\n  var remove$1 = (element, classes) => {\n    each$2(classes, x => {\n      remove$2(element, x);\n    });\n  };\n  var addClass = clazz => element => {\n    add(element, clazz);\n  };\n  var removeClasses = classes => element => {\n    remove$1(element, classes);\n  };\n  var byClass = ephemera => {\n    var addSelectionClass = addClass(ephemera.selected);\n    var removeSelectionClasses = removeClasses([ephemera.selected, ephemera.lastSelected, ephemera.firstSelected]);\n    var clear = container => {\n      var sels = descendants(container, ephemera.selectedSelector);\n      each$2(sels, removeSelectionClasses);\n    };\n    var selectRange = (container, cells, start, finish) => {\n      clear(container);\n      each$2(cells, addSelectionClass);\n      add(start, ephemera.firstSelected);\n      add(finish, ephemera.lastSelected);\n    };\n    return {\n      clearBeforeUpdate: clear,\n      clear,\n      selectRange,\n      selectedSelector: ephemera.selectedSelector,\n      firstSelectedSelector: ephemera.firstSelectedSelector,\n      lastSelectedSelector: ephemera.lastSelectedSelector\n    };\n  };\n  var byAttr = (ephemera, onSelection, onClear) => {\n    var removeSelectionAttributes = element => {\n      remove$7(element, ephemera.selected);\n      remove$7(element, ephemera.firstSelected);\n      remove$7(element, ephemera.lastSelected);\n    };\n    var addSelectionAttribute = element => {\n      set$2(element, ephemera.selected, '1');\n    };\n    var clear = container => {\n      clearBeforeUpdate(container);\n      onClear();\n    };\n    var clearBeforeUpdate = container => {\n      var sels = descendants(container, \"\".concat(ephemera.selectedSelector, \",\").concat(ephemera.firstSelectedSelector, \",\").concat(ephemera.lastSelectedSelector));\n      each$2(sels, removeSelectionAttributes);\n    };\n    var selectRange = (container, cells, start, finish) => {\n      clear(container);\n      each$2(cells, addSelectionAttribute);\n      set$2(start, ephemera.firstSelected, '1');\n      set$2(finish, ephemera.lastSelected, '1');\n      onSelection(cells, start, finish);\n    };\n    return {\n      clearBeforeUpdate,\n      clear,\n      selectRange,\n      selectedSelector: ephemera.selectedSelector,\n      firstSelectedSelector: ephemera.firstSelectedSelector,\n      lastSelectedSelector: ephemera.lastSelectedSelector\n    };\n  };\n  var SelectionAnnotation = {\n    byClass,\n    byAttr\n  };\n  var fold = (subject, onNone, onMultiple, onSingle) => {\n    switch (subject.tag) {\n      case 'none':\n        return onNone();\n      case 'single':\n        return onSingle(subject.element);\n      case 'multiple':\n        return onMultiple(subject.elements);\n    }\n  };\n  var none = () => ({\n    tag: 'none'\n  });\n  var multiple = elements => ({\n    tag: 'multiple',\n    elements\n  });\n  var single = element => ({\n    tag: 'single',\n    element\n  });\n  var Selections = (lazyRoot, getStart, selectedSelector) => {\n    var get = () => retrieve(lazyRoot(), selectedSelector).fold(() => getStart().fold(none, single), multiple);\n    return {\n      get\n    };\n  };\n  var getUpOrLeftCells = (grid, selectedCells) => {\n    var upGrid = grid.slice(0, selectedCells[selectedCells.length - 1].row + 1);\n    var upDetails = toDetailList(upGrid);\n    return bind$2(upDetails, detail => {\n      var slicedCells = detail.cells.slice(0, selectedCells[selectedCells.length - 1].column + 1);\n      return map$1(slicedCells, cell => cell.element);\n    });\n  };\n  var getDownOrRightCells = (grid, selectedCells) => {\n    var downGrid = grid.slice(selectedCells[0].row + selectedCells[0].rowspan - 1, grid.length);\n    var downDetails = toDetailList(downGrid);\n    return bind$2(downDetails, detail => {\n      var slicedCells = detail.cells.slice(selectedCells[0].column + selectedCells[0].colspan - 1, detail.cells.length);\n      return map$1(slicedCells, cell => cell.element);\n    });\n  };\n  var getOtherCells = (table, target, generators) => {\n    var warehouse = Warehouse.fromTable(table);\n    var details = onCells(warehouse, target);\n    return details.map(selectedCells => {\n      var grid = toGrid(warehouse, generators, false);\n      var {\n        rows\n      } = extractGridDetails(grid);\n      var upOrLeftCells = getUpOrLeftCells(rows, selectedCells);\n      var downOrRightCells = getDownOrRightCells(rows, selectedCells);\n      return {\n        upOrLeftCells,\n        downOrRightCells\n      };\n    });\n  };\n  var mkEvent = (target, x, y, stop, prevent, kill, raw) => ({\n    target,\n    x,\n    y,\n    stop,\n    prevent,\n    kill,\n    raw\n  });\n  var fromRawEvent$1 = rawEvent => {\n    var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));\n    var stop = () => rawEvent.stopPropagation();\n    var prevent = () => rawEvent.preventDefault();\n    var kill = compose(prevent, stop);\n    return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);\n  };\n  var handle = (filter, handler) => rawEvent => {\n    if (filter(rawEvent)) {\n      handler(fromRawEvent$1(rawEvent));\n    }\n  };\n  var binder = (element, event, filter, handler, useCapture) => {\n    var wrapped = handle(filter, handler);\n    element.dom.addEventListener(event, wrapped, useCapture);\n    return {\n      unbind: curry(unbind, element, event, wrapped, useCapture)\n    };\n  };\n  var bind$1 = (element, event, filter, handler) => binder(element, event, filter, handler, false);\n  var unbind = (element, event, handler, useCapture) => {\n    element.dom.removeEventListener(event, handler, useCapture);\n  };\n  var filter = always;\n  var bind = (element, event, handler) => bind$1(element, event, filter, handler);\n  var fromRawEvent = fromRawEvent$1;\n  var hasInternalTarget = e => !has(SugarElement.fromDom(e.target), 'ephox-snooker-resizer-bar');\n  var TableCellSelectionHandler = (editor, resizeHandler) => {\n    var cellSelection = Selections(() => SugarElement.fromDom(editor.getBody()), () => getSelectionCell(getSelectionStart(editor), getIsRoot(editor)), ephemera.selectedSelector);\n    var onSelection = (cells, start, finish) => {\n      var tableOpt = table(start);\n      tableOpt.each(table => {\n        var cloneFormats = getTableCloneElements(editor);\n        var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), cloneFormats);\n        var selectedCells = getCellsFromSelection(editor);\n        var otherCells = getOtherCells(table, {\n          selection: selectedCells\n        }, generators);\n        fireTableSelectionChange(editor, cells, start, finish, otherCells);\n      });\n    };\n    var onClear = () => fireTableSelectionClear(editor);\n    var annotations = SelectionAnnotation.byAttr(ephemera, onSelection, onClear);\n    editor.on('init', _e => {\n      var win = editor.getWin();\n      var body = getBody(editor);\n      var isRoot = getIsRoot(editor);\n      var syncSelection = () => {\n        var sel = editor.selection;\n        var start = SugarElement.fromDom(sel.getStart());\n        var end = SugarElement.fromDom(sel.getEnd());\n        var shared = sharedOne(table, [start, end]);\n        shared.fold(() => annotations.clear(body), noop);\n      };\n      var mouseHandlers = mouse(win, body, isRoot, annotations);\n      var keyHandlers = keyboard(win, body, isRoot, annotations);\n      var external$1 = external(win, body, isRoot, annotations);\n      var hasShiftKey = event => event.raw.shiftKey === true;\n      editor.on('TableSelectorChange', e => external$1(e.start, e.finish));\n      var handleResponse = (event, response) => {\n        if (!hasShiftKey(event)) {\n          return;\n        }\n        if (response.kill) {\n          event.kill();\n        }\n        response.selection.each(ns => {\n          var relative = SimSelection.relative(ns.start, ns.finish);\n          var rng = asLtrRange(win, relative);\n          editor.selection.setRng(rng);\n        });\n      };\n      var keyup = event => {\n        var wrappedEvent = fromRawEvent(event);\n        if (wrappedEvent.raw.shiftKey && isNavigation(wrappedEvent.raw.which)) {\n          var rng = editor.selection.getRng();\n          var start = SugarElement.fromDom(rng.startContainer);\n          var end = SugarElement.fromDom(rng.endContainer);\n          keyHandlers.keyup(wrappedEvent, start, rng.startOffset, end, rng.endOffset).each(response => {\n            handleResponse(wrappedEvent, response);\n          });\n        }\n      };\n      var keydown = event => {\n        var wrappedEvent = fromRawEvent(event);\n        resizeHandler.hide();\n        var rng = editor.selection.getRng();\n        var start = SugarElement.fromDom(rng.startContainer);\n        var end = SugarElement.fromDom(rng.endContainer);\n        var direction = onDirection(ltr, rtl)(SugarElement.fromDom(editor.selection.getStart()));\n        keyHandlers.keydown(wrappedEvent, start, rng.startOffset, end, rng.endOffset, direction).each(response => {\n          handleResponse(wrappedEvent, response);\n        });\n        resizeHandler.show();\n      };\n      var isLeftMouse = raw => raw.button === 0;\n      var isLeftButtonPressed = raw => {\n        if (raw.buttons === undefined) {\n          return true;\n        }\n        return (raw.buttons & 1) !== 0;\n      };\n      var dragStart = _e => {\n        mouseHandlers.clearstate();\n      };\n      var mouseDown = e => {\n        if (isLeftMouse(e) && hasInternalTarget(e)) {\n          mouseHandlers.mousedown(fromRawEvent(e));\n        }\n      };\n      var mouseOver = e => {\n        if (isLeftButtonPressed(e) && hasInternalTarget(e)) {\n          mouseHandlers.mouseover(fromRawEvent(e));\n        }\n      };\n      var mouseUp = e => {\n        if (isLeftMouse(e) && hasInternalTarget(e)) {\n          mouseHandlers.mouseup(fromRawEvent(e));\n        }\n      };\n      var getDoubleTap = () => {\n        var lastTarget = Cell(SugarElement.fromDom(body));\n        var lastTimeStamp = Cell(0);\n        var touchEnd = t => {\n          var target = SugarElement.fromDom(t.target);\n          if (isTag('td')(target) || isTag('th')(target)) {\n            var lT = lastTarget.get();\n            var lTS = lastTimeStamp.get();\n            if (eq$1(lT, target) && t.timeStamp - lTS < 300) {\n              t.preventDefault();\n              external$1(target, target);\n            }\n          }\n          lastTarget.set(target);\n          lastTimeStamp.set(t.timeStamp);\n        };\n        return {\n          touchEnd\n        };\n      };\n      var doubleTap = getDoubleTap();\n      editor.on('dragstart', dragStart);\n      editor.on('mousedown', mouseDown);\n      editor.on('mouseover', mouseOver);\n      editor.on('mouseup', mouseUp);\n      editor.on('touchend', doubleTap.touchEnd);\n      editor.on('keyup', keyup);\n      editor.on('keydown', keydown);\n      editor.on('NodeChange', syncSelection);\n    });\n    editor.on('PreInit', () => {\n      editor.serializer.addTempAttr(ephemera.firstSelected);\n      editor.serializer.addTempAttr(ephemera.lastSelected);\n    });\n    var clearSelectedCells = container => annotations.clear(SugarElement.fromDom(container));\n    var getSelectedCells = () => fold(cellSelection.get(), constant([]), cells => {\n      return map$1(cells, cell => cell.dom);\n    }, cell => [cell.dom]);\n    return {\n      getSelectedCells,\n      clearSelectedCells\n    };\n  };\n  var Event = fields => {\n    var handlers = [];\n    var bind = handler => {\n      if (handler === undefined) {\n        throw new Error('Event bind error: undefined handler');\n      }\n      handlers.push(handler);\n    };\n    var unbind = handler => {\n      handlers = filter$2(handlers, h => {\n        return h !== handler;\n      });\n    };\n    var trigger = function trigger() {\n      for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n      var event = {};\n      each$2(fields, (name, i) => {\n        event[name] = args[i];\n      });\n      each$2(handlers, handler => {\n        handler(event);\n      });\n    };\n    return {\n      bind,\n      unbind,\n      trigger\n    };\n  };\n  var create$1 = typeDefs => {\n    var registry = map(typeDefs, event => {\n      return {\n        bind: event.bind,\n        unbind: event.unbind\n      };\n    });\n    var trigger = map(typeDefs, event => {\n      return event.trigger;\n    });\n    return {\n      registry,\n      trigger\n    };\n  };\n  var last = (fn, rate) => {\n    var timer = null;\n    var cancel = () => {\n      if (!isNull(timer)) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n    var throttle = function throttle() {\n      for (var _len8 = arguments.length, args = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n        args[_key8] = arguments[_key8];\n      }\n      cancel();\n      timer = setTimeout(() => {\n        timer = null;\n        fn.apply(null, args);\n      }, rate);\n    };\n    return {\n      cancel,\n      throttle\n    };\n  };\n  var sort = arr => {\n    return arr.slice(0).sort();\n  };\n  var reqMessage = (required, keys) => {\n    throw new Error('All required keys (' + sort(required).join(', ') + ') were not specified. Specified keys were: ' + sort(keys).join(', ') + '.');\n  };\n  var unsuppMessage = unsupported => {\n    throw new Error('Unsupported keys for object: ' + sort(unsupported).join(', '));\n  };\n  var validateStrArr = (label, array) => {\n    if (!isArray(array)) {\n      throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');\n    }\n    each$2(array, a => {\n      if (!isString(a)) {\n        throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');\n      }\n    });\n  };\n  var invalidTypeMessage = (incorrect, type) => {\n    throw new Error('All values need to be of type: ' + type + '. Keys (' + sort(incorrect).join(', ') + ') were not.');\n  };\n  var checkDupes = everything => {\n    var sorted = sort(everything);\n    var dupe = find$1(sorted, (s, i) => {\n      return i < sorted.length - 1 && s === sorted[i + 1];\n    });\n    dupe.each(d => {\n      throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');\n    });\n  };\n  var base = (handleUnsupported, required) => {\n    return baseWith(handleUnsupported, required, {\n      validate: isFunction,\n      label: 'function'\n    });\n  };\n  var baseWith = (handleUnsupported, required, pred) => {\n    if (required.length === 0) {\n      throw new Error('You must specify at least one required field.');\n    }\n    validateStrArr('required', required);\n    checkDupes(required);\n    return obj => {\n      var keys$1 = keys(obj);\n      var allReqd = forall(required, req => {\n        return contains$2(keys$1, req);\n      });\n      if (!allReqd) {\n        reqMessage(required, keys$1);\n      }\n      handleUnsupported(required, keys$1);\n      var invalidKeys = filter$2(required, key => {\n        return !pred.validate(obj[key], key);\n      });\n      if (invalidKeys.length > 0) {\n        invalidTypeMessage(invalidKeys, pred.label);\n      }\n      return obj;\n    };\n  };\n  var handleExact = (required, keys) => {\n    var unsupported = filter$2(keys, key => {\n      return !contains$2(required, key);\n    });\n    if (unsupported.length > 0) {\n      unsuppMessage(unsupported);\n    }\n  };\n  var exactly = required => base(handleExact, required);\n  var DragMode = exactly(['compare', 'extract', 'mutate', 'sink']);\n  var DragSink = exactly(['element', 'start', 'stop', 'destroy']);\n  var DragApi = exactly(['forceDrop', 'drop', 'move', 'delayDrop']);\n  var InDrag = () => {\n    var previous = Optional.none();\n    var reset = () => {\n      previous = Optional.none();\n    };\n    var update = (mode, nu) => {\n      var result = previous.map(old => {\n        return mode.compare(old, nu);\n      });\n      previous = Optional.some(nu);\n      return result;\n    };\n    var onEvent = (event, mode) => {\n      var dataOption = mode.extract(event);\n      dataOption.each(data => {\n        var offset = update(mode, data);\n        offset.each(d => {\n          events.trigger.move(d);\n        });\n      });\n    };\n    var events = create$1({\n      move: Event(['info'])\n    });\n    return {\n      onEvent,\n      reset,\n      events: events.registry\n    };\n  };\n  var NoDrag = () => {\n    var events = create$1({\n      move: Event(['info'])\n    });\n    return {\n      onEvent: noop,\n      reset: noop,\n      events: events.registry\n    };\n  };\n  var Movement = () => {\n    var noDragState = NoDrag();\n    var inDragState = InDrag();\n    var dragState = noDragState;\n    var on = () => {\n      dragState.reset();\n      dragState = inDragState;\n    };\n    var off = () => {\n      dragState.reset();\n      dragState = noDragState;\n    };\n    var onEvent = (event, mode) => {\n      dragState.onEvent(event, mode);\n    };\n    var isOn = () => {\n      return dragState === inDragState;\n    };\n    return {\n      on,\n      off,\n      isOn,\n      onEvent,\n      events: inDragState.events\n    };\n  };\n  var setup = (mutation, mode, settings) => {\n    var active = false;\n    var events = create$1({\n      start: Event([]),\n      stop: Event([])\n    });\n    var movement = Movement();\n    var drop = () => {\n      sink.stop();\n      if (movement.isOn()) {\n        movement.off();\n        events.trigger.stop();\n      }\n    };\n    var throttledDrop = last(drop, 200);\n    var go = parent => {\n      sink.start(parent);\n      movement.on();\n      events.trigger.start();\n    };\n    var mousemove = event => {\n      throttledDrop.cancel();\n      movement.onEvent(event, mode);\n    };\n    movement.events.move.bind(event => {\n      mode.mutate(mutation, event.info);\n    });\n    var on = () => {\n      active = true;\n    };\n    var off = () => {\n      active = false;\n    };\n    var isActive = () => active;\n    var runIfActive = f => {\n      return function () {\n        if (active) {\n          for (var _len9 = arguments.length, args = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n            args[_key9] = arguments[_key9];\n          }\n          f.apply(null, args);\n        }\n      };\n    };\n    var sink = mode.sink(DragApi({\n      forceDrop: drop,\n      drop: runIfActive(drop),\n      move: runIfActive(mousemove),\n      delayDrop: runIfActive(throttledDrop.throttle)\n    }), settings);\n    var destroy = () => {\n      sink.destroy();\n    };\n    return {\n      element: sink.element,\n      go,\n      on,\n      off,\n      isActive,\n      destroy,\n      events: events.registry\n    };\n  };\n  var css = namespace => {\n    var dashNamespace = namespace.replace(/\\./g, '-');\n    var resolve = str => {\n      return dashNamespace + '-' + str;\n    };\n    return {\n      resolve\n    };\n  };\n  var styles$1 = css('ephox-dragster');\n  var resolve$1 = styles$1.resolve;\n  var Blocker = options => {\n    var settings = _objectSpread({\n      layerClass: resolve$1('blocker')\n    }, options);\n    var div = SugarElement.fromTag('div');\n    set$2(div, 'role', 'presentation');\n    setAll(div, {\n      position: 'fixed',\n      left: '0px',\n      top: '0px',\n      width: '100%',\n      height: '100%'\n    });\n    add(div, resolve$1('blocker'));\n    add(div, settings.layerClass);\n    var element = constant(div);\n    var destroy = () => {\n      remove$6(div);\n    };\n    return {\n      element,\n      destroy\n    };\n  };\n  var compare = (old, nu) => {\n    return SugarPosition(nu.left - old.left, nu.top - old.top);\n  };\n  var extract = event => {\n    return Optional.some(SugarPosition(event.x, event.y));\n  };\n  var mutate = (mutation, info) => {\n    mutation.mutate(info.left, info.top);\n  };\n  var sink = (dragApi, settings) => {\n    var blocker = Blocker(settings);\n    var mdown = bind(blocker.element(), 'mousedown', dragApi.forceDrop);\n    var mup = bind(blocker.element(), 'mouseup', dragApi.drop);\n    var mmove = bind(blocker.element(), 'mousemove', dragApi.move);\n    var mout = bind(blocker.element(), 'mouseout', dragApi.delayDrop);\n    var destroy = () => {\n      blocker.destroy();\n      mup.unbind();\n      mmove.unbind();\n      mout.unbind();\n      mdown.unbind();\n    };\n    var start = parent => {\n      append$1(parent, blocker.element());\n    };\n    var stop = () => {\n      remove$6(blocker.element());\n    };\n    return DragSink({\n      element: blocker.element,\n      start,\n      stop,\n      destroy\n    });\n  };\n  var MouseDrag = DragMode({\n    compare,\n    extract,\n    sink,\n    mutate\n  });\n  var transform = function transform(mutation) {\n    var settings = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var _a;\n    var mode = (_a = settings.mode) !== null && _a !== void 0 ? _a : MouseDrag;\n    return setup(mutation, mode, settings);\n  };\n  var styles = css('ephox-snooker');\n  var resolve = styles.resolve;\n  var Mutation = () => {\n    var events = create$1({\n      drag: Event(['xDelta', 'yDelta'])\n    });\n    var mutate = (x, y) => {\n      events.trigger.drag(x, y);\n    };\n    return {\n      mutate,\n      events: events.registry\n    };\n  };\n  var BarMutation = () => {\n    var events = create$1({\n      drag: Event(['xDelta', 'yDelta', 'target'])\n    });\n    var target = Optional.none();\n    var delegate = Mutation();\n    delegate.events.drag.bind(event => {\n      target.each(t => {\n        events.trigger.drag(event.xDelta, event.yDelta, t);\n      });\n    });\n    var assign = t => {\n      target = Optional.some(t);\n    };\n    var get = () => {\n      return target;\n    };\n    return {\n      assign,\n      get,\n      mutate: delegate.mutate,\n      events: events.registry\n    };\n  };\n  var col = (column, x, y, w, h) => {\n    var bar = SugarElement.fromTag('div');\n    setAll(bar, {\n      position: 'absolute',\n      left: x - w / 2 + 'px',\n      top: y + 'px',\n      height: h + 'px',\n      width: w + 'px'\n    });\n    setAll$1(bar, {\n      'data-column': column,\n      'role': 'presentation'\n    });\n    return bar;\n  };\n  var row = (r, x, y, w, h) => {\n    var bar = SugarElement.fromTag('div');\n    setAll(bar, {\n      position: 'absolute',\n      left: x + 'px',\n      top: y - h / 2 + 'px',\n      height: h + 'px',\n      width: w + 'px'\n    });\n    setAll$1(bar, {\n      'data-row': r,\n      'role': 'presentation'\n    });\n    return bar;\n  };\n  var resizeBar = resolve('resizer-bar');\n  var resizeRowBar = resolve('resizer-rows');\n  var resizeColBar = resolve('resizer-cols');\n  var BAR_THICKNESS = 7;\n  var resizableRows = (warehouse, isResizable) => bind$2(warehouse.all, (row, i) => isResizable(row.element) ? [i] : []);\n  var resizableColumns = (warehouse, isResizable) => {\n    var resizableCols = [];\n    range$1(warehouse.grid.columns, index => {\n      var colElmOpt = Warehouse.getColumnAt(warehouse, index).map(col => col.element);\n      if (colElmOpt.forall(isResizable)) {\n        resizableCols.push(index);\n      }\n    });\n    return filter$2(resizableCols, colIndex => {\n      var columnCells = Warehouse.filterItems(warehouse, cell => cell.column === colIndex);\n      return forall(columnCells, cell => isResizable(cell.element));\n    });\n  };\n  var destroy = wire => {\n    var previous = descendants(wire.parent(), '.' + resizeBar);\n    each$2(previous, remove$6);\n  };\n  var drawBar = (wire, positions, create) => {\n    var origin = wire.origin();\n    each$2(positions, cpOption => {\n      cpOption.each(cp => {\n        var bar = create(origin, cp);\n        add(bar, resizeBar);\n        append$1(wire.parent(), bar);\n      });\n    });\n  };\n  var refreshCol = (wire, colPositions, position, tableHeight) => {\n    drawBar(wire, colPositions, (origin, cp) => {\n      var colBar = col(cp.col, cp.x - origin.left, position.top - origin.top, BAR_THICKNESS, tableHeight);\n      add(colBar, resizeColBar);\n      return colBar;\n    });\n  };\n  var refreshRow = (wire, rowPositions, position, tableWidth) => {\n    drawBar(wire, rowPositions, (origin, cp) => {\n      var rowBar = row(cp.row, position.left - origin.left, cp.y - origin.top, tableWidth, BAR_THICKNESS);\n      add(rowBar, resizeRowBar);\n      return rowBar;\n    });\n  };\n  var refreshGrid = (warhouse, wire, table, rows, cols) => {\n    var position = absolute(table);\n    var isResizable = wire.isResizable;\n    var rowPositions = rows.length > 0 ? height.positions(rows, table) : [];\n    var resizableRowBars = rowPositions.length > 0 ? resizableRows(warhouse, isResizable) : [];\n    var resizableRowPositions = filter$2(rowPositions, (_pos, i) => exists(resizableRowBars, barIndex => i === barIndex));\n    refreshRow(wire, resizableRowPositions, position, getOuter$2(table));\n    var colPositions = cols.length > 0 ? width.positions(cols, table) : [];\n    var resizableColBars = colPositions.length > 0 ? resizableColumns(warhouse, isResizable) : [];\n    var resizableColPositions = filter$2(colPositions, (_pos, i) => exists(resizableColBars, barIndex => i === barIndex));\n    refreshCol(wire, resizableColPositions, position, getOuter$1(table));\n  };\n  var refresh = (wire, table) => {\n    destroy(wire);\n    if (wire.isResizable(table)) {\n      var warehouse = Warehouse.fromTable(table);\n      var _rows$ = rows(warehouse);\n      var cols = columns(warehouse);\n      refreshGrid(warehouse, wire, table, _rows$, cols);\n    }\n  };\n  var each = (wire, f) => {\n    var bars = descendants(wire.parent(), '.' + resizeBar);\n    each$2(bars, f);\n  };\n  var hide = wire => {\n    each(wire, bar => {\n      set$1(bar, 'display', 'none');\n    });\n  };\n  var show = wire => {\n    each(wire, bar => {\n      set$1(bar, 'display', 'block');\n    });\n  };\n  var isRowBar = element => {\n    return has(element, resizeRowBar);\n  };\n  var isColBar = element => {\n    return has(element, resizeColBar);\n  };\n  var resizeBarDragging = resolve('resizer-bar-dragging');\n  var BarManager = wire => {\n    var mutation = BarMutation();\n    var resizing = transform(mutation, {});\n    var hoverTable = Optional.none();\n    var getResizer = (element, type) => {\n      return Optional.from(get$b(element, type));\n    };\n    mutation.events.drag.bind(event => {\n      getResizer(event.target, 'data-row').each(_dataRow => {\n        var currentRow = getCssValue(event.target, 'top');\n        set$1(event.target, 'top', currentRow + event.yDelta + 'px');\n      });\n      getResizer(event.target, 'data-column').each(_dataCol => {\n        var currentCol = getCssValue(event.target, 'left');\n        set$1(event.target, 'left', currentCol + event.xDelta + 'px');\n      });\n    });\n    var getDelta = (target, dir) => {\n      var newX = getCssValue(target, dir);\n      var oldX = getAttrValue(target, 'data-initial-' + dir, 0);\n      return newX - oldX;\n    };\n    resizing.events.stop.bind(() => {\n      mutation.get().each(target => {\n        hoverTable.each(table => {\n          getResizer(target, 'data-row').each(row => {\n            var delta = getDelta(target, 'top');\n            remove$7(target, 'data-initial-top');\n            events.trigger.adjustHeight(table, delta, parseInt(row, 10));\n          });\n          getResizer(target, 'data-column').each(column => {\n            var delta = getDelta(target, 'left');\n            remove$7(target, 'data-initial-left');\n            events.trigger.adjustWidth(table, delta, parseInt(column, 10));\n          });\n          refresh(wire, table);\n        });\n      });\n    });\n    var handler = (target, dir) => {\n      events.trigger.startAdjust();\n      mutation.assign(target);\n      set$2(target, 'data-initial-' + dir, getCssValue(target, dir));\n      add(target, resizeBarDragging);\n      set$1(target, 'opacity', '0.2');\n      resizing.go(wire.parent());\n    };\n    var mousedown = bind(wire.parent(), 'mousedown', event => {\n      if (isRowBar(event.target)) {\n        handler(event.target, 'top');\n      }\n      if (isColBar(event.target)) {\n        handler(event.target, 'left');\n      }\n    });\n    var isRoot = e => {\n      return eq$1(e, wire.view());\n    };\n    var findClosestEditableTable = target => closest$1(target, 'table', isRoot).filter(isEditable$1);\n    var mouseover = bind(wire.view(), 'mouseover', event => {\n      findClosestEditableTable(event.target).fold(() => {\n        if (inBody(event.target)) {\n          destroy(wire);\n        }\n      }, table => {\n        if (resizing.isActive()) {\n          hoverTable = Optional.some(table);\n          refresh(wire, table);\n        }\n      });\n    });\n    var destroy$1 = () => {\n      mousedown.unbind();\n      mouseover.unbind();\n      resizing.destroy();\n      destroy(wire);\n    };\n    var refresh$1 = tbl => {\n      refresh(wire, tbl);\n    };\n    var events = create$1({\n      adjustHeight: Event(['table', 'delta', 'row']),\n      adjustWidth: Event(['table', 'delta', 'column']),\n      startAdjust: Event([])\n    });\n    return {\n      destroy: destroy$1,\n      refresh: refresh$1,\n      on: resizing.on,\n      off: resizing.off,\n      hideBars: curry(hide, wire),\n      showBars: curry(show, wire),\n      events: events.registry\n    };\n  };\n  var create = (wire, resizing, lazySizing) => {\n    var hdirection = height;\n    var vdirection = width;\n    var manager = BarManager(wire);\n    var events = create$1({\n      beforeResize: Event(['table', 'type']),\n      afterResize: Event(['table', 'type']),\n      startDrag: Event([])\n    });\n    manager.events.adjustHeight.bind(event => {\n      var table = event.table;\n      events.trigger.beforeResize(table, 'row');\n      var delta = hdirection.delta(event.delta, table);\n      adjustHeight(table, delta, event.row, hdirection);\n      events.trigger.afterResize(table, 'row');\n    });\n    manager.events.startAdjust.bind(_event => {\n      events.trigger.startDrag();\n    });\n    manager.events.adjustWidth.bind(event => {\n      var table = event.table;\n      events.trigger.beforeResize(table, 'col');\n      var delta = vdirection.delta(event.delta, table);\n      var tableSize = lazySizing(table);\n      adjustWidth(table, delta, event.column, resizing, tableSize);\n      events.trigger.afterResize(table, 'col');\n    });\n    return {\n      on: manager.on,\n      off: manager.off,\n      refreshBars: manager.refresh,\n      hideBars: manager.hideBars,\n      showBars: manager.showBars,\n      destroy: manager.destroy,\n      events: events.registry\n    };\n  };\n  var TableResize = {\n    create\n  };\n  var only = (element, isResizable) => {\n    var parent = isDocument(element) ? documentElement(element) : element;\n    return {\n      parent: constant(parent),\n      view: constant(element),\n      origin: constant(SugarPosition(0, 0)),\n      isResizable\n    };\n  };\n  var detached = (editable, chrome, isResizable) => {\n    var origin = () => absolute(chrome);\n    return {\n      parent: constant(chrome),\n      view: constant(editable),\n      origin,\n      isResizable\n    };\n  };\n  var body = (editable, chrome, isResizable) => {\n    return {\n      parent: constant(chrome),\n      view: constant(editable),\n      origin: constant(SugarPosition(0, 0)),\n      isResizable\n    };\n  };\n  var ResizeWire = {\n    only,\n    detached,\n    body\n  };\n  var createContainer = () => {\n    var container = SugarElement.fromTag('div');\n    setAll(container, {\n      position: 'static',\n      height: '0',\n      width: '0',\n      padding: '0',\n      margin: '0',\n      border: '0'\n    });\n    append$1(body$1(), container);\n    return container;\n  };\n  var get = (editor, isResizable) => {\n    return editor.inline ? ResizeWire.body(SugarElement.fromDom(editor.getBody()), createContainer(), isResizable) : ResizeWire.only(SugarElement.fromDom(editor.getDoc()), isResizable);\n  };\n  var remove = (editor, wire) => {\n    if (editor.inline) {\n      remove$6(wire.parent());\n    }\n  };\n  var isTable = node => isNonNullable(node) && node.nodeName === 'TABLE';\n  var barResizerPrefix = 'bar-';\n  var isResizable = elm => get$b(elm, 'data-mce-resize') !== 'false';\n  var syncPixels = table => {\n    var warehouse = Warehouse.fromTable(table);\n    if (!Warehouse.hasColumns(warehouse)) {\n      each$2(cells$1(table), cell => {\n        var computedWidth = get$a(cell, 'width');\n        set$1(cell, 'width', computedWidth);\n        remove$7(cell, 'width');\n      });\n    }\n  };\n  var TableResizeHandler = editor => {\n    var selectionRng = value();\n    var tableResize = value();\n    var resizeWire = value();\n    var startW;\n    var startRawW;\n    var lazySizing = table => get$5(editor, table);\n    var lazyResizingBehaviour = () => isPreserveTableColumnResizing(editor) ? preserveTable() : resizeTable();\n    var getNumColumns = table => getGridSize(table).columns;\n    var afterCornerResize = (table, origin, width) => {\n      var isRightEdgeResize = endsWith(origin, 'e');\n      if (startRawW === '') {\n        convertToPercentSize(table);\n      }\n      if (width !== startW && startRawW !== '') {\n        set$1(table, 'width', startRawW);\n        var resizing = lazyResizingBehaviour();\n        var tableSize = lazySizing(table);\n        var _col = isPreserveTableColumnResizing(editor) || isRightEdgeResize ? getNumColumns(table) - 1 : 0;\n        adjustWidth(table, width - startW, _col, resizing, tableSize);\n      } else if (isPercentage$1(startRawW)) {\n        var percentW = parseFloat(startRawW.replace('%', ''));\n        var targetPercentW = width * percentW / startW;\n        set$1(table, 'width', targetPercentW + '%');\n      }\n      if (isPixel(startRawW)) {\n        syncPixels(table);\n      }\n    };\n    var destroy = () => {\n      tableResize.on(sz => {\n        sz.destroy();\n      });\n      resizeWire.on(w => {\n        remove(editor, w);\n      });\n    };\n    editor.on('init', () => {\n      var rawWire = get(editor, isResizable);\n      resizeWire.set(rawWire);\n      if (hasTableObjectResizing(editor) && hasTableResizeBars(editor)) {\n        var resizing = lazyResizingBehaviour();\n        var sz = TableResize.create(rawWire, resizing, lazySizing);\n        sz.on();\n        sz.events.startDrag.bind(_event => {\n          selectionRng.set(editor.selection.getRng());\n        });\n        sz.events.beforeResize.bind(event => {\n          var rawTable = event.table.dom;\n          fireObjectResizeStart(editor, rawTable, getPixelWidth(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n        });\n        sz.events.afterResize.bind(event => {\n          var table = event.table;\n          var rawTable = table.dom;\n          removeDataStyle(table);\n          selectionRng.on(rng => {\n            editor.selection.setRng(rng);\n            editor.focus();\n          });\n          fireObjectResized(editor, rawTable, getPixelWidth(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n          editor.undoManager.add();\n        });\n        tableResize.set(sz);\n      }\n    });\n    editor.on('ObjectResizeStart', e => {\n      var targetElm = e.target;\n      if (isTable(targetElm)) {\n        var _table2 = SugarElement.fromDom(targetElm);\n        each$2(editor.dom.select('.mce-clonedresizable'), clone => {\n          editor.dom.addClass(clone, 'mce-' + getTableColumnResizingBehaviour(editor) + '-columns');\n        });\n        if (!isPixelSizing(_table2) && isTablePixelsForced(editor)) {\n          convertToPixelSize(_table2);\n        } else if (!isPercentSizing(_table2) && isTablePercentagesForced(editor)) {\n          convertToPercentSize(_table2);\n        }\n        if (isNoneSizing(_table2) && startsWith(e.origin, barResizerPrefix)) {\n          convertToPercentSize(_table2);\n        }\n        startW = e.width;\n        startRawW = isTableResponsiveForced(editor) ? '' : getRawWidth(editor, targetElm).getOr('');\n      }\n    });\n    editor.on('ObjectResized', e => {\n      var targetElm = e.target;\n      if (isTable(targetElm)) {\n        var _table3 = SugarElement.fromDom(targetElm);\n        var origin = e.origin;\n        if (startsWith(origin, 'corner-')) {\n          afterCornerResize(_table3, origin, e.width);\n        }\n        removeDataStyle(_table3);\n        fireTableModified(editor, _table3.dom, styleModified);\n      }\n    });\n    editor.on('SwitchMode', () => {\n      tableResize.on(resize => {\n        if (editor.mode.isReadOnly()) {\n          resize.hideBars();\n        } else {\n          resize.showBars();\n        }\n      });\n    });\n    editor.on('dragstart dragend', e => {\n      tableResize.on(resize => {\n        if (e.type === 'dragstart') {\n          resize.hideBars();\n          resize.off();\n        } else {\n          resize.on();\n          resize.showBars();\n        }\n      });\n    });\n    editor.on('remove', () => {\n      destroy();\n    });\n    var refresh = table => {\n      tableResize.on(resize => resize.refreshBars(SugarElement.fromDom(table)));\n    };\n    var hide = () => {\n      tableResize.on(resize => resize.hideBars());\n    };\n    var show = () => {\n      tableResize.on(resize => resize.showBars());\n    };\n    return {\n      refresh,\n      hide,\n      show\n    };\n  };\n  var setupTable = editor => {\n    register(editor);\n    var resizeHandler = TableResizeHandler(editor);\n    var cellSelectionHandler = TableCellSelectionHandler(editor, resizeHandler);\n    var actions = TableActions(editor, resizeHandler, cellSelectionHandler);\n    registerCommands(editor, actions);\n    registerQueryCommands(editor, actions);\n    registerEvents(editor, actions);\n    return {\n      getSelectedCells: cellSelectionHandler.getSelectedCells,\n      clearSelectedCells: cellSelectionHandler.clearSelectedCells\n    };\n  };\n  var DomModel = editor => {\n    var table = setupTable(editor);\n    return {\n      table\n    };\n  };\n  var Model = () => {\n    global$1.add('dom', DomModel);\n  };\n  Model();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/models/dom/model.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/code/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/code/index.js ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"code\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/code')\n//   ES2015:\n//     import 'tinymce/plugins/code'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/code/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/code/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/code/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/code/plugin.js ***!
  \*****************************************************/
/***/ (() => {

eval("/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var setContent = (editor, html) => {\n    editor.focus();\n    editor.undoManager.transact(() => {\n      editor.setContent(html);\n    });\n    editor.selection.setCursorLocation();\n    editor.nodeChanged();\n  };\n  var getContent = editor => {\n    return editor.getContent({\n      source_view: true\n    });\n  };\n  var open = editor => {\n    var editorContent = getContent(editor);\n    editor.windowManager.open({\n      title: 'Source Code',\n      size: 'large',\n      body: {\n        type: 'panel',\n        items: [{\n          type: 'textarea',\n          name: 'code'\n        }]\n      },\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: {\n        code: editorContent\n      },\n      onSubmit: api => {\n        setContent(editor, api.getData().code);\n        api.close();\n      }\n    });\n  };\n  var register$1 = editor => {\n    editor.addCommand('mceCodeEditor', () => {\n      open(editor);\n    });\n  };\n  var register = editor => {\n    var onAction = () => editor.execCommand('mceCodeEditor');\n    editor.ui.registry.addButton('code', {\n      icon: 'sourcecode',\n      tooltip: 'Source code',\n      onAction\n    });\n    editor.ui.registry.addMenuItem('code', {\n      icon: 'sourcecode',\n      text: 'Source code',\n      onAction\n    });\n  };\n  var Plugin = () => {\n    global.add('code', editor => {\n      register$1(editor);\n      register(editor);\n      return {};\n    });\n  };\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/code/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/codesample/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/tinymce/plugins/codesample/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"codesample\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/codesample')\n//   ES2015:\n//     import 'tinymce/plugins/codesample'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/codesample/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/codesample/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/codesample/plugin.js":
/*!***********************************************************!*\
  !*** ./node_modules/tinymce/plugins/codesample/plugin.js ***!
  \***********************************************************/
/***/ (() => {

eval("/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global$2 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var isNullable = a => a === null || a === undefined;\n  var isNonNullable = a => !isNullable(a);\n  var noop = () => {};\n  var constant = value => {\n    return () => {\n      return value;\n    };\n  };\n  class Optional {\n    constructor(tag, value) {\n      this.tag = tag;\n      this.value = value;\n    }\n    static some(value) {\n      return new Optional(true, value);\n    }\n    static none() {\n      return Optional.singletonNone;\n    }\n    fold(onNone, onSome) {\n      if (this.tag) {\n        return onSome(this.value);\n      } else {\n        return onNone();\n      }\n    }\n    isSome() {\n      return this.tag;\n    }\n    isNone() {\n      return !this.tag;\n    }\n    map(mapper) {\n      if (this.tag) {\n        return Optional.some(mapper(this.value));\n      } else {\n        return Optional.none();\n      }\n    }\n    bind(binder) {\n      if (this.tag) {\n        return binder(this.value);\n      } else {\n        return Optional.none();\n      }\n    }\n    exists(predicate) {\n      return this.tag && predicate(this.value);\n    }\n    forall(predicate) {\n      return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n      if (!this.tag || predicate(this.value)) {\n        return this;\n      } else {\n        return Optional.none();\n      }\n    }\n    getOr(replacement) {\n      return this.tag ? this.value : replacement;\n    }\n    or(replacement) {\n      return this.tag ? this : replacement;\n    }\n    getOrThunk(thunk) {\n      return this.tag ? this.value : thunk();\n    }\n    orThunk(thunk) {\n      return this.tag ? this : thunk();\n    }\n    getOrDie(message) {\n      if (!this.tag) {\n        throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n      } else {\n        return this.value;\n      }\n    }\n    static from(value) {\n      return isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    getOrNull() {\n      return this.tag ? this.value : null;\n    }\n    getOrUndefined() {\n      return this.value;\n    }\n    each(worker) {\n      if (this.tag) {\n        worker(this.value);\n      }\n    }\n    toArray() {\n      return this.tag ? [this.value] : [];\n    }\n    toString() {\n      return this.tag ? \"some(\".concat(this.value, \")\") : 'none()';\n    }\n  }\n  Optional.singletonNone = new Optional(false);\n  var get$1 = (xs, i) => i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  var head = xs => get$1(xs, 0);\n  var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n  var prismjs = function (global, module, exports) {\n    var oldprism = window.Prism;\n    window.Prism = {\n      manual: true\n    };\n    var _self = typeof window !== 'undefined' ? window : typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope ? self : {};\n    var Prism = function (_self) {\n      var lang = /(?:^|\\s)lang(?:uage)?-([\\w-]+)(?=\\s|$)/i;\n      var uniqueId = 0;\n      var plainTextGrammar = {};\n      var _ = {\n        manual: _self.Prism && _self.Prism.manual,\n        disableWorkerMessageHandler: _self.Prism && _self.Prism.disableWorkerMessageHandler,\n        util: {\n          encode: function encode(tokens) {\n            if (tokens instanceof Token) {\n              return new Token(tokens.type, encode(tokens.content), tokens.alias);\n            } else if (Array.isArray(tokens)) {\n              return tokens.map(encode);\n            } else {\n              return tokens.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\\u00a0/g, ' ');\n            }\n          },\n          type: function type(o) {\n            return Object.prototype.toString.call(o).slice(8, -1);\n          },\n          objId: function objId(obj) {\n            if (!obj['__id']) {\n              Object.defineProperty(obj, '__id', {\n                value: ++uniqueId\n              });\n            }\n            return obj['__id'];\n          },\n          clone: function deepClone(o, visited) {\n            visited = visited || {};\n            var clone;\n            var id;\n            switch (_.util.type(o)) {\n              case 'Object':\n                id = _.util.objId(o);\n                if (visited[id]) {\n                  return visited[id];\n                }\n                clone = {};\n                visited[id] = clone;\n                for (var key in o) {\n                  if (o.hasOwnProperty(key)) {\n                    clone[key] = deepClone(o[key], visited);\n                  }\n                }\n                return clone;\n              case 'Array':\n                id = _.util.objId(o);\n                if (visited[id]) {\n                  return visited[id];\n                }\n                clone = [];\n                visited[id] = clone;\n                o.forEach(function (v, i) {\n                  clone[i] = deepClone(v, visited);\n                });\n                return clone;\n              default:\n                return o;\n            }\n          },\n          getLanguage: function getLanguage(element) {\n            while (element) {\n              var m = lang.exec(element.className);\n              if (m) {\n                return m[1].toLowerCase();\n              }\n              element = element.parentElement;\n            }\n            return 'none';\n          },\n          setLanguage: function setLanguage(element, language) {\n            element.className = element.className.replace(RegExp(lang, 'gi'), '');\n            element.classList.add('language-' + language);\n          },\n          currentScript: function currentScript() {\n            if (typeof document === 'undefined') {\n              return null;\n            }\n            if ('currentScript' in document && 1 < 2) {\n              return document.currentScript;\n            }\n            try {\n              throw new Error();\n            } catch (err) {\n              var src = (/at [^(\\r\\n]*\\((.*):[^:]+:[^:]+\\)$/i.exec(err.stack) || [])[1];\n              if (src) {\n                var scripts = document.getElementsByTagName('script');\n                for (var i in scripts) {\n                  if (scripts[i].src == src) {\n                    return scripts[i];\n                  }\n                }\n              }\n              return null;\n            }\n          },\n          isActive: function isActive(element, className, defaultActivation) {\n            var no = 'no-' + className;\n            while (element) {\n              var classList = element.classList;\n              if (classList.contains(className)) {\n                return true;\n              }\n              if (classList.contains(no)) {\n                return false;\n              }\n              element = element.parentElement;\n            }\n            return !!defaultActivation;\n          }\n        },\n        languages: {\n          plain: plainTextGrammar,\n          plaintext: plainTextGrammar,\n          text: plainTextGrammar,\n          txt: plainTextGrammar,\n          extend: function extend(id, redef) {\n            var lang = _.util.clone(_.languages[id]);\n            for (var key in redef) {\n              lang[key] = redef[key];\n            }\n            return lang;\n          },\n          insertBefore: function insertBefore(inside, before, insert, root) {\n            root = root || _.languages;\n            var grammar = root[inside];\n            var ret = {};\n            for (var token in grammar) {\n              if (grammar.hasOwnProperty(token)) {\n                if (token == before) {\n                  for (var newToken in insert) {\n                    if (insert.hasOwnProperty(newToken)) {\n                      ret[newToken] = insert[newToken];\n                    }\n                  }\n                }\n                if (!insert.hasOwnProperty(token)) {\n                  ret[token] = grammar[token];\n                }\n              }\n            }\n            var old = root[inside];\n            root[inside] = ret;\n            _.languages.DFS(_.languages, function (key, value) {\n              if (value === old && key != inside) {\n                this[key] = ret;\n              }\n            });\n            return ret;\n          },\n          DFS: function DFS(o, callback, type, visited) {\n            visited = visited || {};\n            var objId = _.util.objId;\n            for (var i in o) {\n              if (o.hasOwnProperty(i)) {\n                callback.call(o, i, o[i], type || i);\n                var property = o[i];\n                var propertyType = _.util.type(property);\n                if (propertyType === 'Object' && !visited[objId(property)]) {\n                  visited[objId(property)] = true;\n                  DFS(property, callback, null, visited);\n                } else if (propertyType === 'Array' && !visited[objId(property)]) {\n                  visited[objId(property)] = true;\n                  DFS(property, callback, i, visited);\n                }\n              }\n            }\n          }\n        },\n        plugins: {},\n        highlightAll: function highlightAll(async, callback) {\n          _.highlightAllUnder(document, async, callback);\n        },\n        highlightAllUnder: function highlightAllUnder(container, async, callback) {\n          var env = {\n            callback: callback,\n            container: container,\n            selector: 'code[class*=\"language-\"], [class*=\"language-\"] code, code[class*=\"lang-\"], [class*=\"lang-\"] code'\n          };\n          _.hooks.run('before-highlightall', env);\n          env.elements = Array.prototype.slice.apply(env.container.querySelectorAll(env.selector));\n          _.hooks.run('before-all-elements-highlight', env);\n          for (var i = 0, element; element = env.elements[i++];) {\n            _.highlightElement(element, async === true, env.callback);\n          }\n        },\n        highlightElement: function highlightElement(element, async, callback) {\n          var language = _.util.getLanguage(element);\n          var grammar = _.languages[language];\n          _.util.setLanguage(element, language);\n          var parent = element.parentElement;\n          if (parent && parent.nodeName.toLowerCase() === 'pre') {\n            _.util.setLanguage(parent, language);\n          }\n          var code = element.textContent;\n          var env = {\n            element: element,\n            language: language,\n            grammar: grammar,\n            code: code\n          };\n          function insertHighlightedCode(highlightedCode) {\n            env.highlightedCode = highlightedCode;\n            _.hooks.run('before-insert', env);\n            env.element.innerHTML = env.highlightedCode;\n            _.hooks.run('after-highlight', env);\n            _.hooks.run('complete', env);\n            callback && callback.call(env.element);\n          }\n          _.hooks.run('before-sanity-check', env);\n          parent = env.element.parentElement;\n          if (parent && parent.nodeName.toLowerCase() === 'pre' && !parent.hasAttribute('tabindex')) {\n            parent.setAttribute('tabindex', '0');\n          }\n          if (!env.code) {\n            _.hooks.run('complete', env);\n            callback && callback.call(env.element);\n            return;\n          }\n          _.hooks.run('before-highlight', env);\n          if (!env.grammar) {\n            insertHighlightedCode(_.util.encode(env.code));\n            return;\n          }\n          if (async && _self.Worker) {\n            var worker = new Worker(_.filename);\n            worker.onmessage = function (evt) {\n              insertHighlightedCode(evt.data);\n            };\n            worker.postMessage(JSON.stringify({\n              language: env.language,\n              code: env.code,\n              immediateClose: true\n            }));\n          } else {\n            insertHighlightedCode(_.highlight(env.code, env.grammar, env.language));\n          }\n        },\n        highlight: function highlight(text, grammar, language) {\n          var env = {\n            code: text,\n            grammar: grammar,\n            language: language\n          };\n          _.hooks.run('before-tokenize', env);\n          if (!env.grammar) {\n            throw new Error('The language \"' + env.language + '\" has no grammar.');\n          }\n          env.tokens = _.tokenize(env.code, env.grammar);\n          _.hooks.run('after-tokenize', env);\n          return Token.stringify(_.util.encode(env.tokens), env.language);\n        },\n        tokenize: function tokenize(text, grammar) {\n          var rest = grammar.rest;\n          if (rest) {\n            for (var token in rest) {\n              grammar[token] = rest[token];\n            }\n            delete grammar.rest;\n          }\n          var tokenList = new LinkedList();\n          addAfter(tokenList, tokenList.head, text);\n          matchGrammar(text, tokenList, grammar, tokenList.head, 0);\n          return toArray(tokenList);\n        },\n        hooks: {\n          all: {},\n          add: function add(name, callback) {\n            var hooks = _.hooks.all;\n            hooks[name] = hooks[name] || [];\n            hooks[name].push(callback);\n          },\n          run: function run(name, env) {\n            var callbacks = _.hooks.all[name];\n            if (!callbacks || !callbacks.length) {\n              return;\n            }\n            for (var i = 0, callback; callback = callbacks[i++];) {\n              callback(env);\n            }\n          }\n        },\n        Token: Token\n      };\n      _self.Prism = _;\n      function Token(type, content, alias, matchedStr) {\n        this.type = type;\n        this.content = content;\n        this.alias = alias;\n        this.length = (matchedStr || '').length | 0;\n      }\n      Token.stringify = function stringify(o, language) {\n        if (typeof o == 'string') {\n          return o;\n        }\n        if (Array.isArray(o)) {\n          var s = '';\n          o.forEach(function (e) {\n            s += stringify(e, language);\n          });\n          return s;\n        }\n        var env = {\n          type: o.type,\n          content: stringify(o.content, language),\n          tag: 'span',\n          classes: ['token', o.type],\n          attributes: {},\n          language: language\n        };\n        var aliases = o.alias;\n        if (aliases) {\n          if (Array.isArray(aliases)) {\n            Array.prototype.push.apply(env.classes, aliases);\n          } else {\n            env.classes.push(aliases);\n          }\n        }\n        _.hooks.run('wrap', env);\n        var attributes = '';\n        for (var name in env.attributes) {\n          attributes += ' ' + name + '=\"' + (env.attributes[name] || '').replace(/\"/g, '&quot;') + '\"';\n        }\n        return '<' + env.tag + ' class=\"' + env.classes.join(' ') + '\"' + attributes + '>' + env.content + '</' + env.tag + '>';\n      };\n      function matchPattern(pattern, pos, text, lookbehind) {\n        pattern.lastIndex = pos;\n        var match = pattern.exec(text);\n        if (match && lookbehind && match[1]) {\n          var lookbehindLength = match[1].length;\n          match.index += lookbehindLength;\n          match[0] = match[0].slice(lookbehindLength);\n        }\n        return match;\n      }\n      function matchGrammar(text, tokenList, grammar, startNode, startPos, rematch) {\n        for (var token in grammar) {\n          if (!grammar.hasOwnProperty(token) || !grammar[token]) {\n            continue;\n          }\n          var patterns = grammar[token];\n          patterns = Array.isArray(patterns) ? patterns : [patterns];\n          for (var j = 0; j < patterns.length; ++j) {\n            if (rematch && rematch.cause == token + ',' + j) {\n              return;\n            }\n            var patternObj = patterns[j];\n            var inside = patternObj.inside;\n            var lookbehind = !!patternObj.lookbehind;\n            var greedy = !!patternObj.greedy;\n            var alias = patternObj.alias;\n            if (greedy && !patternObj.pattern.global) {\n              var flags = patternObj.pattern.toString().match(/[imsuy]*$/)[0];\n              patternObj.pattern = RegExp(patternObj.pattern.source, flags + 'g');\n            }\n            var pattern = patternObj.pattern || patternObj;\n            for (var currentNode = startNode.next, pos = startPos; currentNode !== tokenList.tail; pos += currentNode.value.length, currentNode = currentNode.next) {\n              if (rematch && pos >= rematch.reach) {\n                break;\n              }\n              var str = currentNode.value;\n              if (tokenList.length > text.length) {\n                return;\n              }\n              if (str instanceof Token) {\n                continue;\n              }\n              var removeCount = 1;\n              var match;\n              if (greedy) {\n                match = matchPattern(pattern, pos, text, lookbehind);\n                if (!match || match.index >= text.length) {\n                  break;\n                }\n                var from = match.index;\n                var to = match.index + match[0].length;\n                var p = pos;\n                p += currentNode.value.length;\n                while (from >= p) {\n                  currentNode = currentNode.next;\n                  p += currentNode.value.length;\n                }\n                p -= currentNode.value.length;\n                pos = p;\n                if (currentNode.value instanceof Token) {\n                  continue;\n                }\n                for (var k = currentNode; k !== tokenList.tail && (p < to || typeof k.value === 'string'); k = k.next) {\n                  removeCount++;\n                  p += k.value.length;\n                }\n                removeCount--;\n                str = text.slice(pos, p);\n                match.index -= pos;\n              } else {\n                match = matchPattern(pattern, 0, str, lookbehind);\n                if (!match) {\n                  continue;\n                }\n              }\n              var from = match.index;\n              var matchStr = match[0];\n              var before = str.slice(0, from);\n              var after = str.slice(from + matchStr.length);\n              var reach = pos + str.length;\n              if (rematch && reach > rematch.reach) {\n                rematch.reach = reach;\n              }\n              var removeFrom = currentNode.prev;\n              if (before) {\n                removeFrom = addAfter(tokenList, removeFrom, before);\n                pos += before.length;\n              }\n              removeRange(tokenList, removeFrom, removeCount);\n              var wrapped = new Token(token, inside ? _.tokenize(matchStr, inside) : matchStr, alias, matchStr);\n              currentNode = addAfter(tokenList, removeFrom, wrapped);\n              if (after) {\n                addAfter(tokenList, currentNode, after);\n              }\n              if (removeCount > 1) {\n                var nestedRematch = {\n                  cause: token + ',' + j,\n                  reach: reach\n                };\n                matchGrammar(text, tokenList, grammar, currentNode.prev, pos, nestedRematch);\n                if (rematch && nestedRematch.reach > rematch.reach) {\n                  rematch.reach = nestedRematch.reach;\n                }\n              }\n            }\n          }\n        }\n      }\n      function LinkedList() {\n        var head = {\n          value: null,\n          prev: null,\n          next: null\n        };\n        var tail = {\n          value: null,\n          prev: head,\n          next: null\n        };\n        head.next = tail;\n        this.head = head;\n        this.tail = tail;\n        this.length = 0;\n      }\n      function addAfter(list, node, value) {\n        var next = node.next;\n        var newNode = {\n          value: value,\n          prev: node,\n          next: next\n        };\n        node.next = newNode;\n        next.prev = newNode;\n        list.length++;\n        return newNode;\n      }\n      function removeRange(list, node, count) {\n        var next = node.next;\n        for (var i = 0; i < count && next !== list.tail; i++) {\n          next = next.next;\n        }\n        node.next = next;\n        next.prev = node;\n        list.length -= i;\n      }\n      function toArray(list) {\n        var array = [];\n        var node = list.head.next;\n        while (node !== list.tail) {\n          array.push(node.value);\n          node = node.next;\n        }\n        return array;\n      }\n      if (!_self.document) {\n        if (!_self.addEventListener) {\n          return _;\n        }\n        if (!_.disableWorkerMessageHandler) {\n          _self.addEventListener('message', function (evt) {\n            var message = JSON.parse(evt.data);\n            var lang = message.language;\n            var code = message.code;\n            var immediateClose = message.immediateClose;\n            _self.postMessage(_.highlight(code, _.languages[lang], lang));\n            if (immediateClose) {\n              _self.close();\n            }\n          }, false);\n        }\n        return _;\n      }\n      var script = _.util.currentScript();\n      if (script) {\n        _.filename = script.src;\n        if (script.hasAttribute('data-manual')) {\n          _.manual = true;\n        }\n      }\n      function highlightAutomaticallyCallback() {\n        if (!_.manual) {\n          _.highlightAll();\n        }\n      }\n      if (!_.manual) {\n        var readyState = document.readyState;\n        if (readyState === 'loading' || readyState === 'interactive' && script && script.defer) {\n          document.addEventListener('DOMContentLoaded', highlightAutomaticallyCallback);\n        } else {\n          if (window.requestAnimationFrame) {\n            window.requestAnimationFrame(highlightAutomaticallyCallback);\n          } else {\n            window.setTimeout(highlightAutomaticallyCallback, 16);\n          }\n        }\n      }\n      return _;\n    }(_self);\n    if (typeof module !== 'undefined' && module.exports) {\n      module.exports = Prism;\n    }\n    if (typeof global !== 'undefined') {\n      global.Prism = Prism;\n    }\n    Prism.languages.clike = {\n      'comment': [{\n        pattern: /(^|[^\\\\])\\/\\*[\\s\\S]*?(?:\\*\\/|$)/,\n        lookbehind: true,\n        greedy: true\n      }, {\n        pattern: /(^|[^\\\\:])\\/\\/.*/,\n        lookbehind: true,\n        greedy: true\n      }],\n      'string': {\n        pattern: /([\"'])(?:\\\\(?:\\r\\n|[\\s\\S])|(?!\\1)[^\\\\\\r\\n])*\\1/,\n        greedy: true\n      },\n      'class-name': {\n        pattern: /(\\b(?:class|extends|implements|instanceof|interface|new|trait)\\s+|\\bcatch\\s+\\()[\\w.\\\\]+/i,\n        lookbehind: true,\n        inside: {\n          'punctuation': /[.\\\\]/\n        }\n      },\n      'keyword': /\\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\\b/,\n      'boolean': /\\b(?:false|true)\\b/,\n      'function': /\\b\\w+(?=\\()/,\n      'number': /\\b0x[\\da-f]+\\b|(?:\\b\\d+(?:\\.\\d*)?|\\B\\.\\d+)(?:e[+-]?\\d+)?/i,\n      'operator': /[<>]=?|[!=]=?=?|--?|\\+\\+?|&&?|\\|\\|?|[?*/~^%]/,\n      'punctuation': /[{}[\\];(),.:]/\n    };\n    (function (Prism) {\n      function getPlaceholder(language, index) {\n        return '___' + language.toUpperCase() + index + '___';\n      }\n      Object.defineProperties(Prism.languages['markup-templating'] = {}, {\n        buildPlaceholders: {\n          value: function value(env, language, placeholderPattern, replaceFilter) {\n            if (env.language !== language) {\n              return;\n            }\n            var tokenStack = env.tokenStack = [];\n            env.code = env.code.replace(placeholderPattern, function (match) {\n              if (typeof replaceFilter === 'function' && !replaceFilter(match)) {\n                return match;\n              }\n              var i = tokenStack.length;\n              var placeholder;\n              while (env.code.indexOf(placeholder = getPlaceholder(language, i)) !== -1) {\n                ++i;\n              }\n              tokenStack[i] = match;\n              return placeholder;\n            });\n            env.grammar = Prism.languages.markup;\n          }\n        },\n        tokenizePlaceholders: {\n          value: function value(env, language) {\n            if (env.language !== language || !env.tokenStack) {\n              return;\n            }\n            env.grammar = Prism.languages[language];\n            var j = 0;\n            var keys = Object.keys(env.tokenStack);\n            function walkTokens(tokens) {\n              for (var i = 0; i < tokens.length; i++) {\n                if (j >= keys.length) {\n                  break;\n                }\n                var token = tokens[i];\n                if (typeof token === 'string' || token.content && typeof token.content === 'string') {\n                  var k = keys[j];\n                  var t = env.tokenStack[k];\n                  var s = typeof token === 'string' ? token : token.content;\n                  var placeholder = getPlaceholder(language, k);\n                  var index = s.indexOf(placeholder);\n                  if (index > -1) {\n                    ++j;\n                    var before = s.substring(0, index);\n                    var middle = new Prism.Token(language, Prism.tokenize(t, env.grammar), 'language-' + language, t);\n                    var after = s.substring(index + placeholder.length);\n                    var replacement = [];\n                    if (before) {\n                      replacement.push.apply(replacement, walkTokens([before]));\n                    }\n                    replacement.push(middle);\n                    if (after) {\n                      replacement.push.apply(replacement, walkTokens([after]));\n                    }\n                    if (typeof token === 'string') {\n                      tokens.splice.apply(tokens, [i, 1].concat(replacement));\n                    } else {\n                      token.content = replacement;\n                    }\n                  }\n                } else if (token.content) {\n                  walkTokens(token.content);\n                }\n              }\n              return tokens;\n            }\n            walkTokens(env.tokens);\n          }\n        }\n      });\n    })(Prism);\n    Prism.languages.c = Prism.languages.extend('clike', {\n      'comment': {\n        pattern: /\\/\\/(?:[^\\r\\n\\\\]|\\\\(?:\\r\\n?|\\n|(?![\\r\\n])))*|\\/\\*[\\s\\S]*?(?:\\*\\/|$)/,\n        greedy: true\n      },\n      'string': {\n        pattern: /\"(?:\\\\(?:\\r\\n|[\\s\\S])|[^\"\\\\\\r\\n])*\"/,\n        greedy: true\n      },\n      'class-name': {\n        pattern: /(\\b(?:enum|struct)\\s+(?:__attribute__\\s*\\(\\([\\s\\S]*?\\)\\)\\s*)?)\\w+|\\b[a-z]\\w*_t\\b/,\n        lookbehind: true\n      },\n      'keyword': /\\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\\b/,\n      'function': /\\b[a-z_]\\w*(?=\\s*\\()/i,\n      'number': /(?:\\b0x(?:[\\da-f]+(?:\\.[\\da-f]*)?|\\.[\\da-f]+)(?:p[+-]?\\d+)?|(?:\\b\\d+(?:\\.\\d*)?|\\B\\.\\d+)(?:e[+-]?\\d+)?)[ful]{0,4}/i,\n      'operator': />>=?|<<=?|->|([-+&|:])\\1|[?:~]|[-+*/%&|^!=<>]=?/\n    });\n    Prism.languages.insertBefore('c', 'string', {\n      'char': {\n        pattern: /'(?:\\\\(?:\\r\\n|[\\s\\S])|[^'\\\\\\r\\n]){0,32}'/,\n        greedy: true\n      }\n    });\n    Prism.languages.insertBefore('c', 'string', {\n      'macro': {\n        pattern: /(^[\\t ]*)#\\s*[a-z](?:[^\\r\\n\\\\/]|\\/(?!\\*)|\\/\\*(?:[^*]|\\*(?!\\/))*\\*\\/|\\\\(?:\\r\\n|[\\s\\S]))*/im,\n        lookbehind: true,\n        greedy: true,\n        alias: 'property',\n        inside: {\n          'string': [{\n            pattern: /^(#\\s*include\\s*)<[^>]+>/,\n            lookbehind: true\n          }, Prism.languages.c['string']],\n          'char': Prism.languages.c['char'],\n          'comment': Prism.languages.c['comment'],\n          'macro-name': [{\n            pattern: /(^#\\s*define\\s+)\\w+\\b(?!\\()/i,\n            lookbehind: true\n          }, {\n            pattern: /(^#\\s*define\\s+)\\w+\\b(?=\\()/i,\n            lookbehind: true,\n            alias: 'function'\n          }],\n          'directive': {\n            pattern: /^(#\\s*)[a-z]+/,\n            lookbehind: true,\n            alias: 'keyword'\n          },\n          'directive-hash': /^#/,\n          'punctuation': /##|\\\\(?=[\\r\\n])/,\n          'expression': {\n            pattern: /\\S[\\s\\S]*/,\n            inside: Prism.languages.c\n          }\n        }\n      }\n    });\n    Prism.languages.insertBefore('c', 'function', {\n      'constant': /\\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\\b/\n    });\n    delete Prism.languages.c['boolean'];\n    (function (Prism) {\n      var keyword = /\\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|char8_t|class|co_await|co_return|co_yield|compl|concept|const|const_cast|consteval|constexpr|constinit|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|final|float|for|friend|goto|if|import|inline|int|int16_t|int32_t|int64_t|int8_t|long|module|mutable|namespace|new|noexcept|nullptr|operator|override|private|protected|public|register|reinterpret_cast|requires|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|uint16_t|uint32_t|uint64_t|uint8_t|union|unsigned|using|virtual|void|volatile|wchar_t|while)\\b/;\n      var modName = /\\b(?!<keyword>)\\w+(?:\\s*\\.\\s*\\w+)*\\b/.source.replace(/<keyword>/g, function () {\n        return keyword.source;\n      });\n      Prism.languages.cpp = Prism.languages.extend('c', {\n        'class-name': [{\n          pattern: RegExp(/(\\b(?:class|concept|enum|struct|typename)\\s+)(?!<keyword>)\\w+/.source.replace(/<keyword>/g, function () {\n            return keyword.source;\n          })),\n          lookbehind: true\n        }, /\\b[A-Z]\\w*(?=\\s*::\\s*\\w+\\s*\\()/, /\\b[A-Z_]\\w*(?=\\s*::\\s*~\\w+\\s*\\()/i, /\\b\\w+(?=\\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>\\s*::\\s*\\w+\\s*\\()/],\n        'keyword': keyword,\n        'number': {\n          pattern: /(?:\\b0b[01']+|\\b0x(?:[\\da-f']+(?:\\.[\\da-f']*)?|\\.[\\da-f']+)(?:p[+-]?[\\d']+)?|(?:\\b[\\d']+(?:\\.[\\d']*)?|\\B\\.[\\d']+)(?:e[+-]?[\\d']+)?)[ful]{0,4}/i,\n          greedy: true\n        },\n        'operator': />>=?|<<=?|->|--|\\+\\+|&&|\\|\\||[?:~]|<=>|[-+*/%&|^!=<>]=?|\\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\\b/,\n        'boolean': /\\b(?:false|true)\\b/\n      });\n      Prism.languages.insertBefore('cpp', 'string', {\n        'module': {\n          pattern: RegExp(/(\\b(?:import|module)\\s+)/.source + '(?:' + /\"(?:\\\\(?:\\r\\n|[\\s\\S])|[^\"\\\\\\r\\n])*\"|<[^<>\\r\\n]*>/.source + '|' + /<mod-name>(?:\\s*:\\s*<mod-name>)?|:\\s*<mod-name>/.source.replace(/<mod-name>/g, function () {\n            return modName;\n          }) + ')'),\n          lookbehind: true,\n          greedy: true,\n          inside: {\n            'string': /^[<\"][\\s\\S]+/,\n            'operator': /:/,\n            'punctuation': /\\./\n          }\n        },\n        'raw-string': {\n          pattern: /R\"([^()\\\\ ]{0,16})\\([\\s\\S]*?\\)\\1\"/,\n          alias: 'string',\n          greedy: true\n        }\n      });\n      Prism.languages.insertBefore('cpp', 'keyword', {\n        'generic-function': {\n          pattern: /\\b(?!operator\\b)[a-z_]\\w*\\s*<(?:[^<>]|<[^<>]*>)*>(?=\\s*\\()/i,\n          inside: {\n            'function': /^\\w+/,\n            'generic': {\n              pattern: /<[\\s\\S]+/,\n              alias: 'class-name',\n              inside: Prism.languages.cpp\n            }\n          }\n        }\n      });\n      Prism.languages.insertBefore('cpp', 'operator', {\n        'double-colon': {\n          pattern: /::/,\n          alias: 'punctuation'\n        }\n      });\n      Prism.languages.insertBefore('cpp', 'class-name', {\n        'base-clause': {\n          pattern: /(\\b(?:class|struct)\\s+\\w+\\s*:\\s*)[^;{}\"'\\s]+(?:\\s+[^;{}\"'\\s]+)*(?=\\s*[;{])/,\n          lookbehind: true,\n          greedy: true,\n          inside: Prism.languages.extend('cpp', {})\n        }\n      });\n      Prism.languages.insertBefore('inside', 'double-colon', {\n        'class-name': /\\b[a-z_]\\w*\\b(?!\\s*::)/i\n      }, Prism.languages.cpp['base-clause']);\n    })(Prism);\n    (function (Prism) {\n      function replace(pattern, replacements) {\n        return pattern.replace(/<<(\\d+)>>/g, function (m, index) {\n          return '(?:' + replacements[+index] + ')';\n        });\n      }\n      function re(pattern, replacements, flags) {\n        return RegExp(replace(pattern, replacements), flags || '');\n      }\n      function nested(pattern, depthLog2) {\n        for (var i = 0; i < depthLog2; i++) {\n          pattern = pattern.replace(/<<self>>/g, function () {\n            return '(?:' + pattern + ')';\n          });\n        }\n        return pattern.replace(/<<self>>/g, '[^\\\\s\\\\S]');\n      }\n      var keywordKinds = {\n        type: 'bool byte char decimal double dynamic float int long object sbyte short string uint ulong ushort var void',\n        typeDeclaration: 'class enum interface record struct',\n        contextual: 'add alias and ascending async await by descending from(?=\\\\s*(?:\\\\w|$)) get global group into init(?=\\\\s*;) join let nameof not notnull on or orderby partial remove select set unmanaged value when where with(?=\\\\s*{)',\n        other: 'abstract as base break case catch checked const continue default delegate do else event explicit extern finally fixed for foreach goto if implicit in internal is lock namespace new null operator out override params private protected public readonly ref return sealed sizeof stackalloc static switch this throw try typeof unchecked unsafe using virtual volatile while yield'\n      };\n      function keywordsToPattern(words) {\n        return '\\\\b(?:' + words.trim().replace(/ /g, '|') + ')\\\\b';\n      }\n      var typeDeclarationKeywords = keywordsToPattern(keywordKinds.typeDeclaration);\n      var keywords = RegExp(keywordsToPattern(keywordKinds.type + ' ' + keywordKinds.typeDeclaration + ' ' + keywordKinds.contextual + ' ' + keywordKinds.other));\n      var nonTypeKeywords = keywordsToPattern(keywordKinds.typeDeclaration + ' ' + keywordKinds.contextual + ' ' + keywordKinds.other);\n      var nonContextualKeywords = keywordsToPattern(keywordKinds.type + ' ' + keywordKinds.typeDeclaration + ' ' + keywordKinds.other);\n      var generic = nested(/<(?:[^<>;=+\\-*/%&|^]|<<self>>)*>/.source, 2);\n      var nestedRound = nested(/\\((?:[^()]|<<self>>)*\\)/.source, 2);\n      var name = /@?\\b[A-Za-z_]\\w*\\b/.source;\n      var genericName = replace(/<<0>>(?:\\s*<<1>>)?/.source, [name, generic]);\n      var identifier = replace(/(?!<<0>>)<<1>>(?:\\s*\\.\\s*<<1>>)*/.source, [nonTypeKeywords, genericName]);\n      var array = /\\[\\s*(?:,\\s*)*\\]/.source;\n      var typeExpressionWithoutTuple = replace(/<<0>>(?:\\s*(?:\\?\\s*)?<<1>>)*(?:\\s*\\?)?/.source, [identifier, array]);\n      var tupleElement = replace(/[^,()<>[\\];=+\\-*/%&|^]|<<0>>|<<1>>|<<2>>/.source, [generic, nestedRound, array]);\n      var tuple = replace(/\\(<<0>>+(?:,<<0>>+)+\\)/.source, [tupleElement]);\n      var typeExpression = replace(/(?:<<0>>|<<1>>)(?:\\s*(?:\\?\\s*)?<<2>>)*(?:\\s*\\?)?/.source, [tuple, identifier, array]);\n      var typeInside = {\n        'keyword': keywords,\n        'punctuation': /[<>()?,.:[\\]]/\n      };\n      var character = /'(?:[^\\r\\n'\\\\]|\\\\.|\\\\[Uux][\\da-fA-F]{1,8})'/.source;\n      var regularString = /\"(?:\\\\.|[^\\\\\"\\r\\n])*\"/.source;\n      var verbatimString = /@\"(?:\"\"|\\\\[\\s\\S]|[^\\\\\"])*\"(?!\")/.source;\n      Prism.languages.csharp = Prism.languages.extend('clike', {\n        'string': [{\n          pattern: re(/(^|[^$\\\\])<<0>>/.source, [verbatimString]),\n          lookbehind: true,\n          greedy: true\n        }, {\n          pattern: re(/(^|[^@$\\\\])<<0>>/.source, [regularString]),\n          lookbehind: true,\n          greedy: true\n        }],\n        'class-name': [{\n          pattern: re(/(\\busing\\s+static\\s+)<<0>>(?=\\s*;)/.source, [identifier]),\n          lookbehind: true,\n          inside: typeInside\n        }, {\n          pattern: re(/(\\busing\\s+<<0>>\\s*=\\s*)<<1>>(?=\\s*;)/.source, [name, typeExpression]),\n          lookbehind: true,\n          inside: typeInside\n        }, {\n          pattern: re(/(\\busing\\s+)<<0>>(?=\\s*=)/.source, [name]),\n          lookbehind: true\n        }, {\n          pattern: re(/(\\b<<0>>\\s+)<<1>>/.source, [typeDeclarationKeywords, genericName]),\n          lookbehind: true,\n          inside: typeInside\n        }, {\n          pattern: re(/(\\bcatch\\s*\\(\\s*)<<0>>/.source, [identifier]),\n          lookbehind: true,\n          inside: typeInside\n        }, {\n          pattern: re(/(\\bwhere\\s+)<<0>>/.source, [name]),\n          lookbehind: true\n        }, {\n          pattern: re(/(\\b(?:is(?:\\s+not)?|as)\\s+)<<0>>/.source, [typeExpressionWithoutTuple]),\n          lookbehind: true,\n          inside: typeInside\n        }, {\n          pattern: re(/\\b<<0>>(?=\\s+(?!<<1>>|with\\s*\\{)<<2>>(?:\\s*[=,;:{)\\]]|\\s+(?:in|when)\\b))/.source, [typeExpression, nonContextualKeywords, name]),\n          inside: typeInside\n        }],\n        'keyword': keywords,\n        'number': /(?:\\b0(?:x[\\da-f_]*[\\da-f]|b[01_]*[01])|(?:\\B\\.\\d+(?:_+\\d+)*|\\b\\d+(?:_+\\d+)*(?:\\.\\d+(?:_+\\d+)*)?)(?:e[-+]?\\d+(?:_+\\d+)*)?)(?:[dflmu]|lu|ul)?\\b/i,\n        'operator': />>=?|<<=?|[-=]>|([-+&|])\\1|~|\\?\\?=?|[-+*/%&|^!=<>]=?/,\n        'punctuation': /\\?\\.?|::|[{}[\\];(),.:]/\n      });\n      Prism.languages.insertBefore('csharp', 'number', {\n        'range': {\n          pattern: /\\.\\./,\n          alias: 'operator'\n        }\n      });\n      Prism.languages.insertBefore('csharp', 'punctuation', {\n        'named-parameter': {\n          pattern: re(/([(,]\\s*)<<0>>(?=\\s*:)/.source, [name]),\n          lookbehind: true,\n          alias: 'punctuation'\n        }\n      });\n      Prism.languages.insertBefore('csharp', 'class-name', {\n        'namespace': {\n          pattern: re(/(\\b(?:namespace|using)\\s+)<<0>>(?:\\s*\\.\\s*<<0>>)*(?=\\s*[;{])/.source, [name]),\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\./\n          }\n        },\n        'type-expression': {\n          pattern: re(/(\\b(?:default|sizeof|typeof)\\s*\\(\\s*(?!\\s))(?:[^()\\s]|\\s(?!\\s)|<<0>>)*(?=\\s*\\))/.source, [nestedRound]),\n          lookbehind: true,\n          alias: 'class-name',\n          inside: typeInside\n        },\n        'return-type': {\n          pattern: re(/<<0>>(?=\\s+(?:<<1>>\\s*(?:=>|[({]|\\.\\s*this\\s*\\[)|this\\s*\\[))/.source, [typeExpression, identifier]),\n          inside: typeInside,\n          alias: 'class-name'\n        },\n        'constructor-invocation': {\n          pattern: re(/(\\bnew\\s+)<<0>>(?=\\s*[[({])/.source, [typeExpression]),\n          lookbehind: true,\n          inside: typeInside,\n          alias: 'class-name'\n        },\n        'generic-method': {\n          pattern: re(/<<0>>\\s*<<1>>(?=\\s*\\()/.source, [name, generic]),\n          inside: {\n            'function': re(/^<<0>>/.source, [name]),\n            'generic': {\n              pattern: RegExp(generic),\n              alias: 'class-name',\n              inside: typeInside\n            }\n          }\n        },\n        'type-list': {\n          pattern: re(/\\b((?:<<0>>\\s+<<1>>|record\\s+<<1>>\\s*<<5>>|where\\s+<<2>>)\\s*:\\s*)(?:<<3>>|<<4>>|<<1>>\\s*<<5>>|<<6>>)(?:\\s*,\\s*(?:<<3>>|<<4>>|<<6>>))*(?=\\s*(?:where|[{;]|=>|$))/.source, [typeDeclarationKeywords, genericName, name, typeExpression, keywords.source, nestedRound, /\\bnew\\s*\\(\\s*\\)/.source]),\n          lookbehind: true,\n          inside: {\n            'record-arguments': {\n              pattern: re(/(^(?!new\\s*\\()<<0>>\\s*)<<1>>/.source, [genericName, nestedRound]),\n              lookbehind: true,\n              greedy: true,\n              inside: Prism.languages.csharp\n            },\n            'keyword': keywords,\n            'class-name': {\n              pattern: RegExp(typeExpression),\n              greedy: true,\n              inside: typeInside\n            },\n            'punctuation': /[,()]/\n          }\n        },\n        'preprocessor': {\n          pattern: /(^[\\t ]*)#.*/m,\n          lookbehind: true,\n          alias: 'property',\n          inside: {\n            'directive': {\n              pattern: /(#)\\b(?:define|elif|else|endif|endregion|error|if|line|nullable|pragma|region|undef|warning)\\b/,\n              lookbehind: true,\n              alias: 'keyword'\n            }\n          }\n        }\n      });\n      var regularStringOrCharacter = regularString + '|' + character;\n      var regularStringCharacterOrComment = replace(/\\/(?![*/])|\\/\\/[^\\r\\n]*[\\r\\n]|\\/\\*(?:[^*]|\\*(?!\\/))*\\*\\/|<<0>>/.source, [regularStringOrCharacter]);\n      var roundExpression = nested(replace(/[^\"'/()]|<<0>>|\\(<<self>>*\\)/.source, [regularStringCharacterOrComment]), 2);\n      var attrTarget = /\\b(?:assembly|event|field|method|module|param|property|return|type)\\b/.source;\n      var attr = replace(/<<0>>(?:\\s*\\(<<1>>*\\))?/.source, [identifier, roundExpression]);\n      Prism.languages.insertBefore('csharp', 'class-name', {\n        'attribute': {\n          pattern: re(/((?:^|[^\\s\\w>)?])\\s*\\[\\s*)(?:<<0>>\\s*:\\s*)?<<1>>(?:\\s*,\\s*<<1>>)*(?=\\s*\\])/.source, [attrTarget, attr]),\n          lookbehind: true,\n          greedy: true,\n          inside: {\n            'target': {\n              pattern: re(/^<<0>>(?=\\s*:)/.source, [attrTarget]),\n              alias: 'keyword'\n            },\n            'attribute-arguments': {\n              pattern: re(/\\(<<0>>*\\)/.source, [roundExpression]),\n              inside: Prism.languages.csharp\n            },\n            'class-name': {\n              pattern: RegExp(identifier),\n              inside: {\n                'punctuation': /\\./\n              }\n            },\n            'punctuation': /[:,]/\n          }\n        }\n      });\n      var formatString = /:[^}\\r\\n]+/.source;\n      var mInterpolationRound = nested(replace(/[^\"'/()]|<<0>>|\\(<<self>>*\\)/.source, [regularStringCharacterOrComment]), 2);\n      var mInterpolation = replace(/\\{(?!\\{)(?:(?![}:])<<0>>)*<<1>>?\\}/.source, [mInterpolationRound, formatString]);\n      var sInterpolationRound = nested(replace(/[^\"'/()]|\\/(?!\\*)|\\/\\*(?:[^*]|\\*(?!\\/))*\\*\\/|<<0>>|\\(<<self>>*\\)/.source, [regularStringOrCharacter]), 2);\n      var sInterpolation = replace(/\\{(?!\\{)(?:(?![}:])<<0>>)*<<1>>?\\}/.source, [sInterpolationRound, formatString]);\n      function createInterpolationInside(interpolation, interpolationRound) {\n        return {\n          'interpolation': {\n            pattern: re(/((?:^|[^{])(?:\\{\\{)*)<<0>>/.source, [interpolation]),\n            lookbehind: true,\n            inside: {\n              'format-string': {\n                pattern: re(/(^\\{(?:(?![}:])<<0>>)*)<<1>>(?=\\}$)/.source, [interpolationRound, formatString]),\n                lookbehind: true,\n                inside: {\n                  'punctuation': /^:/\n                }\n              },\n              'punctuation': /^\\{|\\}$/,\n              'expression': {\n                pattern: /[\\s\\S]+/,\n                alias: 'language-csharp',\n                inside: Prism.languages.csharp\n              }\n            }\n          },\n          'string': /[\\s\\S]+/\n        };\n      }\n      Prism.languages.insertBefore('csharp', 'string', {\n        'interpolation-string': [{\n          pattern: re(/(^|[^\\\\])(?:\\$@|@\\$)\"(?:\"\"|\\\\[\\s\\S]|\\{\\{|<<0>>|[^\\\\{\"])*\"/.source, [mInterpolation]),\n          lookbehind: true,\n          greedy: true,\n          inside: createInterpolationInside(mInterpolation, mInterpolationRound)\n        }, {\n          pattern: re(/(^|[^@\\\\])\\$\"(?:\\\\.|\\{\\{|<<0>>|[^\\\\\"{])*\"/.source, [sInterpolation]),\n          lookbehind: true,\n          greedy: true,\n          inside: createInterpolationInside(sInterpolation, sInterpolationRound)\n        }],\n        'char': {\n          pattern: RegExp(character),\n          greedy: true\n        }\n      });\n      Prism.languages.dotnet = Prism.languages.cs = Prism.languages.csharp;\n    })(Prism);\n    (function (Prism) {\n      var string = /(?:\"(?:\\\\(?:\\r\\n|[\\s\\S])|[^\"\\\\\\r\\n])*\"|'(?:\\\\(?:\\r\\n|[\\s\\S])|[^'\\\\\\r\\n])*')/;\n      Prism.languages.css = {\n        'comment': /\\/\\*[\\s\\S]*?\\*\\//,\n        'atrule': {\n          pattern: RegExp('@[\\\\w-](?:' + /[^;{\\s\"']|\\s+(?!\\s)/.source + '|' + string.source + ')*?' + /(?:;|(?=\\s*\\{))/.source),\n          inside: {\n            'rule': /^@[\\w-]+/,\n            'selector-function-argument': {\n              pattern: /(\\bselector\\s*\\(\\s*(?![\\s)]))(?:[^()\\s]|\\s+(?![\\s)])|\\((?:[^()]|\\([^()]*\\))*\\))+(?=\\s*\\))/,\n              lookbehind: true,\n              alias: 'selector'\n            },\n            'keyword': {\n              pattern: /(^|[^\\w-])(?:and|not|only|or)(?![\\w-])/,\n              lookbehind: true\n            }\n          }\n        },\n        'url': {\n          pattern: RegExp('\\\\burl\\\\((?:' + string.source + '|' + /(?:[^\\\\\\r\\n()\"']|\\\\[\\s\\S])*/.source + ')\\\\)', 'i'),\n          greedy: true,\n          inside: {\n            'function': /^url/i,\n            'punctuation': /^\\(|\\)$/,\n            'string': {\n              pattern: RegExp('^' + string.source + '$'),\n              alias: 'url'\n            }\n          }\n        },\n        'selector': {\n          pattern: RegExp('(^|[{}\\\\s])[^{}\\\\s](?:[^{};\"\\'\\\\s]|\\\\s+(?![\\\\s{])|' + string.source + ')*(?=\\\\s*\\\\{)'),\n          lookbehind: true\n        },\n        'string': {\n          pattern: string,\n          greedy: true\n        },\n        'property': {\n          pattern: /(^|[^-\\w\\xA0-\\uFFFF])(?!\\s)[-_a-z\\xA0-\\uFFFF](?:(?!\\s)[-\\w\\xA0-\\uFFFF])*(?=\\s*:)/i,\n          lookbehind: true\n        },\n        'important': /!important\\b/i,\n        'function': {\n          pattern: /(^|[^-a-z0-9])[-a-z0-9]+(?=\\()/i,\n          lookbehind: true\n        },\n        'punctuation': /[(){};:,]/\n      };\n      Prism.languages.css['atrule'].inside.rest = Prism.languages.css;\n      var markup = Prism.languages.markup;\n      if (markup) {\n        markup.tag.addInlined('style', 'css');\n        markup.tag.addAttribute('style', 'css');\n      }\n    })(Prism);\n    (function (Prism) {\n      var keywords = /\\b(?:abstract|assert|boolean|break|byte|case|catch|char|class|const|continue|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|non-sealed|null|open|opens|package|permits|private|protected|provides|public|record(?!\\s*[(){}[\\]<>=%~.:,;?+\\-*/&|^])|requires|return|sealed|short|static|strictfp|super|switch|synchronized|this|throw|throws|to|transient|transitive|try|uses|var|void|volatile|while|with|yield)\\b/;\n      var classNamePrefix = /(?:[a-z]\\w*\\s*\\.\\s*)*(?:[A-Z]\\w*\\s*\\.\\s*)*/.source;\n      var className = {\n        pattern: RegExp(/(^|[^\\w.])/.source + classNamePrefix + /[A-Z](?:[\\d_A-Z]*[a-z]\\w*)?\\b/.source),\n        lookbehind: true,\n        inside: {\n          'namespace': {\n            pattern: /^[a-z]\\w*(?:\\s*\\.\\s*[a-z]\\w*)*(?:\\s*\\.)?/,\n            inside: {\n              'punctuation': /\\./\n            }\n          },\n          'punctuation': /\\./\n        }\n      };\n      Prism.languages.java = Prism.languages.extend('clike', {\n        'string': {\n          pattern: /(^|[^\\\\])\"(?:\\\\.|[^\"\\\\\\r\\n])*\"/,\n          lookbehind: true,\n          greedy: true\n        },\n        'class-name': [className, {\n          pattern: RegExp(/(^|[^\\w.])/.source + classNamePrefix + /[A-Z]\\w*(?=\\s+\\w+\\s*[;,=()]|\\s*(?:\\[[\\s,]*\\]\\s*)?::\\s*new\\b)/.source),\n          lookbehind: true,\n          inside: className.inside\n        }, {\n          pattern: RegExp(/(\\b(?:class|enum|extends|implements|instanceof|interface|new|record|throws)\\s+)/.source + classNamePrefix + /[A-Z]\\w*\\b/.source),\n          lookbehind: true,\n          inside: className.inside\n        }],\n        'keyword': keywords,\n        'function': [Prism.languages.clike.function, {\n          pattern: /(::\\s*)[a-z_]\\w*/,\n          lookbehind: true\n        }],\n        'number': /\\b0b[01][01_]*L?\\b|\\b0x(?:\\.[\\da-f_p+-]+|[\\da-f_]+(?:\\.[\\da-f_p+-]+)?)\\b|(?:\\b\\d[\\d_]*(?:\\.[\\d_]*)?|\\B\\.\\d[\\d_]*)(?:e[+-]?\\d[\\d_]*)?[dfl]?/i,\n        'operator': {\n          pattern: /(^|[^.])(?:<<=?|>>>?=?|->|--|\\+\\+|&&|\\|\\||::|[?:~]|[-+*/%&|^!=<>]=?)/m,\n          lookbehind: true\n        },\n        'constant': /\\b[A-Z][A-Z_\\d]+\\b/\n      });\n      Prism.languages.insertBefore('java', 'string', {\n        'triple-quoted-string': {\n          pattern: /\"\"\"[ \\t]*[\\r\\n](?:(?:\"|\"\")?(?:\\\\.|[^\"\\\\]))*\"\"\"/,\n          greedy: true,\n          alias: 'string'\n        },\n        'char': {\n          pattern: /'(?:\\\\.|[^'\\\\\\r\\n]){1,6}'/,\n          greedy: true\n        }\n      });\n      Prism.languages.insertBefore('java', 'class-name', {\n        'annotation': {\n          pattern: /(^|[^.])@\\w+(?:\\s*\\.\\s*\\w+)*/,\n          lookbehind: true,\n          alias: 'punctuation'\n        },\n        'generics': {\n          pattern: /<(?:[\\w\\s,.?]|&(?!&)|<(?:[\\w\\s,.?]|&(?!&)|<(?:[\\w\\s,.?]|&(?!&)|<(?:[\\w\\s,.?]|&(?!&))*>)*>)*>)*>/,\n          inside: {\n            'class-name': className,\n            'keyword': keywords,\n            'punctuation': /[<>(),.:]/,\n            'operator': /[?&|]/\n          }\n        },\n        'import': [{\n          pattern: RegExp(/(\\bimport\\s+)/.source + classNamePrefix + /(?:[A-Z]\\w*|\\*)(?=\\s*;)/.source),\n          lookbehind: true,\n          inside: {\n            'namespace': className.inside.namespace,\n            'punctuation': /\\./,\n            'operator': /\\*/,\n            'class-name': /\\w+/\n          }\n        }, {\n          pattern: RegExp(/(\\bimport\\s+static\\s+)/.source + classNamePrefix + /(?:\\w+|\\*)(?=\\s*;)/.source),\n          lookbehind: true,\n          alias: 'static',\n          inside: {\n            'namespace': className.inside.namespace,\n            'static': /\\b\\w+$/,\n            'punctuation': /\\./,\n            'operator': /\\*/,\n            'class-name': /\\w+/\n          }\n        }],\n        'namespace': {\n          pattern: RegExp(/(\\b(?:exports|import(?:\\s+static)?|module|open|opens|package|provides|requires|to|transitive|uses|with)\\s+)(?!<keyword>)[a-z]\\w*(?:\\.[a-z]\\w*)*\\.?/.source.replace(/<keyword>/g, function () {\n            return keywords.source;\n          })),\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\./\n          }\n        }\n      });\n    })(Prism);\n    Prism.languages.javascript = Prism.languages.extend('clike', {\n      'class-name': [Prism.languages.clike['class-name'], {\n        pattern: /(^|[^$\\w\\xA0-\\uFFFF])(?!\\s)[_$A-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\.(?:constructor|prototype))/,\n        lookbehind: true\n      }],\n      'keyword': [{\n        pattern: /((?:^|\\})\\s*)catch\\b/,\n        lookbehind: true\n      }, {\n        pattern: /(^|[^.]|\\.\\.\\.\\s*)\\b(?:as|assert(?=\\s*\\{)|async(?=\\s*(?:function\\b|\\(|[$\\w\\xA0-\\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\\s*(?:\\{|$))|for|from(?=\\s*(?:['\"]|$))|function|(?:get|set)(?=\\s*(?:[#\\[$\\w\\xA0-\\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\\b/,\n        lookbehind: true\n      }],\n      'function': /#?(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*(?:\\.\\s*(?:apply|bind|call)\\s*)?\\()/,\n      'number': {\n        pattern: RegExp(/(^|[^\\w$])/.source + '(?:' + (/NaN|Infinity/.source + '|' + /0[bB][01]+(?:_[01]+)*n?/.source + '|' + /0[oO][0-7]+(?:_[0-7]+)*n?/.source + '|' + /0[xX][\\dA-Fa-f]+(?:_[\\dA-Fa-f]+)*n?/.source + '|' + /\\d+(?:_\\d+)*n/.source + '|' + /(?:\\d+(?:_\\d+)*(?:\\.(?:\\d+(?:_\\d+)*)?)?|\\.\\d+(?:_\\d+)*)(?:[Ee][+-]?\\d+(?:_\\d+)*)?/.source) + ')' + /(?![\\w$])/.source),\n        lookbehind: true\n      },\n      'operator': /--|\\+\\+|\\*\\*=?|=>|&&=?|\\|\\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\\.{3}|\\?\\?=?|\\?\\.?|[~:]/\n    });\n    Prism.languages.javascript['class-name'][0].pattern = /(\\b(?:class|extends|implements|instanceof|interface|new)\\s+)[\\w.\\\\]+/;\n    Prism.languages.insertBefore('javascript', 'keyword', {\n      'regex': {\n        pattern: RegExp(/((?:^|[^$\\w\\xA0-\\uFFFF.\"'\\])\\s]|\\b(?:return|yield))\\s*)/.source + /\\//.source + '(?:' + /(?:\\[(?:[^\\]\\\\\\r\\n]|\\\\.)*\\]|\\\\.|[^/\\\\\\[\\r\\n])+\\/[dgimyus]{0,7}/.source + '|' + /(?:\\[(?:[^[\\]\\\\\\r\\n]|\\\\.|\\[(?:[^[\\]\\\\\\r\\n]|\\\\.|\\[(?:[^[\\]\\\\\\r\\n]|\\\\.)*\\])*\\])*\\]|\\\\.|[^/\\\\\\[\\r\\n])+\\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source + ')' + /(?=(?:\\s|\\/\\*(?:[^*]|\\*(?!\\/))*\\*\\/)*(?:$|[\\r\\n,.;:})\\]]|\\/\\/))/.source),\n        lookbehind: true,\n        greedy: true,\n        inside: {\n          'regex-source': {\n            pattern: /^(\\/)[\\s\\S]+(?=\\/[a-z]*$)/,\n            lookbehind: true,\n            alias: 'language-regex',\n            inside: Prism.languages.regex\n          },\n          'regex-delimiter': /^\\/|\\/$/,\n          'regex-flags': /^[a-z]+$/\n        }\n      },\n      'function-variable': {\n        pattern: /#?(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*[=:]\\s*(?:async\\s*)?(?:\\bfunction\\b|(?:\\((?:[^()]|\\([^()]*\\))*\\)|(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*)\\s*=>))/,\n        alias: 'function'\n      },\n      'parameter': [{\n        pattern: /(function(?:\\s+(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*)?\\s*\\(\\s*)(?!\\s)(?:[^()\\s]|\\s+(?![\\s)])|\\([^()]*\\))+(?=\\s*\\))/,\n        lookbehind: true,\n        inside: Prism.languages.javascript\n      }, {\n        pattern: /(^|[^$\\w\\xA0-\\uFFFF])(?!\\s)[_$a-z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*=>)/i,\n        lookbehind: true,\n        inside: Prism.languages.javascript\n      }, {\n        pattern: /(\\(\\s*)(?!\\s)(?:[^()\\s]|\\s+(?![\\s)])|\\([^()]*\\))+(?=\\s*\\)\\s*=>)/,\n        lookbehind: true,\n        inside: Prism.languages.javascript\n      }, {\n        pattern: /((?:\\b|\\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\\w\\xA0-\\uFFFF]))(?:(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*\\s*)\\(\\s*|\\]\\s*\\(\\s*)(?!\\s)(?:[^()\\s]|\\s+(?![\\s)])|\\([^()]*\\))+(?=\\s*\\)\\s*\\{)/,\n        lookbehind: true,\n        inside: Prism.languages.javascript\n      }],\n      'constant': /\\b[A-Z](?:[A-Z_]|\\dx?)*\\b/\n    });\n    Prism.languages.insertBefore('javascript', 'string', {\n      'hashbang': {\n        pattern: /^#!.*/,\n        greedy: true,\n        alias: 'comment'\n      },\n      'template-string': {\n        pattern: /`(?:\\\\[\\s\\S]|\\$\\{(?:[^{}]|\\{(?:[^{}]|\\{[^}]*\\})*\\})+\\}|(?!\\$\\{)[^\\\\`])*`/,\n        greedy: true,\n        inside: {\n          'template-punctuation': {\n            pattern: /^`|`$/,\n            alias: 'string'\n          },\n          'interpolation': {\n            pattern: /((?:^|[^\\\\])(?:\\\\{2})*)\\$\\{(?:[^{}]|\\{(?:[^{}]|\\{[^}]*\\})*\\})+\\}/,\n            lookbehind: true,\n            inside: {\n              'interpolation-punctuation': {\n                pattern: /^\\$\\{|\\}$/,\n                alias: 'punctuation'\n              },\n              rest: Prism.languages.javascript\n            }\n          },\n          'string': /[\\s\\S]+/\n        }\n      },\n      'string-property': {\n        pattern: /((?:^|[,{])[ \\t]*)([\"'])(?:\\\\(?:\\r\\n|[\\s\\S])|(?!\\2)[^\\\\\\r\\n])*\\2(?=\\s*:)/m,\n        lookbehind: true,\n        greedy: true,\n        alias: 'property'\n      }\n    });\n    Prism.languages.insertBefore('javascript', 'operator', {\n      'literal-property': {\n        pattern: /((?:^|[,{])[ \\t]*)(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*:)/m,\n        lookbehind: true,\n        alias: 'property'\n      }\n    });\n    if (Prism.languages.markup) {\n      Prism.languages.markup.tag.addInlined('script', 'javascript');\n      Prism.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source, 'javascript');\n    }\n    Prism.languages.js = Prism.languages.javascript;\n    Prism.languages.markup = {\n      'comment': {\n        pattern: /<!--(?:(?!<!--)[\\s\\S])*?-->/,\n        greedy: true\n      },\n      'prolog': {\n        pattern: /<\\?[\\s\\S]+?\\?>/,\n        greedy: true\n      },\n      'doctype': {\n        pattern: /<!DOCTYPE(?:[^>\"'[\\]]|\"[^\"]*\"|'[^']*')+(?:\\[(?:[^<\"'\\]]|\"[^\"]*\"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\\]\\s*)?>/i,\n        greedy: true,\n        inside: {\n          'internal-subset': {\n            pattern: /(^[^\\[]*\\[)[\\s\\S]+(?=\\]>$)/,\n            lookbehind: true,\n            greedy: true,\n            inside: null\n          },\n          'string': {\n            pattern: /\"[^\"]*\"|'[^']*'/,\n            greedy: true\n          },\n          'punctuation': /^<!|>$|[[\\]]/,\n          'doctype-tag': /^DOCTYPE/i,\n          'name': /[^\\s<>'\"]+/\n        }\n      },\n      'cdata': {\n        pattern: /<!\\[CDATA\\[[\\s\\S]*?\\]\\]>/i,\n        greedy: true\n      },\n      'tag': {\n        pattern: /<\\/?(?!\\d)[^\\s>\\/=$<%]+(?:\\s(?:\\s*[^\\s>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+(?=[\\s>]))|(?=[\\s/>])))+)?\\s*\\/?>/,\n        greedy: true,\n        inside: {\n          'tag': {\n            pattern: /^<\\/?[^\\s>\\/]+/,\n            inside: {\n              'punctuation': /^<\\/?/,\n              'namespace': /^[^\\s>\\/:]+:/\n            }\n          },\n          'special-attr': [],\n          'attr-value': {\n            pattern: /=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+)/,\n            inside: {\n              'punctuation': [{\n                pattern: /^=/,\n                alias: 'attr-equals'\n              }, {\n                pattern: /^(\\s*)[\"']|[\"']$/,\n                lookbehind: true\n              }]\n            }\n          },\n          'punctuation': /\\/?>/,\n          'attr-name': {\n            pattern: /[^\\s>\\/]+/,\n            inside: {\n              'namespace': /^[^\\s>\\/:]+:/\n            }\n          }\n        }\n      },\n      'entity': [{\n        pattern: /&[\\da-z]{1,8};/i,\n        alias: 'named-entity'\n      }, /&#x?[\\da-f]{1,8};/i]\n    };\n    Prism.languages.markup['tag'].inside['attr-value'].inside['entity'] = Prism.languages.markup['entity'];\n    Prism.languages.markup['doctype'].inside['internal-subset'].inside = Prism.languages.markup;\n    Prism.hooks.add('wrap', function (env) {\n      if (env.type === 'entity') {\n        env.attributes['title'] = env.content.replace(/&amp;/, '&');\n      }\n    });\n    Object.defineProperty(Prism.languages.markup.tag, 'addInlined', {\n      value: function addInlined(tagName, lang) {\n        var includedCdataInside = {};\n        includedCdataInside['language-' + lang] = {\n          pattern: /(^<!\\[CDATA\\[)[\\s\\S]+?(?=\\]\\]>$)/i,\n          lookbehind: true,\n          inside: Prism.languages[lang]\n        };\n        includedCdataInside['cdata'] = /^<!\\[CDATA\\[|\\]\\]>$/i;\n        var inside = {\n          'included-cdata': {\n            pattern: /<!\\[CDATA\\[[\\s\\S]*?\\]\\]>/i,\n            inside: includedCdataInside\n          }\n        };\n        inside['language-' + lang] = {\n          pattern: /[\\s\\S]+/,\n          inside: Prism.languages[lang]\n        };\n        var def = {};\n        def[tagName] = {\n          pattern: RegExp(/(<__[^>]*>)(?:<!\\[CDATA\\[(?:[^\\]]|\\](?!\\]>))*\\]\\]>|(?!<!\\[CDATA\\[)[\\s\\S])*?(?=<\\/__>)/.source.replace(/__/g, function () {\n            return tagName;\n          }), 'i'),\n          lookbehind: true,\n          greedy: true,\n          inside: inside\n        };\n        Prism.languages.insertBefore('markup', 'cdata', def);\n      }\n    });\n    Object.defineProperty(Prism.languages.markup.tag, 'addAttribute', {\n      value: function value(attrName, lang) {\n        Prism.languages.markup.tag.inside['special-attr'].push({\n          pattern: RegExp(/(^|[\"'\\s])/.source + '(?:' + attrName + ')' + /\\s*=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+(?=[\\s>]))/.source, 'i'),\n          lookbehind: true,\n          inside: {\n            'attr-name': /^[^\\s=]+/,\n            'attr-value': {\n              pattern: /=[\\s\\S]+/,\n              inside: {\n                'value': {\n                  pattern: /(^=\\s*([\"']|(?![\"'])))\\S[\\s\\S]*(?=\\2$)/,\n                  lookbehind: true,\n                  alias: [lang, 'language-' + lang],\n                  inside: Prism.languages[lang]\n                },\n                'punctuation': [{\n                  pattern: /^=/,\n                  alias: 'attr-equals'\n                }, /\"|'/]\n              }\n            }\n          }\n        });\n      }\n    });\n    Prism.languages.html = Prism.languages.markup;\n    Prism.languages.mathml = Prism.languages.markup;\n    Prism.languages.svg = Prism.languages.markup;\n    Prism.languages.xml = Prism.languages.extend('markup', {});\n    Prism.languages.ssml = Prism.languages.xml;\n    Prism.languages.atom = Prism.languages.xml;\n    Prism.languages.rss = Prism.languages.xml;\n    (function (Prism) {\n      var comment = /\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*|#(?!\\[).*/;\n      var constant = [{\n        pattern: /\\b(?:false|true)\\b/i,\n        alias: 'boolean'\n      }, {\n        pattern: /(::\\s*)\\b[a-z_]\\w*\\b(?!\\s*\\()/i,\n        greedy: true,\n        lookbehind: true\n      }, {\n        pattern: /(\\b(?:case|const)\\s+)\\b[a-z_]\\w*(?=\\s*[;=])/i,\n        greedy: true,\n        lookbehind: true\n      }, /\\b(?:null)\\b/i, /\\b[A-Z_][A-Z0-9_]*\\b(?!\\s*\\()/];\n      var number = /\\b0b[01]+(?:_[01]+)*\\b|\\b0o[0-7]+(?:_[0-7]+)*\\b|\\b0x[\\da-f]+(?:_[\\da-f]+)*\\b|(?:\\b\\d+(?:_\\d+)*\\.?(?:\\d+(?:_\\d+)*)?|\\B\\.\\d+)(?:e[+-]?\\d+)?/i;\n      var operator = /<?=>|\\?\\?=?|\\.{3}|\\??->|[!=]=?=?|::|\\*\\*=?|--|\\+\\+|&&|\\|\\||<<|>>|[?~]|[/^|%*&<>.+-]=?/;\n      var punctuation = /[{}\\[\\](),:;]/;\n      Prism.languages.php = {\n        'delimiter': {\n          pattern: /\\?>$|^<\\?(?:php(?=\\s)|=)?/i,\n          alias: 'important'\n        },\n        'comment': comment,\n        'variable': /\\$+(?:\\w+\\b|(?=\\{))/,\n        'package': {\n          pattern: /(namespace\\s+|use\\s+(?:function\\s+)?)(?:\\\\?\\b[a-z_]\\w*)+\\b(?!\\\\)/i,\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        },\n        'class-name-definition': {\n          pattern: /(\\b(?:class|enum|interface|trait)\\s+)\\b[a-z_]\\w*(?!\\\\)\\b/i,\n          lookbehind: true,\n          alias: 'class-name'\n        },\n        'function-definition': {\n          pattern: /(\\bfunction\\s+)[a-z_]\\w*(?=\\s*\\()/i,\n          lookbehind: true,\n          alias: 'function'\n        },\n        'keyword': [{\n          pattern: /(\\(\\s*)\\b(?:array|bool|boolean|float|int|integer|object|string)\\b(?=\\s*\\))/i,\n          alias: 'type-casting',\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /([(,?]\\s*)\\b(?:array(?!\\s*\\()|bool|callable|(?:false|null)(?=\\s*\\|)|float|int|iterable|mixed|object|self|static|string)\\b(?=\\s*\\$)/i,\n          alias: 'type-hint',\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /(\\)\\s*:\\s*(?:\\?\\s*)?)\\b(?:array(?!\\s*\\()|bool|callable|(?:false|null)(?=\\s*\\|)|float|int|iterable|mixed|never|object|self|static|string|void)\\b/i,\n          alias: 'return-type',\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /\\b(?:array(?!\\s*\\()|bool|float|int|iterable|mixed|object|string|void)\\b/i,\n          alias: 'type-declaration',\n          greedy: true\n        }, {\n          pattern: /(\\|\\s*)(?:false|null)\\b|\\b(?:false|null)(?=\\s*\\|)/i,\n          alias: 'type-declaration',\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /\\b(?:parent|self|static)(?=\\s*::)/i,\n          alias: 'static-context',\n          greedy: true\n        }, {\n          pattern: /(\\byield\\s+)from\\b/i,\n          lookbehind: true\n        }, /\\bclass\\b/i, {\n          pattern: /((?:^|[^\\s>:]|(?:^|[^-])>|(?:^|[^:]):)\\s*)\\b(?:abstract|and|array|as|break|callable|case|catch|clone|const|continue|declare|default|die|do|echo|else|elseif|empty|enddeclare|endfor|endforeach|endif|endswitch|endwhile|enum|eval|exit|extends|final|finally|fn|for|foreach|function|global|goto|if|implements|include|include_once|instanceof|insteadof|interface|isset|list|match|namespace|never|new|or|parent|print|private|protected|public|readonly|require|require_once|return|self|static|switch|throw|trait|try|unset|use|var|while|xor|yield|__halt_compiler)\\b/i,\n          lookbehind: true\n        }],\n        'argument-name': {\n          pattern: /([(,]\\s*)\\b[a-z_]\\w*(?=\\s*:(?!:))/i,\n          lookbehind: true\n        },\n        'class-name': [{\n          pattern: /(\\b(?:extends|implements|instanceof|new(?!\\s+self|\\s+static))\\s+|\\bcatch\\s*\\()\\b[a-z_]\\w*(?!\\\\)\\b/i,\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /(\\|\\s*)\\b[a-z_]\\w*(?!\\\\)\\b/i,\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /\\b[a-z_]\\w*(?!\\\\)\\b(?=\\s*\\|)/i,\n          greedy: true\n        }, {\n          pattern: /(\\|\\s*)(?:\\\\?\\b[a-z_]\\w*)+\\b/i,\n          alias: 'class-name-fully-qualified',\n          greedy: true,\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }, {\n          pattern: /(?:\\\\?\\b[a-z_]\\w*)+\\b(?=\\s*\\|)/i,\n          alias: 'class-name-fully-qualified',\n          greedy: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }, {\n          pattern: /(\\b(?:extends|implements|instanceof|new(?!\\s+self\\b|\\s+static\\b))\\s+|\\bcatch\\s*\\()(?:\\\\?\\b[a-z_]\\w*)+\\b(?!\\\\)/i,\n          alias: 'class-name-fully-qualified',\n          greedy: true,\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }, {\n          pattern: /\\b[a-z_]\\w*(?=\\s*\\$)/i,\n          alias: 'type-declaration',\n          greedy: true\n        }, {\n          pattern: /(?:\\\\?\\b[a-z_]\\w*)+(?=\\s*\\$)/i,\n          alias: ['class-name-fully-qualified', 'type-declaration'],\n          greedy: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }, {\n          pattern: /\\b[a-z_]\\w*(?=\\s*::)/i,\n          alias: 'static-context',\n          greedy: true\n        }, {\n          pattern: /(?:\\\\?\\b[a-z_]\\w*)+(?=\\s*::)/i,\n          alias: ['class-name-fully-qualified', 'static-context'],\n          greedy: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }, {\n          pattern: /([(,?]\\s*)[a-z_]\\w*(?=\\s*\\$)/i,\n          alias: 'type-hint',\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /([(,?]\\s*)(?:\\\\?\\b[a-z_]\\w*)+(?=\\s*\\$)/i,\n          alias: ['class-name-fully-qualified', 'type-hint'],\n          greedy: true,\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }, {\n          pattern: /(\\)\\s*:\\s*(?:\\?\\s*)?)\\b[a-z_]\\w*(?!\\\\)\\b/i,\n          alias: 'return-type',\n          greedy: true,\n          lookbehind: true\n        }, {\n          pattern: /(\\)\\s*:\\s*(?:\\?\\s*)?)(?:\\\\?\\b[a-z_]\\w*)+\\b(?!\\\\)/i,\n          alias: ['class-name-fully-qualified', 'return-type'],\n          greedy: true,\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        }],\n        'constant': constant,\n        'function': {\n          pattern: /(^|[^\\\\\\w])\\\\?[a-z_](?:[\\w\\\\]*\\w)?(?=\\s*\\()/i,\n          lookbehind: true,\n          inside: {\n            'punctuation': /\\\\/\n          }\n        },\n        'property': {\n          pattern: /(->\\s*)\\w+/,\n          lookbehind: true\n        },\n        'number': number,\n        'operator': operator,\n        'punctuation': punctuation\n      };\n      var string_interpolation = {\n        pattern: /\\{\\$(?:\\{(?:\\{[^{}]+\\}|[^{}]+)\\}|[^{}])+\\}|(^|[^\\\\{])\\$+(?:\\w+(?:\\[[^\\r\\n\\[\\]]+\\]|->\\w+)?)/,\n        lookbehind: true,\n        inside: Prism.languages.php\n      };\n      var string = [{\n        pattern: /<<<'([^']+)'[\\r\\n](?:.*[\\r\\n])*?\\1;/,\n        alias: 'nowdoc-string',\n        greedy: true,\n        inside: {\n          'delimiter': {\n            pattern: /^<<<'[^']+'|[a-z_]\\w*;$/i,\n            alias: 'symbol',\n            inside: {\n              'punctuation': /^<<<'?|[';]$/\n            }\n          }\n        }\n      }, {\n        pattern: /<<<(?:\"([^\"]+)\"[\\r\\n](?:.*[\\r\\n])*?\\1;|([a-z_]\\w*)[\\r\\n](?:.*[\\r\\n])*?\\2;)/i,\n        alias: 'heredoc-string',\n        greedy: true,\n        inside: {\n          'delimiter': {\n            pattern: /^<<<(?:\"[^\"]+\"|[a-z_]\\w*)|[a-z_]\\w*;$/i,\n            alias: 'symbol',\n            inside: {\n              'punctuation': /^<<<\"?|[\";]$/\n            }\n          },\n          'interpolation': string_interpolation\n        }\n      }, {\n        pattern: /`(?:\\\\[\\s\\S]|[^\\\\`])*`/,\n        alias: 'backtick-quoted-string',\n        greedy: true\n      }, {\n        pattern: /'(?:\\\\[\\s\\S]|[^\\\\'])*'/,\n        alias: 'single-quoted-string',\n        greedy: true\n      }, {\n        pattern: /\"(?:\\\\[\\s\\S]|[^\\\\\"])*\"/,\n        alias: 'double-quoted-string',\n        greedy: true,\n        inside: {\n          'interpolation': string_interpolation\n        }\n      }];\n      Prism.languages.insertBefore('php', 'variable', {\n        'string': string,\n        'attribute': {\n          pattern: /#\\[(?:[^\"'\\/#]|\\/(?![*/])|\\/\\/.*$|#(?!\\[).*$|\\/\\*(?:[^*]|\\*(?!\\/))*\\*\\/|\"(?:\\\\[\\s\\S]|[^\\\\\"])*\"|'(?:\\\\[\\s\\S]|[^\\\\'])*')+\\](?=\\s*[a-z$#])/im,\n          greedy: true,\n          inside: {\n            'attribute-content': {\n              pattern: /^(#\\[)[\\s\\S]+(?=\\]$)/,\n              lookbehind: true,\n              inside: {\n                'comment': comment,\n                'string': string,\n                'attribute-class-name': [{\n                  pattern: /([^:]|^)\\b[a-z_]\\w*(?!\\\\)\\b/i,\n                  alias: 'class-name',\n                  greedy: true,\n                  lookbehind: true\n                }, {\n                  pattern: /([^:]|^)(?:\\\\?\\b[a-z_]\\w*)+/i,\n                  alias: ['class-name', 'class-name-fully-qualified'],\n                  greedy: true,\n                  lookbehind: true,\n                  inside: {\n                    'punctuation': /\\\\/\n                  }\n                }],\n                'constant': constant,\n                'number': number,\n                'operator': operator,\n                'punctuation': punctuation\n              }\n            },\n            'delimiter': {\n              pattern: /^#\\[|\\]$/,\n              alias: 'punctuation'\n            }\n          }\n        }\n      });\n      Prism.hooks.add('before-tokenize', function (env) {\n        if (!/<\\?/.test(env.code)) {\n          return;\n        }\n        var phpPattern = /<\\?(?:[^\"'/#]|\\/(?![*/])|(\"|')(?:\\\\[\\s\\S]|(?!\\1)[^\\\\])*\\1|(?:\\/\\/|#(?!\\[))(?:[^?\\n\\r]|\\?(?!>))*(?=$|\\?>|[\\r\\n])|#\\[|\\/\\*(?:[^*]|\\*(?!\\/))*(?:\\*\\/|$))*?(?:\\?>|$)/g;\n        Prism.languages['markup-templating'].buildPlaceholders(env, 'php', phpPattern);\n      });\n      Prism.hooks.add('after-tokenize', function (env) {\n        Prism.languages['markup-templating'].tokenizePlaceholders(env, 'php');\n      });\n    })(Prism);\n    Prism.languages.python = {\n      'comment': {\n        pattern: /(^|[^\\\\])#.*/,\n        lookbehind: true,\n        greedy: true\n      },\n      'string-interpolation': {\n        pattern: /(?:f|fr|rf)(?:(\"\"\"|''')[\\s\\S]*?\\1|(\"|')(?:\\\\.|(?!\\2)[^\\\\\\r\\n])*\\2)/i,\n        greedy: true,\n        inside: {\n          'interpolation': {\n            pattern: /((?:^|[^{])(?:\\{\\{)*)\\{(?!\\{)(?:[^{}]|\\{(?!\\{)(?:[^{}]|\\{(?!\\{)(?:[^{}])+\\})+\\})+\\}/,\n            lookbehind: true,\n            inside: {\n              'format-spec': {\n                pattern: /(:)[^:(){}]+(?=\\}$)/,\n                lookbehind: true\n              },\n              'conversion-option': {\n                pattern: /![sra](?=[:}]$)/,\n                alias: 'punctuation'\n              },\n              rest: null\n            }\n          },\n          'string': /[\\s\\S]+/\n        }\n      },\n      'triple-quoted-string': {\n        pattern: /(?:[rub]|br|rb)?(\"\"\"|''')[\\s\\S]*?\\1/i,\n        greedy: true,\n        alias: 'string'\n      },\n      'string': {\n        pattern: /(?:[rub]|br|rb)?(\"|')(?:\\\\.|(?!\\1)[^\\\\\\r\\n])*\\1/i,\n        greedy: true\n      },\n      'function': {\n        pattern: /((?:^|\\s)def[ \\t]+)[a-zA-Z_]\\w*(?=\\s*\\()/g,\n        lookbehind: true\n      },\n      'class-name': {\n        pattern: /(\\bclass\\s+)\\w+/i,\n        lookbehind: true\n      },\n      'decorator': {\n        pattern: /(^[\\t ]*)@\\w+(?:\\.\\w+)*/m,\n        lookbehind: true,\n        alias: ['annotation', 'punctuation'],\n        inside: {\n          'punctuation': /\\./\n        }\n      },\n      'keyword': /\\b(?:_(?=\\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\\b/,\n      'builtin': /\\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\\b/,\n      'boolean': /\\b(?:False|None|True)\\b/,\n      'number': /\\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\\b|(?:\\b\\d+(?:_\\d+)*(?:\\.(?:\\d+(?:_\\d+)*)?)?|\\B\\.\\d+(?:_\\d+)*)(?:e[+-]?\\d+(?:_\\d+)*)?j?(?!\\w)/i,\n      'operator': /[-+%=]=?|!=|:=|\\*\\*?=?|\\/\\/?=?|<[<=>]?|>[=>]?|[&|^~]/,\n      'punctuation': /[{}[\\];(),.:]/\n    };\n    Prism.languages.python['string-interpolation'].inside['interpolation'].inside.rest = Prism.languages.python;\n    Prism.languages.py = Prism.languages.python;\n    (function (Prism) {\n      Prism.languages.ruby = Prism.languages.extend('clike', {\n        'comment': {\n          pattern: /#.*|^=begin\\s[\\s\\S]*?^=end/m,\n          greedy: true\n        },\n        'class-name': {\n          pattern: /(\\b(?:class|module)\\s+|\\bcatch\\s+\\()[\\w.\\\\]+|\\b[A-Z_]\\w*(?=\\s*\\.\\s*new\\b)/,\n          lookbehind: true,\n          inside: {\n            'punctuation': /[.\\\\]/\n          }\n        },\n        'keyword': /\\b(?:BEGIN|END|alias|and|begin|break|case|class|def|define_method|defined|do|each|else|elsif|end|ensure|extend|for|if|in|include|module|new|next|nil|not|or|prepend|private|protected|public|raise|redo|require|rescue|retry|return|self|super|then|throw|undef|unless|until|when|while|yield)\\b/,\n        'operator': /\\.{2,3}|&\\.|===|<?=>|[!=]?~|(?:&&|\\|\\||<<|>>|\\*\\*|[+\\-*/%<>!^&|=])=?|[?:]/,\n        'punctuation': /[(){}[\\].,;]/\n      });\n      Prism.languages.insertBefore('ruby', 'operator', {\n        'double-colon': {\n          pattern: /::/,\n          alias: 'punctuation'\n        }\n      });\n      var interpolation = {\n        pattern: /((?:^|[^\\\\])(?:\\\\{2})*)#\\{(?:[^{}]|\\{[^{}]*\\})*\\}/,\n        lookbehind: true,\n        inside: {\n          'content': {\n            pattern: /^(#\\{)[\\s\\S]+(?=\\}$)/,\n            lookbehind: true,\n            inside: Prism.languages.ruby\n          },\n          'delimiter': {\n            pattern: /^#\\{|\\}$/,\n            alias: 'punctuation'\n          }\n        }\n      };\n      delete Prism.languages.ruby.function;\n      var percentExpression = '(?:' + [/([^a-zA-Z0-9\\s{(\\[<=])(?:(?!\\1)[^\\\\]|\\\\[\\s\\S])*\\1/.source, /\\((?:[^()\\\\]|\\\\[\\s\\S]|\\((?:[^()\\\\]|\\\\[\\s\\S])*\\))*\\)/.source, /\\{(?:[^{}\\\\]|\\\\[\\s\\S]|\\{(?:[^{}\\\\]|\\\\[\\s\\S])*\\})*\\}/.source, /\\[(?:[^\\[\\]\\\\]|\\\\[\\s\\S]|\\[(?:[^\\[\\]\\\\]|\\\\[\\s\\S])*\\])*\\]/.source, /<(?:[^<>\\\\]|\\\\[\\s\\S]|<(?:[^<>\\\\]|\\\\[\\s\\S])*>)*>/.source].join('|') + ')';\n      var symbolName = /(?:\"(?:\\\\.|[^\"\\\\\\r\\n])*\"|(?:\\b[a-zA-Z_]\\w*|[^\\s\\0-\\x7F]+)[?!]?|\\$.)/.source;\n      Prism.languages.insertBefore('ruby', 'keyword', {\n        'regex-literal': [{\n          pattern: RegExp(/%r/.source + percentExpression + /[egimnosux]{0,6}/.source),\n          greedy: true,\n          inside: {\n            'interpolation': interpolation,\n            'regex': /[\\s\\S]+/\n          }\n        }, {\n          pattern: /(^|[^/])\\/(?!\\/)(?:\\[[^\\r\\n\\]]+\\]|\\\\.|[^[/\\\\\\r\\n])+\\/[egimnosux]{0,6}(?=\\s*(?:$|[\\r\\n,.;})#]))/,\n          lookbehind: true,\n          greedy: true,\n          inside: {\n            'interpolation': interpolation,\n            'regex': /[\\s\\S]+/\n          }\n        }],\n        'variable': /[@$]+[a-zA-Z_]\\w*(?:[?!]|\\b)/,\n        'symbol': [{\n          pattern: RegExp(/(^|[^:]):/.source + symbolName),\n          lookbehind: true,\n          greedy: true\n        }, {\n          pattern: RegExp(/([\\r\\n{(,][ \\t]*)/.source + symbolName + /(?=:(?!:))/.source),\n          lookbehind: true,\n          greedy: true\n        }],\n        'method-definition': {\n          pattern: /(\\bdef\\s+)\\w+(?:\\s*\\.\\s*\\w+)?/,\n          lookbehind: true,\n          inside: {\n            'function': /\\b\\w+$/,\n            'keyword': /^self\\b/,\n            'class-name': /^\\w+/,\n            'punctuation': /\\./\n          }\n        }\n      });\n      Prism.languages.insertBefore('ruby', 'string', {\n        'string-literal': [{\n          pattern: RegExp(/%[qQiIwWs]?/.source + percentExpression),\n          greedy: true,\n          inside: {\n            'interpolation': interpolation,\n            'string': /[\\s\\S]+/\n          }\n        }, {\n          pattern: /(\"|')(?:#\\{[^}]+\\}|#(?!\\{)|\\\\(?:\\r\\n|[\\s\\S])|(?!\\1)[^\\\\#\\r\\n])*\\1/,\n          greedy: true,\n          inside: {\n            'interpolation': interpolation,\n            'string': /[\\s\\S]+/\n          }\n        }, {\n          pattern: /<<[-~]?([a-z_]\\w*)[\\r\\n](?:.*[\\r\\n])*?[\\t ]*\\1/i,\n          alias: 'heredoc-string',\n          greedy: true,\n          inside: {\n            'delimiter': {\n              pattern: /^<<[-~]?[a-z_]\\w*|\\b[a-z_]\\w*$/i,\n              inside: {\n                'symbol': /\\b\\w+/,\n                'punctuation': /^<<[-~]?/\n              }\n            },\n            'interpolation': interpolation,\n            'string': /[\\s\\S]+/\n          }\n        }, {\n          pattern: /<<[-~]?'([a-z_]\\w*)'[\\r\\n](?:.*[\\r\\n])*?[\\t ]*\\1/i,\n          alias: 'heredoc-string',\n          greedy: true,\n          inside: {\n            'delimiter': {\n              pattern: /^<<[-~]?'[a-z_]\\w*'|\\b[a-z_]\\w*$/i,\n              inside: {\n                'symbol': /\\b\\w+/,\n                'punctuation': /^<<[-~]?'|'$/\n              }\n            },\n            'string': /[\\s\\S]+/\n          }\n        }],\n        'command-literal': [{\n          pattern: RegExp(/%x/.source + percentExpression),\n          greedy: true,\n          inside: {\n            'interpolation': interpolation,\n            'command': {\n              pattern: /[\\s\\S]+/,\n              alias: 'string'\n            }\n          }\n        }, {\n          pattern: /`(?:#\\{[^}]+\\}|#(?!\\{)|\\\\(?:\\r\\n|[\\s\\S])|[^\\\\`#\\r\\n])*`/,\n          greedy: true,\n          inside: {\n            'interpolation': interpolation,\n            'command': {\n              pattern: /[\\s\\S]+/,\n              alias: 'string'\n            }\n          }\n        }]\n      });\n      delete Prism.languages.ruby.string;\n      Prism.languages.insertBefore('ruby', 'number', {\n        'builtin': /\\b(?:Array|Bignum|Binding|Class|Continuation|Dir|Exception|FalseClass|File|Fixnum|Float|Hash|IO|Integer|MatchData|Method|Module|NilClass|Numeric|Object|Proc|Range|Regexp|Stat|String|Struct|Symbol|TMS|Thread|ThreadGroup|Time|TrueClass)\\b/,\n        'constant': /\\b[A-Z][A-Z0-9_]*(?:[?!]|\\b)/\n      });\n      Prism.languages.rb = Prism.languages.ruby;\n    })(Prism);\n    window.Prism = oldprism;\n    return Prism;\n  }(undefined, undefined);\n  var option = name => editor => editor.options.get(name);\n  var register$2 = editor => {\n    var registerOption = editor.options.register;\n    registerOption('codesample_languages', {\n      processor: 'object[]'\n    });\n    registerOption('codesample_global_prismjs', {\n      processor: 'boolean',\n      default: false\n    });\n  };\n  var getLanguages$1 = option('codesample_languages');\n  var useGlobalPrismJS = option('codesample_global_prismjs');\n  var get = editor => Global.Prism && useGlobalPrismJS(editor) ? Global.Prism : prismjs;\n  var isCodeSample = elm => {\n    return isNonNullable(elm) && elm.nodeName === 'PRE' && elm.className.indexOf('language-') !== -1;\n  };\n  var getSelectedCodeSample = editor => {\n    var node = editor.selection ? editor.selection.getNode() : null;\n    return isCodeSample(node) ? Optional.some(node) : Optional.none();\n  };\n  var insertCodeSample = (editor, language, code) => {\n    var dom = editor.dom;\n    editor.undoManager.transact(() => {\n      var node = getSelectedCodeSample(editor);\n      code = global$1.DOM.encode(code);\n      return node.fold(() => {\n        editor.insertContent('<pre id=\"__new\" class=\"language-' + language + '\">' + code + '</pre>');\n        var newPre = dom.select('#__new')[0];\n        dom.setAttrib(newPre, 'id', null);\n        editor.selection.select(newPre);\n      }, n => {\n        dom.setAttrib(n, 'class', 'language-' + language);\n        n.innerHTML = code;\n        get(editor).highlightElement(n);\n        editor.selection.select(n);\n      });\n    });\n  };\n  var getCurrentCode = editor => {\n    var node = getSelectedCodeSample(editor);\n    return node.bind(n => Optional.from(n.textContent)).getOr('');\n  };\n  var getLanguages = editor => {\n    var defaultLanguages = [{\n      text: 'HTML/XML',\n      value: 'markup'\n    }, {\n      text: 'JavaScript',\n      value: 'javascript'\n    }, {\n      text: 'CSS',\n      value: 'css'\n    }, {\n      text: 'PHP',\n      value: 'php'\n    }, {\n      text: 'Ruby',\n      value: 'ruby'\n    }, {\n      text: 'Python',\n      value: 'python'\n    }, {\n      text: 'Java',\n      value: 'java'\n    }, {\n      text: 'C',\n      value: 'c'\n    }, {\n      text: 'C#',\n      value: 'csharp'\n    }, {\n      text: 'C++',\n      value: 'cpp'\n    }];\n    var customLanguages = getLanguages$1(editor);\n    return customLanguages ? customLanguages : defaultLanguages;\n  };\n  var getCurrentLanguage = (editor, fallback) => {\n    var node = getSelectedCodeSample(editor);\n    return node.fold(() => fallback, n => {\n      var matches = n.className.match(/language-(\\w+)/);\n      return matches ? matches[1] : fallback;\n    });\n  };\n  var open = editor => {\n    var languages = getLanguages(editor);\n    var defaultLanguage = head(languages).fold(constant(''), l => l.value);\n    var currentLanguage = getCurrentLanguage(editor, defaultLanguage);\n    var currentCode = getCurrentCode(editor);\n    editor.windowManager.open({\n      title: 'Insert/Edit Code Sample',\n      size: 'large',\n      body: {\n        type: 'panel',\n        items: [{\n          type: 'listbox',\n          name: 'language',\n          label: 'Language',\n          items: languages\n        }, {\n          type: 'textarea',\n          name: 'code',\n          label: 'Code view'\n        }]\n      },\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: {\n        language: currentLanguage,\n        code: currentCode\n      },\n      onSubmit: api => {\n        var data = api.getData();\n        insertCodeSample(editor, data.language, data.code);\n        api.close();\n      }\n    });\n  };\n  var register$1 = editor => {\n    editor.addCommand('codesample', () => {\n      var node = editor.selection.getNode();\n      if (editor.selection.isCollapsed() || isCodeSample(node)) {\n        open(editor);\n      } else {\n        editor.formatter.toggle('code');\n      }\n    });\n  };\n  var blank = r => s => s.replace(r, '');\n  var trim = blank(/^\\s+|\\s+$/g);\n  var global = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var setup = editor => {\n    editor.on('PreProcess', e => {\n      var dom = editor.dom;\n      var pres = dom.select('pre[contenteditable=false]', e.node);\n      global.each(global.grep(pres, isCodeSample), elm => {\n        var code = elm.textContent;\n        dom.setAttrib(elm, 'class', trim(dom.getAttrib(elm, 'class')));\n        dom.setAttrib(elm, 'contentEditable', null);\n        dom.setAttrib(elm, 'data-mce-highlighted', null);\n        var child;\n        while (child = elm.firstChild) {\n          elm.removeChild(child);\n        }\n        var codeElm = dom.add(elm, 'code');\n        codeElm.textContent = code;\n      });\n    });\n    editor.on('SetContent', () => {\n      var dom = editor.dom;\n      var unprocessedCodeSamples = global.grep(dom.select('pre'), elm => {\n        return isCodeSample(elm) && dom.getAttrib(elm, 'data-mce-highlighted') !== 'true';\n      });\n      if (unprocessedCodeSamples.length) {\n        editor.undoManager.transact(() => {\n          global.each(unprocessedCodeSamples, elm => {\n            var _a;\n            global.each(dom.select('br', elm), elm => {\n              dom.replace(editor.getDoc().createTextNode('\\n'), elm);\n            });\n            elm.innerHTML = dom.encode((_a = elm.textContent) !== null && _a !== void 0 ? _a : '');\n            get(editor).highlightElement(elm);\n            dom.setAttrib(elm, 'data-mce-highlighted', true);\n            elm.className = trim(elm.className);\n          });\n        });\n      }\n    });\n    editor.on('PreInit', () => {\n      editor.parser.addNodeFilter('pre', nodes => {\n        var _a;\n        for (var i = 0, l = nodes.length; i < l; i++) {\n          var node = nodes[i];\n          var _isCodeSample = ((_a = node.attr('class')) !== null && _a !== void 0 ? _a : '').indexOf('language-') !== -1;\n          if (_isCodeSample) {\n            node.attr('contenteditable', 'false');\n            node.attr('data-mce-highlighted', 'false');\n          }\n        }\n      });\n    });\n  };\n  var onSetupEditable = function onSetupEditable(editor) {\n    var onChanged = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n    return api => {\n      var nodeChanged = () => {\n        api.setEnabled(editor.selection.isEditable());\n        onChanged(api);\n      };\n      editor.on('NodeChange', nodeChanged);\n      nodeChanged();\n      return () => {\n        editor.off('NodeChange', nodeChanged);\n      };\n    };\n  };\n  var isCodeSampleSelection = editor => {\n    var node = editor.selection.getStart();\n    return editor.dom.is(node, 'pre[class*=\"language-\"]');\n  };\n  var register = editor => {\n    var onAction = () => editor.execCommand('codesample');\n    editor.ui.registry.addToggleButton('codesample', {\n      icon: 'code-sample',\n      tooltip: 'Insert/edit code sample',\n      onAction,\n      onSetup: onSetupEditable(editor, api => {\n        api.setActive(isCodeSampleSelection(editor));\n      })\n    });\n    editor.ui.registry.addMenuItem('codesample', {\n      text: 'Code sample...',\n      icon: 'code-sample',\n      onAction,\n      onSetup: onSetupEditable(editor)\n    });\n  };\n  var Plugin = () => {\n    global$2.add('codesample', editor => {\n      register$2(editor);\n      setup(editor);\n      register(editor);\n      register$1(editor);\n      editor.on('dblclick', ev => {\n        if (isCodeSample(ev.target)) {\n          open(editor);\n        }\n      });\n    });\n  };\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/codesample/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/image/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/image/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"image\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/image')\n//   ES2015:\n//     import 'tinymce/plugins/image'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/image/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/image/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/image/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/image/plugin.js ***!
  \******************************************************/
/***/ (() => {

eval("function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global$4 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var getPrototypeOf = Object.getPrototypeOf;\n  var hasProto = (v, constructor, predicate) => {\n    var _a;\n    if (predicate(v, constructor.prototype)) {\n      return true;\n    } else {\n      return ((_a = v.constructor) === null || _a === void 0 ? void 0 : _a.name) === constructor.name;\n    }\n  };\n  var typeOf = x => {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && Array.isArray(x)) {\n      return 'array';\n    } else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType = type => value => typeOf(value) === type;\n  var isSimpleType = type => value => typeof value === type;\n  var eq = t => a => t === a;\n  var is = (value, constructor) => isObject(value) && hasProto(value, constructor, (o, proto) => getPrototypeOf(o) === proto);\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isPlainObject = value => is(value, Object);\n  var isArray = isType('array');\n  var isNull = eq(null);\n  var isBoolean = isSimpleType('boolean');\n  var isNullable = a => a === null || a === undefined;\n  var isNonNullable = a => !isNullable(a);\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var isArrayOf = (value, pred) => {\n    if (isArray(value)) {\n      for (var i = 0, len = value.length; i < len; ++i) {\n        if (!pred(value[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return false;\n  };\n  var noop = () => {};\n  class Optional {\n    constructor(tag, value) {\n      this.tag = tag;\n      this.value = value;\n    }\n    static some(value) {\n      return new Optional(true, value);\n    }\n    static none() {\n      return Optional.singletonNone;\n    }\n    fold(onNone, onSome) {\n      if (this.tag) {\n        return onSome(this.value);\n      } else {\n        return onNone();\n      }\n    }\n    isSome() {\n      return this.tag;\n    }\n    isNone() {\n      return !this.tag;\n    }\n    map(mapper) {\n      if (this.tag) {\n        return Optional.some(mapper(this.value));\n      } else {\n        return Optional.none();\n      }\n    }\n    bind(binder) {\n      if (this.tag) {\n        return binder(this.value);\n      } else {\n        return Optional.none();\n      }\n    }\n    exists(predicate) {\n      return this.tag && predicate(this.value);\n    }\n    forall(predicate) {\n      return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n      if (!this.tag || predicate(this.value)) {\n        return this;\n      } else {\n        return Optional.none();\n      }\n    }\n    getOr(replacement) {\n      return this.tag ? this.value : replacement;\n    }\n    or(replacement) {\n      return this.tag ? this : replacement;\n    }\n    getOrThunk(thunk) {\n      return this.tag ? this.value : thunk();\n    }\n    orThunk(thunk) {\n      return this.tag ? this : thunk();\n    }\n    getOrDie(message) {\n      if (!this.tag) {\n        throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n      } else {\n        return this.value;\n      }\n    }\n    static from(value) {\n      return isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    getOrNull() {\n      return this.tag ? this.value : null;\n    }\n    getOrUndefined() {\n      return this.value;\n    }\n    each(worker) {\n      if (this.tag) {\n        worker(this.value);\n      }\n    }\n    toArray() {\n      return this.tag ? [this.value] : [];\n    }\n    toString() {\n      return this.tag ? \"some(\".concat(this.value, \")\") : 'none()';\n    }\n  }\n  Optional.singletonNone = new Optional(false);\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n  var each = (obj, f) => {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var objAcc = r => (x, i) => {\n    r[i] = x;\n  };\n  var internalFilter = (obj, pred, onTrue, onFalse) => {\n    each(obj, (x, i) => {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n  };\n  var filter = (obj, pred) => {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  var has = (obj, key) => hasOwnProperty.call(obj, key);\n  var hasNonNullableKey = (obj, key) => has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  var nativePush = Array.prototype.push;\n  var flatten = xs => {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var get = (xs, i) => i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  var head = xs => get(xs, 0);\n  var findMap = (arr, f) => {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n      if (r.isSome()) {\n        return r;\n      }\n    }\n    return Optional.none();\n  };\n  typeof window !== 'undefined' ? window : Function('return this;')();\n  var rawSet = (dom, key, value) => {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n  var set = (element, key, value) => {\n    rawSet(element.dom, key, value);\n  };\n  var remove = (element, key) => {\n    element.dom.removeAttribute(key);\n  };\n  var fromHtml = (html, scope) => {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      var message = 'HTML does not have a single root node';\n      console.error(message, html);\n      throw new Error(message);\n    }\n    return fromDom(div.childNodes[0]);\n  };\n  var fromTag = (tag, scope) => {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n  var fromText = (text, scope) => {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n  var fromDom = node => {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n    return {\n      dom: node\n    };\n  };\n  var fromPoint = (docElm, x, y) => Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  var SugarElement = {\n    fromHtml,\n    fromTag,\n    fromText,\n    fromDom,\n    fromPoint\n  };\n  var global$3 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.URI');\n  var isNotEmpty = s => s.length > 0;\n  var option = name => editor => editor.options.get(name);\n  var register$2 = editor => {\n    var registerOption = editor.options.register;\n    registerOption('image_dimensions', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('image_advtab', {\n      processor: 'boolean',\n      default: false\n    });\n    registerOption('image_uploadtab', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('image_prepend_url', {\n      processor: 'string',\n      default: ''\n    });\n    registerOption('image_class_list', {\n      processor: 'object[]'\n    });\n    registerOption('image_description', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('image_title', {\n      processor: 'boolean',\n      default: false\n    });\n    registerOption('image_caption', {\n      processor: 'boolean',\n      default: false\n    });\n    registerOption('image_list', {\n      processor: value => {\n        var valid = value === false || isString(value) || isArrayOf(value, isObject) || isFunction(value);\n        return valid ? {\n          value,\n          valid\n        } : {\n          valid: false,\n          message: 'Must be false, a string, an array or a function.'\n        };\n      },\n      default: false\n    });\n  };\n  var hasDimensions = option('image_dimensions');\n  var hasAdvTab = option('image_advtab');\n  var hasUploadTab = option('image_uploadtab');\n  var getPrependUrl = option('image_prepend_url');\n  var getClassList = option('image_class_list');\n  var hasDescription = option('image_description');\n  var hasImageTitle = option('image_title');\n  var hasImageCaption = option('image_caption');\n  var getImageList = option('image_list');\n  var showAccessibilityOptions = option('a11y_advanced_options');\n  var isAutomaticUploadsEnabled = option('automatic_uploads');\n  var hasUploadUrl = editor => isNotEmpty(editor.options.get('images_upload_url'));\n  var hasUploadHandler = editor => isNonNullable(editor.options.get('images_upload_handler'));\n  var parseIntAndGetMax = (val1, val2) => Math.max(parseInt(val1, 10), parseInt(val2, 10));\n  var getImageSize = url => new Promise(callback => {\n    var img = document.createElement('img');\n    var done = dimensions => {\n      img.onload = img.onerror = null;\n      if (img.parentNode) {\n        img.parentNode.removeChild(img);\n      }\n      callback(dimensions);\n    };\n    img.onload = () => {\n      var width = parseIntAndGetMax(img.width, img.clientWidth);\n      var height = parseIntAndGetMax(img.height, img.clientHeight);\n      var dimensions = {\n        width,\n        height\n      };\n      done(Promise.resolve(dimensions));\n    };\n    img.onerror = () => {\n      done(Promise.reject(\"Failed to get image dimensions for: \".concat(url)));\n    };\n    var style = img.style;\n    style.visibility = 'hidden';\n    style.position = 'fixed';\n    style.bottom = style.left = '0px';\n    style.width = style.height = 'auto';\n    document.body.appendChild(img);\n    img.src = url;\n  });\n  var removePixelSuffix = value => {\n    if (value) {\n      value = value.replace(/px$/, '');\n    }\n    return value;\n  };\n  var addPixelSuffix = value => {\n    if (value.length > 0 && /^[0-9]+$/.test(value)) {\n      value += 'px';\n    }\n    return value;\n  };\n  var mergeMargins = css => {\n    if (css.margin) {\n      var splitMargin = String(css.margin).split(' ');\n      switch (splitMargin.length) {\n        case 1:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[0];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[0];\n          break;\n        case 2:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n        case 3:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n        case 4:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[3];\n      }\n      delete css.margin;\n    }\n    return css;\n  };\n  var createImageList = (editor, callback) => {\n    var imageList = getImageList(editor);\n    if (isString(imageList)) {\n      fetch(imageList).then(res => {\n        if (res.ok) {\n          res.json().then(callback);\n        }\n      });\n    } else if (isFunction(imageList)) {\n      imageList(callback);\n    } else {\n      callback(imageList);\n    }\n  };\n  var waitLoadImage = (editor, data, imgElm) => {\n    var selectImage = () => {\n      imgElm.onload = imgElm.onerror = null;\n      if (editor.selection) {\n        editor.selection.select(imgElm);\n        editor.nodeChanged();\n      }\n    };\n    imgElm.onload = () => {\n      if (!data.width && !data.height && hasDimensions(editor)) {\n        editor.dom.setAttribs(imgElm, {\n          width: String(imgElm.clientWidth),\n          height: String(imgElm.clientHeight)\n        });\n      }\n      selectImage();\n    };\n    imgElm.onerror = selectImage;\n  };\n  var blobToDataUri = blob => new Promise((resolve, reject) => {\n    var reader = new FileReader();\n    reader.onload = () => {\n      resolve(reader.result);\n    };\n    reader.onerror = () => {\n      var _a;\n      reject((_a = reader.error) === null || _a === void 0 ? void 0 : _a.message);\n    };\n    reader.readAsDataURL(blob);\n  });\n  var isPlaceholderImage = imgElm => imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));\n  var isSafeImageUrl = (editor, src) => {\n    var getOption = editor.options.get;\n    return global$2.isDomSafe(src, 'img', {\n      allow_html_data_urls: getOption('allow_html_data_urls'),\n      allow_script_urls: getOption('allow_script_urls'),\n      allow_svg_data_urls: getOption('allow_svg_data_urls')\n    });\n  };\n  var DOM = global$3.DOM;\n  var getHspace = image => {\n    if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {\n      return removePixelSuffix(image.style.marginLeft);\n    } else {\n      return '';\n    }\n  };\n  var getVspace = image => {\n    if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {\n      return removePixelSuffix(image.style.marginTop);\n    } else {\n      return '';\n    }\n  };\n  var getBorder = image => {\n    if (image.style.borderWidth) {\n      return removePixelSuffix(image.style.borderWidth);\n    } else {\n      return '';\n    }\n  };\n  var getAttrib = (image, name) => {\n    var _a;\n    if (image.hasAttribute(name)) {\n      return (_a = image.getAttribute(name)) !== null && _a !== void 0 ? _a : '';\n    } else {\n      return '';\n    }\n  };\n  var hasCaption = image => image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';\n  var updateAttrib = (image, name, value) => {\n    if (value === '' || value === null) {\n      image.removeAttribute(name);\n    } else {\n      image.setAttribute(name, value);\n    }\n  };\n  var wrapInFigure = image => {\n    var figureElm = DOM.create('figure', {\n      class: 'image'\n    });\n    DOM.insertAfter(figureElm, image);\n    figureElm.appendChild(image);\n    figureElm.appendChild(DOM.create('figcaption', {\n      contentEditable: 'true'\n    }, 'Caption'));\n    figureElm.contentEditable = 'false';\n  };\n  var removeFigure = image => {\n    var figureElm = image.parentNode;\n    if (isNonNullable(figureElm)) {\n      DOM.insertAfter(image, figureElm);\n      DOM.remove(figureElm);\n    }\n  };\n  var toggleCaption = image => {\n    if (hasCaption(image)) {\n      removeFigure(image);\n    } else {\n      wrapInFigure(image);\n    }\n  };\n  var normalizeStyle = (image, normalizeCss) => {\n    var attrValue = image.getAttribute('style');\n    var value = normalizeCss(attrValue !== null ? attrValue : '');\n    if (value.length > 0) {\n      image.setAttribute('style', value);\n      image.setAttribute('data-mce-style', value);\n    } else {\n      image.removeAttribute('style');\n    }\n  };\n  var setSize = (name, normalizeCss) => (image, name, value) => {\n    var styles = image.style;\n    if (styles[name]) {\n      styles[name] = addPixelSuffix(value);\n      normalizeStyle(image, normalizeCss);\n    } else {\n      updateAttrib(image, name, value);\n    }\n  };\n  var getSize = (image, name) => {\n    if (image.style[name]) {\n      return removePixelSuffix(image.style[name]);\n    } else {\n      return getAttrib(image, name);\n    }\n  };\n  var setHspace = (image, value) => {\n    var pxValue = addPixelSuffix(value);\n    image.style.marginLeft = pxValue;\n    image.style.marginRight = pxValue;\n  };\n  var setVspace = (image, value) => {\n    var pxValue = addPixelSuffix(value);\n    image.style.marginTop = pxValue;\n    image.style.marginBottom = pxValue;\n  };\n  var setBorder = (image, value) => {\n    var pxValue = addPixelSuffix(value);\n    image.style.borderWidth = pxValue;\n  };\n  var setBorderStyle = (image, value) => {\n    image.style.borderStyle = value;\n  };\n  var getBorderStyle = image => {\n    var _a;\n    return (_a = image.style.borderStyle) !== null && _a !== void 0 ? _a : '';\n  };\n  var isFigure = elm => isNonNullable(elm) && elm.nodeName === 'FIGURE';\n  var isImage = elm => elm.nodeName === 'IMG';\n  var getIsDecorative = image => DOM.getAttrib(image, 'alt').length === 0 && DOM.getAttrib(image, 'role') === 'presentation';\n  var getAlt = image => {\n    if (getIsDecorative(image)) {\n      return '';\n    } else {\n      return getAttrib(image, 'alt');\n    }\n  };\n  var defaultData = () => ({\n    src: '',\n    alt: '',\n    title: '',\n    width: '',\n    height: '',\n    class: '',\n    style: '',\n    caption: false,\n    hspace: '',\n    vspace: '',\n    border: '',\n    borderStyle: '',\n    isDecorative: false\n  });\n  var getStyleValue = (normalizeCss, data) => {\n    var _a;\n    var image = document.createElement('img');\n    updateAttrib(image, 'style', data.style);\n    if (getHspace(image) || data.hspace !== '') {\n      setHspace(image, data.hspace);\n    }\n    if (getVspace(image) || data.vspace !== '') {\n      setVspace(image, data.vspace);\n    }\n    if (getBorder(image) || data.border !== '') {\n      setBorder(image, data.border);\n    }\n    if (getBorderStyle(image) || data.borderStyle !== '') {\n      setBorderStyle(image, data.borderStyle);\n    }\n    return normalizeCss((_a = image.getAttribute('style')) !== null && _a !== void 0 ? _a : '');\n  };\n  var create = (normalizeCss, data) => {\n    var image = document.createElement('img');\n    write(normalizeCss, _objectSpread(_objectSpread({}, data), {}, {\n      caption: false\n    }), image);\n    setAlt(image, data.alt, data.isDecorative);\n    if (data.caption) {\n      var figure = DOM.create('figure', {\n        class: 'image'\n      });\n      figure.appendChild(image);\n      figure.appendChild(DOM.create('figcaption', {\n        contentEditable: 'true'\n      }, 'Caption'));\n      figure.contentEditable = 'false';\n      return figure;\n    } else {\n      return image;\n    }\n  };\n  var read = (normalizeCss, image) => ({\n    src: getAttrib(image, 'src'),\n    alt: getAlt(image),\n    title: getAttrib(image, 'title'),\n    width: getSize(image, 'width'),\n    height: getSize(image, 'height'),\n    class: getAttrib(image, 'class'),\n    style: normalizeCss(getAttrib(image, 'style')),\n    caption: hasCaption(image),\n    hspace: getHspace(image),\n    vspace: getVspace(image),\n    border: getBorder(image),\n    borderStyle: getBorderStyle(image),\n    isDecorative: getIsDecorative(image)\n  });\n  var updateProp = (image, oldData, newData, name, set) => {\n    if (newData[name] !== oldData[name]) {\n      set(image, name, String(newData[name]));\n    }\n  };\n  var setAlt = (image, alt, isDecorative) => {\n    if (isDecorative) {\n      DOM.setAttrib(image, 'role', 'presentation');\n      var sugarImage = SugarElement.fromDom(image);\n      set(sugarImage, 'alt', '');\n    } else {\n      if (isNull(alt)) {\n        var _sugarImage = SugarElement.fromDom(image);\n        remove(_sugarImage, 'alt');\n      } else {\n        var _sugarImage2 = SugarElement.fromDom(image);\n        set(_sugarImage2, 'alt', alt);\n      }\n      if (DOM.getAttrib(image, 'role') === 'presentation') {\n        DOM.setAttrib(image, 'role', '');\n      }\n    }\n  };\n  var updateAlt = (image, oldData, newData) => {\n    if (newData.alt !== oldData.alt || newData.isDecorative !== oldData.isDecorative) {\n      setAlt(image, newData.alt, newData.isDecorative);\n    }\n  };\n  var normalized = (set, normalizeCss) => (image, name, value) => {\n    set(image, value);\n    normalizeStyle(image, normalizeCss);\n  };\n  var write = (normalizeCss, newData, image) => {\n    var oldData = read(normalizeCss, image);\n    updateProp(image, oldData, newData, 'caption', (image, _name, _value) => toggleCaption(image));\n    updateProp(image, oldData, newData, 'src', updateAttrib);\n    updateProp(image, oldData, newData, 'title', updateAttrib);\n    updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));\n    updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));\n    updateProp(image, oldData, newData, 'class', updateAttrib);\n    updateProp(image, oldData, newData, 'style', normalized((image, value) => updateAttrib(image, 'style', value), normalizeCss));\n    updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));\n    updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));\n    updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));\n    updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));\n    updateAlt(image, oldData, newData);\n  };\n  var normalizeCss$1 = (editor, cssText) => {\n    var css = editor.dom.styles.parse(cssText);\n    var mergedCss = mergeMargins(css);\n    var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));\n    return editor.dom.styles.serialize(compressed);\n  };\n  var getSelectedImage = editor => {\n    var imgElm = editor.selection.getNode();\n    var figureElm = editor.dom.getParent(imgElm, 'figure.image');\n    if (figureElm) {\n      return editor.dom.select('img', figureElm)[0];\n    }\n    if (imgElm && (imgElm.nodeName !== 'IMG' || isPlaceholderImage(imgElm))) {\n      return null;\n    }\n    return imgElm;\n  };\n  var splitTextBlock = (editor, figure) => {\n    var _a;\n    var dom = editor.dom;\n    var textBlockElements = filter(editor.schema.getTextBlockElements(), (_, parentElm) => !editor.schema.isValidChild(parentElm, 'figure'));\n    var textBlock = dom.getParent(figure.parentNode, node => hasNonNullableKey(textBlockElements, node.nodeName), editor.getBody());\n    if (textBlock) {\n      return (_a = dom.split(textBlock, figure)) !== null && _a !== void 0 ? _a : figure;\n    } else {\n      return figure;\n    }\n  };\n  var readImageDataFromSelection = editor => {\n    var image = getSelectedImage(editor);\n    return image ? read(css => normalizeCss$1(editor, css), image) : defaultData();\n  };\n  var insertImageAtCaret = (editor, data) => {\n    var elm = create(css => normalizeCss$1(editor, css), data);\n    editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');\n    editor.focus();\n    editor.selection.setContent(elm.outerHTML);\n    var insertedElm = editor.dom.select('*[data-mce-id=\"__mcenew\"]')[0];\n    editor.dom.setAttrib(insertedElm, 'data-mce-id', null);\n    if (isFigure(insertedElm)) {\n      var figure = splitTextBlock(editor, insertedElm);\n      editor.selection.select(figure);\n    } else {\n      editor.selection.select(insertedElm);\n    }\n  };\n  var syncSrcAttr = (editor, image) => {\n    editor.dom.setAttrib(image, 'src', image.getAttribute('src'));\n  };\n  var deleteImage = (editor, image) => {\n    if (image) {\n      var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;\n      editor.dom.remove(elm);\n      editor.focus();\n      editor.nodeChanged();\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      }\n    }\n  };\n  var writeImageDataToSelection = (editor, data) => {\n    var image = getSelectedImage(editor);\n    if (image) {\n      write(css => normalizeCss$1(editor, css), data, image);\n      syncSrcAttr(editor, image);\n      if (isFigure(image.parentNode)) {\n        var figure = image.parentNode;\n        splitTextBlock(editor, figure);\n        editor.selection.select(image.parentNode);\n      } else {\n        editor.selection.select(image);\n        waitLoadImage(editor, data, image);\n      }\n    }\n  };\n  var sanitizeImageData = (editor, data) => {\n    var src = data.src;\n    return _objectSpread(_objectSpread({}, data), {}, {\n      src: isSafeImageUrl(editor, src) ? src : ''\n    });\n  };\n  var insertOrUpdateImage = (editor, partialData) => {\n    var image = getSelectedImage(editor);\n    if (image) {\n      var selectedImageData = read(css => normalizeCss$1(editor, css), image);\n      var data = _objectSpread(_objectSpread({}, selectedImageData), partialData);\n      var sanitizedData = sanitizeImageData(editor, data);\n      if (data.src) {\n        writeImageDataToSelection(editor, sanitizedData);\n      } else {\n        deleteImage(editor, image);\n      }\n    } else if (partialData.src) {\n      insertImageAtCaret(editor, _objectSpread(_objectSpread({}, defaultData()), partialData));\n    }\n  };\n  var deep = (old, nu) => {\n    var bothObjects = isPlainObject(old) && isPlainObject(nu);\n    return bothObjects ? deepMerge(old, nu) : nu;\n  };\n  var baseMerge = merger => {\n    return function () {\n      if (arguments.length === 0) {\n        throw new Error(\"Can't merge zero objects\");\n      }\n      var ret = {};\n      for (var j = 0; j < arguments.length; j++) {\n        var curObject = j < 0 || arguments.length <= j ? undefined : arguments[j];\n        for (var key in curObject) {\n          if (has(curObject, key)) {\n            ret[key] = merger(ret[key], curObject[key]);\n          }\n        }\n      }\n      return ret;\n    };\n  };\n  var deepMerge = baseMerge(deep);\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.ImageUploader');\n  var global = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var getValue = item => isString(item.value) ? item.value : '';\n  var getText = item => {\n    if (isString(item.text)) {\n      return item.text;\n    } else if (isString(item.title)) {\n      return item.title;\n    } else {\n      return '';\n    }\n  };\n  var sanitizeList = (list, extractValue) => {\n    var out = [];\n    global.each(list, item => {\n      var text = getText(item);\n      if (item.menu !== undefined) {\n        var items = sanitizeList(item.menu, extractValue);\n        out.push({\n          text,\n          items\n        });\n      } else {\n        var value = extractValue(item);\n        out.push({\n          text,\n          value\n        });\n      }\n    });\n    return out;\n  };\n  var sanitizer = function sanitizer() {\n    var extractor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getValue;\n    return list => {\n      if (list) {\n        return Optional.from(list).map(list => sanitizeList(list, extractor));\n      } else {\n        return Optional.none();\n      }\n    };\n  };\n  var sanitize = list => sanitizer(getValue)(list);\n  var isGroup = item => has(item, 'items');\n  var findEntryDelegate = (list, value) => findMap(list, item => {\n    if (isGroup(item)) {\n      return findEntryDelegate(item.items, value);\n    } else if (item.value === value) {\n      return Optional.some(item);\n    } else {\n      return Optional.none();\n    }\n  });\n  var findEntry = (optList, value) => optList.bind(list => findEntryDelegate(list, value));\n  var ListUtils = {\n    sanitizer,\n    sanitize,\n    findEntry\n  };\n  var makeTab$2 = _info => ({\n    title: 'Advanced',\n    name: 'advanced',\n    items: [{\n      type: 'grid',\n      columns: 2,\n      items: [{\n        type: 'input',\n        label: 'Vertical space',\n        name: 'vspace',\n        inputMode: 'numeric'\n      }, {\n        type: 'input',\n        label: 'Horizontal space',\n        name: 'hspace',\n        inputMode: 'numeric'\n      }, {\n        type: 'input',\n        label: 'Border width',\n        name: 'border',\n        inputMode: 'numeric'\n      }, {\n        type: 'listbox',\n        name: 'borderstyle',\n        label: 'Border style',\n        items: [{\n          text: 'Select...',\n          value: ''\n        }, {\n          text: 'Solid',\n          value: 'solid'\n        }, {\n          text: 'Dotted',\n          value: 'dotted'\n        }, {\n          text: 'Dashed',\n          value: 'dashed'\n        }, {\n          text: 'Double',\n          value: 'double'\n        }, {\n          text: 'Groove',\n          value: 'groove'\n        }, {\n          text: 'Ridge',\n          value: 'ridge'\n        }, {\n          text: 'Inset',\n          value: 'inset'\n        }, {\n          text: 'Outset',\n          value: 'outset'\n        }, {\n          text: 'None',\n          value: 'none'\n        }, {\n          text: 'Hidden',\n          value: 'hidden'\n        }]\n      }]\n    }]\n  });\n  var AdvTab = {\n    makeTab: makeTab$2\n  };\n  var collect = editor => {\n    var urlListSanitizer = ListUtils.sanitizer(item => editor.convertURL(item.value || item.url || '', 'src'));\n    var futureImageList = new Promise(completer => {\n      createImageList(editor, imageList => {\n        completer(urlListSanitizer(imageList).map(items => flatten([[{\n          text: 'None',\n          value: ''\n        }], items])));\n      });\n    });\n    var classList = ListUtils.sanitize(getClassList(editor));\n    var hasAdvTab$1 = hasAdvTab(editor);\n    var hasUploadTab$1 = hasUploadTab(editor);\n    var hasUploadUrl$1 = hasUploadUrl(editor);\n    var hasUploadHandler$1 = hasUploadHandler(editor);\n    var image = readImageDataFromSelection(editor);\n    var hasDescription$1 = hasDescription(editor);\n    var hasImageTitle$1 = hasImageTitle(editor);\n    var hasDimensions$1 = hasDimensions(editor);\n    var hasImageCaption$1 = hasImageCaption(editor);\n    var hasAccessibilityOptions = showAccessibilityOptions(editor);\n    var automaticUploads = isAutomaticUploadsEnabled(editor);\n    var prependURL = Optional.some(getPrependUrl(editor)).filter(preUrl => isString(preUrl) && preUrl.length > 0);\n    return futureImageList.then(imageList => ({\n      image,\n      imageList,\n      classList,\n      hasAdvTab: hasAdvTab$1,\n      hasUploadTab: hasUploadTab$1,\n      hasUploadUrl: hasUploadUrl$1,\n      hasUploadHandler: hasUploadHandler$1,\n      hasDescription: hasDescription$1,\n      hasImageTitle: hasImageTitle$1,\n      hasDimensions: hasDimensions$1,\n      hasImageCaption: hasImageCaption$1,\n      prependURL,\n      hasAccessibilityOptions,\n      automaticUploads\n    }));\n  };\n  var makeItems = info => {\n    var imageUrl = {\n      name: 'src',\n      type: 'urlinput',\n      filetype: 'image',\n      label: 'Source'\n    };\n    var imageList = info.imageList.map(items => ({\n      name: 'images',\n      type: 'listbox',\n      label: 'Image list',\n      items\n    }));\n    var imageDescription = {\n      name: 'alt',\n      type: 'input',\n      label: 'Alternative description',\n      enabled: !(info.hasAccessibilityOptions && info.image.isDecorative)\n    };\n    var imageTitle = {\n      name: 'title',\n      type: 'input',\n      label: 'Image title'\n    };\n    var imageDimensions = {\n      name: 'dimensions',\n      type: 'sizeinput'\n    };\n    var isDecorative = {\n      type: 'label',\n      label: 'Accessibility',\n      items: [{\n        name: 'isDecorative',\n        type: 'checkbox',\n        label: 'Image is decorative'\n      }]\n    };\n    var classList = info.classList.map(items => ({\n      name: 'classes',\n      type: 'listbox',\n      label: 'Class',\n      items\n    }));\n    var caption = {\n      type: 'label',\n      label: 'Caption',\n      items: [{\n        type: 'checkbox',\n        name: 'caption',\n        label: 'Show caption'\n      }]\n    };\n    var getDialogContainerType = useColumns => useColumns ? {\n      type: 'grid',\n      columns: 2\n    } : {\n      type: 'panel'\n    };\n    return flatten([[imageUrl], imageList.toArray(), info.hasAccessibilityOptions && info.hasDescription ? [isDecorative] : [], info.hasDescription ? [imageDescription] : [], info.hasImageTitle ? [imageTitle] : [], info.hasDimensions ? [imageDimensions] : [], [_objectSpread(_objectSpread({}, getDialogContainerType(info.classList.isSome() && info.hasImageCaption)), {}, {\n      items: flatten([classList.toArray(), info.hasImageCaption ? [caption] : []])\n    })]]);\n  };\n  var makeTab$1 = info => ({\n    title: 'General',\n    name: 'general',\n    items: makeItems(info)\n  });\n  var MainTab = {\n    makeTab: makeTab$1,\n    makeItems\n  };\n  var makeTab = _info => {\n    var items = [{\n      type: 'dropzone',\n      name: 'fileinput'\n    }];\n    return {\n      title: 'Upload',\n      name: 'upload',\n      items\n    };\n  };\n  var UploadTab = {\n    makeTab\n  };\n  var createState = info => ({\n    prevImage: ListUtils.findEntry(info.imageList, info.image.src),\n    prevAlt: info.image.alt,\n    open: true\n  });\n  var fromImageData = image => ({\n    src: {\n      value: image.src,\n      meta: {}\n    },\n    images: image.src,\n    alt: image.alt,\n    title: image.title,\n    dimensions: {\n      width: image.width,\n      height: image.height\n    },\n    classes: image.class,\n    caption: image.caption,\n    style: image.style,\n    vspace: image.vspace,\n    border: image.border,\n    hspace: image.hspace,\n    borderstyle: image.borderStyle,\n    fileinput: [],\n    isDecorative: image.isDecorative\n  });\n  var toImageData = (data, removeEmptyAlt) => ({\n    src: data.src.value,\n    alt: (data.alt === null || data.alt.length === 0) && removeEmptyAlt ? null : data.alt,\n    title: data.title,\n    width: data.dimensions.width,\n    height: data.dimensions.height,\n    class: data.classes,\n    style: data.style,\n    caption: data.caption,\n    hspace: data.hspace,\n    vspace: data.vspace,\n    border: data.border,\n    borderStyle: data.borderstyle,\n    isDecorative: data.isDecorative\n  });\n  var addPrependUrl2 = (info, srcURL) => {\n    if (!/^(?:[a-zA-Z]+:)?\\/\\//.test(srcURL)) {\n      return info.prependURL.bind(prependUrl => {\n        if (srcURL.substring(0, prependUrl.length) !== prependUrl) {\n          return Optional.some(prependUrl + srcURL);\n        }\n        return Optional.none();\n      });\n    }\n    return Optional.none();\n  };\n  var addPrependUrl = (info, api) => {\n    var data = api.getData();\n    addPrependUrl2(info, data.src.value).each(srcURL => {\n      api.setData({\n        src: {\n          value: srcURL,\n          meta: data.src.meta\n        }\n      });\n    });\n  };\n  var formFillFromMeta2 = (info, data, meta) => {\n    if (info.hasDescription && isString(meta.alt)) {\n      data.alt = meta.alt;\n    }\n    if (info.hasAccessibilityOptions) {\n      data.isDecorative = meta.isDecorative || data.isDecorative || false;\n    }\n    if (info.hasImageTitle && isString(meta.title)) {\n      data.title = meta.title;\n    }\n    if (info.hasDimensions) {\n      if (isString(meta.width)) {\n        data.dimensions.width = meta.width;\n      }\n      if (isString(meta.height)) {\n        data.dimensions.height = meta.height;\n      }\n    }\n    if (isString(meta.class)) {\n      ListUtils.findEntry(info.classList, meta.class).each(entry => {\n        data.classes = entry.value;\n      });\n    }\n    if (info.hasImageCaption) {\n      if (isBoolean(meta.caption)) {\n        data.caption = meta.caption;\n      }\n    }\n    if (info.hasAdvTab) {\n      if (isString(meta.style)) {\n        data.style = meta.style;\n      }\n      if (isString(meta.vspace)) {\n        data.vspace = meta.vspace;\n      }\n      if (isString(meta.border)) {\n        data.border = meta.border;\n      }\n      if (isString(meta.hspace)) {\n        data.hspace = meta.hspace;\n      }\n      if (isString(meta.borderstyle)) {\n        data.borderstyle = meta.borderstyle;\n      }\n    }\n  };\n  var formFillFromMeta = (info, api) => {\n    var data = api.getData();\n    var meta = data.src.meta;\n    if (meta !== undefined) {\n      var newData = deepMerge({}, data);\n      formFillFromMeta2(info, newData, meta);\n      api.setData(newData);\n    }\n  };\n  var calculateImageSize = (helpers, info, state, api) => {\n    var data = api.getData();\n    var url = data.src.value;\n    var meta = data.src.meta || {};\n    if (!meta.width && !meta.height && info.hasDimensions) {\n      if (isNotEmpty(url)) {\n        helpers.imageSize(url).then(size => {\n          if (state.open) {\n            api.setData({\n              dimensions: size\n            });\n          }\n        }).catch(e => console.error(e));\n      } else {\n        api.setData({\n          dimensions: {\n            width: '',\n            height: ''\n          }\n        });\n      }\n    }\n  };\n  var updateImagesDropdown = (info, state, api) => {\n    var data = api.getData();\n    var image = ListUtils.findEntry(info.imageList, data.src.value);\n    state.prevImage = image;\n    api.setData({\n      images: image.map(entry => entry.value).getOr('')\n    });\n  };\n  var changeSrc = (helpers, info, state, api) => {\n    addPrependUrl(info, api);\n    formFillFromMeta(info, api);\n    calculateImageSize(helpers, info, state, api);\n    updateImagesDropdown(info, state, api);\n  };\n  var changeImages = (helpers, info, state, api) => {\n    var data = api.getData();\n    var image = ListUtils.findEntry(info.imageList, data.images);\n    image.each(img => {\n      var updateAlt = data.alt === '' || state.prevImage.map(image => image.text === data.alt).getOr(false);\n      if (updateAlt) {\n        if (img.value === '') {\n          api.setData({\n            src: img,\n            alt: state.prevAlt\n          });\n        } else {\n          api.setData({\n            src: img,\n            alt: img.text\n          });\n        }\n      } else {\n        api.setData({\n          src: img\n        });\n      }\n    });\n    state.prevImage = image;\n    changeSrc(helpers, info, state, api);\n  };\n  var changeFileInput = (helpers, info, state, api) => {\n    var data = api.getData();\n    api.block('Uploading image');\n    head(data.fileinput).fold(() => {\n      api.unblock();\n    }, file => {\n      var blobUri = URL.createObjectURL(file);\n      var finalize = () => {\n        api.unblock();\n        URL.revokeObjectURL(blobUri);\n      };\n      var updateSrcAndSwitchTab = url => {\n        api.setData({\n          src: {\n            value: url,\n            meta: {}\n          }\n        });\n        api.showTab('general');\n        changeSrc(helpers, info, state, api);\n      };\n      blobToDataUri(file).then(dataUrl => {\n        var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);\n        if (info.automaticUploads) {\n          helpers.uploadImage(blobInfo).then(result => {\n            updateSrcAndSwitchTab(result.url);\n            finalize();\n          }).catch(err => {\n            finalize();\n            helpers.alertErr(err);\n          });\n        } else {\n          helpers.addToBlobCache(blobInfo);\n          updateSrcAndSwitchTab(blobInfo.blobUri());\n          api.unblock();\n        }\n      });\n    });\n  };\n  var changeHandler = (helpers, info, state) => (api, evt) => {\n    if (evt.name === 'src') {\n      changeSrc(helpers, info, state, api);\n    } else if (evt.name === 'images') {\n      changeImages(helpers, info, state, api);\n    } else if (evt.name === 'alt') {\n      state.prevAlt = api.getData().alt;\n    } else if (evt.name === 'fileinput') {\n      changeFileInput(helpers, info, state, api);\n    } else if (evt.name === 'isDecorative') {\n      api.setEnabled('alt', !api.getData().isDecorative);\n    }\n  };\n  var closeHandler = state => () => {\n    state.open = false;\n  };\n  var makeDialogBody = info => {\n    if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {\n      var tabPanel = {\n        type: 'tabpanel',\n        tabs: flatten([[MainTab.makeTab(info)], info.hasAdvTab ? [AdvTab.makeTab(info)] : [], info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []])\n      };\n      return tabPanel;\n    } else {\n      var panel = {\n        type: 'panel',\n        items: MainTab.makeItems(info)\n      };\n      return panel;\n    }\n  };\n  var submitHandler = (editor, info, helpers) => api => {\n    var data = deepMerge(fromImageData(info.image), api.getData());\n    var finalData = _objectSpread(_objectSpread({}, data), {}, {\n      style: getStyleValue(helpers.normalizeCss, toImageData(data, false))\n    });\n    editor.execCommand('mceUpdateImage', false, toImageData(finalData, info.hasAccessibilityOptions));\n    editor.editorUpload.uploadImagesAuto();\n    api.close();\n  };\n  var imageSize = editor => url => {\n    if (!isSafeImageUrl(editor, url)) {\n      return Promise.resolve({\n        width: '',\n        height: ''\n      });\n    } else {\n      return getImageSize(editor.documentBaseURI.toAbsolute(url)).then(dimensions => ({\n        width: String(dimensions.width),\n        height: String(dimensions.height)\n      }));\n    }\n  };\n  var createBlobCache = editor => (file, blobUri, dataUrl) => {\n    var _a;\n    return editor.editorUpload.blobCache.create({\n      blob: file,\n      blobUri,\n      name: (_a = file.name) === null || _a === void 0 ? void 0 : _a.replace(/\\.[^\\.]+$/, ''),\n      filename: file.name,\n      base64: dataUrl.split(',')[1]\n    });\n  };\n  var addToBlobCache = editor => blobInfo => {\n    editor.editorUpload.blobCache.add(blobInfo);\n  };\n  var alertErr = editor => message => {\n    editor.windowManager.alert(message);\n  };\n  var normalizeCss = editor => cssText => normalizeCss$1(editor, cssText);\n  var parseStyle = editor => cssText => editor.dom.parseStyle(cssText);\n  var serializeStyle = editor => (stylesArg, name) => editor.dom.serializeStyle(stylesArg, name);\n  var uploadImage = editor => blobInfo => global$1(editor).upload([blobInfo], false).then(results => {\n    var _a;\n    if (results.length === 0) {\n      return Promise.reject('Failed to upload image');\n    } else if (results[0].status === false) {\n      return Promise.reject((_a = results[0].error) === null || _a === void 0 ? void 0 : _a.message);\n    } else {\n      return results[0];\n    }\n  });\n  var Dialog = editor => {\n    var helpers = {\n      imageSize: imageSize(editor),\n      addToBlobCache: addToBlobCache(editor),\n      createBlobCache: createBlobCache(editor),\n      alertErr: alertErr(editor),\n      normalizeCss: normalizeCss(editor),\n      parseStyle: parseStyle(editor),\n      serializeStyle: serializeStyle(editor),\n      uploadImage: uploadImage(editor)\n    };\n    var open = () => {\n      collect(editor).then(info => {\n        var state = createState(info);\n        return {\n          title: 'Insert/Edit Image',\n          size: 'normal',\n          body: makeDialogBody(info),\n          buttons: [{\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          }, {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }],\n          initialData: fromImageData(info.image),\n          onSubmit: submitHandler(editor, info, helpers),\n          onChange: changeHandler(helpers, info, state),\n          onClose: closeHandler(state)\n        };\n      }).then(editor.windowManager.open);\n    };\n    return {\n      open\n    };\n  };\n  var register$1 = editor => {\n    editor.addCommand('mceImage', Dialog(editor).open);\n    editor.addCommand('mceUpdateImage', (_ui, data) => {\n      editor.undoManager.transact(() => insertOrUpdateImage(editor, data));\n    });\n  };\n  var hasImageClass = node => {\n    var className = node.attr('class');\n    return isNonNullable(className) && /\\bimage\\b/.test(className);\n  };\n  var toggleContentEditableState = state => nodes => {\n    var i = nodes.length;\n    var toggleContentEditable = node => {\n      node.attr('contenteditable', state ? 'true' : null);\n    };\n    while (i--) {\n      var node = nodes[i];\n      if (hasImageClass(node)) {\n        node.attr('contenteditable', state ? 'false' : null);\n        global.each(node.getAll('figcaption'), toggleContentEditable);\n      }\n    }\n  };\n  var setup = editor => {\n    editor.on('PreInit', () => {\n      editor.parser.addNodeFilter('figure', toggleContentEditableState(true));\n      editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));\n    });\n  };\n  var onSetupEditable = editor => api => {\n    var nodeChanged = () => {\n      api.setEnabled(editor.selection.isEditable());\n    };\n    editor.on('NodeChange', nodeChanged);\n    nodeChanged();\n    return () => {\n      editor.off('NodeChange', nodeChanged);\n    };\n  };\n  var register = editor => {\n    editor.ui.registry.addToggleButton('image', {\n      icon: 'image',\n      tooltip: 'Insert/edit image',\n      onAction: Dialog(editor).open,\n      onSetup: buttonApi => {\n        buttonApi.setActive(isNonNullable(getSelectedImage(editor)));\n        var unbindSelectorChanged = editor.selection.selectorChangedWithUnbind('img:not([data-mce-object]):not([data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;\n        var unbindEditable = onSetupEditable(editor)(buttonApi);\n        return () => {\n          unbindSelectorChanged();\n          unbindEditable();\n        };\n      }\n    });\n    editor.ui.registry.addMenuItem('image', {\n      icon: 'image',\n      text: 'Image...',\n      onAction: Dialog(editor).open,\n      onSetup: onSetupEditable(editor)\n    });\n    editor.ui.registry.addContextMenu('image', {\n      update: element => editor.selection.isEditable() && (isFigure(element) || isImage(element) && !isPlaceholderImage(element)) ? ['image'] : []\n    });\n  };\n  var Plugin = () => {\n    global$4.add('image', editor => {\n      register$2(editor);\n      setup(editor);\n      register(editor);\n      register$1(editor);\n    });\n  };\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/image/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/index.js ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"link\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/link')\n//   ES2015:\n//     import 'tinymce/plugins/link'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/link/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/link/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/plugin.js ***!
  \*****************************************************/
/***/ (() => {

eval("function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global$5 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var hasProto = (v, constructor, predicate) => {\n    var _a;\n    if (predicate(v, constructor.prototype)) {\n      return true;\n    } else {\n      return ((_a = v.constructor) === null || _a === void 0 ? void 0 : _a.name) === constructor.name;\n    }\n  };\n  var typeOf = x => {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && Array.isArray(x)) {\n      return 'array';\n    } else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType = type => value => typeOf(value) === type;\n  var isSimpleType = type => value => typeof value === type;\n  var eq = t => a => t === a;\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n  var isNull = eq(null);\n  var isBoolean = isSimpleType('boolean');\n  var isNullable = a => a === null || a === undefined;\n  var isNonNullable = a => !isNullable(a);\n  var isFunction = isSimpleType('function');\n  var isArrayOf = (value, pred) => {\n    if (isArray(value)) {\n      for (var i = 0, len = value.length; i < len; ++i) {\n        if (!pred(value[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    return false;\n  };\n  var noop = () => {};\n  var constant = value => {\n    return () => {\n      return value;\n    };\n  };\n  var tripleEquals = (a, b) => {\n    return a === b;\n  };\n  class Optional {\n    constructor(tag, value) {\n      this.tag = tag;\n      this.value = value;\n    }\n    static some(value) {\n      return new Optional(true, value);\n    }\n    static none() {\n      return Optional.singletonNone;\n    }\n    fold(onNone, onSome) {\n      if (this.tag) {\n        return onSome(this.value);\n      } else {\n        return onNone();\n      }\n    }\n    isSome() {\n      return this.tag;\n    }\n    isNone() {\n      return !this.tag;\n    }\n    map(mapper) {\n      if (this.tag) {\n        return Optional.some(mapper(this.value));\n      } else {\n        return Optional.none();\n      }\n    }\n    bind(binder) {\n      if (this.tag) {\n        return binder(this.value);\n      } else {\n        return Optional.none();\n      }\n    }\n    exists(predicate) {\n      return this.tag && predicate(this.value);\n    }\n    forall(predicate) {\n      return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n      if (!this.tag || predicate(this.value)) {\n        return this;\n      } else {\n        return Optional.none();\n      }\n    }\n    getOr(replacement) {\n      return this.tag ? this.value : replacement;\n    }\n    or(replacement) {\n      return this.tag ? this : replacement;\n    }\n    getOrThunk(thunk) {\n      return this.tag ? this.value : thunk();\n    }\n    orThunk(thunk) {\n      return this.tag ? this : thunk();\n    }\n    getOrDie(message) {\n      if (!this.tag) {\n        throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n      } else {\n        return this.value;\n      }\n    }\n    static from(value) {\n      return isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    getOrNull() {\n      return this.tag ? this.value : null;\n    }\n    getOrUndefined() {\n      return this.value;\n    }\n    each(worker) {\n      if (this.tag) {\n        worker(this.value);\n      }\n    }\n    toArray() {\n      return this.tag ? [this.value] : [];\n    }\n    toString() {\n      return this.tag ? \"some(\".concat(this.value, \")\") : 'none()';\n    }\n  }\n  Optional.singletonNone = new Optional(false);\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n  var rawIndexOf = (ts, t) => nativeIndexOf.call(ts, t);\n  var contains = (xs, x) => rawIndexOf(xs, x) > -1;\n  var map = (xs, f) => {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each$1 = (xs, f) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var foldl = (xs, f, acc) => {\n    each$1(xs, (x, i) => {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var flatten = xs => {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind = (xs, f) => flatten(map(xs, f));\n  var findMap = (arr, f) => {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n      if (r.isSome()) {\n        return r;\n      }\n    }\n    return Optional.none();\n  };\n  var is = function is(lhs, rhs) {\n    var comparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : tripleEquals;\n    return lhs.exists(left => comparator(left, rhs));\n  };\n  var cat = arr => {\n    var r = [];\n    var push = x => {\n      r.push(x);\n    };\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n    return r;\n  };\n  var someIf = (b, a) => b ? Optional.some(a) : Optional.none();\n  var option = name => editor => editor.options.get(name);\n  var register$1 = editor => {\n    var registerOption = editor.options.register;\n    registerOption('link_assume_external_targets', {\n      processor: value => {\n        var valid = isString(value) || isBoolean(value);\n        if (valid) {\n          if (value === true) {\n            return {\n              value: 1,\n              valid\n            };\n          } else if (value === 'http' || value === 'https') {\n            return {\n              value,\n              valid\n            };\n          } else {\n            return {\n              value: 0,\n              valid\n            };\n          }\n        } else {\n          return {\n            valid: false,\n            message: 'Must be a string or a boolean.'\n          };\n        }\n      },\n      default: false\n    });\n    registerOption('link_context_toolbar', {\n      processor: 'boolean',\n      default: false\n    });\n    registerOption('link_list', {\n      processor: value => isString(value) || isFunction(value) || isArrayOf(value, isObject)\n    });\n    registerOption('link_default_target', {\n      processor: 'string'\n    });\n    registerOption('link_default_protocol', {\n      processor: 'string',\n      default: 'https'\n    });\n    registerOption('link_target_list', {\n      processor: value => isBoolean(value) || isArrayOf(value, isObject),\n      default: true\n    });\n    registerOption('link_rel_list', {\n      processor: 'object[]',\n      default: []\n    });\n    registerOption('link_class_list', {\n      processor: 'object[]',\n      default: []\n    });\n    registerOption('link_title', {\n      processor: 'boolean',\n      default: true\n    });\n    registerOption('allow_unsafe_link_target', {\n      processor: 'boolean',\n      default: false\n    });\n    registerOption('link_quicklink', {\n      processor: 'boolean',\n      default: false\n    });\n  };\n  var assumeExternalTargets = option('link_assume_external_targets');\n  var hasContextToolbar = option('link_context_toolbar');\n  var getLinkList = option('link_list');\n  var getDefaultLinkTarget = option('link_default_target');\n  var getDefaultLinkProtocol = option('link_default_protocol');\n  var getTargetList = option('link_target_list');\n  var getRelList = option('link_rel_list');\n  var getLinkClassList = option('link_class_list');\n  var shouldShowLinkTitle = option('link_title');\n  var allowUnsafeLinkTarget = option('allow_unsafe_link_target');\n  var useQuickLink = option('link_quicklink');\n  var global$4 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var getValue = item => isString(item.value) ? item.value : '';\n  var getText = item => {\n    if (isString(item.text)) {\n      return item.text;\n    } else if (isString(item.title)) {\n      return item.title;\n    } else {\n      return '';\n    }\n  };\n  var sanitizeList = (list, extractValue) => {\n    var out = [];\n    global$4.each(list, item => {\n      var text = getText(item);\n      if (item.menu !== undefined) {\n        var items = sanitizeList(item.menu, extractValue);\n        out.push({\n          text,\n          items\n        });\n      } else {\n        var value = extractValue(item);\n        out.push({\n          text,\n          value\n        });\n      }\n    });\n    return out;\n  };\n  var sanitizeWith = function sanitizeWith() {\n    var extracter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getValue;\n    return list => Optional.from(list).map(list => sanitizeList(list, extracter));\n  };\n  var sanitize = list => sanitizeWith(getValue)(list);\n  var createUi = (name, label) => items => ({\n    name,\n    type: 'listbox',\n    label,\n    items\n  });\n  var ListOptions = {\n    sanitize,\n    sanitizeWith,\n    createUi,\n    getValue\n  };\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n  var each = (obj, f) => {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var objAcc = r => (x, i) => {\n    r[i] = x;\n  };\n  var internalFilter = (obj, pred, onTrue, onFalse) => {\n    each(obj, (x, i) => {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n  };\n  var filter = (obj, pred) => {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  var has = (obj, key) => hasOwnProperty.call(obj, key);\n  var hasNonNullableKey = (obj, key) => has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  var global$3 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.URI');\n  var isAnchor = elm => isNonNullable(elm) && elm.nodeName.toLowerCase() === 'a';\n  var isLink = elm => isAnchor(elm) && !!getHref(elm);\n  var collectNodesInRange = (rng, predicate) => {\n    if (rng.collapsed) {\n      return [];\n    } else {\n      var contents = rng.cloneContents();\n      var firstChild = contents.firstChild;\n      var walker = new global$3(firstChild, contents);\n      var elements = [];\n      var current = firstChild;\n      do {\n        if (predicate(current)) {\n          elements.push(current);\n        }\n      } while (current = walker.next());\n      return elements;\n    }\n  };\n  var hasProtocol = url => /^\\w+:/i.test(url);\n  var getHref = elm => {\n    var _a, _b;\n    return (_b = (_a = elm.getAttribute('data-mce-href')) !== null && _a !== void 0 ? _a : elm.getAttribute('href')) !== null && _b !== void 0 ? _b : '';\n  };\n  var applyRelTargetRules = (rel, isUnsafe) => {\n    var rules = ['noopener'];\n    var rels = rel ? rel.split(/\\s+/) : [];\n    var toString = rels => global$4.trim(rels.sort().join(' '));\n    var addTargetRules = rels => {\n      rels = removeTargetRules(rels);\n      return rels.length > 0 ? rels.concat(rules) : rules;\n    };\n    var removeTargetRules = rels => rels.filter(val => global$4.inArray(rules, val) === -1);\n    var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);\n    return newRels.length > 0 ? toString(newRels) : '';\n  };\n  var trimCaretContainers = text => text.replace(/\\uFEFF/g, '');\n  var getAnchorElement = (editor, selectedElm) => {\n    selectedElm = selectedElm || getLinksInSelection(editor.selection.getRng())[0] || editor.selection.getNode();\n    if (isImageFigure(selectedElm)) {\n      return Optional.from(editor.dom.select('a[href]', selectedElm)[0]);\n    } else {\n      return Optional.from(editor.dom.getParent(selectedElm, 'a[href]'));\n    }\n  };\n  var isInAnchor = (editor, selectedElm) => getAnchorElement(editor, selectedElm).isSome();\n  var getAnchorText = (selection, anchorElm) => {\n    var text = anchorElm.fold(() => selection.getContent({\n      format: 'text'\n    }), anchorElm => anchorElm.innerText || anchorElm.textContent || '');\n    return trimCaretContainers(text);\n  };\n  var getLinksInSelection = rng => collectNodesInRange(rng, isLink);\n  var getLinks$1 = elements => global$4.grep(elements, isLink);\n  var hasLinks = elements => getLinks$1(elements).length > 0;\n  var hasLinksInSelection = rng => getLinksInSelection(rng).length > 0;\n  var isOnlyTextSelected = editor => {\n    var inlineTextElements = editor.schema.getTextInlineElements();\n    var isElement = elm => elm.nodeType === 1 && !isAnchor(elm) && !has(inlineTextElements, elm.nodeName.toLowerCase());\n    var isInBlockAnchor = getAnchorElement(editor).exists(anchor => anchor.hasAttribute('data-mce-block'));\n    if (isInBlockAnchor) {\n      return false;\n    }\n    var rng = editor.selection.getRng();\n    if (!rng.collapsed) {\n      var elements = collectNodesInRange(rng, isElement);\n      return elements.length === 0;\n    } else {\n      return true;\n    }\n  };\n  var isImageFigure = elm => isNonNullable(elm) && elm.nodeName === 'FIGURE' && /\\bimage\\b/i.test(elm.className);\n  var getLinkAttrs = data => {\n    var attrs = ['title', 'rel', 'class', 'target'];\n    return foldl(attrs, (acc, key) => {\n      data[key].each(value => {\n        acc[key] = value.length > 0 ? value : null;\n      });\n      return acc;\n    }, {\n      href: data.href\n    });\n  };\n  var handleExternalTargets = (href, assumeExternalTargets) => {\n    if ((assumeExternalTargets === 'http' || assumeExternalTargets === 'https') && !hasProtocol(href)) {\n      return assumeExternalTargets + '://' + href;\n    }\n    return href;\n  };\n  var applyLinkOverrides = (editor, linkAttrs) => {\n    var newLinkAttrs = _objectSpread({}, linkAttrs);\n    if (getRelList(editor).length === 0 && !allowUnsafeLinkTarget(editor)) {\n      var newRel = applyRelTargetRules(newLinkAttrs.rel, newLinkAttrs.target === '_blank');\n      newLinkAttrs.rel = newRel ? newRel : null;\n    }\n    if (Optional.from(newLinkAttrs.target).isNone() && getTargetList(editor) === false) {\n      newLinkAttrs.target = getDefaultLinkTarget(editor);\n    }\n    newLinkAttrs.href = handleExternalTargets(newLinkAttrs.href, assumeExternalTargets(editor));\n    return newLinkAttrs;\n  };\n  var updateLink = (editor, anchorElm, text, linkAttrs) => {\n    text.each(text => {\n      if (has(anchorElm, 'innerText')) {\n        anchorElm.innerText = text;\n      } else {\n        anchorElm.textContent = text;\n      }\n    });\n    editor.dom.setAttribs(anchorElm, linkAttrs);\n    editor.selection.select(anchorElm);\n  };\n  var createLink = (editor, selectedElm, text, linkAttrs) => {\n    var dom = editor.dom;\n    if (isImageFigure(selectedElm)) {\n      linkImageFigure(dom, selectedElm, linkAttrs);\n    } else {\n      text.fold(() => {\n        editor.execCommand('mceInsertLink', false, linkAttrs);\n      }, text => {\n        editor.insertContent(dom.createHTML('a', linkAttrs, dom.encode(text)));\n      });\n    }\n  };\n  var linkDomMutation = (editor, attachState, data) => {\n    var selectedElm = editor.selection.getNode();\n    var anchorElm = getAnchorElement(editor, selectedElm);\n    var linkAttrs = applyLinkOverrides(editor, getLinkAttrs(data));\n    editor.undoManager.transact(() => {\n      if (data.href === attachState.href) {\n        attachState.attach();\n      }\n      anchorElm.fold(() => {\n        createLink(editor, selectedElm, data.text, linkAttrs);\n      }, elm => {\n        editor.focus();\n        updateLink(editor, elm, data.text, linkAttrs);\n      });\n    });\n  };\n  var unlinkSelection = editor => {\n    var dom = editor.dom,\n      selection = editor.selection;\n    var bookmark = selection.getBookmark();\n    var rng = selection.getRng().cloneRange();\n    var startAnchorElm = dom.getParent(rng.startContainer, 'a[href]', editor.getBody());\n    var endAnchorElm = dom.getParent(rng.endContainer, 'a[href]', editor.getBody());\n    if (startAnchorElm) {\n      rng.setStartBefore(startAnchorElm);\n    }\n    if (endAnchorElm) {\n      rng.setEndAfter(endAnchorElm);\n    }\n    selection.setRng(rng);\n    editor.execCommand('unlink');\n    selection.moveToBookmark(bookmark);\n  };\n  var unlinkDomMutation = editor => {\n    editor.undoManager.transact(() => {\n      var node = editor.selection.getNode();\n      if (isImageFigure(node)) {\n        unlinkImageFigure(editor, node);\n      } else {\n        unlinkSelection(editor);\n      }\n      editor.focus();\n    });\n  };\n  var unwrapOptions = data => {\n    var {\n      class: cls,\n      href,\n      rel,\n      target,\n      text,\n      title\n    } = data;\n    return filter({\n      class: cls.getOrNull(),\n      href,\n      rel: rel.getOrNull(),\n      target: target.getOrNull(),\n      text: text.getOrNull(),\n      title: title.getOrNull()\n    }, (v, _k) => isNull(v) === false);\n  };\n  var sanitizeData = (editor, data) => {\n    var getOption = editor.options.get;\n    var uriOptions = {\n      allow_html_data_urls: getOption('allow_html_data_urls'),\n      allow_script_urls: getOption('allow_script_urls'),\n      allow_svg_data_urls: getOption('allow_svg_data_urls')\n    };\n    var href = data.href;\n    return _objectSpread(_objectSpread({}, data), {}, {\n      href: global$2.isDomSafe(href, 'a', uriOptions) ? href : ''\n    });\n  };\n  var link = (editor, attachState, data) => {\n    var sanitizedData = sanitizeData(editor, data);\n    editor.hasPlugin('rtc', true) ? editor.execCommand('createlink', false, unwrapOptions(sanitizedData)) : linkDomMutation(editor, attachState, sanitizedData);\n  };\n  var unlink = editor => {\n    editor.hasPlugin('rtc', true) ? editor.execCommand('unlink') : unlinkDomMutation(editor);\n  };\n  var unlinkImageFigure = (editor, fig) => {\n    var _a;\n    var img = editor.dom.select('img', fig)[0];\n    if (img) {\n      var a = editor.dom.getParents(img, 'a[href]', fig)[0];\n      if (a) {\n        (_a = a.parentNode) === null || _a === void 0 ? void 0 : _a.insertBefore(img, a);\n        editor.dom.remove(a);\n      }\n    }\n  };\n  var linkImageFigure = (dom, fig, attrs) => {\n    var _a;\n    var img = dom.select('img', fig)[0];\n    if (img) {\n      var a = dom.create('a', attrs);\n      (_a = img.parentNode) === null || _a === void 0 ? void 0 : _a.insertBefore(a, img);\n      a.appendChild(img);\n    }\n  };\n  var isListGroup = item => hasNonNullableKey(item, 'items');\n  var findTextByValue = (value, catalog) => findMap(catalog, item => {\n    if (isListGroup(item)) {\n      return findTextByValue(value, item.items);\n    } else {\n      return someIf(item.value === value, item);\n    }\n  });\n  var getDelta = (persistentText, fieldName, catalog, data) => {\n    var value = data[fieldName];\n    var hasPersistentText = persistentText.length > 0;\n    return value !== undefined ? findTextByValue(value, catalog).map(i => ({\n      url: {\n        value: i.value,\n        meta: {\n          text: hasPersistentText ? persistentText : i.text,\n          attach: noop\n        }\n      },\n      text: hasPersistentText ? persistentText : i.text\n    })) : Optional.none();\n  };\n  var findCatalog = (catalogs, fieldName) => {\n    if (fieldName === 'link') {\n      return catalogs.link;\n    } else if (fieldName === 'anchor') {\n      return catalogs.anchor;\n    } else {\n      return Optional.none();\n    }\n  };\n  var init = (initialData, linkCatalog) => {\n    var persistentData = {\n      text: initialData.text,\n      title: initialData.title\n    };\n    var getTitleFromUrlChange = url => {\n      var _a;\n      return someIf(persistentData.title.length <= 0, Optional.from((_a = url.meta) === null || _a === void 0 ? void 0 : _a.title).getOr(''));\n    };\n    var getTextFromUrlChange = url => {\n      var _a;\n      return someIf(persistentData.text.length <= 0, Optional.from((_a = url.meta) === null || _a === void 0 ? void 0 : _a.text).getOr(url.value));\n    };\n    var onUrlChange = data => {\n      var text = getTextFromUrlChange(data.url);\n      var title = getTitleFromUrlChange(data.url);\n      if (text.isSome() || title.isSome()) {\n        return Optional.some(_objectSpread(_objectSpread({}, text.map(text => ({\n          text\n        })).getOr({})), title.map(title => ({\n          title\n        })).getOr({})));\n      } else {\n        return Optional.none();\n      }\n    };\n    var onCatalogChange = (data, change) => {\n      var catalog = findCatalog(linkCatalog, change).getOr([]);\n      return getDelta(persistentData.text, change, catalog, data);\n    };\n    var onChange = (getData, change) => {\n      var name = change.name;\n      if (name === 'url') {\n        return onUrlChange(getData());\n      } else if (contains(['anchor', 'link'], name)) {\n        return onCatalogChange(getData(), name);\n      } else if (name === 'text' || name === 'title') {\n        persistentData[name] = getData()[name];\n        return Optional.none();\n      } else {\n        return Optional.none();\n      }\n    };\n    return {\n      onChange\n    };\n  };\n  var DialogChanges = {\n    init,\n    getDelta\n  };\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n  var delayedConfirm = (editor, message, callback) => {\n    var rng = editor.selection.getRng();\n    global$1.setEditorTimeout(editor, () => {\n      editor.windowManager.confirm(message, state => {\n        editor.selection.setRng(rng);\n        callback(state);\n      });\n    });\n  };\n  var tryEmailTransform = data => {\n    var url = data.href;\n    var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('/') === -1 && url.indexOf('mailto:') === -1;\n    return suggestMailTo ? Optional.some({\n      message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\n      preprocess: oldData => _objectSpread(_objectSpread({}, oldData), {}, {\n        href: 'mailto:' + url\n      })\n    }) : Optional.none();\n  };\n  var tryProtocolTransform = (assumeExternalTargets, defaultLinkProtocol) => data => {\n    var url = data.href;\n    var suggestProtocol = assumeExternalTargets === 1 && !hasProtocol(url) || assumeExternalTargets === 0 && /^\\s*www(\\.|\\d\\.)/i.test(url);\n    return suggestProtocol ? Optional.some({\n      message: \"The URL you entered seems to be an external link. Do you want to add the required \".concat(defaultLinkProtocol, \":// prefix?\"),\n      preprocess: oldData => _objectSpread(_objectSpread({}, oldData), {}, {\n        href: defaultLinkProtocol + '://' + url\n      })\n    }) : Optional.none();\n  };\n  var preprocess = (editor, data) => findMap([tryEmailTransform, tryProtocolTransform(assumeExternalTargets(editor), getDefaultLinkProtocol(editor))], f => f(data)).fold(() => Promise.resolve(data), transform => new Promise(callback => {\n    delayedConfirm(editor, transform.message, state => {\n      callback(state ? transform.preprocess(data) : data);\n    });\n  }));\n  var DialogConfirms = {\n    preprocess\n  };\n  var getAnchors = editor => {\n    var anchorNodes = editor.dom.select('a:not([href])');\n    var anchors = bind(anchorNodes, anchor => {\n      var id = anchor.name || anchor.id;\n      return id ? [{\n        text: id,\n        value: '#' + id\n      }] : [];\n    });\n    return anchors.length > 0 ? Optional.some([{\n      text: 'None',\n      value: ''\n    }].concat(anchors)) : Optional.none();\n  };\n  var AnchorListOptions = {\n    getAnchors\n  };\n  var getClasses = editor => {\n    var list = getLinkClassList(editor);\n    if (list.length > 0) {\n      return ListOptions.sanitize(list);\n    }\n    return Optional.none();\n  };\n  var ClassListOptions = {\n    getClasses\n  };\n  var parseJson = text => {\n    try {\n      return Optional.some(JSON.parse(text));\n    } catch (err) {\n      return Optional.none();\n    }\n  };\n  var getLinks = editor => {\n    var extractor = item => editor.convertURL(item.value || item.url || '', 'href');\n    var linkList = getLinkList(editor);\n    return new Promise(resolve => {\n      if (isString(linkList)) {\n        fetch(linkList).then(res => res.ok ? res.text().then(parseJson) : Promise.reject()).then(resolve, () => resolve(Optional.none()));\n      } else if (isFunction(linkList)) {\n        linkList(output => resolve(Optional.some(output)));\n      } else {\n        resolve(Optional.from(linkList));\n      }\n    }).then(optItems => optItems.bind(ListOptions.sanitizeWith(extractor)).map(items => {\n      if (items.length > 0) {\n        var noneItem = [{\n          text: 'None',\n          value: ''\n        }];\n        return noneItem.concat(items);\n      } else {\n        return items;\n      }\n    }));\n  };\n  var LinkListOptions = {\n    getLinks\n  };\n  var getRels = (editor, initialTarget) => {\n    var list = getRelList(editor);\n    if (list.length > 0) {\n      var isTargetBlank = is(initialTarget, '_blank');\n      var enforceSafe = allowUnsafeLinkTarget(editor) === false;\n      var safeRelExtractor = item => applyRelTargetRules(ListOptions.getValue(item), isTargetBlank);\n      var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;\n      return sanitizer(list);\n    }\n    return Optional.none();\n  };\n  var RelOptions = {\n    getRels\n  };\n  var fallbacks = [{\n    text: 'Current window',\n    value: ''\n  }, {\n    text: 'New window',\n    value: '_blank'\n  }];\n  var getTargets = editor => {\n    var list = getTargetList(editor);\n    if (isArray(list)) {\n      return ListOptions.sanitize(list).orThunk(() => Optional.some(fallbacks));\n    } else if (list === false) {\n      return Optional.none();\n    }\n    return Optional.some(fallbacks);\n  };\n  var TargetOptions = {\n    getTargets\n  };\n  var nonEmptyAttr = (dom, elem, name) => {\n    var val = dom.getAttrib(elem, name);\n    return val !== null && val.length > 0 ? Optional.some(val) : Optional.none();\n  };\n  var extractFromAnchor = (editor, anchor) => {\n    var dom = editor.dom;\n    var onlyText = isOnlyTextSelected(editor);\n    var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)) : Optional.none();\n    var url = anchor.bind(anchorElm => Optional.from(dom.getAttrib(anchorElm, 'href')));\n    var target = anchor.bind(anchorElm => Optional.from(dom.getAttrib(anchorElm, 'target')));\n    var rel = anchor.bind(anchorElm => nonEmptyAttr(dom, anchorElm, 'rel'));\n    var linkClass = anchor.bind(anchorElm => nonEmptyAttr(dom, anchorElm, 'class'));\n    var title = anchor.bind(anchorElm => nonEmptyAttr(dom, anchorElm, 'title'));\n    return {\n      url,\n      text,\n      title,\n      target,\n      rel,\n      linkClass\n    };\n  };\n  var collect = (editor, linkNode) => LinkListOptions.getLinks(editor).then(links => {\n    var anchor = extractFromAnchor(editor, linkNode);\n    return {\n      anchor,\n      catalogs: {\n        targets: TargetOptions.getTargets(editor),\n        rels: RelOptions.getRels(editor, anchor.target),\n        classes: ClassListOptions.getClasses(editor),\n        anchor: AnchorListOptions.getAnchors(editor),\n        link: links\n      },\n      optNode: linkNode,\n      flags: {\n        titleEnabled: shouldShowLinkTitle(editor)\n      }\n    };\n  });\n  var DialogInfo = {\n    collect\n  };\n  var handleSubmit = (editor, info) => api => {\n    var data = api.getData();\n    if (!data.url.value) {\n      unlink(editor);\n      api.close();\n      return;\n    }\n    var getChangedValue = key => Optional.from(data[key]).filter(value => !is(info.anchor[key], value));\n    var changedData = {\n      href: data.url.value,\n      text: getChangedValue('text'),\n      target: getChangedValue('target'),\n      rel: getChangedValue('rel'),\n      class: getChangedValue('linkClass'),\n      title: getChangedValue('title')\n    };\n    var attachState = {\n      href: data.url.value,\n      attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : noop\n    };\n    DialogConfirms.preprocess(editor, changedData).then(pData => {\n      link(editor, attachState, pData);\n    });\n    api.close();\n  };\n  var collectData = editor => {\n    var anchorNode = getAnchorElement(editor);\n    return DialogInfo.collect(editor, anchorNode);\n  };\n  var getInitialData = (info, defaultTarget) => {\n    var anchor = info.anchor;\n    var url = anchor.url.getOr('');\n    return {\n      url: {\n        value: url,\n        meta: {\n          original: {\n            value: url\n          }\n        }\n      },\n      text: anchor.text.getOr(''),\n      title: anchor.title.getOr(''),\n      anchor: url,\n      link: url,\n      rel: anchor.rel.getOr(''),\n      target: anchor.target.or(defaultTarget).getOr(''),\n      linkClass: anchor.linkClass.getOr('')\n    };\n  };\n  var makeDialog = (settings, onSubmit, editor) => {\n    var urlInput = [{\n      name: 'url',\n      type: 'urlinput',\n      filetype: 'file',\n      label: 'URL'\n    }];\n    var displayText = settings.anchor.text.map(() => ({\n      name: 'text',\n      type: 'input',\n      label: 'Text to display'\n    })).toArray();\n    var titleText = settings.flags.titleEnabled ? [{\n      name: 'title',\n      type: 'input',\n      label: 'Title'\n    }] : [];\n    var defaultTarget = Optional.from(getDefaultLinkTarget(editor));\n    var initialData = getInitialData(settings, defaultTarget);\n    var catalogs = settings.catalogs;\n    var dialogDelta = DialogChanges.init(initialData, catalogs);\n    var body = {\n      type: 'panel',\n      items: flatten([urlInput, displayText, titleText, cat([catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')), catalogs.rels.map(ListOptions.createUi('rel', 'Rel')), catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')), catalogs.link.map(ListOptions.createUi('link', 'Link list')), catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))])])\n    };\n    return {\n      title: 'Insert/Edit Link',\n      size: 'normal',\n      body,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData,\n      onChange: (api, _ref) => {\n        var {\n          name\n        } = _ref;\n        dialogDelta.onChange(api.getData, {\n          name\n        }).each(newData => {\n          api.setData(newData);\n        });\n      },\n      onSubmit\n    };\n  };\n  var open$1 = editor => {\n    var data = collectData(editor);\n    data.then(info => {\n      var onSubmit = handleSubmit(editor, info);\n      return makeDialog(info, onSubmit, editor);\n    }).then(spec => {\n      editor.windowManager.open(spec);\n    });\n  };\n  var register = editor => {\n    editor.addCommand('mceLink', (_ui, value) => {\n      if ((value === null || value === void 0 ? void 0 : value.dialog) === true || !useQuickLink(editor)) {\n        open$1(editor);\n      } else {\n        editor.dispatch('contexttoolbar-show', {\n          toolbarKey: 'quicklink'\n        });\n      }\n    });\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.util.VK');\n  var appendClickRemove = (link, evt) => {\n    document.body.appendChild(link);\n    link.dispatchEvent(evt);\n    document.body.removeChild(link);\n  };\n  var open = url => {\n    var link = document.createElement('a');\n    link.target = '_blank';\n    link.href = url;\n    link.rel = 'noreferrer noopener';\n    var evt = document.createEvent('MouseEvents');\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    appendClickRemove(link, evt);\n  };\n  var getLink = (editor, elm) => editor.dom.getParent(elm, 'a[href]');\n  var getSelectedLink = editor => getLink(editor, editor.selection.getStart());\n  var hasOnlyAltModifier = e => {\n    return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;\n  };\n  var gotoLink = (editor, a) => {\n    if (a) {\n      var href = getHref(a);\n      if (/^#/.test(href)) {\n        var targetEl = editor.dom.select(href);\n        if (targetEl.length) {\n          editor.selection.scrollIntoView(targetEl[0], true);\n        }\n      } else {\n        open(a.href);\n      }\n    }\n  };\n  var openDialog = editor => () => {\n    editor.execCommand('mceLink', false, {\n      dialog: true\n    });\n  };\n  var gotoSelectedLink = editor => () => {\n    gotoLink(editor, getSelectedLink(editor));\n  };\n  var setupGotoLinks = editor => {\n    editor.on('click', e => {\n      var link = getLink(editor, e.target);\n      if (link && global.metaKeyPressed(e)) {\n        e.preventDefault();\n        gotoLink(editor, link);\n      }\n    });\n    editor.on('keydown', e => {\n      if (!e.isDefaultPrevented() && e.keyCode === 13 && hasOnlyAltModifier(e)) {\n        var _link = getSelectedLink(editor);\n        if (_link) {\n          e.preventDefault();\n          gotoLink(editor, _link);\n        }\n      }\n    });\n  };\n  var toggleState = (editor, toggler) => {\n    editor.on('NodeChange', toggler);\n    return () => editor.off('NodeChange', toggler);\n  };\n  var toggleLinkState = editor => api => {\n    var updateState = () => {\n      api.setActive(!editor.mode.isReadOnly() && isInAnchor(editor, editor.selection.getNode()));\n      api.setEnabled(editor.selection.isEditable());\n    };\n    updateState();\n    return toggleState(editor, updateState);\n  };\n  var toggleLinkMenuState = editor => api => {\n    var updateState = () => {\n      api.setEnabled(editor.selection.isEditable());\n    };\n    updateState();\n    return toggleState(editor, updateState);\n  };\n  var hasExactlyOneLinkInSelection = editor => {\n    var links = editor.selection.isCollapsed() ? getLinks$1(editor.dom.getParents(editor.selection.getStart())) : getLinksInSelection(editor.selection.getRng());\n    return links.length === 1;\n  };\n  var toggleGotoLinkState = editor => api => {\n    var updateState = () => api.setEnabled(hasExactlyOneLinkInSelection(editor));\n    updateState();\n    return toggleState(editor, updateState);\n  };\n  var toggleUnlinkState = editor => api => {\n    var hasLinks$1 = parents => hasLinks(parents) || hasLinksInSelection(editor.selection.getRng());\n    var parents = editor.dom.getParents(editor.selection.getStart());\n    var updateEnabled = parents => {\n      api.setEnabled(hasLinks$1(parents) && editor.selection.isEditable());\n    };\n    updateEnabled(parents);\n    return toggleState(editor, e => updateEnabled(e.parents));\n  };\n  var setup = editor => {\n    editor.addShortcut('Meta+K', '', () => {\n      editor.execCommand('mceLink');\n    });\n  };\n  var setupButtons = editor => {\n    editor.ui.registry.addToggleButton('link', {\n      icon: 'link',\n      tooltip: 'Insert/edit link',\n      onAction: openDialog(editor),\n      onSetup: toggleLinkState(editor)\n    });\n    editor.ui.registry.addButton('openlink', {\n      icon: 'new-tab',\n      tooltip: 'Open link',\n      onAction: gotoSelectedLink(editor),\n      onSetup: toggleGotoLinkState(editor)\n    });\n    editor.ui.registry.addButton('unlink', {\n      icon: 'unlink',\n      tooltip: 'Remove link',\n      onAction: () => unlink(editor),\n      onSetup: toggleUnlinkState(editor)\n    });\n  };\n  var setupMenuItems = editor => {\n    editor.ui.registry.addMenuItem('openlink', {\n      text: 'Open link',\n      icon: 'new-tab',\n      onAction: gotoSelectedLink(editor),\n      onSetup: toggleGotoLinkState(editor)\n    });\n    editor.ui.registry.addMenuItem('link', {\n      icon: 'link',\n      text: 'Link...',\n      shortcut: 'Meta+K',\n      onSetup: toggleLinkMenuState(editor),\n      onAction: openDialog(editor)\n    });\n    editor.ui.registry.addMenuItem('unlink', {\n      icon: 'unlink',\n      text: 'Remove link',\n      onAction: () => unlink(editor),\n      onSetup: toggleUnlinkState(editor)\n    });\n  };\n  var setupContextMenu = editor => {\n    var inLink = 'link unlink openlink';\n    var noLink = 'link';\n    editor.ui.registry.addContextMenu('link', {\n      update: element => {\n        var isEditable = editor.dom.isEditable(element);\n        if (!isEditable) {\n          return '';\n        }\n        return hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;\n      }\n    });\n  };\n  var setupContextToolbars = editor => {\n    var collapseSelectionToEnd = editor => {\n      editor.selection.collapse(false);\n    };\n    var onSetupLink = buttonApi => {\n      var node = editor.selection.getNode();\n      buttonApi.setEnabled(isInAnchor(editor, node));\n      return noop;\n    };\n    var getLinkText = value => {\n      var anchor = getAnchorElement(editor);\n      var onlyText = isOnlyTextSelected(editor);\n      if (anchor.isNone() && onlyText) {\n        var text = getAnchorText(editor.selection, anchor);\n        return someIf(text.length === 0, value);\n      } else {\n        return Optional.none();\n      }\n    };\n    editor.ui.registry.addContextForm('quicklink', {\n      launch: {\n        type: 'contextformtogglebutton',\n        icon: 'link',\n        tooltip: 'Link',\n        onSetup: toggleLinkState(editor)\n      },\n      label: 'Link',\n      predicate: node => hasContextToolbar(editor) && isInAnchor(editor, node),\n      initValue: () => {\n        var elm = getAnchorElement(editor);\n        return elm.fold(constant(''), getHref);\n      },\n      commands: [{\n        type: 'contextformtogglebutton',\n        icon: 'link',\n        tooltip: 'Link',\n        primary: true,\n        onSetup: buttonApi => {\n          var node = editor.selection.getNode();\n          buttonApi.setActive(isInAnchor(editor, node));\n          return toggleLinkState(editor)(buttonApi);\n        },\n        onAction: formApi => {\n          var value = formApi.getValue();\n          var text = getLinkText(value);\n          var attachState = {\n            href: value,\n            attach: noop\n          };\n          link(editor, attachState, {\n            href: value,\n            text,\n            title: Optional.none(),\n            rel: Optional.none(),\n            target: Optional.none(),\n            class: Optional.none()\n          });\n          collapseSelectionToEnd(editor);\n          formApi.hide();\n        }\n      }, {\n        type: 'contextformbutton',\n        icon: 'unlink',\n        tooltip: 'Remove link',\n        onSetup: onSetupLink,\n        onAction: formApi => {\n          unlink(editor);\n          formApi.hide();\n        }\n      }, {\n        type: 'contextformbutton',\n        icon: 'new-tab',\n        tooltip: 'Open link',\n        onSetup: onSetupLink,\n        onAction: formApi => {\n          gotoSelectedLink(editor)();\n          formApi.hide();\n        }\n      }]\n    });\n  };\n  var Plugin = () => {\n    global$5.add('link', editor => {\n      register$1(editor);\n      setupButtons(editor);\n      setupMenuItems(editor);\n      setupContextMenu(editor);\n      setupContextToolbars(editor);\n      setupGotoLinks(editor);\n      register(editor);\n      setup(editor);\n    });\n  };\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/link/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/lists/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/lists/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"lists\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/lists')\n//   ES2015:\n//     import 'tinymce/plugins/lists'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/lists/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/lists/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/lists/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/lists/plugin.js ***!
  \******************************************************/
/***/ (() => {

eval("function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global$7 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var hasProto = (v, constructor, predicate) => {\n    var _a;\n    if (predicate(v, constructor.prototype)) {\n      return true;\n    } else {\n      return ((_a = v.constructor) === null || _a === void 0 ? void 0 : _a.name) === constructor.name;\n    }\n  };\n  var typeOf = x => {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && Array.isArray(x)) {\n      return 'array';\n    } else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType$1 = type => value => typeOf(value) === type;\n  var isSimpleType = type => value => typeof value === type;\n  var isString = isType$1('string');\n  var isObject = isType$1('object');\n  var isArray = isType$1('array');\n  var isBoolean = isSimpleType('boolean');\n  var isNullable = a => a === null || a === undefined;\n  var isNonNullable = a => !isNullable(a);\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n  var noop = () => {};\n  var constant = value => {\n    return () => {\n      return value;\n    };\n  };\n  var tripleEquals = (a, b) => {\n    return a === b;\n  };\n  function curry(fn) {\n    for (var _len = arguments.length, initialArgs = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      initialArgs[_key - 1] = arguments[_key];\n    }\n    return function () {\n      for (var _len2 = arguments.length, restArgs = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        restArgs[_key2] = arguments[_key2];\n      }\n      var all = initialArgs.concat(restArgs);\n      return fn.apply(null, all);\n    };\n  }\n  var not = f => t => !f(t);\n  var never = constant(false);\n  class Optional {\n    constructor(tag, value) {\n      this.tag = tag;\n      this.value = value;\n    }\n    static some(value) {\n      return new Optional(true, value);\n    }\n    static none() {\n      return Optional.singletonNone;\n    }\n    fold(onNone, onSome) {\n      if (this.tag) {\n        return onSome(this.value);\n      } else {\n        return onNone();\n      }\n    }\n    isSome() {\n      return this.tag;\n    }\n    isNone() {\n      return !this.tag;\n    }\n    map(mapper) {\n      if (this.tag) {\n        return Optional.some(mapper(this.value));\n      } else {\n        return Optional.none();\n      }\n    }\n    bind(binder) {\n      if (this.tag) {\n        return binder(this.value);\n      } else {\n        return Optional.none();\n      }\n    }\n    exists(predicate) {\n      return this.tag && predicate(this.value);\n    }\n    forall(predicate) {\n      return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n      if (!this.tag || predicate(this.value)) {\n        return this;\n      } else {\n        return Optional.none();\n      }\n    }\n    getOr(replacement) {\n      return this.tag ? this.value : replacement;\n    }\n    or(replacement) {\n      return this.tag ? this : replacement;\n    }\n    getOrThunk(thunk) {\n      return this.tag ? this.value : thunk();\n    }\n    orThunk(thunk) {\n      return this.tag ? this : thunk();\n    }\n    getOrDie(message) {\n      if (!this.tag) {\n        throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n      } else {\n        return this.value;\n      }\n    }\n    static from(value) {\n      return isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    getOrNull() {\n      return this.tag ? this.value : null;\n    }\n    getOrUndefined() {\n      return this.value;\n    }\n    each(worker) {\n      if (this.tag) {\n        worker(this.value);\n      }\n    }\n    toArray() {\n      return this.tag ? [this.value] : [];\n    }\n    toString() {\n      return this.tag ? \"some(\".concat(this.value, \")\") : 'none()';\n    }\n  }\n  Optional.singletonNone = new Optional(false);\n  var nativeSlice = Array.prototype.slice;\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n  var rawIndexOf = (ts, t) => nativeIndexOf.call(ts, t);\n  var contains$1 = (xs, x) => rawIndexOf(xs, x) > -1;\n  var exists = (xs, pred) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n    return false;\n  };\n  var map = (xs, f) => {\n    var len = xs.length;\n    var r = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n    return r;\n  };\n  var each$1 = (xs, f) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n  var filter$1 = (xs, pred) => {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n    return r;\n  };\n  var groupBy = (xs, f) => {\n    if (xs.length === 0) {\n      return [];\n    } else {\n      var wasType = f(xs[0]);\n      var r = [];\n      var group = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var _type = f(x);\n        if (_type !== wasType) {\n          r.push(group);\n          group = [];\n        }\n        wasType = _type;\n        group.push(x);\n      }\n      if (group.length !== 0) {\n        r.push(group);\n      }\n      return r;\n    }\n  };\n  var foldl = (xs, f, acc) => {\n    each$1(xs, (x, i) => {\n      acc = f(acc, x, i);\n    });\n    return acc;\n  };\n  var findUntil = (xs, pred, until) => {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var find = (xs, pred) => {\n    return findUntil(xs, pred, never);\n  };\n  var flatten = xs => {\n    var r = [];\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n      nativePush.apply(r, xs[i]);\n    }\n    return r;\n  };\n  var bind = (xs, f) => flatten(map(xs, f));\n  var reverse = xs => {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n  var get$1 = (xs, i) => i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  var head = xs => get$1(xs, 0);\n  var last = xs => get$1(xs, xs.length - 1);\n  var unique = (xs, comparator) => {\n    var r = [];\n    var isDuplicated = isFunction(comparator) ? x => exists(r, i => comparator(i, x)) : x => contains$1(r, x);\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      if (!isDuplicated(x)) {\n        r.push(x);\n      }\n    }\n    return r;\n  };\n  var is$2 = function is$2(lhs, rhs) {\n    var comparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : tripleEquals;\n    return lhs.exists(left => comparator(left, rhs));\n  };\n  var equals = function equals(lhs, rhs) {\n    var comparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : tripleEquals;\n    return lift2(lhs, rhs, comparator).getOr(lhs.isNone() && rhs.isNone());\n  };\n  var lift2 = (oa, ob, f) => oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n  var ELEMENT = 1;\n  var fromHtml = (html, scope) => {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      var message = 'HTML does not have a single root node';\n      console.error(message, html);\n      throw new Error(message);\n    }\n    return fromDom$1(div.childNodes[0]);\n  };\n  var fromTag = (tag, scope) => {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom$1(node);\n  };\n  var fromText = (text, scope) => {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom$1(node);\n  };\n  var fromDom$1 = node => {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n    return {\n      dom: node\n    };\n  };\n  var fromPoint = (docElm, x, y) => Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom$1);\n  var SugarElement = {\n    fromHtml,\n    fromTag,\n    fromText,\n    fromDom: fromDom$1,\n    fromPoint\n  };\n  var is$1 = (element, selector) => {\n    var dom = element.dom;\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n  var eq = (e1, e2) => e1.dom === e2.dom;\n  var contains = (e1, e2) => {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n  var is = is$1;\n  var ClosestOrAncestor = (is, ancestor, scope, a, isRoot) => {\n    if (is(scope, a)) {\n      return Optional.some(scope);\n    } else if (isFunction(isRoot) && isRoot(scope)) {\n      return Optional.none();\n    } else {\n      return ancestor(scope, a, isRoot);\n    }\n  };\n  typeof window !== 'undefined' ? window : Function('return this;')();\n  var name = element => {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n  var type = element => element.dom.nodeType;\n  var isType = t => element => type(element) === t;\n  var isElement$1 = isType(ELEMENT);\n  var isTag = tag => e => isElement$1(e) && name(e) === tag;\n  var parent = element => Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  var parentElement = element => Optional.from(element.dom.parentElement).map(SugarElement.fromDom);\n  var nextSibling = element => Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n  var children = element => map(element.dom.childNodes, SugarElement.fromDom);\n  var child = (element, index) => {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n  var firstChild = element => child(element, 0);\n  var lastChild = element => child(element, element.dom.childNodes.length - 1);\n  var ancestor$2 = (scope, predicate, isRoot) => {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var closest = (scope, predicate, isRoot) => {\n    var is = (s, test) => test(s);\n    return ClosestOrAncestor(is, ancestor$2, scope, predicate, isRoot);\n  };\n  var before$1 = (marker, element) => {\n    var parent$1 = parent(marker);\n    parent$1.each(v => {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n  var after = (marker, element) => {\n    var sibling = nextSibling(marker);\n    sibling.fold(() => {\n      var parent$1 = parent(marker);\n      parent$1.each(v => {\n        append$1(v, element);\n      });\n    }, v => {\n      before$1(v, element);\n    });\n  };\n  var append$1 = (parent, element) => {\n    parent.dom.appendChild(element.dom);\n  };\n  var before = (marker, elements) => {\n    each$1(elements, x => {\n      before$1(marker, x);\n    });\n  };\n  var append = (parent, elements) => {\n    each$1(elements, x => {\n      append$1(parent, x);\n    });\n  };\n  var empty = element => {\n    element.dom.textContent = '';\n    each$1(children(element), rogue => {\n      remove(rogue);\n    });\n  };\n  var remove = element => {\n    var dom = element.dom;\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n  var global$6 = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');\n  var global$5 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n  var global$4 = tinymce.util.Tools.resolve('tinymce.util.VK');\n  var fromDom = nodes => map(nodes, SugarElement.fromDom);\n  var keys = Object.keys;\n  var each = (obj, f) => {\n    var props = keys(obj);\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n  var objAcc = r => (x, i) => {\n    r[i] = x;\n  };\n  var internalFilter = (obj, pred, onTrue, onFalse) => {\n    each(obj, (x, i) => {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n  };\n  var filter = (obj, pred) => {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n  var rawSet = (dom, key, value) => {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n  var setAll = (element, attrs) => {\n    var dom = element.dom;\n    each(attrs, (v, k) => {\n      rawSet(dom, k, v);\n    });\n  };\n  var clone$1 = element => foldl(element.dom.attributes, (acc, attr) => {\n    acc[attr.name] = attr.value;\n    return acc;\n  }, {});\n  var clone = (original, isDeep) => SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  var deep = original => clone(original, true);\n  var shallowAs = (original, tag) => {\n    var nu = SugarElement.fromTag(tag);\n    var attributes = clone$1(original);\n    setAll(nu, attributes);\n    return nu;\n  };\n  var mutate = (original, tag) => {\n    var nu = shallowAs(original, tag);\n    after(original, nu);\n    var children$1 = children(original);\n    append(nu, children$1);\n    remove(original);\n    return nu;\n  };\n  var global$3 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var matchNodeName = name => node => isNonNullable(node) && node.nodeName.toLowerCase() === name;\n  var matchNodeNames = regex => node => isNonNullable(node) && regex.test(node.nodeName);\n  var isTextNode$1 = node => isNonNullable(node) && node.nodeType === 3;\n  var isElement = node => isNonNullable(node) && node.nodeType === 1;\n  var isListNode = matchNodeNames(/^(OL|UL|DL)$/);\n  var isOlUlNode = matchNodeNames(/^(OL|UL)$/);\n  var isOlNode = matchNodeName('ol');\n  var isListItemNode = matchNodeNames(/^(LI|DT|DD)$/);\n  var isDlItemNode = matchNodeNames(/^(DT|DD)$/);\n  var isTableCellNode = matchNodeNames(/^(TH|TD)$/);\n  var isBr = matchNodeName('br');\n  var isFirstChild = node => {\n    var _a;\n    return ((_a = node.parentNode) === null || _a === void 0 ? void 0 : _a.firstChild) === node;\n  };\n  var isTextBlock = (editor, node) => isNonNullable(node) && node.nodeName in editor.schema.getTextBlockElements();\n  var isBlock = (node, blockElements) => isNonNullable(node) && node.nodeName in blockElements;\n  var isVoid = (editor, node) => isNonNullable(node) && node.nodeName in editor.schema.getVoidElements();\n  var isBogusBr = (dom, node) => {\n    if (!isBr(node)) {\n      return false;\n    }\n    return dom.isBlock(node.nextSibling) && !isBr(node.previousSibling);\n  };\n  var isEmpty$2 = (dom, elm, keepBookmarks) => {\n    var empty = dom.isEmpty(elm);\n    if (keepBookmarks && dom.select('span[data-mce-type=bookmark]', elm).length > 0) {\n      return false;\n    }\n    return empty;\n  };\n  var isChildOfBody = (dom, elm) => dom.isChildOf(elm, dom.getRoot());\n  var option = name => editor => editor.options.get(name);\n  var register$3 = editor => {\n    var registerOption = editor.options.register;\n    registerOption('lists_indent_on_tab', {\n      processor: 'boolean',\n      default: true\n    });\n  };\n  var shouldIndentOnTab = option('lists_indent_on_tab');\n  var getForcedRootBlock = option('forced_root_block');\n  var getForcedRootBlockAttrs = option('forced_root_block_attrs');\n  var createTextBlock = (editor, contentNode) => {\n    var dom = editor.dom;\n    var blockElements = editor.schema.getBlockElements();\n    var fragment = dom.createFragment();\n    var blockName = getForcedRootBlock(editor);\n    var blockAttrs = getForcedRootBlockAttrs(editor);\n    var node;\n    var textBlock;\n    var hasContentNode = false;\n    textBlock = dom.create(blockName, blockAttrs);\n    if (!isBlock(contentNode.firstChild, blockElements)) {\n      fragment.appendChild(textBlock);\n    }\n    while (node = contentNode.firstChild) {\n      var nodeName = node.nodeName;\n      if (!hasContentNode && (nodeName !== 'SPAN' || node.getAttribute('data-mce-type') !== 'bookmark')) {\n        hasContentNode = true;\n      }\n      if (isBlock(node, blockElements)) {\n        fragment.appendChild(node);\n        textBlock = null;\n      } else {\n        if (!textBlock) {\n          textBlock = dom.create(blockName, blockAttrs);\n          fragment.appendChild(textBlock);\n        }\n        textBlock.appendChild(node);\n      }\n    }\n    if (!hasContentNode && textBlock) {\n      textBlock.appendChild(dom.create('br', {\n        'data-mce-bogus': '1'\n      }));\n    }\n    return fragment;\n  };\n  var DOM$2 = global$3.DOM;\n  var splitList = (editor, list, li) => {\n    var removeAndKeepBookmarks = targetNode => {\n      var parent = targetNode.parentNode;\n      if (parent) {\n        global$2.each(bookmarks, node => {\n          parent.insertBefore(node, li.parentNode);\n        });\n      }\n      DOM$2.remove(targetNode);\n    };\n    var bookmarks = DOM$2.select('span[data-mce-type=\"bookmark\"]', list);\n    var newBlock = createTextBlock(editor, li);\n    var tmpRng = DOM$2.createRng();\n    tmpRng.setStartAfter(li);\n    tmpRng.setEndAfter(list);\n    var fragment = tmpRng.extractContents();\n    for (var node = fragment.firstChild; node; node = node.firstChild) {\n      if (node.nodeName === 'LI' && editor.dom.isEmpty(node)) {\n        DOM$2.remove(node);\n        break;\n      }\n    }\n    if (!editor.dom.isEmpty(fragment)) {\n      DOM$2.insertAfter(fragment, list);\n    }\n    DOM$2.insertAfter(newBlock, list);\n    var parent = li.parentElement;\n    if (parent && isEmpty$2(editor.dom, parent)) {\n      removeAndKeepBookmarks(parent);\n    }\n    DOM$2.remove(li);\n    if (isEmpty$2(editor.dom, list)) {\n      DOM$2.remove(list);\n    }\n  };\n  var isDescriptionDetail = isTag('dd');\n  var isDescriptionTerm = isTag('dt');\n  var outdentDlItem = (editor, item) => {\n    if (isDescriptionDetail(item)) {\n      mutate(item, 'dt');\n    } else if (isDescriptionTerm(item)) {\n      parentElement(item).each(dl => splitList(editor, dl.dom, item.dom));\n    }\n  };\n  var indentDlItem = item => {\n    if (isDescriptionTerm(item)) {\n      mutate(item, 'dd');\n    }\n  };\n  var dlIndentation = (editor, indentation, dlItems) => {\n    if (indentation === 'Indent') {\n      each$1(dlItems, indentDlItem);\n    } else {\n      each$1(dlItems, item => outdentDlItem(editor, item));\n    }\n  };\n  var getNormalizedPoint = (container, offset) => {\n    if (isTextNode$1(container)) {\n      return {\n        container,\n        offset\n      };\n    }\n    var node = global$6.getNode(container, offset);\n    if (isTextNode$1(node)) {\n      return {\n        container: node,\n        offset: offset >= container.childNodes.length ? node.data.length : 0\n      };\n    } else if (node.previousSibling && isTextNode$1(node.previousSibling)) {\n      return {\n        container: node.previousSibling,\n        offset: node.previousSibling.data.length\n      };\n    } else if (node.nextSibling && isTextNode$1(node.nextSibling)) {\n      return {\n        container: node.nextSibling,\n        offset: 0\n      };\n    }\n    return {\n      container,\n      offset\n    };\n  };\n  var normalizeRange = rng => {\n    var outRng = rng.cloneRange();\n    var rangeStart = getNormalizedPoint(rng.startContainer, rng.startOffset);\n    outRng.setStart(rangeStart.container, rangeStart.offset);\n    var rangeEnd = getNormalizedPoint(rng.endContainer, rng.endOffset);\n    outRng.setEnd(rangeEnd.container, rangeEnd.offset);\n    return outRng;\n  };\n  var listNames = ['OL', 'UL', 'DL'];\n  var listSelector = listNames.join(',');\n  var getParentList = (editor, node) => {\n    var selectionStart = node || editor.selection.getStart(true);\n    return editor.dom.getParent(selectionStart, listSelector, getClosestListHost(editor, selectionStart));\n  };\n  var isParentListSelected = (parentList, selectedBlocks) => isNonNullable(parentList) && selectedBlocks.length === 1 && selectedBlocks[0] === parentList;\n  var findSubLists = parentList => filter$1(parentList.querySelectorAll(listSelector), isListNode);\n  var getSelectedSubLists = editor => {\n    var parentList = getParentList(editor);\n    var selectedBlocks = editor.selection.getSelectedBlocks();\n    if (isParentListSelected(parentList, selectedBlocks)) {\n      return findSubLists(parentList);\n    } else {\n      return filter$1(selectedBlocks, elm => {\n        return isListNode(elm) && parentList !== elm;\n      });\n    }\n  };\n  var findParentListItemsNodes = (editor, elms) => {\n    var listItemsElms = global$2.map(elms, elm => {\n      var parentLi = editor.dom.getParent(elm, 'li,dd,dt', getClosestListHost(editor, elm));\n      return parentLi ? parentLi : elm;\n    });\n    return unique(listItemsElms);\n  };\n  var getSelectedListItems = editor => {\n    var selectedBlocks = editor.selection.getSelectedBlocks();\n    return filter$1(findParentListItemsNodes(editor, selectedBlocks), isListItemNode);\n  };\n  var getSelectedDlItems = editor => filter$1(getSelectedListItems(editor), isDlItemNode);\n  var getClosestEditingHost = (editor, elm) => {\n    var parentTableCell = editor.dom.getParents(elm, 'TD,TH');\n    return parentTableCell.length > 0 ? parentTableCell[0] : editor.getBody();\n  };\n  var isListHost = (schema, node) => !isListNode(node) && !isListItemNode(node) && exists(listNames, listName => schema.isValidChild(node.nodeName, listName));\n  var getClosestListHost = (editor, elm) => {\n    var parentBlocks = editor.dom.getParents(elm, editor.dom.isBlock);\n    var parentBlock = find(parentBlocks, elm => isListHost(editor.schema, elm));\n    return parentBlock.getOr(editor.getBody());\n  };\n  var findLastParentListNode = (editor, elm) => {\n    var parentLists = editor.dom.getParents(elm, 'ol,ul', getClosestListHost(editor, elm));\n    return last(parentLists);\n  };\n  var getSelectedLists = editor => {\n    var firstList = findLastParentListNode(editor, editor.selection.getStart());\n    var subsequentLists = filter$1(editor.selection.getSelectedBlocks(), isOlUlNode);\n    return firstList.toArray().concat(subsequentLists);\n  };\n  var getSelectedListRoots = editor => {\n    var selectedLists = getSelectedLists(editor);\n    return getUniqueListRoots(editor, selectedLists);\n  };\n  var getUniqueListRoots = (editor, lists) => {\n    var listRoots = map(lists, list => findLastParentListNode(editor, list).getOr(list));\n    return unique(listRoots);\n  };\n  var isCustomList = list => /\\btox\\-/.test(list.className);\n  var inList = (parents, listName) => findUntil(parents, isListNode, isTableCellNode).exists(list => list.nodeName === listName && !isCustomList(list));\n  var isWithinNonEditable = (editor, element) => element !== null && !editor.dom.isEditable(element);\n  var selectionIsWithinNonEditableList = editor => {\n    var parentList = getParentList(editor);\n    return isWithinNonEditable(editor, parentList);\n  };\n  var isWithinNonEditableList = (editor, element) => {\n    var parentList = editor.dom.getParent(element, 'ol,ul,dl');\n    return isWithinNonEditable(editor, parentList);\n  };\n  var setNodeChangeHandler = (editor, nodeChangeHandler) => {\n    var initialNode = editor.selection.getNode();\n    nodeChangeHandler({\n      parents: editor.dom.getParents(initialNode),\n      element: initialNode\n    });\n    editor.on('NodeChange', nodeChangeHandler);\n    return () => editor.off('NodeChange', nodeChangeHandler);\n  };\n  var fromElements = (elements, scope) => {\n    var doc = scope || document;\n    var fragment = doc.createDocumentFragment();\n    each$1(elements, element => {\n      fragment.appendChild(element.dom);\n    });\n    return SugarElement.fromDom(fragment);\n  };\n  var fireListEvent = (editor, action, element) => editor.dispatch('ListMutation', {\n    action,\n    element\n  });\n  var blank = r => s => s.replace(r, '');\n  var trim = blank(/^\\s+|\\s+$/g);\n  var isNotEmpty = s => s.length > 0;\n  var isEmpty$1 = s => !isNotEmpty(s);\n  var isSupported = dom => dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  var internalSet = (dom, property, value) => {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n    if (isSupported(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n  var set = (element, property, value) => {\n    var dom = element.dom;\n    internalSet(dom, property, value);\n  };\n  var joinSegment = (parent, child) => {\n    append$1(parent.item, child.list);\n  };\n  var joinSegments = segments => {\n    for (var i = 1; i < segments.length; i++) {\n      joinSegment(segments[i - 1], segments[i]);\n    }\n  };\n  var appendSegments = (head$1, tail) => {\n    lift2(last(head$1), head(tail), joinSegment);\n  };\n  var createSegment = (scope, listType) => {\n    var segment = {\n      list: SugarElement.fromTag(listType, scope),\n      item: SugarElement.fromTag('li', scope)\n    };\n    append$1(segment.list, segment.item);\n    return segment;\n  };\n  var createSegments = (scope, entry, size) => {\n    var segments = [];\n    for (var i = 0; i < size; i++) {\n      segments.push(createSegment(scope, entry.listType));\n    }\n    return segments;\n  };\n  var populateSegments = (segments, entry) => {\n    for (var i = 0; i < segments.length - 1; i++) {\n      set(segments[i].item, 'list-style-type', 'none');\n    }\n    last(segments).each(segment => {\n      setAll(segment.list, entry.listAttributes);\n      setAll(segment.item, entry.itemAttributes);\n      append(segment.item, entry.content);\n    });\n  };\n  var normalizeSegment = (segment, entry) => {\n    if (name(segment.list) !== entry.listType) {\n      segment.list = mutate(segment.list, entry.listType);\n    }\n    setAll(segment.list, entry.listAttributes);\n  };\n  var createItem = (scope, attr, content) => {\n    var item = SugarElement.fromTag('li', scope);\n    setAll(item, attr);\n    append(item, content);\n    return item;\n  };\n  var appendItem = (segment, item) => {\n    append$1(segment.list, item);\n    segment.item = item;\n  };\n  var writeShallow = (scope, cast, entry) => {\n    var newCast = cast.slice(0, entry.depth);\n    last(newCast).each(segment => {\n      var item = createItem(scope, entry.itemAttributes, entry.content);\n      appendItem(segment, item);\n      normalizeSegment(segment, entry);\n    });\n    return newCast;\n  };\n  var writeDeep = (scope, cast, entry) => {\n    var segments = createSegments(scope, entry, entry.depth - cast.length);\n    joinSegments(segments);\n    populateSegments(segments, entry);\n    appendSegments(cast, segments);\n    return cast.concat(segments);\n  };\n  var composeList = (scope, entries) => {\n    var cast = foldl(entries, (cast, entry) => {\n      return entry.depth > cast.length ? writeDeep(scope, cast, entry) : writeShallow(scope, cast, entry);\n    }, []);\n    return head(cast).map(segment => segment.list);\n  };\n  var isList = el => is(el, 'OL,UL');\n  var hasFirstChildList = el => firstChild(el).exists(isList);\n  var hasLastChildList = el => lastChild(el).exists(isList);\n  var isIndented = entry => entry.depth > 0;\n  var isSelected = entry => entry.isSelected;\n  var cloneItemContent = li => {\n    var children$1 = children(li);\n    var content = hasLastChildList(li) ? children$1.slice(0, -1) : children$1;\n    return map(content, deep);\n  };\n  var createEntry = (li, depth, isSelected) => parent(li).filter(isElement$1).map(list => ({\n    depth,\n    dirty: false,\n    isSelected,\n    content: cloneItemContent(li),\n    itemAttributes: clone$1(li),\n    listAttributes: clone$1(list),\n    listType: name(list)\n  }));\n  var indentEntry = (indentation, entry) => {\n    switch (indentation) {\n      case 'Indent':\n        entry.depth++;\n        break;\n      case 'Outdent':\n        entry.depth--;\n        break;\n      case 'Flatten':\n        entry.depth = 0;\n    }\n    entry.dirty = true;\n  };\n  var cloneListProperties = (target, source) => {\n    target.listType = source.listType;\n    target.listAttributes = _objectSpread({}, source.listAttributes);\n  };\n  var cleanListProperties = entry => {\n    entry.listAttributes = filter(entry.listAttributes, (_value, key) => key !== 'start');\n  };\n  var closestSiblingEntry = (entries, start) => {\n    var depth = entries[start].depth;\n    var matches = entry => entry.depth === depth && !entry.dirty;\n    var until = entry => entry.depth < depth;\n    return findUntil(reverse(entries.slice(0, start)), matches, until).orThunk(() => findUntil(entries.slice(start + 1), matches, until));\n  };\n  var normalizeEntries = entries => {\n    each$1(entries, (entry, i) => {\n      closestSiblingEntry(entries, i).fold(() => {\n        if (entry.dirty) {\n          cleanListProperties(entry);\n        }\n      }, matchingEntry => cloneListProperties(entry, matchingEntry));\n    });\n    return entries;\n  };\n  var Cell = initial => {\n    var value = initial;\n    var get = () => {\n      return value;\n    };\n    var set = v => {\n      value = v;\n    };\n    return {\n      get,\n      set\n    };\n  };\n  var parseItem = (depth, itemSelection, selectionState, item) => firstChild(item).filter(isList).fold(() => {\n    itemSelection.each(selection => {\n      if (eq(selection.start, item)) {\n        selectionState.set(true);\n      }\n    });\n    var currentItemEntry = createEntry(item, depth, selectionState.get());\n    itemSelection.each(selection => {\n      if (eq(selection.end, item)) {\n        selectionState.set(false);\n      }\n    });\n    var childListEntries = lastChild(item).filter(isList).map(list => parseList(depth, itemSelection, selectionState, list)).getOr([]);\n    return currentItemEntry.toArray().concat(childListEntries);\n  }, list => parseList(depth, itemSelection, selectionState, list));\n  var parseList = (depth, itemSelection, selectionState, list) => bind(children(list), element => {\n    var parser = isList(element) ? parseList : parseItem;\n    var newDepth = depth + 1;\n    return parser(newDepth, itemSelection, selectionState, element);\n  });\n  var parseLists = (lists, itemSelection) => {\n    var selectionState = Cell(false);\n    var initialDepth = 0;\n    return map(lists, list => ({\n      sourceList: list,\n      entries: parseList(initialDepth, itemSelection, selectionState, list)\n    }));\n  };\n  var outdentedComposer = (editor, entries) => {\n    var normalizedEntries = normalizeEntries(entries);\n    return map(normalizedEntries, entry => {\n      var content = fromElements(entry.content);\n      return SugarElement.fromDom(createTextBlock(editor, content.dom));\n    });\n  };\n  var indentedComposer = (editor, entries) => {\n    var normalizedEntries = normalizeEntries(entries);\n    return composeList(editor.contentDocument, normalizedEntries).toArray();\n  };\n  var composeEntries = (editor, entries) => bind(groupBy(entries, isIndented), entries => {\n    var groupIsIndented = head(entries).exists(isIndented);\n    return groupIsIndented ? indentedComposer(editor, entries) : outdentedComposer(editor, entries);\n  });\n  var indentSelectedEntries = (entries, indentation) => {\n    each$1(filter$1(entries, isSelected), entry => indentEntry(indentation, entry));\n  };\n  var getItemSelection = editor => {\n    var selectedListItems = map(getSelectedListItems(editor), SugarElement.fromDom);\n    return lift2(find(selectedListItems, not(hasFirstChildList)), find(reverse(selectedListItems), not(hasFirstChildList)), (start, end) => ({\n      start,\n      end\n    }));\n  };\n  var listIndentation = (editor, lists, indentation) => {\n    var entrySets = parseLists(lists, getItemSelection(editor));\n    each$1(entrySets, entrySet => {\n      indentSelectedEntries(entrySet.entries, indentation);\n      var composedLists = composeEntries(editor, entrySet.entries);\n      each$1(composedLists, composedList => {\n        fireListEvent(editor, indentation === 'Indent' ? 'IndentList' : 'OutdentList', composedList.dom);\n      });\n      before(entrySet.sourceList, composedLists);\n      remove(entrySet.sourceList);\n    });\n  };\n  var selectionIndentation = (editor, indentation) => {\n    var lists = fromDom(getSelectedListRoots(editor));\n    var dlItems = fromDom(getSelectedDlItems(editor));\n    var isHandled = false;\n    if (lists.length || dlItems.length) {\n      var bookmark = editor.selection.getBookmark();\n      listIndentation(editor, lists, indentation);\n      dlIndentation(editor, indentation, dlItems);\n      editor.selection.moveToBookmark(bookmark);\n      editor.selection.setRng(normalizeRange(editor.selection.getRng()));\n      editor.nodeChanged();\n      isHandled = true;\n    }\n    return isHandled;\n  };\n  var handleIndentation = (editor, indentation) => !selectionIsWithinNonEditableList(editor) && selectionIndentation(editor, indentation);\n  var indentListSelection = editor => handleIndentation(editor, 'Indent');\n  var outdentListSelection = editor => handleIndentation(editor, 'Outdent');\n  var flattenListSelection = editor => handleIndentation(editor, 'Flatten');\n  var zeroWidth = '\\uFEFF';\n  var isZwsp = char => char === zeroWidth;\n  var ancestor$1 = (scope, predicate, isRoot) => ancestor$2(scope, predicate, isRoot).isSome();\n  var ancestor = (element, target) => ancestor$1(element, curry(eq, target));\n  var global$1 = tinymce.util.Tools.resolve('tinymce.dom.BookmarkManager');\n  var DOM$1 = global$3.DOM;\n  var createBookmark = rng => {\n    var bookmark = {};\n    var setupEndPoint = start => {\n      var container = rng[start ? 'startContainer' : 'endContainer'];\n      var offset = rng[start ? 'startOffset' : 'endOffset'];\n      if (isElement(container)) {\n        var offsetNode = DOM$1.create('span', {\n          'data-mce-type': 'bookmark'\n        });\n        if (container.hasChildNodes()) {\n          offset = Math.min(offset, container.childNodes.length - 1);\n          if (start) {\n            container.insertBefore(offsetNode, container.childNodes[offset]);\n          } else {\n            DOM$1.insertAfter(offsetNode, container.childNodes[offset]);\n          }\n        } else {\n          container.appendChild(offsetNode);\n        }\n        container = offsetNode;\n        offset = 0;\n      }\n      bookmark[start ? 'startContainer' : 'endContainer'] = container;\n      bookmark[start ? 'startOffset' : 'endOffset'] = offset;\n    };\n    setupEndPoint(true);\n    if (!rng.collapsed) {\n      setupEndPoint();\n    }\n    return bookmark;\n  };\n  var resolveBookmark = bookmark => {\n    var restoreEndPoint = start => {\n      var nodeIndex = container => {\n        var _a;\n        var node = (_a = container.parentNode) === null || _a === void 0 ? void 0 : _a.firstChild;\n        var idx = 0;\n        while (node) {\n          if (node === container) {\n            return idx;\n          }\n          if (!isElement(node) || node.getAttribute('data-mce-type') !== 'bookmark') {\n            idx++;\n          }\n          node = node.nextSibling;\n        }\n        return -1;\n      };\n      var container = bookmark[start ? 'startContainer' : 'endContainer'];\n      var offset = bookmark[start ? 'startOffset' : 'endOffset'];\n      if (!container) {\n        return;\n      }\n      if (isElement(container) && container.parentNode) {\n        var node = container;\n        offset = nodeIndex(container);\n        container = container.parentNode;\n        DOM$1.remove(node);\n        if (!container.hasChildNodes() && DOM$1.isBlock(container)) {\n          container.appendChild(DOM$1.create('br'));\n        }\n      }\n      bookmark[start ? 'startContainer' : 'endContainer'] = container;\n      bookmark[start ? 'startOffset' : 'endOffset'] = offset;\n    };\n    restoreEndPoint(true);\n    restoreEndPoint();\n    var rng = DOM$1.createRng();\n    rng.setStart(bookmark.startContainer, bookmark.startOffset);\n    if (bookmark.endContainer) {\n      rng.setEnd(bookmark.endContainer, bookmark.endOffset);\n    }\n    return normalizeRange(rng);\n  };\n  var listToggleActionFromListName = listName => {\n    switch (listName) {\n      case 'UL':\n        return 'ToggleUlList';\n      case 'OL':\n        return 'ToggleOlList';\n      case 'DL':\n        return 'ToggleDLList';\n    }\n  };\n  var updateListStyle = (dom, el, detail) => {\n    var type = detail['list-style-type'] ? detail['list-style-type'] : null;\n    dom.setStyle(el, 'list-style-type', type);\n  };\n  var setAttribs = (elm, attrs) => {\n    global$2.each(attrs, (value, key) => {\n      elm.setAttribute(key, value);\n    });\n  };\n  var updateListAttrs = (dom, el, detail) => {\n    setAttribs(el, detail['list-attributes']);\n    global$2.each(dom.select('li', el), li => {\n      setAttribs(li, detail['list-item-attributes']);\n    });\n  };\n  var updateListWithDetails = (dom, el, detail) => {\n    updateListStyle(dom, el, detail);\n    updateListAttrs(dom, el, detail);\n  };\n  var removeStyles = (dom, element, styles) => {\n    global$2.each(styles, style => dom.setStyle(element, style, ''));\n  };\n  var isInline = (editor, node) => isNonNullable(node) && !isBlock(node, editor.schema.getBlockElements());\n  var getEndPointNode = (editor, rng, start, root) => {\n    var container = rng[start ? 'startContainer' : 'endContainer'];\n    var offset = rng[start ? 'startOffset' : 'endOffset'];\n    if (isElement(container)) {\n      container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n    }\n    if (!start && isBr(container.nextSibling)) {\n      container = container.nextSibling;\n    }\n    var findBlockAncestor = node => {\n      while (!editor.dom.isBlock(node) && node.parentNode && root !== node) {\n        node = node.parentNode;\n      }\n      return node;\n    };\n    var findBetterContainer = (container, forward) => {\n      var _a;\n      var walker = new global$5(container, findBlockAncestor(container));\n      var dir = forward ? 'next' : 'prev';\n      var node;\n      while (node = walker[dir]()) {\n        if (!(isVoid(editor, node) || isZwsp(node.textContent) || ((_a = node.textContent) === null || _a === void 0 ? void 0 : _a.length) === 0)) {\n          return Optional.some(node);\n        }\n      }\n      return Optional.none();\n    };\n    if (start && isTextNode$1(container)) {\n      if (isZwsp(container.textContent)) {\n        container = findBetterContainer(container, false).getOr(container);\n      } else {\n        if (container.parentNode !== null && isInline(editor, container.parentNode)) {\n          container = container.parentNode;\n        }\n        while (container.previousSibling !== null && (isInline(editor, container.previousSibling) || isTextNode$1(container.previousSibling))) {\n          container = container.previousSibling;\n        }\n      }\n    }\n    if (!start && isTextNode$1(container)) {\n      if (isZwsp(container.textContent)) {\n        container = findBetterContainer(container, true).getOr(container);\n      } else {\n        if (container.parentNode !== null && isInline(editor, container.parentNode)) {\n          container = container.parentNode;\n        }\n        while (container.nextSibling !== null && (isInline(editor, container.nextSibling) || isTextNode$1(container.nextSibling))) {\n          container = container.nextSibling;\n        }\n      }\n    }\n    while (container.parentNode !== root) {\n      var _parent = container.parentNode;\n      if (isTextBlock(editor, container)) {\n        return container;\n      }\n      if (/^(TD|TH)$/.test(_parent.nodeName)) {\n        return container;\n      }\n      container = _parent;\n    }\n    return container;\n  };\n  var getSelectedTextBlocks = (editor, rng, root) => {\n    var textBlocks = [];\n    var dom = editor.dom;\n    var startNode = getEndPointNode(editor, rng, true, root);\n    var endNode = getEndPointNode(editor, rng, false, root);\n    var block;\n    var siblings = [];\n    for (var node = startNode; node; node = node.nextSibling) {\n      siblings.push(node);\n      if (node === endNode) {\n        break;\n      }\n    }\n    global$2.each(siblings, node => {\n      var _a;\n      if (isTextBlock(editor, node)) {\n        textBlocks.push(node);\n        block = null;\n        return;\n      }\n      if (dom.isBlock(node) || isBr(node)) {\n        if (isBr(node)) {\n          dom.remove(node);\n        }\n        block = null;\n        return;\n      }\n      var nextSibling = node.nextSibling;\n      if (global$1.isBookmarkNode(node)) {\n        if (isListNode(nextSibling) || isTextBlock(editor, nextSibling) || !nextSibling && node.parentNode === root) {\n          block = null;\n          return;\n        }\n      }\n      if (!block) {\n        block = dom.create('p');\n        (_a = node.parentNode) === null || _a === void 0 ? void 0 : _a.insertBefore(block, node);\n        textBlocks.push(block);\n      }\n      block.appendChild(node);\n    });\n    return textBlocks;\n  };\n  var hasCompatibleStyle = (dom, sib, detail) => {\n    var sibStyle = dom.getStyle(sib, 'list-style-type');\n    var detailStyle = detail ? detail['list-style-type'] : '';\n    detailStyle = detailStyle === null ? '' : detailStyle;\n    return sibStyle === detailStyle;\n  };\n  var getRootSearchStart = (editor, range) => {\n    var start = editor.selection.getStart(true);\n    var startPoint = getEndPointNode(editor, range, true, editor.getBody());\n    if (ancestor(SugarElement.fromDom(startPoint), SugarElement.fromDom(range.commonAncestorContainer))) {\n      return range.commonAncestorContainer;\n    } else {\n      return start;\n    }\n  };\n  var applyList = (editor, listName, detail) => {\n    var rng = editor.selection.getRng();\n    var listItemName = 'LI';\n    var root = getClosestListHost(editor, getRootSearchStart(editor, rng));\n    var dom = editor.dom;\n    if (dom.getContentEditable(editor.selection.getNode()) === 'false') {\n      return;\n    }\n    listName = listName.toUpperCase();\n    if (listName === 'DL') {\n      listItemName = 'DT';\n    }\n    var bookmark = createBookmark(rng);\n    var selectedTextBlocks = filter$1(getSelectedTextBlocks(editor, rng, root), editor.dom.isEditable);\n    global$2.each(selectedTextBlocks, block => {\n      var listBlock;\n      var sibling = block.previousSibling;\n      var parent = block.parentNode;\n      if (!isListItemNode(parent)) {\n        if (sibling && isListNode(sibling) && sibling.nodeName === listName && hasCompatibleStyle(dom, sibling, detail)) {\n          listBlock = sibling;\n          block = dom.rename(block, listItemName);\n          sibling.appendChild(block);\n        } else {\n          listBlock = dom.create(listName);\n          parent.insertBefore(listBlock, block);\n          listBlock.appendChild(block);\n          block = dom.rename(block, listItemName);\n        }\n        removeStyles(dom, block, ['margin', 'margin-right', 'margin-bottom', 'margin-left', 'margin-top', 'padding', 'padding-right', 'padding-bottom', 'padding-left', 'padding-top']);\n        updateListWithDetails(dom, listBlock, detail);\n        mergeWithAdjacentLists(editor.dom, listBlock);\n      }\n    });\n    editor.selection.setRng(resolveBookmark(bookmark));\n  };\n  var isValidLists = (list1, list2) => {\n    return isListNode(list1) && list1.nodeName === (list2 === null || list2 === void 0 ? void 0 : list2.nodeName);\n  };\n  var hasSameListStyle = (dom, list1, list2) => {\n    var targetStyle = dom.getStyle(list1, 'list-style-type', true);\n    var style = dom.getStyle(list2, 'list-style-type', true);\n    return targetStyle === style;\n  };\n  var hasSameClasses = (elm1, elm2) => {\n    return elm1.className === elm2.className;\n  };\n  var shouldMerge = (dom, list1, list2) => {\n    return isValidLists(list1, list2) && hasSameListStyle(dom, list1, list2) && hasSameClasses(list1, list2);\n  };\n  var mergeWithAdjacentLists = (dom, listBlock) => {\n    var node;\n    var sibling = listBlock.nextSibling;\n    if (shouldMerge(dom, listBlock, sibling)) {\n      var liSibling = sibling;\n      while (node = liSibling.firstChild) {\n        listBlock.appendChild(node);\n      }\n      dom.remove(liSibling);\n    }\n    sibling = listBlock.previousSibling;\n    if (shouldMerge(dom, listBlock, sibling)) {\n      var _liSibling = sibling;\n      while (node = _liSibling.lastChild) {\n        listBlock.insertBefore(node, listBlock.firstChild);\n      }\n      dom.remove(_liSibling);\n    }\n  };\n  var updateList$1 = (editor, list, listName, detail) => {\n    if (list.nodeName !== listName) {\n      var newList = editor.dom.rename(list, listName);\n      updateListWithDetails(editor.dom, newList, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), newList);\n    } else {\n      updateListWithDetails(editor.dom, list, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), list);\n    }\n  };\n  var updateCustomList = (editor, list, listName, detail) => {\n    list.classList.forEach((cls, _, classList) => {\n      if (cls.startsWith('tox-')) {\n        classList.remove(cls);\n        if (classList.length === 0) {\n          list.removeAttribute('class');\n        }\n      }\n    });\n    if (list.nodeName !== listName) {\n      var newList = editor.dom.rename(list, listName);\n      updateListWithDetails(editor.dom, newList, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), newList);\n    } else {\n      updateListWithDetails(editor.dom, list, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), list);\n    }\n  };\n  var toggleMultipleLists = (editor, parentList, lists, listName, detail) => {\n    var parentIsList = isListNode(parentList);\n    if (parentIsList && parentList.nodeName === listName && !hasListStyleDetail(detail) && !isCustomList(parentList)) {\n      flattenListSelection(editor);\n    } else {\n      applyList(editor, listName, detail);\n      var bookmark = createBookmark(editor.selection.getRng());\n      var allLists = parentIsList ? [parentList, ...lists] : lists;\n      var updateFunction = parentIsList && isCustomList(parentList) ? updateCustomList : updateList$1;\n      global$2.each(allLists, elm => {\n        updateFunction(editor, elm, listName, detail);\n      });\n      editor.selection.setRng(resolveBookmark(bookmark));\n    }\n  };\n  var hasListStyleDetail = detail => {\n    return 'list-style-type' in detail;\n  };\n  var toggleSingleList = (editor, parentList, listName, detail) => {\n    if (parentList === editor.getBody()) {\n      return;\n    }\n    if (parentList) {\n      if (parentList.nodeName === listName && !hasListStyleDetail(detail) && !isCustomList(parentList)) {\n        flattenListSelection(editor);\n      } else {\n        var bookmark = createBookmark(editor.selection.getRng());\n        if (isCustomList(parentList)) {\n          parentList.classList.forEach((cls, _, classList) => {\n            if (cls.startsWith('tox-')) {\n              classList.remove(cls);\n              if (classList.length === 0) {\n                parentList.removeAttribute('class');\n              }\n            }\n          });\n        }\n        updateListWithDetails(editor.dom, parentList, detail);\n        var newList = editor.dom.rename(parentList, listName);\n        mergeWithAdjacentLists(editor.dom, newList);\n        editor.selection.setRng(resolveBookmark(bookmark));\n        applyList(editor, listName, detail);\n        fireListEvent(editor, listToggleActionFromListName(listName), newList);\n      }\n    } else {\n      applyList(editor, listName, detail);\n      fireListEvent(editor, listToggleActionFromListName(listName), parentList);\n    }\n  };\n  var toggleList = (editor, listName, _detail) => {\n    var parentList = getParentList(editor);\n    if (isWithinNonEditableList(editor, parentList)) {\n      return;\n    }\n    var selectedSubLists = getSelectedSubLists(editor);\n    var detail = isObject(_detail) ? _detail : {};\n    if (selectedSubLists.length > 0) {\n      toggleMultipleLists(editor, parentList, selectedSubLists, listName, detail);\n    } else {\n      toggleSingleList(editor, parentList, listName, detail);\n    }\n  };\n  var DOM = global$3.DOM;\n  var normalizeList = (dom, list) => {\n    var parentNode = list.parentElement;\n    if (parentNode && parentNode.nodeName === 'LI' && parentNode.firstChild === list) {\n      var sibling = parentNode.previousSibling;\n      if (sibling && sibling.nodeName === 'LI') {\n        sibling.appendChild(list);\n        if (isEmpty$2(dom, parentNode)) {\n          DOM.remove(parentNode);\n        }\n      } else {\n        DOM.setStyle(parentNode, 'listStyleType', 'none');\n      }\n    }\n    if (isListNode(parentNode)) {\n      var _sibling = parentNode.previousSibling;\n      if (_sibling && _sibling.nodeName === 'LI') {\n        _sibling.appendChild(list);\n      }\n    }\n  };\n  var normalizeLists = (dom, element) => {\n    var lists = global$2.grep(dom.select('ol,ul', element));\n    global$2.each(lists, list => {\n      normalizeList(dom, list);\n    });\n  };\n  var findNextCaretContainer = (editor, rng, isForward, root) => {\n    var node = rng.startContainer;\n    var offset = rng.startOffset;\n    if (isTextNode$1(node) && (isForward ? offset < node.data.length : offset > 0)) {\n      return node;\n    }\n    var nonEmptyBlocks = editor.schema.getNonEmptyElements();\n    if (isElement(node)) {\n      node = global$6.getNode(node, offset);\n    }\n    var walker = new global$5(node, root);\n    if (isForward) {\n      if (isBogusBr(editor.dom, node)) {\n        walker.next();\n      }\n    }\n    var walkFn = isForward ? walker.next.bind(walker) : walker.prev2.bind(walker);\n    while (node = walkFn()) {\n      if (node.nodeName === 'LI' && !node.hasChildNodes()) {\n        return node;\n      }\n      if (nonEmptyBlocks[node.nodeName]) {\n        return node;\n      }\n      if (isTextNode$1(node) && node.data.length > 0) {\n        return node;\n      }\n    }\n    return null;\n  };\n  var hasOnlyOneBlockChild = (dom, elm) => {\n    var childNodes = elm.childNodes;\n    return childNodes.length === 1 && !isListNode(childNodes[0]) && dom.isBlock(childNodes[0]);\n  };\n  var unwrapSingleBlockChild = (dom, elm) => {\n    if (hasOnlyOneBlockChild(dom, elm)) {\n      dom.remove(elm.firstChild, true);\n    }\n  };\n  var moveChildren = (dom, fromElm, toElm) => {\n    var node;\n    var targetElm = hasOnlyOneBlockChild(dom, toElm) ? toElm.firstChild : toElm;\n    unwrapSingleBlockChild(dom, fromElm);\n    if (!isEmpty$2(dom, fromElm, true)) {\n      while (node = fromElm.firstChild) {\n        targetElm.appendChild(node);\n      }\n    }\n  };\n  var mergeLiElements = (dom, fromElm, toElm) => {\n    var listNode;\n    var ul = fromElm.parentNode;\n    if (!isChildOfBody(dom, fromElm) || !isChildOfBody(dom, toElm)) {\n      return;\n    }\n    if (isListNode(toElm.lastChild)) {\n      listNode = toElm.lastChild;\n    }\n    if (ul === toElm.lastChild) {\n      if (isBr(ul.previousSibling)) {\n        dom.remove(ul.previousSibling);\n      }\n    }\n    var node = toElm.lastChild;\n    if (node && isBr(node) && fromElm.hasChildNodes()) {\n      dom.remove(node);\n    }\n    if (isEmpty$2(dom, toElm, true)) {\n      empty(SugarElement.fromDom(toElm));\n    }\n    moveChildren(dom, fromElm, toElm);\n    if (listNode) {\n      toElm.appendChild(listNode);\n    }\n    var contains$1 = contains(SugarElement.fromDom(toElm), SugarElement.fromDom(fromElm));\n    var nestedLists = contains$1 ? dom.getParents(fromElm, isListNode, toElm) : [];\n    dom.remove(fromElm);\n    each$1(nestedLists, list => {\n      if (isEmpty$2(dom, list) && list !== dom.getRoot()) {\n        dom.remove(list);\n      }\n    });\n  };\n  var mergeIntoEmptyLi = (editor, fromLi, toLi) => {\n    empty(SugarElement.fromDom(toLi));\n    mergeLiElements(editor.dom, fromLi, toLi);\n    editor.selection.setCursorLocation(toLi, 0);\n  };\n  var mergeForward = (editor, rng, fromLi, toLi) => {\n    var dom = editor.dom;\n    if (dom.isEmpty(toLi)) {\n      mergeIntoEmptyLi(editor, fromLi, toLi);\n    } else {\n      var bookmark = createBookmark(rng);\n      mergeLiElements(dom, fromLi, toLi);\n      editor.selection.setRng(resolveBookmark(bookmark));\n    }\n  };\n  var mergeBackward = (editor, rng, fromLi, toLi) => {\n    var bookmark = createBookmark(rng);\n    mergeLiElements(editor.dom, fromLi, toLi);\n    var resolvedBookmark = resolveBookmark(bookmark);\n    editor.selection.setRng(resolvedBookmark);\n  };\n  var backspaceDeleteFromListToListCaret = (editor, isForward) => {\n    var dom = editor.dom,\n      selection = editor.selection;\n    var selectionStartElm = selection.getStart();\n    var root = getClosestEditingHost(editor, selectionStartElm);\n    var li = dom.getParent(selection.getStart(), 'LI', root);\n    if (li) {\n      var ul = li.parentElement;\n      if (ul === editor.getBody() && isEmpty$2(dom, ul)) {\n        return true;\n      }\n      var rng = normalizeRange(selection.getRng());\n      var otherLi = dom.getParent(findNextCaretContainer(editor, rng, isForward, root), 'LI', root);\n      if (otherLi && otherLi !== li) {\n        editor.undoManager.transact(() => {\n          if (isForward) {\n            mergeForward(editor, rng, otherLi, li);\n          } else {\n            if (isFirstChild(li)) {\n              outdentListSelection(editor);\n            } else {\n              mergeBackward(editor, rng, li, otherLi);\n            }\n          }\n        });\n        return true;\n      } else if (!otherLi) {\n        if (!isForward && rng.startOffset === 0 && rng.endOffset === 0) {\n          editor.undoManager.transact(() => {\n            flattenListSelection(editor);\n          });\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n  var removeBlock = (dom, block, root) => {\n    var parentBlock = dom.getParent(block.parentNode, dom.isBlock, root);\n    dom.remove(block);\n    if (parentBlock && dom.isEmpty(parentBlock)) {\n      dom.remove(parentBlock);\n    }\n  };\n  var backspaceDeleteIntoListCaret = (editor, isForward) => {\n    var dom = editor.dom;\n    var selectionStartElm = editor.selection.getStart();\n    var root = getClosestEditingHost(editor, selectionStartElm);\n    var block = dom.getParent(selectionStartElm, dom.isBlock, root);\n    if (block && dom.isEmpty(block)) {\n      var rng = normalizeRange(editor.selection.getRng());\n      var otherLi = dom.getParent(findNextCaretContainer(editor, rng, isForward, root), 'LI', root);\n      if (otherLi) {\n        var findValidElement = element => contains$1(['td', 'th', 'caption'], name(element));\n        var findRoot = node => node.dom === root;\n        var otherLiCell = closest(SugarElement.fromDom(otherLi), findValidElement, findRoot);\n        var caretCell = closest(SugarElement.fromDom(rng.startContainer), findValidElement, findRoot);\n        if (!equals(otherLiCell, caretCell, eq)) {\n          return false;\n        }\n        editor.undoManager.transact(() => {\n          var parentNode = otherLi.parentNode;\n          removeBlock(dom, block, root);\n          mergeWithAdjacentLists(dom, parentNode);\n          editor.selection.select(otherLi, true);\n          editor.selection.collapse(isForward);\n        });\n        return true;\n      }\n    }\n    return false;\n  };\n  var backspaceDeleteCaret = (editor, isForward) => {\n    return backspaceDeleteFromListToListCaret(editor, isForward) || backspaceDeleteIntoListCaret(editor, isForward);\n  };\n  var hasListSelection = editor => {\n    var selectionStartElm = editor.selection.getStart();\n    var root = getClosestEditingHost(editor, selectionStartElm);\n    var startListParent = editor.dom.getParent(selectionStartElm, 'LI,DT,DD', root);\n    return startListParent || getSelectedListItems(editor).length > 0;\n  };\n  var backspaceDeleteRange = editor => {\n    if (hasListSelection(editor)) {\n      editor.undoManager.transact(() => {\n        editor.execCommand('Delete');\n        normalizeLists(editor.dom, editor.getBody());\n      });\n      return true;\n    }\n    return false;\n  };\n  var _backspaceDelete = (editor, isForward) => {\n    var selection = editor.selection;\n    return !isWithinNonEditableList(editor, selection.getNode()) && (selection.isCollapsed() ? backspaceDeleteCaret(editor, isForward) : backspaceDeleteRange(editor));\n  };\n  var setup$2 = editor => {\n    editor.on('ExecCommand', e => {\n      var cmd = e.command.toLowerCase();\n      if ((cmd === 'delete' || cmd === 'forwarddelete') && hasListSelection(editor)) {\n        normalizeLists(editor.dom, editor.getBody());\n      }\n    });\n    editor.on('keydown', e => {\n      if (e.keyCode === global$4.BACKSPACE) {\n        if (_backspaceDelete(editor, false)) {\n          e.preventDefault();\n        }\n      } else if (e.keyCode === global$4.DELETE) {\n        if (_backspaceDelete(editor, true)) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  var get = editor => ({\n    backspaceDelete: isForward => {\n      _backspaceDelete(editor, isForward);\n    }\n  });\n  var updateList = (editor, update) => {\n    var parentList = getParentList(editor);\n    if (parentList === null || isWithinNonEditableList(editor, parentList)) {\n      return;\n    }\n    editor.undoManager.transact(() => {\n      if (isObject(update.styles)) {\n        editor.dom.setStyles(parentList, update.styles);\n      }\n      if (isObject(update.attrs)) {\n        each(update.attrs, (v, k) => editor.dom.setAttrib(parentList, k, v));\n      }\n    });\n  };\n  var parseAlphabeticBase26 = str => {\n    var chars = reverse(trim(str).split(''));\n    var values = map(chars, (char, i) => {\n      var charValue = char.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0) + 1;\n      return Math.pow(26, i) * charValue;\n    });\n    return foldl(values, (sum, v) => sum + v, 0);\n  };\n  var composeAlphabeticBase26 = value => {\n    value--;\n    if (value < 0) {\n      return '';\n    } else {\n      var remainder = value % 26;\n      var quotient = Math.floor(value / 26);\n      var rest = composeAlphabeticBase26(quotient);\n      var char = String.fromCharCode('A'.charCodeAt(0) + remainder);\n      return rest + char;\n    }\n  };\n  var isUppercase = str => /^[A-Z]+$/.test(str);\n  var isLowercase = str => /^[a-z]+$/.test(str);\n  var isNumeric = str => /^[0-9]+$/.test(str);\n  var deduceListType = start => {\n    if (isNumeric(start)) {\n      return 2;\n    } else if (isUppercase(start)) {\n      return 0;\n    } else if (isLowercase(start)) {\n      return 1;\n    } else if (isEmpty$1(start)) {\n      return 3;\n    } else {\n      return 4;\n    }\n  };\n  var parseStartValue = start => {\n    switch (deduceListType(start)) {\n      case 2:\n        return Optional.some({\n          listStyleType: Optional.none(),\n          start\n        });\n      case 0:\n        return Optional.some({\n          listStyleType: Optional.some('upper-alpha'),\n          start: parseAlphabeticBase26(start).toString()\n        });\n      case 1:\n        return Optional.some({\n          listStyleType: Optional.some('lower-alpha'),\n          start: parseAlphabeticBase26(start).toString()\n        });\n      case 3:\n        return Optional.some({\n          listStyleType: Optional.none(),\n          start: ''\n        });\n      case 4:\n        return Optional.none();\n    }\n  };\n  var parseDetail = detail => {\n    var start = parseInt(detail.start, 10);\n    if (is$2(detail.listStyleType, 'upper-alpha')) {\n      return composeAlphabeticBase26(start);\n    } else if (is$2(detail.listStyleType, 'lower-alpha')) {\n      return composeAlphabeticBase26(start).toLowerCase();\n    } else {\n      return detail.start;\n    }\n  };\n  var open = editor => {\n    var currentList = getParentList(editor);\n    if (!isOlNode(currentList) || isWithinNonEditableList(editor, currentList)) {\n      return;\n    }\n    editor.windowManager.open({\n      title: 'List Properties',\n      body: {\n        type: 'panel',\n        items: [{\n          type: 'input',\n          name: 'start',\n          label: 'Start list at number',\n          inputMode: 'numeric'\n        }]\n      },\n      initialData: {\n        start: parseDetail({\n          start: editor.dom.getAttrib(currentList, 'start', '1'),\n          listStyleType: Optional.from(editor.dom.getStyle(currentList, 'list-style-type'))\n        })\n      },\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      onSubmit: api => {\n        var data = api.getData();\n        parseStartValue(data.start).each(detail => {\n          editor.execCommand('mceListUpdate', false, {\n            attrs: {\n              start: detail.start === '1' ? '' : detail.start\n            },\n            styles: {\n              'list-style-type': detail.listStyleType.getOr('')\n            }\n          });\n        });\n        api.close();\n      }\n    });\n  };\n  var queryListCommandState = (editor, listName) => () => {\n    var parentList = getParentList(editor);\n    return isNonNullable(parentList) && parentList.nodeName === listName;\n  };\n  var registerDialog = editor => {\n    editor.addCommand('mceListProps', () => {\n      open(editor);\n    });\n  };\n  var register$2 = editor => {\n    editor.on('BeforeExecCommand', e => {\n      var cmd = e.command.toLowerCase();\n      if (cmd === 'indent') {\n        indentListSelection(editor);\n      } else if (cmd === 'outdent') {\n        outdentListSelection(editor);\n      }\n    });\n    editor.addCommand('InsertUnorderedList', (ui, detail) => {\n      toggleList(editor, 'UL', detail);\n    });\n    editor.addCommand('InsertOrderedList', (ui, detail) => {\n      toggleList(editor, 'OL', detail);\n    });\n    editor.addCommand('InsertDefinitionList', (ui, detail) => {\n      toggleList(editor, 'DL', detail);\n    });\n    editor.addCommand('RemoveList', () => {\n      flattenListSelection(editor);\n    });\n    registerDialog(editor);\n    editor.addCommand('mceListUpdate', (ui, detail) => {\n      if (isObject(detail)) {\n        updateList(editor, detail);\n      }\n    });\n    editor.addQueryStateHandler('InsertUnorderedList', queryListCommandState(editor, 'UL'));\n    editor.addQueryStateHandler('InsertOrderedList', queryListCommandState(editor, 'OL'));\n    editor.addQueryStateHandler('InsertDefinitionList', queryListCommandState(editor, 'DL'));\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.html.Node');\n  var isTextNode = node => node.type === 3;\n  var isEmpty = nodeBuffer => nodeBuffer.length === 0;\n  var wrapInvalidChildren = list => {\n    var insertListItem = (buffer, refNode) => {\n      var li = global.create('li');\n      each$1(buffer, node => li.append(node));\n      if (refNode) {\n        list.insert(li, refNode, true);\n      } else {\n        list.append(li);\n      }\n    };\n    var reducer = (buffer, node) => {\n      if (isTextNode(node)) {\n        return [...buffer, node];\n      } else if (!isEmpty(buffer) && !isTextNode(node)) {\n        insertListItem(buffer, node);\n        return [];\n      } else {\n        return buffer;\n      }\n    };\n    var restBuffer = foldl(list.children(), reducer, []);\n    if (!isEmpty(restBuffer)) {\n      insertListItem(restBuffer);\n    }\n  };\n  var setup$1 = editor => {\n    editor.on('PreInit', () => {\n      var {\n        parser\n      } = editor;\n      parser.addNodeFilter('ul,ol', nodes => each$1(nodes, wrapInvalidChildren));\n    });\n  };\n  var setupTabKey = editor => {\n    editor.on('keydown', e => {\n      if (e.keyCode !== global$4.TAB || global$4.metaKeyPressed(e)) {\n        return;\n      }\n      editor.undoManager.transact(() => {\n        if (e.shiftKey ? outdentListSelection(editor) : indentListSelection(editor)) {\n          e.preventDefault();\n        }\n      });\n    });\n  };\n  var setup = editor => {\n    if (shouldIndentOnTab(editor)) {\n      setupTabKey(editor);\n    }\n    setup$2(editor);\n  };\n  var setupToggleButtonHandler = (editor, listName) => api => {\n    var toggleButtonHandler = e => {\n      api.setActive(inList(e.parents, listName));\n      api.setEnabled(!isWithinNonEditableList(editor, e.element) && editor.selection.isEditable());\n    };\n    api.setEnabled(editor.selection.isEditable());\n    return setNodeChangeHandler(editor, toggleButtonHandler);\n  };\n  var register$1 = editor => {\n    var exec = command => () => editor.execCommand(command);\n    if (!editor.hasPlugin('advlist')) {\n      editor.ui.registry.addToggleButton('numlist', {\n        icon: 'ordered-list',\n        active: false,\n        tooltip: 'Numbered list',\n        onAction: exec('InsertOrderedList'),\n        onSetup: setupToggleButtonHandler(editor, 'OL')\n      });\n      editor.ui.registry.addToggleButton('bullist', {\n        icon: 'unordered-list',\n        active: false,\n        tooltip: 'Bullet list',\n        onAction: exec('InsertUnorderedList'),\n        onSetup: setupToggleButtonHandler(editor, 'UL')\n      });\n    }\n  };\n  var setupMenuButtonHandler = (editor, listName) => api => {\n    var menuButtonHandler = e => api.setEnabled(inList(e.parents, listName) && !isWithinNonEditableList(editor, e.element));\n    return setNodeChangeHandler(editor, menuButtonHandler);\n  };\n  var register = editor => {\n    var listProperties = {\n      text: 'List properties...',\n      icon: 'ordered-list',\n      onAction: () => editor.execCommand('mceListProps'),\n      onSetup: setupMenuButtonHandler(editor, 'OL')\n    };\n    editor.ui.registry.addMenuItem('listprops', listProperties);\n    editor.ui.registry.addContextMenu('lists', {\n      update: node => {\n        var parentList = getParentList(editor, node);\n        return isOlNode(parentList) ? ['listprops'] : [];\n      }\n    });\n  };\n  var Plugin = () => {\n    global$7.add('lists', editor => {\n      register$3(editor);\n      setup$1(editor);\n      if (!editor.hasPlugin('rtc', true)) {\n        setup(editor);\n        register$2(editor);\n      } else {\n        registerDialog(editor);\n      }\n      register$1(editor);\n      register(editor);\n      return get(editor);\n    });\n  };\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/lists/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/quickbars/index.js":
/*!*********************************************************!*\
  !*** ./node_modules/tinymce/plugins/quickbars/index.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"quickbars\" plugin for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/plugins/quickbars')\n//   ES2015:\n//     import 'tinymce/plugins/quickbars'\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/quickbars/plugin.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/quickbars/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/quickbars/plugin.js":
/*!**********************************************************!*\
  !*** ./node_modules/tinymce/plugins/quickbars/plugin.js ***!
  \**********************************************************/
/***/ (() => {

eval("/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */\n\n(function () {\n  'use strict';\n\n  var global$1 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var hasProto = (v, constructor, predicate) => {\n    var _a;\n    if (predicate(v, constructor.prototype)) {\n      return true;\n    } else {\n      return ((_a = v.constructor) === null || _a === void 0 ? void 0 : _a.name) === constructor.name;\n    }\n  };\n  var typeOf = x => {\n    var t = typeof x;\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && Array.isArray(x)) {\n      return 'array';\n    } else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n  var isType = type => value => typeOf(value) === type;\n  var isSimpleType = type => value => typeof value === type;\n  var isString = isType('string');\n  var isBoolean = isSimpleType('boolean');\n  var isNullable = a => a === null || a === undefined;\n  var isNonNullable = a => !isNullable(a);\n  var isFunction = isSimpleType('function');\n  var option = name => editor => editor.options.get(name);\n  var register = editor => {\n    var registerOption = editor.options.register;\n    var toolbarProcessor = defaultValue => value => {\n      var valid = isBoolean(value) || isString(value);\n      if (valid) {\n        if (isBoolean(value)) {\n          return {\n            value: value ? defaultValue : '',\n            valid\n          };\n        } else {\n          return {\n            value: value.trim(),\n            valid\n          };\n        }\n      } else {\n        return {\n          valid: false,\n          message: 'Must be a boolean or string.'\n        };\n      }\n    };\n    var defaultSelectionToolbar = 'bold italic | quicklink h2 h3 blockquote';\n    registerOption('quickbars_selection_toolbar', {\n      processor: toolbarProcessor(defaultSelectionToolbar),\n      default: defaultSelectionToolbar\n    });\n    var defaultInsertToolbar = 'quickimage quicktable';\n    registerOption('quickbars_insert_toolbar', {\n      processor: toolbarProcessor(defaultInsertToolbar),\n      default: defaultInsertToolbar\n    });\n    var defaultImageToolbar = 'alignleft aligncenter alignright';\n    registerOption('quickbars_image_toolbar', {\n      processor: toolbarProcessor(defaultImageToolbar),\n      default: defaultImageToolbar\n    });\n  };\n  var getTextSelectionToolbarItems = option('quickbars_selection_toolbar');\n  var getInsertToolbarItems = option('quickbars_insert_toolbar');\n  var getImageToolbarItems = option('quickbars_image_toolbar');\n  var unique = 0;\n  var generate = prefix => {\n    var date = new Date();\n    var time = date.getTime();\n    var random = Math.floor(Math.random() * 1000000000);\n    unique++;\n    return prefix + '_' + random + unique + String(time);\n  };\n  var insertTable = (editor, columns, rows) => {\n    editor.execCommand('mceInsertTable', false, {\n      rows,\n      columns\n    });\n  };\n  var insertBlob = (editor, base64, blob) => {\n    var blobCache = editor.editorUpload.blobCache;\n    var blobInfo = blobCache.create(generate('mceu'), blob, base64);\n    blobCache.add(blobInfo);\n    editor.insertContent(editor.dom.createHTML('img', {\n      src: blobInfo.blobUri()\n    }));\n  };\n  var blobToBase64 = blob => {\n    return new Promise(resolve => {\n      var reader = new FileReader();\n      reader.onloadend = () => {\n        resolve(reader.result.split(',')[1]);\n      };\n      reader.readAsDataURL(blob);\n    });\n  };\n  var global = tinymce.util.Tools.resolve('tinymce.util.Delay');\n  var pickFile = editor => new Promise(resolve => {\n    var resolved = false;\n    var fileInput = document.createElement('input');\n    fileInput.type = 'file';\n    fileInput.accept = 'image/*';\n    fileInput.style.position = 'fixed';\n    fileInput.style.left = '0';\n    fileInput.style.top = '0';\n    fileInput.style.opacity = '0.001';\n    document.body.appendChild(fileInput);\n    var resolveFileInput = value => {\n      var _a;\n      if (!resolved) {\n        (_a = fileInput.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(fileInput);\n        resolved = true;\n        resolve(value);\n      }\n    };\n    var changeHandler = e => {\n      resolveFileInput(Array.prototype.slice.call(e.target.files));\n    };\n    fileInput.addEventListener('input', changeHandler);\n    fileInput.addEventListener('change', changeHandler);\n    var cancelHandler = e => {\n      var cleanup = () => {\n        resolveFileInput([]);\n      };\n      if (!resolved) {\n        if (e.type === 'focusin') {\n          global.setEditorTimeout(editor, cleanup, 1000);\n        } else {\n          cleanup();\n        }\n      }\n      editor.off('focusin remove', cancelHandler);\n    };\n    editor.on('focusin remove', cancelHandler);\n    fileInput.click();\n  });\n  var setupButtons = editor => {\n    editor.ui.registry.addButton('quickimage', {\n      icon: 'image',\n      tooltip: 'Insert image',\n      onAction: () => {\n        pickFile(editor).then(files => {\n          if (files.length > 0) {\n            var blob = files[0];\n            blobToBase64(blob).then(base64 => {\n              insertBlob(editor, base64, blob);\n            });\n          }\n        });\n      }\n    });\n    editor.ui.registry.addButton('quicktable', {\n      icon: 'table',\n      tooltip: 'Insert table',\n      onAction: () => {\n        insertTable(editor, 2, 2);\n      }\n    });\n  };\n  var constant = value => {\n    return () => {\n      return value;\n    };\n  };\n  var never = constant(false);\n  class Optional {\n    constructor(tag, value) {\n      this.tag = tag;\n      this.value = value;\n    }\n    static some(value) {\n      return new Optional(true, value);\n    }\n    static none() {\n      return Optional.singletonNone;\n    }\n    fold(onNone, onSome) {\n      if (this.tag) {\n        return onSome(this.value);\n      } else {\n        return onNone();\n      }\n    }\n    isSome() {\n      return this.tag;\n    }\n    isNone() {\n      return !this.tag;\n    }\n    map(mapper) {\n      if (this.tag) {\n        return Optional.some(mapper(this.value));\n      } else {\n        return Optional.none();\n      }\n    }\n    bind(binder) {\n      if (this.tag) {\n        return binder(this.value);\n      } else {\n        return Optional.none();\n      }\n    }\n    exists(predicate) {\n      return this.tag && predicate(this.value);\n    }\n    forall(predicate) {\n      return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n      if (!this.tag || predicate(this.value)) {\n        return this;\n      } else {\n        return Optional.none();\n      }\n    }\n    getOr(replacement) {\n      return this.tag ? this.value : replacement;\n    }\n    or(replacement) {\n      return this.tag ? this : replacement;\n    }\n    getOrThunk(thunk) {\n      return this.tag ? this.value : thunk();\n    }\n    orThunk(thunk) {\n      return this.tag ? this : thunk();\n    }\n    getOrDie(message) {\n      if (!this.tag) {\n        throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n      } else {\n        return this.value;\n      }\n    }\n    static from(value) {\n      return isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    getOrNull() {\n      return this.tag ? this.value : null;\n    }\n    getOrUndefined() {\n      return this.value;\n    }\n    each(worker) {\n      if (this.tag) {\n        worker(this.value);\n      }\n    }\n    toArray() {\n      return this.tag ? [this.value] : [];\n    }\n    toString() {\n      return this.tag ? \"some(\".concat(this.value, \")\") : 'none()';\n    }\n  }\n  Optional.singletonNone = new Optional(false);\n  typeof window !== 'undefined' ? window : Function('return this;')();\n  var ELEMENT = 1;\n  var name = element => {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n  var has$1 = (element, key) => {\n    var dom = element.dom;\n    return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\n  };\n  var ClosestOrAncestor = (is, ancestor, scope, a, isRoot) => {\n    if (is(scope, a)) {\n      return Optional.some(scope);\n    } else if (isFunction(isRoot) && isRoot(scope)) {\n      return Optional.none();\n    } else {\n      return ancestor(scope, a, isRoot);\n    }\n  };\n  var fromHtml = (html, scope) => {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      var message = 'HTML does not have a single root node';\n      console.error(message, html);\n      throw new Error(message);\n    }\n    return fromDom(div.childNodes[0]);\n  };\n  var fromTag = (tag, scope) => {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n  var fromText = (text, scope) => {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n  var fromDom = node => {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n    return {\n      dom: node\n    };\n  };\n  var fromPoint = (docElm, x, y) => Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  var SugarElement = {\n    fromHtml,\n    fromTag,\n    fromText,\n    fromDom,\n    fromPoint\n  };\n  var is = (element, selector) => {\n    var dom = element.dom;\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n  var ancestor$1 = (scope, predicate, isRoot) => {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n    return Optional.none();\n  };\n  var closest$2 = (scope, predicate, isRoot) => {\n    var is = (s, test) => test(s);\n    return ClosestOrAncestor(is, ancestor$1, scope, predicate, isRoot);\n  };\n  var closest$1 = (scope, predicate, isRoot) => closest$2(scope, predicate, isRoot).isSome();\n  var ancestor = (scope, selector, isRoot) => ancestor$1(scope, e => is(e, selector), isRoot);\n  var closest = (scope, selector, isRoot) => {\n    var is$1 = (element, selector) => is(element, selector);\n    return ClosestOrAncestor(is$1, ancestor, scope, selector, isRoot);\n  };\n  var addToEditor$1 = editor => {\n    var insertToolbarItems = getInsertToolbarItems(editor);\n    if (insertToolbarItems.length > 0) {\n      editor.ui.registry.addContextToolbar('quickblock', {\n        predicate: node => {\n          var sugarNode = SugarElement.fromDom(node);\n          var textBlockElementsMap = editor.schema.getTextBlockElements();\n          var isRoot = elem => elem.dom === editor.getBody();\n          return !has$1(sugarNode, 'data-mce-bogus') && closest(sugarNode, 'table,[data-mce-bogus=\"all\"]', isRoot).fold(() => closest$1(sugarNode, elem => name(elem) in textBlockElementsMap && editor.dom.isEmpty(elem.dom), isRoot), never);\n        },\n        items: insertToolbarItems,\n        position: 'line',\n        scope: 'editor'\n      });\n    }\n  };\n  var supports = element => element.dom.classList !== undefined;\n  var has = (element, clazz) => supports(element) && element.dom.classList.contains(clazz);\n  var addToEditor = editor => {\n    var isEditable = node => editor.dom.isEditable(node);\n    var isInEditableContext = el => isEditable(el.parentElement);\n    var isImage = node => {\n      var isImageFigure = node.nodeName === 'FIGURE' && /image/i.test(node.className);\n      var isImage = node.nodeName === 'IMG' || isImageFigure;\n      var isPagebreak = has(SugarElement.fromDom(node), 'mce-pagebreak');\n      return isImage && isInEditableContext(node) && !isPagebreak;\n    };\n    var imageToolbarItems = getImageToolbarItems(editor);\n    if (imageToolbarItems.length > 0) {\n      editor.ui.registry.addContextToolbar('imageselection', {\n        predicate: isImage,\n        items: imageToolbarItems,\n        position: 'node'\n      });\n    }\n    var textToolbarItems = getTextSelectionToolbarItems(editor);\n    if (textToolbarItems.length > 0) {\n      editor.ui.registry.addContextToolbar('textselection', {\n        predicate: node => !isImage(node) && !editor.selection.isCollapsed() && isEditable(node),\n        items: textToolbarItems,\n        position: 'selection',\n        scope: 'editor'\n      });\n    }\n  };\n  var Plugin = () => {\n    global$1.add('quickbars', editor => {\n      register(editor);\n      setupButtons(editor);\n      addToEditor$1(editor);\n      addToEditor(editor);\n    });\n  };\n  Plugin();\n})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/plugins/quickbars/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("// Exports the \"silver\" theme for usage with module loaders\n// Usage:\n//   CommonJS:\n//     require('tinymce/themes/silver')\n//   ES2015:\n//     import 'tinymce/themes/silver'\n__webpack_require__(/*! ./theme.js */ \"./node_modules/tinymce/themes/silver/theme.js\");\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/themes/silver/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/theme.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/theme.js ***!
  \*****************************************************/
/***/ (() => {

eval("var _excluded=[\"class\",\"style\"],_excluded2=[\"events\"],_excluded3=[\"attributes\"],_excluded4=[\"primary\"],_excluded5=[\"primary\"];function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,\"next\",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,\"throw\",err);}_next(undefined);});};}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */(function(){'use strict';var getPrototypeOf$2=Object.getPrototypeOf;var hasProto=(v,constructor,predicate)=>{var _a;if(predicate(v,constructor.prototype)){return true;}else{return((_a=v.constructor)===null||_a===void 0?void 0:_a.name)===constructor.name;}};var typeOf=x=>{var t=typeof x;if(x===null){return'null';}else if(t==='object'&&Array.isArray(x)){return'array';}else if(t==='object'&&hasProto(x,String,(o,proto)=>proto.isPrototypeOf(o))){return'string';}else{return t;}};var isType$1=type=>value=>typeOf(value)===type;var isSimpleType=type=>value=>typeof value===type;var eq$1=t=>a=>t===a;var is$2=(value,constructor)=>isObject(value)&&hasProto(value,constructor,(o,proto)=>getPrototypeOf$2(o)===proto);var isString=isType$1('string');var isObject=isType$1('object');var isPlainObject=value=>is$2(value,Object);var isArray=isType$1('array');var isNull=eq$1(null);var isBoolean=isSimpleType('boolean');var isUndefined=eq$1(undefined);var isNullable=a=>a===null||a===undefined;var isNonNullable=a=>!isNullable(a);var isFunction=isSimpleType('function');var isNumber=isSimpleType('number');var isArrayOf=(value,pred)=>{if(isArray(value)){for(var i=0,len=value.length;i<len;++i){if(!pred(value[i])){return false;}}return true;}return false;};var noop=()=>{};var noarg=f=>()=>f();var compose=(fa,fb)=>{return function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}return fa(fb.apply(null,args));};};var compose1=(fbc,fab)=>a=>fbc(fab(a));var constant$1=value=>{return()=>{return value;};};var identity=x=>{return x;};var tripleEquals=(a,b)=>{return a===b;};function curry(fn){for(var _len4=arguments.length,initialArgs=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){initialArgs[_key4-1]=arguments[_key4];}return function(){for(var _len5=arguments.length,restArgs=new Array(_len5),_key5=0;_key5<_len5;_key5++){restArgs[_key5]=arguments[_key5];}var all=initialArgs.concat(restArgs);return fn.apply(null,all);};}var not=f=>t=>!f(t);var die=msg=>{return()=>{throw new Error(msg);};};var apply$1=f=>{return f();};var never=constant$1(false);var always=constant$1(true);class Optional{constructor(tag,value){this.tag=tag;this.value=value;}static some(value){return new Optional(true,value);}static none(){return Optional.singletonNone;}fold(onNone,onSome){if(this.tag){return onSome(this.value);}else{return onNone();}}isSome(){return this.tag;}isNone(){return!this.tag;}map(mapper){if(this.tag){return Optional.some(mapper(this.value));}else{return Optional.none();}}bind(binder){if(this.tag){return binder(this.value);}else{return Optional.none();}}exists(predicate){return this.tag&&predicate(this.value);}forall(predicate){return!this.tag||predicate(this.value);}filter(predicate){if(!this.tag||predicate(this.value)){return this;}else{return Optional.none();}}getOr(replacement){return this.tag?this.value:replacement;}or(replacement){return this.tag?this:replacement;}getOrThunk(thunk){return this.tag?this.value:thunk();}orThunk(thunk){return this.tag?this:thunk();}getOrDie(message){if(!this.tag){throw new Error(message!==null&&message!==void 0?message:'Called getOrDie on None');}else{return this.value;}}static from(value){return isNonNullable(value)?Optional.some(value):Optional.none();}getOrNull(){return this.tag?this.value:null;}getOrUndefined(){return this.value;}each(worker){if(this.tag){worker(this.value);}}toArray(){return this.tag?[this.value]:[];}toString(){return this.tag?\"some(\".concat(this.value,\")\"):'none()';}}Optional.singletonNone=new Optional(false);var nativeSlice=Array.prototype.slice;var nativeIndexOf=Array.prototype.indexOf;var nativePush=Array.prototype.push;var rawIndexOf=(ts,t)=>nativeIndexOf.call(ts,t);var indexOf=(xs,x)=>{var r=rawIndexOf(xs,x);return r===-1?Optional.none():Optional.some(r);};var contains$2=(xs,x)=>rawIndexOf(xs,x)>-1;var exists=(xs,pred)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return true;}}return false;};var range$2=(num,f)=>{var r=[];for(var i=0;i<num;i++){r.push(f(i));}return r;};var chunk$1=(array,size)=>{var r=[];for(var i=0;i<array.length;i+=size){var s=nativeSlice.call(array,i,i+size);r.push(s);}return r;};var map$2=(xs,f)=>{var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i);}return r;};var each$1=(xs,f)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i);}};var eachr=(xs,f)=>{for(var i=xs.length-1;i>=0;i--){var x=xs[i];f(x,i);}};var partition$3=(xs,pred)=>{var pass=[];var fail=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var arr=pred(x,i)?pass:fail;arr.push(x);}return{pass,fail};};var filter$2=(xs,pred)=>{var r=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){r.push(x);}}return r;};var foldr=(xs,f,acc)=>{eachr(xs,(x,i)=>{acc=f(acc,x,i);});return acc;};var foldl=(xs,f,acc)=>{each$1(xs,(x,i)=>{acc=f(acc,x,i);});return acc;};var findUntil=(xs,pred,until)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(x);}else if(until(x,i)){break;}}return Optional.none();};var find$5=(xs,pred)=>{return findUntil(xs,pred,never);};var findIndex$1=(xs,pred)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(i);}}return Optional.none();};var flatten=xs=>{var r=[];for(var i=0,len=xs.length;i<len;++i){if(!isArray(xs[i])){throw new Error('Arr.flatten item '+i+' was not an array, input: '+xs);}nativePush.apply(r,xs[i]);}return r;};var bind$3=(xs,f)=>flatten(map$2(xs,f));var forall=(xs,pred)=>{for(var i=0,len=xs.length;i<len;++i){var x=xs[i];if(pred(x,i)!==true){return false;}}return true;};var reverse=xs=>{var r=nativeSlice.call(xs,0);r.reverse();return r;};var difference=(a1,a2)=>filter$2(a1,x=>!contains$2(a2,x));var mapToObject=(xs,f)=>{var r={};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i);}return r;};var pure$2=x=>[x];var sort=(xs,comparator)=>{var copy=nativeSlice.call(xs,0);copy.sort(comparator);return copy;};var get$h=(xs,i)=>i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none();var head=xs=>get$h(xs,0);var last$1=xs=>get$h(xs,xs.length-1);var from=isFunction(Array.from)?Array.from:x=>nativeSlice.call(x);var findMap=(arr,f)=>{for(var i=0;i<arr.length;i++){var _r=f(arr[i],i);if(_r.isSome()){return _r;}}return Optional.none();};var keys=Object.keys;var hasOwnProperty$1=Object.hasOwnProperty;var each=(obj,f)=>{var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i);}};var map$1=(obj,f)=>{return tupleMap(obj,(x,i)=>({k:i,v:f(x,i)}));};var tupleMap=(obj,f)=>{var r={};each(obj,(x,i)=>{var tuple=f(x,i);r[tuple.k]=tuple.v;});return r;};var objAcc=r=>(x,i)=>{r[i]=x;};var internalFilter=(obj,pred,onTrue,onFalse)=>{each(obj,(x,i)=>{(pred(x,i)?onTrue:onFalse)(x,i);});};var bifilter=(obj,pred)=>{var t={};var f={};internalFilter(obj,pred,objAcc(t),objAcc(f));return{t,f};};var filter$1=(obj,pred)=>{var t={};internalFilter(obj,pred,objAcc(t),noop);return t;};var mapToArray=(obj,f)=>{var r=[];each(obj,(value,name)=>{r.push(f(value,name));});return r;};var find$4=(obj,pred)=>{var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];if(pred(x,i,obj)){return Optional.some(x);}}return Optional.none();};var values=obj=>{return mapToArray(obj,identity);};var get$g=(obj,key)=>{return has$2(obj,key)?Optional.from(obj[key]):Optional.none();};var has$2=(obj,key)=>hasOwnProperty$1.call(obj,key);var hasNonNullableKey=(obj,key)=>has$2(obj,key)&&obj[key]!==undefined&&obj[key]!==null;var is$1=function is$1(lhs,rhs){var comparator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:tripleEquals;return lhs.exists(left=>comparator(left,rhs));};var equals=function equals(lhs,rhs){var comparator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:tripleEquals;return lift2(lhs,rhs,comparator).getOr(lhs.isNone()&&rhs.isNone());};var cat=arr=>{var r=[];var push=x=>{r.push(x);};for(var i=0;i<arr.length;i++){arr[i].each(push);}return r;};var sequence=arr=>{var r=[];for(var i=0;i<arr.length;i++){var x=arr[i];if(x.isSome()){r.push(x.getOrDie());}else{return Optional.none();}}return Optional.some(r);};var lift2=(oa,ob,f)=>oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none();var lift3=(oa,ob,oc,f)=>oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none();var mapFrom=(a,f)=>a!==undefined&&a!==null?Optional.some(f(a)):Optional.none();var someIf=(b,a)=>b?Optional.some(a):Optional.none();var addToEnd=(str,suffix)=>{return str+suffix;};var removeFromStart=(str,numChars)=>{return str.substring(numChars);};var checkRange=(str,substr,start)=>substr===''||str.length>=substr.length&&str.substr(start,start+substr.length)===substr;var removeLeading=(str,prefix)=>{return startsWith(str,prefix)?removeFromStart(str,prefix.length):str;};var ensureTrailing=(str,suffix)=>{return endsWith(str,suffix)?str:addToEnd(str,suffix);};var contains$1=function contains$1(str,substr){var start=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var end=arguments.length>3?arguments[3]:undefined;var idx=str.indexOf(substr,start);if(idx!==-1){return isUndefined(end)?true:idx+substr.length<=end;}else{return false;}};var startsWith=(str,prefix)=>{return checkRange(str,prefix,0);};var endsWith=(str,suffix)=>{return checkRange(str,suffix,str.length-suffix.length);};var blank=r=>s=>s.replace(r,'');var trim$1=blank(/^\\s+|\\s+$/g);var isNotEmpty=s=>s.length>0;var isEmpty=s=>!isNotEmpty(s);var isSupported$1=dom=>dom.style!==undefined&&isFunction(dom.style.getPropertyValue);var fromHtml$2=(html,scope)=>{var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;if(!div.hasChildNodes()||div.childNodes.length>1){var message='HTML does not have a single root node';console.error(message,html);throw new Error(message);}return fromDom(div.childNodes[0]);};var fromTag=(tag,scope)=>{var doc=scope||document;var node=doc.createElement(tag);return fromDom(node);};var fromText=(text,scope)=>{var doc=scope||document;var node=doc.createTextNode(text);return fromDom(node);};var fromDom=node=>{if(node===null||node===undefined){throw new Error('Node cannot be null or undefined');}return{dom:node};};var fromPoint=(docElm,x,y)=>Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom);var SugarElement={fromHtml:fromHtml$2,fromTag,fromText,fromDom,fromPoint};var Global=typeof window!=='undefined'?window:Function('return this;')();var path$1=(parts,scope)=>{var o=scope!==undefined&&scope!==null?scope:Global;for(var i=0;i<parts.length&&o!==undefined&&o!==null;++i){o=o[parts[i]];}return o;};var resolve=(p,scope)=>{var parts=p.split('.');return path$1(parts,scope);};var unsafe=(name,scope)=>{return resolve(name,scope);};var getOrDie$1=(name,scope)=>{var actual=unsafe(name,scope);if(actual===undefined||actual===null){throw new Error(name+' not available on this browser');}return actual;};var getPrototypeOf$1=Object.getPrototypeOf;var sandHTMLElement=scope=>{return getOrDie$1('HTMLElement',scope);};var isPrototypeOf=x=>{var scope=resolve('ownerDocument.defaultView',x);return isObject(x)&&(sandHTMLElement(scope).prototype.isPrototypeOf(x)||/^HTML\\w*Element$/.test(getPrototypeOf$1(x).constructor.name));};var DOCUMENT=9;var DOCUMENT_FRAGMENT=11;var ELEMENT=1;var TEXT=3;var name$3=element=>{var r=element.dom.nodeName;return r.toLowerCase();};var type$1=element=>element.dom.nodeType;var isType=t=>element=>type$1(element)===t;var isHTMLElement=element=>isElement$1(element)&&isPrototypeOf(element.dom);var isElement$1=isType(ELEMENT);var isText=isType(TEXT);var isDocument=isType(DOCUMENT);var isDocumentFragment=isType(DOCUMENT_FRAGMENT);var isTag=tag=>e=>isElement$1(e)&&name$3(e)===tag;var is=(element,selector)=>{var dom=element.dom;if(dom.nodeType!==ELEMENT){return false;}else{var elem=dom;if(elem.matches!==undefined){return elem.matches(selector);}else if(elem.msMatchesSelector!==undefined){return elem.msMatchesSelector(selector);}else if(elem.webkitMatchesSelector!==undefined){return elem.webkitMatchesSelector(selector);}else if(elem.mozMatchesSelector!==undefined){return elem.mozMatchesSelector(selector);}else{throw new Error('Browser lacks native selectors');}}};var bypassSelector=dom=>dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT&&dom.nodeType!==DOCUMENT_FRAGMENT||dom.childElementCount===0;var all$3=(selector,scope)=>{var base=scope===undefined?document:scope.dom;return bypassSelector(base)?[]:map$2(base.querySelectorAll(selector),SugarElement.fromDom);};var one=(selector,scope)=>{var base=scope===undefined?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);};var eq=(e1,e2)=>e1.dom===e2.dom;var contains=(e1,e2)=>{var d1=e1.dom;var d2=e2.dom;return d1===d2?false:d1.contains(d2);};var owner$4=element=>SugarElement.fromDom(element.dom.ownerDocument);var documentOrOwner=dos=>isDocument(dos)?dos:owner$4(dos);var documentElement=element=>SugarElement.fromDom(documentOrOwner(element).dom.documentElement);var defaultView=element=>SugarElement.fromDom(documentOrOwner(element).dom.defaultView);var parent=element=>Optional.from(element.dom.parentNode).map(SugarElement.fromDom);var parentNode=element=>parent(element);var parentElement=element=>Optional.from(element.dom.parentElement).map(SugarElement.fromDom);var parents=(element,isRoot)=>{var stop=isFunction(isRoot)?isRoot:never;var dom=element.dom;var ret=[];while(dom.parentNode!==null&&dom.parentNode!==undefined){var rawParent=dom.parentNode;var p=SugarElement.fromDom(rawParent);ret.push(p);if(stop(p)===true){break;}else{dom=rawParent;}}return ret;};var offsetParent=element=>Optional.from(element.dom.offsetParent).map(SugarElement.fromDom);var nextSibling=element=>Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);var children=element=>map$2(element.dom.childNodes,SugarElement.fromDom);var child$2=(element,index)=>{var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom);};var firstChild=element=>child$2(element,0);var spot=(element,offset)=>({element,offset});var leaf=(element,offset)=>{var cs=children(element);return cs.length>0&&offset<cs.length?spot(cs[offset],0):spot(element,offset);};var isShadowRoot=dos=>isDocumentFragment(dos)&&isNonNullable(dos.dom.host);var supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode);var isSupported=constant$1(supported);var getRootNode=supported?e=>SugarElement.fromDom(e.dom.getRootNode()):documentOrOwner;var getContentContainer=dos=>isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body);var isInShadowRoot=e=>getShadowRoot(e).isSome();var getShadowRoot=e=>{var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none();};var getShadowHost=e=>SugarElement.fromDom(e.dom.host);var getOriginalEventTarget=event=>{if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$1(el)&&isOpenShadowHost(el)){if(event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath){return head(composedPath);}}}}return Optional.from(event.target);};var isOpenShadowHost=element=>isNonNullable(element.dom.shadowRoot);var inBody=element=>{var dom=isText(element)?element.dom.parentNode:element.dom;if(dom===undefined||dom===null||dom.ownerDocument===null){return false;}var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(()=>doc.body.contains(dom),compose1(inBody,getShadowHost));};var body=()=>getBody(SugarElement.fromDom(document));var getBody=doc=>{var b=doc.dom.body;if(b===null||b===undefined){throw new Error('Body is not available yet');}return SugarElement.fromDom(b);};var rawSet=(dom,key,value)=>{if(isString(value)||isBoolean(value)||isNumber(value)){dom.setAttribute(key,value+'');}else{console.error('Invalid call to Attribute.set. Key ',key,':: Value ',value,':: Element ',dom);throw new Error('Attribute value was not simple');}};var set$9=(element,key,value)=>{rawSet(element.dom,key,value);};var setAll$1=(element,attrs)=>{var dom=element.dom;each(attrs,(v,k)=>{rawSet(dom,k,v);});};var get$f=(element,key)=>{var v=element.dom.getAttribute(key);return v===null?undefined:v;};var getOpt=(element,key)=>Optional.from(get$f(element,key));var has$1=(element,key)=>{var dom=element.dom;return dom&&dom.hasAttribute?dom.hasAttribute(key):false;};var remove$7=(element,key)=>{element.dom.removeAttribute(key);};var clone$2=element=>foldl(element.dom.attributes,(acc,attr)=>{acc[attr.name]=attr.value;return acc;},{});var internalSet=(dom,property,value)=>{if(!isString(value)){console.error('Invalid call to CSS.set. Property ',property,':: Value ',value,':: Element ',dom);throw new Error('CSS value must be a string: '+value);}if(isSupported$1(dom)){dom.style.setProperty(property,value);}};var internalRemove=(dom,property)=>{if(isSupported$1(dom)){dom.style.removeProperty(property);}};var set$8=(element,property,value)=>{var dom=element.dom;internalSet(dom,property,value);};var setAll=(element,css)=>{var dom=element.dom;each(css,(v,k)=>{internalSet(dom,k,v);});};var setOptions=(element,css)=>{var dom=element.dom;each(css,(v,k)=>{v.fold(()=>{internalRemove(dom,k);},value=>{internalSet(dom,k,value);});});};var get$e=(element,property)=>{var dom=element.dom;var styles=window.getComputedStyle(dom);var r=styles.getPropertyValue(property);return r===''&&!inBody(element)?getUnsafeProperty(dom,property):r;};var getUnsafeProperty=(dom,property)=>isSupported$1(dom)?dom.style.getPropertyValue(property):'';var getRaw=(element,property)=>{var dom=element.dom;var raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter(r=>r.length>0);};var getAllRaw=element=>{var css={};var dom=element.dom;if(isSupported$1(dom)){for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName];}}return css;};var isValidValue$1=(tag,property,value)=>{var element=SugarElement.fromTag(tag);set$8(element,property,value);var style=getRaw(element,property);return style.isSome();};var remove$6=(element,property)=>{var dom=element.dom;internalRemove(dom,property);if(is$1(getOpt(element,'style').map(trim$1),'')){remove$7(element,'style');}};var reflow=e=>e.dom.offsetWidth;var Dimension=(name,getOffset)=>{var set=(element,h)=>{if(!isNumber(h)&&!h.match(/^[0-9]+$/)){throw new Error(name+'.set accepts only positive integer values. Value was '+h);}var dom=element.dom;if(isSupported$1(dom)){dom.style[name]=h+'px';}};var get=element=>{var r=getOffset(element);if(r<=0||r===null){var css=get$e(element,name);return parseFloat(css)||0;}return r;};var getOuter=get;var aggregate=(element,properties)=>foldl(properties,(acc,property)=>{var val=get$e(element,property);var value=val===undefined?0:parseInt(val,10);return isNaN(value)?acc:acc+value;},0);var max=(element,value,properties)=>{var cumulativeInclusions=aggregate(element,properties);var absoluteMax=value>cumulativeInclusions?value-cumulativeInclusions:0;return absoluteMax;};return{set,get,getOuter,aggregate,max};};var api$2=Dimension('height',element=>{var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight;});var get$d=element=>api$2.get(element);var getOuter$2=element=>api$2.getOuter(element);var setMax$1=(element,value)=>{var inclusions=['margin-top','border-top-width','padding-top','padding-bottom','border-bottom-width','margin-bottom'];var absMax=api$2.max(element,value,inclusions);set$8(element,'max-height',absMax+'px');};var r$1=(left,top)=>{var translate=(x,y)=>r$1(left+x,top+y);return{left,top,translate};};var SugarPosition=r$1;var boxPosition=dom=>{var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top);};var firstDefinedOrZero=(a,b)=>{if(a!==undefined){return a;}else{return b!==undefined?b:0;}};var absolute$3=element=>{var doc=element.dom.ownerDocument;var body=doc.body;var win=doc.defaultView;var html=doc.documentElement;if(body===element.dom){return SugarPosition(body.offsetLeft,body.offsetTop);}var scrollTop=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageYOffset,html.scrollTop);var scrollLeft=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageXOffset,html.scrollLeft);var clientTop=firstDefinedOrZero(html.clientTop,body.clientTop);var clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport$1(element).translate(scrollLeft-clientLeft,scrollTop-clientTop);};var viewport$1=element=>{var dom=element.dom;var doc=dom.ownerDocument;var body=doc.body;if(body===dom){return SugarPosition(body.offsetLeft,body.offsetTop);}if(!inBody(element)){return SugarPosition(0,0);}return boxPosition(dom);};var api$1=Dimension('width',element=>element.dom.offsetWidth);var set$7=(element,h)=>api$1.set(element,h);var get$c=element=>api$1.get(element);var getOuter$1=element=>api$1.getOuter(element);var setMax=(element,value)=>{var inclusions=['margin-left','border-left-width','padding-left','padding-right','border-right-width','margin-right'];var absMax=api$1.max(element,value,inclusions);set$8(element,'max-width',absMax+'px');};var cached=f=>{var called=false;var r;return function(){if(!called){called=true;for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}r=f.apply(null,args);}return r;};};var DeviceType=(os,browser,userAgent,mediaMatch)=>{var isiPad=os.isiOS()&&/ipad/i.test(userAgent)===true;var isiPhone=os.isiOS()&&!isiPad;var isMobile=os.isiOS()||os.isAndroid();var isTouch=isMobile||mediaMatch('(pointer:coarse)');var isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch('(min-device-width:768px)');var isPhone=isiPhone||isMobile&&!isTablet;var iOSwebview=browser.isSafari()&&os.isiOS()&&/safari/i.test(userAgent)===false;var isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant$1(isiPad),isiPhone:constant$1(isiPhone),isTablet:constant$1(isTablet),isPhone:constant$1(isPhone),isTouch:constant$1(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant$1(iOSwebview),isDesktop:constant$1(isDesktop)};};var firstMatch=(regexes,s)=>{for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s)){return x;}}return undefined;};var find$3=(regexes,agent)=>{var r=firstMatch(regexes,agent);if(!r){return{major:0,minor:0};}var group=i=>{return Number(agent.replace(r,'$'+i));};return nu$d(group(1),group(2));};var detect$5=(versionRegexes,agent)=>{var cleanedAgent=String(agent).toLowerCase();if(versionRegexes.length===0){return unknown$3();}return find$3(versionRegexes,cleanedAgent);};var unknown$3=()=>{return nu$d(0,0);};var nu$d=(major,minor)=>{return{major,minor};};var Version={nu:nu$d,detect:detect$5,unknown:unknown$3};var detectBrowser$1=(browsers,userAgentData)=>{return findMap(userAgentData.brands,uaBrand=>{var lcBrand=uaBrand.brand.toLowerCase();return find$5(browsers,browser=>{var _a;return lcBrand===((_a=browser.brand)===null||_a===void 0?void 0:_a.toLowerCase());}).map(info=>({current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}));});};var detect$4=(candidates,userAgent)=>{var agent=String(userAgent).toLowerCase();return find$5(candidates,candidate=>{return candidate.search(agent);});};var detectBrowser=(browsers,userAgent)=>{return detect$4(browsers,userAgent).map(browser=>{var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version};});};var detectOs=(oses,userAgent)=>{return detect$4(oses,userAgent).map(os=>{var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version};});};var normalVersionRegex=/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;var checkContains=target=>{return uastring=>{return contains$1(uastring,target);};};var browsers=[{name:'Edge',versionRegexes:[/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],search:uastring=>{return contains$1(uastring,'edge/')&&contains$1(uastring,'chrome')&&contains$1(uastring,'safari')&&contains$1(uastring,'applewebkit');}},{name:'Chromium',brand:'Chromium',versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/,normalVersionRegex],search:uastring=>{return contains$1(uastring,'chrome')&&!contains$1(uastring,'chromeframe');}},{name:'IE',versionRegexes:[/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,/.*?rv:([0-9]+)\\.([0-9]+).*/],search:uastring=>{return contains$1(uastring,'msie')||contains$1(uastring,'trident');}},{name:'Opera',versionRegexes:[normalVersionRegex,/.*?opera\\/([0-9]+)\\.([0-9]+).*/],search:checkContains('opera')},{name:'Firefox',versionRegexes:[/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],search:checkContains('firefox')},{name:'Safari',versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:uastring=>{return(contains$1(uastring,'safari')||contains$1(uastring,'mobile/'))&&contains$1(uastring,'applewebkit');}}];var oses=[{name:'Windows',search:checkContains('win'),versionRegexes:[/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'iOS',search:uastring=>{return contains$1(uastring,'iphone')||contains$1(uastring,'ipad');},versionRegexes:[/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:'Android',search:checkContains('android'),versionRegexes:[/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'macOS',search:checkContains('mac os x'),versionRegexes:[/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]},{name:'Linux',search:checkContains('linux'),versionRegexes:[]},{name:'Solaris',search:checkContains('sunos'),versionRegexes:[]},{name:'FreeBSD',search:checkContains('freebsd'),versionRegexes:[]},{name:'ChromeOS',search:checkContains('cros'),versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]}];var PlatformInfo={browsers:constant$1(browsers),oses:constant$1(oses)};var edge='Edge';var chromium='Chromium';var ie='IE';var opera='Opera';var firefox='Firefox';var safari='Safari';var unknown$2=()=>{return nu$c({current:undefined,version:Version.unknown()});};var nu$c=info=>{var current=info.current;var version=info.version;var isBrowser=name=>()=>current===name;return{current,version,isEdge:isBrowser(edge),isChromium:isBrowser(chromium),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)};};var Browser={unknown:unknown$2,nu:nu$c,edge:constant$1(edge),chromium:constant$1(chromium),ie:constant$1(ie),opera:constant$1(opera),firefox:constant$1(firefox),safari:constant$1(safari)};var windows='Windows';var ios='iOS';var android='Android';var linux='Linux';var macos='macOS';var solaris='Solaris';var freebsd='FreeBSD';var chromeos='ChromeOS';var unknown$1=()=>{return nu$b({current:undefined,version:Version.unknown()});};var nu$b=info=>{var current=info.current;var version=info.version;var isOS=name=>()=>current===name;return{current,version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isMacOS:isOS(macos),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)};};var OperatingSystem={unknown:unknown$1,nu:nu$b,windows:constant$1(windows),ios:constant$1(ios),android:constant$1(android),linux:constant$1(linux),macos:constant$1(macos),solaris:constant$1(solaris),freebsd:constant$1(freebsd),chromeos:constant$1(chromeos)};var detect$3=(userAgent,userAgentDataOpt,mediaMatch)=>{var browsers=PlatformInfo.browsers();var oses=PlatformInfo.oses();var browser=userAgentDataOpt.bind(userAgentData=>detectBrowser$1(browsers,userAgentData)).orThunk(()=>detectBrowser(browsers,userAgent)).fold(Browser.unknown,Browser.nu);var os=detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);var deviceType=DeviceType(os,browser,userAgent,mediaMatch);return{browser,os,deviceType};};var PlatformDetection={detect:detect$3};var mediaMatch=query=>window.matchMedia(query).matches;var platform=cached(()=>PlatformDetection.detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch));var detect$2=()=>platform();var mkEvent=(target,x,y,stop,prevent,kill,raw)=>({target,x,y,stop,prevent,kill,raw});var fromRawEvent$1=rawEvent=>{var target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));var stop=()=>rawEvent.stopPropagation();var prevent=()=>rawEvent.preventDefault();var kill=compose(prevent,stop);return mkEvent(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent);};var handle=(filter,handler)=>rawEvent=>{if(filter(rawEvent)){handler(fromRawEvent$1(rawEvent));}};var binder=(element,event,filter,handler,useCapture)=>{var wrapped=handle(filter,handler);element.dom.addEventListener(event,wrapped,useCapture);return{unbind:curry(unbind,element,event,wrapped,useCapture)};};var bind$2=(element,event,filter,handler)=>binder(element,event,filter,handler,false);var capture$1=(element,event,filter,handler)=>binder(element,event,filter,handler,true);var unbind=(element,event,handler,useCapture)=>{element.dom.removeEventListener(event,handler,useCapture);};var before$1=(marker,element)=>{var parent$1=parent(marker);parent$1.each(v=>{v.dom.insertBefore(element.dom,marker.dom);});};var after$2=(marker,element)=>{var sibling=nextSibling(marker);sibling.fold(()=>{var parent$1=parent(marker);parent$1.each(v=>{append$2(v,element);});},v=>{before$1(v,element);});};var prepend$1=(parent,element)=>{var firstChild$1=firstChild(parent);firstChild$1.fold(()=>{append$2(parent,element);},v=>{parent.dom.insertBefore(element.dom,v.dom);});};var append$2=(parent,element)=>{parent.dom.appendChild(element.dom);};var appendAt=(parent,element,index)=>{child$2(parent,index).fold(()=>{append$2(parent,element);},v=>{before$1(v,element);});};var append$1=(parent,elements)=>{each$1(elements,x=>{append$2(parent,x);});};var empty=element=>{element.dom.textContent='';each$1(children(element),rogue=>{remove$5(rogue);});};var remove$5=element=>{var dom=element.dom;if(dom.parentNode!==null){dom.parentNode.removeChild(dom);}};var get$b=_DOC=>{var doc=_DOC!==undefined?_DOC.dom:document;var x=doc.body.scrollLeft||doc.documentElement.scrollLeft;var y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y);};var to=(x,y,_DOC)=>{var doc=_DOC!==undefined?_DOC.dom:document;var win=doc.defaultView;if(win){win.scrollTo(x,y);}};var get$a=_win=>{var win=_win===undefined?window:_win;if(detect$2().browser.isFirefox()){return Optional.none();}else{return Optional.from(win.visualViewport);}};var bounds$1=(x,y,width,height)=>({x,y,width,height,right:x+width,bottom:y+height});var getBounds$3=_win=>{var win=_win===undefined?window:_win;var doc=win.document;var scroll=get$b(SugarElement.fromDom(doc));return get$a(win).fold(()=>{var html=win.document.documentElement;var width=html.clientWidth;var height=html.clientHeight;return bounds$1(scroll.left,scroll.top,width,height);},visualViewport=>bounds$1(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height));};var getDocument=()=>SugarElement.fromDom(document);var walkUp=(navigation,doc)=>{var frame=navigation.view(doc);return frame.fold(constant$1([]),f=>{var parent=navigation.owner(f);var rest=walkUp(navigation,parent);return[f].concat(rest);});};var pathTo=(element,navigation)=>{var d=navigation.owner(element);var paths=walkUp(navigation,d);return Optional.some(paths);};var view=doc=>{var _a;var element=doc.dom===document?Optional.none():Optional.from((_a=doc.dom.defaultView)===null||_a===void 0?void 0:_a.frameElement);return element.map(SugarElement.fromDom);};var owner$3=element=>owner$4(element);var Navigation=/*#__PURE__*/Object.freeze({__proto__:null,view:view,owner:owner$3});var find$2=element=>{var doc=getDocument();var scroll=get$b(doc);var path=pathTo(element,Navigation);return path.fold(curry(absolute$3,element),frames=>{var offset=viewport$1(element);var r=foldr(frames,(b,a)=>{var loc=viewport$1(a);return{left:b.left+loc.left,top:b.top+loc.top};},{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top);});};var pointed=(point,width,height)=>({point,width,height});var rect=(x,y,width,height)=>({x,y,width,height});var bounds=(x,y,width,height)=>({x,y,width,height,right:x+width,bottom:y+height});var box$1=element=>{var xy=absolute$3(element);var w=getOuter$1(element);var h=getOuter$2(element);return bounds(xy.left,xy.top,w,h);};var absolute$2=element=>{var position=find$2(element);var width=getOuter$1(element);var height=getOuter$2(element);return bounds(position.left,position.top,width,height);};var constrain=(original,constraint)=>{var left=Math.max(original.x,constraint.x);var top=Math.max(original.y,constraint.y);var right=Math.min(original.right,constraint.right);var bottom=Math.min(original.bottom,constraint.bottom);var width=right-left;var height=bottom-top;return bounds(left,top,width,height);};var constrainByMany=(original,constraints)=>{return foldl(constraints,(acc,c)=>constrain(acc,c),original);};var win=()=>getBounds$3(window);var global$a=tinymce.util.Tools.resolve('tinymce.ThemeManager');var value$4=value=>{var applyHelper=fn=>fn(value);var constHelper=constant$1(value);var outputHelper=()=>output;var output={tag:true,inner:value,fold:(_onError,onValue)=>onValue(value),isValue:always,isError:never,map:mapper=>Result.value(mapper(value)),mapError:outputHelper,bind:applyHelper,exists:applyHelper,forall:applyHelper,getOr:constHelper,or:outputHelper,getOrThunk:constHelper,orThunk:outputHelper,getOrDie:constHelper,each:fn=>{fn(value);},toOptional:()=>Optional.some(value)};return output;};var error$1=error=>{var outputHelper=()=>output;var output={tag:false,inner:error,fold:(onError,_onValue)=>onError(error),isValue:never,isError:always,map:outputHelper,mapError:mapper=>Result.error(mapper(error)),bind:outputHelper,exists:never,forall:always,getOr:identity,or:identity,getOrThunk:apply$1,orThunk:apply$1,getOrDie:die(String(error)),each:noop,toOptional:Optional.none};return output;};var fromOption=(optional,err)=>optional.fold(()=>error$1(err),value$4);var Result={value:value$4,error:error$1,fromOption};var SimpleResultType;(function(SimpleResultType){SimpleResultType[SimpleResultType['Error']=0]='Error';SimpleResultType[SimpleResultType['Value']=1]='Value';})(SimpleResultType||(SimpleResultType={}));var fold$1=(res,onError,onValue)=>res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue);var partition$2=results=>{var values=[];var errors=[];each$1(results,obj=>{fold$1(obj,err=>errors.push(err),val=>values.push(val));});return{values,errors};};var mapError=(res,f)=>{if(res.stype===SimpleResultType.Error){return{stype:SimpleResultType.Error,serror:f(res.serror)};}else{return res;}};var map=(res,f)=>{if(res.stype===SimpleResultType.Value){return{stype:SimpleResultType.Value,svalue:f(res.svalue)};}else{return res;}};var bind$1=(res,f)=>{if(res.stype===SimpleResultType.Value){return f(res.svalue);}else{return res;}};var bindError=(res,f)=>{if(res.stype===SimpleResultType.Error){return f(res.serror);}else{return res;}};var svalue=v=>({stype:SimpleResultType.Value,svalue:v});var serror=e=>({stype:SimpleResultType.Error,serror:e});var toResult$1=res=>fold$1(res,Result.error,Result.value);var fromResult$1=res=>res.fold(serror,svalue);var SimpleResult={fromResult:fromResult$1,toResult:toResult$1,svalue,partition:partition$2,serror,bind:bind$1,bindError,map,mapError,fold:fold$1};var field$2=(key,newKey,presence,prop)=>({tag:'field',key,newKey,presence,prop});var customField$1=(newKey,instantiator)=>({tag:'custom',newKey,instantiator});var fold=(value,ifField,ifCustom)=>{switch(value.tag){case'field':return ifField(value.key,value.newKey,value.presence,value.prop);case'custom':return ifCustom(value.newKey,value.instantiator);}};var shallow$1=(old,nu)=>{return nu;};var deep=(old,nu)=>{var bothObjects=isPlainObject(old)&&isPlainObject(nu);return bothObjects?deepMerge(old,nu):nu;};var baseMerge=merger=>{return function(){if(arguments.length===0){throw new Error(\"Can't merge zero objects\");}var ret={};for(var j=0;j<arguments.length;j++){var curObject=j<0||arguments.length<=j?undefined:arguments[j];for(var key in curObject){if(has$2(curObject,key)){ret[key]=merger(ret[key],curObject[key]);}}}return ret;};};var deepMerge=baseMerge(deep);var merge$1=baseMerge(shallow$1);var required$2=()=>({tag:'required',process:{}});var defaultedThunk=fallbackThunk=>({tag:'defaultedThunk',process:fallbackThunk});var defaulted$1=fallback=>defaultedThunk(constant$1(fallback));var asOption=()=>({tag:'option',process:{}});var mergeWithThunk=baseThunk=>({tag:'mergeWithThunk',process:baseThunk});var mergeWith=base=>mergeWithThunk(constant$1(base));var mergeValues$1=(values,base)=>values.length>0?SimpleResult.svalue(deepMerge(base,merge$1.apply(undefined,values))):SimpleResult.svalue(base);var mergeErrors$1=errors=>compose(SimpleResult.serror,flatten)(errors);var consolidateObj=(objects,base)=>{var partition=SimpleResult.partition(objects);return partition.errors.length>0?mergeErrors$1(partition.errors):mergeValues$1(partition.values,base);};var consolidateArr=objects=>{var partitions=SimpleResult.partition(objects);return partitions.errors.length>0?mergeErrors$1(partitions.errors):SimpleResult.svalue(partitions.values);};var ResultCombine={consolidateObj,consolidateArr};var formatObj=input=>{return isObject(input)&&keys(input).length>100?' removed due to size':JSON.stringify(input,null,2);};var formatErrors=errors=>{var es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant$1('... (only showing first ten failures)')}]):errors;return map$2(es,e=>{return'Failed path: ('+e.path.join(' > ')+')\\n'+e.getErrorInfo();});};var nu$a=(path,getErrorInfo)=>{return SimpleResult.serror([{path,getErrorInfo}]);};var missingRequired=(path,key,obj)=>nu$a(path,()=>'Could not find valid *required* value for \"'+key+'\" in '+formatObj(obj));var missingKey=(path,key)=>nu$a(path,()=>'Choice schema did not contain choice key: \"'+key+'\"');var missingBranch=(path,branches,branch)=>nu$a(path,()=>'The chosen schema: \"'+branch+'\" did not exist in branches: '+formatObj(branches));var unsupportedFields=(path,unsupported)=>nu$a(path,()=>'There are unsupported fields: ['+unsupported.join(', ')+'] specified');var custom=(path,err)=>nu$a(path,constant$1(err));var value$3=validator=>{var extract=(path,val)=>{return SimpleResult.bindError(validator(val),err=>custom(path,err));};var toString=constant$1('val');return{extract,toString};};var anyValue$1=value$3(SimpleResult.svalue);var requiredAccess=(path,obj,key,bundle)=>get$g(obj,key).fold(()=>missingRequired(path,key,obj),bundle);var fallbackAccess=(obj,key,fallback,bundle)=>{var v=get$g(obj,key).getOrThunk(()=>fallback(obj));return bundle(v);};var optionAccess=(obj,key,bundle)=>bundle(get$g(obj,key));var optionDefaultedAccess=(obj,key,fallback,bundle)=>{var opt=get$g(obj,key).map(val=>val===true?fallback(obj):val);return bundle(opt);};var extractField=(field,path,obj,key,prop)=>{var bundle=av=>prop.extract(path.concat([key]),av);var bundleAsOption=optValue=>optValue.fold(()=>SimpleResult.svalue(Optional.none()),ov=>{var result=prop.extract(path.concat([key]),ov);return SimpleResult.map(result,Optional.some);});switch(field.tag){case'required':return requiredAccess(path,obj,key,bundle);case'defaultedThunk':return fallbackAccess(obj,key,field.process,bundle);case'option':return optionAccess(obj,key,bundleAsOption);case'defaultedOptionThunk':return optionDefaultedAccess(obj,key,field.process,bundleAsOption);case'mergeWithThunk':{return fallbackAccess(obj,key,constant$1({}),v=>{var result=deepMerge(field.process(obj),v);return bundle(result);});}}};var extractFields=(path,obj,fields)=>{var success={};var errors=[];for(var _field2 of fields){fold(_field2,(key,newKey,presence,prop)=>{var result=extractField(presence,path,obj,key,prop);SimpleResult.fold(result,err=>{errors.push(...err);},res=>{success[newKey]=res;});},(newKey,instantiator)=>{success[newKey]=instantiator(obj);});}return errors.length>0?SimpleResult.serror(errors):SimpleResult.svalue(success);};var valueThunk=getDelegate=>{var extract=(path,val)=>getDelegate().extract(path,val);var toString=()=>getDelegate().toString();return{extract,toString};};var getSetKeys=obj=>keys(filter$1(obj,isNonNullable));var objOfOnly=fields=>{var delegate=objOf(fields);var fieldNames=foldr(fields,(acc,value)=>{return fold(value,key=>deepMerge(acc,{[key]:true}),constant$1(acc));},{});var extract=(path,o)=>{var keys=isBoolean(o)?[]:getSetKeys(o);var extra=filter$2(keys,k=>!hasNonNullableKey(fieldNames,k));return extra.length===0?delegate.extract(path,o):unsupportedFields(path,extra);};return{extract,toString:delegate.toString};};var objOf=values=>{var extract=(path,o)=>extractFields(path,o,values);var toString=()=>{var fieldStrings=map$2(values,value=>fold(value,(key,_okey,_presence,prop)=>key+' -> '+prop.toString(),(newKey,_instantiator)=>'state('+newKey+')'));return'obj{\\n'+fieldStrings.join('\\n')+'}';};return{extract,toString};};var arrOf=prop=>{var extract=(path,array)=>{var results=map$2(array,(a,i)=>prop.extract(path.concat(['['+i+']']),a));return ResultCombine.consolidateArr(results);};var toString=()=>'array('+prop.toString()+')';return{extract,toString};};var oneOf=(props,rawF)=>{var f=rawF!==undefined?rawF:identity;var extract=(path,val)=>{var errors=[];for(var prop of props){var res=prop.extract(path,val);if(res.stype===SimpleResultType.Value){return{stype:SimpleResultType.Value,svalue:f(res.svalue)};}errors.push(res);}return ResultCombine.consolidateArr(errors);};var toString=()=>'oneOf('+map$2(props,prop=>prop.toString()).join(', ')+')';return{extract,toString};};var setOf$1=(validator,prop)=>{var validateKeys=(path,keys)=>arrOf(value$3(validator)).extract(path,keys);var extract=(path,o)=>{var keys$1=keys(o);var validatedKeys=validateKeys(path,keys$1);return SimpleResult.bind(validatedKeys,validKeys=>{var schema=map$2(validKeys,vk=>{return field$2(vk,vk,required$2(),prop);});return objOf(schema).extract(path,o);});};var toString=()=>'setOf('+prop.toString()+')';return{extract,toString};};var thunk=(_desc,processor)=>{var getP=cached(processor);var extract=(path,val)=>getP().extract(path,val);var toString=()=>getP().toString();return{extract,toString};};var arrOfObj=compose(arrOf,objOf);var anyValue=constant$1(anyValue$1);var typedValue=(validator,expectedType)=>value$3(a=>{var actualType=typeof a;return validator(a)?SimpleResult.svalue(a):SimpleResult.serror(\"Expected type: \".concat(expectedType,\" but got: \").concat(actualType));});var number=typedValue(isNumber,'number');var string=typedValue(isString,'string');var boolean=typedValue(isBoolean,'boolean');var functionProcessor=typedValue(isFunction,'function');var isPostMessageable=val=>{if(Object(val)!==val){return true;}switch({}.toString.call(val).slice(8,-1)){case'Boolean':case'Number':case'String':case'Date':case'RegExp':case'Blob':case'FileList':case'ImageData':case'ImageBitmap':case'ArrayBuffer':return true;case'Array':case'Object':return Object.keys(val).every(prop=>isPostMessageable(val[prop]));default:return false;}};var postMessageable=value$3(a=>{if(isPostMessageable(a)){return SimpleResult.svalue(a);}else{return SimpleResult.serror('Expected value to be acceptable for sending via postMessage');}});var chooseFrom=(path,input,branches,ch)=>{var fields=get$g(branches,ch);return fields.fold(()=>missingBranch(path,branches,ch),vp=>vp.extract(path.concat(['branch: '+ch]),input));};var choose$2=(key,branches)=>{var extract=(path,input)=>{var choice=get$g(input,key);return choice.fold(()=>missingKey(path,key),chosen=>chooseFrom(path,input,branches,chosen));};var toString=()=>'chooseOn('+key+'). Possible values: '+keys(branches);return{extract,toString};};var arrOfVal=()=>arrOf(anyValue$1);var valueOf=validator=>value$3(v=>validator(v).fold(SimpleResult.serror,SimpleResult.svalue));var setOf=(validator,prop)=>setOf$1(v=>SimpleResult.fromResult(validator(v)),prop);var extractValue=(label,prop,obj)=>{var res=prop.extract([label],obj);return SimpleResult.mapError(res,errs=>({input:obj,errors:errs}));};var asRaw=(label,prop,obj)=>SimpleResult.toResult(extractValue(label,prop,obj));var getOrDie=extraction=>{return extraction.fold(errInfo=>{throw new Error(formatError(errInfo));},identity);};var asRawOrDie$1=(label,prop,obj)=>getOrDie(asRaw(label,prop,obj));var formatError=errInfo=>{return'Errors: \\n'+formatErrors(errInfo.errors).join('\\n')+'\\n\\nInput object: '+formatObj(errInfo.input);};var choose$1=(key,branches)=>choose$2(key,map$1(branches,objOf));var thunkOf=(desc,schema)=>thunk(desc,schema);var field$1=field$2;var customField=customField$1;var validateEnum=values=>valueOf(value=>contains$2(values,value)?Result.value(value):Result.error(\"Unsupported value: \\\"\".concat(value,\"\\\", choose one of \\\"\").concat(values.join(', '),\"\\\".\")));var required$1=key=>field$1(key,key,required$2(),anyValue());var requiredOf=(key,schema)=>field$1(key,key,required$2(),schema);var requiredNumber=key=>requiredOf(key,number);var requiredString=key=>requiredOf(key,string);var requiredStringEnum=(key,values)=>field$1(key,key,required$2(),validateEnum(values));var requiredBoolean=key=>requiredOf(key,boolean);var requiredFunction=key=>requiredOf(key,functionProcessor);var forbid=(key,message)=>field$1(key,key,asOption(),value$3(_v=>SimpleResult.serror('The field: '+key+' is forbidden. '+message)));var requiredObjOf=(key,objSchema)=>field$1(key,key,required$2(),objOf(objSchema));var requiredArrayOfObj=(key,objFields)=>field$1(key,key,required$2(),arrOfObj(objFields));var requiredArrayOf=(key,schema)=>field$1(key,key,required$2(),arrOf(schema));var option$3=key=>field$1(key,key,asOption(),anyValue());var optionOf=(key,schema)=>field$1(key,key,asOption(),schema);var optionNumber=key=>optionOf(key,number);var optionString=key=>optionOf(key,string);var optionStringEnum=(key,values)=>optionOf(key,validateEnum(values));var optionFunction=key=>optionOf(key,functionProcessor);var optionArrayOf=(key,schema)=>optionOf(key,arrOf(schema));var optionObjOf=(key,objSchema)=>optionOf(key,objOf(objSchema));var optionObjOfOnly=(key,objSchema)=>optionOf(key,objOfOnly(objSchema));var defaulted=(key,fallback)=>field$1(key,key,defaulted$1(fallback),anyValue());var defaultedOf=(key,fallback,schema)=>field$1(key,key,defaulted$1(fallback),schema);var defaultedNumber=(key,fallback)=>defaultedOf(key,fallback,number);var defaultedString=(key,fallback)=>defaultedOf(key,fallback,string);var defaultedStringEnum=(key,fallback,values)=>defaultedOf(key,fallback,validateEnum(values));var defaultedBoolean=(key,fallback)=>defaultedOf(key,fallback,boolean);var defaultedFunction=(key,fallback)=>defaultedOf(key,fallback,functionProcessor);var defaultedPostMsg=(key,fallback)=>defaultedOf(key,fallback,postMessageable);var defaultedArrayOf=(key,fallback,schema)=>defaultedOf(key,fallback,arrOf(schema));var defaultedObjOf=(key,fallback,objSchema)=>defaultedOf(key,fallback,objOf(objSchema));var Cell=initial=>{var value=initial;var get=()=>{return value;};var set=v=>{value=v;};return{get,set};};var generate$7=cases=>{if(!isArray(cases)){throw new Error('cases must be an array');}if(cases.length===0){throw new Error('there must be at least one case');}var constructors=[];var adt={};each$1(cases,(acase,count)=>{var keys$1=keys(acase);if(keys$1.length!==1){throw new Error('one and only one name per case');}var key=keys$1[0];var value=acase[key];if(adt[key]!==undefined){throw new Error('duplicate key detected:'+key);}else if(key==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!isArray(value)){throw new Error('case arguments must be an array');}constructors.push(key);adt[key]=function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7];}var argLength=args.length;if(argLength!==value.length){throw new Error('Wrong number of arguments to case '+key+'. Expected '+value.length+' ('+value+'), got '+argLength);}var match=branches=>{var branchKeys=keys(branches);if(constructors.length!==branchKeys.length){throw new Error('Wrong number of arguments to match. Expected: '+constructors.join(',')+'\\nActual: '+branchKeys.join(','));}var allReqd=forall(constructors,reqKey=>{return contains$2(branchKeys,reqKey);});if(!allReqd){throw new Error('Not all branches were specified when using match. Specified: '+branchKeys.join(', ')+'\\nRequired: '+constructors.join(', '));}return branches[key].apply(null,args);};return{fold:function fold(){for(var _len8=arguments.length,foldArgs=new Array(_len8),_key8=0;_key8<_len8;_key8++){foldArgs[_key8]=arguments[_key8];}if(foldArgs.length!==cases.length){throw new Error('Wrong number of arguments to fold. Expected '+cases.length+', got '+foldArgs.length);}var target=foldArgs[count];return target.apply(null,args);},match,log:label=>{console.log(label,{constructors,constructor:key,params:args});}};};});return adt;};var Adt={generate:generate$7};Adt.generate([{bothErrors:['error1','error2']},{firstError:['error1','value2']},{secondError:['value1','error2']},{bothValues:['value1','value2']}]);var partition$1=results=>{var errors=[];var values=[];each$1(results,result=>{result.fold(err=>{errors.push(err);},value=>{values.push(value);});});return{errors,values};};var exclude$1=(obj,fields)=>{var r={};each(obj,(v,k)=>{if(!contains$2(fields,k)){r[k]=v;}});return r;};var wrap$2=(key,value)=>({[key]:value});var wrapAll$1=keyvalues=>{var r={};each$1(keyvalues,kv=>{r[kv.key]=kv.value;});return r;};var exclude=(obj,fields)=>exclude$1(obj,fields);var wrap$1=(key,value)=>wrap$2(key,value);var wrapAll=keyvalues=>wrapAll$1(keyvalues);var mergeValues=(values,base)=>{return values.length===0?Result.value(base):Result.value(deepMerge(base,merge$1.apply(undefined,values)));};var mergeErrors=errors=>Result.error(flatten(errors));var consolidate=(objs,base)=>{var partitions=partition$1(objs);return partitions.errors.length>0?mergeErrors(partitions.errors):mergeValues(partitions.values,base);};var ensureIsRoot=isRoot=>isFunction(isRoot)?isRoot:never;var ancestor$2=(scope,transform,isRoot)=>{var element=scope.dom;var stop=ensureIsRoot(isRoot);while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);var transformed=transform(el);if(transformed.isSome()){return transformed;}else if(stop(el)){break;}}return Optional.none();};var closest$4=(scope,transform,isRoot)=>{var current=transform(scope);var stop=ensureIsRoot(isRoot);return current.orThunk(()=>stop(scope)?Optional.none():ancestor$2(scope,transform,stop));};var isSource=(component,simulatedEvent)=>eq(component.element,simulatedEvent.event.target);var defaultEventHandler={can:always,abort:never,run:noop};var nu$9=parts=>{if(!hasNonNullableKey(parts,'can')&&!hasNonNullableKey(parts,'abort')&&!hasNonNullableKey(parts,'run')){throw new Error('EventHandler defined by: '+JSON.stringify(parts,null,2)+' does not have can, abort, or run!');}return _objectSpread(_objectSpread({},defaultEventHandler),parts);};var all$2=(handlers,f)=>function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9];}return foldl(handlers,(acc,handler)=>acc&&f(handler).apply(undefined,args),true);};var any=(handlers,f)=>function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++){args[_key10]=arguments[_key10];}return foldl(handlers,(acc,handler)=>acc||f(handler).apply(undefined,args),false);};var read$2=handler=>isFunction(handler)?{can:always,abort:never,run:handler}:handler;var fuse$1=handlers=>{var can=all$2(handlers,handler=>handler.can);var abort=any(handlers,handler=>handler.abort);var run=function run(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++){args[_key11]=arguments[_key11];}each$1(handlers,handler=>{handler.run.apply(undefined,args);});};return{can,abort,run};};var constant=constant$1;var touchstart=constant('touchstart');var touchmove=constant('touchmove');var touchend=constant('touchend');var touchcancel=constant('touchcancel');var mousedown=constant('mousedown');var mousemove=constant('mousemove');var mouseout=constant('mouseout');var mouseup=constant('mouseup');var mouseover=constant('mouseover');var focusin=constant('focusin');var focusout=constant('focusout');var keydown=constant('keydown');var keyup=constant('keyup');var input=constant('input');var change=constant('change');var click=constant('click');var transitioncancel=constant('transitioncancel');var transitionend=constant('transitionend');var transitionstart=constant('transitionstart');var selectstart=constant('selectstart');var prefixName=name=>constant$1('alloy.'+name);var alloy={tap:prefixName('tap')};var focus$4=prefixName('focus');var postBlur=prefixName('blur.post');var postPaste=prefixName('paste.post');var receive=prefixName('receive');var execute$5=prefixName('execute');var focusItem=prefixName('focus.item');var tap=alloy.tap;var longpress=prefixName('longpress');var sandboxClose=prefixName('sandbox.close');var typeaheadCancel=prefixName('typeahead.cancel');var systemInit=prefixName('system.init');var documentTouchmove=prefixName('system.touchmove');var documentTouchend=prefixName('system.touchend');var windowScroll=prefixName('system.scroll');var windowResize=prefixName('system.resize');var attachedToDom=prefixName('system.attached');var detachedFromDom=prefixName('system.detached');var dismissRequested=prefixName('system.dismissRequested');var repositionRequested=prefixName('system.repositionRequested');var focusShifted=prefixName('focusmanager.shifted');var slotVisibility=prefixName('slotcontainer.visibility');var externalElementScroll=prefixName('system.external.element.scroll');var changeTab=prefixName('change.tab');var dismissTab=prefixName('dismiss.tab');var highlight$1=prefixName('highlight');var dehighlight$1=prefixName('dehighlight');var emit=(component,event)=>{dispatchWith(component,component.element,event,{});};var emitWith=(component,event,properties)=>{dispatchWith(component,component.element,event,properties);};var emitExecute=component=>{emit(component,execute$5());};var dispatch=(component,target,event)=>{dispatchWith(component,target,event,{});};var dispatchWith=(component,target,event,properties)=>{var data=_objectSpread({target},properties);component.getSystem().triggerEvent(event,target,data);};var retargetAndDispatchWith=(component,target,eventName,properties)=>{var data=_objectSpread(_objectSpread({},properties),{},{target});component.getSystem().triggerEvent(eventName,target,data);};var dispatchEvent=(component,target,event,simulatedEvent)=>{component.getSystem().triggerEvent(event,target,simulatedEvent.event);};var derive$2=configs=>wrapAll(configs);var abort=(name,predicate)=>{return{key:name,value:nu$9({abort:predicate})};};var can=(name,predicate)=>{return{key:name,value:nu$9({can:predicate})};};var preventDefault=name=>{return{key:name,value:nu$9({run:(component,simulatedEvent)=>{simulatedEvent.event.prevent();}})};};var run$1=(name,handler)=>{return{key:name,value:nu$9({run:handler})};};var runActionExtra=(name,action,extra)=>{return{key:name,value:nu$9({run:(component,simulatedEvent)=>{action.apply(undefined,[component,simulatedEvent].concat(extra));}})};};var runOnName=name=>{return handler=>run$1(name,handler);};var runOnSourceName=name=>{return handler=>({key:name,value:nu$9({run:(component,simulatedEvent)=>{if(isSource(component,simulatedEvent)){handler(component,simulatedEvent);}}})});};var redirectToUid=(name,uid)=>{return run$1(name,(component,simulatedEvent)=>{component.getSystem().getByUid(uid).each(redirectee=>{dispatchEvent(redirectee,redirectee.element,name,simulatedEvent);});});};var redirectToPart=(name,detail,partName)=>{var uid=detail.partUids[partName];return redirectToUid(name,uid);};var runWithTarget=(name,f)=>{return run$1(name,(component,simulatedEvent)=>{var ev=simulatedEvent.event;var target=component.getSystem().getByDom(ev.target).getOrThunk(()=>{var closest=closest$4(ev.target,el=>component.getSystem().getByDom(el).toOptional(),never);return closest.getOr(component);});f(component,target,simulatedEvent);});};var cutter=name=>{return run$1(name,(component,simulatedEvent)=>{simulatedEvent.cut();});};var stopper=name=>{return run$1(name,(component,simulatedEvent)=>{simulatedEvent.stop();});};var runOnSource=(name,f)=>{return runOnSourceName(name)(f);};var runOnAttached=runOnSourceName(attachedToDom());var runOnDetached=runOnSourceName(detachedFromDom());var runOnInit=runOnSourceName(systemInit());var runOnExecute$1=runOnName(execute$5());var fromHtml$1=(html,scope)=>{var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;return children(SugarElement.fromDom(div));};var get$9=element=>element.dom.innerHTML;var set$6=(element,content)=>{var owner=owner$4(element);var docDom=owner.dom;var fragment=SugarElement.fromDom(docDom.createDocumentFragment());var contentElements=fromHtml$1(content,docDom);append$1(fragment,contentElements);empty(element);append$2(element,fragment);};var getOuter=element=>{var container=SugarElement.fromTag('div');var clone=SugarElement.fromDom(element.dom.cloneNode(true));append$2(container,clone);return get$9(container);};var clone$1=(original,isDeep)=>SugarElement.fromDom(original.dom.cloneNode(isDeep));var shallow=original=>clone$1(original,false);var getHtml=element=>{if(isShadowRoot(element)){return'#shadow-root';}else{var _clone=shallow(element);return getOuter(_clone);}};var element=elem=>getHtml(elem);var isRecursive=(component,originator,target)=>eq(originator,component.element)&&!eq(originator,target);var events$i=derive$2([can(focus$4(),(component,simulatedEvent)=>{var event=simulatedEvent.event;var originator=event.originator;var target=event.target;if(isRecursive(component,originator,target)){console.warn(focus$4()+' did not get interpreted by the desired target. '+'\\nOriginator: '+element(originator)+'\\nTarget: '+element(target)+'\\nCheck the '+focus$4()+' event handlers');return false;}else{return true;}})]);var DefaultEvents=/*#__PURE__*/Object.freeze({__proto__:null,events:events$i});var unique=0;var generate$6=prefix=>{var date=new Date();var time=date.getTime();var random=Math.floor(Math.random()*1000000000);unique++;return prefix+'_'+random+unique+String(time);};var prefix$1=constant$1('alloy-id-');var idAttr$1=constant$1('data-alloy-id');var prefix=prefix$1();var idAttr=idAttr$1();var write=(label,elem)=>{var id=generate$6(prefix+label);writeOnly(elem,id);return id;};var writeOnly=(elem,uid)=>{Object.defineProperty(elem.dom,idAttr,{value:uid,writable:true});};var read$1=elem=>{var id=isElement$1(elem)?elem.dom[idAttr]:null;return Optional.from(id);};var generate$5=prefix=>generate$6(prefix);var make$8=identity;var NoContextApi=getComp=>{var getMessage=event=>\"The component must be in a context to execute: \".concat(event)+(getComp?'\\n'+element(getComp().element)+' is not in context.':'');var fail=event=>()=>{throw new Error(getMessage(event));};var warn=event=>()=>{console.warn(getMessage(event));};return{debugInfo:constant$1('fake'),triggerEvent:warn('triggerEvent'),triggerFocus:warn('triggerFocus'),triggerEscape:warn('triggerEscape'),broadcast:warn('broadcast'),broadcastOn:warn('broadcastOn'),broadcastEvent:warn('broadcastEvent'),build:fail('build'),buildOrPatch:fail('buildOrPatch'),addToWorld:fail('addToWorld'),removeFromWorld:fail('removeFromWorld'),addToGui:fail('addToGui'),removeFromGui:fail('removeFromGui'),getByUid:fail('getByUid'),getByDom:fail('getByDom'),isConnected:never};};var singleton$1=NoContextApi();var markAsBehaviourApi=(f,apiName,apiFunction)=>{var delegate=apiFunction.toString();var endIndex=delegate.indexOf(')')+1;var openBracketIndex=delegate.indexOf('(');var parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\\s*/);f.toFunctionAnnotation=()=>({name:apiName,parameters:cleanParameters(parameters.slice(0,1).concat(parameters.slice(3)))});return f;};var cleanParameters=parameters=>map$2(parameters,p=>endsWith(p,'/*')?p.substring(0,p.length-'/*'.length):p);var markAsExtraApi=(f,extraName)=>{var delegate=f.toString();var endIndex=delegate.indexOf(')')+1;var openBracketIndex=delegate.indexOf('(');var parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\\s*/);f.toFunctionAnnotation=()=>({name:extraName,parameters:cleanParameters(parameters)});return f;};var markAsSketchApi=(f,apiFunction)=>{var delegate=apiFunction.toString();var endIndex=delegate.indexOf(')')+1;var openBracketIndex=delegate.indexOf('(');var parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\\s*/);f.toFunctionAnnotation=()=>({name:'OVERRIDE',parameters:cleanParameters(parameters.slice(1))});return f;};var premadeTag=generate$6('alloy-premade');var premade$1=comp=>{Object.defineProperty(comp.element.dom,premadeTag,{value:comp.uid,writable:true});return wrap$1(premadeTag,comp);};var isPremade=element=>has$2(element.dom,premadeTag);var getPremade=spec=>get$g(spec,premadeTag);var makeApi=f=>markAsSketchApi(function(component){for(var _len12=arguments.length,rest=new Array(_len12>1?_len12-1:0),_key12=1;_key12<_len12;_key12++){rest[_key12-1]=arguments[_key12];}return f(component.getApis(),component,...rest);},f);var NoState={init:()=>nu$8({readState:constant$1('No State required')})};var nu$8=spec=>spec;var generateFrom$1=(spec,all)=>{var schema=map$2(all,a=>optionObjOf(a.name(),[required$1('config'),defaulted('state',NoState)]));var validated=asRaw('component.behaviours',objOf(schema),spec.behaviours).fold(errInfo=>{throw new Error(formatError(errInfo)+'\\nComplete spec:\\n'+JSON.stringify(spec,null,2));},identity);return{list:all,data:map$1(validated,optBlobThunk=>{var output=optBlobThunk.map(blob=>({config:blob.config,state:blob.state.init(blob.config)}));return constant$1(output);})};};var getBehaviours$3=bData=>bData.list;var getData$2=bData=>bData.data;var byInnerKey=(data,tuple)=>{var r={};each(data,(detail,key)=>{each(detail,(value,indexKey)=>{var chain=get$g(r,indexKey).getOr([]);r[indexKey]=chain.concat([tuple(key,value)]);});});return r;};var nu$7=s=>({classes:isUndefined(s.classes)?[]:s.classes,attributes:isUndefined(s.attributes)?{}:s.attributes,styles:isUndefined(s.styles)?{}:s.styles});var merge=(defnA,mod)=>_objectSpread(_objectSpread({},defnA),{},{attributes:_objectSpread(_objectSpread({},defnA.attributes),mod.attributes),styles:_objectSpread(_objectSpread({},defnA.styles),mod.styles),classes:defnA.classes.concat(mod.classes)});var combine$2=(info,baseMod,behaviours,base)=>{var modsByBehaviour=_objectSpread({},baseMod);each$1(behaviours,behaviour=>{modsByBehaviour[behaviour.name()]=behaviour.exhibit(info,base);});var byAspect=byInnerKey(modsByBehaviour,(name,modification)=>({name,modification}));var combineObjects=objects=>foldr(objects,(b,a)=>_objectSpread(_objectSpread({},a.modification),b),{});var combinedClasses=foldr(byAspect.classes,(b,a)=>a.modification.concat(b),[]);var combinedAttributes=combineObjects(byAspect.attributes);var combinedStyles=combineObjects(byAspect.styles);return nu$7({classes:combinedClasses,attributes:combinedAttributes,styles:combinedStyles});};var sortKeys=(label,keyName,array,order)=>{try{var sorted=sort(array,(a,b)=>{var aKey=a[keyName];var bKey=b[keyName];var aIndex=order.indexOf(aKey);var bIndex=order.indexOf(bKey);if(aIndex===-1){throw new Error('The ordering for '+label+' does not have an entry for '+aKey+'.\\nOrder specified: '+JSON.stringify(order,null,2));}if(bIndex===-1){throw new Error('The ordering for '+label+' does not have an entry for '+bKey+'.\\nOrder specified: '+JSON.stringify(order,null,2));}if(aIndex<bIndex){return-1;}else if(bIndex<aIndex){return 1;}else{return 0;}});return Result.value(sorted);}catch(err){return Result.error([err]);}};var uncurried=(handler,purpose)=>({handler,purpose});var curried=(handler,purpose)=>({cHandler:handler,purpose});var curryArgs=(descHandler,extraArgs)=>curried(curry.apply(undefined,[descHandler.handler].concat(extraArgs)),descHandler.purpose);var getCurried=descHandler=>descHandler.cHandler;var behaviourTuple=(name,handler)=>({name,handler});var nameToHandlers=(behaviours,info)=>{var r={};each$1(behaviours,behaviour=>{r[behaviour.name()]=behaviour.handlers(info);});return r;};var groupByEvents=(info,behaviours,base)=>{var behaviourEvents=_objectSpread(_objectSpread({},base),nameToHandlers(behaviours,info));return byInnerKey(behaviourEvents,behaviourTuple);};var combine$1=(info,eventOrder,behaviours,base)=>{var byEventName=groupByEvents(info,behaviours,base);return combineGroups(byEventName,eventOrder);};var assemble=rawHandler=>{var handler=read$2(rawHandler);return function(component,simulatedEvent){for(var _len13=arguments.length,rest=new Array(_len13>2?_len13-2:0),_key13=2;_key13<_len13;_key13++){rest[_key13-2]=arguments[_key13];}var args=[component,simulatedEvent].concat(rest);if(handler.abort.apply(undefined,args)){simulatedEvent.stop();}else if(handler.can.apply(undefined,args)){handler.run.apply(undefined,args);}};};var missingOrderError=(eventName,tuples)=>Result.error(['The event ('+eventName+') has more than one behaviour that listens to it.\\nWhen this occurs, you must '+'specify an event ordering for the behaviours in your spec (e.g. [ \"listing\", \"toggling\" ]).\\nThe behaviours that '+'can trigger it are: '+JSON.stringify(map$2(tuples,c=>c.name),null,2)]);var fuse=(tuples,eventOrder,eventName)=>{var order=eventOrder[eventName];if(!order){return missingOrderError(eventName,tuples);}else{return sortKeys('Event: '+eventName,'name',tuples,order).map(sortedTuples=>{var handlers=map$2(sortedTuples,tuple=>tuple.handler);return fuse$1(handlers);});}};var combineGroups=(byEventName,eventOrder)=>{var r=mapToArray(byEventName,(tuples,eventName)=>{var combined=tuples.length===1?Result.value(tuples[0].handler):fuse(tuples,eventOrder,eventName);return combined.map(handler=>{var assembled=assemble(handler);var purpose=tuples.length>1?filter$2(eventOrder[eventName],o=>exists(tuples,t=>t.name===o)).join(' > '):tuples[0].name;return wrap$1(eventName,uncurried(assembled,purpose));});});return consolidate(r,{});};var baseBehaviour='alloy.base.behaviour';var schema$z=objOf([field$1('dom','dom',required$2(),objOf([required$1('tag'),defaulted('styles',{}),defaulted('classes',[]),defaulted('attributes',{}),option$3('value'),option$3('innerHtml')])),required$1('components'),required$1('uid'),defaulted('events',{}),defaulted('apis',{}),field$1('eventOrder','eventOrder',mergeWith({[execute$5()]:['disabling',baseBehaviour,'toggling','typeaheadevents'],[focus$4()]:[baseBehaviour,'focusing','keying'],[systemInit()]:[baseBehaviour,'disabling','toggling','representing'],[input()]:[baseBehaviour,'representing','streaming','invalidating'],[detachedFromDom()]:[baseBehaviour,'representing','item-events','tooltipping'],[mousedown()]:['focusing',baseBehaviour,'item-type-events'],[touchstart()]:['focusing',baseBehaviour,'item-type-events'],[mouseover()]:['item-type-events','tooltipping'],[receive()]:['receiving','reflecting','tooltipping']}),anyValue()),option$3('domModification')]);var toInfo=spec=>asRaw('custom.definition',schema$z,spec);var toDefinition=detail=>_objectSpread(_objectSpread({},detail.dom),{},{uid:detail.uid,domChildren:map$2(detail.components,comp=>comp.element)});var toModification=detail=>detail.domModification.fold(()=>nu$7({}),nu$7);var toEvents=info=>info.events;var read=(element,attr)=>{var value=get$f(element,attr);return value===undefined||value===''?[]:value.split(' ');};var add$4=(element,attr,id)=>{var old=read(element,attr);var nu=old.concat([id]);set$9(element,attr,nu.join(' '));return true;};var remove$4=(element,attr,id)=>{var nu=filter$2(read(element,attr),v=>v!==id);if(nu.length>0){set$9(element,attr,nu.join(' '));}else{remove$7(element,attr);}return false;};var supports=element=>element.dom.classList!==undefined;var get$8=element=>read(element,'class');var add$3=(element,clazz)=>add$4(element,'class',clazz);var remove$3=(element,clazz)=>remove$4(element,'class',clazz);var add$2=(element,clazz)=>{if(supports(element)){element.dom.classList.add(clazz);}else{add$3(element,clazz);}};var cleanClass=element=>{var classList=supports(element)?element.dom.classList:get$8(element);if(classList.length===0){remove$7(element,'class');}};var remove$2=(element,clazz)=>{if(supports(element)){var classList=element.dom.classList;classList.remove(clazz);}else{remove$3(element,clazz);}cleanClass(element);};var has=(element,clazz)=>supports(element)&&element.dom.classList.contains(clazz);var add$1=(element,classes)=>{each$1(classes,x=>{add$2(element,x);});};var remove$1=(element,classes)=>{each$1(classes,x=>{remove$2(element,x);});};var hasAll=(element,classes)=>forall(classes,clazz=>has(element,clazz));var getNative=element=>{var classList=element.dom.classList;var r=new Array(classList.length);for(var i=0;i<classList.length;i++){var _item2=classList.item(i);if(_item2!==null){r[i]=_item2;}}return r;};var get$7=element=>supports(element)?getNative(element):get$8(element);var get$6=element=>element.dom.value;var set$5=(element,value)=>{if(value===undefined){throw new Error('Value.set was undefined');}element.dom.value=value;};var determineObsoleted=(parent,index,oldObsoleted)=>{var newObsoleted=child$2(parent,index);return newObsoleted.map(newObs=>{var elemChanged=oldObsoleted.exists(o=>!eq(o,newObs));if(elemChanged){var oldTag=oldObsoleted.map(name$3).getOr('span');var marker=SugarElement.fromTag(oldTag);before$1(newObs,marker);return marker;}else{return newObs;}});};var ensureInDom=(parent,child,obsoleted)=>{obsoleted.fold(()=>append$2(parent,child),obs=>{if(!eq(obs,child)){before$1(obs,child);remove$5(obs);}});};var patchChildrenWith=(parent,nu,f)=>{var builtChildren=map$2(nu,f);var currentChildren=children(parent);each$1(currentChildren.slice(builtChildren.length),remove$5);return builtChildren;};var patchSpecChild=(parent,index,spec,build)=>{var oldObsoleted=child$2(parent,index);var childComp=build(spec,oldObsoleted);var obsoleted=determineObsoleted(parent,index,oldObsoleted);ensureInDom(parent,childComp.element,obsoleted);return childComp;};var patchSpecChildren=(parent,specs,build)=>patchChildrenWith(parent,specs,(spec,index)=>patchSpecChild(parent,index,spec,build));var patchDomChildren=(parent,nodes)=>patchChildrenWith(parent,nodes,(node,index)=>{var optObsoleted=child$2(parent,index);ensureInDom(parent,node,optObsoleted);return node;});var diffKeyValueSet=(newObj,oldObj)=>{var newKeys=keys(newObj);var oldKeys=keys(oldObj);var toRemove=difference(oldKeys,newKeys);var toSet=bifilter(newObj,(v,k)=>{return!has$2(oldObj,k)||v!==oldObj[k];}).t;return{toRemove,toSet};};var reconcileToDom=(definition,obsoleted)=>{var _clone$=clone$2(obsoleted),{class:clazz,style}=_clone$,existingAttributes=_objectWithoutProperties(_clone$,_excluded);var{toSet:attrsToSet,toRemove:attrsToRemove}=diffKeyValueSet(definition.attributes,existingAttributes);var updateAttrs=()=>{each$1(attrsToRemove,a=>remove$7(obsoleted,a));setAll$1(obsoleted,attrsToSet);};var existingStyles=getAllRaw(obsoleted);var{toSet:stylesToSet,toRemove:stylesToRemove}=diffKeyValueSet(definition.styles,existingStyles);var updateStyles=()=>{each$1(stylesToRemove,s=>remove$6(obsoleted,s));setAll(obsoleted,stylesToSet);};var existingClasses=get$7(obsoleted);var classesToRemove=difference(existingClasses,definition.classes);var classesToAdd=difference(definition.classes,existingClasses);var updateClasses=()=>{add$1(obsoleted,classesToAdd);remove$1(obsoleted,classesToRemove);};var updateHtml=html=>{set$6(obsoleted,html);};var updateChildren=()=>{var children=definition.domChildren;patchDomChildren(obsoleted,children);};var updateValue=()=>{var valueElement=obsoleted;var value=definition.value.getOrUndefined();if(value!==get$6(valueElement)){set$5(valueElement,value!==null&&value!==void 0?value:'');}};updateAttrs();updateClasses();updateStyles();definition.innerHtml.fold(updateChildren,updateHtml);updateValue();return obsoleted;};var introduceToDom=definition=>{var subject=SugarElement.fromTag(definition.tag);setAll$1(subject,definition.attributes);add$1(subject,definition.classes);setAll(subject,definition.styles);definition.innerHtml.each(html=>set$6(subject,html));var children=definition.domChildren;append$1(subject,children);definition.value.each(value=>{set$5(subject,value);});return subject;};var attemptPatch=(definition,obsoleted)=>{try{var e=reconcileToDom(definition,obsoleted);return Optional.some(e);}catch(err){return Optional.none();}};var hasMixedChildren=definition=>definition.innerHtml.isSome()&&definition.domChildren.length>0;var renderToDom=(definition,optObsoleted)=>{var canBePatched=candidate=>name$3(candidate)===definition.tag&&!hasMixedChildren(definition)&&!isPremade(candidate);var elem=optObsoleted.filter(canBePatched).bind(obsoleted=>attemptPatch(definition,obsoleted)).getOrThunk(()=>introduceToDom(definition));writeOnly(elem,definition.uid);return elem;};var getBehaviours$2=spec=>{var behaviours=get$g(spec,'behaviours').getOr({});return bind$3(keys(behaviours),name=>{var behaviour=behaviours[name];return isNonNullable(behaviour)?[behaviour.me]:[];});};var generateFrom=(spec,all)=>generateFrom$1(spec,all);var generate$4=spec=>{var all=getBehaviours$2(spec);return generateFrom(spec,all);};var getDomDefinition=(info,bList,bData)=>{var definition=toDefinition(info);var infoModification=toModification(info);var baseModification={'alloy.base.modification':infoModification};var modification=bList.length>0?combine$2(bData,baseModification,bList,definition):infoModification;return merge(definition,modification);};var getEvents=(info,bList,bData)=>{var baseEvents={'alloy.base.behaviour':toEvents(info)};return combine$1(bData,info.eventOrder,bList,baseEvents).getOrDie();};var build$2=(spec,obsoleted)=>{var getMe=()=>me;var systemApi=Cell(singleton$1);var info=getOrDie(toInfo(spec));var bBlob=generate$4(spec);var bList=getBehaviours$3(bBlob);var bData=getData$2(bBlob);var modDefinition=getDomDefinition(info,bList,bData);var item=renderToDom(modDefinition,obsoleted);var events=getEvents(info,bList,bData);var subcomponents=Cell(info.components);var connect=newApi=>{systemApi.set(newApi);};var disconnect=()=>{systemApi.set(NoContextApi(getMe));};var syncComponents=()=>{var children$1=children(item);var subs=bind$3(children$1,child=>systemApi.get().getByDom(child).fold(()=>[],pure$2));subcomponents.set(subs);};var config=behaviour=>{var b=bData;var f=isFunction(b[behaviour.name()])?b[behaviour.name()]:()=>{throw new Error('Could not find '+behaviour.name()+' in '+JSON.stringify(spec,null,2));};return f();};var hasConfigured=behaviour=>isFunction(bData[behaviour.name()]);var getApis=()=>info.apis;var readState=behaviourName=>bData[behaviourName]().map(b=>b.state.readState()).getOr('not enabled');var me={uid:spec.uid,getSystem:systemApi.get,config,hasConfigured,spec,readState,getApis,connect,disconnect,element:item,syncComponents,components:subcomponents.get,events};return me;};var buildSubcomponents=(spec,obsoleted)=>{var components=get$g(spec,'components').getOr([]);return obsoleted.fold(()=>map$2(components,build$1),obs=>map$2(components,(c,i)=>{return buildOrPatch(c,child$2(obs,i));}));};var buildFromSpec=(userSpec,obsoleted)=>{var _make$=make$8(userSpec),{events:specEvents}=_make$,spec=_objectWithoutProperties(_make$,_excluded2);var components=buildSubcomponents(spec,obsoleted);var completeSpec=_objectSpread(_objectSpread({},spec),{},{events:_objectSpread(_objectSpread({},DefaultEvents),specEvents),components});return Result.value(build$2(completeSpec,obsoleted));};var text$2=textContent=>{var element=SugarElement.fromText(textContent);return external$1({element});};var external$1=spec=>{var extSpec=asRawOrDie$1('external.component',objOfOnly([required$1('element'),option$3('uid')]),spec);var systemApi=Cell(NoContextApi());var connect=newApi=>{systemApi.set(newApi);};var disconnect=()=>{systemApi.set(NoContextApi(()=>me));};var uid=extSpec.uid.getOrThunk(()=>generate$5('external'));writeOnly(extSpec.element,uid);var me={uid,getSystem:systemApi.get,config:Optional.none,hasConfigured:never,connect,disconnect,getApis:()=>({}),element:extSpec.element,spec,readState:constant$1('No state'),syncComponents:noop,components:constant$1([]),events:{}};return premade$1(me);};var uids=generate$5;var isSketchSpec$1=spec=>has$2(spec,'uid');var buildOrPatch=(spec,obsoleted)=>getPremade(spec).getOrThunk(()=>{var userSpecWithUid=isSketchSpec$1(spec)?spec:_objectSpread({uid:uids('')},spec);return buildFromSpec(userSpecWithUid,obsoleted).getOrDie();});var build$1=spec=>buildOrPatch(spec,Optional.none());var premade=premade$1;var ClosestOrAncestor=(is,ancestor,scope,a,isRoot)=>{if(is(scope,a)){return Optional.some(scope);}else if(isFunction(isRoot)&&isRoot(scope)){return Optional.none();}else{return ancestor(scope,a,isRoot);}};var ancestor$1=(scope,predicate,isRoot)=>{var element=scope.dom;var stop=isFunction(isRoot)?isRoot:never;while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el)){return Optional.some(el);}else if(stop(el)){break;}}return Optional.none();};var closest$3=(scope,predicate,isRoot)=>{var is=(s,test)=>test(s);return ClosestOrAncestor(is,ancestor$1,scope,predicate,isRoot);};var child$1=(scope,predicate)=>{var pred=node=>predicate(SugarElement.fromDom(node));var result=find$5(scope.dom.childNodes,pred);return result.map(SugarElement.fromDom);};var descendant$1=(scope,predicate)=>{var descend=node=>{for(var i=0;i<node.childNodes.length;i++){var _child=SugarElement.fromDom(node.childNodes[i]);if(predicate(_child)){return Optional.some(_child);}var res=descend(node.childNodes[i]);if(res.isSome()){return res;}}return Optional.none();};return descend(scope.dom);};var closest$2=(scope,predicate,isRoot)=>closest$3(scope,predicate,isRoot).isSome();var ancestor=(scope,selector,isRoot)=>ancestor$1(scope,e=>is(e,selector),isRoot);var child=(scope,selector)=>child$1(scope,e=>is(e,selector));var descendant=(scope,selector)=>one(selector,scope);var closest$1=(scope,selector,isRoot)=>{var is$1=(element,selector)=>is(element,selector);return ClosestOrAncestor(is$1,ancestor,scope,selector,isRoot);};var attribute='aria-controls';var find$1=queryElem=>{var dependent=closest$3(queryElem,elem=>{if(!isElement$1(elem)){return false;}var id=get$f(elem,'id');return id!==undefined&&id.indexOf(attribute)>-1;});return dependent.bind(dep=>{var id=get$f(dep,'id');var dos=getRootNode(dep);return descendant(dos,\"[\".concat(attribute,\"=\\\"\").concat(id,\"\\\"]\"));});};var manager=()=>{var ariaId=generate$6(attribute);var link=elem=>{set$9(elem,attribute,ariaId);};var unlink=elem=>{remove$7(elem,attribute);};return{id:ariaId,link,unlink};};var isAriaPartOf=(component,queryElem)=>find$1(queryElem).exists(owner=>isPartOf$1(component,owner));var isPartOf$1=(component,queryElem)=>closest$2(queryElem,el=>eq(el,component.element),never)||isAriaPartOf(component,queryElem);var unknown='unknown';var EventConfiguration;(function(EventConfiguration){EventConfiguration[EventConfiguration['STOP']=0]='STOP';EventConfiguration[EventConfiguration['NORMAL']=1]='NORMAL';EventConfiguration[EventConfiguration['LOGGING']=2]='LOGGING';})(EventConfiguration||(EventConfiguration={}));var eventConfig=Cell({});var makeEventLogger=(eventName,initialTarget)=>{var sequence=[];var startTime=new Date().getTime();return{logEventCut:(_name,target,purpose)=>{sequence.push({outcome:'cut',target,purpose});},logEventStopped:(_name,target,purpose)=>{sequence.push({outcome:'stopped',target,purpose});},logNoParent:(_name,target,purpose)=>{sequence.push({outcome:'no-parent',target,purpose});},logEventNoHandlers:(_name,target)=>{sequence.push({outcome:'no-handlers-left',target});},logEventResponse:(_name,target,purpose)=>{sequence.push({outcome:'response',purpose,target});},write:()=>{var finishTime=new Date().getTime();if(contains$2(['mousemove','mouseover','mouseout',systemInit()],eventName)){return;}console.log(eventName,{event:eventName,time:finishTime-startTime,target:initialTarget.dom,sequence:map$2(sequence,s=>{if(!contains$2(['cut','stopped','response'],s.outcome)){return s.outcome;}else{return'{'+s.purpose+'} '+s.outcome+' at ('+element(s.target)+')';}})});}};};var processEvent=(eventName,initialTarget,f)=>{var status=get$g(eventConfig.get(),eventName).orThunk(()=>{var patterns=keys(eventConfig.get());return findMap(patterns,p=>eventName.indexOf(p)>-1?Optional.some(eventConfig.get()[p]):Optional.none());}).getOr(EventConfiguration.NORMAL);switch(status){case EventConfiguration.NORMAL:return f(noLogger());case EventConfiguration.LOGGING:{var logger=makeEventLogger(eventName,initialTarget);var _output=f(logger);logger.write();return _output;}case EventConfiguration.STOP:return true;}};var path=['alloy/data/Fields','alloy/debugging/Debugging'];var getTrace=()=>{var err=new Error();if(err.stack!==undefined){var lines=err.stack.split('\\n');return find$5(lines,line=>line.indexOf('alloy')>0&&!exists(path,p=>line.indexOf(p)>-1)).getOr(unknown);}else{return unknown;}};var ignoreEvent={logEventCut:noop,logEventStopped:noop,logNoParent:noop,logEventNoHandlers:noop,logEventResponse:noop,write:noop};var monitorEvent=(eventName,initialTarget,f)=>processEvent(eventName,initialTarget,f);var noLogger=constant$1(ignoreEvent);var menuFields=constant$1([required$1('menu'),required$1('selectedMenu')]);var itemFields=constant$1([required$1('item'),required$1('selectedItem')]);constant$1(objOf(itemFields().concat(menuFields())));var itemSchema$3=constant$1(objOf(itemFields()));var _initSize=requiredObjOf('initSize',[required$1('numColumns'),required$1('numRows')]);var itemMarkers=()=>requiredOf('markers',itemSchema$3());var tieredMenuMarkers=()=>requiredObjOf('markers',[required$1('backgroundMenu')].concat(menuFields()).concat(itemFields()));var markers$1=required=>requiredObjOf('markers',map$2(required,required$1));var onPresenceHandler=(label,fieldName,presence)=>{getTrace();return field$1(fieldName,fieldName,presence,valueOf(f=>Result.value(function(){for(var _len14=arguments.length,args=new Array(_len14),_key14=0;_key14<_len14;_key14++){args[_key14]=arguments[_key14];}return f.apply(undefined,args);})));};var onHandler=fieldName=>onPresenceHandler('onHandler',fieldName,defaulted$1(noop));var onKeyboardHandler=fieldName=>onPresenceHandler('onKeyboardHandler',fieldName,defaulted$1(Optional.none));var onStrictHandler=fieldName=>onPresenceHandler('onHandler',fieldName,required$2());var onStrictKeyboardHandler=fieldName=>onPresenceHandler('onKeyboardHandler',fieldName,required$2());var output$1=(name,value)=>customField(name,constant$1(value));var snapshot=name=>customField(name,identity);var initSize=constant$1(_initSize);var nu$6=function nu$6(x,y,bubble,direction,placement,boundsRestriction,labelPrefix){var alwaysFit=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;return{x,y,bubble,direction,placement,restriction:boundsRestriction,label:\"\".concat(labelPrefix,\"-\").concat(placement),alwaysFit};};var adt$a=Adt.generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]);var cata$2=(subject,southeast,southwest,northeast,northwest,south,north,east,west)=>subject.fold(southeast,southwest,northeast,northwest,south,north,east,west);var cataVertical=(subject,south,middle,north)=>subject.fold(south,south,north,north,south,north,middle,middle);var cataHorizontal=(subject,east,middle,west)=>subject.fold(east,west,east,west,middle,middle,east,west);var southeast$3=adt$a.southeast;var southwest$3=adt$a.southwest;var northeast$3=adt$a.northeast;var northwest$3=adt$a.northwest;var south$3=adt$a.south;var north$3=adt$a.north;var east$3=adt$a.east;var west$3=adt$a.west;var cycleBy=(value,delta,min,max)=>{var r=value+delta;if(r>max){return min;}else if(r<min){return max;}else{return r;}};var clamp=(value,min,max)=>Math.min(Math.max(value,min),max);var getRestriction=(anchor,restriction)=>{switch(restriction){case 1:return anchor.x;case 0:return anchor.x+anchor.width;case 2:return anchor.y;case 3:return anchor.y+anchor.height;}};var boundsRestriction=(anchor,restrictions)=>mapToObject(['left','right','top','bottom'],dir=>get$g(restrictions,dir).map(restriction=>getRestriction(anchor,restriction)));var adjustBounds=(bounds$1,restriction,bubbleOffset)=>{var applyRestriction=(dir,current)=>restriction[dir].map(pos=>{var isVerticalAxis=dir==='top'||dir==='bottom';var offset=isVerticalAxis?bubbleOffset.top:bubbleOffset.left;var comparator=dir==='left'||dir==='top'?Math.max:Math.min;var newPos=comparator(pos,current)+offset;return isVerticalAxis?clamp(newPos,bounds$1.y,bounds$1.bottom):clamp(newPos,bounds$1.x,bounds$1.right);}).getOr(current);var adjustedLeft=applyRestriction('left',bounds$1.x);var adjustedTop=applyRestriction('top',bounds$1.y);var adjustedRight=applyRestriction('right',bounds$1.right);var adjustedBottom=applyRestriction('bottom',bounds$1.bottom);return bounds(adjustedLeft,adjustedTop,adjustedRight-adjustedLeft,adjustedBottom-adjustedTop);};var labelPrefix$2='layout';var eastX$1=anchor=>anchor.x;var middleX$1=(anchor,element)=>anchor.x+anchor.width/2-element.width/2;var westX$1=(anchor,element)=>anchor.x+anchor.width-element.width;var northY$2=(anchor,element)=>anchor.y-element.height;var southY$2=anchor=>anchor.y+anchor.height;var centreY$1=(anchor,element)=>anchor.y+anchor.height/2-element.height/2;var eastEdgeX$1=anchor=>anchor.x+anchor.width;var westEdgeX$1=(anchor,element)=>anchor.x-element.width;var southeast$2=(anchor,element,bubbles)=>nu$6(eastX$1(anchor),southY$2(anchor),bubbles.southeast(),southeast$3(),'southeast',boundsRestriction(anchor,{left:1,top:3}),labelPrefix$2);var southwest$2=(anchor,element,bubbles)=>nu$6(westX$1(anchor,element),southY$2(anchor),bubbles.southwest(),southwest$3(),'southwest',boundsRestriction(anchor,{right:0,top:3}),labelPrefix$2);var northeast$2=(anchor,element,bubbles)=>nu$6(eastX$1(anchor),northY$2(anchor,element),bubbles.northeast(),northeast$3(),'northeast',boundsRestriction(anchor,{left:1,bottom:2}),labelPrefix$2);var northwest$2=(anchor,element,bubbles)=>nu$6(westX$1(anchor,element),northY$2(anchor,element),bubbles.northwest(),northwest$3(),'northwest',boundsRestriction(anchor,{right:0,bottom:2}),labelPrefix$2);var north$2=(anchor,element,bubbles)=>nu$6(middleX$1(anchor,element),northY$2(anchor,element),bubbles.north(),north$3(),'north',boundsRestriction(anchor,{bottom:2}),labelPrefix$2);var south$2=(anchor,element,bubbles)=>nu$6(middleX$1(anchor,element),southY$2(anchor),bubbles.south(),south$3(),'south',boundsRestriction(anchor,{top:3}),labelPrefix$2);var east$2=(anchor,element,bubbles)=>nu$6(eastEdgeX$1(anchor),centreY$1(anchor,element),bubbles.east(),east$3(),'east',boundsRestriction(anchor,{left:0}),labelPrefix$2);var west$2=(anchor,element,bubbles)=>nu$6(westEdgeX$1(anchor,element),centreY$1(anchor,element),bubbles.west(),west$3(),'west',boundsRestriction(anchor,{right:1}),labelPrefix$2);var all$1=()=>[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2,east$2,west$2];var allRtl$1=()=>[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2,east$2,west$2];var aboveOrBelow=()=>[northeast$2,northwest$2,southeast$2,southwest$2,north$2,south$2];var aboveOrBelowRtl=()=>[northwest$2,northeast$2,southwest$2,southeast$2,north$2,south$2];var belowOrAbove=()=>[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2];var belowOrAboveRtl=()=>[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2];var chooseChannels=(channels,message)=>message.universal?channels:filter$2(channels,ch=>contains$2(message.channels,ch));var events$h=receiveConfig=>derive$2([run$1(receive(),(component,message)=>{var channelMap=receiveConfig.channels;var channels=keys(channelMap);var receivingData=message;var targetChannels=chooseChannels(channels,receivingData);each$1(targetChannels,ch=>{var channelInfo=channelMap[ch];var channelSchema=channelInfo.schema;var data=asRawOrDie$1('channel['+ch+'] data\\nReceiver: '+element(component.element),channelSchema,receivingData.data);channelInfo.onReceive(component,data);});})]);var ActiveReceiving=/*#__PURE__*/Object.freeze({__proto__:null,events:events$h});var ReceivingSchema=[requiredOf('channels',setOf(Result.value,objOfOnly([onStrictHandler('onReceive'),defaulted('schema',anyValue())])))];var executeEvent=(bConfig,bState,executor)=>runOnExecute$1(component=>{executor(component,bConfig,bState);});var loadEvent=(bConfig,bState,f)=>runOnInit((component,_simulatedEvent)=>{f(component,bConfig,bState);});var create$5=(schema,name,active,apis,extra,state)=>{var configSchema=objOfOnly(schema);var schemaSchema=optionObjOf(name,[optionObjOfOnly('config',schema)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state);};var createModes$1=(modes,name,active,apis,extra,state)=>{var configSchema=modes;var schemaSchema=optionObjOf(name,[optionOf('config',modes)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state);};var wrapApi=(bName,apiFunction,apiName)=>{var f=function f(component){for(var _len15=arguments.length,rest=new Array(_len15>1?_len15-1:0),_key15=1;_key15<_len15;_key15++){rest[_key15-1]=arguments[_key15];}var args=[component].concat(rest);return component.config({name:constant$1(bName)}).fold(()=>{throw new Error('We could not find any behaviour configuration for: '+bName+'. Using API: '+apiName);},info=>{var rest=Array.prototype.slice.call(args,1);return apiFunction.apply(undefined,[component,info.config,info.state].concat(rest));});};return markAsBehaviourApi(f,apiName,apiFunction);};var revokeBehaviour=name=>({key:name,value:undefined});var doCreate=(configSchema,schemaSchema,name,active,apis,extra,state)=>{var getConfig=info=>hasNonNullableKey(info,name)?info[name]():Optional.none();var wrappedApis=map$1(apis,(apiF,apiName)=>wrapApi(name,apiF,apiName));var wrappedExtra=map$1(extra,(extraF,extraName)=>markAsExtraApi(extraF,extraName));var me=_objectSpread(_objectSpread(_objectSpread({},wrappedExtra),wrappedApis),{},{revoke:curry(revokeBehaviour,name),config:spec=>{var prepared=asRawOrDie$1(name+'-config',configSchema,spec);return{key:name,value:{config:prepared,me,configAsRaw:cached(()=>asRawOrDie$1(name+'-config',configSchema,spec)),initialConfig:spec,state}};},schema:constant$1(schemaSchema),exhibit:(info,base)=>{return lift2(getConfig(info),get$g(active,'exhibit'),(behaviourInfo,exhibitor)=>{return exhibitor(base,behaviourInfo.config,behaviourInfo.state);}).getOrThunk(()=>nu$7({}));},name:constant$1(name),handlers:info=>{return getConfig(info).map(behaviourInfo=>{var getEvents=get$g(active,'events').getOr(()=>({}));return getEvents(behaviourInfo.config,behaviourInfo.state);}).getOr({});}});return me;};var derive$1=capabilities=>wrapAll(capabilities);var simpleSchema=objOfOnly([required$1('fields'),required$1('name'),defaulted('active',{}),defaulted('apis',{}),defaulted('state',NoState),defaulted('extra',{})]);var create$4=data=>{var value=asRawOrDie$1('Creating behaviour: '+data.name,simpleSchema,data);return create$5(value.fields,value.name,value.active,value.apis,value.extra,value.state);};var modeSchema=objOfOnly([required$1('branchKey'),required$1('branches'),required$1('name'),defaulted('active',{}),defaulted('apis',{}),defaulted('state',NoState),defaulted('extra',{})]);var createModes=data=>{var value=asRawOrDie$1('Creating behaviour: '+data.name,modeSchema,data);return createModes$1(choose$1(value.branchKey,value.branches),value.name,value.active,value.apis,value.extra,value.state);};var revoke=constant$1(undefined);var Receiving=create$4({fields:ReceivingSchema,name:'receiving',active:ActiveReceiving});var exhibit$6=(base,posConfig)=>nu$7({classes:[],styles:posConfig.useFixed()?{}:{position:'relative'}});var ActivePosition=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$6});var focus$3=element=>element.dom.focus();var blur$1=element=>element.dom.blur();var hasFocus=element=>{var root=getRootNode(element).dom;return element.dom===root.activeElement;};var active$1=function active$1(){var root=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getDocument();return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);};var search=element=>active$1(getRootNode(element)).filter(e=>element.dom.contains(e.dom));var preserve$1=(f,container)=>{var dos=getRootNode(container);var refocus=active$1(dos).bind(focused=>{var hasFocus=elem=>eq(focused,elem);return hasFocus(container)?Optional.some(container):descendant$1(container,hasFocus);});var result=f(container);refocus.each(oldFocus=>{active$1(dos).filter(newFocus=>eq(newFocus,oldFocus)).fold(()=>{focus$3(oldFocus);},noop);});return result;};var NuPositionCss=(position,left,top,right,bottom)=>{var toPx=num=>num+'px';return{position,left:left.map(toPx),top:top.map(toPx),right:right.map(toPx),bottom:bottom.map(toPx)};};var toOptions=position=>_objectSpread(_objectSpread({},position),{},{position:Optional.some(position.position)});var applyPositionCss=(element,position)=>{setOptions(element,toOptions(position));};var adt$9=Adt.generate([{none:[]},{relative:['x','y','width','height']},{fixed:['x','y','width','height']}]);var positionWithDirection=(posName,decision,x,y,width,height)=>{var decisionRect=decision.rect;var decisionX=decisionRect.x-x;var decisionY=decisionRect.y-y;var decisionWidth=decisionRect.width;var decisionHeight=decisionRect.height;var decisionRight=width-(decisionX+decisionWidth);var decisionBottom=height-(decisionY+decisionHeight);var left=Optional.some(decisionX);var top=Optional.some(decisionY);var right=Optional.some(decisionRight);var bottom=Optional.some(decisionBottom);var none=Optional.none();return cata$2(decision.direction,()=>NuPositionCss(posName,left,top,none,none),()=>NuPositionCss(posName,none,top,right,none),()=>NuPositionCss(posName,left,none,none,bottom),()=>NuPositionCss(posName,none,none,right,bottom),()=>NuPositionCss(posName,left,top,none,none),()=>NuPositionCss(posName,left,none,none,bottom),()=>NuPositionCss(posName,left,top,none,none),()=>NuPositionCss(posName,none,top,right,none));};var reposition=(origin,decision)=>origin.fold(()=>{var decisionRect=decision.rect;return NuPositionCss('absolute',Optional.some(decisionRect.x),Optional.some(decisionRect.y),Optional.none(),Optional.none());},(x,y,width,height)=>{return positionWithDirection('absolute',decision,x,y,width,height);},(x,y,width,height)=>{return positionWithDirection('fixed',decision,x,y,width,height);});var toBox=(origin,element)=>{var rel=curry(find$2,element);var position=origin.fold(rel,rel,()=>{var scroll=get$b();return find$2(element).translate(-scroll.left,-scroll.top);});var width=getOuter$1(element);var height=getOuter$2(element);return bounds(position.left,position.top,width,height);};var viewport=(origin,optBounds)=>optBounds.fold(()=>origin.fold(win,win,bounds),bounds$1=>origin.fold(constant$1(bounds$1),constant$1(bounds$1),()=>{var pos=translate$2(origin,bounds$1.x,bounds$1.y);return bounds(pos.left,pos.top,bounds$1.width,bounds$1.height);}));var translate$2=(origin,x,y)=>{var pos=SugarPosition(x,y);var removeScroll=()=>{var outerScroll=get$b();return pos.translate(-outerScroll.left,-outerScroll.top);};return origin.fold(constant$1(pos),constant$1(pos),removeScroll);};var cata$1=(subject,onNone,onRelative,onFixed)=>subject.fold(onNone,onRelative,onFixed);adt$9.none;var relative$1=adt$9.relative;var fixed$1=adt$9.fixed;var anchor=(anchorBox,origin)=>({anchorBox,origin});var box=(anchorBox,origin)=>anchor(anchorBox,origin);var placementAttribute='data-alloy-placement';var setPlacement$1=(element,placement)=>{set$9(element,placementAttribute,placement);};var getPlacement=element=>getOpt(element,placementAttribute);var reset$2=element=>remove$7(element,placementAttribute);var adt$8=Adt.generate([{fit:['reposition']},{nofit:['reposition','visibleW','visibleH','isVisible']}]);var determinePosition=(box,bounds)=>{var{x:boundsX,y:boundsY,right:boundsRight,bottom:boundsBottom}=bounds;var{x,y,right,bottom,width,height}=box;var xInBounds=x>=boundsX&&x<=boundsRight;var yInBounds=y>=boundsY&&y<=boundsBottom;var originInBounds=xInBounds&&yInBounds;var rightInBounds=right<=boundsRight&&right>=boundsX;var bottomInBounds=bottom<=boundsBottom&&bottom>=boundsY;var sizeInBounds=rightInBounds&&bottomInBounds;var visibleW=Math.min(width,x>=boundsX?boundsRight-x:right-boundsX);var visibleH=Math.min(height,y>=boundsY?boundsBottom-y:bottom-boundsY);return{originInBounds,sizeInBounds,visibleW,visibleH};};var calcReposition=(box,bounds$1)=>{var{x:boundsX,y:boundsY,right:boundsRight,bottom:boundsBottom}=bounds$1;var{x,y,width,height}=box;var maxX=Math.max(boundsX,boundsRight-width);var maxY=Math.max(boundsY,boundsBottom-height);var restrictedX=clamp(x,boundsX,maxX);var restrictedY=clamp(y,boundsY,maxY);var restrictedWidth=Math.min(restrictedX+width,boundsRight)-restrictedX;var restrictedHeight=Math.min(restrictedY+height,boundsBottom)-restrictedY;return bounds(restrictedX,restrictedY,restrictedWidth,restrictedHeight);};var calcMaxSizes=(direction,box,bounds)=>{var upAvailable=constant$1(box.bottom-bounds.y);var downAvailable=constant$1(bounds.bottom-box.y);var maxHeight=cataVertical(direction,downAvailable,downAvailable,upAvailable);var westAvailable=constant$1(box.right-bounds.x);var eastAvailable=constant$1(bounds.right-box.x);var maxWidth=cataHorizontal(direction,eastAvailable,eastAvailable,westAvailable);return{maxWidth,maxHeight};};var attempt=(candidate,width,height,bounds$1)=>{var bubble=candidate.bubble;var bubbleOffset=bubble.offset;var adjustedBounds=adjustBounds(bounds$1,candidate.restriction,bubbleOffset);var newX=candidate.x+bubbleOffset.left;var newY=candidate.y+bubbleOffset.top;var box=bounds(newX,newY,width,height);var{originInBounds,sizeInBounds,visibleW,visibleH}=determinePosition(box,adjustedBounds);var fits=originInBounds&&sizeInBounds;var fittedBox=fits?box:calcReposition(box,adjustedBounds);var isPartlyVisible=fittedBox.width>0&&fittedBox.height>0;var{maxWidth,maxHeight}=calcMaxSizes(candidate.direction,fittedBox,bounds$1);var reposition={rect:fittedBox,maxHeight,maxWidth,direction:candidate.direction,placement:candidate.placement,classes:{on:bubble.classesOn,off:bubble.classesOff},layout:candidate.label,testY:newY};return fits||candidate.alwaysFit?adt$8.fit(reposition):adt$8.nofit(reposition,visibleW,visibleH,isPartlyVisible);};var attempts=(element,candidates,anchorBox,elementBox,bubbles,bounds)=>{var panelWidth=elementBox.width;var panelHeight=elementBox.height;var attemptBestFit=(layout,reposition,visibleW,visibleH,isVisible)=>{var next=layout(anchorBox,elementBox,bubbles,element,bounds);var attemptLayout=attempt(next,panelWidth,panelHeight,bounds);return attemptLayout.fold(constant$1(attemptLayout),(newReposition,newVisibleW,newVisibleH,newIsVisible)=>{var improved=isVisible===newIsVisible?newVisibleH>visibleH||newVisibleW>visibleW:!isVisible&&newIsVisible;return improved?attemptLayout:adt$8.nofit(reposition,visibleW,visibleH,isVisible);});};var abc=foldl(candidates,(b,a)=>{var bestNext=curry(attemptBestFit,a);return b.fold(constant$1(b),bestNext);},adt$8.nofit({rect:anchorBox,maxHeight:elementBox.height,maxWidth:elementBox.width,direction:southeast$3(),placement:'southeast',classes:{on:[],off:[]},layout:'none',testY:anchorBox.y},-1,-1,false));return abc.fold(identity,identity);};var singleton=doRevoke=>{var subject=Cell(Optional.none());var revoke=()=>subject.get().each(doRevoke);var clear=()=>{revoke();subject.set(Optional.none());};var isSet=()=>subject.get().isSome();var get=()=>subject.get();var set=s=>{revoke();subject.set(Optional.some(s));};return{clear,isSet,get,set};};var destroyable=()=>singleton(s=>s.destroy());var unbindable=()=>singleton(s=>s.unbind());var value$2=()=>{var subject=singleton(noop);var on=f=>subject.get().each(f);return _objectSpread(_objectSpread({},subject),{},{on});};var filter=always;var bind=(element,event,handler)=>bind$2(element,event,filter,handler);var capture=(element,event,handler)=>capture$1(element,event,filter,handler);var fromRawEvent=fromRawEvent$1;var properties=['top','bottom','right','left'];var timerAttr='data-alloy-transition-timer';var isTransitioning$1=(element,transition)=>hasAll(element,transition.classes);var shouldApplyTransitionCss=(transition,decision,lastPlacement)=>{return lastPlacement.exists(placer=>{var mode=transition.mode;return mode==='all'?true:placer[mode]!==decision[mode];});};var hasChanges=(position,intermediate)=>{var round=value=>parseFloat(value).toFixed(3);return find$4(intermediate,(value,key)=>{var newValue=position[key].map(round);var val=value.map(round);return!equals(newValue,val);}).isSome();};var getTransitionDuration=element=>{var get=name=>{var style=get$e(element,name);var times=style.split(/\\s*,\\s*/);return filter$2(times,isNotEmpty);};var parse=value=>{if(isString(value)&&/^[\\d.]+/.test(value)){var num=parseFloat(value);return endsWith(value,'ms')?num:num*1000;}else{return 0;}};var delay=get('transition-delay');var duration=get('transition-duration');return foldl(duration,(acc,dur,i)=>{var time=parse(delay[i])+parse(dur);return Math.max(acc,time);},0);};var setupTransitionListeners=(element,transition)=>{var transitionEnd=unbindable();var transitionCancel=unbindable();var timer;var isSourceTransition=e=>{var _a;var pseudoElement=(_a=e.raw.pseudoElement)!==null&&_a!==void 0?_a:'';return eq(e.target,element)&&isEmpty(pseudoElement)&&contains$2(properties,e.raw.propertyName);};var transitionDone=e=>{if(isNullable(e)||isSourceTransition(e)){transitionEnd.clear();transitionCancel.clear();var _type=e===null||e===void 0?void 0:e.raw.type;if(isNullable(_type)||_type===transitionend()){clearTimeout(timer);remove$7(element,timerAttr);remove$1(element,transition.classes);}}};var transitionStart=bind(element,transitionstart(),e=>{if(isSourceTransition(e)){transitionStart.unbind();transitionEnd.set(bind(element,transitionend(),transitionDone));transitionCancel.set(bind(element,transitioncancel(),transitionDone));}});var duration=getTransitionDuration(element);requestAnimationFrame(()=>{timer=setTimeout(transitionDone,duration+17);set$9(element,timerAttr,timer);});};var startTransitioning=(element,transition)=>{add$1(element,transition.classes);getOpt(element,timerAttr).each(timerId=>{clearTimeout(parseInt(timerId,10));remove$7(element,timerAttr);});setupTransitionListeners(element,transition);};var applyTransitionCss=(element,origin,position,transition,decision,lastPlacement)=>{var shouldTransition=shouldApplyTransitionCss(transition,decision,lastPlacement);if(shouldTransition||isTransitioning$1(element,transition)){set$8(element,'position',position.position);var _rect=toBox(origin,element);var intermediatePosition=reposition(origin,_objectSpread(_objectSpread({},decision),{},{rect:_rect}));var intermediateCssOptions=mapToObject(properties,prop=>intermediatePosition[prop]);if(hasChanges(position,intermediateCssOptions)){setOptions(element,intermediateCssOptions);if(shouldTransition){startTransitioning(element,transition);}reflow(element);}}else{remove$1(element,transition.classes);}};var elementSize=p=>({width:getOuter$1(p),height:getOuter$2(p)});var layout=(anchorBox,element,bubbles,options)=>{remove$6(element,'max-height');remove$6(element,'max-width');var elementBox=elementSize(element);return attempts(element,options.preference,anchorBox,elementBox,bubbles,options.bounds);};var setClasses=(element,decision)=>{var classInfo=decision.classes;remove$1(element,classInfo.off);add$1(element,classInfo.on);};var setHeight=(element,decision,options)=>{var maxHeightFunction=options.maxHeightFunction;maxHeightFunction(element,decision.maxHeight);};var setWidth=(element,decision,options)=>{var maxWidthFunction=options.maxWidthFunction;maxWidthFunction(element,decision.maxWidth);};var position$2=(element,decision,options)=>{var positionCss=reposition(options.origin,decision);options.transition.each(transition=>{applyTransitionCss(element,options.origin,positionCss,transition,decision,options.lastPlacement);});applyPositionCss(element,positionCss);};var setPlacement=(element,decision)=>{setPlacement$1(element,decision.placement);};var setMaxHeight=(element,maxHeight)=>{setMax$1(element,Math.floor(maxHeight));};var anchored=constant$1((element,available)=>{setMaxHeight(element,available);setAll(element,{'overflow-x':'hidden','overflow-y':'auto'});});var expandable$1=constant$1((element,available)=>{setMaxHeight(element,available);});var defaultOr=(options,key,dephault)=>options[key]===undefined?dephault:options[key];var simple=(anchor,element,bubble,layouts,lastPlacement,optBounds,overrideOptions,transition)=>{var maxHeightFunction=defaultOr(overrideOptions,'maxHeightFunction',anchored());var maxWidthFunction=defaultOr(overrideOptions,'maxWidthFunction',noop);var anchorBox=anchor.anchorBox;var origin=anchor.origin;var options={bounds:viewport(origin,optBounds),origin,preference:layouts,maxHeightFunction,maxWidthFunction,lastPlacement,transition};return go(anchorBox,element,bubble,options);};var go=(anchorBox,element,bubble,options)=>{var decision=layout(anchorBox,element,bubble,options);position$2(element,decision,options);setPlacement(element,decision);setClasses(element,decision);setHeight(element,decision,options);setWidth(element,decision,options);return{layout:decision.layout,placement:decision.placement};};var allAlignments=['valignCentre','alignLeft','alignRight','alignCentre','top','bottom','left','right','inset'];var nu$5=function nu$5(xOffset,yOffset,classes){var insetModifier=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var insetXOffset=xOffset*insetModifier;var insetYOffset=yOffset*insetModifier;var getClasses=prop=>get$g(classes,prop).getOr([]);var make=(xDelta,yDelta,alignmentsOn)=>{var alignmentsOff=difference(allAlignments,alignmentsOn);return{offset:SugarPosition(xDelta,yDelta),classesOn:bind$3(alignmentsOn,getClasses),classesOff:bind$3(alignmentsOff,getClasses)};};return{southeast:()=>make(-xOffset,yOffset,['top','alignLeft']),southwest:()=>make(xOffset,yOffset,['top','alignRight']),south:()=>make(-xOffset/2,yOffset,['top','alignCentre']),northeast:()=>make(-xOffset,-yOffset,['bottom','alignLeft']),northwest:()=>make(xOffset,-yOffset,['bottom','alignRight']),north:()=>make(-xOffset/2,-yOffset,['bottom','alignCentre']),east:()=>make(xOffset,-yOffset/2,['valignCentre','left']),west:()=>make(-xOffset,-yOffset/2,['valignCentre','right']),insetNortheast:()=>make(insetXOffset,insetYOffset,['top','alignLeft','inset']),insetNorthwest:()=>make(-insetXOffset,insetYOffset,['top','alignRight','inset']),insetNorth:()=>make(-insetXOffset/2,insetYOffset,['top','alignCentre','inset']),insetSoutheast:()=>make(insetXOffset,-insetYOffset,['bottom','alignLeft','inset']),insetSouthwest:()=>make(-insetXOffset,-insetYOffset,['bottom','alignRight','inset']),insetSouth:()=>make(-insetXOffset/2,-insetYOffset,['bottom','alignCentre','inset']),insetEast:()=>make(-insetXOffset,-insetYOffset/2,['valignCentre','right','inset']),insetWest:()=>make(insetXOffset,-insetYOffset/2,['valignCentre','left','inset'])};};var fallback=()=>nu$5(0,0,{});var nu$4=identity;var onDirection=(isLtr,isRtl)=>element=>getDirection(element)==='rtl'?isRtl:isLtr;var getDirection=element=>get$e(element,'direction')==='rtl'?'rtl':'ltr';var AttributeValue;(function(AttributeValue){AttributeValue['TopToBottom']='toptobottom';AttributeValue['BottomToTop']='bottomtotop';})(AttributeValue||(AttributeValue={}));var Attribute='data-alloy-vertical-dir';var isBottomToTopDir=el=>closest$2(el,current=>isElement$1(current)&&get$f(current,'data-alloy-vertical-dir')===AttributeValue.BottomToTop);var schema$y=()=>optionObjOf('layouts',[required$1('onLtr'),required$1('onRtl'),option$3('onBottomLtr'),option$3('onBottomRtl')]);var get$5=(elem,info,defaultLtr,defaultRtl,defaultBottomLtr,defaultBottomRtl,dirElement)=>{var isBottomToTop=dirElement.map(isBottomToTopDir).getOr(false);var customLtr=info.layouts.map(ls=>ls.onLtr(elem));var customRtl=info.layouts.map(ls=>ls.onRtl(elem));var ltr=isBottomToTop?info.layouts.bind(ls=>ls.onBottomLtr.map(f=>f(elem))).or(customLtr).getOr(defaultBottomLtr):customLtr.getOr(defaultLtr);var rtl=isBottomToTop?info.layouts.bind(ls=>ls.onBottomRtl.map(f=>f(elem))).or(customRtl).getOr(defaultBottomRtl):customRtl.getOr(defaultRtl);var f=onDirection(ltr,rtl);return f(elem);};var placement$4=(component,anchorInfo,origin)=>{var hotspot=anchorInfo.hotspot;var anchorBox=toBox(origin,hotspot.element);var layouts=get$5(component.element,anchorInfo,belowOrAbove(),belowOrAboveRtl(),aboveOrBelow(),aboveOrBelowRtl(),Optional.some(anchorInfo.hotspot.element));return Optional.some(nu$4({anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts}));};var HotspotAnchor=[required$1('hotspot'),option$3('bubble'),defaulted('overrides',{}),schema$y(),output$1('placement',placement$4)];var placement$3=(component,anchorInfo,origin)=>{var pos=translate$2(origin,anchorInfo.x,anchorInfo.y);var anchorBox=bounds(pos.left,pos.top,anchorInfo.width,anchorInfo.height);var layouts=get$5(component.element,anchorInfo,all$1(),allRtl$1(),all$1(),allRtl$1(),Optional.none());return Optional.some(nu$4({anchorBox,bubble:anchorInfo.bubble,overrides:anchorInfo.overrides,layouts}));};var MakeshiftAnchor=[required$1('x'),required$1('y'),defaulted('height',0),defaulted('width',0),defaulted('bubble',fallback()),defaulted('overrides',{}),schema$y(),output$1('placement',placement$3)];var adt$7=Adt.generate([{screen:['point']},{absolute:['point','scrollLeft','scrollTop']}]);var toFixed=pos=>pos.fold(identity,(point,scrollLeft,scrollTop)=>point.translate(-scrollLeft,-scrollTop));var toAbsolute=pos=>pos.fold(identity,identity);var sum=points=>foldl(points,(b,a)=>b.translate(a.left,a.top),SugarPosition(0,0));var sumAsFixed=positions=>{var points=map$2(positions,toFixed);return sum(points);};var sumAsAbsolute=positions=>{var points=map$2(positions,toAbsolute);return sum(points);};var screen=adt$7.screen;var absolute$1=adt$7.absolute;var getOffset=(component,origin,anchorInfo)=>{var win=defaultView(anchorInfo.root).dom;var hasSameOwner=frame=>{var frameOwner=owner$4(frame);var compOwner=owner$4(component.element);return eq(frameOwner,compOwner);};return Optional.from(win.frameElement).map(SugarElement.fromDom).filter(hasSameOwner).map(absolute$3);};var getRootPoint=(component,origin,anchorInfo)=>{var doc=owner$4(component.element);var outerScroll=get$b(doc);var offset=getOffset(component,origin,anchorInfo).getOr(outerScroll);return absolute$1(offset,outerScroll.left,outerScroll.top);};var getBox=(left,top,width,height)=>{var point=screen(SugarPosition(left,top));return Optional.some(pointed(point,width,height));};var calcNewAnchor=(optBox,rootPoint,anchorInfo,origin,elem)=>optBox.map(box=>{var points=[rootPoint,box.point];var topLeft=cata$1(origin,()=>sumAsAbsolute(points),()=>sumAsAbsolute(points),()=>sumAsFixed(points));var anchorBox=rect(topLeft.left,topLeft.top,box.width,box.height);var layoutsLtr=anchorInfo.showAbove?aboveOrBelow():belowOrAbove();var layoutsRtl=anchorInfo.showAbove?aboveOrBelowRtl():belowOrAboveRtl();var layouts=get$5(elem,anchorInfo,layoutsLtr,layoutsRtl,layoutsLtr,layoutsRtl,Optional.none());return nu$4({anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts});});var placement$2=(component,anchorInfo,origin)=>{var rootPoint=getRootPoint(component,origin,anchorInfo);return anchorInfo.node.filter(inBody).bind(target=>{var rect=target.dom.getBoundingClientRect();var nodeBox=getBox(rect.left,rect.top,rect.width,rect.height);var elem=anchorInfo.node.getOr(component.element);return calcNewAnchor(nodeBox,rootPoint,anchorInfo,origin,elem);});};var NodeAnchor=[required$1('node'),required$1('root'),option$3('bubble'),schema$y(),defaulted('overrides',{}),defaulted('showAbove',false),output$1('placement',placement$2)];var zeroWidth='\\uFEFF';var nbsp='\\xA0';var create$3=(start,soffset,finish,foffset)=>({start,soffset,finish,foffset});var SimRange={create:create$3};var adt$6=Adt.generate([{before:['element']},{on:['element','offset']},{after:['element']}]);var cata=(subject,onBefore,onOn,onAfter)=>subject.fold(onBefore,onOn,onAfter);var getStart$1=situ=>situ.fold(identity,identity,identity);var before=adt$6.before;var on$1=adt$6.on;var after$1=adt$6.after;var Situ={before,on:on$1,after:after$1,cata,getStart:getStart$1};var adt$5=Adt.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var exactFromRange=simRange=>adt$5.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset);var getStart=selection=>selection.match({domRange:rng=>SugarElement.fromDom(rng.startContainer),relative:(startSitu,_finishSitu)=>Situ.getStart(startSitu),exact:(start,_soffset,_finish,_foffset)=>start});var domRange=adt$5.domRange;var relative=adt$5.relative;var exact=adt$5.exact;var getWin=selection=>{var start=getStart(selection);return defaultView(start);};var range$1=SimRange.create;var SimSelection={domRange,relative,exact,exactFromRange,getWin,range:range$1};var setStart=(rng,situ)=>{situ.fold(e=>{rng.setStartBefore(e.dom);},(e,o)=>{rng.setStart(e.dom,o);},e=>{rng.setStartAfter(e.dom);});};var setFinish=(rng,situ)=>{situ.fold(e=>{rng.setEndBefore(e.dom);},(e,o)=>{rng.setEnd(e.dom,o);},e=>{rng.setEndAfter(e.dom);});};var relativeToNative=(win,startSitu,finishSitu)=>{var range=win.document.createRange();setStart(range,startSitu);setFinish(range,finishSitu);return range;};var exactToNative=(win,start,soffset,finish,foffset)=>{var rng=win.document.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;};var toRect=rect=>({left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height});var getFirstRect$1=rng=>{var rects=rng.getClientRects();var rect=rects.length>0?rects[0]:rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none();};var getBounds$2=rng=>{var rect=rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none();};var adt$4=Adt.generate([{ltr:['start','soffset','finish','foffset']},{rtl:['start','soffset','finish','foffset']}]);var fromRange=(win,type,range)=>type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset);var getRanges=(win,selection)=>selection.match({domRange:rng=>{return{ltr:constant$1(rng),rtl:Optional.none};},relative:(startSitu,finishSitu)=>{return{ltr:cached(()=>relativeToNative(win,startSitu,finishSitu)),rtl:cached(()=>Optional.some(relativeToNative(win,finishSitu,startSitu)))};},exact:(start,soffset,finish,foffset)=>{return{ltr:cached(()=>exactToNative(win,start,soffset,finish,foffset)),rtl:cached(()=>Optional.some(exactToNative(win,finish,foffset,start,soffset)))};}});var doDiagnose=(win,ranges)=>{var rng=ranges.ltr();if(rng.collapsed){var reversed=ranges.rtl().filter(rev=>rev.collapsed===false);return reversed.map(rev=>adt$4.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)).getOrThunk(()=>fromRange(win,adt$4.ltr,rng));}else{return fromRange(win,adt$4.ltr,rng);}};var diagnose=(win,selection)=>{var ranges=getRanges(win,selection);return doDiagnose(win,ranges);};var asLtrRange=(win,selection)=>{var diagnosis=diagnose(win,selection);return diagnosis.match({ltr:(start,soffset,finish,foffset)=>{var rng=win.document.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;},rtl:(start,soffset,finish,foffset)=>{var rng=win.document.createRange();rng.setStart(finish.dom,foffset);rng.setEnd(start.dom,soffset);return rng;}});};adt$4.ltr;adt$4.rtl;var ancestors=(scope,predicate,isRoot)=>filter$2(parents(scope,isRoot),predicate);var descendants=(scope,selector)=>all$3(selector,scope);var makeRange=(start,soffset,finish,foffset)=>{var doc=owner$4(start);var rng=doc.dom.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;};var after=(start,soffset,finish,foffset)=>{var r=makeRange(start,soffset,finish,foffset);var same=eq(start,finish)&&soffset===foffset;return r.collapsed&&!same;};var getNativeSelection=win=>Optional.from(win.getSelection());var readRange=selection=>{if(selection.rangeCount>0){var firstRng=selection.getRangeAt(0);var lastRng=selection.getRangeAt(selection.rangeCount-1);return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(lastRng.endContainer),lastRng.endOffset));}else{return Optional.none();}};var doGetExact=selection=>{if(selection.anchorNode===null||selection.focusNode===null){return readRange(selection);}else{var _anchor=SugarElement.fromDom(selection.anchorNode);var _focus=SugarElement.fromDom(selection.focusNode);return after(_anchor,selection.anchorOffset,_focus,selection.focusOffset)?Optional.some(SimRange.create(_anchor,selection.anchorOffset,_focus,selection.focusOffset)):readRange(selection);}};var getExact=win=>getNativeSelection(win).filter(sel=>sel.rangeCount>0).bind(doGetExact);var getFirstRect=(win,selection)=>{var rng=asLtrRange(win,selection);return getFirstRect$1(rng);};var getBounds$1=(win,selection)=>{var rng=asLtrRange(win,selection);return getBounds$2(rng);};var NodeValue=(is,name)=>{var get=element=>{if(!is(element)){throw new Error('Can only get '+name+' value of a '+name+' node');}return getOption(element).getOr('');};var getOption=element=>is(element)?Optional.from(element.dom.nodeValue):Optional.none();var set=(element,value)=>{if(!is(element)){throw new Error('Can only set raw '+name+' value of a '+name+' node');}element.dom.nodeValue=value;};return{get,getOption,set};};var api=NodeValue(isText,'text');var get$4=element=>api.get(element);var point=(element,offset)=>({element,offset});var descendOnce$1=(element,offset)=>{var children$1=children(element);if(children$1.length===0){return point(element,offset);}else if(offset<children$1.length){return point(children$1[offset],0);}else{var _last=children$1[children$1.length-1];var len=isText(_last)?get$4(_last).length:children(_last).length;return point(_last,len);}};var descendOnce=(element,offset)=>isText(element)?point(element,offset):descendOnce$1(element,offset);var isSimRange=detail=>detail.foffset!==undefined;var getAnchorSelection=(win,anchorInfo)=>{var getSelection=anchorInfo.getSelection.getOrThunk(()=>()=>getExact(win));return getSelection().map(sel=>{if(isSimRange(sel)){var modStart=descendOnce(sel.start,sel.soffset);var modFinish=descendOnce(sel.finish,sel.foffset);return SimSelection.range(modStart.element,modStart.offset,modFinish.element,modFinish.offset);}else{return sel;}});};var placement$1=(component,anchorInfo,origin)=>{var win=defaultView(anchorInfo.root).dom;var rootPoint=getRootPoint(component,origin,anchorInfo);var selectionBox=getAnchorSelection(win,anchorInfo).bind(sel=>{if(isSimRange(sel)){var optRect=getBounds$1(win,SimSelection.exactFromRange(sel)).orThunk(()=>{var zeroWidth$1=SugarElement.fromText(zeroWidth);before$1(sel.start,zeroWidth$1);var rect=getFirstRect(win,SimSelection.exact(zeroWidth$1,0,zeroWidth$1,1));remove$5(zeroWidth$1);return rect;});return optRect.bind(rawRect=>{return getBox(rawRect.left,rawRect.top,rawRect.width,rawRect.height);});}else{var selectionRect=map$1(sel,cell=>cell.dom.getBoundingClientRect());var _bounds={left:Math.min(selectionRect.firstCell.left,selectionRect.lastCell.left),right:Math.max(selectionRect.firstCell.right,selectionRect.lastCell.right),top:Math.min(selectionRect.firstCell.top,selectionRect.lastCell.top),bottom:Math.max(selectionRect.firstCell.bottom,selectionRect.lastCell.bottom)};return getBox(_bounds.left,_bounds.top,_bounds.right-_bounds.left,_bounds.bottom-_bounds.top);}});var targetElement=getAnchorSelection(win,anchorInfo).bind(sel=>{if(isSimRange(sel)){return isElement$1(sel.start)?Optional.some(sel.start):parentElement(sel.start);}else{return Optional.some(sel.firstCell);}});var elem=targetElement.getOr(component.element);return calcNewAnchor(selectionBox,rootPoint,anchorInfo,origin,elem);};var SelectionAnchor=[option$3('getSelection'),required$1('root'),option$3('bubble'),schema$y(),defaulted('overrides',{}),defaulted('showAbove',false),output$1('placement',placement$1)];var labelPrefix$1='link-layout';var eastX=anchor=>anchor.x+anchor.width;var westX=(anchor,element)=>anchor.x-element.width;var northY$1=(anchor,element)=>anchor.y-element.height+anchor.height;var southY$1=anchor=>anchor.y;var southeast$1=(anchor,element,bubbles)=>nu$6(eastX(anchor),southY$1(anchor),bubbles.southeast(),southeast$3(),'southeast',boundsRestriction(anchor,{left:0,top:2}),labelPrefix$1);var southwest$1=(anchor,element,bubbles)=>nu$6(westX(anchor,element),southY$1(anchor),bubbles.southwest(),southwest$3(),'southwest',boundsRestriction(anchor,{right:1,top:2}),labelPrefix$1);var northeast$1=(anchor,element,bubbles)=>nu$6(eastX(anchor),northY$1(anchor,element),bubbles.northeast(),northeast$3(),'northeast',boundsRestriction(anchor,{left:0,bottom:3}),labelPrefix$1);var northwest$1=(anchor,element,bubbles)=>nu$6(westX(anchor,element),northY$1(anchor,element),bubbles.northwest(),northwest$3(),'northwest',boundsRestriction(anchor,{right:1,bottom:3}),labelPrefix$1);var all=()=>[southeast$1,southwest$1,northeast$1,northwest$1];var allRtl=()=>[southwest$1,southeast$1,northwest$1,northeast$1];var placement=(component,submenuInfo,origin)=>{var anchorBox=toBox(origin,submenuInfo.item.element);var layouts=get$5(component.element,submenuInfo,all(),allRtl(),all(),allRtl(),Optional.none());return Optional.some(nu$4({anchorBox,bubble:fallback(),overrides:submenuInfo.overrides,layouts}));};var SubmenuAnchor=[required$1('item'),schema$y(),defaulted('overrides',{}),output$1('placement',placement)];var AnchorSchema=choose$1('type',{selection:SelectionAnchor,node:NodeAnchor,hotspot:HotspotAnchor,submenu:SubmenuAnchor,makeshift:MakeshiftAnchor});var TransitionSchema=[requiredArrayOf('classes',string),defaultedStringEnum('mode','all',['all','layout','placement'])];var PositionSchema=[defaulted('useFixed',never),option$3('getBounds')];var PlacementSchema=[requiredOf('anchor',AnchorSchema),optionObjOf('transition',TransitionSchema)];var getFixedOrigin=()=>{var html=document.documentElement;return fixed$1(0,0,html.clientWidth,html.clientHeight);};var getRelativeOrigin=component=>{var position=absolute$3(component.element);var bounds=component.element.dom.getBoundingClientRect();return relative$1(position.left,position.top,bounds.width,bounds.height);};var place=(origin,anchoring,optBounds,placee,lastPlace,transition)=>{var anchor=box(anchoring.anchorBox,origin);return simple(anchor,placee.element,anchoring.bubble,anchoring.layouts,lastPlace,optBounds,anchoring.overrides,transition);};var position$1=(component,posConfig,posState,placee,placementSpec)=>{var optWithinBounds=Optional.none();positionWithinBounds(component,posConfig,posState,placee,placementSpec,optWithinBounds);};var positionWithinBounds=(component,posConfig,posState,placee,placementSpec,optWithinBounds)=>{var placeeDetail=asRawOrDie$1('placement.info',objOf(PlacementSchema),placementSpec);var anchorage=placeeDetail.anchor;var element=placee.element;var placeeState=posState.get(placee.uid);preserve$1(()=>{set$8(element,'position','fixed');var oldVisibility=getRaw(element,'visibility');set$8(element,'visibility','hidden');var origin=posConfig.useFixed()?getFixedOrigin():getRelativeOrigin(component);anchorage.placement(component,anchorage,origin).each(anchoring=>{var optBounds=optWithinBounds.orThunk(()=>posConfig.getBounds.map(apply$1));var newState=place(origin,anchoring,optBounds,placee,placeeState,placeeDetail.transition);posState.set(placee.uid,newState);});oldVisibility.fold(()=>{remove$6(element,'visibility');},vis=>{set$8(element,'visibility',vis);});if(getRaw(element,'left').isNone()&&getRaw(element,'top').isNone()&&getRaw(element,'right').isNone()&&getRaw(element,'bottom').isNone()&&is$1(getRaw(element,'position'),'fixed')){remove$6(element,'position');}},element);};var getMode=(component,pConfig,_pState)=>pConfig.useFixed()?'fixed':'absolute';var reset$1=(component,pConfig,posState,placee)=>{var element=placee.element;each$1(['position','left','right','top','bottom'],prop=>remove$6(element,prop));reset$2(element);posState.clear(placee.uid);};var PositionApis=/*#__PURE__*/Object.freeze({__proto__:null,position:position$1,positionWithinBounds:positionWithinBounds,getMode:getMode,reset:reset$1});var init$g=()=>{var state={};var set=(id,data)=>{state[id]=data;};var get=id=>get$g(state,id);var clear=id=>{if(isNonNullable(id)){delete state[id];}else{state={};}};return nu$8({readState:()=>state,clear,set,get});};var PositioningState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$g});var Positioning=create$4({fields:PositionSchema,name:'positioning',active:ActivePosition,apis:PositionApis,state:PositioningState});var isConnected=comp=>comp.getSystem().isConnected();var fireDetaching=component=>{emit(component,detachedFromDom());var children=component.components();each$1(children,fireDetaching);};var fireAttaching=component=>{var children=component.components();each$1(children,fireAttaching);emit(component,attachedToDom());};var virtualAttach=(parent,child)=>{parent.getSystem().addToWorld(child);if(inBody(parent.element)){fireAttaching(child);}};var virtualDetach=comp=>{fireDetaching(comp);comp.getSystem().removeFromWorld(comp);};var attach$1=(parent,child)=>{append$2(parent.element,child.element);};var detachChildren$1=component=>{each$1(component.components(),childComp=>remove$5(childComp.element));empty(component.element);component.syncComponents();};var replaceChildren=(component,newSpecs,buildNewChildren)=>{var subs=component.components();detachChildren$1(component);var newChildren=buildNewChildren(newSpecs);var deleted=difference(subs,newChildren);each$1(deleted,comp=>{fireDetaching(comp);component.getSystem().removeFromWorld(comp);});each$1(newChildren,childComp=>{if(!isConnected(childComp)){component.getSystem().addToWorld(childComp);attach$1(component,childComp);if(inBody(component.element)){fireAttaching(childComp);}}else{attach$1(component,childComp);}});component.syncComponents();};var virtualReplaceChildren=(component,newSpecs,buildNewChildren)=>{var subs=component.components();var existingComps=bind$3(newSpecs,spec=>getPremade(spec).toArray());each$1(subs,childComp=>{if(!contains$2(existingComps,childComp)){virtualDetach(childComp);}});var newChildren=buildNewChildren(newSpecs);var deleted=difference(subs,newChildren);each$1(deleted,deletedComp=>{if(isConnected(deletedComp)){virtualDetach(deletedComp);}});each$1(newChildren,childComp=>{if(!isConnected(childComp)){virtualAttach(component,childComp);}});component.syncComponents();};var attach=(parent,child)=>{attachWith(parent,child,append$2);};var attachWith=(parent,child,insertion)=>{parent.getSystem().addToWorld(child);insertion(parent.element,child.element);if(inBody(parent.element)){fireAttaching(child);}parent.syncComponents();};var doDetach=component=>{fireDetaching(component);remove$5(component.element);component.getSystem().removeFromWorld(component);};var detach=component=>{var parent$1=parent(component.element).bind(p=>component.getSystem().getByDom(p).toOptional());doDetach(component);parent$1.each(p=>{p.syncComponents();});};var detachChildren=component=>{var subs=component.components();each$1(subs,doDetach);empty(component.element);component.syncComponents();};var attachSystem=(element,guiSystem)=>{attachSystemWith(element,guiSystem,append$2);};var attachSystemAfter=(element,guiSystem)=>{attachSystemWith(element,guiSystem,after$2);};var attachSystemWith=(element,guiSystem,inserter)=>{inserter(element,guiSystem.element);var children$1=children(guiSystem.element);each$1(children$1,child=>{guiSystem.getByDom(child).each(fireAttaching);});};var detachSystem=guiSystem=>{var children$1=children(guiSystem.element);each$1(children$1,child=>{guiSystem.getByDom(child).each(fireDetaching);});remove$5(guiSystem.element);};var rebuild=(sandbox,sConfig,sState,data)=>{sState.get().each(_data=>{detachChildren(sandbox);});var point=sConfig.getAttachPoint(sandbox);attach(point,sandbox);var built=sandbox.getSystem().build(data);attach(sandbox,built);sState.set(built);return built;};var open$1=(sandbox,sConfig,sState,data)=>{var newState=rebuild(sandbox,sConfig,sState,data);sConfig.onOpen(sandbox,newState);return newState;};var setContent=(sandbox,sConfig,sState,data)=>sState.get().map(()=>rebuild(sandbox,sConfig,sState,data));var openWhileCloaked=(sandbox,sConfig,sState,data,transaction)=>{cloak(sandbox,sConfig);open$1(sandbox,sConfig,sState,data);transaction();decloak(sandbox,sConfig);};var close$1=(sandbox,sConfig,sState)=>{sState.get().each(data=>{detachChildren(sandbox);detach(sandbox);sConfig.onClose(sandbox,data);sState.clear();});};var isOpen$1=(_sandbox,_sConfig,sState)=>sState.isOpen();var isPartOf=(sandbox,sConfig,sState,queryElem)=>isOpen$1(sandbox,sConfig,sState)&&sState.get().exists(data=>sConfig.isPartOf(sandbox,data,queryElem));var getState$2=(_sandbox,_sConfig,sState)=>sState.get();var store=(sandbox,cssKey,attr,newValue)=>{getRaw(sandbox.element,cssKey).fold(()=>{remove$7(sandbox.element,attr);},v=>{set$9(sandbox.element,attr,v);});set$8(sandbox.element,cssKey,newValue);};var restore=(sandbox,cssKey,attr)=>{getOpt(sandbox.element,attr).fold(()=>remove$6(sandbox.element,cssKey),oldValue=>set$8(sandbox.element,cssKey,oldValue));};var cloak=(sandbox,sConfig,_sState)=>{var sink=sConfig.getAttachPoint(sandbox);set$8(sandbox.element,'position',Positioning.getMode(sink));store(sandbox,'visibility',sConfig.cloakVisibilityAttr,'hidden');};var hasPosition=element=>exists(['top','left','right','bottom'],pos=>getRaw(element,pos).isSome());var decloak=(sandbox,sConfig,_sState)=>{if(!hasPosition(sandbox.element)){remove$6(sandbox.element,'position');}restore(sandbox,'visibility',sConfig.cloakVisibilityAttr);};var SandboxApis=/*#__PURE__*/Object.freeze({__proto__:null,cloak:cloak,decloak:decloak,open:open$1,openWhileCloaked:openWhileCloaked,close:close$1,isOpen:isOpen$1,isPartOf:isPartOf,getState:getState$2,setContent:setContent});var events$g=(sandboxConfig,sandboxState)=>derive$2([run$1(sandboxClose(),(sandbox,_simulatedEvent)=>{close$1(sandbox,sandboxConfig,sandboxState);})]);var ActiveSandbox=/*#__PURE__*/Object.freeze({__proto__:null,events:events$g});var SandboxSchema=[onHandler('onOpen'),onHandler('onClose'),required$1('isPartOf'),required$1('getAttachPoint'),defaulted('cloakVisibilityAttr','data-precloak-visibility')];var init$f=()=>{var contents=value$2();var readState=constant$1('not-implemented');return nu$8({readState,isOpen:contents.isSet,clear:contents.clear,set:contents.set,get:contents.get});};var SandboxState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$f});var Sandboxing=create$4({fields:SandboxSchema,name:'sandboxing',active:ActiveSandbox,apis:SandboxApis,state:SandboxState});var dismissPopups=constant$1('dismiss.popups');var repositionPopups=constant$1('reposition.popups');var mouseReleased=constant$1('mouse.released');var schema$x=objOfOnly([defaulted('isExtraPart',never),optionObjOf('fireEventInstead',[defaulted('event',dismissRequested())])]);var receivingChannel$1=rawSpec=>{var detail=asRawOrDie$1('Dismissal',schema$x,rawSpec);return{[dismissPopups()]:{schema:objOfOnly([required$1('target')]),onReceive:(sandbox,data)=>{if(Sandboxing.isOpen(sandbox)){var isPart=Sandboxing.isPartOf(sandbox,data.target)||detail.isExtraPart(sandbox,data.target);if(!isPart){detail.fireEventInstead.fold(()=>Sandboxing.close(sandbox),fe=>emit(sandbox,fe.event));}}}}};};var schema$w=objOfOnly([optionObjOf('fireEventInstead',[defaulted('event',repositionRequested())]),requiredFunction('doReposition')]);var receivingChannel=rawSpec=>{var detail=asRawOrDie$1('Reposition',schema$w,rawSpec);return{[repositionPopups()]:{onReceive:sandbox=>{if(Sandboxing.isOpen(sandbox)){detail.fireEventInstead.fold(()=>detail.doReposition(sandbox),fe=>emit(sandbox,fe.event));}}}};};var onLoad$5=(component,repConfig,repState)=>{repConfig.store.manager.onLoad(component,repConfig,repState);};var onUnload$2=(component,repConfig,repState)=>{repConfig.store.manager.onUnload(component,repConfig,repState);};var setValue$3=(component,repConfig,repState,data)=>{repConfig.store.manager.setValue(component,repConfig,repState,data);};var getValue$3=(component,repConfig,repState)=>repConfig.store.manager.getValue(component,repConfig,repState);var getState$1=(component,repConfig,repState)=>repState;var RepresentApis=/*#__PURE__*/Object.freeze({__proto__:null,onLoad:onLoad$5,onUnload:onUnload$2,setValue:setValue$3,getValue:getValue$3,getState:getState$1});var events$f=(repConfig,repState)=>{var es=repConfig.resetOnDom?[runOnAttached((comp,_se)=>{onLoad$5(comp,repConfig,repState);}),runOnDetached((comp,_se)=>{onUnload$2(comp,repConfig,repState);})]:[loadEvent(repConfig,repState,onLoad$5)];return derive$2(es);};var ActiveRepresenting=/*#__PURE__*/Object.freeze({__proto__:null,events:events$f});var memory$1=()=>{var data=Cell(null);var readState=()=>({mode:'memory',value:data.get()});var isNotSet=()=>data.get()===null;var clear=()=>{data.set(null);};return nu$8({set:data.set,get:data.get,isNotSet,clear,readState});};var manual=()=>{var readState=noop;return nu$8({readState});};var dataset=()=>{var dataByValue=Cell({});var dataByText=Cell({});var readState=()=>({mode:'dataset',dataByValue:dataByValue.get(),dataByText:dataByText.get()});var clear=()=>{dataByValue.set({});dataByText.set({});};var lookup=itemString=>get$g(dataByValue.get(),itemString).orThunk(()=>get$g(dataByText.get(),itemString));var update=items=>{var currentDataByValue=dataByValue.get();var currentDataByText=dataByText.get();var newDataByValue={};var newDataByText={};each$1(items,item=>{newDataByValue[item.value]=item;get$g(item,'meta').each(meta=>{get$g(meta,'text').each(text=>{newDataByText[text]=item;});});});dataByValue.set(_objectSpread(_objectSpread({},currentDataByValue),newDataByValue));dataByText.set(_objectSpread(_objectSpread({},currentDataByText),newDataByText));};return nu$8({readState,lookup,update,clear});};var init$e=spec=>spec.store.manager.state(spec);var RepresentState=/*#__PURE__*/Object.freeze({__proto__:null,memory:memory$1,dataset:dataset,manual:manual,init:init$e});var setValue$2=(component,repConfig,repState,data)=>{var store=repConfig.store;repState.update([data]);store.setValue(component,data);repConfig.onSetValue(component,data);};var getValue$2=(component,repConfig,repState)=>{var store=repConfig.store;var key=store.getDataKey(component);return repState.lookup(key).getOrThunk(()=>store.getFallbackEntry(key));};var onLoad$4=(component,repConfig,repState)=>{var store=repConfig.store;store.initialValue.each(data=>{setValue$2(component,repConfig,repState,data);});};var onUnload$1=(component,repConfig,repState)=>{repState.clear();};var DatasetStore=[option$3('initialValue'),required$1('getFallbackEntry'),required$1('getDataKey'),required$1('setValue'),output$1('manager',{setValue:setValue$2,getValue:getValue$2,onLoad:onLoad$4,onUnload:onUnload$1,state:dataset})];var getValue$1=(component,repConfig,_repState)=>repConfig.store.getValue(component);var setValue$1=(component,repConfig,_repState,data)=>{repConfig.store.setValue(component,data);repConfig.onSetValue(component,data);};var onLoad$3=(component,repConfig,_repState)=>{repConfig.store.initialValue.each(data=>{repConfig.store.setValue(component,data);});};var ManualStore=[required$1('getValue'),defaulted('setValue',noop),option$3('initialValue'),output$1('manager',{setValue:setValue$1,getValue:getValue$1,onLoad:onLoad$3,onUnload:noop,state:NoState.init})];var setValue=(component,repConfig,repState,data)=>{repState.set(data);repConfig.onSetValue(component,data);};var getValue=(component,repConfig,repState)=>repState.get();var onLoad$2=(component,repConfig,repState)=>{repConfig.store.initialValue.each(initVal=>{if(repState.isNotSet()){repState.set(initVal);}});};var onUnload=(component,repConfig,repState)=>{repState.clear();};var MemoryStore=[option$3('initialValue'),output$1('manager',{setValue,getValue,onLoad:onLoad$2,onUnload,state:memory$1})];var RepresentSchema=[defaultedOf('store',{mode:'memory'},choose$1('mode',{memory:MemoryStore,manual:ManualStore,dataset:DatasetStore})),onHandler('onSetValue'),defaulted('resetOnDom',false)];var Representing=create$4({fields:RepresentSchema,name:'representing',active:ActiveRepresenting,apis:RepresentApis,extra:{setValueFrom:(component,source)=>{var value=Representing.getValue(source);Representing.setValue(component,value);}},state:RepresentState});var field=(name,forbidden)=>defaultedObjOf(name,{},map$2(forbidden,f=>forbid(f.name(),'Cannot configure '+f.name()+' for '+name)).concat([customField('dump',identity)]));var get$3=data=>data.dump;var augment=(data,original)=>_objectSpread(_objectSpread({},derive$1(original)),data.dump);var SketchBehaviours={field,augment,get:get$3};var _placeholder='placeholder';var adt$3=Adt.generate([{single:['required','valueThunk']},{multiple:['required','valueThunks']}]);var isSubstituted=spec=>has$2(spec,'uiType');var subPlaceholder=(owner,detail,compSpec,placeholders)=>{if(owner.exists(o=>o!==compSpec.owner)){return adt$3.single(true,constant$1(compSpec));}return get$g(placeholders,compSpec.name).fold(()=>{throw new Error('Unknown placeholder component: '+compSpec.name+'\\nKnown: ['+keys(placeholders)+']\\nNamespace: '+owner.getOr('none')+'\\nSpec: '+JSON.stringify(compSpec,null,2));},newSpec=>newSpec.replace());};var scan=(owner,detail,compSpec,placeholders)=>{if(isSubstituted(compSpec)&&compSpec.uiType===_placeholder){return subPlaceholder(owner,detail,compSpec,placeholders);}else{return adt$3.single(false,constant$1(compSpec));}};var substitute=(owner,detail,compSpec,placeholders)=>{var base=scan(owner,detail,compSpec,placeholders);return base.fold((req,valueThunk)=>{var value=isSubstituted(compSpec)?valueThunk(detail,compSpec.config,compSpec.validated):valueThunk(detail);var childSpecs=get$g(value,'components').getOr([]);var substituted=bind$3(childSpecs,c=>substitute(owner,detail,c,placeholders));return[_objectSpread(_objectSpread({},value),{},{components:substituted})];},(req,valuesThunk)=>{if(isSubstituted(compSpec)){var _values=valuesThunk(detail,compSpec.config,compSpec.validated);var preprocessor=compSpec.validated.preprocess.getOr(identity);return preprocessor(_values);}else{return valuesThunk(detail);}});};var substituteAll=(owner,detail,components,placeholders)=>bind$3(components,c=>substitute(owner,detail,c,placeholders));var oneReplace=(label,replacements)=>{var called=false;var used=()=>called;var replace=()=>{if(called){throw new Error('Trying to use the same placeholder more than once: '+label);}called=true;return replacements;};var required=()=>replacements.fold((req,_)=>req,(req,_)=>req);return{name:constant$1(label),required,used,replace};};var substitutePlaces=(owner,detail,components,placeholders)=>{var ps=map$1(placeholders,(ph,name)=>oneReplace(name,ph));var outcome=substituteAll(owner,detail,components,ps);each(ps,p=>{if(p.used()===false&&p.required()){throw new Error('Placeholder: '+p.name()+' was not found in components list\\nNamespace: '+owner.getOr('none')+'\\nComponents: '+JSON.stringify(detail.components,null,2));}});return outcome;};var single$2=adt$3.single;var multiple=adt$3.multiple;var placeholder=constant$1(_placeholder);var adt$2=Adt.generate([{required:['data']},{external:['data']},{optional:['data']},{group:['data']}]);var fFactory=defaulted('factory',{sketch:identity});var fSchema=defaulted('schema',[]);var fName=required$1('name');var fPname=field$1('pname','pname',defaultedThunk(typeSpec=>'<alloy.'+generate$6(typeSpec.name)+'>'),anyValue());var fGroupSchema=customField('schema',()=>[option$3('preprocess')]);var fDefaults=defaulted('defaults',constant$1({}));var fOverrides=defaulted('overrides',constant$1({}));var requiredSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]);var externalSpec=objOf([fFactory,fSchema,fName,fDefaults,fOverrides]);var optionalSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]);var groupSpec=objOf([fFactory,fGroupSchema,fName,required$1('unit'),fPname,fDefaults,fOverrides]);var asNamedPart=part=>{return part.fold(Optional.some,Optional.none,Optional.some,Optional.some);};var name$2=part=>{var get=data=>data.name;return part.fold(get,get,get,get);};var asCommon=part=>{return part.fold(identity,identity,identity,identity);};var convert=(adtConstructor,partSchema)=>spec=>{var data=asRawOrDie$1('Converting part type',partSchema,spec);return adtConstructor(data);};var required=convert(adt$2.required,requiredSpec);var external=convert(adt$2.external,externalSpec);var optional=convert(adt$2.optional,optionalSpec);var group=convert(adt$2.group,groupSpec);var original=constant$1('entirety');var PartType=/*#__PURE__*/Object.freeze({__proto__:null,required:required,external:external,optional:optional,group:group,asNamedPart:asNamedPart,name:name$2,asCommon:asCommon,original:original});var combine=(detail,data,partSpec,partValidated)=>deepMerge(data.defaults(detail,partSpec,partValidated),partSpec,{uid:detail.partUids[data.name]},data.overrides(detail,partSpec,partValidated));var subs=(owner,detail,parts)=>{var internals={};var externals={};each$1(parts,part=>{part.fold(data=>{internals[data.pname]=single$2(true,(detail,partSpec,partValidated)=>data.factory.sketch(combine(detail,data,partSpec,partValidated)));},data=>{var partSpec=detail.parts[data.name];externals[data.name]=constant$1(data.factory.sketch(combine(detail,data,partSpec[original()]),partSpec));},data=>{internals[data.pname]=single$2(false,(detail,partSpec,partValidated)=>data.factory.sketch(combine(detail,data,partSpec,partValidated)));},data=>{internals[data.pname]=multiple(true,(detail,_partSpec,_partValidated)=>{var units=detail[data.name];return map$2(units,u=>data.factory.sketch(deepMerge(data.defaults(detail,u,_partValidated),u,data.overrides(detail,u))));});});});return{internals:constant$1(internals),externals:constant$1(externals)};};var generate$3=(owner,parts)=>{var r={};each$1(parts,part=>{asNamedPart(part).each(np=>{var g=doGenerateOne(owner,np.pname);r[np.name]=config=>{var validated=asRawOrDie$1('Part: '+np.name+' in '+owner,objOf(np.schema),config);return _objectSpread(_objectSpread({},g),{},{config,validated});};});});return r;};var doGenerateOne=(owner,pname)=>({uiType:placeholder(),owner,name:pname});var generateOne$1=(owner,pname,config)=>({uiType:placeholder(),owner,name:pname,config,validated:{}});var schemas=parts=>bind$3(parts,part=>part.fold(Optional.none,Optional.some,Optional.none,Optional.none).map(data=>requiredObjOf(data.name,data.schema.concat([snapshot(original())]))).toArray());var names=parts=>map$2(parts,name$2);var substitutes=(owner,detail,parts)=>subs(owner,detail,parts);var components$1=(owner,detail,internals)=>substitutePlaces(Optional.some(owner),detail,detail.components,internals);var getPart=(component,detail,partKey)=>{var uid=detail.partUids[partKey];return component.getSystem().getByUid(uid).toOptional();};var getPartOrDie=(component,detail,partKey)=>getPart(component,detail,partKey).getOrDie('Could not find part: '+partKey);var getParts=(component,detail,partKeys)=>{var r={};var uids=detail.partUids;var system=component.getSystem();each$1(partKeys,pk=>{r[pk]=constant$1(system.getByUid(uids[pk]));});return r;};var getAllParts=(component,detail)=>{var system=component.getSystem();return map$1(detail.partUids,(pUid,_k)=>constant$1(system.getByUid(pUid)));};var getAllPartNames=detail=>keys(detail.partUids);var getPartsOrDie=(component,detail,partKeys)=>{var r={};var uids=detail.partUids;var system=component.getSystem();each$1(partKeys,pk=>{r[pk]=constant$1(system.getByUid(uids[pk]).getOrDie());});return r;};var defaultUids=(baseUid,partTypes)=>{var partNames=names(partTypes);return wrapAll(map$2(partNames,pn=>({key:pn,value:baseUid+'-'+pn})));};var defaultUidsSchema=partTypes=>field$1('partUids','partUids',mergeWithThunk(spec=>defaultUids(spec.uid,partTypes)),anyValue());var AlloyParts=/*#__PURE__*/Object.freeze({__proto__:null,generate:generate$3,generateOne:generateOne$1,schemas:schemas,names:names,substitutes:substitutes,components:components$1,defaultUids:defaultUids,defaultUidsSchema:defaultUidsSchema,getAllParts:getAllParts,getAllPartNames:getAllPartNames,getPart:getPart,getPartOrDie:getPartOrDie,getParts:getParts,getPartsOrDie:getPartsOrDie});var base=(partSchemas,partUidsSchemas)=>{var ps=partSchemas.length>0?[requiredObjOf('parts',partSchemas)]:[];return ps.concat([required$1('uid'),defaulted('dom',{}),defaulted('components',[]),snapshot('originalSpec'),defaulted('debug.sketcher',{})]).concat(partUidsSchemas);};var asRawOrDie=(label,schema,spec,partSchemas,partUidsSchemas)=>{var baseS=base(partSchemas,partUidsSchemas);return asRawOrDie$1(label+' [SpecSchema]',objOfOnly(baseS.concat(schema)),spec);};var single$1=(owner,schema,factory,spec)=>{var specWithUid=supplyUid(spec);var detail=asRawOrDie(owner,schema,specWithUid,[],[]);return factory(detail,specWithUid);};var composite$1=(owner,schema,partTypes,factory,spec)=>{var specWithUid=supplyUid(spec);var partSchemas=schemas(partTypes);var partUidsSchema=defaultUidsSchema(partTypes);var detail=asRawOrDie(owner,schema,specWithUid,partSchemas,[partUidsSchema]);var subs=substitutes(owner,detail,partTypes);var components=components$1(owner,detail,subs.internals());return factory(detail,components,specWithUid,subs.externals());};var hasUid=spec=>has$2(spec,'uid');var supplyUid=spec=>{return hasUid(spec)?spec:_objectSpread(_objectSpread({},spec),{},{uid:generate$5('uid')});};var isSketchSpec=spec=>{return spec.uid!==undefined;};var singleSchema=objOfOnly([required$1('name'),required$1('factory'),required$1('configFields'),defaulted('apis',{}),defaulted('extraApis',{})]);var compositeSchema=objOfOnly([required$1('name'),required$1('factory'),required$1('configFields'),required$1('partFields'),defaulted('apis',{}),defaulted('extraApis',{})]);var single=rawConfig=>{var config=asRawOrDie$1('Sketcher for '+rawConfig.name,singleSchema,rawConfig);var sketch=spec=>single$1(config.name,config.configFields,config.factory,spec);var apis=map$1(config.apis,makeApi);var extraApis=map$1(config.extraApis,(f,k)=>markAsExtraApi(f,k));return _objectSpread(_objectSpread({name:config.name,configFields:config.configFields,sketch},apis),extraApis);};var composite=rawConfig=>{var config=asRawOrDie$1('Sketcher for '+rawConfig.name,compositeSchema,rawConfig);var sketch=spec=>composite$1(config.name,config.configFields,config.partFields,config.factory,spec);var parts=generate$3(config.name,config.partFields);var apis=map$1(config.apis,makeApi);var extraApis=map$1(config.extraApis,(f,k)=>markAsExtraApi(f,k));return _objectSpread(_objectSpread({name:config.name,partFields:config.partFields,configFields:config.configFields,sketch,parts},apis),extraApis);};var inside=target=>isTag('input')(target)&&get$f(target,'type')!=='radio'||isTag('textarea')(target);var getCurrent=(component,composeConfig,_composeState)=>composeConfig.find(component);var ComposeApis=/*#__PURE__*/Object.freeze({__proto__:null,getCurrent:getCurrent});var ComposeSchema=[required$1('find')];var Composing=create$4({fields:ComposeSchema,name:'composing',apis:ComposeApis});var nativeDisabled=['input','button','textarea','select'];var onLoad$1=(component,disableConfig,disableState)=>{var f=disableConfig.disabled()?disable:enable;f(component,disableConfig);};var hasNative=(component,config)=>config.useNative===true&&contains$2(nativeDisabled,name$3(component.element));var nativeIsDisabled=component=>has$1(component.element,'disabled');var nativeDisable=component=>{set$9(component.element,'disabled','disabled');};var nativeEnable=component=>{remove$7(component.element,'disabled');};var ariaIsDisabled=component=>get$f(component.element,'aria-disabled')==='true';var ariaDisable=component=>{set$9(component.element,'aria-disabled','true');};var ariaEnable=component=>{set$9(component.element,'aria-disabled','false');};var disable=(component,disableConfig,_disableState)=>{disableConfig.disableClass.each(disableClass=>{add$2(component.element,disableClass);});var f=hasNative(component,disableConfig)?nativeDisable:ariaDisable;f(component);disableConfig.onDisabled(component);};var enable=(component,disableConfig,_disableState)=>{disableConfig.disableClass.each(disableClass=>{remove$2(component.element,disableClass);});var f=hasNative(component,disableConfig)?nativeEnable:ariaEnable;f(component);disableConfig.onEnabled(component);};var isDisabled=(component,disableConfig)=>hasNative(component,disableConfig)?nativeIsDisabled(component):ariaIsDisabled(component);var set$4=(component,disableConfig,disableState,disabled)=>{var f=disabled?disable:enable;f(component,disableConfig);};var DisableApis=/*#__PURE__*/Object.freeze({__proto__:null,enable:enable,disable:disable,isDisabled:isDisabled,onLoad:onLoad$1,set:set$4});var exhibit$5=(base,disableConfig)=>nu$7({classes:disableConfig.disabled()?disableConfig.disableClass.toArray():[]});var events$e=(disableConfig,disableState)=>derive$2([abort(execute$5(),(component,_simulatedEvent)=>isDisabled(component,disableConfig)),loadEvent(disableConfig,disableState,onLoad$1)]);var ActiveDisable=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$5,events:events$e});var DisableSchema=[defaultedFunction('disabled',never),defaulted('useNative',true),option$3('disableClass'),onHandler('onDisabled'),onHandler('onEnabled')];var Disabling=create$4({fields:DisableSchema,name:'disabling',active:ActiveDisable,apis:DisableApis});var dehighlightAllExcept=(component,hConfig,hState,skip)=>{var highlighted=descendants(component.element,'.'+hConfig.highlightClass);each$1(highlighted,h=>{var shouldSkip=exists(skip,skipComp=>eq(skipComp.element,h));if(!shouldSkip){remove$2(h,hConfig.highlightClass);component.getSystem().getByDom(h).each(target=>{hConfig.onDehighlight(component,target);emit(target,dehighlight$1());});}});};var dehighlightAll=(component,hConfig,hState)=>dehighlightAllExcept(component,hConfig,hState,[]);var dehighlight=(component,hConfig,hState,target)=>{if(isHighlighted(component,hConfig,hState,target)){remove$2(target.element,hConfig.highlightClass);hConfig.onDehighlight(component,target);emit(target,dehighlight$1());}};var highlight=(component,hConfig,hState,target)=>{dehighlightAllExcept(component,hConfig,hState,[target]);if(!isHighlighted(component,hConfig,hState,target)){add$2(target.element,hConfig.highlightClass);hConfig.onHighlight(component,target);emit(target,highlight$1());}};var highlightFirst=(component,hConfig,hState)=>{getFirst(component,hConfig).each(firstComp=>{highlight(component,hConfig,hState,firstComp);});};var highlightLast=(component,hConfig,hState)=>{getLast(component,hConfig).each(lastComp=>{highlight(component,hConfig,hState,lastComp);});};var highlightAt=(component,hConfig,hState,index)=>{getByIndex(component,hConfig,hState,index).fold(err=>{throw err;},firstComp=>{highlight(component,hConfig,hState,firstComp);});};var highlightBy=(component,hConfig,hState,predicate)=>{var candidates=getCandidates(component,hConfig);var targetComp=find$5(candidates,predicate);targetComp.each(c=>{highlight(component,hConfig,hState,c);});};var isHighlighted=(component,hConfig,hState,queryTarget)=>has(queryTarget.element,hConfig.highlightClass);var getHighlighted=(component,hConfig,_hState)=>descendant(component.element,'.'+hConfig.highlightClass).bind(e=>component.getSystem().getByDom(e).toOptional());var getByIndex=(component,hConfig,hState,index)=>{var items=descendants(component.element,'.'+hConfig.itemClass);return Optional.from(items[index]).fold(()=>Result.error(new Error('No element found with index '+index)),component.getSystem().getByDom);};var getFirst=(component,hConfig,_hState)=>descendant(component.element,'.'+hConfig.itemClass).bind(e=>component.getSystem().getByDom(e).toOptional());var getLast=(component,hConfig,_hState)=>{var items=descendants(component.element,'.'+hConfig.itemClass);var last=items.length>0?Optional.some(items[items.length-1]):Optional.none();return last.bind(c=>component.getSystem().getByDom(c).toOptional());};var getDelta$2=(component,hConfig,hState,delta)=>{var items=descendants(component.element,'.'+hConfig.itemClass);var current=findIndex$1(items,item=>has(item,hConfig.highlightClass));return current.bind(selected=>{var dest=cycleBy(selected,delta,0,items.length-1);return component.getSystem().getByDom(items[dest]).toOptional();});};var getPrevious=(component,hConfig,hState)=>getDelta$2(component,hConfig,hState,-1);var getNext=(component,hConfig,hState)=>getDelta$2(component,hConfig,hState,+1);var getCandidates=(component,hConfig,_hState)=>{var items=descendants(component.element,'.'+hConfig.itemClass);return cat(map$2(items,i=>component.getSystem().getByDom(i).toOptional()));};var HighlightApis=/*#__PURE__*/Object.freeze({__proto__:null,dehighlightAll:dehighlightAll,dehighlight:dehighlight,highlight:highlight,highlightFirst:highlightFirst,highlightLast:highlightLast,highlightAt:highlightAt,highlightBy:highlightBy,isHighlighted:isHighlighted,getHighlighted:getHighlighted,getFirst:getFirst,getLast:getLast,getPrevious:getPrevious,getNext:getNext,getCandidates:getCandidates});var HighlightSchema=[required$1('highlightClass'),required$1('itemClass'),onHandler('onHighlight'),onHandler('onDehighlight')];var Highlighting=create$4({fields:HighlightSchema,name:'highlighting',apis:HighlightApis});var BACKSPACE=[8];var TAB=[9];var ENTER=[13];var ESCAPE=[27];var SPACE=[32];var LEFT=[37];var UP=[38];var RIGHT=[39];var DOWN=[40];var cyclePrev=(values,index,predicate)=>{var before=reverse(values.slice(0,index));var after=reverse(values.slice(index+1));return find$5(before.concat(after),predicate);};var tryPrev=(values,index,predicate)=>{var before=reverse(values.slice(0,index));return find$5(before,predicate);};var cycleNext=(values,index,predicate)=>{var before=values.slice(0,index);var after=values.slice(index+1);return find$5(after.concat(before),predicate);};var tryNext=(values,index,predicate)=>{var after=values.slice(index+1);return find$5(after,predicate);};var inSet=keys=>event=>{var raw=event.raw;return contains$2(keys,raw.which);};var and=preds=>event=>forall(preds,pred=>pred(event));var isShift=event=>{var raw=event.raw;return raw.shiftKey===true;};var isControl=event=>{var raw=event.raw;return raw.ctrlKey===true;};var isNotShift=not(isShift);var rule=(matches,action)=>({matches,classification:action});var choose=(transitions,event)=>{var transition=find$5(transitions,t=>t.matches(event));return transition.map(t=>t.classification);};var reportFocusShifting=(component,prevFocus,newFocus)=>{var noChange=prevFocus.exists(p=>newFocus.exists(n=>eq(n,p)));if(!noChange){emitWith(component,focusShifted(),{prevFocus,newFocus});}};var dom$2=()=>{var get=component=>search(component.element);var set=(component,focusee)=>{var prevFocus=get(component);component.getSystem().triggerFocus(focusee,component.element);var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus);};return{get,set};};var highlights=()=>{var get=component=>Highlighting.getHighlighted(component).map(item=>item.element);var set=(component,element)=>{var prevFocus=get(component);component.getSystem().getByDom(element).fold(noop,item=>{Highlighting.highlight(component,item);});var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus);};return{get,set};};var FocusInsideModes;(function(FocusInsideModes){FocusInsideModes['OnFocusMode']='onFocus';FocusInsideModes['OnEnterOrSpaceMode']='onEnterOrSpace';FocusInsideModes['OnApiMode']='onApi';})(FocusInsideModes||(FocusInsideModes={}));var typical=(infoSchema,stateInit,getKeydownRules,getKeyupRules,optFocusIn)=>{var schema=()=>infoSchema.concat([defaulted('focusManager',dom$2()),defaultedOf('focusInside','onFocus',valueOf(val=>contains$2(['onFocus','onEnterOrSpace','onApi'],val)?Result.value(val):Result.error('Invalid value for focusInside'))),output$1('handler',me),output$1('state',stateInit),output$1('sendFocusIn',optFocusIn)]);var processKey=(component,simulatedEvent,getRules,keyingConfig,keyingState)=>{var rules=getRules(component,simulatedEvent,keyingConfig,keyingState);return choose(rules,simulatedEvent.event).bind(rule=>rule(component,simulatedEvent,keyingConfig,keyingState));};var toEvents=(keyingConfig,keyingState)=>{var onFocusHandler=keyingConfig.focusInside!==FocusInsideModes.OnFocusMode?Optional.none():optFocusIn(keyingConfig).map(focusIn=>run$1(focus$4(),(component,simulatedEvent)=>{focusIn(component,keyingConfig,keyingState);simulatedEvent.stop();}));var tryGoInsideComponent=(component,simulatedEvent)=>{var isEnterOrSpace=inSet(SPACE.concat(ENTER))(simulatedEvent.event);if(keyingConfig.focusInside===FocusInsideModes.OnEnterOrSpaceMode&&isEnterOrSpace&&isSource(component,simulatedEvent)){optFocusIn(keyingConfig).each(focusIn=>{focusIn(component,keyingConfig,keyingState);simulatedEvent.stop();});}};var keyboardEvents=[run$1(keydown(),(component,simulatedEvent)=>{processKey(component,simulatedEvent,getKeydownRules,keyingConfig,keyingState).fold(()=>{tryGoInsideComponent(component,simulatedEvent);},_=>{simulatedEvent.stop();});}),run$1(keyup(),(component,simulatedEvent)=>{processKey(component,simulatedEvent,getKeyupRules,keyingConfig,keyingState).each(_=>{simulatedEvent.stop();});})];return derive$2(onFocusHandler.toArray().concat(keyboardEvents));};var me={schema,processKey,toEvents};return me;};var create$2=cyclicField=>{var schema=[option$3('onEscape'),option$3('onEnter'),defaulted('selector','[data-alloy-tabstop=\"true\"]:not(:disabled)'),defaulted('firstTabstop',0),defaulted('useTabstopAt',always),option$3('visibilitySelector')].concat([cyclicField]);var isVisible=(tabbingConfig,element)=>{var target=tabbingConfig.visibilitySelector.bind(sel=>closest$1(element,sel)).getOr(element);return get$d(target)>0;};var findInitial=(component,tabbingConfig)=>{var tabstops=descendants(component.element,tabbingConfig.selector);var visibles=filter$2(tabstops,elem=>isVisible(tabbingConfig,elem));return Optional.from(visibles[tabbingConfig.firstTabstop]);};var findCurrent=(component,tabbingConfig)=>tabbingConfig.focusManager.get(component).bind(elem=>closest$1(elem,tabbingConfig.selector));var isTabstop=(tabbingConfig,element)=>isVisible(tabbingConfig,element)&&tabbingConfig.useTabstopAt(element);var focusIn=(component,tabbingConfig,_tabbingState)=>{findInitial(component,tabbingConfig).each(target=>{tabbingConfig.focusManager.set(component,target);});};var goFromTabstop=(component,tabstops,stopIndex,tabbingConfig,cycle)=>cycle(tabstops,stopIndex,elem=>isTabstop(tabbingConfig,elem)).fold(()=>tabbingConfig.cyclic?Optional.some(true):Optional.none(),target=>{tabbingConfig.focusManager.set(component,target);return Optional.some(true);});var go=(component,_simulatedEvent,tabbingConfig,cycle)=>{var tabstops=descendants(component.element,tabbingConfig.selector);return findCurrent(component,tabbingConfig).bind(tabstop=>{var optStopIndex=findIndex$1(tabstops,curry(eq,tabstop));return optStopIndex.bind(stopIndex=>goFromTabstop(component,tabstops,stopIndex,tabbingConfig,cycle));});};var goBackwards=(component,simulatedEvent,tabbingConfig)=>{var navigate=tabbingConfig.cyclic?cyclePrev:tryPrev;return go(component,simulatedEvent,tabbingConfig,navigate);};var goForwards=(component,simulatedEvent,tabbingConfig)=>{var navigate=tabbingConfig.cyclic?cycleNext:tryNext;return go(component,simulatedEvent,tabbingConfig,navigate);};var isFirstChild=elem=>parentNode(elem).bind(firstChild).exists(child=>eq(child,elem));var goFromPseudoTabstop=(component,simulatedEvent,tabbingConfig)=>findCurrent(component,tabbingConfig).filter(elem=>!tabbingConfig.useTabstopAt(elem)).bind(elem=>(isFirstChild(elem)?goBackwards:goForwards)(component,simulatedEvent,tabbingConfig));var execute=(component,simulatedEvent,tabbingConfig)=>tabbingConfig.onEnter.bind(f=>f(component,simulatedEvent));var exit=(component,simulatedEvent,tabbingConfig)=>tabbingConfig.onEscape.bind(f=>f(component,simulatedEvent));var getKeydownRules=constant$1([rule(and([isShift,inSet(TAB)]),goBackwards),rule(inSet(TAB),goForwards),rule(and([isNotShift,inSet(ENTER)]),execute)]);var getKeyupRules=constant$1([rule(inSet(ESCAPE),exit),rule(inSet(TAB),goFromPseudoTabstop)]);return typical(schema,NoState.init,getKeydownRules,getKeyupRules,()=>Optional.some(focusIn));};var AcyclicType=create$2(customField('cyclic',never));var CyclicType=create$2(customField('cyclic',always));var doDefaultExecute=(component,_simulatedEvent,focused)=>{dispatch(component,focused,execute$5());return Optional.some(true);};var defaultExecute=(component,simulatedEvent,focused)=>{var isComplex=inside(focused)&&inSet(SPACE)(simulatedEvent.event);return isComplex?Optional.none():doDefaultExecute(component,simulatedEvent,focused);};var stopEventForFirefox=(_component,_simulatedEvent)=>Optional.some(true);var schema$v=[defaulted('execute',defaultExecute),defaulted('useSpace',false),defaulted('useEnter',true),defaulted('useControlEnter',false),defaulted('useDown',false)];var execute$4=(component,simulatedEvent,executeConfig)=>executeConfig.execute(component,simulatedEvent,component.element);var getKeydownRules$5=(component,_simulatedEvent,executeConfig,_executeState)=>{var spaceExec=executeConfig.useSpace&&!inside(component.element)?SPACE:[];var enterExec=executeConfig.useEnter?ENTER:[];var downExec=executeConfig.useDown?DOWN:[];var execKeys=spaceExec.concat(enterExec).concat(downExec);return[rule(inSet(execKeys),execute$4)].concat(executeConfig.useControlEnter?[rule(and([isControl,inSet(ENTER)]),execute$4)]:[]);};var getKeyupRules$5=(component,_simulatedEvent,executeConfig,_executeState)=>executeConfig.useSpace&&!inside(component.element)?[rule(inSet(SPACE),stopEventForFirefox)]:[];var ExecutionType=typical(schema$v,NoState.init,getKeydownRules$5,getKeyupRules$5,()=>Optional.none());var flatgrid$1=()=>{var dimensions=value$2();var setGridSize=(numRows,numColumns)=>{dimensions.set({numRows,numColumns});};var getNumRows=()=>dimensions.get().map(d=>d.numRows);var getNumColumns=()=>dimensions.get().map(d=>d.numColumns);return nu$8({readState:()=>dimensions.get().map(d=>({numRows:String(d.numRows),numColumns:String(d.numColumns)})).getOr({numRows:'?',numColumns:'?'}),setGridSize,getNumRows,getNumColumns});};var init$d=spec=>spec.state(spec);var KeyingState=/*#__PURE__*/Object.freeze({__proto__:null,flatgrid:flatgrid$1,init:init$d});var useH=movement=>(component,simulatedEvent,config,state)=>{var move=movement(component.element);return use(move,component,simulatedEvent,config,state);};var west$1=(moveLeft,moveRight)=>{var movement=onDirection(moveLeft,moveRight);return useH(movement);};var east$1=(moveLeft,moveRight)=>{var movement=onDirection(moveRight,moveLeft);return useH(movement);};var useV=move=>(component,simulatedEvent,config,state)=>use(move,component,simulatedEvent,config,state);var use=(move,component,simulatedEvent,config,state)=>{var outcome=config.focusManager.get(component).bind(focused=>move(component.element,focused,config,state));return outcome.map(newFocus=>{config.focusManager.set(component,newFocus);return true;});};var north$1=useV;var south$1=useV;var move$1=useV;var isHidden$1=dom=>dom.offsetWidth<=0&&dom.offsetHeight<=0;var isVisible=element=>!isHidden$1(element.dom);var locate=(candidates,predicate)=>findIndex$1(candidates,predicate).map(index=>({index,candidates}));var locateVisible=(container,current,selector)=>{var predicate=x=>eq(x,current);var candidates=descendants(container,selector);var visible=filter$2(candidates,isVisible);return locate(visible,predicate);};var findIndex=(elements,target)=>findIndex$1(elements,elem=>eq(target,elem));var withGrid=(values,index,numCols,f)=>{var oldRow=Math.floor(index/numCols);var oldColumn=index%numCols;return f(oldRow,oldColumn).bind(address=>{var newIndex=address.row*numCols+address.column;return newIndex>=0&&newIndex<values.length?Optional.some(values[newIndex]):Optional.none();});};var cycleHorizontal$1=(values,index,numRows,numCols,delta)=>withGrid(values,index,numCols,(oldRow,oldColumn)=>{var onLastRow=oldRow===numRows-1;var colsInRow=onLastRow?values.length-oldRow*numCols:numCols;var newColumn=cycleBy(oldColumn,delta,0,colsInRow-1);return Optional.some({row:oldRow,column:newColumn});});var cycleVertical$1=(values,index,numRows,numCols,delta)=>withGrid(values,index,numCols,(oldRow,oldColumn)=>{var newRow=cycleBy(oldRow,delta,0,numRows-1);var onLastRow=newRow===numRows-1;var colsInRow=onLastRow?values.length-newRow*numCols:numCols;var newCol=clamp(oldColumn,0,colsInRow-1);return Optional.some({row:newRow,column:newCol});});var cycleRight$1=(values,index,numRows,numCols)=>cycleHorizontal$1(values,index,numRows,numCols,+1);var cycleLeft$1=(values,index,numRows,numCols)=>cycleHorizontal$1(values,index,numRows,numCols,-1);var cycleUp$1=(values,index,numRows,numCols)=>cycleVertical$1(values,index,numRows,numCols,-1);var cycleDown$1=(values,index,numRows,numCols)=>cycleVertical$1(values,index,numRows,numCols,+1);var schema$u=[required$1('selector'),defaulted('execute',defaultExecute),onKeyboardHandler('onEscape'),defaulted('captureTab',false),initSize()];var focusIn$3=(component,gridConfig,_gridState)=>{descendant(component.element,gridConfig.selector).each(first=>{gridConfig.focusManager.set(component,first);});};var findCurrent$1=(component,gridConfig)=>gridConfig.focusManager.get(component).bind(elem=>closest$1(elem,gridConfig.selector));var execute$3=(component,simulatedEvent,gridConfig,_gridState)=>findCurrent$1(component,gridConfig).bind(focused=>gridConfig.execute(component,simulatedEvent,focused));var doMove$2=cycle=>(element,focused,gridConfig,gridState)=>locateVisible(element,focused,gridConfig.selector).bind(identified=>cycle(identified.candidates,identified.index,gridState.getNumRows().getOr(gridConfig.initSize.numRows),gridState.getNumColumns().getOr(gridConfig.initSize.numColumns)));var handleTab=(_component,_simulatedEvent,gridConfig)=>gridConfig.captureTab?Optional.some(true):Optional.none();var doEscape$1=(component,simulatedEvent,gridConfig)=>gridConfig.onEscape(component,simulatedEvent);var moveLeft$3=doMove$2(cycleLeft$1);var moveRight$3=doMove$2(cycleRight$1);var moveNorth$1=doMove$2(cycleUp$1);var moveSouth$1=doMove$2(cycleDown$1);var getKeydownRules$4=constant$1([rule(inSet(LEFT),west$1(moveLeft$3,moveRight$3)),rule(inSet(RIGHT),east$1(moveLeft$3,moveRight$3)),rule(inSet(UP),north$1(moveNorth$1)),rule(inSet(DOWN),south$1(moveSouth$1)),rule(and([isShift,inSet(TAB)]),handleTab),rule(and([isNotShift,inSet(TAB)]),handleTab),rule(inSet(SPACE.concat(ENTER)),execute$3)]);var getKeyupRules$4=constant$1([rule(inSet(ESCAPE),doEscape$1),rule(inSet(SPACE),stopEventForFirefox)]);var FlatgridType=typical(schema$u,flatgrid$1,getKeydownRules$4,getKeyupRules$4,()=>Optional.some(focusIn$3));var f=(container,selector,current,delta,getNewIndex)=>{var isDisabledButton=candidate=>name$3(candidate)==='button'&&get$f(candidate,'disabled')==='disabled';var tryNewIndex=(initial,index,candidates)=>getNewIndex(initial,index,delta,0,candidates.length-1,candidates[index],newIndex=>isDisabledButton(candidates[newIndex])?tryNewIndex(initial,newIndex,candidates):Optional.from(candidates[newIndex]));return locateVisible(container,current,selector).bind(identified=>{var index=identified.index;var candidates=identified.candidates;return tryNewIndex(index,index,candidates);});};var horizontalWithoutCycles=(container,selector,current,delta)=>f(container,selector,current,delta,(prevIndex,v,d,min,max,oldCandidate,onNewIndex)=>{var newIndex=clamp(v+d,min,max);return newIndex===prevIndex?Optional.from(oldCandidate):onNewIndex(newIndex);});var horizontal=(container,selector,current,delta)=>f(container,selector,current,delta,(prevIndex,v,d,min,max,_oldCandidate,onNewIndex)=>{var newIndex=cycleBy(v,d,min,max);return newIndex===prevIndex?Optional.none():onNewIndex(newIndex);});var schema$t=[required$1('selector'),defaulted('getInitial',Optional.none),defaulted('execute',defaultExecute),onKeyboardHandler('onEscape'),defaulted('executeOnMove',false),defaulted('allowVertical',true),defaulted('allowHorizontal',true),defaulted('cycles',true)];var findCurrent=(component,flowConfig)=>flowConfig.focusManager.get(component).bind(elem=>closest$1(elem,flowConfig.selector));var execute$2=(component,simulatedEvent,flowConfig)=>findCurrent(component,flowConfig).bind(focused=>flowConfig.execute(component,simulatedEvent,focused));var focusIn$2=(component,flowConfig,_state)=>{flowConfig.getInitial(component).orThunk(()=>descendant(component.element,flowConfig.selector)).each(first=>{flowConfig.focusManager.set(component,first);});};var moveLeft$2=(element,focused,info)=>(info.cycles?horizontal:horizontalWithoutCycles)(element,info.selector,focused,-1);var moveRight$2=(element,focused,info)=>(info.cycles?horizontal:horizontalWithoutCycles)(element,info.selector,focused,+1);var doMove$1=movement=>(component,simulatedEvent,flowConfig,flowState)=>movement(component,simulatedEvent,flowConfig,flowState).bind(()=>flowConfig.executeOnMove?execute$2(component,simulatedEvent,flowConfig):Optional.some(true));var doEscape=(component,simulatedEvent,flowConfig)=>flowConfig.onEscape(component,simulatedEvent);var getKeydownRules$3=(_component,_se,flowConfig,_flowState)=>{var westMovers=[...(flowConfig.allowHorizontal?LEFT:[])].concat(flowConfig.allowVertical?UP:[]);var eastMovers=[...(flowConfig.allowHorizontal?RIGHT:[])].concat(flowConfig.allowVertical?DOWN:[]);return[rule(inSet(westMovers),doMove$1(west$1(moveLeft$2,moveRight$2))),rule(inSet(eastMovers),doMove$1(east$1(moveLeft$2,moveRight$2))),rule(inSet(ENTER),execute$2),rule(inSet(SPACE),execute$2)];};var getKeyupRules$3=constant$1([rule(inSet(SPACE),stopEventForFirefox),rule(inSet(ESCAPE),doEscape)]);var FlowType=typical(schema$t,NoState.init,getKeydownRules$3,getKeyupRules$3,()=>Optional.some(focusIn$2));var toCell=(matrix,rowIndex,columnIndex)=>Optional.from(matrix[rowIndex]).bind(row=>Optional.from(row[columnIndex]).map(cell=>({rowIndex,columnIndex,cell})));var cycleHorizontal=(matrix,rowIndex,startCol,deltaCol)=>{var row=matrix[rowIndex];var colsInRow=row.length;var newColIndex=cycleBy(startCol,deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex);};var cycleVertical=(matrix,colIndex,startRow,deltaRow)=>{var nextRowIndex=cycleBy(startRow,deltaRow,0,matrix.length-1);var colsInNextRow=matrix[nextRowIndex].length;var nextColIndex=clamp(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex);};var moveHorizontal=(matrix,rowIndex,startCol,deltaCol)=>{var row=matrix[rowIndex];var colsInRow=row.length;var newColIndex=clamp(startCol+deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex);};var moveVertical=(matrix,colIndex,startRow,deltaRow)=>{var nextRowIndex=clamp(startRow+deltaRow,0,matrix.length-1);var colsInNextRow=matrix[nextRowIndex].length;var nextColIndex=clamp(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex);};var cycleRight=(matrix,startRow,startCol)=>cycleHorizontal(matrix,startRow,startCol,+1);var cycleLeft=(matrix,startRow,startCol)=>cycleHorizontal(matrix,startRow,startCol,-1);var cycleUp=(matrix,startRow,startCol)=>cycleVertical(matrix,startCol,startRow,-1);var cycleDown=(matrix,startRow,startCol)=>cycleVertical(matrix,startCol,startRow,+1);var moveLeft$1=(matrix,startRow,startCol)=>moveHorizontal(matrix,startRow,startCol,-1);var moveRight$1=(matrix,startRow,startCol)=>moveHorizontal(matrix,startRow,startCol,+1);var moveUp$1=(matrix,startRow,startCol)=>moveVertical(matrix,startCol,startRow,-1);var moveDown$1=(matrix,startRow,startCol)=>moveVertical(matrix,startCol,startRow,+1);var schema$s=[requiredObjOf('selectors',[required$1('row'),required$1('cell')]),defaulted('cycles',true),defaulted('previousSelector',Optional.none),defaulted('execute',defaultExecute)];var focusIn$1=(component,matrixConfig,_state)=>{var focused=matrixConfig.previousSelector(component).orThunk(()=>{var selectors=matrixConfig.selectors;return descendant(component.element,selectors.cell);});focused.each(cell=>{matrixConfig.focusManager.set(component,cell);});};var execute$1=(component,simulatedEvent,matrixConfig)=>search(component.element).bind(focused=>matrixConfig.execute(component,simulatedEvent,focused));var toMatrix=(rows,matrixConfig)=>map$2(rows,row=>descendants(row,matrixConfig.selectors.cell));var doMove=(ifCycle,ifMove)=>(element,focused,matrixConfig)=>{var move=matrixConfig.cycles?ifCycle:ifMove;return closest$1(focused,matrixConfig.selectors.row).bind(inRow=>{var cellsInRow=descendants(inRow,matrixConfig.selectors.cell);return findIndex(cellsInRow,focused).bind(colIndex=>{var allRows=descendants(element,matrixConfig.selectors.row);return findIndex(allRows,inRow).bind(rowIndex=>{var matrix=toMatrix(allRows,matrixConfig);return move(matrix,rowIndex,colIndex).map(next=>next.cell);});});});};var moveLeft=doMove(cycleLeft,moveLeft$1);var moveRight=doMove(cycleRight,moveRight$1);var moveNorth=doMove(cycleUp,moveUp$1);var moveSouth=doMove(cycleDown,moveDown$1);var getKeydownRules$2=constant$1([rule(inSet(LEFT),west$1(moveLeft,moveRight)),rule(inSet(RIGHT),east$1(moveLeft,moveRight)),rule(inSet(UP),north$1(moveNorth)),rule(inSet(DOWN),south$1(moveSouth)),rule(inSet(SPACE.concat(ENTER)),execute$1)]);var getKeyupRules$2=constant$1([rule(inSet(SPACE),stopEventForFirefox)]);var MatrixType=typical(schema$s,NoState.init,getKeydownRules$2,getKeyupRules$2,()=>Optional.some(focusIn$1));var schema$r=[required$1('selector'),defaulted('execute',defaultExecute),defaulted('moveOnTab',false)];var execute=(component,simulatedEvent,menuConfig)=>menuConfig.focusManager.get(component).bind(focused=>menuConfig.execute(component,simulatedEvent,focused));var focusIn=(component,menuConfig,_state)=>{descendant(component.element,menuConfig.selector).each(first=>{menuConfig.focusManager.set(component,first);});};var moveUp=(element,focused,info)=>horizontal(element,info.selector,focused,-1);var moveDown=(element,focused,info)=>horizontal(element,info.selector,focused,+1);var fireShiftTab=(component,simulatedEvent,menuConfig,menuState)=>menuConfig.moveOnTab?move$1(moveUp)(component,simulatedEvent,menuConfig,menuState):Optional.none();var fireTab=(component,simulatedEvent,menuConfig,menuState)=>menuConfig.moveOnTab?move$1(moveDown)(component,simulatedEvent,menuConfig,menuState):Optional.none();var getKeydownRules$1=constant$1([rule(inSet(UP),move$1(moveUp)),rule(inSet(DOWN),move$1(moveDown)),rule(and([isShift,inSet(TAB)]),fireShiftTab),rule(and([isNotShift,inSet(TAB)]),fireTab),rule(inSet(ENTER),execute),rule(inSet(SPACE),execute)]);var getKeyupRules$1=constant$1([rule(inSet(SPACE),stopEventForFirefox)]);var MenuType=typical(schema$r,NoState.init,getKeydownRules$1,getKeyupRules$1,()=>Optional.some(focusIn));var schema$q=[onKeyboardHandler('onSpace'),onKeyboardHandler('onEnter'),onKeyboardHandler('onShiftEnter'),onKeyboardHandler('onLeft'),onKeyboardHandler('onRight'),onKeyboardHandler('onTab'),onKeyboardHandler('onShiftTab'),onKeyboardHandler('onUp'),onKeyboardHandler('onDown'),onKeyboardHandler('onEscape'),defaulted('stopSpaceKeyup',false),option$3('focusIn')];var getKeydownRules=(component,simulatedEvent,specialInfo)=>[rule(inSet(SPACE),specialInfo.onSpace),rule(and([isNotShift,inSet(ENTER)]),specialInfo.onEnter),rule(and([isShift,inSet(ENTER)]),specialInfo.onShiftEnter),rule(and([isShift,inSet(TAB)]),specialInfo.onShiftTab),rule(and([isNotShift,inSet(TAB)]),specialInfo.onTab),rule(inSet(UP),specialInfo.onUp),rule(inSet(DOWN),specialInfo.onDown),rule(inSet(LEFT),specialInfo.onLeft),rule(inSet(RIGHT),specialInfo.onRight),rule(inSet(SPACE),specialInfo.onSpace)];var getKeyupRules=(component,simulatedEvent,specialInfo)=>[...(specialInfo.stopSpaceKeyup?[rule(inSet(SPACE),stopEventForFirefox)]:[]),rule(inSet(ESCAPE),specialInfo.onEscape)];var SpecialType=typical(schema$q,NoState.init,getKeydownRules,getKeyupRules,specialInfo=>specialInfo.focusIn);var acyclic=AcyclicType.schema();var cyclic=CyclicType.schema();var flow=FlowType.schema();var flatgrid=FlatgridType.schema();var matrix=MatrixType.schema();var execution=ExecutionType.schema();var menu=MenuType.schema();var special=SpecialType.schema();var KeyboardBranches=/*#__PURE__*/Object.freeze({__proto__:null,acyclic:acyclic,cyclic:cyclic,flow:flow,flatgrid:flatgrid,matrix:matrix,execution:execution,menu:menu,special:special});var isFlatgridState=keyState=>hasNonNullableKey(keyState,'setGridSize');var Keying=createModes({branchKey:'mode',branches:KeyboardBranches,name:'keying',active:{events:(keyingConfig,keyingState)=>{var handler=keyingConfig.handler;return handler.toEvents(keyingConfig,keyingState);}},apis:{focusIn:(component,keyConfig,keyState)=>{keyConfig.sendFocusIn(keyConfig).fold(()=>{component.getSystem().triggerFocus(component.element,component.element);},sendFocusIn=>{sendFocusIn(component,keyConfig,keyState);});},setGridSize:(component,keyConfig,keyState,numRows,numColumns)=>{if(!isFlatgridState(keyState)){console.error('Layout does not support setGridSize');}else{keyState.setGridSize(numRows,numColumns);}}},state:KeyingState});var withoutReuse=(parent,data)=>{preserve$1(()=>{replaceChildren(parent,data,()=>map$2(data,parent.getSystem().build));},parent.element);};var withReuse=(parent,data)=>{preserve$1(()=>{virtualReplaceChildren(parent,data,()=>{return patchSpecChildren(parent.element,data,parent.getSystem().buildOrPatch);});},parent.element);};var virtualReplace=(component,replacee,replaceeIndex,childSpec)=>{virtualDetach(replacee);var child=patchSpecChild(component.element,replaceeIndex,childSpec,component.getSystem().buildOrPatch);virtualAttach(component,child);component.syncComponents();};var insert=(component,insertion,childSpec)=>{var child=component.getSystem().build(childSpec);attachWith(component,child,insertion);};var replace=(component,replacee,replaceeIndex,childSpec)=>{detach(replacee);insert(component,(p,c)=>appendAt(p,c,replaceeIndex),childSpec);};var set$3=(component,replaceConfig,replaceState,data)=>{var replacer=replaceConfig.reuseDom?withReuse:withoutReuse;return replacer(component,data);};var append=(component,replaceConfig,replaceState,appendee)=>{insert(component,append$2,appendee);};var prepend=(component,replaceConfig,replaceState,prependee)=>{insert(component,prepend$1,prependee);};var remove=(component,replaceConfig,replaceState,removee)=>{var children=contents(component);var foundChild=find$5(children,child=>eq(removee.element,child.element));foundChild.each(detach);};var contents=(component,_replaceConfig)=>component.components();var replaceAt=(component,replaceConfig,replaceState,replaceeIndex,replacer)=>{var children=contents(component);return Optional.from(children[replaceeIndex]).map(replacee=>{replacer.fold(()=>detach(replacee),r=>{var replacer=replaceConfig.reuseDom?virtualReplace:replace;replacer(component,replacee,replaceeIndex,r);});return replacee;});};var replaceBy=(component,replaceConfig,replaceState,replaceePred,replacer)=>{var children=contents(component);return findIndex$1(children,replaceePred).bind(replaceeIndex=>replaceAt(component,replaceConfig,replaceState,replaceeIndex,replacer));};var ReplaceApis=/*#__PURE__*/Object.freeze({__proto__:null,append:append,prepend:prepend,remove:remove,replaceAt:replaceAt,replaceBy:replaceBy,set:set$3,contents:contents});var Replacing=create$4({fields:[defaultedBoolean('reuseDom',true)],name:'replacing',apis:ReplaceApis});var events$d=(name,eventHandlers)=>{var events=derive$2(eventHandlers);return create$4({fields:[required$1('enabled')],name,active:{events:constant$1(events)}});};var config=(name,eventHandlers)=>{var me=events$d(name,eventHandlers);return{key:name,value:{config:{},me,configAsRaw:constant$1({}),initialConfig:{},state:NoState}};};var focus$2=(component,focusConfig)=>{if(!focusConfig.ignore){focus$3(component.element);focusConfig.onFocus(component);}};var blur=(component,focusConfig)=>{if(!focusConfig.ignore){blur$1(component.element);}};var isFocused=component=>hasFocus(component.element);var FocusApis=/*#__PURE__*/Object.freeze({__proto__:null,focus:focus$2,blur:blur,isFocused:isFocused});var exhibit$4=(base,focusConfig)=>{var mod=focusConfig.ignore?{}:{attributes:{tabindex:'-1'}};return nu$7(mod);};var events$c=focusConfig=>derive$2([run$1(focus$4(),(component,simulatedEvent)=>{focus$2(component,focusConfig);simulatedEvent.stop();})].concat(focusConfig.stopMousedown?[run$1(mousedown(),(_,simulatedEvent)=>{simulatedEvent.event.prevent();})]:[]));var ActiveFocus=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$4,events:events$c});var FocusSchema=[onHandler('onFocus'),defaulted('stopMousedown',false),defaulted('ignore',false)];var Focusing=create$4({fields:FocusSchema,name:'focusing',active:ActiveFocus,apis:FocusApis});var SetupBehaviourCellState=initialState=>{var init=()=>{var cell=Cell(initialState);var get=()=>cell.get();var set=newState=>cell.set(newState);var clear=()=>cell.set(initialState);var readState=()=>cell.get();return{get,set,clear,readState};};return{init};};var updateAriaState=(component,toggleConfig,toggleState)=>{var ariaInfo=toggleConfig.aria;ariaInfo.update(component,ariaInfo,toggleState.get());};var updateClass=(component,toggleConfig,toggleState)=>{toggleConfig.toggleClass.each(toggleClass=>{if(toggleState.get()){add$2(component.element,toggleClass);}else{remove$2(component.element,toggleClass);}});};var set$2=(component,toggleConfig,toggleState,state)=>{var initialState=toggleState.get();toggleState.set(state);updateClass(component,toggleConfig,toggleState);updateAriaState(component,toggleConfig,toggleState);if(initialState!==state){toggleConfig.onToggled(component,state);}};var toggle$2=(component,toggleConfig,toggleState)=>{set$2(component,toggleConfig,toggleState,!toggleState.get());};var on=(component,toggleConfig,toggleState)=>{set$2(component,toggleConfig,toggleState,true);};var off=(component,toggleConfig,toggleState)=>{set$2(component,toggleConfig,toggleState,false);};var isOn=(component,toggleConfig,toggleState)=>toggleState.get();var onLoad=(component,toggleConfig,toggleState)=>{set$2(component,toggleConfig,toggleState,toggleConfig.selected);};var ToggleApis=/*#__PURE__*/Object.freeze({__proto__:null,onLoad:onLoad,toggle:toggle$2,isOn:isOn,on:on,off:off,set:set$2});var exhibit$3=()=>nu$7({});var events$b=(toggleConfig,toggleState)=>{var execute=executeEvent(toggleConfig,toggleState,toggle$2);var load=loadEvent(toggleConfig,toggleState,onLoad);return derive$2(flatten([toggleConfig.toggleOnExecute?[execute]:[],[load]]));};var ActiveToggle=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$3,events:events$b});var updatePressed=(component,ariaInfo,status)=>{set$9(component.element,'aria-pressed',status);if(ariaInfo.syncWithExpanded){updateExpanded(component,ariaInfo,status);}};var updateSelected=(component,ariaInfo,status)=>{set$9(component.element,'aria-selected',status);};var updateChecked=(component,ariaInfo,status)=>{set$9(component.element,'aria-checked',status);};var updateExpanded=(component,ariaInfo,status)=>{set$9(component.element,'aria-expanded',status);};var ToggleSchema=[defaulted('selected',false),option$3('toggleClass'),defaulted('toggleOnExecute',true),onHandler('onToggled'),defaultedOf('aria',{mode:'none'},choose$1('mode',{pressed:[defaulted('syncWithExpanded',false),output$1('update',updatePressed)],checked:[output$1('update',updateChecked)],expanded:[output$1('update',updateExpanded)],selected:[output$1('update',updateSelected)],none:[output$1('update',noop)]}))];var Toggling=create$4({fields:ToggleSchema,name:'toggling',active:ActiveToggle,apis:ToggleApis,state:SetupBehaviourCellState(false)});var pointerEvents=()=>{var onClick=(component,simulatedEvent)=>{simulatedEvent.stop();emitExecute(component);};return[run$1(click(),onClick),run$1(tap(),onClick),cutter(touchstart()),cutter(mousedown())];};var events$a=optAction=>{var executeHandler=action=>runOnExecute$1((component,simulatedEvent)=>{action(component);simulatedEvent.stop();});return derive$2(flatten([optAction.map(executeHandler).toArray(),pointerEvents()]));};var hoverEvent='alloy.item-hover';var focusEvent='alloy.item-focus';var toggledEvent='alloy.item-toggled';var onHover=item=>{if(search(item.element).isNone()||Focusing.isFocused(item)){if(!Focusing.isFocused(item)){Focusing.focus(item);}emitWith(item,hoverEvent,{item});}};var onFocus$1=item=>{emitWith(item,focusEvent,{item});};var _onToggled=(item,state)=>{emitWith(item,toggledEvent,{item,state});};var hover=constant$1(hoverEvent);var focus$1=constant$1(focusEvent);var toggled=constant$1(toggledEvent);var getItemRole=detail=>detail.toggling.map(toggling=>toggling.exclusive?'menuitemradio':'menuitemcheckbox').getOr('menuitem');var getTogglingSpec=tConfig=>_objectSpread(_objectSpread({aria:{mode:'checked'}},filter$1(tConfig,(_value,name)=>name!=='exclusive')),{},{onToggled:(component,state)=>{if(isFunction(tConfig.onToggled)){tConfig.onToggled(component,state);}_onToggled(component,state);}});var builder$2=detail=>({dom:detail.dom,domModification:_objectSpread(_objectSpread({},detail.domModification),{},{attributes:_objectSpread(_objectSpread({'role':getItemRole(detail)},detail.domModification.attributes),{},{'aria-haspopup':detail.hasSubmenu},detail.hasSubmenu?{'aria-expanded':false}:{})}),behaviours:SketchBehaviours.augment(detail.itemBehaviours,[detail.toggling.fold(Toggling.revoke,tConfig=>Toggling.config(getTogglingSpec(tConfig))),Focusing.config({ignore:detail.ignoreFocus,stopMousedown:detail.ignoreFocus,onFocus:component=>{onFocus$1(component);}}),Keying.config({mode:'execution'}),Representing.config({store:{mode:'memory',initialValue:detail.data}}),config('item-type-events',[...pointerEvents(),run$1(mouseover(),onHover),run$1(focusItem(),Focusing.focus)])]),components:detail.components,eventOrder:detail.eventOrder});var schema$p=[required$1('data'),required$1('components'),required$1('dom'),defaulted('hasSubmenu',false),option$3('toggling'),SketchBehaviours.field('itemBehaviours',[Toggling,Focusing,Keying,Representing]),defaulted('ignoreFocus',false),defaulted('domModification',{}),output$1('builder',builder$2),defaulted('eventOrder',{})];var builder$1=detail=>({dom:detail.dom,components:detail.components,events:derive$2([stopper(focusItem())])});var schema$o=[required$1('dom'),required$1('components'),output$1('builder',builder$1)];var owner$2=constant$1('item-widget');var parts$h=constant$1([required({name:'widget',overrides:detail=>{return{behaviours:derive$1([Representing.config({store:{mode:'manual',getValue:_component=>{return detail.data;},setValue:noop}})])};}})]);var builder=detail=>{var subs=substitutes(owner$2(),detail,parts$h());var components=components$1(owner$2(),detail,subs.internals());var focusWidget=component=>getPart(component,detail,'widget').map(widget=>{Keying.focusIn(widget);return widget;});var onHorizontalArrow=(component,simulatedEvent)=>inside(simulatedEvent.event.target)?Optional.none():(()=>{if(detail.autofocus){simulatedEvent.setSource(component.element);return Optional.none();}else{return Optional.none();}})();return{dom:detail.dom,components,domModification:detail.domModification,events:derive$2([runOnExecute$1((component,simulatedEvent)=>{focusWidget(component).each(_widget=>{simulatedEvent.stop();});}),run$1(mouseover(),onHover),run$1(focusItem(),(component,_simulatedEvent)=>{if(detail.autofocus){focusWidget(component);}else{Focusing.focus(component);}})]),behaviours:SketchBehaviours.augment(detail.widgetBehaviours,[Representing.config({store:{mode:'memory',initialValue:detail.data}}),Focusing.config({ignore:detail.ignoreFocus,onFocus:component=>{onFocus$1(component);}}),Keying.config({mode:'special',focusIn:detail.autofocus?component=>{focusWidget(component);}:revoke(),onLeft:onHorizontalArrow,onRight:onHorizontalArrow,onEscape:(component,simulatedEvent)=>{if(!Focusing.isFocused(component)&&!detail.autofocus){Focusing.focus(component);return Optional.some(true);}else if(detail.autofocus){simulatedEvent.setSource(component.element);return Optional.none();}else{return Optional.none();}}})])};};var schema$n=[required$1('uid'),required$1('data'),required$1('components'),required$1('dom'),defaulted('autofocus',false),defaulted('ignoreFocus',false),SketchBehaviours.field('widgetBehaviours',[Representing,Focusing,Keying]),defaulted('domModification',{}),defaultUidsSchema(parts$h()),output$1('builder',builder)];var itemSchema$2=choose$1('type',{widget:schema$n,item:schema$p,separator:schema$o});var configureGrid=(detail,movementInfo)=>({mode:'flatgrid',selector:'.'+detail.markers.item,initSize:{numColumns:movementInfo.initSize.numColumns,numRows:movementInfo.initSize.numRows},focusManager:detail.focusManager});var configureMatrix=(detail,movementInfo)=>({mode:'matrix',selectors:{row:movementInfo.rowSelector,cell:'.'+detail.markers.item},previousSelector:movementInfo.previousSelector,focusManager:detail.focusManager});var configureMenu=(detail,movementInfo)=>({mode:'menu',selector:'.'+detail.markers.item,moveOnTab:movementInfo.moveOnTab,focusManager:detail.focusManager});var parts$g=constant$1([group({factory:{sketch:spec=>{var itemInfo=asRawOrDie$1('menu.spec item',itemSchema$2,spec);return itemInfo.builder(itemInfo);}},name:'items',unit:'item',defaults:(detail,u)=>{return has$2(u,'uid')?u:_objectSpread(_objectSpread({},u),{},{uid:generate$5('item')});},overrides:(detail,u)=>{return{type:u.type,ignoreFocus:detail.fakeFocus,domModification:{classes:[detail.markers.item]}};}})]);var schema$m=constant$1([required$1('value'),required$1('items'),required$1('dom'),required$1('components'),defaulted('eventOrder',{}),field('menuBehaviours',[Highlighting,Representing,Composing,Keying]),defaultedOf('movement',{mode:'menu',moveOnTab:true},choose$1('mode',{grid:[initSize(),output$1('config',configureGrid)],matrix:[output$1('config',configureMatrix),required$1('rowSelector'),defaulted('previousSelector',Optional.none)],menu:[defaulted('moveOnTab',true),output$1('config',configureMenu)]})),itemMarkers(),defaulted('fakeFocus',false),defaulted('focusManager',dom$2()),onHandler('onHighlight'),onHandler('onDehighlight')]);var focus=constant$1('alloy.menu-focus');var deselectOtherRadioItems=(menu,item)=>{var checkedRadioItems=descendants(menu.element,'[role=\"menuitemradio\"][aria-checked=\"true\"]');each$1(checkedRadioItems,ele=>{if(!eq(ele,item.element)){menu.getSystem().getByDom(ele).each(c=>{Toggling.off(c);});}});};var make$7=(detail,components,_spec,_externals)=>({uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.menuBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedItem,itemClass:detail.markers.item,onHighlight:detail.onHighlight,onDehighlight:detail.onDehighlight}),Representing.config({store:{mode:'memory',initialValue:detail.value}}),Composing.config({find:Optional.some}),Keying.config(detail.movement.config(detail,detail.movement))]),events:derive$2([run$1(focus$1(),(menu,simulatedEvent)=>{var event=simulatedEvent.event;menu.getSystem().getByDom(event.target).each(item=>{Highlighting.highlight(menu,item);simulatedEvent.stop();emitWith(menu,focus(),{menu,item});});}),run$1(hover(),(menu,simulatedEvent)=>{var item=simulatedEvent.event.item;Highlighting.highlight(menu,item);}),run$1(toggled(),(menu,simulatedEvent)=>{var{item,state}=simulatedEvent.event;if(state&&get$f(item.element,'role')==='menuitemradio'){deselectOtherRadioItems(menu,item);}})]),components,eventOrder:detail.eventOrder,domModification:{attributes:{role:'menu'}}});var Menu=composite({name:'Menu',configFields:schema$m(),partFields:parts$g(),factory:make$7});var transpose$1=obj=>tupleMap(obj,(v,k)=>({k:v,v:k}));var trace=(items,byItem,byMenu,finish)=>get$g(byMenu,finish).bind(triggerItem=>get$g(items,triggerItem).bind(triggerMenu=>{var rest=trace(items,byItem,byMenu,triggerMenu);return Optional.some([triggerMenu].concat(rest));})).getOr([]);var generate$2=(menus,expansions)=>{var items={};each(menus,(menuItems,menu)=>{each$1(menuItems,item=>{items[item]=menu;});});var byItem=expansions;var byMenu=transpose$1(expansions);var menuPaths=map$1(byMenu,(_triggerItem,submenu)=>[submenu].concat(trace(items,byItem,byMenu,submenu)));return map$1(items,menu=>get$g(menuPaths,menu).getOr([menu]));};var init$c=()=>{var expansions=Cell({});var menus=Cell({});var paths=Cell({});var primary=value$2();var directory=Cell({});var clear=()=>{expansions.set({});menus.set({});paths.set({});primary.clear();};var isClear=()=>primary.get().isNone();var setMenuBuilt=(menuName,built)=>{menus.set(_objectSpread(_objectSpread({},menus.get()),{},{[menuName]:{type:'prepared',menu:built}}));};var setContents=(sPrimary,sMenus,sExpansions,dir)=>{primary.set(sPrimary);expansions.set(sExpansions);menus.set(sMenus);directory.set(dir);var sPaths=generate$2(dir,sExpansions);paths.set(sPaths);};var getTriggeringItem=menuValue=>find$4(expansions.get(),(v,_k)=>v===menuValue);var getTriggerData=(menuValue,getItemByValue,path)=>getPreparedMenu(menuValue).bind(menu=>getTriggeringItem(menuValue).bind(triggeringItemValue=>getItemByValue(triggeringItemValue).map(triggeredItem=>({triggeredMenu:menu,triggeringItem:triggeredItem,triggeringPath:path}))));var getTriggeringPath=(itemValue,getItemByValue)=>{var extraPath=filter$2(lookupItem(itemValue).toArray(),menuValue=>getPreparedMenu(menuValue).isSome());return get$g(paths.get(),itemValue).bind(path=>{var revPath=reverse(extraPath.concat(path));var triggers=bind$3(revPath,(menuValue,menuIndex)=>getTriggerData(menuValue,getItemByValue,revPath.slice(0,menuIndex+1)).fold(()=>is$1(primary.get(),menuValue)?[]:[Optional.none()],data=>[Optional.some(data)]));return sequence(triggers);});};var expand=itemValue=>get$g(expansions.get(),itemValue).map(menu=>{var current=get$g(paths.get(),itemValue).getOr([]);return[menu].concat(current);});var collapse=itemValue=>get$g(paths.get(),itemValue).bind(path=>path.length>1?Optional.some(path.slice(1)):Optional.none());var refresh=itemValue=>get$g(paths.get(),itemValue);var getPreparedMenu=menuValue=>lookupMenu(menuValue).bind(extractPreparedMenu);var lookupMenu=menuValue=>get$g(menus.get(),menuValue);var lookupItem=itemValue=>get$g(expansions.get(),itemValue);var otherMenus=path=>{var menuValues=directory.get();return difference(keys(menuValues),path);};var getPrimary=()=>primary.get().bind(getPreparedMenu);var getMenus=()=>menus.get();return{setMenuBuilt,setContents,expand,refresh,collapse,lookupMenu,lookupItem,otherMenus,getPrimary,getMenus,clear,isClear,getTriggeringPath};};var extractPreparedMenu=prep=>prep.type==='prepared'?Optional.some(prep.menu):Optional.none();var LayeredState={init:init$c,extractPreparedMenu};var onMenuItemHighlightedEvent=generate$6('tiered-menu-item-highlight');var onMenuItemDehighlightedEvent=generate$6('tiered-menu-item-dehighlight');var HighlightOnOpen;(function(HighlightOnOpen){HighlightOnOpen[HighlightOnOpen['HighlightMenuAndItem']=0]='HighlightMenuAndItem';HighlightOnOpen[HighlightOnOpen['HighlightJustMenu']=1]='HighlightJustMenu';HighlightOnOpen[HighlightOnOpen['HighlightNone']=2]='HighlightNone';})(HighlightOnOpen||(HighlightOnOpen={}));var make$6=(detail,_rawUiSpec)=>{var submenuParentItems=value$2();var buildMenus=(container,primaryName,menus)=>map$1(menus,(spec,name)=>{var makeSketch=()=>Menu.sketch(_objectSpread(_objectSpread({},spec),{},{value:name,markers:detail.markers,fakeFocus:detail.fakeFocus,onHighlight:(menuComp,itemComp)=>{var highlightData={menuComp,itemComp};emitWith(menuComp,onMenuItemHighlightedEvent,highlightData);},onDehighlight:(menuComp,itemComp)=>{var dehighlightData={menuComp,itemComp};emitWith(menuComp,onMenuItemDehighlightedEvent,dehighlightData);},focusManager:detail.fakeFocus?highlights():dom$2()}));return name===primaryName?{type:'prepared',menu:container.getSystem().build(makeSketch())}:{type:'notbuilt',nbMenu:makeSketch};});var layeredState=LayeredState.init();var setup=container=>{var componentMap=buildMenus(container,detail.data.primary,detail.data.menus);var directory=toDirectory();layeredState.setContents(detail.data.primary,componentMap,detail.data.expansions,directory);return layeredState.getPrimary();};var getItemValue=item=>Representing.getValue(item).value;var getItemByValue=(_container,menus,itemValue)=>findMap(menus,menu=>{if(!menu.getSystem().isConnected()){return Optional.none();}var candidates=Highlighting.getCandidates(menu);return find$5(candidates,c=>getItemValue(c)===itemValue);});var toDirectory=_container=>map$1(detail.data.menus,(data,_menuName)=>bind$3(data.items,item=>item.type==='separator'?[]:[item.data.value]));var setActiveMenu=Highlighting.highlight;var setActiveMenuAndItem=(container,menu)=>{setActiveMenu(container,menu);Highlighting.getHighlighted(menu).orThunk(()=>Highlighting.getFirst(menu)).each(item=>{if(detail.fakeFocus){Highlighting.highlight(menu,item);}else{dispatch(container,item.element,focusItem());}});};var getMenus=(state,menuValues)=>cat(map$2(menuValues,mv=>state.lookupMenu(mv).bind(prep=>prep.type==='prepared'?Optional.some(prep.menu):Optional.none())));var closeOthers=(container,state,path)=>{var others=getMenus(state,state.otherMenus(path));each$1(others,o=>{remove$1(o.element,[detail.markers.backgroundMenu]);if(!detail.stayInDom){Replacing.remove(container,o);}});};var getSubmenuParents=container=>submenuParentItems.get().getOrThunk(()=>{var r={};var items=descendants(container.element,\".\".concat(detail.markers.item));var parentItems=filter$2(items,i=>get$f(i,'aria-haspopup')==='true');each$1(parentItems,i=>{container.getSystem().getByDom(i).each(itemComp=>{var key=getItemValue(itemComp);r[key]=itemComp;});});submenuParentItems.set(r);return r;});var updateAriaExpansions=(container,path)=>{var parentItems=getSubmenuParents(container);each(parentItems,(v,k)=>{var expanded=contains$2(path,k);set$9(v.element,'aria-expanded',expanded);});};var updateMenuPath=(container,state,path)=>Optional.from(path[0]).bind(latestMenuName=>state.lookupMenu(latestMenuName).bind(menuPrep=>{if(menuPrep.type==='notbuilt'){return Optional.none();}else{var activeMenu=menuPrep.menu;var rest=getMenus(state,path.slice(1));each$1(rest,r=>{add$2(r.element,detail.markers.backgroundMenu);});if(!inBody(activeMenu.element)){Replacing.append(container,premade(activeMenu));}remove$1(activeMenu.element,[detail.markers.backgroundMenu]);setActiveMenuAndItem(container,activeMenu);closeOthers(container,state,path);return Optional.some(activeMenu);}}));var ExpandHighlightDecision;(function(ExpandHighlightDecision){ExpandHighlightDecision[ExpandHighlightDecision['HighlightSubmenu']=0]='HighlightSubmenu';ExpandHighlightDecision[ExpandHighlightDecision['HighlightParent']=1]='HighlightParent';})(ExpandHighlightDecision||(ExpandHighlightDecision={}));var buildIfRequired=(container,menuName,menuPrep)=>{if(menuPrep.type==='notbuilt'){var _menu2=container.getSystem().build(menuPrep.nbMenu());layeredState.setMenuBuilt(menuName,_menu2);return _menu2;}else{return menuPrep.menu;}};var expandRight=function expandRight(container,item){var decision=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ExpandHighlightDecision.HighlightSubmenu;if(item.hasConfigured(Disabling)&&Disabling.isDisabled(item)){return Optional.some(item);}else{var _value2=getItemValue(item);return layeredState.expand(_value2).bind(path=>{updateAriaExpansions(container,path);return Optional.from(path[0]).bind(menuName=>layeredState.lookupMenu(menuName).bind(activeMenuPrep=>{var activeMenu=buildIfRequired(container,menuName,activeMenuPrep);if(!inBody(activeMenu.element)){Replacing.append(container,premade(activeMenu));}detail.onOpenSubmenu(container,item,activeMenu,reverse(path));if(decision===ExpandHighlightDecision.HighlightSubmenu){Highlighting.highlightFirst(activeMenu);return updateMenuPath(container,layeredState,path);}else{Highlighting.dehighlightAll(activeMenu);return Optional.some(item);}}));});}};var collapseLeft=(container,item)=>{var value=getItemValue(item);return layeredState.collapse(value).bind(path=>{updateAriaExpansions(container,path);return updateMenuPath(container,layeredState,path).map(activeMenu=>{detail.onCollapseMenu(container,item,activeMenu);return activeMenu;});});};var updateView=(container,item)=>{var value=getItemValue(item);return layeredState.refresh(value).bind(path=>{updateAriaExpansions(container,path);return updateMenuPath(container,layeredState,path);});};var onRight=(container,item)=>inside(item.element)?Optional.none():expandRight(container,item,ExpandHighlightDecision.HighlightSubmenu);var onLeft=(container,item)=>inside(item.element)?Optional.none():collapseLeft(container,item);var onEscape=(container,item)=>collapseLeft(container,item).orThunk(()=>detail.onEscape(container,item).map(()=>container));var keyOnItem=f=>(container,simulatedEvent)=>{return closest$1(simulatedEvent.getSource(),\".\".concat(detail.markers.item)).bind(target=>container.getSystem().getByDom(target).toOptional().bind(item=>f(container,item).map(always)));};var events=derive$2([run$1(focus(),(tmenu,simulatedEvent)=>{var item=simulatedEvent.event.item;layeredState.lookupItem(getItemValue(item)).each(()=>{var menu=simulatedEvent.event.menu;Highlighting.highlight(tmenu,menu);var value=getItemValue(simulatedEvent.event.item);layeredState.refresh(value).each(path=>closeOthers(tmenu,layeredState,path));});}),runOnExecute$1((component,simulatedEvent)=>{var target=simulatedEvent.event.target;component.getSystem().getByDom(target).each(item=>{var itemValue=getItemValue(item);if(itemValue.indexOf('collapse-item')===0){collapseLeft(component,item);}expandRight(component,item,ExpandHighlightDecision.HighlightSubmenu).fold(()=>{detail.onExecute(component,item);},noop);});}),runOnAttached((container,_simulatedEvent)=>{setup(container).each(primary=>{Replacing.append(container,premade(primary));detail.onOpenMenu(container,primary);if(detail.highlightOnOpen===HighlightOnOpen.HighlightMenuAndItem){setActiveMenuAndItem(container,primary);}else if(detail.highlightOnOpen===HighlightOnOpen.HighlightJustMenu){setActiveMenu(container,primary);}});}),run$1(onMenuItemHighlightedEvent,(tmenuComp,se)=>{detail.onHighlightItem(tmenuComp,se.event.menuComp,se.event.itemComp);}),run$1(onMenuItemDehighlightedEvent,(tmenuComp,se)=>{detail.onDehighlightItem(tmenuComp,se.event.menuComp,se.event.itemComp);}),...(detail.navigateOnHover?[run$1(hover(),(tmenu,simulatedEvent)=>{var item=simulatedEvent.event.item;updateView(tmenu,item);expandRight(tmenu,item,ExpandHighlightDecision.HighlightParent);detail.onHover(tmenu,item);})]:[])]);var getActiveItem=container=>Highlighting.getHighlighted(container).bind(Highlighting.getHighlighted);var collapseMenuApi=container=>{getActiveItem(container).each(currentItem=>{collapseLeft(container,currentItem);});};var highlightPrimary=container=>{layeredState.getPrimary().each(primary=>{setActiveMenuAndItem(container,primary);});};var extractMenuFromContainer=container=>Optional.from(container.components()[0]).filter(comp=>get$f(comp.element,'role')==='menu');var repositionMenus=container=>{var maybeActivePrimary=layeredState.getPrimary().bind(primary=>getActiveItem(container).bind(currentItem=>{var itemValue=getItemValue(currentItem);var allMenus=values(layeredState.getMenus());var preparedMenus=cat(map$2(allMenus,LayeredState.extractPreparedMenu));return layeredState.getTriggeringPath(itemValue,v=>getItemByValue(container,preparedMenus,v));}).map(triggeringPath=>({primary,triggeringPath})));maybeActivePrimary.fold(()=>{extractMenuFromContainer(container).each(primaryMenu=>{detail.onRepositionMenu(container,primaryMenu,[]);});},_ref2=>{var{primary,triggeringPath}=_ref2;detail.onRepositionMenu(container,primary,triggeringPath);});};var apis={collapseMenu:collapseMenuApi,highlightPrimary,repositionMenus};return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.tmenuBehaviours,[Keying.config({mode:'special',onRight:keyOnItem(onRight),onLeft:keyOnItem(onLeft),onEscape:keyOnItem(onEscape),focusIn:(container,_keyInfo)=>{layeredState.getPrimary().each(primary=>{dispatch(container,primary.element,focusItem());});}}),Highlighting.config({highlightClass:detail.markers.selectedMenu,itemClass:detail.markers.menu}),Composing.config({find:container=>{return Highlighting.getHighlighted(container);}}),Replacing.config({})]),eventOrder:detail.eventOrder,apis,events};};var collapseItem$1=constant$1('collapse-item');var tieredData=(primary,menus,expansions)=>({primary,menus,expansions});var singleData=(name,menu)=>({primary:name,menus:wrap$1(name,menu),expansions:{}});var collapseItem=text=>({value:generate$6(collapseItem$1()),meta:{text}});var tieredMenu=single({name:'TieredMenu',configFields:[onStrictKeyboardHandler('onExecute'),onStrictKeyboardHandler('onEscape'),onStrictHandler('onOpenMenu'),onStrictHandler('onOpenSubmenu'),onHandler('onRepositionMenu'),onHandler('onCollapseMenu'),defaulted('highlightOnOpen',HighlightOnOpen.HighlightMenuAndItem),requiredObjOf('data',[required$1('primary'),required$1('menus'),required$1('expansions')]),defaulted('fakeFocus',false),onHandler('onHighlightItem'),onHandler('onDehighlightItem'),onHandler('onHover'),tieredMenuMarkers(),required$1('dom'),defaulted('navigateOnHover',true),defaulted('stayInDom',false),field('tmenuBehaviours',[Keying,Highlighting,Composing,Replacing]),defaulted('eventOrder',{})],apis:{collapseMenu:(apis,tmenu)=>{apis.collapseMenu(tmenu);},highlightPrimary:(apis,tmenu)=>{apis.highlightPrimary(tmenu);},repositionMenus:(apis,tmenu)=>{apis.repositionMenus(tmenu);}},factory:make$6,extraApis:{tieredData,singleData,collapseItem}});var makeMenu=(detail,menuSandbox,placementSpec,menuSpec,getBounds)=>{var lazySink=()=>detail.lazySink(menuSandbox);var layouts=menuSpec.type==='horizontal'?{layouts:{onLtr:()=>belowOrAbove(),onRtl:()=>belowOrAboveRtl()}}:{};var isFirstTierSubmenu=triggeringPaths=>triggeringPaths.length===2;var getSubmenuLayouts=triggeringPaths=>isFirstTierSubmenu(triggeringPaths)?layouts:{};return tieredMenu.sketch({dom:{tag:'div'},data:menuSpec.data,markers:menuSpec.menu.markers,highlightOnOpen:menuSpec.menu.highlightOnOpen,fakeFocus:menuSpec.menu.fakeFocus,onEscape:()=>{Sandboxing.close(menuSandbox);detail.onEscape.map(handler=>handler(menuSandbox));return Optional.some(true);},onExecute:()=>{return Optional.some(true);},onOpenMenu:(tmenu,menu)=>{Positioning.positionWithinBounds(lazySink().getOrDie(),menu,placementSpec,getBounds());},onOpenSubmenu:(tmenu,item,submenu,triggeringPaths)=>{var sink=lazySink().getOrDie();Positioning.position(sink,submenu,{anchor:_objectSpread({type:'submenu',item},getSubmenuLayouts(triggeringPaths))});},onRepositionMenu:(tmenu,primaryMenu,submenuTriggers)=>{var sink=lazySink().getOrDie();Positioning.positionWithinBounds(sink,primaryMenu,placementSpec,getBounds());each$1(submenuTriggers,st=>{var submenuLayouts=getSubmenuLayouts(st.triggeringPath);Positioning.position(sink,st.triggeredMenu,{anchor:_objectSpread({type:'submenu',item:st.triggeringItem},submenuLayouts)});});}});};var factory$o=(detail,spec)=>{var isPartOfRelated=(sandbox,queryElem)=>{var related=detail.getRelated(sandbox);return related.exists(rel=>isPartOf$1(rel,queryElem));};var setContent=(sandbox,thing)=>{Sandboxing.setContent(sandbox,thing);};var showAt=(sandbox,thing,placementSpec)=>{var getBounds=Optional.none;showWithinBounds(sandbox,thing,placementSpec,getBounds);};var showWithinBounds=(sandbox,thing,placementSpec,getBounds)=>{var sink=detail.lazySink(sandbox).getOrDie();Sandboxing.openWhileCloaked(sandbox,thing,()=>Positioning.positionWithinBounds(sink,sandbox,placementSpec,getBounds()));Representing.setValue(sandbox,Optional.some({mode:'position',config:placementSpec,getBounds}));};var showMenuAt=(sandbox,placementSpec,menuSpec)=>{showMenuWithinBounds(sandbox,placementSpec,menuSpec,Optional.none);};var showMenuWithinBounds=(sandbox,placementSpec,menuSpec,getBounds)=>{var menu=makeMenu(detail,sandbox,placementSpec,menuSpec,getBounds);Sandboxing.open(sandbox,menu);Representing.setValue(sandbox,Optional.some({mode:'menu',menu}));};var hide=sandbox=>{if(Sandboxing.isOpen(sandbox)){Representing.setValue(sandbox,Optional.none());Sandboxing.close(sandbox);}};var getContent=sandbox=>Sandboxing.getState(sandbox);var reposition=sandbox=>{if(Sandboxing.isOpen(sandbox)){Representing.getValue(sandbox).each(state=>{switch(state.mode){case'menu':Sandboxing.getState(sandbox).each(tieredMenu.repositionMenus);break;case'position':var sink=detail.lazySink(sandbox).getOrDie();Positioning.positionWithinBounds(sink,sandbox,state.config,state.getBounds());break;}});}};var apis={setContent,showAt,showWithinBounds,showMenuAt,showMenuWithinBounds,hide,getContent,reposition,isOpen:Sandboxing.isOpen};return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.inlineBehaviours,[Sandboxing.config({isPartOf:(sandbox,data,queryElem)=>{return isPartOf$1(data,queryElem)||isPartOfRelated(sandbox,queryElem);},getAttachPoint:sandbox=>{return detail.lazySink(sandbox).getOrDie();},onOpen:sandbox=>{detail.onShow(sandbox);},onClose:sandbox=>{detail.onHide(sandbox);}}),Representing.config({store:{mode:'memory',initialValue:Optional.none()}}),Receiving.config({channels:_objectSpread(_objectSpread({},receivingChannel$1(_objectSpread({isExtraPart:spec.isExtraPart},detail.fireDismissalEventInstead.map(fe=>({fireEventInstead:{event:fe.event}})).getOr({})))),receivingChannel(_objectSpread(_objectSpread({},detail.fireRepositionEventInstead.map(fe=>({fireEventInstead:{event:fe.event}})).getOr({})),{},{doReposition:reposition})))})]),eventOrder:detail.eventOrder,apis};};var InlineView=single({name:'InlineView',configFields:[required$1('lazySink'),onHandler('onShow'),onHandler('onHide'),optionFunction('onEscape'),field('inlineBehaviours',[Sandboxing,Representing,Receiving]),optionObjOf('fireDismissalEventInstead',[defaulted('event',dismissRequested())]),optionObjOf('fireRepositionEventInstead',[defaulted('event',repositionRequested())]),defaulted('getRelated',Optional.none),defaulted('isExtraPart',never),defaulted('eventOrder',Optional.none)],factory:factory$o,apis:{showAt:(apis,component,anchor,thing)=>{apis.showAt(component,anchor,thing);},showWithinBounds:(apis,component,anchor,thing,bounds)=>{apis.showWithinBounds(component,anchor,thing,bounds);},showMenuAt:(apis,component,anchor,menuSpec)=>{apis.showMenuAt(component,anchor,menuSpec);},showMenuWithinBounds:(apis,component,anchor,menuSpec,bounds)=>{apis.showMenuWithinBounds(component,anchor,menuSpec,bounds);},hide:(apis,component)=>{apis.hide(component);},isOpen:(apis,component)=>apis.isOpen(component),getContent:(apis,component)=>apis.getContent(component),setContent:(apis,component,thing)=>{apis.setContent(component,thing);},reposition:(apis,component)=>{apis.reposition(component);}}});var global$9=tinymce.util.Tools.resolve('tinymce.util.Delay');var factory$n=detail=>{var events=events$a(detail.action);var tag=detail.dom.tag;var lookupAttr=attr=>get$g(detail.dom,'attributes').bind(attrs=>get$g(attrs,attr));var getModAttributes=()=>{if(tag==='button'){var _type2=lookupAttr('type').getOr('button');var roleAttrs=lookupAttr('role').map(role=>({role})).getOr({});return _objectSpread({type:_type2},roleAttrs);}else{var role=detail.role.getOr(lookupAttr('role').getOr('button'));return{role};}};return{uid:detail.uid,dom:detail.dom,components:detail.components,events,behaviours:SketchBehaviours.augment(detail.buttonBehaviours,[Focusing.config({}),Keying.config({mode:'execution',useSpace:true,useEnter:true})]),domModification:{attributes:getModAttributes()},eventOrder:detail.eventOrder};};var Button=single({name:'Button',factory:factory$n,configFields:[defaulted('uid',undefined),required$1('dom'),defaulted('components',[]),SketchBehaviours.field('buttonBehaviours',[Focusing,Keying]),option$3('action'),option$3('role'),defaulted('eventOrder',{})]});var record=spec=>{var uid=isSketchSpec(spec)&&hasNonNullableKey(spec,'uid')?spec.uid:generate$5('memento');var get=anyInSystem=>anyInSystem.getSystem().getByUid(uid).getOrDie();var getOpt=anyInSystem=>anyInSystem.getSystem().getByUid(uid).toOptional();var asSpec=()=>_objectSpread(_objectSpread({},spec),{},{uid});return{get,getOpt,asSpec};};var global$8=tinymce.util.Tools.resolve('tinymce.util.I18n');var rtlTransform={'indent':true,'outdent':true,'table-insert-column-after':true,'table-insert-column-before':true,'paste-column-after':true,'paste-column-before':true,'unordered-list':true,'list-bull-circle':true,'list-bull-default':true,'list-bull-square':true};var defaultIconName='temporary-placeholder';var defaultIcon=icons=>()=>get$g(icons,defaultIconName).getOr('!not found!');var getIconName=(name,icons)=>{var lcName=name.toLowerCase();if(global$8.isRtl()){var rtlName=ensureTrailing(lcName,'-rtl');return has$2(icons,rtlName)?rtlName:lcName;}else{return lcName;}};var lookupIcon=(name,icons)=>get$g(icons,getIconName(name,icons));var get$2=(name,iconProvider)=>{var icons=iconProvider();return lookupIcon(name,icons).getOrThunk(defaultIcon(icons));};var getOr=(name,iconProvider,fallbackIcon)=>{var icons=iconProvider();return lookupIcon(name,icons).or(fallbackIcon).getOrThunk(defaultIcon(icons));};var needsRtlTransform=iconName=>global$8.isRtl()?has$2(rtlTransform,iconName):false;var addFocusableBehaviour=()=>config('add-focusable',[runOnAttached(comp=>{child(comp.element,'svg').each(svg=>set$9(svg,'focusable','false'));})]);var renderIcon$3=(spec,iconName,icons,fallbackIcon)=>{var _a,_b;var rtlIconClasses=needsRtlTransform(iconName)?['tox-icon--flip']:[];var iconHtml=get$g(icons,getIconName(iconName,icons)).or(fallbackIcon).getOrThunk(defaultIcon(icons));return{dom:{tag:spec.tag,attributes:(_a=spec.attributes)!==null&&_a!==void 0?_a:{},classes:spec.classes.concat(rtlIconClasses),innerHtml:iconHtml},behaviours:derive$1([...((_b=spec.behaviours)!==null&&_b!==void 0?_b:[]),addFocusableBehaviour()])};};var render$3=function render$3(iconName,spec,iconProvider){var fallbackIcon=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Optional.none();return renderIcon$3(spec,iconName,iconProvider(),fallbackIcon);};var renderFirst=(iconNames,spec,iconProvider)=>{var icons=iconProvider();var iconName=find$5(iconNames,name=>has$2(icons,getIconName(name,icons)));return renderIcon$3(spec,iconName.getOr(defaultIconName),icons,Optional.none());};var notificationIconMap={success:'checkmark',error:'warning',err:'error',warning:'warning',warn:'warning',info:'info'};var factory$m=detail=>{var memBannerText=record({dom:{tag:'p',innerHtml:detail.translationProvider(detail.text)},behaviours:derive$1([Replacing.config({})])});var renderPercentBar=percent=>({dom:{tag:'div',classes:['tox-bar'],styles:{width:\"\".concat(percent,\"%\")}}});var renderPercentText=percent=>({dom:{tag:'div',classes:['tox-text'],innerHtml:\"\".concat(percent,\"%\")}});var memBannerProgress=record({dom:{tag:'div',classes:detail.progress?['tox-progress-bar','tox-progress-indicator']:['tox-progress-bar']},components:[{dom:{tag:'div',classes:['tox-bar-container']},components:[renderPercentBar(0)]},renderPercentText(0)],behaviours:derive$1([Replacing.config({})])});var updateProgress=(comp,percent)=>{if(comp.getSystem().isConnected()){memBannerProgress.getOpt(comp).each(progress=>{Replacing.set(progress,[{dom:{tag:'div',classes:['tox-bar-container']},components:[renderPercentBar(percent)]},renderPercentText(percent)]);});}};var updateText=(comp,text)=>{if(comp.getSystem().isConnected()){var banner=memBannerText.get(comp);Replacing.set(banner,[text$2(text)]);}};var apis={updateProgress,updateText};var iconChoices=flatten([detail.icon.toArray(),detail.level.toArray(),detail.level.bind(level=>Optional.from(notificationIconMap[level])).toArray()]);var memButton=record(Button.sketch({dom:{tag:'button',classes:['tox-notification__dismiss','tox-button','tox-button--naked','tox-button--icon']},components:[render$3('close',{tag:'span',classes:['tox-icon'],attributes:{'aria-label':detail.translationProvider('Close')}},detail.iconProvider)],action:comp=>{detail.onAction(comp);}}));var notificationIconSpec=renderFirst(iconChoices,{tag:'div',classes:['tox-notification__icon']},detail.iconProvider);var notificationBodySpec={dom:{tag:'div',classes:['tox-notification__body']},components:[memBannerText.asSpec()],behaviours:derive$1([Replacing.config({})])};var components=[notificationIconSpec,notificationBodySpec];return{uid:detail.uid,dom:{tag:'div',attributes:{role:'alert'},classes:detail.level.map(level=>['tox-notification','tox-notification--in',\"tox-notification--\".concat(level)]).getOr(['tox-notification','tox-notification--in'])},behaviours:derive$1([Focusing.config({}),config('notification-events',[run$1(focusin(),comp=>{memButton.getOpt(comp).each(Focusing.focus);})])]),components:components.concat(detail.progress?[memBannerProgress.asSpec()]:[]).concat(!detail.closeButton?[]:[memButton.asSpec()]),apis};};var Notification=single({name:'Notification',factory:factory$m,configFields:[option$3('level'),required$1('progress'),option$3('icon'),required$1('onAction'),required$1('text'),required$1('iconProvider'),required$1('translationProvider'),defaultedBoolean('closeButton',true)],apis:{updateProgress:(apis,comp,percent)=>{apis.updateProgress(comp,percent);},updateText:(apis,comp,text)=>{apis.updateText(comp,text);}}});var NotificationManagerImpl=(editor,extras,uiMothership)=>{var sharedBackstage=extras.backstage.shared;var getBounds=()=>{var contentArea=box$1(SugarElement.fromDom(editor.getContentAreaContainer()));var win$1=win();var x=clamp(win$1.x,contentArea.x,contentArea.right);var y=clamp(win$1.y,contentArea.y,contentArea.bottom);var right=Math.max(contentArea.right,win$1.right);var bottom=Math.max(contentArea.bottom,win$1.bottom);return Optional.some(bounds(x,y,right-x,bottom-y));};var open=(settings,closeCallback)=>{var close=()=>{closeCallback();InlineView.hide(notificationWrapper);};var notification=build$1(Notification.sketch({text:settings.text,level:contains$2(['success','error','warning','warn','info'],settings.type)?settings.type:undefined,progress:settings.progressBar===true,icon:settings.icon,closeButton:settings.closeButton,onAction:close,iconProvider:sharedBackstage.providers.icons,translationProvider:sharedBackstage.providers.translate}));var notificationWrapper=build$1(InlineView.sketch(_objectSpread({dom:{tag:'div',classes:['tox-notifications-container']},lazySink:sharedBackstage.getSink,fireDismissalEventInstead:{}},sharedBackstage.header.isPositionedAtTop()?{}:{fireRepositionEventInstead:{}})));uiMothership.add(notificationWrapper);if(isNumber(settings.timeout)&&settings.timeout>0){global$9.setEditorTimeout(editor,()=>{close();},settings.timeout);}var reposition=()=>{var notificationSpec=premade(notification);var anchorOverrides={maxHeightFunction:expandable$1()};var allNotifications=editor.notificationManager.getNotifications();if(allNotifications[0]===thisNotification){var _anchor2=_objectSpread(_objectSpread({},sharedBackstage.anchors.banner()),{},{overrides:anchorOverrides});InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:_anchor2},getBounds);}else{indexOf(allNotifications,thisNotification).each(idx=>{var previousNotification=allNotifications[idx-1].getEl();var nodeAnchor={type:'node',root:body(),node:Optional.some(SugarElement.fromDom(previousNotification)),overrides:anchorOverrides,layouts:{onRtl:()=>[south$2],onLtr:()=>[south$2]}};InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:nodeAnchor},getBounds);});}};var thisNotification={close,reposition,text:nuText=>{Notification.updateText(notification,nuText);},settings,getEl:()=>notification.element.dom,progressBar:{value:percent=>{Notification.updateProgress(notification,percent);}}};return thisNotification;};var close=notification=>{notification.close();};var getArgs=notification=>{return notification.settings;};return{open,close,getArgs};};var global$7=tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');var global$6=tinymce.util.Tools.resolve('tinymce.EditorManager');var global$5=tinymce.util.Tools.resolve('tinymce.Env');var ToolbarMode$1;(function(ToolbarMode){ToolbarMode['default']='wrap';ToolbarMode['floating']='floating';ToolbarMode['sliding']='sliding';ToolbarMode['scrolling']='scrolling';})(ToolbarMode$1||(ToolbarMode$1={}));var ToolbarLocation$1;(function(ToolbarLocation){ToolbarLocation['auto']='auto';ToolbarLocation['top']='top';ToolbarLocation['bottom']='bottom';})(ToolbarLocation$1||(ToolbarLocation$1={}));var option$2=name=>editor=>editor.options.get(name);var wrapOptional=fn=>editor=>Optional.from(fn(editor));var register$e=editor=>{var isPhone=global$5.deviceType.isPhone();var isMobile=global$5.deviceType.isTablet()||isPhone;var registerOption=editor.options.register;var stringOrFalseProcessor=value=>isString(value)||value===false;var stringOrNumberProcessor=value=>isString(value)||isNumber(value);registerOption('skin',{processor:value=>isString(value)||value===false,default:'oxide'});registerOption('skin_url',{processor:'string'});registerOption('height',{processor:stringOrNumberProcessor,default:Math.max(editor.getElement().offsetHeight,400)});registerOption('width',{processor:stringOrNumberProcessor,default:global$7.DOM.getStyle(editor.getElement(),'width')});registerOption('min_height',{processor:'number',default:100});registerOption('min_width',{processor:'number'});registerOption('max_height',{processor:'number'});registerOption('max_width',{processor:'number'});registerOption('style_formats',{processor:'object[]'});registerOption('style_formats_merge',{processor:'boolean',default:false});registerOption('style_formats_autohide',{processor:'boolean',default:false});registerOption('line_height_formats',{processor:'string',default:'1 1.1 1.2 1.3 1.4 1.5 2'});registerOption('font_family_formats',{processor:'string',default:'Andale Mono=andale mono,monospace;'+'Arial=arial,helvetica,sans-serif;'+'Arial Black=arial black,sans-serif;'+'Book Antiqua=book antiqua,palatino,serif;'+'Comic Sans MS=comic sans ms,sans-serif;'+'Courier New=courier new,courier,monospace;'+'Georgia=georgia,palatino,serif;'+'Helvetica=helvetica,arial,sans-serif;'+'Impact=impact,sans-serif;'+'Symbol=symbol;'+'Tahoma=tahoma,arial,helvetica,sans-serif;'+'Terminal=terminal,monaco,monospace;'+'Times New Roman=times new roman,times,serif;'+'Trebuchet MS=trebuchet ms,geneva,sans-serif;'+'Verdana=verdana,geneva,sans-serif;'+'Webdings=webdings;'+'Wingdings=wingdings,zapf dingbats'});registerOption('font_size_formats',{processor:'string',default:'8pt 10pt 12pt 14pt 18pt 24pt 36pt'});registerOption('font_size_input_default_unit',{processor:'string',default:'pt'});registerOption('block_formats',{processor:'string',default:'Paragraph=p;'+'Heading 1=h1;'+'Heading 2=h2;'+'Heading 3=h3;'+'Heading 4=h4;'+'Heading 5=h5;'+'Heading 6=h6;'+'Preformatted=pre'});registerOption('content_langs',{processor:'object[]'});registerOption('removed_menuitems',{processor:'string',default:''});registerOption('menubar',{processor:value=>isString(value)||isBoolean(value),default:!isPhone});registerOption('menu',{processor:'object',default:{}});registerOption('toolbar',{processor:value=>{if(isBoolean(value)||isString(value)||isArray(value)){return{value,valid:true};}else{return{valid:false,message:'Must be a boolean, string or array.'};}},default:true});range$2(9,num=>{registerOption('toolbar'+(num+1),{processor:'string'});});registerOption('toolbar_mode',{processor:'string',default:isMobile?'scrolling':'floating'});registerOption('toolbar_groups',{processor:'object',default:{}});registerOption('toolbar_location',{processor:'string',default:ToolbarLocation$1.auto});registerOption('toolbar_persist',{processor:'boolean',default:false});registerOption('toolbar_sticky',{processor:'boolean',default:editor.inline});registerOption('toolbar_sticky_offset',{processor:'number',default:0});registerOption('fixed_toolbar_container',{processor:'string',default:''});registerOption('fixed_toolbar_container_target',{processor:'object'});registerOption('ui_mode',{processor:'string',default:'combined'});registerOption('file_picker_callback',{processor:'function'});registerOption('file_picker_validator_handler',{processor:'function'});registerOption('file_picker_types',{processor:'string'});registerOption('typeahead_urls',{processor:'boolean',default:true});registerOption('anchor_top',{processor:stringOrFalseProcessor,default:'#top'});registerOption('anchor_bottom',{processor:stringOrFalseProcessor,default:'#bottom'});registerOption('draggable_modal',{processor:'boolean',default:false});registerOption('statusbar',{processor:'boolean',default:true});registerOption('elementpath',{processor:'boolean',default:true});registerOption('branding',{processor:'boolean',default:true});registerOption('promotion',{processor:'boolean',default:true});registerOption('resize',{processor:value=>value==='both'||isBoolean(value),default:!global$5.deviceType.isTouch()});registerOption('sidebar_show',{processor:'string'});registerOption('help_accessibility',{processor:'boolean',default:editor.hasPlugin('help')});};var isReadOnly=option$2('readonly');var getHeightOption=option$2('height');var getWidthOption=option$2('width');var getMinWidthOption=wrapOptional(option$2('min_width'));var getMinHeightOption=wrapOptional(option$2('min_height'));var getMaxWidthOption=wrapOptional(option$2('max_width'));var getMaxHeightOption=wrapOptional(option$2('max_height'));var getUserStyleFormats=wrapOptional(option$2('style_formats'));var shouldMergeStyleFormats=option$2('style_formats_merge');var shouldAutoHideStyleFormats=option$2('style_formats_autohide');var getContentLanguages=option$2('content_langs');var getRemovedMenuItems=option$2('removed_menuitems');var getToolbarMode=option$2('toolbar_mode');var getToolbarGroups=option$2('toolbar_groups');var getToolbarLocation=option$2('toolbar_location');var fixedContainerSelector=option$2('fixed_toolbar_container');var fixedToolbarContainerTarget=option$2('fixed_toolbar_container_target');var isToolbarPersist=option$2('toolbar_persist');var getStickyToolbarOffset=option$2('toolbar_sticky_offset');var getMenubar=option$2('menubar');var getToolbar=option$2('toolbar');var getFilePickerCallback=option$2('file_picker_callback');var getFilePickerValidatorHandler=option$2('file_picker_validator_handler');var getFontSizeInputDefaultUnit=option$2('font_size_input_default_unit');var getFilePickerTypes=option$2('file_picker_types');var useTypeaheadUrls=option$2('typeahead_urls');var getAnchorTop=option$2('anchor_top');var getAnchorBottom=option$2('anchor_bottom');var isDraggableModal$1=option$2('draggable_modal');var useStatusBar=option$2('statusbar');var useElementPath=option$2('elementpath');var useBranding=option$2('branding');var getResize=option$2('resize');var getPasteAsText=option$2('paste_as_text');var getSidebarShow=option$2('sidebar_show');var promotionEnabled=option$2('promotion');var useHelpAccessibility=option$2('help_accessibility');var isSkinDisabled=editor=>editor.options.get('skin')===false;var isMenubarEnabled=editor=>editor.options.get('menubar')!==false;var getSkinUrl=editor=>{var skinUrl=editor.options.get('skin_url');if(isSkinDisabled(editor)){return skinUrl;}else{if(skinUrl){return editor.documentBaseURI.toAbsolute(skinUrl);}else{var skin=editor.options.get('skin');return global$6.baseURL+'/skins/ui/'+skin;}}};var getLineHeightFormats=editor=>editor.options.get('line_height_formats').split(' ');var isToolbarEnabled=editor=>{var toolbar=getToolbar(editor);var isToolbarString=isString(toolbar);var isToolbarObjectArray=isArray(toolbar)&&toolbar.length>0;return!isMultipleToolbars(editor)&&(isToolbarObjectArray||isToolbarString||toolbar===true);};var getMultipleToolbarsOption=editor=>{var toolbars=range$2(9,num=>editor.options.get('toolbar'+(num+1)));var toolbarArray=filter$2(toolbars,isString);return someIf(toolbarArray.length>0,toolbarArray);};var isMultipleToolbars=editor=>getMultipleToolbarsOption(editor).fold(()=>{var toolbar=getToolbar(editor);return isArrayOf(toolbar,isString)&&toolbar.length>0;},always);var isToolbarLocationBottom=editor=>getToolbarLocation(editor)===ToolbarLocation$1.bottom;var fixedContainerTarget=editor=>{var _a;if(!editor.inline){return Optional.none();}var selector=(_a=fixedContainerSelector(editor))!==null&&_a!==void 0?_a:'';if(selector.length>0){return descendant(body(),selector);}var element=fixedToolbarContainerTarget(editor);if(isNonNullable(element)){return Optional.some(SugarElement.fromDom(element));}return Optional.none();};var useFixedContainer=editor=>editor.inline&&fixedContainerTarget(editor).isSome();var getUiContainer=editor=>{var fixedContainer=fixedContainerTarget(editor);return fixedContainer.getOrThunk(()=>getContentContainer(getRootNode(SugarElement.fromDom(editor.getElement()))));};var isDistractionFree=editor=>editor.inline&&!isMenubarEnabled(editor)&&!isToolbarEnabled(editor)&&!isMultipleToolbars(editor);var isStickyToolbar=editor=>{var isStickyToolbar=editor.options.get('toolbar_sticky');return(isStickyToolbar||editor.inline)&&!useFixedContainer(editor)&&!isDistractionFree(editor);};var isSplitUiMode=editor=>!useFixedContainer(editor)&&editor.options.get('ui_mode')==='split';var getMenus=editor=>{var menu=editor.options.get('menu');return map$1(menu,menu=>_objectSpread(_objectSpread({},menu),{},{items:menu.items}));};var Options=/*#__PURE__*/Object.freeze({__proto__:null,get ToolbarMode(){return ToolbarMode$1;},get ToolbarLocation(){return ToolbarLocation$1;},register:register$e,getSkinUrl:getSkinUrl,isReadOnly:isReadOnly,isSkinDisabled:isSkinDisabled,getHeightOption:getHeightOption,getWidthOption:getWidthOption,getMinWidthOption:getMinWidthOption,getMinHeightOption:getMinHeightOption,getMaxWidthOption:getMaxWidthOption,getMaxHeightOption:getMaxHeightOption,getUserStyleFormats:getUserStyleFormats,shouldMergeStyleFormats:shouldMergeStyleFormats,shouldAutoHideStyleFormats:shouldAutoHideStyleFormats,getLineHeightFormats:getLineHeightFormats,getContentLanguages:getContentLanguages,getRemovedMenuItems:getRemovedMenuItems,isMenubarEnabled:isMenubarEnabled,isMultipleToolbars:isMultipleToolbars,isToolbarEnabled:isToolbarEnabled,isToolbarPersist:isToolbarPersist,getMultipleToolbarsOption:getMultipleToolbarsOption,getUiContainer:getUiContainer,useFixedContainer:useFixedContainer,isSplitUiMode:isSplitUiMode,getToolbarMode:getToolbarMode,isDraggableModal:isDraggableModal$1,isDistractionFree:isDistractionFree,isStickyToolbar:isStickyToolbar,getStickyToolbarOffset:getStickyToolbarOffset,getToolbarLocation:getToolbarLocation,isToolbarLocationBottom:isToolbarLocationBottom,getToolbarGroups:getToolbarGroups,getMenus:getMenus,getMenubar:getMenubar,getToolbar:getToolbar,getFilePickerCallback:getFilePickerCallback,getFilePickerTypes:getFilePickerTypes,useTypeaheadUrls:useTypeaheadUrls,getAnchorTop:getAnchorTop,getAnchorBottom:getAnchorBottom,getFilePickerValidatorHandler:getFilePickerValidatorHandler,getFontSizeInputDefaultUnit:getFontSizeInputDefaultUnit,useStatusBar:useStatusBar,useElementPath:useElementPath,promotionEnabled:promotionEnabled,useBranding:useBranding,getResize:getResize,getPasteAsText:getPasteAsText,getSidebarShow:getSidebarShow,useHelpAccessibility:useHelpAccessibility});var autocompleteSelector='[data-mce-autocompleter]';var detect$1=elm=>closest$1(elm,autocompleteSelector);var findIn=elm=>descendant(elm,autocompleteSelector);var setup$e=(api,editor)=>{var redirectKeyToItem=(item,e)=>{emitWith(item,keydown(),{raw:e});};var getItem=()=>api.getMenu().bind(Highlighting.getHighlighted);editor.on('keydown',e=>{var keyCode=e.which;if(!api.isActive()){return;}if(api.isMenuOpen()){if(keyCode===13){getItem().each(emitExecute);e.preventDefault();}else if(keyCode===40){getItem().fold(()=>{api.getMenu().each(Highlighting.highlightFirst);},item=>{redirectKeyToItem(item,e);});e.preventDefault();e.stopImmediatePropagation();}else if(keyCode===37||keyCode===38||keyCode===39){getItem().each(item=>{redirectKeyToItem(item,e);e.preventDefault();e.stopImmediatePropagation();});}}else{if(keyCode===13||keyCode===38||keyCode===40){api.cancelIfNecessary();}}});editor.on('NodeChange',e=>{if(api.isActive()&&!api.isProcessingAction()&&detect$1(SugarElement.fromDom(e.element)).isNone()){api.cancelIfNecessary();}});};var AutocompleterEditorEvents={setup:setup$e};var ItemResponse;(function(ItemResponse){ItemResponse[ItemResponse['CLOSE_ON_EXECUTE']=0]='CLOSE_ON_EXECUTE';ItemResponse[ItemResponse['BUBBLE_TO_SANDBOX']=1]='BUBBLE_TO_SANDBOX';})(ItemResponse||(ItemResponse={}));var ItemResponse$1=ItemResponse;var navClass='tox-menu-nav__js';var selectableClass='tox-collection__item';var colorClass='tox-swatch';var presetClasses={normal:navClass,color:colorClass};var tickedClass='tox-collection__item--enabled';var groupHeadingClass='tox-collection__group-heading';var iconClass='tox-collection__item-icon';var textClass='tox-collection__item-label';var accessoryClass='tox-collection__item-accessory';var caretClass='tox-collection__item-caret';var checkmarkClass='tox-collection__item-checkmark';var activeClass='tox-collection__item--active';var containerClass='tox-collection__item-container';var containerColumnClass='tox-collection__item-container--column';var containerRowClass='tox-collection__item-container--row';var containerAlignRightClass='tox-collection__item-container--align-right';var containerAlignLeftClass='tox-collection__item-container--align-left';var containerValignTopClass='tox-collection__item-container--valign-top';var containerValignMiddleClass='tox-collection__item-container--valign-middle';var containerValignBottomClass='tox-collection__item-container--valign-bottom';var classForPreset=presets=>get$g(presetClasses,presets).getOr(navClass);var forMenu=presets=>{if(presets==='color'){return'tox-swatches';}else{return'tox-menu';}};var classes=presets=>({backgroundMenu:'tox-background-menu',selectedMenu:'tox-selected-menu',selectedItem:'tox-collection__item--active',hasIcons:'tox-menu--has-icons',menu:forMenu(presets),tieredMenu:'tox-tiered-menu'});var markers=presets=>{var menuClasses=classes(presets);return{backgroundMenu:menuClasses.backgroundMenu,selectedMenu:menuClasses.selectedMenu,menu:menuClasses.menu,selectedItem:menuClasses.selectedItem,item:classForPreset(presets)};};var dom$1=(hasIcons,columns,presets)=>{var menuClasses=classes(presets);return{tag:'div',classes:flatten([[menuClasses.menu,\"tox-menu-\".concat(columns,\"-column\")],hasIcons?[menuClasses.hasIcons]:[]])};};var components=[Menu.parts.items({})];var part=(hasIcons,columns,presets)=>{var menuClasses=classes(presets);var d={tag:'div',classes:flatten([[menuClasses.tieredMenu]])};return{dom:d,markers:markers(presets)};};var schema$l=constant$1([option$3('data'),defaulted('inputAttributes',{}),defaulted('inputStyles',{}),defaulted('tag','input'),defaulted('inputClasses',[]),onHandler('onSetValue'),defaulted('styles',{}),defaulted('eventOrder',{}),field('inputBehaviours',[Representing,Focusing]),defaulted('selectOnFocus',true)]);var focusBehaviours=detail=>derive$1([Focusing.config({onFocus:!detail.selectOnFocus?noop:component=>{var input=component.element;var value=get$6(input);input.dom.setSelectionRange(0,value.length);}})]);var behaviours=detail=>_objectSpread(_objectSpread({},focusBehaviours(detail)),augment(detail.inputBehaviours,[Representing.config({store:_objectSpread(_objectSpread({mode:'manual'},detail.data.map(data=>({initialValue:data})).getOr({})),{},{getValue:input=>{return get$6(input.element);},setValue:(input,data)=>{var current=get$6(input.element);if(current!==data){set$5(input.element,data);}}}),onSetValue:detail.onSetValue})]));var dom=detail=>({tag:detail.tag,attributes:_objectSpread({type:'text'},detail.inputAttributes),styles:detail.inputStyles,classes:detail.inputClasses});var factory$l=(detail,_spec)=>({uid:detail.uid,dom:dom(detail),components:[],behaviours:behaviours(detail),eventOrder:detail.eventOrder});var Input=single({name:'Input',configFields:schema$l(),factory:factory$l});var refetchTriggerEvent=generate$6('refetch-trigger-event');var redirectMenuItemInteractionEvent=generate$6('redirect-menu-item-interaction');var menuSearcherClass='tox-menu__searcher';var findWithinSandbox=sandboxComp=>{return descendant(sandboxComp.element,\".\".concat(menuSearcherClass)).bind(inputElem=>sandboxComp.getSystem().getByDom(inputElem).toOptional());};var findWithinMenu=findWithinSandbox;var restoreState=(inputComp,searcherState)=>{Representing.setValue(inputComp,searcherState.fetchPattern);inputComp.element.dom.selectionStart=searcherState.selectionStart;inputComp.element.dom.selectionEnd=searcherState.selectionEnd;};var saveState=inputComp=>{var fetchPattern=Representing.getValue(inputComp);var selectionStart=inputComp.element.dom.selectionStart;var selectionEnd=inputComp.element.dom.selectionEnd;return{fetchPattern,selectionStart,selectionEnd};};var setActiveDescendant=(inputComp,active)=>{getOpt(active.element,'id').each(id=>set$9(inputComp.element,'aria-activedescendant',id));};var renderMenuSearcher=spec=>{var handleByBrowser=(comp,se)=>{se.cut();return Optional.none();};var handleByHighlightedItem=(comp,se)=>{var eventData={interactionEvent:se.event,eventType:se.event.raw.type};emitWith(comp,redirectMenuItemInteractionEvent,eventData);return Optional.some(true);};var customSearcherEventsName='searcher-events';return{dom:{tag:'div',classes:[selectableClass]},components:[Input.sketch({inputClasses:[menuSearcherClass,'tox-textfield'],inputAttributes:_objectSpread(_objectSpread({},spec.placeholder.map(placeholder=>({placeholder:spec.i18n(placeholder)})).getOr({})),{},{'type':'search','aria-autocomplete':'list'}),inputBehaviours:derive$1([config(customSearcherEventsName,[run$1(input(),inputComp=>{emit(inputComp,refetchTriggerEvent);}),run$1(keydown(),(inputComp,se)=>{if(se.event.raw.key==='Escape'){se.stop();}})]),Keying.config({mode:'special',onLeft:handleByBrowser,onRight:handleByBrowser,onSpace:handleByBrowser,onEnter:handleByHighlightedItem,onEscape:handleByHighlightedItem,onUp:handleByHighlightedItem,onDown:handleByHighlightedItem})]),eventOrder:{keydown:[customSearcherEventsName,Keying.name()]}})]};};var searchResultsClass='tox-collection--results__js';var augmentWithAria=item=>{var _a;if(item.dom){return _objectSpread(_objectSpread({},item),{},{dom:_objectSpread(_objectSpread({},item.dom),{},{attributes:_objectSpread(_objectSpread({},(_a=item.dom.attributes)!==null&&_a!==void 0?_a:{}),{},{'id':generate$6('aria-item-search-result-id'),'aria-selected':'false'})})});}else{return item;}};var chunk=(rowDom,numColumns)=>items=>{var chunks=chunk$1(items,numColumns);return map$2(chunks,c=>({dom:rowDom,components:c}));};var forSwatch=columns=>({dom:{tag:'div',classes:['tox-menu','tox-swatches-menu']},components:[{dom:{tag:'div',classes:['tox-swatches']},components:[Menu.parts.items({preprocess:columns!=='auto'?chunk({tag:'div',classes:['tox-swatches__row']},columns):identity})]}]});var forToolbar=columns=>({dom:{tag:'div',classes:['tox-menu','tox-collection','tox-collection--toolbar','tox-collection--toolbar-lg']},components:[Menu.parts.items({preprocess:chunk({tag:'div',classes:['tox-collection__group']},columns)})]});var preprocessCollection=(items,isSeparator)=>{var allSplits=[];var currentSplit=[];each$1(items,(item,i)=>{if(isSeparator(item,i)){if(currentSplit.length>0){allSplits.push(currentSplit);}currentSplit=[];if(has$2(item.dom,'innerHtml')||item.components&&item.components.length>0){currentSplit.push(item);}}else{currentSplit.push(item);}});if(currentSplit.length>0){allSplits.push(currentSplit);}return map$2(allSplits,s=>({dom:{tag:'div',classes:['tox-collection__group']},components:s}));};var insertItemsPlaceholder=(columns,initItems,onItem)=>{return Menu.parts.items({preprocess:rawItems=>{var enrichedItems=map$2(rawItems,onItem);if(columns!=='auto'&&columns>1){return chunk({tag:'div',classes:['tox-collection__group']},columns)(enrichedItems);}else{return preprocessCollection(enrichedItems,(_item,i)=>initItems[i].type==='separator');}}});};var forCollection=function forCollection(columns,initItems){var _hasIcons=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return{dom:{tag:'div',classes:['tox-menu','tox-collection'].concat(columns===1?['tox-collection--list']:['tox-collection--grid'])},components:[insertItemsPlaceholder(columns,initItems,identity)]};};var forCollectionWithSearchResults=function forCollectionWithSearchResults(columns,initItems){var _hasIcons=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var ariaControlsSearchResults=generate$6('aria-controls-search-results');return{dom:{tag:'div',classes:['tox-menu','tox-collection',searchResultsClass].concat(columns===1?['tox-collection--list']:['tox-collection--grid']),attributes:{id:ariaControlsSearchResults}},components:[insertItemsPlaceholder(columns,initItems,augmentWithAria)]};};var forCollectionWithSearchField=(columns,initItems,searchField)=>{var ariaControlsSearchResults=generate$6('aria-controls-search-results');return{dom:{tag:'div',classes:['tox-menu','tox-collection'].concat(columns===1?['tox-collection--list']:['tox-collection--grid'])},components:[renderMenuSearcher({i18n:global$8.translate,placeholder:searchField.placeholder}),{dom:{tag:'div',classes:[...(columns===1?['tox-collection--list']:['tox-collection--grid']),searchResultsClass],attributes:{id:ariaControlsSearchResults}},components:[insertItemsPlaceholder(columns,initItems,augmentWithAria)]}]};};var forHorizontalCollection=function forHorizontalCollection(initItems){var _hasIcons=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return{dom:{tag:'div',classes:['tox-collection','tox-collection--horizontal']},components:[Menu.parts.items({preprocess:items=>preprocessCollection(items,(_item,i)=>initItems[i].type==='separator')})]};};var menuHasIcons=xs=>exists(xs,item=>'icon'in item&&item.icon!==undefined);var handleError=error=>{console.error(formatError(error));console.log(error);return Optional.none();};var createHorizontalPartialMenuWithAlloyItems=(value,_hasIcons,items,_columns,_menuLayout)=>{var structure=forHorizontalCollection(items);return{value,dom:structure.dom,components:structure.components,items};};var createPartialMenuWithAlloyItems=(value,hasIcons,items,columns,menuLayout)=>{var getNormalStructure=()=>{if(menuLayout.menuType!=='searchable'){return forCollection(columns,items);}else{return menuLayout.searchMode.searchMode==='search-with-field'?forCollectionWithSearchField(columns,items,menuLayout.searchMode):forCollectionWithSearchResults(columns,items);}};if(menuLayout.menuType==='color'){var structure=forSwatch(columns);return{value,dom:structure.dom,components:structure.components,items};}else if(menuLayout.menuType==='normal'&&columns==='auto'){var _structure=forCollection(columns,items);return{value,dom:_structure.dom,components:_structure.components,items};}else if(menuLayout.menuType==='normal'||menuLayout.menuType==='searchable'){var _structure2=getNormalStructure();return{value,dom:_structure2.dom,components:_structure2.components,items};}else if(menuLayout.menuType==='listpreview'&&columns!=='auto'){var _structure3=forToolbar(columns);return{value,dom:_structure3.dom,components:_structure3.components,items};}else{return{value,dom:dom$1(hasIcons,columns,menuLayout.menuType),components:components,items};}};var type=requiredString('type');var name$1=requiredString('name');var label=requiredString('label');var text$1=requiredString('text');var title=requiredString('title');var icon=requiredString('icon');var value$1=requiredString('value');var fetch$1=requiredFunction('fetch');var getSubmenuItems=requiredFunction('getSubmenuItems');var onAction=requiredFunction('onAction');var onItemAction=requiredFunction('onItemAction');var onSetup=defaultedFunction('onSetup',()=>noop);var optionalName=optionString('name');var optionalText=optionString('text');var optionalIcon=optionString('icon');var optionalTooltip=optionString('tooltip');var optionalLabel=optionString('label');var optionalShortcut=optionString('shortcut');var optionalSelect=optionFunction('select');var active=defaultedBoolean('active',false);var borderless=defaultedBoolean('borderless',false);var enabled=defaultedBoolean('enabled',true);var primary=defaultedBoolean('primary',false);var defaultedColumns=num=>defaulted('columns',num);var defaultedMeta=defaulted('meta',{});var defaultedOnAction=defaultedFunction('onAction',noop);var defaultedType=type=>defaultedString('type',type);var generatedName=namePrefix=>field$1('name','name',defaultedThunk(()=>generate$6(\"\".concat(namePrefix,\"-name\"))),string);var generatedValue=valuePrefix=>field$1('value','value',defaultedThunk(()=>generate$6(\"\".concat(valuePrefix,\"-value\"))),anyValue());var separatorMenuItemSchema=objOf([type,optionalText]);var createSeparatorMenuItem=spec=>asRaw('separatormenuitem',separatorMenuItemSchema,spec);var autocompleterItemSchema=objOf([defaultedType('autocompleteitem'),active,enabled,defaultedMeta,value$1,optionalText,optionalIcon]);var createSeparatorItem=spec=>asRaw('Autocompleter.Separator',separatorMenuItemSchema,spec);var createAutocompleterItem=spec=>asRaw('Autocompleter.Item',autocompleterItemSchema,spec);var baseToolbarButtonFields=[enabled,optionalTooltip,optionalIcon,optionalText,onSetup];var toolbarButtonSchema=objOf([type,onAction].concat(baseToolbarButtonFields));var createToolbarButton=spec=>asRaw('toolbarbutton',toolbarButtonSchema,spec);var baseToolbarToggleButtonFields=[active].concat(baseToolbarButtonFields);var toggleButtonSchema=objOf(baseToolbarToggleButtonFields.concat([type,onAction]));var createToggleButton=spec=>asRaw('ToggleButton',toggleButtonSchema,spec);var contextBarFields=[defaultedFunction('predicate',never),defaultedStringEnum('scope','node',['node','editor']),defaultedStringEnum('position','selection',['node','selection','line'])];var contextButtonFields=baseToolbarButtonFields.concat([defaultedType('contextformbutton'),primary,onAction,customField('original',identity)]);var contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType('contextformbutton'),primary,onAction,customField('original',identity)]);var launchButtonFields=baseToolbarButtonFields.concat([defaultedType('contextformbutton')]);var launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType('contextformtogglebutton')]);var toggleOrNormal=choose$1('type',{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields});var contextFormSchema=objOf([defaultedType('contextform'),defaultedFunction('initValue',constant$1('')),optionalLabel,requiredArrayOf('commands',toggleOrNormal),optionOf('launch',choose$1('type',{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields));var createContextForm=spec=>asRaw('ContextForm',contextFormSchema,spec);var contextToolbarSchema=objOf([defaultedType('contexttoolbar'),requiredString('items')].concat(contextBarFields));var createContextToolbar=spec=>asRaw('ContextToolbar',contextToolbarSchema,spec);var cardImageFields=[type,requiredString('src'),optionString('alt'),defaultedArrayOf('classes',[],string)];var cardImageSchema=objOf(cardImageFields);var cardTextFields=[type,text$1,optionalName,defaultedArrayOf('classes',['tox-collection__item-label'],string)];var cardTextSchema=objOf(cardTextFields);var itemSchema$1=valueThunk(()=>choose$2('type',{cardimage:cardImageSchema,cardtext:cardTextSchema,cardcontainer:cardContainerSchema}));var cardContainerSchema=objOf([type,defaultedString('direction','horizontal'),defaultedString('align','left'),defaultedString('valign','middle'),requiredArrayOf('items',itemSchema$1)]);var commonMenuItemFields=[enabled,optionalText,optionalShortcut,generatedValue('menuitem'),defaultedMeta];var cardMenuItemSchema=objOf([type,optionalLabel,requiredArrayOf('items',itemSchema$1),onSetup,defaultedOnAction].concat(commonMenuItemFields));var createCardMenuItem=spec=>asRaw('cardmenuitem',cardMenuItemSchema,spec);var choiceMenuItemSchema=objOf([type,active,optionalIcon].concat(commonMenuItemFields));var createChoiceMenuItem=spec=>asRaw('choicemenuitem',choiceMenuItemSchema,spec);var baseFields=[type,requiredString('fancytype'),defaultedOnAction];var insertTableFields=[defaulted('initData',{})].concat(baseFields);var colorSwatchFields=[optionFunction('select'),defaultedObjOf('initData',{},[defaultedBoolean('allowCustomColors',true),defaultedString('storageKey','default'),optionArrayOf('colors',anyValue())])].concat(baseFields);var fancyMenuItemSchema=choose$1('fancytype',{inserttable:insertTableFields,colorswatch:colorSwatchFields});var createFancyMenuItem=spec=>asRaw('fancymenuitem',fancyMenuItemSchema,spec);var menuItemSchema=objOf([type,onSetup,defaultedOnAction,optionalIcon].concat(commonMenuItemFields));var createMenuItem=spec=>asRaw('menuitem',menuItemSchema,spec);var nestedMenuItemSchema=objOf([type,getSubmenuItems,onSetup,optionalIcon].concat(commonMenuItemFields));var createNestedMenuItem=spec=>asRaw('nestedmenuitem',nestedMenuItemSchema,spec);var toggleMenuItemSchema=objOf([type,optionalIcon,active,onSetup,onAction].concat(commonMenuItemFields));var createToggleMenuItem=spec=>asRaw('togglemenuitem',toggleMenuItemSchema,spec);var detectSize=(comp,margin,selectorClass)=>{var descendants$1=descendants(comp.element,'.'+selectorClass);if(descendants$1.length>0){var columnLength=findIndex$1(descendants$1,c=>{var thisTop=c.dom.getBoundingClientRect().top;var cTop=descendants$1[0].dom.getBoundingClientRect().top;return Math.abs(thisTop-cTop)>margin;}).getOr(descendants$1.length);return Optional.some({numColumns:columnLength,numRows:Math.ceil(descendants$1.length/columnLength)});}else{return Optional.none();}};var namedEvents=(name,handlers)=>derive$1([config(name,handlers)]);var unnamedEvents=handlers=>namedEvents(generate$6('unnamed-events'),handlers);var SimpleBehaviours={namedEvents,unnamedEvents};var ExclusivityChannel=generate$6('tooltip.exclusive');var ShowTooltipEvent=generate$6('tooltip.show');var HideTooltipEvent=generate$6('tooltip.hide');var hideAllExclusive=(component,_tConfig,_tState)=>{component.getSystem().broadcastOn([ExclusivityChannel],{});};var setComponents=(component,tConfig,tState,specs)=>{tState.getTooltip().each(tooltip=>{if(tooltip.getSystem().isConnected()){Replacing.set(tooltip,specs);}});};var TooltippingApis=/*#__PURE__*/Object.freeze({__proto__:null,hideAllExclusive:hideAllExclusive,setComponents:setComponents});var events$9=(tooltipConfig,state)=>{var hide=comp=>{state.getTooltip().each(p=>{detach(p);tooltipConfig.onHide(comp,p);state.clearTooltip();});state.clearTimer();};var show=comp=>{if(!state.isShowing()){hideAllExclusive(comp);var sink=tooltipConfig.lazySink(comp).getOrDie();var popup=comp.getSystem().build({dom:tooltipConfig.tooltipDom,components:tooltipConfig.tooltipComponents,events:derive$2(tooltipConfig.mode==='normal'?[run$1(mouseover(),_=>{emit(comp,ShowTooltipEvent);}),run$1(mouseout(),_=>{emit(comp,HideTooltipEvent);})]:[]),behaviours:derive$1([Replacing.config({})])});state.setTooltip(popup);attach(sink,popup);tooltipConfig.onShow(comp,popup);Positioning.position(sink,popup,{anchor:tooltipConfig.anchor(comp)});}};return derive$2(flatten([[run$1(ShowTooltipEvent,comp=>{state.resetTimer(()=>{show(comp);},tooltipConfig.delay);}),run$1(HideTooltipEvent,comp=>{state.resetTimer(()=>{hide(comp);},tooltipConfig.delay);}),run$1(receive(),(comp,message)=>{var receivingData=message;if(!receivingData.universal){if(contains$2(receivingData.channels,ExclusivityChannel)){hide(comp);}}}),runOnDetached(comp=>{hide(comp);})],tooltipConfig.mode==='normal'?[run$1(focusin(),comp=>{emit(comp,ShowTooltipEvent);}),run$1(postBlur(),comp=>{emit(comp,HideTooltipEvent);}),run$1(mouseover(),comp=>{emit(comp,ShowTooltipEvent);}),run$1(mouseout(),comp=>{emit(comp,HideTooltipEvent);})]:[run$1(highlight$1(),(comp,_se)=>{emit(comp,ShowTooltipEvent);}),run$1(dehighlight$1(),comp=>{emit(comp,HideTooltipEvent);})]]));};var ActiveTooltipping=/*#__PURE__*/Object.freeze({__proto__:null,events:events$9});var TooltippingSchema=[required$1('lazySink'),required$1('tooltipDom'),defaulted('exclusive',true),defaulted('tooltipComponents',[]),defaulted('delay',300),defaultedStringEnum('mode','normal',['normal','follow-highlight']),defaulted('anchor',comp=>({type:'hotspot',hotspot:comp,layouts:{onLtr:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2]),onRtl:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2])}})),onHandler('onHide'),onHandler('onShow')];var init$b=()=>{var timer=value$2();var popup=value$2();var clearTimer=()=>{timer.on(clearTimeout);};var resetTimer=(f,delay)=>{clearTimer();timer.set(setTimeout(f,delay));};var readState=constant$1('not-implemented');return nu$8({getTooltip:popup.get,isShowing:popup.isSet,setTooltip:popup.set,clearTooltip:popup.clear,clearTimer,resetTimer,readState});};var TooltippingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$b});var Tooltipping=create$4({fields:TooltippingSchema,name:'tooltipping',active:ActiveTooltipping,state:TooltippingState,apis:TooltippingApis});var escape=text=>text.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\\\$&');var ReadOnlyChannel='silver.readonly';var ReadOnlyDataSchema=objOf([requiredBoolean('readonly')]);var broadcastReadonly=(uiRefs,readonly)=>{var outerContainer=uiRefs.mainUi.outerContainer;var target=outerContainer.element;var motherships=[uiRefs.mainUi.mothership,...uiRefs.uiMotherships];if(readonly){each$1(motherships,m=>{m.broadcastOn([dismissPopups()],{target});});}each$1(motherships,m=>{m.broadcastOn([ReadOnlyChannel],{readonly});});};var setupReadonlyModeSwitch=(editor,uiRefs)=>{editor.on('init',()=>{if(editor.mode.isReadOnly()){broadcastReadonly(uiRefs,true);}});editor.on('SwitchMode',()=>broadcastReadonly(uiRefs,editor.mode.isReadOnly()));if(isReadOnly(editor)){editor.mode.set('readonly');}};var receivingConfig=()=>Receiving.config({channels:{[ReadOnlyChannel]:{schema:ReadOnlyDataSchema,onReceive:(comp,data)=>{Disabling.set(comp,data.readonly);}}}});var item=disabled=>Disabling.config({disabled,disableClass:'tox-collection__item--state-disabled'});var button=disabled=>Disabling.config({disabled});var splitButton=disabled=>Disabling.config({disabled,disableClass:'tox-tbtn--disabled'});var toolbarButton=disabled=>Disabling.config({disabled,disableClass:'tox-tbtn--disabled',useNative:false});var DisablingConfigs={item,button,splitButton,toolbarButton};var runWithApi=(info,comp)=>{var api=info.getApi(comp);return f=>{f(api);};};var onControlAttached=(info,editorOffCell)=>runOnAttached(comp=>{var run=runWithApi(info,comp);run(api=>{var onDestroy=info.onSetup(api);if(isFunction(onDestroy)){editorOffCell.set(onDestroy);}});});var onControlDetached=(getApi,editorOffCell)=>runOnDetached(comp=>runWithApi(getApi,comp)(editorOffCell.get()));var onMenuItemExecute=(info,itemResponse)=>runOnExecute$1((comp,simulatedEvent)=>{runWithApi(info,comp)(info.onAction);if(!info.triggersSubmenu&&itemResponse===ItemResponse$1.CLOSE_ON_EXECUTE){if(comp.getSystem().isConnected()){emit(comp,sandboxClose());}simulatedEvent.stop();}});var menuItemEventOrder={[execute$5()]:['disabling','alloy.base.behaviour','toggling','item-events']};var componentRenderPipeline=cat;var renderCommonItem=(spec,structure,itemResponse,providersBackstage)=>{var editorOffCell=Cell(noop);return{type:'item',dom:structure.dom,components:componentRenderPipeline(structure.optComponents),data:spec.data,eventOrder:menuItemEventOrder,hasSubmenu:spec.triggersSubmenu,itemBehaviours:derive$1([config('item-events',[onMenuItemExecute(spec,itemResponse),onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),DisablingConfigs.item(()=>!spec.enabled||providersBackstage.isDisabled()),receivingConfig(),Replacing.config({})].concat(spec.itemBehaviours))};};var buildData=source=>({value:source.value,meta:_objectSpread({text:source.text.getOr('')},source.meta)});var convertText=source=>{var isMac=global$5.os.isMacOS()||global$5.os.isiOS();var mac={alt:'\\u2325',ctrl:'\\u2303',shift:'\\u21E7',meta:'\\u2318',access:'\\u2303\\u2325'};var other={meta:'Ctrl',access:'Shift+Alt'};var replace=isMac?mac:other;var shortcut=source.split('+');var updated=map$2(shortcut,segment=>{var search=segment.toLowerCase().trim();return has$2(replace,search)?replace[search]:segment;});return isMac?updated.join(''):updated.join('+');};var renderIcon$2=function renderIcon$2(name,icons){var classes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[iconClass];return render$3(name,{tag:'div',classes},icons);};var renderText=text=>({dom:{tag:'div',classes:[textClass]},components:[text$2(global$8.translate(text))]});var renderHtml=(html,classes)=>({dom:{tag:'div',classes,innerHtml:html}});var renderStyledText=(style,text)=>({dom:{tag:'div',classes:[textClass]},components:[{dom:{tag:style.tag,styles:style.styles},components:[text$2(global$8.translate(text))]}]});var renderShortcut=shortcut=>({dom:{tag:'div',classes:[accessoryClass]},components:[text$2(convertText(shortcut))]});var renderCheckmark=icons=>renderIcon$2('checkmark',icons,[checkmarkClass]);var renderSubmenuCaret=icons=>renderIcon$2('chevron-right',icons,[caretClass]);var renderDownwardsCaret=icons=>renderIcon$2('chevron-down',icons,[caretClass]);var renderContainer=(container,components)=>{var directionClass=container.direction==='vertical'?containerColumnClass:containerRowClass;var alignClass=container.align==='left'?containerAlignLeftClass:containerAlignRightClass;var getValignClass=()=>{switch(container.valign){case'top':return containerValignTopClass;case'middle':return containerValignMiddleClass;case'bottom':return containerValignBottomClass;}};return{dom:{tag:'div',classes:[containerClass,directionClass,alignClass,getValignClass()]},components};};var renderImage=(src,classes,alt)=>({dom:{tag:'img',classes,attributes:{src,alt:alt.getOr('')}}});var renderColorStructure=(item,providerBackstage,fallbackIcon)=>{var colorPickerCommand='custom';var removeColorCommand='remove';var itemText=item.ariaLabel;var itemValue=item.value;var iconSvg=item.iconContent.map(name=>getOr(name,providerBackstage.icons,fallbackIcon));var getDom=()=>{var common=colorClass;var icon=iconSvg.getOr('');var attributes=itemText.map(text=>({title:providerBackstage.translate(text)})).getOr({});var baseDom={tag:'div',attributes,classes:[common]};if(itemValue===colorPickerCommand){return _objectSpread(_objectSpread({},baseDom),{},{tag:'button',classes:[...baseDom.classes,'tox-swatches__picker-btn'],innerHtml:icon});}else if(itemValue===removeColorCommand){return _objectSpread(_objectSpread({},baseDom),{},{classes:[...baseDom.classes,'tox-swatch--remove'],innerHtml:icon});}else if(isNonNullable(itemValue)){return _objectSpread(_objectSpread({},baseDom),{},{attributes:_objectSpread(_objectSpread({},baseDom.attributes),{},{'data-mce-color':itemValue}),styles:{'background-color':itemValue},innerHtml:icon});}else{return baseDom;}};return{dom:getDom(),optComponents:[]};};var renderItemDomStructure=ariaLabel=>{var domTitle=ariaLabel.map(label=>({attributes:{title:global$8.translate(label),id:generate$6('menu-item')}})).getOr({});return _objectSpread({tag:'div',classes:[navClass,selectableClass]},domTitle);};var renderNormalItemStructure=(info,providersBackstage,renderIcons,fallbackIcon)=>{var iconSpec={tag:'div',classes:[iconClass]};var renderIcon=iconName=>render$3(iconName,iconSpec,providersBackstage.icons,fallbackIcon);var renderEmptyIcon=()=>Optional.some({dom:iconSpec});var leftIcon=renderIcons?info.iconContent.map(renderIcon).orThunk(renderEmptyIcon):Optional.none();var checkmark=info.checkMark;var textRender=Optional.from(info.meta).fold(()=>renderText,meta=>has$2(meta,'style')?curry(renderStyledText,meta.style):renderText);var content=info.htmlContent.fold(()=>info.textContent.map(textRender),html=>Optional.some(renderHtml(html,[textClass])));var menuItem={dom:renderItemDomStructure(info.ariaLabel),optComponents:[leftIcon,content,info.shortcutContent.map(renderShortcut),checkmark,info.caret]};return menuItem;};var renderItemStructure=function renderItemStructure(info,providersBackstage,renderIcons){var fallbackIcon=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Optional.none();if(info.presets==='color'){return renderColorStructure(info,providersBackstage,fallbackIcon);}else{return renderNormalItemStructure(info,providersBackstage,renderIcons,fallbackIcon);}};var tooltipBehaviour=(meta,sharedBackstage)=>get$g(meta,'tooltipWorker').map(tooltipWorker=>[Tooltipping.config({lazySink:sharedBackstage.getSink,tooltipDom:{tag:'div',classes:['tox-tooltip-worker-container']},tooltipComponents:[],anchor:comp=>({type:'submenu',item:comp,overrides:{maxHeightFunction:expandable$1}}),mode:'follow-highlight',onShow:(component,_tooltip)=>{tooltipWorker(elm=>{Tooltipping.setComponents(component,[external$1({element:SugarElement.fromDom(elm)})]);});}})]).getOr([]);var encodeText=text=>global$7.DOM.encode(text);var replaceText=(text,matchText)=>{var translated=global$8.translate(text);var encoded=encodeText(translated);if(matchText.length>0){var escapedMatchRegex=new RegExp(escape(matchText),'gi');return encoded.replace(escapedMatchRegex,match=>\"<span class=\\\"tox-autocompleter-highlight\\\">\".concat(match,\"</span>\"));}else{return encoded;}};var renderAutocompleteItem=function renderAutocompleteItem(spec,matchText,useText,presets,onItemValueHandler,itemResponse,sharedBackstage){var renderIcons=arguments.length>7&&arguments[7]!==undefined?arguments[7]:true;var structure=renderItemStructure({presets,textContent:Optional.none(),htmlContent:useText?spec.text.map(text=>replaceText(text,matchText)):Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:Optional.none(),checkMark:Optional.none(),caret:Optional.none(),value:spec.value},sharedBackstage.providers,renderIcons,spec.icon);return renderCommonItem({data:buildData(spec),enabled:spec.enabled,getApi:constant$1({}),onAction:_api=>onItemValueHandler(spec.value,spec.meta),onSetup:constant$1(noop),triggersSubmenu:false,itemBehaviours:tooltipBehaviour(spec.meta,sharedBackstage)},structure,itemResponse,sharedBackstage.providers);};var render$2=(items,extras)=>map$2(items,item=>{switch(item.type){case'cardcontainer':return renderContainer(item,render$2(item.items,extras));case'cardimage':return renderImage(item.src,item.classes,item.alt);case'cardtext':var shouldHighlight=item.name.exists(name=>contains$2(extras.cardText.highlightOn,name));var matchText=shouldHighlight?Optional.from(extras.cardText.matchText).getOr(''):'';return renderHtml(replaceText(item.text,matchText),item.classes);}});var renderCardMenuItem=(spec,itemResponse,sharedBackstage,extras)=>{var getApi=component=>({isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>{Disabling.set(component,!state);each$1(descendants(component.element,'*'),elm=>{component.getSystem().getByDom(elm).each(comp=>{if(comp.hasConfigured(Disabling)){Disabling.set(comp,!state);}});});}});var structure={dom:renderItemDomStructure(spec.label),optComponents:[Optional.some({dom:{tag:'div',classes:[containerClass,containerRowClass]},components:render$2(spec.items,extras)})]};return renderCommonItem({data:buildData(_objectSpread({text:Optional.none()},spec)),enabled:spec.enabled,getApi,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:false,itemBehaviours:Optional.from(extras.itemBehaviours).getOr([])},structure,itemResponse,sharedBackstage.providers);};var renderChoiceItem=function renderChoiceItem(spec,useText,presets,onItemValueHandler,isSelected,itemResponse,providersBackstage){var renderIcons=arguments.length>7&&arguments[7]!==undefined?arguments[7]:true;var getApi=component=>({setActive:state=>{Toggling.set(component,state);},isActive:()=>Toggling.isOn(component),isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state)});var structure=renderItemStructure({presets,textContent:useText?spec.text:Optional.none(),htmlContent:Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:useText?spec.shortcut:Optional.none(),checkMark:useText?Optional.some(renderCheckmark(providersBackstage.icons)):Optional.none(),caret:Optional.none(),value:spec.value},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),enabled:spec.enabled,getApi,onAction:_api=>onItemValueHandler(spec.value),onSetup:api=>{api.setActive(isSelected);return noop;},triggersSubmenu:false,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:tickedClass,toggleOnExecute:false,selected:spec.active,exclusive:true}});};var parts$f=generate$3(owner$2(),parts$h());var hexColour=value=>({value:normalizeHex(value)});var shorthandRegex=/^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;var longformRegex=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;var isHexString=hex=>shorthandRegex.test(hex)||longformRegex.test(hex);var normalizeHex=hex=>removeLeading(hex,'#').toUpperCase();var fromString$1=hex=>isHexString(hex)?Optional.some({value:normalizeHex(hex)}):Optional.none();var getLongForm=hex=>{var hexString=hex.value.replace(shorthandRegex,(m,r,g,b)=>r+r+g+g+b+b);return{value:hexString};};var extractValues=hex=>{var longForm=getLongForm(hex);var splitForm=longformRegex.exec(longForm.value);return splitForm===null?['FFFFFF','FF','FF','FF']:splitForm;};var toHex=component=>{var hex=component.toString(16);return(hex.length===1?'0'+hex:hex).toUpperCase();};var fromRgba=rgbaColour=>{var value=toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue);return hexColour(value);};var min=Math.min;var max=Math.max;var round$1=Math.round;var rgbRegex=/^\\s*rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)\\s*$/i;var rgbaRegex=/^\\s*rgba\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?(?:\\.\\d+)?)\\s*\\)\\s*$/i;var rgbaColour=(red,green,blue,alpha)=>({red,green,blue,alpha});var isRgbaComponent=value=>{var num=parseInt(value,10);return num.toString()===value&&num>=0&&num<=255;};var fromHsv=hsv=>{var r;var g;var b;var hue=(hsv.hue||0)%360;var saturation=hsv.saturation/100;var brightness=hsv.value/100;saturation=max(0,min(saturation,1));brightness=max(0,min(brightness,1));if(saturation===0){r=g=b=round$1(255*brightness);return rgbaColour(r,g,b,1);}var side=hue/60;var chroma=brightness*saturation;var x=chroma*(1-Math.abs(side%2-1));var match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma;g=x;b=0;break;case 1:r=x;g=chroma;b=0;break;case 2:r=0;g=chroma;b=x;break;case 3:r=0;g=x;b=chroma;break;case 4:r=x;g=0;b=chroma;break;case 5:r=chroma;g=0;b=x;break;default:r=g=b=0;}r=round$1(255*(r+match));g=round$1(255*(g+match));b=round$1(255*(b+match));return rgbaColour(r,g,b,1);};var fromHex=hexColour=>{var result=extractValues(hexColour);var red=parseInt(result[1],16);var green=parseInt(result[2],16);var blue=parseInt(result[3],16);return rgbaColour(red,green,blue,1);};var fromStringValues=(red,green,blue,alpha)=>{var r=parseInt(red,10);var g=parseInt(green,10);var b=parseInt(blue,10);var a=parseFloat(alpha);return rgbaColour(r,g,b,a);};var fromString=rgbaString=>{if(rgbaString==='transparent'){return Optional.some(rgbaColour(0,0,0,0));}var rgbMatch=rgbRegex.exec(rgbaString);if(rgbMatch!==null){return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],'1'));}var rgbaMatch=rgbaRegex.exec(rgbaString);if(rgbaMatch!==null){return Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4]));}return Optional.none();};var toString=rgba=>\"rgba(\".concat(rgba.red,\",\").concat(rgba.green,\",\").concat(rgba.blue,\",\").concat(rgba.alpha,\")\");var red=rgbaColour(255,0,0,1);var fireSkinLoaded$1=editor=>{editor.dispatch('SkinLoaded');};var fireSkinLoadError$1=(editor,error)=>{editor.dispatch('SkinLoadError',error);};var fireResizeEditor=editor=>{editor.dispatch('ResizeEditor');};var fireResizeContent=(editor,e)=>{editor.dispatch('ResizeContent',e);};var fireScrollContent=(editor,e)=>{editor.dispatch('ScrollContent',e);};var fireTextColorChange=(editor,data)=>{editor.dispatch('TextColorChange',data);};var fireAfterProgressState=(editor,state)=>{editor.dispatch('AfterProgressState',{state});};var fireResolveName=(editor,node)=>editor.dispatch('ResolveName',{name:node.nodeName.toLowerCase(),target:node});var fireToggleToolbarDrawer=(editor,state)=>{editor.dispatch('ToggleToolbarDrawer',{state});};var composeUnbinders=(f,g)=>()=>{f();g();};var onSetupEditableToggle=editor=>onSetupEvent(editor,'NodeChange',api=>{api.setEnabled(editor.selection.isEditable());});var onSetupFormatToggle=(editor,name)=>api=>{var boundFormatChangeCallback=unbindable();var init=()=>{api.setActive(editor.formatter.match(name));var binding=editor.formatter.formatChanged(name,api.setActive);boundFormatChangeCallback.set(binding);};editor.initialized?init():editor.once('init',init);return()=>{editor.off('init',init);boundFormatChangeCallback.clear();};};var onSetupStateToggle=(editor,name)=>api=>{var unbindEditableToogle=onSetupEditableToggle(editor)(api);var unbindFormatToggle=onSetupFormatToggle(editor,name)(api);return()=>{unbindEditableToogle();unbindFormatToggle();};};var onSetupEvent=(editor,event,f)=>api=>{var handleEvent=()=>f(api);var init=()=>{f(api);editor.on(event,handleEvent);};editor.initialized?init():editor.once('init',init);return()=>{editor.off('init',init);editor.off(event,handleEvent);};};var onActionToggleFormat$1=editor=>rawItem=>()=>{editor.undoManager.transact(()=>{editor.focus();editor.execCommand('mceToggleFormat',false,rawItem.format);});};var onActionExecCommand=(editor,command)=>()=>editor.execCommand(command);var global$4=tinymce.util.Tools.resolve('tinymce.util.LocalStorage');var cacheStorage={};var ColorCache=function ColorCache(storageId){var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;var storageString=global$4.getItem(storageId);var localstorage=isString(storageString)?JSON.parse(storageString):[];var prune=list=>{var diff=max-list.length;return diff<0?list.slice(0,max):list;};var cache=prune(localstorage);var add=key=>{indexOf(cache,key).each(remove);cache.unshift(key);if(cache.length>max){cache.pop();}global$4.setItem(storageId,JSON.stringify(cache));};var remove=idx=>{cache.splice(idx,1);};var state=()=>cache.slice(0);return{add,state};};var getCacheForId=id=>get$g(cacheStorage,id).getOrThunk(()=>{var storageId=\"tinymce-custom-colors-\".concat(id);var currentData=global$4.getItem(storageId);if(isNullable(currentData)){var legacyDefault=global$4.getItem('tinymce-custom-colors');global$4.setItem(storageId,isNonNullable(legacyDefault)?legacyDefault:'[]');}var storage=ColorCache(storageId,10);cacheStorage[id]=storage;return storage;});var getCurrentColors=id=>map$2(getCacheForId(id).state(),color=>({type:'choiceitem',text:color,icon:'checkmark',value:color}));var addColor=(id,color)=>{getCacheForId(id).add(color);};var hsvColour=(hue,saturation,value)=>({hue,saturation,value});var fromRgb=rgbaColour=>{var h=0;var s=0;var v=0;var r=rgbaColour.red/255;var g=rgbaColour.green/255;var b=rgbaColour.blue/255;var minRGB=Math.min(r,Math.min(g,b));var maxRGB=Math.max(r,Math.max(g,b));if(minRGB===maxRGB){v=minRGB;return hsvColour(0,0,v*100);}var d=r===minRGB?g-b:b===minRGB?r-g:b-r;h=r===minRGB?3:b===minRGB?1:5;h=60*(h-d/(maxRGB-minRGB));s=(maxRGB-minRGB)/maxRGB;v=maxRGB;return hsvColour(Math.round(h),Math.round(s*100),Math.round(v*100));};var hexToHsv=hex=>fromRgb(fromHex(hex));var hsvToHex=hsv=>fromRgba(fromHsv(hsv));var anyToHex=color=>fromString$1(color).orThunk(()=>fromString(color).map(fromRgba)).getOrThunk(()=>{var canvas=document.createElement('canvas');canvas.height=1;canvas.width=1;var canvasContext=canvas.getContext('2d');canvasContext.clearRect(0,0,canvas.width,canvas.height);canvasContext.fillStyle='#FFFFFF';canvasContext.fillStyle=color;canvasContext.fillRect(0,0,1,1);var rgba=canvasContext.getImageData(0,0,1,1).data;var r=rgba[0];var g=rgba[1];var b=rgba[2];var a=rgba[3];return fromRgba(rgbaColour(r,g,b,a));});var foregroundId='forecolor';var backgroundId='hilitecolor';var fallbackCols=5;var mapColors=colorMap=>{var colors=[];for(var i=0;i<colorMap.length;i+=2){colors.push({text:colorMap[i+1],value:'#'+anyToHex(colorMap[i]).value,icon:'checkmark',type:'choiceitem'});}return colors;};var option$1=name=>editor=>editor.options.get(name);var fallbackColor='#000000';var register$d=editor=>{var registerOption=editor.options.register;var colorProcessor=value=>{if(isArrayOf(value,isString)){return{value:mapColors(value),valid:true};}else{return{valid:false,message:'Must be an array of strings.'};}};var colorColsProcessor=value=>{if(isNumber(value)&&value>0){return{value,valid:true};}else{return{valid:false,message:'Must be a positive number.'};}};registerOption('color_map',{processor:colorProcessor,default:['#BFEDD2','Light Green','#FBEEB8','Light Yellow','#F8CAC6','Light Red','#ECCAFA','Light Purple','#C2E0F4','Light Blue','#2DC26B','Green','#F1C40F','Yellow','#E03E2D','Red','#B96AD9','Purple','#3598DB','Blue','#169179','Dark Turquoise','#E67E23','Orange','#BA372A','Dark Red','#843FA1','Dark Purple','#236FA1','Dark Blue','#ECF0F1','Light Gray','#CED4D9','Medium Gray','#95A5A6','Gray','#7E8C8D','Dark Gray','#34495E','Navy Blue','#000000','Black','#ffffff','White']});registerOption('color_map_background',{processor:colorProcessor});registerOption('color_map_foreground',{processor:colorProcessor});registerOption('color_cols',{processor:colorColsProcessor,default:calcCols(editor)});registerOption('color_cols_foreground',{processor:colorColsProcessor,default:defaultCols(editor,foregroundId)});registerOption('color_cols_background',{processor:colorColsProcessor,default:defaultCols(editor,backgroundId)});registerOption('custom_colors',{processor:'boolean',default:true});registerOption('color_default_foreground',{processor:'string',default:fallbackColor});registerOption('color_default_background',{processor:'string',default:fallbackColor});};var getColors$2=(editor,id)=>{if(id===foregroundId&&editor.options.isSet('color_map_foreground')){return option$1('color_map_foreground')(editor);}else if(id===backgroundId&&editor.options.isSet('color_map_background')){return option$1('color_map_background')(editor);}else{return option$1('color_map')(editor);}};var calcCols=function calcCols(editor){var id=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'default';return Math.max(fallbackCols,Math.ceil(Math.sqrt(getColors$2(editor,id).length)));};var defaultCols=(editor,id)=>{var defaultCols=option$1('color_cols')(editor);var calculatedCols=calcCols(editor,id);if(defaultCols===calcCols(editor)){return calculatedCols;}else{return defaultCols;}};var getColorCols$1=function getColorCols$1(editor){var id=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'default';var getCols=()=>{if(id===foregroundId){return option$1('color_cols_foreground')(editor);}else if(id===backgroundId){return option$1('color_cols_background')(editor);}else{return option$1('color_cols')(editor);}};return Math.round(getCols());};var hasCustomColors$1=option$1('custom_colors');var getDefaultForegroundColor=option$1('color_default_foreground');var getDefaultBackgroundColor=option$1('color_default_background');var defaultBackgroundColor='rgba(0, 0, 0, 0)';var isValidBackgroundColor=value=>fromString(value).exists(c=>c.alpha!==0);var getClosestCssBackgroundColorValue=scope=>{return closest$4(scope,node=>{if(isElement$1(node)){var color=get$e(node,'background-color');return someIf(isValidBackgroundColor(color),color);}else{return Optional.none();}}).getOr(defaultBackgroundColor);};var getCurrentColor=(editor,format)=>{var node=SugarElement.fromDom(editor.selection.getStart());var cssRgbValue=format==='hilitecolor'?getClosestCssBackgroundColorValue(node):get$e(node,'color');return fromString(cssRgbValue).map(rgba=>'#'+fromRgba(rgba).value);};var applyFormat=(editor,format,value)=>{editor.undoManager.transact(()=>{editor.focus();editor.formatter.apply(format,{value});editor.nodeChanged();});};var removeFormat=(editor,format)=>{editor.undoManager.transact(()=>{editor.focus();editor.formatter.remove(format,{value:null},undefined,true);editor.nodeChanged();});};var registerCommands=editor=>{editor.addCommand('mceApplyTextcolor',(format,value)=>{applyFormat(editor,format,value);});editor.addCommand('mceRemoveTextcolor',format=>{removeFormat(editor,format);});};var getAdditionalColors=hasCustom=>{var type='choiceitem';var remove={type,text:'Remove color',icon:'color-swatch-remove-color',value:'remove'};var custom={type,text:'Custom color',icon:'color-picker',value:'custom'};return hasCustom?[remove,custom]:[remove];};var applyColor=(editor,format,value,onChoice)=>{if(value==='custom'){var dialog=colorPickerDialog(editor);dialog(colorOpt=>{colorOpt.each(color=>{addColor(format,color);editor.execCommand('mceApplyTextcolor',format,color);onChoice(color);});},getCurrentColor(editor,format).getOr(fallbackColor));}else if(value==='remove'){onChoice('');editor.execCommand('mceRemoveTextcolor',format);}else{onChoice(value);editor.execCommand('mceApplyTextcolor',format,value);}};var getColors$1=(colors,id,hasCustom)=>colors.concat(getCurrentColors(id).concat(getAdditionalColors(hasCustom)));var getFetch$1=(colors,id,hasCustom)=>callback=>{callback(getColors$1(colors,id,hasCustom));};var setIconColor=(splitButtonApi,name,newColor)=>{var id=name==='forecolor'?'tox-icon-text-color__color':'tox-icon-highlight-bg-color__color';splitButtonApi.setIconFill(id,newColor);};var select$1=(editor,format)=>value=>{var optCurrentHex=getCurrentColor(editor,format);return is$1(optCurrentHex,value.toUpperCase());};var registerTextColorButton=(editor,name,format,tooltip,lastColor)=>{editor.ui.registry.addSplitButton(name,{tooltip,presets:'color',icon:name==='forecolor'?'text-color':'highlight-bg-color',select:select$1(editor,format),columns:getColorCols$1(editor,format),fetch:getFetch$1(getColors$2(editor,format),format,hasCustomColors$1(editor)),onAction:_splitButtonApi=>{applyColor(editor,format,lastColor.get(),noop);},onItemAction:(_splitButtonApi,value)=>{applyColor(editor,format,value,newColor=>{lastColor.set(newColor);fireTextColorChange(editor,{name,color:newColor});});},onSetup:splitButtonApi=>{setIconColor(splitButtonApi,name,lastColor.get());var handler=e=>{if(e.name===name){setIconColor(splitButtonApi,e.name,e.color);}};editor.on('TextColorChange',handler);return composeUnbinders(onSetupEditableToggle(editor)(splitButtonApi),()=>{editor.off('TextColorChange',handler);});}});};var registerTextColorMenuItem=(editor,name,format,text,lastColor)=>{editor.ui.registry.addNestedMenuItem(name,{text,icon:name==='forecolor'?'text-color':'highlight-bg-color',onSetup:api=>{setIconColor(api,name,lastColor.get());return onSetupEditableToggle(editor)(api);},getSubmenuItems:()=>[{type:'fancymenuitem',fancytype:'colorswatch',select:select$1(editor,format),initData:{storageKey:format},onAction:data=>{applyColor(editor,format,data.value,newColor=>{lastColor.set(newColor);fireTextColorChange(editor,{name,color:newColor});});}}]});};var colorPickerDialog=editor=>(callback,value)=>{var isValid=false;var onSubmit=api=>{var data=api.getData();var hex=data.colorpicker;if(isValid){callback(Optional.from(hex));api.close();}else{editor.windowManager.alert(editor.translate(['Invalid hex color code: {0}',hex]));}};var onAction=(_api,details)=>{if(details.name==='hex-valid'){isValid=details.value;}};var initialData={colorpicker:value};editor.windowManager.open({title:'Color Picker',size:'normal',body:{type:'panel',items:[{type:'colorpicker',name:'colorpicker',label:'Color'}]},buttons:[{type:'cancel',name:'cancel',text:'Cancel'},{type:'submit',name:'save',text:'Save',primary:true}],initialData,onAction,onSubmit,onClose:noop,onCancel:()=>{callback(Optional.none());}});};var register$c=editor=>{registerCommands(editor);var fallbackColorForeground=getDefaultForegroundColor(editor);var fallbackColorBackground=getDefaultBackgroundColor(editor);var lastForeColor=Cell(fallbackColorForeground);var lastBackColor=Cell(fallbackColorBackground);registerTextColorButton(editor,'forecolor','forecolor','Text color',lastForeColor);registerTextColorButton(editor,'backcolor','hilitecolor','Background color',lastBackColor);registerTextColorMenuItem(editor,'forecolor','forecolor','Text color',lastForeColor);registerTextColorMenuItem(editor,'backcolor','hilitecolor','Background color',lastBackColor);};var createPartialChoiceMenu=(value,items,onItemValueHandler,columns,presets,itemResponse,select,providersBackstage)=>{var hasIcons=menuHasIcons(items);var presetItemTypes=presets!=='color'?'normal':'color';var alloyItems=createChoiceItems(items,onItemValueHandler,columns,presetItemTypes,itemResponse,select,providersBackstage);var menuLayout={menuType:presets};return createPartialMenuWithAlloyItems(value,hasIcons,alloyItems,columns,menuLayout);};var createChoiceItems=(items,onItemValueHandler,columns,itemPresets,itemResponse,select,providersBackstage)=>cat(map$2(items,item=>{if(item.type==='choiceitem'){return createChoiceMenuItem(item).fold(handleError,d=>Optional.some(renderChoiceItem(d,columns===1,itemPresets,onItemValueHandler,select(d.value),itemResponse,providersBackstage,menuHasIcons(items))));}else{return Optional.none();}}));var deriveMenuMovement=(columns,presets)=>{var menuMarkers=markers(presets);if(columns===1){return{mode:'menu',moveOnTab:true};}else if(columns==='auto'){return{mode:'grid',selector:'.'+menuMarkers.item,initSize:{numColumns:1,numRows:1}};}else{var rowClass=presets==='color'?'tox-swatches__row':'tox-collection__group';return{mode:'matrix',rowSelector:'.'+rowClass,previousSelector:menu=>{return presets==='color'?descendant(menu.element,'[aria-checked=true]'):Optional.none();}};}};var deriveCollectionMovement=(columns,presets)=>{if(columns===1){return{mode:'menu',moveOnTab:false,selector:'.tox-collection__item'};}else if(columns==='auto'){return{mode:'flatgrid',selector:'.'+'tox-collection__item',initSize:{numColumns:1,numRows:1}};}else{return{mode:'matrix',selectors:{row:presets==='color'?'.tox-swatches__row':'.tox-collection__group',cell:presets==='color'?\".\".concat(colorClass):\".\".concat(selectableClass)}};}};var renderColorSwatchItem=(spec,backstage)=>{var items=getColorItems(spec,backstage);var columns=backstage.colorinput.getColorCols(spec.initData.storageKey);var presets='color';var menuSpec=createPartialChoiceMenu(generate$6('menu-value'),items,value=>{spec.onAction({value});},columns,presets,ItemResponse$1.CLOSE_ON_EXECUTE,spec.select.getOr(never),backstage.shared.providers);var widgetSpec=_objectSpread(_objectSpread({},menuSpec),{},{markers:markers(presets),movement:deriveMenuMovement(columns,presets)});return{type:'widget',data:{value:generate$6('widget-id')},dom:{tag:'div',classes:['tox-fancymenuitem']},autofocus:true,components:[parts$f.widget(Menu.sketch(widgetSpec))]};};var getColorItems=(spec,backstage)=>{var useCustomColors=spec.initData.allowCustomColors&&backstage.colorinput.hasCustomColors();return spec.initData.colors.fold(()=>getColors$1(backstage.colorinput.getColors(spec.initData.storageKey),spec.initData.storageKey,useCustomColors),colors=>colors.concat(getAdditionalColors(useCustomColors)));};var cellOverEvent=generate$6('cell-over');var cellExecuteEvent=generate$6('cell-execute');var makeAnnouncementText=backstage=>(row,col)=>backstage.shared.providers.translate(\"\".concat(col,\" columns, \").concat(row,\" rows\"));var makeCell=(row,col,label)=>{var emitCellOver=c=>emitWith(c,cellOverEvent,{row,col});var emitExecute=c=>emitWith(c,cellExecuteEvent,{row,col});var onClick=(c,se)=>{se.stop();emitExecute(c);};return build$1({dom:{tag:'div',attributes:{role:'button',['aria-label']:label}},behaviours:derive$1([config('insert-table-picker-cell',[run$1(mouseover(),Focusing.focus),run$1(execute$5(),emitExecute),run$1(click(),onClick),run$1(tap(),onClick)]),Toggling.config({toggleClass:'tox-insert-table-picker__selected',toggleOnExecute:false}),Focusing.config({onFocus:emitCellOver})])});};var makeCells=(getCellLabel,numRows,numCols)=>{var cells=[];for(var i=0;i<numRows;i++){var row=[];for(var j=0;j<numCols;j++){var _label=getCellLabel(i+1,j+1);row.push(makeCell(i,j,_label));}cells.push(row);}return cells;};var selectCells=(cells,selectedRow,selectedColumn,numRows,numColumns)=>{for(var i=0;i<numRows;i++){for(var j=0;j<numColumns;j++){Toggling.set(cells[i][j],i<=selectedRow&&j<=selectedColumn);}}};var makeComponents=cells=>bind$3(cells,cellRow=>map$2(cellRow,premade));var makeLabelText=(row,col)=>text$2(\"\".concat(col,\"x\").concat(row));var renderInsertTableMenuItem=(spec,backstage)=>{var numRows=10;var numColumns=10;var getCellLabel=makeAnnouncementText(backstage);var cells=makeCells(getCellLabel,numRows,numColumns);var emptyLabelText=makeLabelText(0,0);var memLabel=record({dom:{tag:'span',classes:['tox-insert-table-picker__label']},components:[emptyLabelText],behaviours:derive$1([Replacing.config({})])});return{type:'widget',data:{value:generate$6('widget-id')},dom:{tag:'div',classes:['tox-fancymenuitem']},autofocus:true,components:[parts$f.widget({dom:{tag:'div',classes:['tox-insert-table-picker']},components:makeComponents(cells).concat(memLabel.asSpec()),behaviours:derive$1([config('insert-table-picker',[runOnAttached(c=>{Replacing.set(memLabel.get(c),[emptyLabelText]);}),runWithTarget(cellOverEvent,(c,t,e)=>{var{row,col}=e.event;selectCells(cells,row,col,numRows,numColumns);Replacing.set(memLabel.get(c),[makeLabelText(row+1,col+1)]);}),runWithTarget(cellExecuteEvent,(c,_,e)=>{var{row,col}=e.event;spec.onAction({numRows:row+1,numColumns:col+1});emit(c,sandboxClose());})]),Keying.config({initSize:{numRows,numColumns},mode:'flatgrid',selector:'[role=\"button\"]'})])})]};};var fancyMenuItems={inserttable:renderInsertTableMenuItem,colorswatch:renderColorSwatchItem};var renderFancyMenuItem=(spec,backstage)=>get$g(fancyMenuItems,spec.fancytype).map(render=>render(spec,backstage));var renderNestedItem=function renderNestedItem(spec,itemResponse,providersBackstage){var renderIcons=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var downwardsCaret=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var caret=downwardsCaret?renderDownwardsCaret(providersBackstage.icons):renderSubmenuCaret(providersBackstage.icons);var getApi=component=>({isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state),setIconFill:(id,value)=>{descendant(component.element,\"svg path[class=\\\"\".concat(id,\"\\\"], rect[class=\\\"\").concat(id,\"\\\"]\")).each(underlinePath=>{set$9(underlinePath,'fill',value);});}});var structure=renderItemStructure({presets:'normal',iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.some(caret),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi,enabled:spec.enabled,onAction:noop,onSetup:spec.onSetup,triggersSubmenu:true,itemBehaviours:[]},structure,itemResponse,providersBackstage);};var renderNormalItem=function renderNormalItem(spec,itemResponse,providersBackstage){var renderIcons=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var getApi=component=>({isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state)});var structure=renderItemStructure({presets:'normal',iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.none(),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi,enabled:spec.enabled,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:false,itemBehaviours:[]},structure,itemResponse,providersBackstage);};var renderSeparatorItem=spec=>({type:'separator',dom:{tag:'div',classes:[selectableClass,groupHeadingClass]},components:spec.text.map(text$2).toArray()});var renderToggleMenuItem=function renderToggleMenuItem(spec,itemResponse,providersBackstage){var renderIcons=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var getApi=component=>({setActive:state=>{Toggling.set(component,state);},isActive:()=>Toggling.isOn(component),isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state)});var structure=renderItemStructure({iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,checkMark:Optional.some(renderCheckmark(providersBackstage.icons)),caret:Optional.none(),shortcutContent:spec.shortcut,presets:'normal',meta:spec.meta},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),enabled:spec.enabled,getApi,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:false,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:tickedClass,toggleOnExecute:false,selected:spec.active}});};var autocomplete=renderAutocompleteItem;var separator$3=renderSeparatorItem;var normal=renderNormalItem;var nested=renderNestedItem;var toggle$1=renderToggleMenuItem;var fancy=renderFancyMenuItem;var card=renderCardMenuItem;var getCoupled=(component,coupleConfig,coupleState,name)=>coupleState.getOrCreate(component,coupleConfig,name);var getExistingCoupled=(component,coupleConfig,coupleState,name)=>coupleState.getExisting(component,coupleConfig,name);var CouplingApis=/*#__PURE__*/Object.freeze({__proto__:null,getCoupled:getCoupled,getExistingCoupled:getExistingCoupled});var CouplingSchema=[requiredOf('others',setOf(Result.value,anyValue()))];var init$a=()=>{var coupled={};var lookupCoupled=(coupleConfig,coupledName)=>{var available=keys(coupleConfig.others);if(available.length===0){throw new Error('Cannot find any known coupled components');}else{return get$g(coupled,coupledName);}};var getOrCreate=(component,coupleConfig,name)=>{return lookupCoupled(coupleConfig,name).getOrThunk(()=>{var builder=get$g(coupleConfig.others,name).getOrDie('No information found for coupled component: '+name);var spec=builder(component);var built=component.getSystem().build(spec);coupled[name]=built;return built;});};var getExisting=(component,coupleConfig,name)=>{return lookupCoupled(coupleConfig,name).orThunk(()=>{get$g(coupleConfig.others,name).getOrDie('No information found for coupled component: '+name);return Optional.none();});};var readState=constant$1({});return nu$8({readState,getExisting,getOrCreate});};var CouplingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$a});var Coupling=create$4({fields:CouplingSchema,name:'coupling',apis:CouplingApis,state:CouplingState});var nu$3=baseFn=>{var data=Optional.none();var callbacks=[];var map=f=>nu$3(nCallback=>{get(data=>{nCallback(f(data));});});var get=nCallback=>{if(isReady()){call(nCallback);}else{callbacks.push(nCallback);}};var set=x=>{if(!isReady()){data=Optional.some(x);run(callbacks);callbacks=[];}};var isReady=()=>data.isSome();var run=cbs=>{each$1(cbs,call);};var call=cb=>{data.each(x=>{setTimeout(()=>{cb(x);},0);});};baseFn(set);return{get,map,isReady};};var pure$1=a=>nu$3(callback=>{callback(a);});var LazyValue={nu:nu$3,pure:pure$1};var errorReporter=err=>{setTimeout(()=>{throw err;},0);};var make$5=run=>{var get=callback=>{run().then(callback,errorReporter);};var map=fab=>{return make$5(()=>run().then(fab));};var bind=aFutureB=>{return make$5(()=>run().then(v=>aFutureB(v).toPromise()));};var anonBind=futureB=>{return make$5(()=>run().then(()=>futureB.toPromise()));};var toLazy=()=>{return LazyValue.nu(get);};var toCached=()=>{var cache=null;return make$5(()=>{if(cache===null){cache=run();}return cache;});};var toPromise=run;return{map,bind,anonBind,toLazy,toCached,toPromise,get};};var nu$2=baseFn=>{return make$5(()=>new Promise(baseFn));};var pure=a=>{return make$5(()=>Promise.resolve(a));};var Future={nu:nu$2,pure};var suffix=constant$1('sink');var partType$1=constant$1(optional({name:suffix(),overrides:constant$1({dom:{tag:'div'},behaviours:derive$1([Positioning.config({useFixed:always})]),events:derive$2([cutter(keydown()),cutter(mousedown()),cutter(click())])})}));var getAnchor=(detail,component)=>{var hotspot=detail.getHotspot(component).getOr(component);var type='hotspot';var overrides=detail.getAnchorOverrides();return detail.layouts.fold(()=>({type,hotspot,overrides}),layouts=>({type,hotspot,overrides,layouts}));};var fetch=(detail,mapFetch,component)=>{var fetcher=detail.fetch;return fetcher(component).map(mapFetch);};var openF=(detail,mapFetch,anchor,component,sandbox,externals,highlightOnOpen)=>{var futureData=fetch(detail,mapFetch,component);var getLazySink=getSink(component,detail);return futureData.map(tdata=>tdata.bind(data=>Optional.from(tieredMenu.sketch(_objectSpread(_objectSpread({},externals.menu()),{},{uid:generate$5(''),data,highlightOnOpen,onOpenMenu:(tmenu,menu)=>{var sink=getLazySink().getOrDie();Positioning.position(sink,menu,{anchor});Sandboxing.decloak(sandbox);},onOpenSubmenu:(tmenu,item,submenu)=>{var sink=getLazySink().getOrDie();Positioning.position(sink,submenu,{anchor:{type:'submenu',item}});Sandboxing.decloak(sandbox);},onRepositionMenu:(tmenu,primaryMenu,submenuTriggers)=>{var sink=getLazySink().getOrDie();Positioning.position(sink,primaryMenu,{anchor});each$1(submenuTriggers,st=>{Positioning.position(sink,st.triggeredMenu,{anchor:{type:'submenu',item:st.triggeringItem}});});},onEscape:()=>{Focusing.focus(component);Sandboxing.close(sandbox);return Optional.some(true);}})))));};var open=(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen)=>{var anchor=getAnchor(detail,hotspot);var processed=openF(detail,mapFetch,anchor,hotspot,sandbox,externals,highlightOnOpen);return processed.map(tdata=>{tdata.fold(()=>{if(Sandboxing.isOpen(sandbox)){Sandboxing.close(sandbox);}},data=>{Sandboxing.cloak(sandbox);Sandboxing.open(sandbox,data);onOpenSync(sandbox);});return sandbox;});};var close=(detail,mapFetch,component,sandbox,_externals,_onOpenSync,_highlightOnOpen)=>{Sandboxing.close(sandbox);return Future.pure(sandbox);};var togglePopup=(detail,mapFetch,hotspot,externals,onOpenSync,highlightOnOpen)=>{var sandbox=Coupling.getCoupled(hotspot,'sandbox');var showing=Sandboxing.isOpen(sandbox);var action=showing?close:open;return action(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen);};var matchWidth=(hotspot,container,useMinWidth)=>{var menu=Composing.getCurrent(container).getOr(container);var buttonWidth=get$c(hotspot.element);if(useMinWidth){set$8(menu.element,'min-width',buttonWidth+'px');}else{set$7(menu.element,buttonWidth);}};var getSink=(anyInSystem,sinkDetail)=>anyInSystem.getSystem().getByUid(sinkDetail.uid+'-'+suffix()).map(internalSink=>()=>Result.value(internalSink)).getOrThunk(()=>sinkDetail.lazySink.fold(()=>()=>Result.error(new Error('No internal sink is specified, nor could an external sink be found')),lazySinkFn=>()=>lazySinkFn(anyInSystem)));var doRepositionMenus=sandbox=>{Sandboxing.getState(sandbox).each(tmenu=>{tieredMenu.repositionMenus(tmenu);});};var makeSandbox$1=(detail,hotspot,extras)=>{var ariaControls=manager();var onOpen=(component,menu)=>{var anchor=getAnchor(detail,hotspot);ariaControls.link(hotspot.element);if(detail.matchWidth){matchWidth(anchor.hotspot,menu,detail.useMinWidth);}detail.onOpen(anchor,component,menu);if(extras!==undefined&&extras.onOpen!==undefined){extras.onOpen(component,menu);}};var onClose=(component,menu)=>{ariaControls.unlink(hotspot.element);if(extras!==undefined&&extras.onClose!==undefined){extras.onClose(component,menu);}};var lazySink=getSink(hotspot,detail);return{dom:{tag:'div',classes:detail.sandboxClasses,attributes:{id:ariaControls.id,role:'listbox'}},behaviours:SketchBehaviours.augment(detail.sandboxBehaviours,[Representing.config({store:{mode:'memory',initialValue:hotspot}}),Sandboxing.config({onOpen,onClose,isPartOf:(container,data,queryElem)=>{return isPartOf$1(data,queryElem)||isPartOf$1(hotspot,queryElem);},getAttachPoint:()=>{return lazySink().getOrDie();}}),Composing.config({find:sandbox=>{return Sandboxing.getState(sandbox).bind(menu=>Composing.getCurrent(menu));}}),Receiving.config({channels:_objectSpread(_objectSpread({},receivingChannel$1({isExtraPart:never})),receivingChannel({doReposition:doRepositionMenus}))})])};};var _repositionMenus=comp=>{var sandbox=Coupling.getCoupled(comp,'sandbox');doRepositionMenus(sandbox);};var sandboxFields=()=>[defaulted('sandboxClasses',[]),SketchBehaviours.field('sandboxBehaviours',[Composing,Receiving,Sandboxing,Representing])];var schema$k=constant$1([required$1('dom'),required$1('fetch'),onHandler('onOpen'),onKeyboardHandler('onExecute'),defaulted('getHotspot',Optional.some),defaulted('getAnchorOverrides',constant$1({})),schema$y(),field('dropdownBehaviours',[Toggling,Coupling,Keying,Focusing]),required$1('toggleClass'),defaulted('eventOrder',{}),option$3('lazySink'),defaulted('matchWidth',false),defaulted('useMinWidth',false),option$3('role')].concat(sandboxFields()));var parts$e=constant$1([external({schema:[tieredMenuMarkers(),defaulted('fakeFocus',false)],name:'menu',defaults:detail=>{return{onExecute:detail.onExecute};}}),partType$1()]);var factory$k=(detail,components,_spec,externals)=>{var lookupAttr=attr=>get$g(detail.dom,'attributes').bind(attrs=>get$g(attrs,attr));var switchToMenu=sandbox=>{Sandboxing.getState(sandbox).each(tmenu=>{tieredMenu.highlightPrimary(tmenu);});};var togglePopup$1=(dropdownComp,onOpenSync,highlightOnOpen)=>{return togglePopup(detail,identity,dropdownComp,externals,onOpenSync,highlightOnOpen);};var action=component=>{var onOpenSync=switchToMenu;togglePopup$1(component,onOpenSync,HighlightOnOpen.HighlightMenuAndItem).get(noop);};var apis={expand:comp=>{if(!Toggling.isOn(comp)){togglePopup$1(comp,noop,HighlightOnOpen.HighlightNone).get(noop);}},open:comp=>{if(!Toggling.isOn(comp)){togglePopup$1(comp,noop,HighlightOnOpen.HighlightMenuAndItem).get(noop);}},refetch:comp=>{var optSandbox=Coupling.getExistingCoupled(comp,'sandbox');return optSandbox.fold(()=>{return togglePopup$1(comp,noop,HighlightOnOpen.HighlightMenuAndItem).map(noop);},sandboxComp=>{return open(detail,identity,comp,sandboxComp,externals,noop,HighlightOnOpen.HighlightMenuAndItem).map(noop);});},isOpen:Toggling.isOn,close:comp=>{if(Toggling.isOn(comp)){togglePopup$1(comp,noop,HighlightOnOpen.HighlightMenuAndItem).get(noop);}},repositionMenus:comp=>{if(Toggling.isOn(comp)){_repositionMenus(comp);}}};var triggerExecute=(comp,_se)=>{emitExecute(comp);return Optional.some(true);};return{uid:detail.uid,dom:detail.dom,components,behaviours:augment(detail.dropdownBehaviours,[Toggling.config({toggleClass:detail.toggleClass,aria:{mode:'expanded'}}),Coupling.config({others:{sandbox:hotspot=>{return makeSandbox$1(detail,hotspot,{onOpen:()=>Toggling.on(hotspot),onClose:()=>Toggling.off(hotspot)});}}}),Keying.config({mode:'special',onSpace:triggerExecute,onEnter:triggerExecute,onDown:(comp,_se)=>{if(Dropdown.isOpen(comp)){var sandbox=Coupling.getCoupled(comp,'sandbox');switchToMenu(sandbox);}else{Dropdown.open(comp);}return Optional.some(true);},onEscape:(comp,_se)=>{if(Dropdown.isOpen(comp)){Dropdown.close(comp);return Optional.some(true);}else{return Optional.none();}}}),Focusing.config({})]),events:events$a(Optional.some(action)),eventOrder:_objectSpread(_objectSpread({},detail.eventOrder),{},{[execute$5()]:['disabling','toggling','alloy.base.behaviour']}),apis,domModification:{attributes:_objectSpread(_objectSpread({'aria-haspopup':'true'},detail.role.fold(()=>({}),role=>({role}))),detail.dom.tag==='button'?{type:lookupAttr('type').getOr('button')}:{})}};};var Dropdown=composite({name:'Dropdown',configFields:schema$k(),partFields:parts$e(),factory:factory$k,apis:{open:(apis,comp)=>apis.open(comp),refetch:(apis,comp)=>apis.refetch(comp),expand:(apis,comp)=>apis.expand(comp),close:(apis,comp)=>apis.close(comp),isOpen:(apis,comp)=>apis.isOpen(comp),repositionMenus:(apis,comp)=>apis.repositionMenus(comp)}});var identifyMenuLayout=searchMode=>{switch(searchMode.searchMode){case'no-search':{return{menuType:'normal'};}default:{return{menuType:'searchable',searchMode};}}};var handleRefetchTrigger=originalSandboxComp=>{var dropdown=Representing.getValue(originalSandboxComp);var optSearcherState=findWithinSandbox(originalSandboxComp).map(saveState);Dropdown.refetch(dropdown).get(()=>{var newSandboxComp=Coupling.getCoupled(dropdown,'sandbox');optSearcherState.each(searcherState=>findWithinSandbox(newSandboxComp).each(inputComp=>restoreState(inputComp,searcherState)));});};var handleRedirectToMenuItem=(sandboxComp,se)=>{getActiveMenuItemFrom(sandboxComp).each(activeItem=>{retargetAndDispatchWith(sandboxComp,activeItem.element,se.event.eventType,se.event.interactionEvent);});};var getActiveMenuItemFrom=sandboxComp=>{return Sandboxing.getState(sandboxComp).bind(Highlighting.getHighlighted).bind(Highlighting.getHighlighted);};var getSearchResults=activeMenuComp=>{return has(activeMenuComp.element,searchResultsClass)?Optional.some(activeMenuComp.element):descendant(activeMenuComp.element,'.'+searchResultsClass);};var updateAriaOnHighlight=(tmenuComp,menuComp,itemComp)=>{findWithinMenu(tmenuComp).each(inputComp=>{setActiveDescendant(inputComp,itemComp);var optActiveResults=getSearchResults(menuComp);optActiveResults.each(resultsElem=>{getOpt(resultsElem,'id').each(controlledId=>set$9(inputComp.element,'aria-controls',controlledId));});});set$9(itemComp.element,'aria-selected','true');};var updateAriaOnDehighlight=(tmenuComp,menuComp,itemComp)=>{set$9(itemComp.element,'aria-selected','false');};var focusSearchField=tmenuComp=>{findWithinMenu(tmenuComp).each(searcherComp=>Focusing.focus(searcherComp));};var getSearchPattern=dropdownComp=>{var optSandboxComp=Coupling.getExistingCoupled(dropdownComp,'sandbox');return optSandboxComp.bind(findWithinSandbox).map(saveState).map(state=>state.fetchPattern).getOr('');};var FocusMode;(function(FocusMode){FocusMode[FocusMode['ContentFocus']=0]='ContentFocus';FocusMode[FocusMode['UiFocus']=1]='UiFocus';})(FocusMode||(FocusMode={}));var createMenuItemFromBridge=(item,itemResponse,backstage,menuHasIcons,isHorizontalMenu)=>{var providersBackstage=backstage.shared.providers;var parseForHorizontalMenu=menuitem=>!isHorizontalMenu?menuitem:_objectSpread(_objectSpread({},menuitem),{},{shortcut:Optional.none(),icon:menuitem.text.isSome()?Optional.none():menuitem.icon});switch(item.type){case'menuitem':return createMenuItem(item).fold(handleError,d=>Optional.some(normal(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons)));case'nestedmenuitem':return createNestedMenuItem(item).fold(handleError,d=>Optional.some(nested(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons,isHorizontalMenu)));case'togglemenuitem':return createToggleMenuItem(item).fold(handleError,d=>Optional.some(toggle$1(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons)));case'separator':return createSeparatorMenuItem(item).fold(handleError,d=>Optional.some(separator$3(d)));case'fancymenuitem':return createFancyMenuItem(item).fold(handleError,d=>fancy(d,backstage));default:{console.error('Unknown item in general menu',item);return Optional.none();}}};var createAutocompleteItems=(items,matchText,onItemValueHandler,columns,itemResponse,sharedBackstage,highlightOn)=>{var renderText=columns===1;var renderIcons=!renderText||menuHasIcons(items);return cat(map$2(items,item=>{switch(item.type){case'separator':return createSeparatorItem(item).fold(handleError,d=>Optional.some(separator$3(d)));case'cardmenuitem':return createCardMenuItem(item).fold(handleError,d=>Optional.some(card(_objectSpread(_objectSpread({},d),{},{onAction:api=>{d.onAction(api);onItemValueHandler(d.value,d.meta);}}),itemResponse,sharedBackstage,{itemBehaviours:tooltipBehaviour(d.meta,sharedBackstage),cardText:{matchText,highlightOn}})));case'autocompleteitem':default:return createAutocompleterItem(item).fold(handleError,d=>Optional.some(autocomplete(d,matchText,renderText,'normal',onItemValueHandler,itemResponse,sharedBackstage,renderIcons)));}}));};var createPartialMenu=(value,items,itemResponse,backstage,isHorizontalMenu,searchMode)=>{var hasIcons=menuHasIcons(items);var alloyItems=cat(map$2(items,item=>{var itemHasIcon=i=>isHorizontalMenu?!has$2(i,'text'):hasIcons;var createItem=i=>createMenuItemFromBridge(i,itemResponse,backstage,itemHasIcon(i),isHorizontalMenu);if(item.type==='nestedmenuitem'&&item.getSubmenuItems().length<=0){return createItem(_objectSpread(_objectSpread({},item),{},{enabled:false}));}else{return createItem(item);}}));var menuLayout=identifyMenuLayout(searchMode);var createPartial=isHorizontalMenu?createHorizontalPartialMenuWithAlloyItems:createPartialMenuWithAlloyItems;return createPartial(value,hasIcons,alloyItems,1,menuLayout);};var createTieredDataFrom=partialMenu=>tieredMenu.singleData(partialMenu.value,partialMenu);var createInlineMenuFrom=(partialMenu,columns,focusMode,presets)=>{var movement=deriveMenuMovement(columns,presets);var menuMarkers=markers(presets);return{data:createTieredDataFrom(_objectSpread(_objectSpread({},partialMenu),{},{movement,menuBehaviours:SimpleBehaviours.unnamedEvents(columns!=='auto'?[]:[runOnAttached((comp,_se)=>{detectSize(comp,4,menuMarkers.item).each(_ref3=>{var{numColumns,numRows}=_ref3;Keying.setGridSize(comp,numRows,numColumns);});})])})),menu:{markers:markers(presets),fakeFocus:focusMode===FocusMode.ContentFocus}};};var getAutocompleterRange=(dom,initRange)=>{return detect$1(SugarElement.fromDom(initRange.startContainer)).map(elm=>{var range=dom.createRng();range.selectNode(elm.dom);return range;});};var register$b=(editor,sharedBackstage)=>{var processingAction=Cell(false);var activeState=Cell(false);var autocompleter=build$1(InlineView.sketch({dom:{tag:'div',classes:['tox-autocompleter']},components:[],fireDismissalEventInstead:{},inlineBehaviours:derive$1([config('dismissAutocompleter',[run$1(dismissRequested(),()=>cancelIfNecessary())])]),lazySink:sharedBackstage.getSink}));var isMenuOpen=()=>InlineView.isOpen(autocompleter);var isActive=activeState.get;var hideIfNecessary=()=>{if(isMenuOpen()){InlineView.hide(autocompleter);}};var getMenu=()=>InlineView.getContent(autocompleter).bind(tmenu=>{return get$h(tmenu.components(),0);});var cancelIfNecessary=()=>editor.execCommand('mceAutocompleterClose');var getCombinedItems=matches=>{var columns=findMap(matches,m=>Optional.from(m.columns)).getOr(1);return bind$3(matches,match=>{var choices=match.items;return createAutocompleteItems(choices,match.matchText,(itemValue,itemMeta)=>{var nr=editor.selection.getRng();getAutocompleterRange(editor.dom,nr).each(range=>{var autocompleterApi={hide:()=>cancelIfNecessary(),reload:fetchOptions=>{hideIfNecessary();editor.execCommand('mceAutocompleterReload',false,{fetchOptions});}};processingAction.set(true);match.onAction(autocompleterApi,range,itemValue,itemMeta);processingAction.set(false);});},columns,ItemResponse$1.BUBBLE_TO_SANDBOX,sharedBackstage,match.highlightOn);});};var display=(lookupData,items)=>{findIn(SugarElement.fromDom(editor.getBody())).each(element=>{var columns=findMap(lookupData,ld=>Optional.from(ld.columns)).getOr(1);InlineView.showMenuAt(autocompleter,{anchor:{type:'node',root:SugarElement.fromDom(editor.getBody()),node:Optional.from(element)}},createInlineMenuFrom(createPartialMenuWithAlloyItems('autocompleter-value',true,items,columns,{menuType:'normal'}),columns,FocusMode.ContentFocus,'normal'));});getMenu().each(Highlighting.highlightFirst);};var updateDisplay=lookupData=>{var combinedItems=getCombinedItems(lookupData);if(combinedItems.length>0){display(lookupData,combinedItems);}else{hideIfNecessary();}};editor.on('AutocompleterStart',_ref4=>{var{lookupData}=_ref4;activeState.set(true);processingAction.set(false);updateDisplay(lookupData);});editor.on('AutocompleterUpdate',_ref5=>{var{lookupData}=_ref5;return updateDisplay(lookupData);});editor.on('AutocompleterEnd',()=>{hideIfNecessary();activeState.set(false);processingAction.set(false);});var autocompleterUiApi={cancelIfNecessary,isMenuOpen,isActive,isProcessingAction:processingAction.get,getMenu};AutocompleterEditorEvents.setup(autocompleterUiApi,editor);};var Autocompleter={register:register$b};var nonScrollingOverflows=['visible','hidden','clip'];var isScrollingOverflowValue=value=>trim$1(value).length>0&&!contains$2(nonScrollingOverflows,value);var isScroller=elem=>{if(isHTMLElement(elem)){var overflowX=get$e(elem,'overflow-x');var overflowY=get$e(elem,'overflow-y');return isScrollingOverflowValue(overflowX)||isScrollingOverflowValue(overflowY);}else{return false;}};var detect=popupSinkElem=>{var ancestorsScrollers=ancestors(popupSinkElem,isScroller);var scrollers=ancestorsScrollers.length===0?getShadowRoot(popupSinkElem).map(getShadowHost).map(x=>ancestors(x,isScroller)).getOr([]):ancestorsScrollers;return head(scrollers).map(element=>({element,others:scrollers.slice(1)}));};var detectWhenSplitUiMode=(editor,popupSinkElem)=>isSplitUiMode(editor)?detect(popupSinkElem):Optional.none();var getBoundsFrom=sc=>{var scrollableBoxes=[...map$2(sc.others,box$1),win()];return constrainByMany(box$1(sc.element),scrollableBoxes);};var closest=(scope,selector,isRoot)=>closest$1(scope,selector,isRoot).isSome();var DelayedFunction=(fun,delay)=>{var ref=null;var schedule=function schedule(){for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++){args[_key16]=arguments[_key16];}ref=setTimeout(()=>{fun.apply(null,args);ref=null;},delay);};var cancel=()=>{if(ref!==null){clearTimeout(ref);ref=null;}};return{cancel,schedule};};var SIGNIFICANT_MOVE=5;var LONGPRESS_DELAY=400;var getTouch=event=>{var raw=event.raw;if(raw.touches===undefined||raw.touches.length!==1){return Optional.none();}return Optional.some(raw.touches[0]);};var isFarEnough=(touch,data)=>{var distX=Math.abs(touch.clientX-data.x);var distY=Math.abs(touch.clientY-data.y);return distX>SIGNIFICANT_MOVE||distY>SIGNIFICANT_MOVE;};var monitor=settings=>{var startData=value$2();var longpressFired=Cell(false);var longpress$1=DelayedFunction(event=>{settings.triggerEvent(longpress(),event);longpressFired.set(true);},LONGPRESS_DELAY);var handleTouchstart=event=>{getTouch(event).each(touch=>{longpress$1.cancel();var data={x:touch.clientX,y:touch.clientY,target:event.target};longpress$1.schedule(event);longpressFired.set(false);startData.set(data);});return Optional.none();};var handleTouchmove=event=>{longpress$1.cancel();getTouch(event).each(touch=>{startData.on(data=>{if(isFarEnough(touch,data)){startData.clear();}});});return Optional.none();};var handleTouchend=event=>{longpress$1.cancel();var isSame=data=>eq(data.target,event.target);return startData.get().filter(isSame).map(_data=>{if(longpressFired.get()){event.prevent();return false;}else{return settings.triggerEvent(tap(),event);}});};var handlers=wrapAll([{key:touchstart(),value:handleTouchstart},{key:touchmove(),value:handleTouchmove},{key:touchend(),value:handleTouchend}]);var fireIfReady=(event,type)=>get$g(handlers,type).bind(handler=>handler(event));return{fireIfReady};};var isDangerous=event=>{var keyEv=event.raw;return keyEv.which===BACKSPACE[0]&&!contains$2(['input','textarea'],name$3(event.target))&&!closest(event.target,'[contenteditable=\"true\"]');};var setup$d=(container,rawSettings)=>{var settings=_objectSpread({stopBackspace:true},rawSettings);var pointerEvents=['touchstart','touchmove','touchend','touchcancel','gesturestart','mousedown','mouseup','mouseover','mousemove','mouseout','click'];var tapEvent=monitor(settings);var simpleEvents=map$2(pointerEvents.concat(['selectstart','input','contextmenu','change','transitionend','transitioncancel','drag','dragstart','dragend','dragenter','dragleave','dragover','drop','keyup']),type=>bind(container,type,event=>{tapEvent.fireIfReady(event,type).each(tapStopped=>{if(tapStopped){event.kill();}});var stopped=settings.triggerEvent(type,event);if(stopped){event.kill();}}));var pasteTimeout=value$2();var onPaste=bind(container,'paste',event=>{tapEvent.fireIfReady(event,'paste').each(tapStopped=>{if(tapStopped){event.kill();}});var stopped=settings.triggerEvent('paste',event);if(stopped){event.kill();}pasteTimeout.set(setTimeout(()=>{settings.triggerEvent(postPaste(),event);},0));});var onKeydown=bind(container,'keydown',event=>{var stopped=settings.triggerEvent('keydown',event);if(stopped){event.kill();}else if(settings.stopBackspace&&isDangerous(event)){event.prevent();}});var onFocusIn=bind(container,'focusin',event=>{var stopped=settings.triggerEvent('focusin',event);if(stopped){event.kill();}});var focusoutTimeout=value$2();var onFocusOut=bind(container,'focusout',event=>{var stopped=settings.triggerEvent('focusout',event);if(stopped){event.kill();}focusoutTimeout.set(setTimeout(()=>{settings.triggerEvent(postBlur(),event);},0));});var unbind=()=>{each$1(simpleEvents,e=>{e.unbind();});onKeydown.unbind();onFocusIn.unbind();onFocusOut.unbind();onPaste.unbind();pasteTimeout.on(clearTimeout);focusoutTimeout.on(clearTimeout);};return{unbind};};var derive=(rawEvent,rawTarget)=>{var source=get$g(rawEvent,'target').getOr(rawTarget);return Cell(source);};var fromSource=(event,source)=>{var stopper=Cell(false);var cutter=Cell(false);var stop=()=>{stopper.set(true);};var cut=()=>{cutter.set(true);};return{stop,cut,isStopped:stopper.get,isCut:cutter.get,event,setSource:source.set,getSource:source.get};};var fromExternal=event=>{var stopper=Cell(false);var stop=()=>{stopper.set(true);};return{stop,cut:noop,isStopped:stopper.get,isCut:never,event,setSource:die('Cannot set source of a broadcasted event'),getSource:die('Cannot get source of a broadcasted event')};};var adt$1=Adt.generate([{stopped:[]},{resume:['element']},{complete:[]}]);var doTriggerHandler=(lookup,eventType,rawEvent,target,source,logger)=>{var handler=lookup(eventType,target);var simulatedEvent=fromSource(rawEvent,source);return handler.fold(()=>{logger.logEventNoHandlers(eventType,target);return adt$1.complete();},handlerInfo=>{var descHandler=handlerInfo.descHandler;var eventHandler=getCurried(descHandler);eventHandler(simulatedEvent);if(simulatedEvent.isStopped()){logger.logEventStopped(eventType,handlerInfo.element,descHandler.purpose);return adt$1.stopped();}else if(simulatedEvent.isCut()){logger.logEventCut(eventType,handlerInfo.element,descHandler.purpose);return adt$1.complete();}else{return parent(handlerInfo.element).fold(()=>{logger.logNoParent(eventType,handlerInfo.element,descHandler.purpose);return adt$1.complete();},parent=>{logger.logEventResponse(eventType,handlerInfo.element,descHandler.purpose);return adt$1.resume(parent);});}});};var doTriggerOnUntilStopped=(lookup,eventType,rawEvent,rawTarget,source,logger)=>doTriggerHandler(lookup,eventType,rawEvent,rawTarget,source,logger).fold(always,parent=>doTriggerOnUntilStopped(lookup,eventType,rawEvent,parent,source,logger),never);var triggerHandler=(lookup,eventType,rawEvent,target,logger)=>{var source=derive(rawEvent,target);return doTriggerHandler(lookup,eventType,rawEvent,target,source,logger);};var broadcast=(listeners,rawEvent,_logger)=>{var simulatedEvent=fromExternal(rawEvent);each$1(listeners,listener=>{var descHandler=listener.descHandler;var handler=getCurried(descHandler);handler(simulatedEvent);});return simulatedEvent.isStopped();};var triggerUntilStopped=(lookup,eventType,rawEvent,logger)=>triggerOnUntilStopped(lookup,eventType,rawEvent,rawEvent.target,logger);var triggerOnUntilStopped=(lookup,eventType,rawEvent,rawTarget,logger)=>{var source=derive(rawEvent,rawTarget);return doTriggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,source,logger);};var eventHandler=(element,descHandler)=>({element,descHandler});var broadcastHandler=(id,handler)=>({id,descHandler:handler});var EventRegistry=()=>{var registry={};var registerId=(extraArgs,id,events)=>{each(events,(v,k)=>{var handlers=registry[k]!==undefined?registry[k]:{};handlers[id]=curryArgs(v,extraArgs);registry[k]=handlers;});};var findHandler=(handlers,elem)=>read$1(elem).bind(id=>get$g(handlers,id)).map(descHandler=>eventHandler(elem,descHandler));var filterByType=type=>get$g(registry,type).map(handlers=>mapToArray(handlers,(f,id)=>broadcastHandler(id,f))).getOr([]);var find=(isAboveRoot,type,target)=>get$g(registry,type).bind(handlers=>closest$4(target,elem=>findHandler(handlers,elem),isAboveRoot));var unregisterId=id=>{each(registry,(handlersById,_eventName)=>{if(has$2(handlersById,id)){delete handlersById[id];}});};return{registerId,unregisterId,filterByType,find};};var Registry=()=>{var events=EventRegistry();var components={};var readOrTag=component=>{var elem=component.element;return read$1(elem).getOrThunk(()=>write('uid-',component.element));};var failOnDuplicate=(component,tagId)=>{var conflict=components[tagId];if(conflict===component){unregister(component);}else{throw new Error('The tagId \"'+tagId+'\" is already used by: '+element(conflict.element)+'\\nCannot use it for: '+element(component.element)+'\\n'+'The conflicting element is'+(inBody(conflict.element)?' ':' not ')+'already in the DOM');}};var register=component=>{var tagId=readOrTag(component);if(hasNonNullableKey(components,tagId)){failOnDuplicate(component,tagId);}var extraArgs=[component];events.registerId(extraArgs,tagId,component.events);components[tagId]=component;};var unregister=component=>{read$1(component.element).each(tagId=>{delete components[tagId];events.unregisterId(tagId);});};var filter=type=>events.filterByType(type);var find=(isAboveRoot,type,target)=>events.find(isAboveRoot,type,target);var getById=id=>get$g(components,id);return{find,filter,register,unregister,getById};};var factory$j=detail=>{var _detail$dom=detail.dom,{attributes}=_detail$dom,domWithoutAttributes=_objectWithoutProperties(_detail$dom,_excluded3);return{uid:detail.uid,dom:_objectSpread({tag:'div',attributes:_objectSpread({role:'presentation'},attributes)},domWithoutAttributes),components:detail.components,behaviours:get$3(detail.containerBehaviours),events:detail.events,domModification:detail.domModification,eventOrder:detail.eventOrder};};var Container=single({name:'Container',factory:factory$j,configFields:[defaulted('components',[]),field('containerBehaviours',[]),defaulted('events',{}),defaulted('domModification',{}),defaulted('eventOrder',{})]});var takeover=root=>{var isAboveRoot=el=>parent(root.element).fold(always,parent=>eq(el,parent));var registry=Registry();var lookup=(eventName,target)=>registry.find(isAboveRoot,eventName,target);var domEvents=setup$d(root.element,{triggerEvent:(eventName,event)=>{return monitorEvent(eventName,event.target,logger=>triggerUntilStopped(lookup,eventName,event,logger));}});var systemApi={debugInfo:constant$1('real'),triggerEvent:(eventName,target,data)=>{monitorEvent(eventName,target,logger=>triggerOnUntilStopped(lookup,eventName,data,target,logger));},triggerFocus:(target,originator)=>{read$1(target).fold(()=>{focus$3(target);},_alloyId=>{monitorEvent(focus$4(),target,logger=>{triggerHandler(lookup,focus$4(),{originator,kill:noop,prevent:noop,target},target,logger);return false;});});},triggerEscape:(comp,simulatedEvent)=>{systemApi.triggerEvent('keydown',comp.element,simulatedEvent.event);},getByUid:uid=>{return _getByUid(uid);},getByDom:elem=>{return _getByDom(elem);},build:build$1,buildOrPatch:buildOrPatch,addToGui:c=>{add(c);},removeFromGui:c=>{remove(c);},addToWorld:c=>{_addToWorld(c);},removeFromWorld:c=>{_removeFromWorld(c);},broadcast:message=>{broadcast$1(message);},broadcastOn:(channels,message)=>{_broadcastOn(channels,message);},broadcastEvent:(eventName,event)=>{_broadcastEvent(eventName,event);},isConnected:always};var _addToWorld=component=>{component.connect(systemApi);if(!isText(component.element)){registry.register(component);each$1(component.components(),_addToWorld);systemApi.triggerEvent(systemInit(),component.element,{target:component.element});}};var _removeFromWorld=component=>{if(!isText(component.element)){each$1(component.components(),_removeFromWorld);registry.unregister(component);}component.disconnect();};var add=component=>{attach(root,component);};var remove=component=>{detach(component);};var destroy=()=>{domEvents.unbind();remove$5(root.element);};var broadcastData=data=>{var receivers=registry.filter(receive());each$1(receivers,receiver=>{var descHandler=receiver.descHandler;var handler=getCurried(descHandler);handler(data);});};var broadcast$1=message=>{broadcastData({universal:true,data:message});};var _broadcastOn=(channels,message)=>{broadcastData({universal:false,channels,data:message});};var _broadcastEvent=(eventName,event)=>{var listeners=registry.filter(eventName);return broadcast(listeners,event);};var _getByUid=uid=>registry.getById(uid).fold(()=>Result.error(new Error('Could not find component with uid: \"'+uid+'\" in system.')),Result.value);var _getByDom=elem=>{var uid=read$1(elem).getOr('not found');return _getByUid(uid);};_addToWorld(root);return{root,element:root.element,destroy,add,remove,getByUid:_getByUid,getByDom:_getByDom,addToWorld:_addToWorld,removeFromWorld:_removeFromWorld,broadcast:broadcast$1,broadcastOn:_broadcastOn,broadcastEvent:_broadcastEvent};};var renderBar=(spec,backstage)=>({dom:{tag:'div',classes:['tox-bar','tox-form__controls-h-stack']},components:map$2(spec.items,backstage.interpreter)});var schema$j=constant$1([defaulted('prefix','form-field'),field('fieldBehaviours',[Composing,Representing])]);var parts$d=constant$1([optional({schema:[required$1('dom')],name:'label'}),optional({factory:{sketch:spec=>{return{uid:spec.uid,dom:{tag:'span',styles:{display:'none'},attributes:{'aria-hidden':'true'},innerHtml:spec.text}};}},schema:[required$1('text')],name:'aria-descriptor'}),required({factory:{sketch:spec=>{var excludeFactory=exclude(spec,['factory']);return spec.factory.sketch(excludeFactory);}},schema:[required$1('factory')],name:'field'})]);var factory$i=(detail,components,_spec,_externals)=>{var behaviours=augment(detail.fieldBehaviours,[Composing.config({find:container=>{return getPart(container,detail,'field');}}),Representing.config({store:{mode:'manual',getValue:field=>{return Composing.getCurrent(field).bind(Representing.getValue);},setValue:(field,value)=>{Composing.getCurrent(field).each(current=>{Representing.setValue(current,value);});}}})]);var events=derive$2([runOnAttached((component,_simulatedEvent)=>{var ps=getParts(component,detail,['label','field','aria-descriptor']);ps.field().each(field=>{var id=generate$6(detail.prefix);ps.label().each(label=>{set$9(label.element,'for',id);set$9(field.element,'id',id);});ps['aria-descriptor']().each(descriptor=>{var descriptorId=generate$6(detail.prefix);set$9(descriptor.element,'id',descriptorId);set$9(field.element,'aria-describedby',descriptorId);});});})]);var apis={getField:container=>getPart(container,detail,'field'),getLabel:container=>getPart(container,detail,'label')};return{uid:detail.uid,dom:detail.dom,components,behaviours,events,apis};};var FormField=composite({name:'FormField',configFields:schema$j(),partFields:parts$d(),factory:factory$i,apis:{getField:(apis,comp)=>apis.getField(comp),getLabel:(apis,comp)=>apis.getLabel(comp)}});var exhibit$2=(base,tabConfig)=>nu$7({attributes:wrapAll([{key:tabConfig.tabAttr,value:'true'}])});var ActiveTabstopping=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit$2});var TabstopSchema=[defaulted('tabAttr','data-alloy-tabstop')];var Tabstopping=create$4({fields:TabstopSchema,name:'tabstopping',active:ActiveTabstopping});var global$3=tinymce.util.Tools.resolve('tinymce.html.Entities');var renderFormFieldWith=(pLabel,pField,extraClasses,extraBehaviours)=>{var spec=renderFormFieldSpecWith(pLabel,pField,extraClasses,extraBehaviours);return FormField.sketch(spec);};var renderFormField=(pLabel,pField)=>renderFormFieldWith(pLabel,pField,[],[]);var renderFormFieldSpecWith=(pLabel,pField,extraClasses,extraBehaviours)=>({dom:renderFormFieldDomWith(extraClasses),components:pLabel.toArray().concat([pField]),fieldBehaviours:derive$1(extraBehaviours)});var renderFormFieldDom=()=>renderFormFieldDomWith([]);var renderFormFieldDomWith=extraClasses=>({tag:'div',classes:['tox-form__group'].concat(extraClasses)});var renderLabel$3=(label,providersBackstage)=>FormField.parts.label({dom:{tag:'label',classes:['tox-label']},components:[text$2(providersBackstage.translate(label))]});var formChangeEvent=generate$6('form-component-change');var formCloseEvent=generate$6('form-close');var formCancelEvent=generate$6('form-cancel');var formActionEvent=generate$6('form-action');var formSubmitEvent=generate$6('form-submit');var formBlockEvent=generate$6('form-block');var formUnblockEvent=generate$6('form-unblock');var formTabChangeEvent=generate$6('form-tabchange');var formResizeEvent=generate$6('form-resize');var renderCollection=(spec,providersBackstage,initialData)=>{var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var runOnItem=f=>(comp,se)=>{closest$1(se.event.target,'[data-collection-item-value]').each(target=>{f(comp,se,target,get$f(target,'data-collection-item-value'));});};var setContents=(comp,items)=>{var htmlLines=map$2(items,item=>{var itemText=global$8.translate(item.text);var textContent=spec.columns===1?\"<div class=\\\"tox-collection__item-label\\\">\".concat(itemText,\"</div>\"):'';var iconContent=\"<div class=\\\"tox-collection__item-icon\\\">\".concat(item.icon,\"</div>\");var mapItemName={'_':' ',' - ':' ','-':' '};var ariaLabel=itemText.replace(/\\_| \\- |\\-/g,match=>mapItemName[match]);var disabledClass=providersBackstage.isDisabled()?' tox-collection__item--state-disabled':'';return\"<div class=\\\"tox-collection__item\".concat(disabledClass,\"\\\" tabindex=\\\"-1\\\" data-collection-item-value=\\\"\").concat(global$3.encodeAllRaw(item.value),\"\\\" title=\\\"\").concat(ariaLabel,\"\\\" aria-label=\\\"\").concat(ariaLabel,\"\\\">\").concat(iconContent).concat(textContent,\"</div>\");});var chunks=spec.columns!=='auto'&&spec.columns>1?chunk$1(htmlLines,spec.columns):[htmlLines];var html=map$2(chunks,ch=>\"<div class=\\\"tox-collection__group\\\">\".concat(ch.join(''),\"</div>\"));set$6(comp.element,html.join(''));};var onClick=runOnItem((comp,se,tgt,itemValue)=>{se.stop();if(!providersBackstage.isDisabled()){emitWith(comp,formActionEvent,{name:spec.name,value:itemValue});}});var collectionEvents=[run$1(mouseover(),runOnItem((comp,se,tgt)=>{focus$3(tgt);})),run$1(click(),onClick),run$1(tap(),onClick),run$1(focusin(),runOnItem((comp,se,tgt)=>{descendant(comp.element,'.'+activeClass).each(currentActive=>{remove$2(currentActive,activeClass);});add$2(tgt,activeClass);})),run$1(focusout(),runOnItem(comp=>{descendant(comp.element,'.'+activeClass).each(currentActive=>{remove$2(currentActive,activeClass);});})),runOnExecute$1(runOnItem((comp,se,tgt,itemValue)=>{emitWith(comp,formActionEvent,{name:spec.name,value:itemValue});}))];var iterCollectionItems=(comp,applyAttributes)=>map$2(descendants(comp.element,'.tox-collection__item'),applyAttributes);var pField=FormField.parts.field({dom:{tag:'div',classes:['tox-collection'].concat(spec.columns!==1?['tox-collection--grid']:['tox-collection--list'])},components:[],factory:{sketch:identity},behaviours:derive$1([Disabling.config({disabled:providersBackstage.isDisabled,onDisabled:comp=>{iterCollectionItems(comp,childElm=>{add$2(childElm,'tox-collection__item--state-disabled');set$9(childElm,'aria-disabled',true);});},onEnabled:comp=>{iterCollectionItems(comp,childElm=>{remove$2(childElm,'tox-collection__item--state-disabled');remove$7(childElm,'aria-disabled');});}}),receivingConfig(),Replacing.config({}),Representing.config({store:{mode:'memory',initialValue:initialData.getOr([])},onSetValue:(comp,items)=>{setContents(comp,items);if(spec.columns==='auto'){detectSize(comp,5,'tox-collection__item').each(_ref6=>{var{numRows,numColumns}=_ref6;Keying.setGridSize(comp,numRows,numColumns);});}emit(comp,formResizeEvent);}}),Tabstopping.config({}),Keying.config(deriveCollectionMovement(spec.columns,'normal')),config('collection-events',collectionEvents)]),eventOrder:{[execute$5()]:['disabling','alloy.base.behaviour','collection-events']}});var extraClasses=['tox-form__group--collection'];return renderFormFieldWith(pLabel,pField,extraClasses,[]);};var ariaElements=['input','textarea'];var isAriaElement=elem=>{var name=name$3(elem);return contains$2(ariaElements,name);};var markValid=(component,invalidConfig)=>{var elem=invalidConfig.getRoot(component).getOr(component.element);remove$2(elem,invalidConfig.invalidClass);invalidConfig.notify.each(notifyInfo=>{if(isAriaElement(component.element)){set$9(component.element,'aria-invalid',false);}notifyInfo.getContainer(component).each(container=>{set$6(container,notifyInfo.validHtml);});notifyInfo.onValid(component);});};var markInvalid=(component,invalidConfig,invalidState,text)=>{var elem=invalidConfig.getRoot(component).getOr(component.element);add$2(elem,invalidConfig.invalidClass);invalidConfig.notify.each(notifyInfo=>{if(isAriaElement(component.element)){set$9(component.element,'aria-invalid',true);}notifyInfo.getContainer(component).each(container=>{set$6(container,text);});notifyInfo.onInvalid(component,text);});};var query=(component,invalidConfig,_invalidState)=>invalidConfig.validator.fold(()=>Future.pure(Result.value(true)),validatorInfo=>validatorInfo.validate(component));var run=(component,invalidConfig,invalidState)=>{invalidConfig.notify.each(notifyInfo=>{notifyInfo.onValidate(component);});return query(component,invalidConfig).map(valid=>{if(component.getSystem().isConnected()){return valid.fold(err=>{markInvalid(component,invalidConfig,invalidState,err);return Result.error(err);},v=>{markValid(component,invalidConfig);return Result.value(v);});}else{return Result.error('No longer in system');}});};var isInvalid=(component,invalidConfig)=>{var elem=invalidConfig.getRoot(component).getOr(component.element);return has(elem,invalidConfig.invalidClass);};var InvalidateApis=/*#__PURE__*/Object.freeze({__proto__:null,markValid:markValid,markInvalid:markInvalid,query:query,run:run,isInvalid:isInvalid});var events$8=(invalidConfig,invalidState)=>invalidConfig.validator.map(validatorInfo=>derive$2([run$1(validatorInfo.onEvent,component=>{run(component,invalidConfig,invalidState).get(identity);})].concat(validatorInfo.validateOnLoad?[runOnAttached(component=>{run(component,invalidConfig,invalidState).get(noop);})]:[]))).getOr({});var ActiveInvalidate=/*#__PURE__*/Object.freeze({__proto__:null,events:events$8});var InvalidateSchema=[required$1('invalidClass'),defaulted('getRoot',Optional.none),optionObjOf('notify',[defaulted('aria','alert'),defaulted('getContainer',Optional.none),defaulted('validHtml',''),onHandler('onValid'),onHandler('onInvalid'),onHandler('onValidate')]),optionObjOf('validator',[required$1('validate'),defaulted('onEvent','input'),defaulted('validateOnLoad',true)])];var Invalidating=create$4({fields:InvalidateSchema,name:'invalidating',active:ActiveInvalidate,apis:InvalidateApis,extra:{validation:validator=>{return component=>{var v=Representing.getValue(component);return Future.pure(validator(v));};}}});var exhibit$1=()=>nu$7({styles:{'-webkit-user-select':'none','user-select':'none','-ms-user-select':'none','-moz-user-select':'-moz-none'},attributes:{unselectable:'on'}});var events$7=()=>derive$2([abort(selectstart(),always)]);var ActiveUnselecting=/*#__PURE__*/Object.freeze({__proto__:null,events:events$7,exhibit:exhibit$1});var Unselecting=create$4({fields:[],name:'unselecting',active:ActiveUnselecting});var renderPanelButton=(spec,sharedBackstage)=>Dropdown.sketch({dom:spec.dom,components:spec.components,toggleClass:'mce-active',dropdownBehaviours:derive$1([DisablingConfigs.button(sharedBackstage.providers.isDisabled),receivingConfig(),Unselecting.config({}),Tabstopping.config({})]),layouts:spec.layouts,sandboxClasses:['tox-dialog__popups'],lazySink:sharedBackstage.getSink,fetch:comp=>Future.nu(callback=>spec.fetch(callback)).map(items=>Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6('menu-value'),items,value=>{spec.onItemAction(comp,value);},spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,never,sharedBackstage.providers),{movement:deriveMenuMovement(spec.columns,spec.presets)})))),parts:{menu:part(false,1,spec.presets)}});var colorInputChangeEvent=generate$6('color-input-change');var colorSwatchChangeEvent=generate$6('color-swatch-change');var colorPickerCancelEvent=generate$6('color-picker-cancel');var renderColorInput=(spec,sharedBackstage,colorInputBackstage,initialData)=>{var pField=FormField.parts.field({factory:Input,inputClasses:['tox-textfield'],data:initialData,onSetValue:c=>Invalidating.run(c).get(noop),inputBehaviours:derive$1([Disabling.config({disabled:sharedBackstage.providers.isDisabled}),receivingConfig(),Tabstopping.config({}),Invalidating.config({invalidClass:'tox-textbox-field-invalid',getRoot:comp=>parentElement(comp.element),notify:{onValid:comp=>{var val=Representing.getValue(comp);emitWith(comp,colorInputChangeEvent,{color:val});}},validator:{validateOnLoad:false,validate:input=>{var inputValue=Representing.getValue(input);if(inputValue.length===0){return Future.pure(Result.value(true));}else{var span=SugarElement.fromTag('span');set$8(span,'background-color',inputValue);var res=getRaw(span,'background-color').fold(()=>Result.error('blah'),_=>Result.value(inputValue));return Future.pure(res);}}}})]),selectOnFocus:false});var pLabel=spec.label.map(label=>renderLabel$3(label,sharedBackstage.providers));var emitSwatchChange=(colorBit,value)=>{emitWith(colorBit,colorSwatchChangeEvent,{value});};var onItemAction=(comp,value)=>{memColorButton.getOpt(comp).each(colorBit=>{if(value==='custom'){colorInputBackstage.colorPicker(valueOpt=>{valueOpt.fold(()=>emit(colorBit,colorPickerCancelEvent),value=>{emitSwatchChange(colorBit,value);addColor(spec.storageKey,value);});},'#ffffff');}else if(value==='remove'){emitSwatchChange(colorBit,'');}else{emitSwatchChange(colorBit,value);}});};var memColorButton=record(renderPanelButton({dom:{tag:'span',attributes:{'aria-label':sharedBackstage.providers.translate('Color swatch')}},layouts:{onRtl:()=>[southwest$2,southeast$2,south$2],onLtr:()=>[southeast$2,southwest$2,south$2]},components:[],fetch:getFetch$1(colorInputBackstage.getColors(spec.storageKey),spec.storageKey,colorInputBackstage.hasCustomColors()),columns:colorInputBackstage.getColorCols(spec.storageKey),presets:'color',onItemAction},sharedBackstage));return FormField.sketch({dom:{tag:'div',classes:['tox-form__group']},components:pLabel.toArray().concat([{dom:{tag:'div',classes:['tox-color-input']},components:[pField,memColorButton.asSpec()]}]),fieldBehaviours:derive$1([config('form-field-events',[run$1(colorInputChangeEvent,(comp,se)=>{memColorButton.getOpt(comp).each(colorButton=>{set$8(colorButton.element,'background-color',se.event.color);});emitWith(comp,formChangeEvent,{name:spec.name});}),run$1(colorSwatchChangeEvent,(comp,se)=>{FormField.getField(comp).each(field=>{Representing.setValue(field,se.event.value);Composing.getCurrent(comp).each(Focusing.focus);});}),run$1(colorPickerCancelEvent,(comp,_se)=>{FormField.getField(comp).each(_field=>{Composing.getCurrent(comp).each(Focusing.focus);});})])])});};var labelPart=optional({schema:[required$1('dom')],name:'label'});var edgePart=name=>optional({name:''+name+'-edge',overrides:detail=>{var action=detail.model.manager.edgeActions[name];return action.fold(()=>({}),a=>({events:derive$2([runActionExtra(touchstart(),(comp,se,d)=>a(comp,d),[detail]),runActionExtra(mousedown(),(comp,se,d)=>a(comp,d),[detail]),runActionExtra(mousemove(),(comp,se,det)=>{if(det.mouseIsDown.get()){a(comp,det);}},[detail])])}));}});var tlEdgePart=edgePart('top-left');var tedgePart=edgePart('top');var trEdgePart=edgePart('top-right');var redgePart=edgePart('right');var brEdgePart=edgePart('bottom-right');var bedgePart=edgePart('bottom');var blEdgePart=edgePart('bottom-left');var ledgePart=edgePart('left');var thumbPart=required({name:'thumb',defaults:constant$1({dom:{styles:{position:'absolute'}}}),overrides:detail=>{return{events:derive$2([redirectToPart(touchstart(),detail,'spectrum'),redirectToPart(touchmove(),detail,'spectrum'),redirectToPart(touchend(),detail,'spectrum'),redirectToPart(mousedown(),detail,'spectrum'),redirectToPart(mousemove(),detail,'spectrum'),redirectToPart(mouseup(),detail,'spectrum')])};}});var spectrumPart=required({schema:[customField('mouseIsDown',()=>Cell(false))],name:'spectrum',overrides:detail=>{var modelDetail=detail.model;var model=modelDetail.manager;var setValueFrom=(component,simulatedEvent)=>model.getValueFromEvent(simulatedEvent).map(value=>model.setValueFrom(component,detail,value));return{behaviours:derive$1([Keying.config({mode:'special',onLeft:spectrum=>model.onLeft(spectrum,detail),onRight:spectrum=>model.onRight(spectrum,detail),onUp:spectrum=>model.onUp(spectrum,detail),onDown:spectrum=>model.onDown(spectrum,detail)}),Focusing.config({})]),events:derive$2([run$1(touchstart(),setValueFrom),run$1(touchmove(),setValueFrom),run$1(mousedown(),setValueFrom),run$1(mousemove(),(spectrum,se)=>{if(detail.mouseIsDown.get()){setValueFrom(spectrum,se);}})])};}});var SliderParts=[labelPart,ledgePart,redgePart,tedgePart,bedgePart,tlEdgePart,trEdgePart,blEdgePart,brEdgePart,thumbPart,spectrumPart];var _sliderChangeEvent='slider.change.value';var sliderChangeEvent=constant$1(_sliderChangeEvent);var isTouchEvent$2=evt=>evt.type.indexOf('touch')!==-1;var getEventSource=simulatedEvent=>{var evt=simulatedEvent.event.raw;if(isTouchEvent$2(evt)){var touchEvent=evt;return touchEvent.touches!==undefined&&touchEvent.touches.length===1?Optional.some(touchEvent.touches[0]).map(t=>SugarPosition(t.clientX,t.clientY)):Optional.none();}else{var mouseEvent=evt;return mouseEvent.clientX!==undefined?Optional.some(mouseEvent).map(me=>SugarPosition(me.clientX,me.clientY)):Optional.none();}};var t='top',r='right',b='bottom',l='left';var minX=detail=>detail.model.minX;var minY=detail=>detail.model.minY;var min1X=detail=>detail.model.minX-1;var min1Y=detail=>detail.model.minY-1;var maxX=detail=>detail.model.maxX;var maxY=detail=>detail.model.maxY;var max1X=detail=>detail.model.maxX+1;var max1Y=detail=>detail.model.maxY+1;var range=(detail,max,min)=>max(detail)-min(detail);var xRange=detail=>range(detail,maxX,minX);var yRange=detail=>range(detail,maxY,minY);var halfX=detail=>xRange(detail)/2;var halfY=detail=>yRange(detail)/2;var step=detail=>detail.stepSize;var snap=detail=>detail.snapToGrid;var snapStart=detail=>detail.snapStart;var rounded=detail=>detail.rounded;var hasEdge=(detail,edgeName)=>detail[edgeName+'-edge']!==undefined;var hasLEdge=detail=>hasEdge(detail,l);var hasREdge=detail=>hasEdge(detail,r);var hasTEdge=detail=>hasEdge(detail,t);var hasBEdge=detail=>hasEdge(detail,b);var currentValue=detail=>detail.model.value.get();var xyValue=(x,y)=>({x,y});var fireSliderChange$3=(component,value)=>{emitWith(component,sliderChangeEvent(),{value});};var setToTLEdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(min1X(detail),min1Y(detail)));};var setToTEdge=(edge,detail)=>{fireSliderChange$3(edge,min1Y(detail));};var setToTEdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(halfX(detail),min1Y(detail)));};var setToTREdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(max1X(detail),min1Y(detail)));};var setToREdge=(edge,detail)=>{fireSliderChange$3(edge,max1X(detail));};var setToREdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(max1X(detail),halfY(detail)));};var setToBREdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(max1X(detail),max1Y(detail)));};var setToBEdge=(edge,detail)=>{fireSliderChange$3(edge,max1Y(detail));};var setToBEdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(halfX(detail),max1Y(detail)));};var setToBLEdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(min1X(detail),max1Y(detail)));};var setToLEdge=(edge,detail)=>{fireSliderChange$3(edge,min1X(detail));};var setToLEdgeXY=(edge,detail)=>{fireSliderChange$3(edge,xyValue(min1X(detail),halfY(detail)));};var reduceBy=(value,min,max,step)=>{if(value<min){return value;}else if(value>max){return max;}else if(value===min){return min-1;}else{return Math.max(min,value-step);}};var increaseBy=(value,min,max,step)=>{if(value>max){return value;}else if(value<min){return min;}else if(value===max){return max+1;}else{return Math.min(max,value+step);}};var capValue=(value,min,max)=>Math.max(min,Math.min(max,value));var snapValueOf=(value,min,max,step,snapStart)=>snapStart.fold(()=>{var initValue=value-min;var extraValue=Math.round(initValue/step)*step;return capValue(min+extraValue,min-1,max+1);},start=>{var remainder=(value-start)%step;var adjustment=Math.round(remainder/step);var rawSteps=Math.floor((value-start)/step);var maxSteps=Math.floor((max-start)/step);var numSteps=Math.min(maxSteps,rawSteps+adjustment);var r=start+numSteps*step;return Math.max(start,r);});var findOffsetOf=(value,min,max)=>Math.min(max,Math.max(value,min))-min;var findValueOf=args=>{var{min,max,range,value,step,snap,snapStart,rounded,hasMinEdge,hasMaxEdge,minBound,maxBound,screenRange}=args;var capMin=hasMinEdge?min-1:min;var capMax=hasMaxEdge?max+1:max;if(value<minBound){return capMin;}else if(value>maxBound){return capMax;}else{var _offset=findOffsetOf(value,minBound,maxBound);var newValue=capValue(_offset/screenRange*range+min,capMin,capMax);if(snap&&newValue>=min&&newValue<=max){return snapValueOf(newValue,min,max,step,snapStart);}else if(rounded){return Math.round(newValue);}else{return newValue;}}};var findOffsetOfValue$2=args=>{var{min,max,range,value,hasMinEdge,hasMaxEdge,maxBound,maxOffset,centerMinEdge,centerMaxEdge}=args;if(value<min){return hasMinEdge?0:centerMinEdge;}else if(value>max){return hasMaxEdge?maxBound:centerMaxEdge;}else{return(value-min)/range*maxOffset;}};var top='top',right='right',bottom='bottom',left='left',width='width',height='height';var getBounds=component=>component.element.dom.getBoundingClientRect();var getBoundsProperty=(bounds,property)=>bounds[property];var getMinXBounds=component=>{var bounds=getBounds(component);return getBoundsProperty(bounds,left);};var getMaxXBounds=component=>{var bounds=getBounds(component);return getBoundsProperty(bounds,right);};var getMinYBounds=component=>{var bounds=getBounds(component);return getBoundsProperty(bounds,top);};var getMaxYBounds=component=>{var bounds=getBounds(component);return getBoundsProperty(bounds,bottom);};var getXScreenRange=component=>{var bounds=getBounds(component);return getBoundsProperty(bounds,width);};var getYScreenRange=component=>{var bounds=getBounds(component);return getBoundsProperty(bounds,height);};var getCenterOffsetOf=(componentMinEdge,componentMaxEdge,spectrumMinEdge)=>(componentMinEdge+componentMaxEdge)/2-spectrumMinEdge;var getXCenterOffSetOf=(component,spectrum)=>{var componentBounds=getBounds(component);var spectrumBounds=getBounds(spectrum);var componentMinEdge=getBoundsProperty(componentBounds,left);var componentMaxEdge=getBoundsProperty(componentBounds,right);var spectrumMinEdge=getBoundsProperty(spectrumBounds,left);return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge);};var getYCenterOffSetOf=(component,spectrum)=>{var componentBounds=getBounds(component);var spectrumBounds=getBounds(spectrum);var componentMinEdge=getBoundsProperty(componentBounds,top);var componentMaxEdge=getBoundsProperty(componentBounds,bottom);var spectrumMinEdge=getBoundsProperty(spectrumBounds,top);return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge);};var fireSliderChange$2=(spectrum,value)=>{emitWith(spectrum,sliderChangeEvent(),{value});};var findValueOfOffset$1=(spectrum,detail,left)=>{var args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:left,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),maxBound:getMaxXBounds(spectrum),screenRange:getXScreenRange(spectrum)};return findValueOf(args);};var setValueFrom$2=(spectrum,detail,value)=>{var xValue=findValueOfOffset$1(spectrum,detail,value);var sliderVal=xValue;fireSliderChange$2(spectrum,sliderVal);return xValue;};var setToMin$2=(spectrum,detail)=>{var min=minX(detail);fireSliderChange$2(spectrum,min);};var setToMax$2=(spectrum,detail)=>{var max=maxX(detail);fireSliderChange$2(spectrum,max);};var moveBy$2=(direction,spectrum,detail)=>{var f=direction>0?increaseBy:reduceBy;var xValue=f(currentValue(detail),minX(detail),maxX(detail),step(detail));fireSliderChange$2(spectrum,xValue);return Optional.some(xValue);};var handleMovement$2=direction=>(spectrum,detail)=>moveBy$2(direction,spectrum,detail).map(always);var getValueFromEvent$2=simulatedEvent=>{var pos=getEventSource(simulatedEvent);return pos.map(p=>p.left);};var findOffsetOfValue$1=(spectrum,detail,value,minEdge,maxEdge)=>{var minOffset=0;var maxOffset=getXScreenRange(spectrum);var centerMinEdge=minEdge.bind(edge=>Optional.some(getXCenterOffSetOf(edge,spectrum))).getOr(minOffset);var centerMaxEdge=maxEdge.bind(edge=>Optional.some(getXCenterOffSetOf(edge,spectrum))).getOr(maxOffset);var args={min:minX(detail),max:maxX(detail),range:xRange(detail),value,hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),minOffset,maxBound:getMaxXBounds(spectrum),maxOffset,centerMinEdge,centerMaxEdge};return findOffsetOfValue$2(args);};var findPositionOfValue$1=(slider,spectrum,value,minEdge,maxEdge,detail)=>{var offset=findOffsetOfValue$1(spectrum,detail,value,minEdge,maxEdge);return getMinXBounds(spectrum)-getMinXBounds(slider)+offset;};var setPositionFromValue$2=(slider,thumb,detail,edges)=>{var value=currentValue(detail);var pos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail);var thumbRadius=get$c(thumb.element)/2;set$8(thumb.element,'left',pos-thumbRadius+'px');};var onLeft$2=handleMovement$2(-1);var onRight$2=handleMovement$2(1);var onUp$2=Optional.none;var onDown$2=Optional.none;var edgeActions$2={'top-left':Optional.none(),'top':Optional.none(),'top-right':Optional.none(),'right':Optional.some(setToREdge),'bottom-right':Optional.none(),'bottom':Optional.none(),'bottom-left':Optional.none(),'left':Optional.some(setToLEdge)};var HorizontalModel=/*#__PURE__*/Object.freeze({__proto__:null,setValueFrom:setValueFrom$2,setToMin:setToMin$2,setToMax:setToMax$2,findValueOfOffset:findValueOfOffset$1,getValueFromEvent:getValueFromEvent$2,findPositionOfValue:findPositionOfValue$1,setPositionFromValue:setPositionFromValue$2,onLeft:onLeft$2,onRight:onRight$2,onUp:onUp$2,onDown:onDown$2,edgeActions:edgeActions$2});var fireSliderChange$1=(spectrum,value)=>{emitWith(spectrum,sliderChangeEvent(),{value});};var findValueOfOffset=(spectrum,detail,top)=>{var args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:top,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),maxBound:getMaxYBounds(spectrum),screenRange:getYScreenRange(spectrum)};return findValueOf(args);};var setValueFrom$1=(spectrum,detail,value)=>{var yValue=findValueOfOffset(spectrum,detail,value);var sliderVal=yValue;fireSliderChange$1(spectrum,sliderVal);return yValue;};var setToMin$1=(spectrum,detail)=>{var min=minY(detail);fireSliderChange$1(spectrum,min);};var setToMax$1=(spectrum,detail)=>{var max=maxY(detail);fireSliderChange$1(spectrum,max);};var moveBy$1=(direction,spectrum,detail)=>{var f=direction>0?increaseBy:reduceBy;var yValue=f(currentValue(detail),minY(detail),maxY(detail),step(detail));fireSliderChange$1(spectrum,yValue);return Optional.some(yValue);};var handleMovement$1=direction=>(spectrum,detail)=>moveBy$1(direction,spectrum,detail).map(always);var getValueFromEvent$1=simulatedEvent=>{var pos=getEventSource(simulatedEvent);return pos.map(p=>{return p.top;});};var findOffsetOfValue=(spectrum,detail,value,minEdge,maxEdge)=>{var minOffset=0;var maxOffset=getYScreenRange(spectrum);var centerMinEdge=minEdge.bind(edge=>Optional.some(getYCenterOffSetOf(edge,spectrum))).getOr(minOffset);var centerMaxEdge=maxEdge.bind(edge=>Optional.some(getYCenterOffSetOf(edge,spectrum))).getOr(maxOffset);var args={min:minY(detail),max:maxY(detail),range:yRange(detail),value,hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),minOffset,maxBound:getMaxYBounds(spectrum),maxOffset,centerMinEdge,centerMaxEdge};return findOffsetOfValue$2(args);};var findPositionOfValue=(slider,spectrum,value,minEdge,maxEdge,detail)=>{var offset=findOffsetOfValue(spectrum,detail,value,minEdge,maxEdge);return getMinYBounds(spectrum)-getMinYBounds(slider)+offset;};var setPositionFromValue$1=(slider,thumb,detail,edges)=>{var value=currentValue(detail);var pos=findPositionOfValue(slider,edges.getSpectrum(slider),value,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail);var thumbRadius=get$d(thumb.element)/2;set$8(thumb.element,'top',pos-thumbRadius+'px');};var onLeft$1=Optional.none;var onRight$1=Optional.none;var onUp$1=handleMovement$1(-1);var onDown$1=handleMovement$1(1);var edgeActions$1={'top-left':Optional.none(),'top':Optional.some(setToTEdge),'top-right':Optional.none(),'right':Optional.none(),'bottom-right':Optional.none(),'bottom':Optional.some(setToBEdge),'bottom-left':Optional.none(),'left':Optional.none()};var VerticalModel=/*#__PURE__*/Object.freeze({__proto__:null,setValueFrom:setValueFrom$1,setToMin:setToMin$1,setToMax:setToMax$1,findValueOfOffset:findValueOfOffset,getValueFromEvent:getValueFromEvent$1,findPositionOfValue:findPositionOfValue,setPositionFromValue:setPositionFromValue$1,onLeft:onLeft$1,onRight:onRight$1,onUp:onUp$1,onDown:onDown$1,edgeActions:edgeActions$1});var fireSliderChange=(spectrum,value)=>{emitWith(spectrum,sliderChangeEvent(),{value});};var sliderValue=(x,y)=>({x,y});var setValueFrom=(spectrum,detail,value)=>{var xValue=findValueOfOffset$1(spectrum,detail,value.left);var yValue=findValueOfOffset(spectrum,detail,value.top);var val=sliderValue(xValue,yValue);fireSliderChange(spectrum,val);return val;};var moveBy=(direction,isVerticalMovement,spectrum,detail)=>{var f=direction>0?increaseBy:reduceBy;var xValue=isVerticalMovement?currentValue(detail).x:f(currentValue(detail).x,minX(detail),maxX(detail),step(detail));var yValue=!isVerticalMovement?currentValue(detail).y:f(currentValue(detail).y,minY(detail),maxY(detail),step(detail));fireSliderChange(spectrum,sliderValue(xValue,yValue));return Optional.some(xValue);};var handleMovement=(direction,isVerticalMovement)=>(spectrum,detail)=>moveBy(direction,isVerticalMovement,spectrum,detail).map(always);var setToMin=(spectrum,detail)=>{var mX=minX(detail);var mY=minY(detail);fireSliderChange(spectrum,sliderValue(mX,mY));};var setToMax=(spectrum,detail)=>{var mX=maxX(detail);var mY=maxY(detail);fireSliderChange(spectrum,sliderValue(mX,mY));};var getValueFromEvent=simulatedEvent=>getEventSource(simulatedEvent);var setPositionFromValue=(slider,thumb,detail,edges)=>{var value=currentValue(detail);var xPos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail);var yPos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail);var thumbXRadius=get$c(thumb.element)/2;var thumbYRadius=get$d(thumb.element)/2;set$8(thumb.element,'left',xPos-thumbXRadius+'px');set$8(thumb.element,'top',yPos-thumbYRadius+'px');};var onLeft=handleMovement(-1,false);var onRight=handleMovement(1,false);var onUp=handleMovement(-1,true);var onDown=handleMovement(1,true);var edgeActions={'top-left':Optional.some(setToTLEdgeXY),'top':Optional.some(setToTEdgeXY),'top-right':Optional.some(setToTREdgeXY),'right':Optional.some(setToREdgeXY),'bottom-right':Optional.some(setToBREdgeXY),'bottom':Optional.some(setToBEdgeXY),'bottom-left':Optional.some(setToBLEdgeXY),'left':Optional.some(setToLEdgeXY)};var TwoDModel=/*#__PURE__*/Object.freeze({__proto__:null,setValueFrom:setValueFrom,setToMin:setToMin,setToMax:setToMax,getValueFromEvent:getValueFromEvent,setPositionFromValue:setPositionFromValue,onLeft:onLeft,onRight:onRight,onUp:onUp,onDown:onDown,edgeActions:edgeActions});var SliderSchema=[defaulted('stepSize',1),defaulted('onChange',noop),defaulted('onChoose',noop),defaulted('onInit',noop),defaulted('onDragStart',noop),defaulted('onDragEnd',noop),defaulted('snapToGrid',false),defaulted('rounded',true),option$3('snapStart'),requiredOf('model',choose$1('mode',{x:[defaulted('minX',0),defaulted('maxX',100),customField('value',spec=>Cell(spec.mode.minX)),required$1('getInitialValue'),output$1('manager',HorizontalModel)],y:[defaulted('minY',0),defaulted('maxY',100),customField('value',spec=>Cell(spec.mode.minY)),required$1('getInitialValue'),output$1('manager',VerticalModel)],xy:[defaulted('minX',0),defaulted('maxX',100),defaulted('minY',0),defaulted('maxY',100),customField('value',spec=>Cell({x:spec.mode.minX,y:spec.mode.minY})),required$1('getInitialValue'),output$1('manager',TwoDModel)]})),field('sliderBehaviours',[Keying,Representing]),customField('mouseIsDown',()=>Cell(false))];var sketch$2=(detail,components,_spec,_externals)=>{var getThumb=component=>getPartOrDie(component,detail,'thumb');var getSpectrum=component=>getPartOrDie(component,detail,'spectrum');var getLeftEdge=component=>getPart(component,detail,'left-edge');var getRightEdge=component=>getPart(component,detail,'right-edge');var getTopEdge=component=>getPart(component,detail,'top-edge');var getBottomEdge=component=>getPart(component,detail,'bottom-edge');var modelDetail=detail.model;var model=modelDetail.manager;var refresh=(slider,thumb)=>{model.setPositionFromValue(slider,thumb,detail,{getLeftEdge,getRightEdge,getTopEdge,getBottomEdge,getSpectrum});};var setValue=(slider,newValue)=>{modelDetail.value.set(newValue);var thumb=getThumb(slider);refresh(slider,thumb);};var changeValue=(slider,newValue)=>{setValue(slider,newValue);var thumb=getThumb(slider);detail.onChange(slider,thumb,newValue);return Optional.some(true);};var resetToMin=slider=>{model.setToMin(slider,detail);};var resetToMax=slider=>{model.setToMax(slider,detail);};var choose=slider=>{var fireOnChoose=()=>{getPart(slider,detail,'thumb').each(thumb=>{var value=modelDetail.value.get();detail.onChoose(slider,thumb,value);});};var wasDown=detail.mouseIsDown.get();detail.mouseIsDown.set(false);if(wasDown){fireOnChoose();}};var onDragStart=(slider,simulatedEvent)=>{simulatedEvent.stop();detail.mouseIsDown.set(true);detail.onDragStart(slider,getThumb(slider));};var onDragEnd=(slider,simulatedEvent)=>{simulatedEvent.stop();detail.onDragEnd(slider,getThumb(slider));choose(slider);};return{uid:detail.uid,dom:detail.dom,components,behaviours:augment(detail.sliderBehaviours,[Keying.config({mode:'special',focusIn:slider=>{return getPart(slider,detail,'spectrum').map(Keying.focusIn).map(always);}}),Representing.config({store:{mode:'manual',getValue:_=>{return modelDetail.value.get();},setValue}}),Receiving.config({channels:{[mouseReleased()]:{onReceive:choose}}})]),events:derive$2([run$1(sliderChangeEvent(),(slider,simulatedEvent)=>{changeValue(slider,simulatedEvent.event.value);}),runOnAttached((slider,_simulatedEvent)=>{var getInitial=modelDetail.getInitialValue();modelDetail.value.set(getInitial);var thumb=getThumb(slider);refresh(slider,thumb);var spectrum=getSpectrum(slider);detail.onInit(slider,thumb,spectrum,modelDetail.value.get());}),run$1(touchstart(),onDragStart),run$1(touchend(),onDragEnd),run$1(mousedown(),onDragStart),run$1(mouseup(),onDragEnd)]),apis:{resetToMin,resetToMax,setValue,refresh},domModification:{styles:{position:'relative'}}};};var Slider=composite({name:'Slider',configFields:SliderSchema,partFields:SliderParts,factory:sketch$2,apis:{setValue:(apis,slider,value)=>{apis.setValue(slider,value);},resetToMin:(apis,slider)=>{apis.resetToMin(slider);},resetToMax:(apis,slider)=>{apis.resetToMax(slider);},refresh:(apis,slider)=>{apis.refresh(slider);}}});var fieldsUpdate=generate$6('rgb-hex-update');var sliderUpdate=generate$6('slider-update');var paletteUpdate=generate$6('palette-update');var sliderFactory=(translate,getClass)=>{var spectrum=Slider.parts.spectrum({dom:{tag:'div',classes:[getClass('hue-slider-spectrum')],attributes:{role:'presentation'}}});var thumb=Slider.parts.thumb({dom:{tag:'div',classes:[getClass('hue-slider-thumb')],attributes:{role:'presentation'}}});return Slider.sketch({dom:{tag:'div',classes:[getClass('hue-slider')],attributes:{role:'presentation'}},rounded:false,model:{mode:'y',getInitialValue:constant$1(0)},components:[spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChange:(slider,_thumb,value)=>{emitWith(slider,sliderUpdate,{value});}});};var owner$1='form';var schema$i=[field('formBehaviours',[Representing])];var getPartName$1=name=>'<alloy.field.'+name+'>';var sketch$1=fSpec=>{var parts=(()=>{var record=[];var field=(name,config)=>{record.push(name);return generateOne$1(owner$1,getPartName$1(name),config);};return{field,record:constant$1(record)};})();var spec=fSpec(parts);var partNames=parts.record();var fieldParts=map$2(partNames,n=>required({name:n,pname:getPartName$1(n)}));return composite$1(owner$1,schema$i,fieldParts,make$4,spec);};var toResult=(o,e)=>o.fold(()=>Result.error(e),Result.value);var make$4=(detail,components)=>({uid:detail.uid,dom:detail.dom,components,behaviours:augment(detail.formBehaviours,[Representing.config({store:{mode:'manual',getValue:form=>{var resPs=getAllParts(form,detail);return map$1(resPs,(resPThunk,pName)=>resPThunk().bind(v=>{var opt=Composing.getCurrent(v);return toResult(opt,new Error(\"Cannot find a current component to extract the value from for form part '\".concat(pName,\"': \")+element(v.element)));}).map(Representing.getValue));},setValue:(form,values)=>{each(values,(newValue,key)=>{getPart(form,detail,key).each(wrapper=>{Composing.getCurrent(wrapper).each(field=>{Representing.setValue(field,newValue);});});});}}})]),apis:{getField:(form,key)=>{return getPart(form,detail,key).bind(Composing.getCurrent);}}});var Form={getField:makeApi((apis,component,key)=>apis.getField(component,key)),sketch:sketch$1};var validInput=generate$6('valid-input');var invalidInput=generate$6('invalid-input');var validatingInput=generate$6('validating-input');var translatePrefix='colorcustom.rgb.';var rgbFormFactory=(translate,getClass,onValidHexx,onInvalidHexx)=>{var invalidation=(label,isValid)=>Invalidating.config({invalidClass:getClass('invalid'),notify:{onValidate:comp=>{emitWith(comp,validatingInput,{type:label});},onValid:comp=>{emitWith(comp,validInput,{type:label,value:Representing.getValue(comp)});},onInvalid:comp=>{emitWith(comp,invalidInput,{type:label,value:Representing.getValue(comp)});}},validator:{validate:comp=>{var value=Representing.getValue(comp);var res=isValid(value)?Result.value(true):Result.error(translate('aria.input.invalid'));return Future.pure(res);},validateOnLoad:false}});var renderTextField=(isValid,name,label,description,data)=>{var helptext=translate(translatePrefix+'range');var pLabel=FormField.parts.label({dom:{tag:'label',attributes:{'aria-label':description}},components:[text$2(label)]});var pField=FormField.parts.field({data,factory:Input,inputAttributes:_objectSpread({type:'text'},name==='hex'?{'aria-live':'polite'}:{}),inputClasses:[getClass('textfield')],inputBehaviours:derive$1([invalidation(name,isValid),Tabstopping.config({})]),onSetValue:input=>{if(Invalidating.isInvalid(input)){var _run=Invalidating.run(input);_run.get(noop);}}});var comps=[pLabel,pField];var concats=name!=='hex'?[FormField.parts['aria-descriptor']({text:helptext})]:[];var components=comps.concat(concats);return{dom:{tag:'div',attributes:{role:'presentation'}},components};};var copyRgbToHex=(form,rgba)=>{var hex=fromRgba(rgba);Form.getField(form,'hex').each(hexField=>{if(!Focusing.isFocused(hexField)){Representing.setValue(form,{hex:hex.value});}});return hex;};var copyRgbToForm=(form,rgb)=>{var red=rgb.red;var green=rgb.green;var blue=rgb.blue;Representing.setValue(form,{red,green,blue});};var memPreview=record({dom:{tag:'div',classes:[getClass('rgba-preview')],styles:{'background-color':'white'},attributes:{role:'presentation'}}});var updatePreview=(anyInSystem,hex)=>{memPreview.getOpt(anyInSystem).each(preview=>{set$8(preview.element,'background-color','#'+hex.value);});};var factory=()=>{var state={red:Cell(Optional.some(255)),green:Cell(Optional.some(255)),blue:Cell(Optional.some(255)),hex:Cell(Optional.some('ffffff'))};var copyHexToRgb=(form,hex)=>{var rgb=fromHex(hex);copyRgbToForm(form,rgb);setValueRgb(rgb);};var get=prop=>state[prop].get();var set=(prop,value)=>{state[prop].set(value);};var getValueRgb=()=>get('red').bind(red=>get('green').bind(green=>get('blue').map(blue=>rgbaColour(red,green,blue,1))));var setValueRgb=rgb=>{var red=rgb.red;var green=rgb.green;var blue=rgb.blue;set('red',Optional.some(red));set('green',Optional.some(green));set('blue',Optional.some(blue));};var onInvalidInput=(form,simulatedEvent)=>{var data=simulatedEvent.event;if(data.type!=='hex'){set(data.type,Optional.none());}else{onInvalidHexx(form);}};var onValidHex=(form,value)=>{onValidHexx(form);var hex=hexColour(value);set('hex',Optional.some(hex.value));var rgb=fromHex(hex);copyRgbToForm(form,rgb);setValueRgb(rgb);emitWith(form,fieldsUpdate,{hex});updatePreview(form,hex);};var onValidRgb=(form,prop,value)=>{var val=parseInt(value,10);set(prop,Optional.some(val));getValueRgb().each(rgb=>{var hex=copyRgbToHex(form,rgb);emitWith(form,fieldsUpdate,{hex});updatePreview(form,hex);});};var isHexInputEvent=data=>data.type==='hex';var onValidInput=(form,simulatedEvent)=>{var data=simulatedEvent.event;if(isHexInputEvent(data)){onValidHex(form,data.value);}else{onValidRgb(form,data.type,data.value);}};var formPartStrings=key=>({label:translate(translatePrefix+key+'.label'),description:translate(translatePrefix+key+'.description')});var redStrings=formPartStrings('red');var greenStrings=formPartStrings('green');var blueStrings=formPartStrings('blue');var hexStrings=formPartStrings('hex');return deepMerge(Form.sketch(parts=>({dom:{tag:'form',classes:[getClass('rgb-form')],attributes:{'aria-label':translate('aria.color.picker')}},components:[parts.field('red',FormField.sketch(renderTextField(isRgbaComponent,'red',redStrings.label,redStrings.description,255))),parts.field('green',FormField.sketch(renderTextField(isRgbaComponent,'green',greenStrings.label,greenStrings.description,255))),parts.field('blue',FormField.sketch(renderTextField(isRgbaComponent,'blue',blueStrings.label,blueStrings.description,255))),parts.field('hex',FormField.sketch(renderTextField(isHexString,'hex',hexStrings.label,hexStrings.description,'ffffff'))),memPreview.asSpec()],formBehaviours:derive$1([Invalidating.config({invalidClass:getClass('form-invalid')}),config('rgb-form-events',[run$1(validInput,onValidInput),run$1(invalidInput,onInvalidInput),run$1(validatingInput,onInvalidInput)])])})),{apis:{updateHex:(form,hex)=>{Representing.setValue(form,{hex:hex.value});copyHexToRgb(form,hex);updatePreview(form,hex);}}});};var rgbFormSketcher=single({factory,name:'RgbForm',configFields:[],apis:{updateHex:(apis,form,hex)=>{apis.updateHex(form,hex);}},extraApis:{}});return rgbFormSketcher;};var paletteFactory=(_translate,getClass)=>{var spectrumPart=Slider.parts.spectrum({dom:{tag:'canvas',attributes:{role:'presentation'},classes:[getClass('sv-palette-spectrum')]}});var thumbPart=Slider.parts.thumb({dom:{tag:'div',attributes:{role:'presentation'},classes:[getClass('sv-palette-thumb')],innerHtml:\"<div class=\".concat(getClass('sv-palette-inner-thumb'),\" role=\\\"presentation\\\"></div>\")}});var setColour=(canvas,rgba)=>{var{width,height}=canvas;var ctx=canvas.getContext('2d');if(ctx===null){return;}ctx.fillStyle=rgba;ctx.fillRect(0,0,width,height);var grdWhite=ctx.createLinearGradient(0,0,width,0);grdWhite.addColorStop(0,'rgba(255,255,255,1)');grdWhite.addColorStop(1,'rgba(255,255,255,0)');ctx.fillStyle=grdWhite;ctx.fillRect(0,0,width,height);var grdBlack=ctx.createLinearGradient(0,0,0,height);grdBlack.addColorStop(0,'rgba(0,0,0,0)');grdBlack.addColorStop(1,'rgba(0,0,0,1)');ctx.fillStyle=grdBlack;ctx.fillRect(0,0,width,height);};var setPaletteHue=(slider,hue)=>{var canvas=slider.components()[0].element.dom;var hsv=hsvColour(hue,100,100);var rgba=fromHsv(hsv);setColour(canvas,toString(rgba));};var setPaletteThumb=(slider,hex)=>{var hsv=fromRgb(fromHex(hex));Slider.setValue(slider,{x:hsv.saturation,y:100-hsv.value});};var factory=_detail=>{var getInitialValue=constant$1({x:0,y:0});var onChange=(slider,_thumb,value)=>{emitWith(slider,paletteUpdate,{value});};var onInit=(_slider,_thumb,spectrum,_value)=>{setColour(spectrum.element.dom,toString(red));};var sliderBehaviours=derive$1([Composing.config({find:Optional.some}),Focusing.config({})]);return Slider.sketch({dom:{tag:'div',attributes:{role:'presentation'},classes:[getClass('sv-palette')]},model:{mode:'xy',getInitialValue},rounded:false,components:[spectrumPart,thumbPart],onChange,onInit,sliderBehaviours});};var saturationBrightnessPaletteSketcher=single({factory,name:'SaturationBrightnessPalette',configFields:[],apis:{setHue:(_apis,slider,hue)=>{setPaletteHue(slider,hue);},setThumb:(_apis,slider,hex)=>{setPaletteThumb(slider,hex);}},extraApis:{}});return saturationBrightnessPaletteSketcher;};var makeFactory=(translate,getClass)=>{var factory=detail=>{var rgbForm=rgbFormFactory(translate,getClass,detail.onValidHex,detail.onInvalidHex);var sbPalette=paletteFactory(translate,getClass);var hueSliderToDegrees=hue=>(100-hue)/100*360;var hueDegreesToSlider=hue=>100-hue/360*100;var state={paletteRgba:Cell(red),paletteHue:Cell(0)};var memSlider=record(sliderFactory(translate,getClass));var memPalette=record(sbPalette.sketch({}));var memRgb=record(rgbForm.sketch({}));var updatePalette=(anyInSystem,_hex,hue)=>{memPalette.getOpt(anyInSystem).each(palette=>{sbPalette.setHue(palette,hue);});};var updateFields=(anyInSystem,hex)=>{memRgb.getOpt(anyInSystem).each(form=>{rgbForm.updateHex(form,hex);});};var updateSlider=(anyInSystem,_hex,hue)=>{memSlider.getOpt(anyInSystem).each(slider=>{Slider.setValue(slider,hueDegreesToSlider(hue));});};var updatePaletteThumb=(anyInSystem,hex)=>{memPalette.getOpt(anyInSystem).each(palette=>{sbPalette.setThumb(palette,hex);});};var updateState=(hex,hue)=>{var rgba=fromHex(hex);state.paletteRgba.set(rgba);state.paletteHue.set(hue);};var runUpdates=(anyInSystem,hex,hue,updates)=>{updateState(hex,hue);each$1(updates,update=>{update(anyInSystem,hex,hue);});};var onPaletteUpdate=()=>{var updates=[updateFields];return(form,simulatedEvent)=>{var value=simulatedEvent.event.value;var oldHue=state.paletteHue.get();var newHsv=hsvColour(oldHue,value.x,100-value.y);var newHex=hsvToHex(newHsv);runUpdates(form,newHex,oldHue,updates);};};var onSliderUpdate=()=>{var updates=[updatePalette,updateFields];return(form,simulatedEvent)=>{var hue=hueSliderToDegrees(simulatedEvent.event.value);var oldRgb=state.paletteRgba.get();var oldHsv=fromRgb(oldRgb);var newHsv=hsvColour(hue,oldHsv.saturation,oldHsv.value);var newHex=hsvToHex(newHsv);runUpdates(form,newHex,hue,updates);};};var onFieldsUpdate=()=>{var updates=[updatePalette,updateSlider,updatePaletteThumb];return(form,simulatedEvent)=>{var hex=simulatedEvent.event.hex;var hsv=hexToHsv(hex);runUpdates(form,hex,hsv.hue,updates);};};return{uid:detail.uid,dom:detail.dom,components:[memPalette.asSpec(),memSlider.asSpec(),memRgb.asSpec()],behaviours:derive$1([config('colour-picker-events',[run$1(fieldsUpdate,onFieldsUpdate()),run$1(paletteUpdate,onPaletteUpdate()),run$1(sliderUpdate,onSliderUpdate())]),Composing.config({find:comp=>memRgb.getOpt(comp)}),Keying.config({mode:'acyclic'})])};};var colourPickerSketcher=single({name:'ColourPicker',configFields:[required$1('dom'),defaulted('onValidHex',noop),defaulted('onInvalidHex',noop)],factory});return colourPickerSketcher;};var self=()=>Composing.config({find:Optional.some});var memento$1=mem=>Composing.config({find:mem.getOpt});var childAt=index=>Composing.config({find:comp=>child$2(comp.element,index).bind(element=>comp.getSystem().getByDom(element).toOptional())});var ComposingConfigs={self,memento:memento$1,childAt};var processors=objOf([defaulted('preprocess',identity),defaulted('postprocess',identity)]);var memento=(mem,rawProcessors)=>{var ps=asRawOrDie$1('RepresentingConfigs.memento processors',processors,rawProcessors);return Representing.config({store:{mode:'manual',getValue:comp=>{var other=mem.get(comp);var rawValue=Representing.getValue(other);return ps.postprocess(rawValue);},setValue:(comp,rawValue)=>{var newValue=ps.preprocess(rawValue);var other=mem.get(comp);Representing.setValue(other,newValue);}}});};var withComp=(optInitialValue,getter,setter)=>Representing.config({store:_objectSpread(_objectSpread({mode:'manual'},optInitialValue.map(initialValue=>({initialValue})).getOr({})),{},{getValue:getter,setValue:setter})});var withElement=(initialValue,getter,setter)=>withComp(initialValue,c=>getter(c.element),(c,v)=>setter(c.element,v));var domHtml=optInitialValue=>withElement(optInitialValue,get$9,set$6);var memory=initialValue=>Representing.config({store:{mode:'memory',initialValue}});var english={'colorcustom.rgb.red.label':'R','colorcustom.rgb.red.description':'Red component','colorcustom.rgb.green.label':'G','colorcustom.rgb.green.description':'Green component','colorcustom.rgb.blue.label':'B','colorcustom.rgb.blue.description':'Blue component','colorcustom.rgb.hex.label':'#','colorcustom.rgb.hex.description':'Hex color code','colorcustom.rgb.range':'Range 0 to 255','aria.color.picker':'Color Picker','aria.input.invalid':'Invalid input'};var translate$1=providerBackstage=>key=>{return providerBackstage.translate(english[key]);};var renderColorPicker=(_spec,providerBackstage,initialData)=>{var getClass=key=>'tox-'+key;var colourPickerFactory=makeFactory(translate$1(providerBackstage),getClass);var onValidHex=form=>{emitWith(form,formActionEvent,{name:'hex-valid',value:true});};var onInvalidHex=form=>{emitWith(form,formActionEvent,{name:'hex-valid',value:false});};var memPicker=record(colourPickerFactory.sketch({dom:{tag:'div',classes:[getClass('color-picker-container')],attributes:{role:'presentation'}},onValidHex,onInvalidHex}));return{dom:{tag:'div'},components:[memPicker.asSpec()],behaviours:derive$1([withComp(initialData,comp=>{var picker=memPicker.get(comp);var optRgbForm=Composing.getCurrent(picker);var optHex=optRgbForm.bind(rgbForm=>{var formValues=Representing.getValue(rgbForm);return formValues.hex;});return optHex.map(hex=>'#'+removeLeading(hex,'#')).getOr('');},(comp,newValue)=>{var pattern=/^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/;var valOpt=Optional.from(pattern.exec(newValue)).bind(matches=>get$h(matches,1));var picker=memPicker.get(comp);var optRgbForm=Composing.getCurrent(picker);optRgbForm.fold(()=>{console.log('Can not find form');},rgbForm=>{Representing.setValue(rgbForm,{hex:valOpt.getOr('')});Form.getField(rgbForm,'hex').each(hexField=>{emit(hexField,input());});});}),ComposingConfigs.self()])};};var global$2=tinymce.util.Tools.resolve('tinymce.Resource');var isOldCustomEditor=spec=>has$2(spec,'init');var renderCustomEditor=spec=>{var editorApi=value$2();var memReplaced=record({dom:{tag:spec.tag}});var initialValue=value$2();return{dom:{tag:'div',classes:['tox-custom-editor']},behaviours:derive$1([config('custom-editor-events',[runOnAttached(component=>{memReplaced.getOpt(component).each(ta=>{(isOldCustomEditor(spec)?spec.init(ta.element.dom):global$2.load(spec.scriptId,spec.scriptUrl).then(init=>init(ta.element.dom,spec.settings))).then(ea=>{initialValue.on(cvalue=>{ea.setValue(cvalue);});initialValue.clear();editorApi.set(ea);});});})]),withComp(Optional.none(),()=>editorApi.get().fold(()=>initialValue.get().getOr(''),ed=>ed.getValue()),(component,value)=>{editorApi.get().fold(()=>initialValue.set(value),ed=>ed.setValue(value));}),ComposingConfigs.self()]),components:[memReplaced.asSpec()]};};var global$1=tinymce.util.Tools.resolve('tinymce.util.Tools');var filterByExtension=(files,providersBackstage)=>{var allowedImageFileTypes=global$1.explode(providersBackstage.getOption('images_file_types'));var isFileInAllowedTypes=file=>exists(allowedImageFileTypes,type=>endsWith(file.name.toLowerCase(),\".\".concat(type.toLowerCase())));return filter$2(from(files),isFileInAllowedTypes);};var renderDropZone=(spec,providersBackstage,initialData)=>{var stopper=(_,se)=>{se.stop();};var sequence=actions=>(comp,se)=>{each$1(actions,a=>{a(comp,se);});};var onDrop=(comp,se)=>{var _a;if(!Disabling.isDisabled(comp)){var transferEvent=se.event.raw;handleFiles(comp,(_a=transferEvent.dataTransfer)===null||_a===void 0?void 0:_a.files);}};var onSelect=(component,simulatedEvent)=>{var input=simulatedEvent.event.raw.target;handleFiles(component,input.files);};var handleFiles=(component,files)=>{if(files){Representing.setValue(component,filterByExtension(files,providersBackstage));emitWith(component,formChangeEvent,{name:spec.name});}};var memInput=record({dom:{tag:'input',attributes:{type:'file',accept:'image/*'},styles:{display:'none'}},behaviours:derive$1([config('input-file-events',[cutter(click()),cutter(tap())])])});var renderField=s=>({uid:s.uid,dom:{tag:'div',classes:['tox-dropzone-container']},behaviours:derive$1([memory(initialData.getOr([])),ComposingConfigs.self(),Disabling.config({}),Toggling.config({toggleClass:'dragenter',toggleOnExecute:false}),config('dropzone-events',[run$1('dragenter',sequence([stopper,Toggling.toggle])),run$1('dragleave',sequence([stopper,Toggling.toggle])),run$1('dragover',stopper),run$1('drop',sequence([stopper,onDrop])),run$1(change(),onSelect)])]),components:[{dom:{tag:'div',classes:['tox-dropzone'],styles:{}},components:[{dom:{tag:'p'},components:[text$2(providersBackstage.translate('Drop an image here'))]},Button.sketch({dom:{tag:'button',styles:{position:'relative'},classes:['tox-button','tox-button--secondary']},components:[text$2(providersBackstage.translate('Browse for an image')),memInput.asSpec()],action:comp=>{var inputComp=memInput.get(comp);inputComp.element.dom.click();},buttonBehaviours:derive$1([Tabstopping.config({}),DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig()])})]}]});var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var pField=FormField.parts.field({factory:{sketch:renderField}});return renderFormFieldWith(pLabel,pField,['tox-form__group--stretched'],[]);};var renderGrid=(spec,backstage)=>({dom:{tag:'div',classes:['tox-form__grid',\"tox-form__grid--\".concat(spec.columns,\"col\")]},components:map$2(spec.items,backstage.interpreter)});var adaptable=(fn,rate)=>{var timer=null;var args=null;var cancel=()=>{if(!isNull(timer)){clearTimeout(timer);timer=null;args=null;}};var throttle=function throttle(){for(var _len17=arguments.length,newArgs=new Array(_len17),_key17=0;_key17<_len17;_key17++){newArgs[_key17]=arguments[_key17];}args=newArgs;if(isNull(timer)){timer=setTimeout(()=>{var tempArgs=args;timer=null;args=null;fn.apply(null,tempArgs);},rate);}};return{cancel,throttle};};var first=(fn,rate)=>{var timer=null;var cancel=()=>{if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++){args[_key18]=arguments[_key18];}if(isNull(timer)){timer=setTimeout(()=>{timer=null;fn.apply(null,args);},rate);}};return{cancel,throttle};};var last=(fn,rate)=>{var timer=null;var cancel=()=>{if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){for(var _len19=arguments.length,args=new Array(_len19),_key19=0;_key19<_len19;_key19++){args[_key19]=arguments[_key19];}cancel();timer=setTimeout(()=>{timer=null;fn.apply(null,args);},rate);};return{cancel,throttle};};var beforeObject=generate$6('alloy-fake-before-tabstop');var afterObject=generate$6('alloy-fake-after-tabstop');var craftWithClasses=classes=>{return{dom:{tag:'div',styles:{width:'1px',height:'1px',outline:'none'},attributes:{tabindex:'0'},classes},behaviours:derive$1([Focusing.config({ignore:true}),Tabstopping.config({})])};};var craft=(containerClasses,spec)=>{return{dom:{tag:'div',classes:['tox-navobj',...containerClasses.getOr([])]},components:[craftWithClasses([beforeObject]),spec,craftWithClasses([afterObject])],behaviours:derive$1([ComposingConfigs.childAt(1)])};};var triggerTab=(placeholder,shiftKey)=>{emitWith(placeholder,keydown(),{raw:{which:9,shiftKey}});};var onFocus=(container,targetComp)=>{var target=targetComp.element;if(has(target,beforeObject)){triggerTab(container,true);}else if(has(target,afterObject)){triggerTab(container,false);}};var isPseudoStop=element=>{return closest(element,['.'+beforeObject,'.'+afterObject].join(','),never);};var dialogChannel=generate$6('update-dialog');var titleChannel=generate$6('update-title');var bodyChannel=generate$6('update-body');var footerChannel=generate$6('update-footer');var bodySendMessageChannel=generate$6('body-send-message');var dialogFocusShiftedChannel=generate$6('dialog-focus-shifted');var browser=detect$2().browser;var isSafari=browser.isSafari();var isFirefox=browser.isFirefox();var isSafariOrFirefox=isSafari||isFirefox;var isChromium=browser.isChromium();var isElementScrollAtBottom=_ref7=>{var{scrollTop,scrollHeight,clientHeight}=_ref7;return Math.ceil(scrollTop)+clientHeight>=scrollHeight;};var scrollToY=(win,y)=>win.scrollTo(0,y==='bottom'?99999999:y);var getScrollingElement=(doc,html)=>{var body=doc.body;return Optional.from(!/^<!DOCTYPE (html|HTML)/.test(html)&&(!isChromium&&!isSafari||isNonNullable(body)&&(body.scrollTop!==0||Math.abs(body.scrollHeight-body.clientHeight)>1))?body:doc.documentElement);};var writeValue=(iframeElement,html,fallbackFn)=>{var iframe=iframeElement.dom;Optional.from(iframe.contentDocument).fold(fallbackFn,doc=>{var lastScrollTop=0;var isScrollAtBottom=getScrollingElement(doc,html).map(el=>{lastScrollTop=el.scrollTop;return el;}).forall(isElementScrollAtBottom);var scrollAfterWrite=()=>{var win=iframe.contentWindow;if(isNonNullable(win)){if(isScrollAtBottom){scrollToY(win,'bottom');}else if(!isScrollAtBottom&&isSafariOrFirefox&&lastScrollTop!==0){scrollToY(win,lastScrollTop);}}};if(isSafari){iframe.addEventListener('load',scrollAfterWrite,{once:true});}doc.open();doc.write(html);doc.close();if(!isSafari){scrollAfterWrite();}});};var throttleInterval=someIf(isSafariOrFirefox,isSafari?500:200);var writeValueThrottler=throttleInterval.map(interval=>adaptable(writeValue,interval));var getDynamicSource=(initialData,stream)=>{var cachedValue=Cell(initialData.getOr(''));return{getValue:_frameComponent=>cachedValue.get(),setValue:(frameComponent,html)=>{if(cachedValue.get()!==html){var iframeElement=frameComponent.element;var setSrcdocValue=()=>set$9(iframeElement,'srcdoc',html);if(stream){writeValueThrottler.fold(constant$1(writeValue),throttler=>throttler.throttle)(iframeElement,html,setSrcdocValue);}else{setSrcdocValue();}}cachedValue.set(html);}};};var renderIFrame=(spec,providersBackstage,initialData)=>{var baseClass='tox-dialog__iframe';var opaqueClass=spec.transparent?[]:[\"\".concat(baseClass,\"--opaque\")];var containerBorderedClass=spec.border?[\"tox-navobj-bordered\"]:[];var attributes=_objectSpread(_objectSpread(_objectSpread({},spec.label.map(title=>({title})).getOr({})),initialData.map(html=>({srcdoc:html})).getOr({})),spec.sandboxed?{sandbox:'allow-scripts allow-same-origin'}:{});var sourcing=getDynamicSource(initialData,spec.streamContent);var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var factory=newSpec=>craft(Optional.from(containerBorderedClass),{uid:newSpec.uid,dom:{tag:'iframe',attributes,classes:[baseClass,...opaqueClass]},behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),withComp(initialData,sourcing.getValue,sourcing.setValue),Receiving.config({channels:{[dialogFocusShiftedChannel]:{onReceive:(comp,message)=>{message.newFocus.each(newFocus=>{parentElement(comp.element).each(parent=>{var f=eq(comp.element,newFocus)?add$2:remove$2;f(parent,'tox-navobj-bordered-focus');});});}}}})])});var pField=FormField.parts.field({factory:{sketch:factory}});return renderFormFieldWith(pLabel,pField,['tox-form__group--stretched'],[]);};var image=image=>new Promise((resolve,reject)=>{var loaded=()=>{destroy();resolve(image);};var listeners=[bind(image,'load',loaded),bind(image,'error',()=>{destroy();reject('Unable to load data from image: '+image.dom.src);})];var destroy=()=>each$1(listeners,l=>l.unbind());if(image.dom.complete){loaded();}});var calculateImagePosition=(panelWidth,panelHeight,imageWidth,imageHeight,zoom)=>{var width=imageWidth*zoom;var height=imageHeight*zoom;var left=Math.max(0,panelWidth/2-width/2);var top=Math.max(0,panelHeight/2-height/2);return{left:left.toString()+'px',top:top.toString()+'px',width:width.toString()+'px',height:height.toString()+'px'};};var zoomToFit=(panel,width,height)=>{var panelW=get$c(panel);var panelH=get$d(panel);return Math.min(panelW/width,panelH/height,1);};var renderImagePreview=(spec,initialData)=>{var cachedData=Cell(initialData.getOr({url:''}));var memImage=record({dom:{tag:'img',classes:['tox-imagepreview__image'],attributes:initialData.map(data=>({src:data.url})).getOr({})}});var memContainer=record({dom:{tag:'div',classes:['tox-imagepreview__container'],attributes:{role:'presentation'}},components:[memImage.asSpec()]});var setValue=(frameComponent,data)=>{var translatedData={url:data.url};data.zoom.each(z=>translatedData.zoom=z);data.cachedWidth.each(z=>translatedData.cachedWidth=z);data.cachedHeight.each(z=>translatedData.cachedHeight=z);cachedData.set(translatedData);var applyFramePositioning=()=>{var{cachedWidth,cachedHeight,zoom}=translatedData;if(!isUndefined(cachedWidth)&&!isUndefined(cachedHeight)){if(isUndefined(zoom)){var z=zoomToFit(frameComponent.element,cachedWidth,cachedHeight);translatedData.zoom=z;}var _position=calculateImagePosition(get$c(frameComponent.element),get$d(frameComponent.element),cachedWidth,cachedHeight,translatedData.zoom);memContainer.getOpt(frameComponent).each(container=>{setAll(container.element,_position);});}};memImage.getOpt(frameComponent).each(imageComponent=>{var img=imageComponent.element;if(data.url!==get$f(img,'src')){set$9(img,'src',data.url);remove$2(frameComponent.element,'tox-imagepreview__loaded');}applyFramePositioning();image(img).then(img=>{if(frameComponent.getSystem().isConnected()){add$2(frameComponent.element,'tox-imagepreview__loaded');translatedData.cachedWidth=img.dom.naturalWidth;translatedData.cachedHeight=img.dom.naturalHeight;applyFramePositioning();}});});};var styles={};spec.height.each(h=>styles.height=h);var fakeValidatedData=initialData.map(d=>({url:d.url,zoom:Optional.from(d.zoom),cachedWidth:Optional.from(d.cachedWidth),cachedHeight:Optional.from(d.cachedHeight)}));return{dom:{tag:'div',classes:['tox-imagepreview'],styles,attributes:{role:'presentation'}},components:[memContainer.asSpec()],behaviours:derive$1([ComposingConfigs.self(),withComp(fakeValidatedData,()=>cachedData.get(),setValue)])};};var renderLabel$2=(spec,backstageShared)=>{var baseClass='tox-label';var centerClass=spec.align==='center'?[\"\".concat(baseClass,\"--center\")]:[];var endClass=spec.align==='end'?[\"\".concat(baseClass,\"--end\")]:[];var label={dom:{tag:'label',classes:[baseClass,...centerClass,...endClass]},components:[text$2(backstageShared.providers.translate(spec.label))]};var comps=map$2(spec.items,backstageShared.interpreter);return{dom:{tag:'div',classes:['tox-form__group']},components:[label,...comps],behaviours:derive$1([ComposingConfigs.self(),Replacing.config({}),domHtml(Optional.none()),Keying.config({mode:'acyclic'})])};};var internalToolbarButtonExecute=generate$6('toolbar.button.execute');var onToolbarButtonExecute=info=>runOnExecute$1((comp,_simulatedEvent)=>{runWithApi(info,comp)(itemApi=>{emitWith(comp,internalToolbarButtonExecute,{buttonApi:itemApi});info.onAction(itemApi);});});var commonButtonDisplayEvent=generate$6('common-button-display-events');var toolbarButtonEventOrder={[execute$5()]:['disabling','alloy.base.behaviour','toggling','toolbar-button-events'],[attachedToDom()]:['toolbar-button-events',commonButtonDisplayEvent],[mousedown()]:['focusing','alloy.base.behaviour',commonButtonDisplayEvent]};var forceInitialSize=comp=>set$8(comp.element,'width',get$e(comp.element,'width'));var renderIcon$1=(iconName,iconsProvider,behaviours)=>render$3(iconName,{tag:'span',classes:['tox-icon','tox-tbtn__icon-wrap'],behaviours},iconsProvider);var renderIconFromPack$1=(iconName,iconsProvider)=>renderIcon$1(iconName,iconsProvider,[]);var renderReplaceableIconFromPack=(iconName,iconsProvider)=>renderIcon$1(iconName,iconsProvider,[Replacing.config({})]);var renderLabel$1=(text,prefix,providersBackstage)=>({dom:{tag:'span',classes:[\"\".concat(prefix,\"__select-label\")]},components:[text$2(providersBackstage.translate(text))],behaviours:derive$1([Replacing.config({})])});var updateMenuText=generate$6('update-menu-text');var updateMenuIcon=generate$6('update-menu-icon');var renderCommonDropdown=(spec,prefix,sharedBackstage)=>{var editorOffCell=Cell(noop);var optMemDisplayText=spec.text.map(text=>record(renderLabel$1(text,prefix,sharedBackstage.providers)));var optMemDisplayIcon=spec.icon.map(iconName=>record(renderReplaceableIconFromPack(iconName,sharedBackstage.providers.icons)));var onLeftOrRightInMenu=(comp,se)=>{var dropdown=Representing.getValue(comp);Focusing.focus(dropdown);emitWith(dropdown,'keydown',{raw:se.event.raw});Dropdown.close(dropdown);return Optional.some(true);};var role=spec.role.fold(()=>({}),role=>({role}));var tooltipAttributes=spec.tooltip.fold(()=>({}),tooltip=>{var translatedTooltip=sharedBackstage.providers.translate(tooltip);return{'title':translatedTooltip,'aria-label':translatedTooltip};});var iconSpec=render$3('chevron-down',{tag:'div',classes:[\"\".concat(prefix,\"__select-chevron\")]},sharedBackstage.providers.icons);var fixWidthBehaviourName=generate$6('common-button-display-events');var memDropdown=record(Dropdown.sketch(_objectSpread(_objectSpread(_objectSpread({},spec.uid?{uid:spec.uid}:{}),role),{},{dom:{tag:'button',classes:[prefix,\"\".concat(prefix,\"--select\")].concat(map$2(spec.classes,c=>\"\".concat(prefix,\"--\").concat(c))),attributes:_objectSpread({},tooltipAttributes)},components:componentRenderPipeline([optMemDisplayIcon.map(mem=>mem.asSpec()),optMemDisplayText.map(mem=>mem.asSpec()),Optional.some(iconSpec)]),matchWidth:true,useMinWidth:true,onOpen:(anchor,dropdownComp,tmenuComp)=>{if(spec.searchable){focusSearchField(tmenuComp);}},dropdownBehaviours:derive$1([...spec.dropdownBehaviours,DisablingConfigs.button(()=>spec.disabled||sharedBackstage.providers.isDisabled()),receivingConfig(),Unselecting.config({}),Replacing.config({}),config('dropdown-events',[onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),config(fixWidthBehaviourName,[runOnAttached((comp,_se)=>forceInitialSize(comp))]),config('menubutton-update-display-text',[run$1(updateMenuText,(comp,se)=>{optMemDisplayText.bind(mem=>mem.getOpt(comp)).each(displayText=>{Replacing.set(displayText,[text$2(sharedBackstage.providers.translate(se.event.text))]);});}),run$1(updateMenuIcon,(comp,se)=>{optMemDisplayIcon.bind(mem=>mem.getOpt(comp)).each(displayIcon=>{Replacing.set(displayIcon,[renderReplaceableIconFromPack(se.event.icon,sharedBackstage.providers.icons)]);});})])]),eventOrder:deepMerge(toolbarButtonEventOrder,{mousedown:['focusing','alloy.base.behaviour','item-type-events','normal-dropdown-events'],[attachedToDom()]:['toolbar-button-events','dropdown-events',fixWidthBehaviourName]}),sandboxBehaviours:derive$1([Keying.config({mode:'special',onLeft:onLeftOrRightInMenu,onRight:onLeftOrRightInMenu}),config('dropdown-sandbox-events',[run$1(refetchTriggerEvent,(originalSandboxComp,se)=>{handleRefetchTrigger(originalSandboxComp);se.stop();}),run$1(redirectMenuItemInteractionEvent,(sandboxComp,se)=>{handleRedirectToMenuItem(sandboxComp,se);se.stop();})])]),lazySink:sharedBackstage.getSink,toggleClass:\"\".concat(prefix,\"--active\"),parts:{menu:_objectSpread(_objectSpread({},part(false,spec.columns,spec.presets)),{},{fakeFocus:spec.searchable,onHighlightItem:updateAriaOnHighlight,onCollapseMenu:(tmenuComp,itemCompCausingCollapse,nowActiveMenuComp)=>{Highlighting.getHighlighted(nowActiveMenuComp).each(itemComp=>{updateAriaOnHighlight(tmenuComp,nowActiveMenuComp,itemComp);});},onDehighlightItem:updateAriaOnDehighlight})},getAnchorOverrides:()=>{return{maxHeightFunction:(element,available)=>{anchored()(element,available-10);}};},fetch:comp=>Future.nu(curry(spec.fetch,comp))})));return memDropdown.asSpec();};var isMenuItemReference=item=>isString(item);var isSeparator$2=item=>item.type==='separator';var isExpandingMenuItem=item=>has$2(item,'getSubmenuItems');var separator$2={type:'separator'};var unwrapReferences=(items,menuItems)=>{var realItems=foldl(items,(acc,item)=>{if(isMenuItemReference(item)){if(item===''){return acc;}else if(item==='|'){return acc.length>0&&!isSeparator$2(acc[acc.length-1])?acc.concat([separator$2]):acc;}else if(has$2(menuItems,item.toLowerCase())){return acc.concat([menuItems[item.toLowerCase()]]);}else{return acc;}}else{return acc.concat([item]);}},[]);if(realItems.length>0&&isSeparator$2(realItems[realItems.length-1])){realItems.pop();}return realItems;};var getFromExpandingItem=(item,menuItems)=>{var submenuItems=item.getSubmenuItems();var rest=expand(submenuItems,menuItems);var newMenus=deepMerge(rest.menus,{[item.value]:rest.items});var newExpansions=deepMerge(rest.expansions,{[item.value]:item.value});return{item,menus:newMenus,expansions:newExpansions};};var generateValueIfRequired=item=>{var itemValue=get$g(item,'value').getOrThunk(()=>generate$6('generated-menu-item'));return deepMerge({value:itemValue},item);};var expand=(items,menuItems)=>{var realItems=unwrapReferences(isString(items)?items.split(' '):items,menuItems);return foldr(realItems,(acc,item)=>{if(isExpandingMenuItem(item)){var itemWithValue=generateValueIfRequired(item);var newData=getFromExpandingItem(itemWithValue,menuItems);return{menus:deepMerge(acc.menus,newData.menus),items:[newData.item,...acc.items],expansions:deepMerge(acc.expansions,newData.expansions)};}else{return _objectSpread(_objectSpread({},acc),{},{items:[item,...acc.items]});}},{menus:{},expansions:{},items:[]});};var getSearchModeForField=settings=>{return settings.search.fold(()=>({searchMode:'no-search'}),searchSettings=>({searchMode:'search-with-field',placeholder:searchSettings.placeholder}));};var getSearchModeForResults=settings=>{return settings.search.fold(()=>({searchMode:'no-search'}),_=>({searchMode:'search-with-results'}));};var build=(items,itemResponse,backstage,settings)=>{var primary=generate$6('primary-menu');var data=expand(items,backstage.shared.providers.menuItems());if(data.items.length===0){return Optional.none();}var mainMenuSearchMode=getSearchModeForField(settings);var mainMenu=createPartialMenu(primary,data.items,itemResponse,backstage,settings.isHorizontalMenu,mainMenuSearchMode);var submenuSearchMode=getSearchModeForResults(settings);var submenus=map$1(data.menus,(menuItems,menuName)=>createPartialMenu(menuName,menuItems,itemResponse,backstage,false,submenuSearchMode));var menus=deepMerge(submenus,wrap$1(primary,mainMenu));return Optional.from(tieredMenu.tieredData(primary,menus,data.expansions));};var isSingleListItem=item=>!has$2(item,'items');var dataAttribute='data-value';var fetchItems=(dropdownComp,name,items,selectedValue)=>map$2(items,item=>{if(!isSingleListItem(item)){return{type:'nestedmenuitem',text:item.text,getSubmenuItems:()=>fetchItems(dropdownComp,name,item.items,selectedValue)};}else{return{type:'togglemenuitem',text:item.text,value:item.value,active:item.value===selectedValue,onAction:()=>{Representing.setValue(dropdownComp,item.value);emitWith(dropdownComp,formChangeEvent,{name});Focusing.focus(dropdownComp);}};}});var findItemByValue=(items,value)=>findMap(items,item=>{if(!isSingleListItem(item)){return findItemByValue(item.items,value);}else{return someIf(item.value===value,item);}});var renderListBox=(spec,backstage,initialData)=>{var providersBackstage=backstage.shared.providers;var initialItem=initialData.bind(value=>findItemByValue(spec.items,value)).orThunk(()=>head(spec.items).filter(isSingleListItem));var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var pField=FormField.parts.field({dom:{},factory:{sketch:sketchSpec=>renderCommonDropdown({uid:sketchSpec.uid,text:initialItem.map(item=>item.text),icon:Optional.none(),tooltip:spec.label,role:Optional.none(),fetch:(comp,callback)=>{var items=fetchItems(comp,spec.name,spec.items,Representing.getValue(comp));callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,{isHorizontalMenu:false,search:Optional.none()}));},onSetup:constant$1(noop),getApi:constant$1({}),columns:1,presets:'normal',classes:[],dropdownBehaviours:[Tabstopping.config({}),withComp(initialItem.map(item=>item.value),comp=>get$f(comp.element,dataAttribute),(comp,data)=>{findItemByValue(spec.items,data).each(item=>{set$9(comp.element,dataAttribute,item.value);emitWith(comp,updateMenuText,{text:item.text});});})]},'tox-listbox',backstage.shared)}});var listBoxWrap={dom:{tag:'div',classes:['tox-listboxfield']},components:[pField]};return FormField.sketch({dom:{tag:'div',classes:['tox-form__group']},components:flatten([pLabel.toArray(),[listBoxWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:constant$1(!spec.enabled),onDisabled:comp=>{FormField.getField(comp).each(Disabling.disable);},onEnabled:comp=>{FormField.getField(comp).each(Disabling.enable);}})])});};var renderPanel=(spec,backstage)=>({dom:{tag:'div',classes:spec.classes},components:map$2(spec.items,backstage.shared.interpreter)});var factory$h=(detail,_spec)=>{var options=map$2(detail.options,option=>({dom:{tag:'option',value:option.value,innerHtml:option.text}}));var initialValues=detail.data.map(v=>wrap$1('initialValue',v)).getOr({});return{uid:detail.uid,dom:{tag:'select',classes:detail.selectClasses,attributes:detail.selectAttributes},components:options,behaviours:augment(detail.selectBehaviours,[Focusing.config({}),Representing.config({store:_objectSpread({mode:'manual',getValue:select=>{return get$6(select.element);},setValue:(select,newValue)=>{var firstOption=head(detail.options);var found=find$5(detail.options,opt=>opt.value===newValue);if(found.isSome()){set$5(select.element,newValue);}else if(select.element.dom.selectedIndex===-1&&newValue===''){firstOption.each(value=>set$5(select.element,value.value));}}},initialValues)})])};};var HtmlSelect=single({name:'HtmlSelect',configFields:[required$1('options'),field('selectBehaviours',[Focusing,Representing]),defaulted('selectClasses',[]),defaulted('selectAttributes',{}),option$3('data')],factory:factory$h});var renderSelectBox=(spec,providersBackstage,initialData)=>{var translatedOptions=map$2(spec.items,item=>({text:providersBackstage.translate(item.text),value:item.value}));var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var pField=FormField.parts.field(_objectSpread(_objectSpread({dom:{}},initialData.map(data=>({data})).getOr({})),{},{selectAttributes:{size:spec.size},options:translatedOptions,factory:HtmlSelect,selectBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled()}),Tabstopping.config({}),config('selectbox-change',[run$1(change(),(component,_)=>{emitWith(component,formChangeEvent,{name:spec.name});})])])}));var chevron=spec.size>1?Optional.none():Optional.some(render$3('chevron-down',{tag:'div',classes:['tox-selectfield__icon-js']},providersBackstage.icons));var selectWrap={dom:{tag:'div',classes:['tox-selectfield']},components:flatten([[pField],chevron.toArray()])};return FormField.sketch({dom:{tag:'div',classes:['tox-form__group']},components:flatten([pLabel.toArray(),[selectWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled(),onDisabled:comp=>{FormField.getField(comp).each(Disabling.disable);},onEnabled:comp=>{FormField.getField(comp).each(Disabling.enable);}}),receivingConfig()])});};var schema$h=constant$1([defaulted('field1Name','field1'),defaulted('field2Name','field2'),onStrictHandler('onLockedChange'),markers$1(['lockClass']),defaulted('locked',false),SketchBehaviours.field('coupledFieldBehaviours',[Composing,Representing])]);var getField=(comp,detail,partName)=>getPart(comp,detail,partName).bind(Composing.getCurrent);var coupledPart=(selfName,otherName)=>required({factory:FormField,name:selfName,overrides:detail=>{return{fieldBehaviours:derive$1([config('coupled-input-behaviour',[run$1(input(),me=>{getField(me,detail,otherName).each(other=>{getPart(me,detail,'lock').each(lock=>{if(Toggling.isOn(lock)){detail.onLockedChange(me,other,lock);}});});})])])};}});var parts$c=constant$1([coupledPart('field1','field2'),coupledPart('field2','field1'),required({factory:Button,schema:[required$1('dom')],name:'lock',overrides:detail=>{return{buttonBehaviours:derive$1([Toggling.config({selected:detail.locked,toggleClass:detail.markers.lockClass,aria:{mode:'pressed'}})])};}})]);var factory$g=(detail,components,_spec,_externals)=>({uid:detail.uid,dom:detail.dom,components,behaviours:SketchBehaviours.augment(detail.coupledFieldBehaviours,[Composing.config({find:Optional.some}),Representing.config({store:{mode:'manual',getValue:comp=>{var parts=getPartsOrDie(comp,detail,['field1','field2']);return{[detail.field1Name]:Representing.getValue(parts.field1()),[detail.field2Name]:Representing.getValue(parts.field2())};},setValue:(comp,value)=>{var parts=getPartsOrDie(comp,detail,['field1','field2']);if(hasNonNullableKey(value,detail.field1Name)){Representing.setValue(parts.field1(),value[detail.field1Name]);}if(hasNonNullableKey(value,detail.field2Name)){Representing.setValue(parts.field2(),value[detail.field2Name]);}}}})]),apis:{getField1:component=>getPart(component,detail,'field1'),getField2:component=>getPart(component,detail,'field2'),getLock:component=>getPart(component,detail,'lock')}});var FormCoupledInputs=composite({name:'FormCoupledInputs',configFields:schema$h(),partFields:parts$c(),factory:factory$g,apis:{getField1:(apis,component)=>apis.getField1(component),getField2:(apis,component)=>apis.getField2(component),getLock:(apis,component)=>apis.getLock(component)}});var formatSize=size=>{var unitDec={'':0,'px':0,'pt':1,'mm':1,'pc':2,'ex':2,'em':2,'ch':2,'rem':2,'cm':3,'in':4,'%':4};var maxDecimal=unit=>unit in unitDec?unitDec[unit]:1;var numText=size.value.toFixed(maxDecimal(size.unit));if(numText.indexOf('.')!==-1){numText=numText.replace(/\\.?0*$/,'');}return numText+size.unit;};var parseSize=sizeText=>{var numPattern=/^\\s*(\\d+(?:\\.\\d+)?)\\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\\s*$/;var match=numPattern.exec(sizeText);if(match!==null){var _value3=parseFloat(match[1]);var unit=match[2];return Result.value({value:_value3,unit});}else{return Result.error(sizeText);}};var convertUnit=(size,unit)=>{var inInch={'':96,'px':96,'pt':72,'cm':2.54,'pc':12,'mm':25.4,'in':1};var supported=u=>has$2(inInch,u);if(size.unit===unit){return Optional.some(size.value);}else if(supported(size.unit)&&supported(unit)){if(inInch[size.unit]===inInch[unit]){return Optional.some(size.value);}else{return Optional.some(size.value/inInch[size.unit]*inInch[unit]);}}else{return Optional.none();}};var noSizeConversion=_input=>Optional.none();var ratioSizeConversion=(scale,unit)=>size=>convertUnit(size,unit).map(value=>({value:value*scale,unit}));var makeRatioConverter=(currentFieldText,otherFieldText)=>{var cValue=parseSize(currentFieldText).toOptional();var oValue=parseSize(otherFieldText).toOptional();return lift2(cValue,oValue,(cSize,oSize)=>convertUnit(cSize,oSize.unit).map(val=>oSize.value/val).map(r=>ratioSizeConversion(r,oSize.unit)).getOr(noSizeConversion)).getOr(noSizeConversion);};var renderSizeInput=(spec,providersBackstage)=>{var converter=noSizeConversion;var ratioEvent=generate$6('ratio-event');var makeIcon=iconName=>render$3(iconName,{tag:'span',classes:['tox-icon','tox-lock-icon__'+iconName]},providersBackstage.icons);var pLock=FormCoupledInputs.parts.lock({dom:{tag:'button',classes:['tox-lock','tox-button','tox-button--naked','tox-button--icon'],attributes:{title:providersBackstage.translate(spec.label.getOr('Constrain proportions'))}},components:[makeIcon('lock'),makeIcon('unlock')],buttonBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled()}),receivingConfig(),Tabstopping.config({})])});var formGroup=components=>({dom:{tag:'div',classes:['tox-form__group']},components});var getFieldPart=isField1=>FormField.parts.field({factory:Input,inputClasses:['tox-textfield'],inputBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled()}),receivingConfig(),Tabstopping.config({}),config('size-input-events',[run$1(focusin(),(component,_simulatedEvent)=>{emitWith(component,ratioEvent,{isField1});}),run$1(change(),(component,_simulatedEvent)=>{emitWith(component,formChangeEvent,{name:spec.name});})])]),selectOnFocus:false});var getLabel=label=>({dom:{tag:'label',classes:['tox-label']},components:[text$2(providersBackstage.translate(label))]});var widthField=FormCoupledInputs.parts.field1(formGroup([FormField.parts.label(getLabel('Width')),getFieldPart(true)]));var heightField=FormCoupledInputs.parts.field2(formGroup([FormField.parts.label(getLabel('Height')),getFieldPart(false)]));return FormCoupledInputs.sketch({dom:{tag:'div',classes:['tox-form__group']},components:[{dom:{tag:'div',classes:['tox-form__controls-h-stack']},components:[widthField,heightField,formGroup([getLabel(nbsp),pLock])]}],field1Name:'width',field2Name:'height',locked:true,markers:{lockClass:'tox-locked'},onLockedChange:(current,other,_lock)=>{parseSize(Representing.getValue(current)).each(size=>{converter(size).each(newSize=>{Representing.setValue(other,formatSize(newSize));});});},coupledFieldBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled(),onDisabled:comp=>{FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.disable);FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.disable);FormCoupledInputs.getLock(comp).each(Disabling.disable);},onEnabled:comp=>{FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.enable);FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.enable);FormCoupledInputs.getLock(comp).each(Disabling.enable);}}),receivingConfig(),config('size-input-events2',[run$1(ratioEvent,(component,simulatedEvent)=>{var isField1=simulatedEvent.event.isField1;var optCurrent=isField1?FormCoupledInputs.getField1(component):FormCoupledInputs.getField2(component);var optOther=isField1?FormCoupledInputs.getField2(component):FormCoupledInputs.getField1(component);var value1=optCurrent.map(Representing.getValue).getOr('');var value2=optOther.map(Representing.getValue).getOr('');converter=makeRatioConverter(value1,value2);})])])});};var renderSlider=(spec,providerBackstage,initialData)=>{var labelPart=Slider.parts.label({dom:{tag:'label',classes:['tox-label']},components:[text$2(providerBackstage.translate(spec.label))]});var spectrum=Slider.parts.spectrum({dom:{tag:'div',classes:['tox-slider__rail'],attributes:{role:'presentation'}}});var thumb=Slider.parts.thumb({dom:{tag:'div',classes:['tox-slider__handle'],attributes:{role:'presentation'}}});return Slider.sketch({dom:{tag:'div',classes:['tox-slider'],attributes:{role:'presentation'}},model:{mode:'x',minX:spec.min,maxX:spec.max,getInitialValue:constant$1(initialData.getOrThunk(()=>(Math.abs(spec.max)-Math.abs(spec.min))/2))},components:[labelPart,spectrum,thumb],sliderBehaviours:derive$1([ComposingConfigs.self(),Focusing.config({})]),onChoose:(component,thumb,value)=>{emitWith(component,formChangeEvent,{name:spec.name,value});}});};var renderTable=(spec,providersBackstage)=>{var renderTh=text=>({dom:{tag:'th',innerHtml:providersBackstage.translate(text)}});var renderHeader=header=>({dom:{tag:'thead'},components:[{dom:{tag:'tr'},components:map$2(header,renderTh)}]});var renderTd=text=>({dom:{tag:'td',innerHtml:providersBackstage.translate(text)}});var renderTr=row=>({dom:{tag:'tr'},components:map$2(row,renderTd)});var renderRows=rows=>({dom:{tag:'tbody'},components:map$2(rows,renderTr)});return{dom:{tag:'table',classes:['tox-dialog__table']},components:[renderHeader(spec.header),renderRows(spec.cells)],behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])};};var renderTextField=(spec,providersBackstage)=>{var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var baseInputBehaviours=[Disabling.config({disabled:()=>spec.disabled||providersBackstage.isDisabled()}),receivingConfig(),Keying.config({mode:'execution',useEnter:spec.multiline!==true,useControlEnter:spec.multiline===true,execute:comp=>{emit(comp,formSubmitEvent);return Optional.some(true);}}),config('textfield-change',[run$1(input(),(component,_)=>{emitWith(component,formChangeEvent,{name:spec.name});}),run$1(postPaste(),(component,_)=>{emitWith(component,formChangeEvent,{name:spec.name});})]),Tabstopping.config({})];var validatingBehaviours=spec.validation.map(vl=>Invalidating.config({getRoot:input=>{return parentElement(input.element);},invalidClass:'tox-invalid',validator:{validate:input=>{var v=Representing.getValue(input);var result=vl.validator(v);return Future.pure(result===true?Result.value(v):Result.error(result));},validateOnLoad:vl.validateOnLoad}})).toArray();var placeholder=spec.placeholder.fold(constant$1({}),p=>({placeholder:providersBackstage.translate(p)}));var inputMode=spec.inputMode.fold(constant$1({}),mode=>({inputmode:mode}));var inputAttributes=_objectSpread(_objectSpread({},placeholder),inputMode);var pField=FormField.parts.field(_objectSpread(_objectSpread({tag:spec.multiline===true?'textarea':'input'},spec.data.map(data=>({data})).getOr({})),{},{inputAttributes,inputClasses:[spec.classname],inputBehaviours:derive$1(flatten([baseInputBehaviours,validatingBehaviours])),selectOnFocus:false,factory:Input}));var pTextField=spec.multiline?{dom:{tag:'div',classes:['tox-textarea-wrap']},components:[pField]}:pField;var extraClasses=spec.flex?['tox-form__group--stretched']:[];var extraClasses2=extraClasses.concat(spec.maximized?['tox-form-group--maximize']:[]);var extraBehaviours=[Disabling.config({disabled:()=>spec.disabled||providersBackstage.isDisabled(),onDisabled:comp=>{FormField.getField(comp).each(Disabling.disable);},onEnabled:comp=>{FormField.getField(comp).each(Disabling.enable);}}),receivingConfig()];return renderFormFieldWith(pLabel,pTextField,extraClasses2,extraBehaviours);};var renderInput=(spec,providersBackstage,initialData)=>renderTextField({name:spec.name,multiline:false,label:spec.label,inputMode:spec.inputMode,placeholder:spec.placeholder,flex:false,disabled:!spec.enabled,classname:'tox-textfield',validation:Optional.none(),maximized:spec.maximized,data:initialData},providersBackstage);var renderTextarea=(spec,providersBackstage,initialData)=>renderTextField({name:spec.name,multiline:true,label:spec.label,inputMode:Optional.none(),placeholder:spec.placeholder,flex:true,disabled:!spec.enabled,classname:'tox-textarea',validation:Optional.none(),maximized:spec.maximized,data:initialData},providersBackstage);var getAnimationRoot=(component,slideConfig)=>slideConfig.getAnimationRoot.fold(()=>component.element,get=>get(component));var getDimensionProperty=slideConfig=>slideConfig.dimension.property;var getDimension=(slideConfig,elem)=>slideConfig.dimension.getDimension(elem);var disableTransitions=(component,slideConfig)=>{var root=getAnimationRoot(component,slideConfig);remove$1(root,[slideConfig.shrinkingClass,slideConfig.growingClass]);};var setShrunk=(component,slideConfig)=>{remove$2(component.element,slideConfig.openClass);add$2(component.element,slideConfig.closedClass);set$8(component.element,getDimensionProperty(slideConfig),'0px');reflow(component.element);};var setGrown=(component,slideConfig)=>{remove$2(component.element,slideConfig.closedClass);add$2(component.element,slideConfig.openClass);remove$6(component.element,getDimensionProperty(slideConfig));};var doImmediateShrink=(component,slideConfig,slideState,_calculatedSize)=>{slideState.setCollapsed();set$8(component.element,getDimensionProperty(slideConfig),getDimension(slideConfig,component.element));disableTransitions(component,slideConfig);setShrunk(component,slideConfig);slideConfig.onStartShrink(component);slideConfig.onShrunk(component);};var doStartShrink=(component,slideConfig,slideState,calculatedSize)=>{var size=calculatedSize.getOrThunk(()=>getDimension(slideConfig,component.element));slideState.setCollapsed();set$8(component.element,getDimensionProperty(slideConfig),size);reflow(component.element);var root=getAnimationRoot(component,slideConfig);remove$2(root,slideConfig.growingClass);add$2(root,slideConfig.shrinkingClass);setShrunk(component,slideConfig);slideConfig.onStartShrink(component);};var doStartSmartShrink=(component,slideConfig,slideState)=>{var size=getDimension(slideConfig,component.element);var shrinker=size==='0px'?doImmediateShrink:doStartShrink;shrinker(component,slideConfig,slideState,Optional.some(size));};var doStartGrow=(component,slideConfig,slideState)=>{var root=getAnimationRoot(component,slideConfig);var wasShrinking=has(root,slideConfig.shrinkingClass);var beforeSize=getDimension(slideConfig,component.element);setGrown(component,slideConfig);var fullSize=getDimension(slideConfig,component.element);var startPartialGrow=()=>{set$8(component.element,getDimensionProperty(slideConfig),beforeSize);reflow(component.element);};var startCompleteGrow=()=>{setShrunk(component,slideConfig);};var setStartSize=wasShrinking?startPartialGrow:startCompleteGrow;setStartSize();remove$2(root,slideConfig.shrinkingClass);add$2(root,slideConfig.growingClass);setGrown(component,slideConfig);set$8(component.element,getDimensionProperty(slideConfig),fullSize);slideState.setExpanded();slideConfig.onStartGrow(component);};var refresh$4=(component,slideConfig,slideState)=>{if(slideState.isExpanded()){remove$6(component.element,getDimensionProperty(slideConfig));var fullSize=getDimension(slideConfig,component.element);set$8(component.element,getDimensionProperty(slideConfig),fullSize);}};var grow=(component,slideConfig,slideState)=>{if(!slideState.isExpanded()){doStartGrow(component,slideConfig,slideState);}};var shrink=(component,slideConfig,slideState)=>{if(slideState.isExpanded()){doStartSmartShrink(component,slideConfig,slideState);}};var immediateShrink=(component,slideConfig,slideState)=>{if(slideState.isExpanded()){doImmediateShrink(component,slideConfig,slideState);}};var hasGrown=(component,slideConfig,slideState)=>slideState.isExpanded();var hasShrunk=(component,slideConfig,slideState)=>slideState.isCollapsed();var isGrowing=(component,slideConfig,_slideState)=>{var root=getAnimationRoot(component,slideConfig);return has(root,slideConfig.growingClass)===true;};var isShrinking=(component,slideConfig,_slideState)=>{var root=getAnimationRoot(component,slideConfig);return has(root,slideConfig.shrinkingClass)===true;};var isTransitioning=(component,slideConfig,slideState)=>isGrowing(component,slideConfig)||isShrinking(component,slideConfig);var toggleGrow=(component,slideConfig,slideState)=>{var f=slideState.isExpanded()?doStartSmartShrink:doStartGrow;f(component,slideConfig,slideState);};var immediateGrow=(component,slideConfig,slideState)=>{if(!slideState.isExpanded()){setGrown(component,slideConfig);set$8(component.element,getDimensionProperty(slideConfig),getDimension(slideConfig,component.element));disableTransitions(component,slideConfig);slideState.setExpanded();slideConfig.onStartGrow(component);slideConfig.onGrown(component);}};var SlidingApis=/*#__PURE__*/Object.freeze({__proto__:null,refresh:refresh$4,grow:grow,shrink:shrink,immediateShrink:immediateShrink,hasGrown:hasGrown,hasShrunk:hasShrunk,isGrowing:isGrowing,isShrinking:isShrinking,isTransitioning:isTransitioning,toggleGrow:toggleGrow,disableTransitions:disableTransitions,immediateGrow:immediateGrow});var exhibit=(base,slideConfig,_slideState)=>{var expanded=slideConfig.expanded;return expanded?nu$7({classes:[slideConfig.openClass],styles:{}}):nu$7({classes:[slideConfig.closedClass],styles:wrap$1(slideConfig.dimension.property,'0px')});};var events$6=(slideConfig,slideState)=>derive$2([runOnSource(transitionend(),(component,simulatedEvent)=>{var raw=simulatedEvent.event.raw;if(raw.propertyName===slideConfig.dimension.property){disableTransitions(component,slideConfig);if(slideState.isExpanded()){remove$6(component.element,slideConfig.dimension.property);}var notify=slideState.isExpanded()?slideConfig.onGrown:slideConfig.onShrunk;notify(component);}})]);var ActiveSliding=/*#__PURE__*/Object.freeze({__proto__:null,exhibit:exhibit,events:events$6});var SlidingSchema=[required$1('closedClass'),required$1('openClass'),required$1('shrinkingClass'),required$1('growingClass'),option$3('getAnimationRoot'),onHandler('onShrunk'),onHandler('onStartShrink'),onHandler('onGrown'),onHandler('onStartGrow'),defaulted('expanded',false),requiredOf('dimension',choose$1('property',{width:[output$1('property','width'),output$1('getDimension',elem=>get$c(elem)+'px')],height:[output$1('property','height'),output$1('getDimension',elem=>get$d(elem)+'px')]}))];var init$9=spec=>{var state=Cell(spec.expanded);var readState=()=>'expanded: '+state.get();return nu$8({isExpanded:()=>state.get()===true,isCollapsed:()=>state.get()===false,setCollapsed:curry(state.set,false),setExpanded:curry(state.set,true),readState});};var SlidingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$9});var Sliding=create$4({fields:SlidingSchema,name:'sliding',active:ActiveSliding,apis:SlidingApis,state:SlidingState});var getMenuButtonApi=component=>({isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state),setActive:state=>{var elm=component.element;if(state){add$2(elm,'tox-tbtn--enabled');set$9(elm,'aria-pressed',true);}else{remove$2(elm,'tox-tbtn--enabled');remove$7(elm,'aria-pressed');}},isActive:()=>has(component.element,'tox-tbtn--enabled'),setText:text=>{emitWith(component,updateMenuText,{text});},setIcon:icon=>emitWith(component,updateMenuIcon,{icon})});var renderMenuButton=function renderMenuButton(spec,prefix,backstage,role){var tabstopping=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;return renderCommonDropdown({text:spec.text,icon:spec.icon,tooltip:spec.tooltip,searchable:spec.search.isSome(),role,fetch:(dropdownComp,callback)=>{var fetchContext={pattern:spec.search.isSome()?getSearchPattern(dropdownComp):''};spec.fetch(items=>{callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,{isHorizontalMenu:false,search:spec.search}));},fetchContext,getMenuButtonApi(dropdownComp));},onSetup:spec.onSetup,getApi:getMenuButtonApi,columns:1,presets:'normal',classes:[],dropdownBehaviours:[...(tabstopping?[Tabstopping.config({})]:[])]},prefix,backstage.shared);};var getFetch=(items,getButton,backstage)=>{var getMenuItemAction=item=>api=>{var newValue=!api.isActive();api.setActive(newValue);item.storage.set(newValue);backstage.shared.getSink().each(sink=>{getButton().getOpt(sink).each(orig=>{focus$3(orig.element);emitWith(orig,formActionEvent,{name:item.name,value:item.storage.get()});});});};var getMenuItemSetup=item=>api=>{api.setActive(item.storage.get());};return success=>{success(map$2(items,item=>{var text=item.text.fold(()=>({}),text=>({text}));return _objectSpread(_objectSpread({type:item.type,active:false},text),{},{onAction:getMenuItemAction(item),onSetup:getMenuItemSetup(item)});}));};};var renderLabel=text=>({dom:{tag:'span',classes:['tox-tree__label'],attributes:{'title':text,'aria-label':text}},components:[text$2(text)]});var leafLabelEventsId=generate$6('leaf-label-event-id');var renderLeafLabel=_ref8=>{var{leaf,onLeafAction,visible,treeId,selectedId,backstage}=_ref8;var internalMenuButton=leaf.menu.map(btn=>renderMenuButton(btn,'tox-mbtn',backstage,Optional.none(),visible));var components=[renderLabel(leaf.title)];internalMenuButton.each(btn=>components.push(btn));return Button.sketch({dom:{tag:'div',classes:['tox-tree--leaf__label','tox-trbtn'].concat(visible?['tox-tree--leaf__label--visible']:[])},components,role:'treeitem',action:button=>{onLeafAction(leaf.id);button.getSystem().broadcastOn([\"update-active-item-\".concat(treeId)],{value:leaf.id});},eventOrder:{[keydown()]:[leafLabelEventsId,'keying']},buttonBehaviours:derive$1([...(visible?[Tabstopping.config({})]:[]),Toggling.config({toggleClass:'tox-trbtn--enabled',toggleOnExecute:false,aria:{mode:'selected'}}),Receiving.config({channels:{[\"update-active-item-\".concat(treeId)]:{onReceive:(comp,message)=>{(message.value===leaf.id?Toggling.on:Toggling.off)(comp);}}}}),config(leafLabelEventsId,[runOnAttached((comp,_se)=>{selectedId.each(id=>{var toggle=id===leaf.id?Toggling.on:Toggling.off;toggle(comp);});}),run$1(keydown(),(comp,se)=>{var isLeftArrowKey=se.event.raw.code==='ArrowLeft';var isRightArrowKey=se.event.raw.code==='ArrowRight';if(isLeftArrowKey){ancestor(comp.element,'.tox-tree--directory').each(dirElement=>{comp.getSystem().getByDom(dirElement).each(dirComp=>{child(dirElement,'.tox-tree--directory__label').each(dirLabelElement=>{dirComp.getSystem().getByDom(dirLabelElement).each(Focusing.focus);});});});se.stop();}else if(isRightArrowKey){se.stop();}})])])});};var renderIcon=(iconName,iconsProvider,behaviours)=>render$3(iconName,{tag:'span',classes:['tox-tree__icon-wrap','tox-icon'],behaviours},iconsProvider);var renderIconFromPack=(iconName,iconsProvider)=>renderIcon(iconName,iconsProvider,[]);var directoryLabelEventsId=generate$6('directory-label-event-id');var renderDirectoryLabel=_ref9=>{var{directory,visible,noChildren,backstage}=_ref9;var internalMenuButton=directory.menu.map(btn=>renderMenuButton(btn,'tox-mbtn',backstage,Optional.none()));var components=[{dom:{tag:'div',classes:['tox-chevron']},components:[renderIconFromPack('chevron-right',backstage.shared.providers.icons)]},renderLabel(directory.title)];internalMenuButton.each(btn=>{components.push(btn);});var toggleExpandChildren=button=>{ancestor(button.element,'.tox-tree--directory').each(directoryEle=>{button.getSystem().getByDom(directoryEle).each(directoryComp=>{var willExpand=!Toggling.isOn(directoryComp);Toggling.toggle(directoryComp);emitWith(button,'expand-tree-node',{expanded:willExpand,node:directory.id});});});};return Button.sketch({dom:{tag:'div',classes:['tox-tree--directory__label','tox-trbtn'].concat(visible?['tox-tree--directory__label--visible']:[])},components,action:toggleExpandChildren,eventOrder:{[keydown()]:[directoryLabelEventsId,'keying']},buttonBehaviours:derive$1([...(visible?[Tabstopping.config({})]:[]),config(directoryLabelEventsId,[run$1(keydown(),(comp,se)=>{var isRightArrowKey=se.event.raw.code==='ArrowRight';var isLeftArrowKey=se.event.raw.code==='ArrowLeft';if(isRightArrowKey&&noChildren){se.stop();}if(isRightArrowKey||isLeftArrowKey){ancestor(comp.element,'.tox-tree--directory').each(directoryEle=>{comp.getSystem().getByDom(directoryEle).each(directoryComp=>{if(!Toggling.isOn(directoryComp)&&isRightArrowKey||Toggling.isOn(directoryComp)&&isLeftArrowKey){toggleExpandChildren(comp);se.stop();}else if(isLeftArrowKey&&!Toggling.isOn(directoryComp)){ancestor(directoryComp.element,'.tox-tree--directory').each(parentDirElement=>{child(parentDirElement,'.tox-tree--directory__label').each(parentDirLabelElement=>{directoryComp.getSystem().getByDom(parentDirLabelElement).each(Focusing.focus);});});se.stop();}});});}})])])});};var renderDirectoryChildren=_ref10=>{var{children,onLeafAction,visible,treeId,expandedIds,selectedId,backstage}=_ref10;return{dom:{tag:'div',classes:['tox-tree--directory__children']},components:children.map(item=>{return item.type==='leaf'?renderLeafLabel({leaf:item,selectedId,onLeafAction,visible,treeId,backstage}):renderDirectory({directory:item,expandedIds,selectedId,onLeafAction,labelTabstopping:visible,treeId,backstage});}),behaviours:derive$1([Sliding.config({dimension:{property:'height'},closedClass:'tox-tree--directory__children--closed',openClass:'tox-tree--directory__children--open',growingClass:'tox-tree--directory__children--growing',shrinkingClass:'tox-tree--directory__children--shrinking',expanded:visible}),Replacing.config({})])};};var directoryEventsId=generate$6('directory-event-id');var renderDirectory=_ref11=>{var{directory,onLeafAction,labelTabstopping,treeId,backstage,expandedIds,selectedId}=_ref11;var{children}=directory;var expandedIdsCell=Cell(expandedIds);var computedChildrenComponents=visible=>children.map(item=>{return item.type==='leaf'?renderLeafLabel({leaf:item,selectedId,onLeafAction,visible,treeId,backstage}):renderDirectory({directory:item,expandedIds:expandedIdsCell.get(),selectedId,onLeafAction,labelTabstopping:visible,treeId,backstage});});var childrenVisible=expandedIds.includes(directory.id);return{dom:{tag:'div',classes:['tox-tree--directory'],attributes:{role:'treeitem'}},components:[renderDirectoryLabel({directory,visible:labelTabstopping,noChildren:directory.children.length===0,backstage}),renderDirectoryChildren({children,expandedIds,selectedId,onLeafAction,visible:childrenVisible,treeId,backstage})],behaviours:derive$1([config(directoryEventsId,[runOnAttached((comp,_se)=>{Toggling.set(comp,childrenVisible);}),run$1('expand-tree-node',(_cmp,se)=>{var{expanded,node}=se.event;expandedIdsCell.set(expanded?[...expandedIdsCell.get(),node]:expandedIdsCell.get().filter(id=>id!==node));})]),Toggling.config(_objectSpread(_objectSpread({},directory.children.length>0?{aria:{mode:'expanded'}}:{}),{},{toggleClass:'tox-tree--directory--expanded',onToggled:(comp,childrenVisible)=>{var childrenComp=comp.components()[1];var newChildren=computedChildrenComponents(childrenVisible);if(childrenVisible){Sliding.grow(childrenComp);}else{Sliding.shrink(childrenComp);}Replacing.set(childrenComp,newChildren);}}))])};};var treeEventsId=generate$6('tree-event-id');var renderTree=(spec,backstage)=>{var onLeafAction=spec.onLeafAction.getOr(noop);var onToggleExpand=spec.onToggleExpand.getOr(noop);var defaultExpandedIds=spec.defaultExpandedIds;var expandedIds=Cell(defaultExpandedIds);var selectedIdCell=Cell(spec.defaultSelectedId);var treeId=generate$6('tree-id');var children=(selectedId,expandedIds)=>spec.items.map(item=>{return item.type==='leaf'?renderLeafLabel({leaf:item,selectedId,onLeafAction,visible:true,treeId,backstage}):renderDirectory({directory:item,selectedId,onLeafAction,expandedIds,labelTabstopping:true,treeId,backstage});});return{dom:{tag:'div',classes:['tox-tree'],attributes:{role:'tree'}},components:children(selectedIdCell.get(),expandedIds.get()),behaviours:derive$1([Keying.config({mode:'flow',selector:'.tox-tree--leaf__label--visible, .tox-tree--directory__label--visible',cycles:false}),config(treeEventsId,[run$1('expand-tree-node',(_cmp,se)=>{var{expanded,node}=se.event;expandedIds.set(expanded?[...expandedIds.get(),node]:expandedIds.get().filter(id=>id!==node));onToggleExpand(expandedIds.get(),{expanded,node});})]),Receiving.config({channels:{[\"update-active-item-\".concat(treeId)]:{onReceive:(comp,message)=>{selectedIdCell.set(Optional.some(message.value));Replacing.set(comp,children(Optional.some(message.value),expandedIds.get()));}}}}),Replacing.config({})])};};var events$5=(streamConfig,streamState)=>{var streams=streamConfig.stream.streams;var processor=streams.setup(streamConfig,streamState);return derive$2([run$1(streamConfig.event,processor),runOnDetached(()=>streamState.cancel())].concat(streamConfig.cancelEvent.map(e=>[run$1(e,()=>streamState.cancel())]).getOr([])));};var ActiveStreaming=/*#__PURE__*/Object.freeze({__proto__:null,events:events$5});var throttle=_config=>{var state=Cell(null);var readState=()=>({timer:state.get()!==null?'set':'unset'});var setTimer=t=>{state.set(t);};var cancel=()=>{var t=state.get();if(t!==null){t.cancel();}};return nu$8({readState,setTimer,cancel});};var init$8=spec=>spec.stream.streams.state(spec);var StreamingState=/*#__PURE__*/Object.freeze({__proto__:null,throttle:throttle,init:init$8});var setup$c=(streamInfo,streamState)=>{var sInfo=streamInfo.stream;var throttler=last(streamInfo.onStream,sInfo.delay);streamState.setTimer(throttler);return(component,simulatedEvent)=>{throttler.throttle(component,simulatedEvent);if(sInfo.stopEvent){simulatedEvent.stop();}};};var StreamingSchema=[requiredOf('stream',choose$1('mode',{throttle:[required$1('delay'),defaulted('stopEvent',true),output$1('streams',{setup:setup$c,state:throttle})]})),defaulted('event','input'),option$3('cancelEvent'),onStrictHandler('onStream')];var Streaming=create$4({fields:StreamingSchema,name:'streaming',active:ActiveStreaming,state:StreamingState});var setValueFromItem=(model,input,item)=>{var itemData=Representing.getValue(item);Representing.setValue(input,itemData);setCursorAtEnd(input);};var setSelectionOn=(input,f)=>{var el=input.element;var value=get$6(el);var node=el.dom;if(get$f(el,'type')!=='number'){f(node,value);}};var setCursorAtEnd=input=>{setSelectionOn(input,(node,value)=>node.setSelectionRange(value.length,value.length));};var setSelectionToEnd=(input,startOffset)=>{setSelectionOn(input,(node,value)=>node.setSelectionRange(startOffset,value.length));};var attemptSelectOver=(model,input,item)=>{if(!model.selectsOver){return Optional.none();}else{var _currentValue=Representing.getValue(input);var inputDisplay=model.getDisplayText(_currentValue);var itemValue=Representing.getValue(item);var itemDisplay=model.getDisplayText(itemValue);return itemDisplay.indexOf(inputDisplay)===0?Optional.some(()=>{setValueFromItem(model,input,item);setSelectionToEnd(input,inputDisplay.length);}):Optional.none();}};var itemExecute=constant$1('alloy.typeahead.itemexecute');var make$3=(detail,components,spec,externals)=>{var navigateList=(comp,simulatedEvent,highlighter)=>{detail.previewing.set(false);var sandbox=Coupling.getCoupled(comp,'sandbox');if(Sandboxing.isOpen(sandbox)){Composing.getCurrent(sandbox).each(menu=>{Highlighting.getHighlighted(menu).fold(()=>{highlighter(menu);},()=>{dispatchEvent(sandbox,menu.element,'keydown',simulatedEvent);});});}else{var onOpenSync=sandbox=>{Composing.getCurrent(sandbox).each(highlighter);};open(detail,mapFetch(comp),comp,sandbox,externals,onOpenSync,HighlightOnOpen.HighlightMenuAndItem).get(noop);}};var focusBehaviours$1=focusBehaviours(detail);var mapFetch=comp=>tdata=>tdata.map(data=>{var menus=values(data.menus);var items=bind$3(menus,menu=>filter$2(menu.items,item=>item.type==='item'));var repState=Representing.getState(comp);repState.update(map$2(items,item=>item.data));return data;});var getActiveMenu=sandboxComp=>Composing.getCurrent(sandboxComp);var typeaheadCustomEvents='typeaheadevents';var behaviours=[Focusing.config({}),Representing.config({onSetValue:detail.onSetValue,store:_objectSpread({mode:'dataset',getDataKey:comp=>get$6(comp.element),getFallbackEntry:itemString=>({value:itemString,meta:{}}),setValue:(comp,data)=>{set$5(comp.element,detail.model.getDisplayText(data));}},detail.initialData.map(d=>wrap$1('initialValue',d)).getOr({}))}),Streaming.config({stream:{mode:'throttle',delay:detail.responseTime,stopEvent:false},onStream:(component,_simulatedEvent)=>{var sandbox=Coupling.getCoupled(component,'sandbox');var focusInInput=Focusing.isFocused(component);if(focusInInput){if(get$6(component.element).length>=detail.minChars){var previousValue=getActiveMenu(sandbox).bind(activeMenu=>Highlighting.getHighlighted(activeMenu).map(Representing.getValue));detail.previewing.set(true);var onOpenSync=_sandbox=>{getActiveMenu(sandbox).each(activeMenu=>{previousValue.fold(()=>{if(detail.model.selectsOver){Highlighting.highlightFirst(activeMenu);}},pv=>{Highlighting.highlightBy(activeMenu,item=>{var itemData=Representing.getValue(item);return itemData.value===pv.value;});Highlighting.getHighlighted(activeMenu).orThunk(()=>{Highlighting.highlightFirst(activeMenu);return Optional.none();});});});};open(detail,mapFetch(component),component,sandbox,externals,onOpenSync,HighlightOnOpen.HighlightJustMenu).get(noop);}}},cancelEvent:typeaheadCancel()}),Keying.config({mode:'special',onDown:(comp,simulatedEvent)=>{navigateList(comp,simulatedEvent,Highlighting.highlightFirst);return Optional.some(true);},onEscape:comp=>{var sandbox=Coupling.getCoupled(comp,'sandbox');if(Sandboxing.isOpen(sandbox)){Sandboxing.close(sandbox);return Optional.some(true);}return Optional.none();},onUp:(comp,simulatedEvent)=>{navigateList(comp,simulatedEvent,Highlighting.highlightLast);return Optional.some(true);},onEnter:comp=>{var sandbox=Coupling.getCoupled(comp,'sandbox');var sandboxIsOpen=Sandboxing.isOpen(sandbox);if(sandboxIsOpen&&!detail.previewing.get()){return getActiveMenu(sandbox).bind(activeMenu=>Highlighting.getHighlighted(activeMenu)).map(item=>{emitWith(comp,itemExecute(),{item});return true;});}else{var _currentValue2=Representing.getValue(comp);emit(comp,typeaheadCancel());detail.onExecute(sandbox,comp,_currentValue2);if(sandboxIsOpen){Sandboxing.close(sandbox);}return Optional.some(true);}}}),Toggling.config({toggleClass:detail.markers.openClass,aria:{mode:'expanded'}}),Coupling.config({others:{sandbox:hotspot=>{return makeSandbox$1(detail,hotspot,{onOpen:()=>Toggling.on(hotspot),onClose:()=>{detail.lazyTypeaheadComp.get().each(input=>remove$7(input.element,'aria-activedescendant'));Toggling.off(hotspot);}});}}}),config(typeaheadCustomEvents,[runOnAttached(typeaheadComp=>{detail.lazyTypeaheadComp.set(Optional.some(typeaheadComp));}),runOnDetached(_typeaheadComp=>{detail.lazyTypeaheadComp.set(Optional.none());}),runOnExecute$1(comp=>{var onOpenSync=noop;togglePopup(detail,mapFetch(comp),comp,externals,onOpenSync,HighlightOnOpen.HighlightMenuAndItem).get(noop);}),run$1(itemExecute(),(comp,se)=>{var sandbox=Coupling.getCoupled(comp,'sandbox');setValueFromItem(detail.model,comp,se.event.item);emit(comp,typeaheadCancel());detail.onItemExecute(comp,sandbox,se.event.item,Representing.getValue(comp));Sandboxing.close(sandbox);setCursorAtEnd(comp);})].concat(detail.dismissOnBlur?[run$1(postBlur(),typeahead=>{var sandbox=Coupling.getCoupled(typeahead,'sandbox');if(search(sandbox.element).isNone()){Sandboxing.close(sandbox);}})]:[]))];var eventOrder=_objectSpread({[detachedFromDom()]:[Representing.name(),Streaming.name(),typeaheadCustomEvents]},detail.eventOrder);return{uid:detail.uid,dom:dom(deepMerge(detail,{inputAttributes:{'role':'combobox','aria-autocomplete':'list','aria-haspopup':'true'}})),behaviours:_objectSpread(_objectSpread({},focusBehaviours$1),augment(detail.typeaheadBehaviours,behaviours)),eventOrder};};var schema$g=constant$1([option$3('lazySink'),required$1('fetch'),defaulted('minChars',5),defaulted('responseTime',1000),onHandler('onOpen'),defaulted('getHotspot',Optional.some),defaulted('getAnchorOverrides',constant$1({})),defaulted('layouts',Optional.none()),defaulted('eventOrder',{}),defaultedObjOf('model',{},[defaulted('getDisplayText',itemData=>itemData.meta!==undefined&&itemData.meta.text!==undefined?itemData.meta.text:itemData.value),defaulted('selectsOver',true),defaulted('populateFromBrowse',true)]),onHandler('onSetValue'),onKeyboardHandler('onExecute'),onHandler('onItemExecute'),defaulted('inputClasses',[]),defaulted('inputAttributes',{}),defaulted('inputStyles',{}),defaulted('matchWidth',true),defaulted('useMinWidth',false),defaulted('dismissOnBlur',true),markers$1(['openClass']),option$3('initialData'),field('typeaheadBehaviours',[Focusing,Representing,Streaming,Keying,Toggling,Coupling]),customField('lazyTypeaheadComp',()=>Cell(Optional.none)),customField('previewing',()=>Cell(true))].concat(schema$l()).concat(sandboxFields()));var parts$b=constant$1([external({schema:[tieredMenuMarkers()],name:'menu',overrides:detail=>{return{fakeFocus:true,onHighlightItem:(_tmenu,menu,item)=>{if(!detail.previewing.get()){detail.lazyTypeaheadComp.get().each(input=>{if(detail.model.populateFromBrowse){setValueFromItem(detail.model,input,item);}getOpt(item.element,'id').each(id=>set$9(input.element,'aria-activedescendant',id));});}else{detail.lazyTypeaheadComp.get().each(input=>{attemptSelectOver(detail.model,input,item).fold(()=>{if(detail.model.selectsOver){Highlighting.dehighlight(menu,item);detail.previewing.set(true);}else{detail.previewing.set(false);}},selectOverTextInInput=>{selectOverTextInInput();detail.previewing.set(false);});});}},onExecute:(_menu,item)=>{return detail.lazyTypeaheadComp.get().map(typeahead=>{emitWith(typeahead,itemExecute(),{item});return true;});},onHover:(menu,item)=>{detail.previewing.set(false);detail.lazyTypeaheadComp.get().each(input=>{if(detail.model.populateFromBrowse){setValueFromItem(detail.model,input,item);}});}};}})]);var Typeahead=composite({name:'Typeahead',configFields:schema$g(),partFields:parts$b(),factory:make$3});var wrap=delegate=>{var toCached=()=>{return wrap(delegate.toCached());};var bindFuture=f=>{return wrap(delegate.bind(resA=>resA.fold(err=>Future.pure(Result.error(err)),a=>f(a))));};var bindResult=f=>{return wrap(delegate.map(resA=>resA.bind(f)));};var mapResult=f=>{return wrap(delegate.map(resA=>resA.map(f)));};var mapError=f=>{return wrap(delegate.map(resA=>resA.mapError(f)));};var foldResult=(whenError,whenValue)=>{return delegate.map(res=>res.fold(whenError,whenValue));};var withTimeout=(timeout,errorThunk)=>{return wrap(Future.nu(callback=>{var timedOut=false;var timer=setTimeout(()=>{timedOut=true;callback(Result.error(errorThunk()));},timeout);delegate.get(result=>{if(!timedOut){clearTimeout(timer);callback(result);}});}));};return _objectSpread(_objectSpread({},delegate),{},{toCached,bindFuture,bindResult,mapResult,mapError,foldResult,withTimeout});};var nu$1=worker=>{return wrap(Future.nu(worker));};var value=value=>{return wrap(Future.pure(Result.value(value)));};var error=error=>{return wrap(Future.pure(Result.error(error)));};var fromResult=result=>{return wrap(Future.pure(result));};var fromFuture=future=>{return wrap(future.map(Result.value));};var fromPromise=promise=>{return nu$1(completer=>{promise.then(value=>{completer(Result.value(value));},error=>{completer(Result.error(error));});});};var FutureResult={nu:nu$1,wrap,pure:value,value,error,fromResult,fromFuture,fromPromise};var renderCommonSpec=function renderCommonSpec(spec,actionOpt){var extraBehaviours=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var dom=arguments.length>3?arguments[3]:undefined;var components=arguments.length>4?arguments[4]:undefined;var providersBackstage=arguments.length>5?arguments[5]:undefined;var action=actionOpt.fold(()=>({}),action=>({action}));var common=_objectSpread({buttonBehaviours:derive$1([DisablingConfigs.button(()=>!spec.enabled||providersBackstage.isDisabled()),receivingConfig(),Tabstopping.config({}),config('button press',[preventDefault('click'),preventDefault('mousedown')])].concat(extraBehaviours)),eventOrder:{click:['button press','alloy.base.behaviour'],mousedown:['button press','alloy.base.behaviour']}},action);var domFinal=deepMerge(common,{dom});return deepMerge(domFinal,{components});};var renderIconButtonSpec=function renderIconButtonSpec(spec,action,providersBackstage){var extraBehaviours=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var tooltipAttributes=spec.tooltip.map(tooltip=>({'aria-label':providersBackstage.translate(tooltip),'title':providersBackstage.translate(tooltip)})).getOr({});var dom={tag:'button',classes:['tox-tbtn'],attributes:tooltipAttributes};var icon=spec.icon.map(iconName=>renderIconFromPack$1(iconName,providersBackstage.icons));var components=componentRenderPipeline([icon]);return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage);};var calculateClassesFromButtonType=buttonType=>{switch(buttonType){case'primary':return['tox-button'];case'toolbar':return['tox-tbtn'];case'secondary':default:return['tox-button','tox-button--secondary'];}};var renderButtonSpec=function renderButtonSpec(spec,action,providersBackstage){var extraBehaviours=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var extraClasses=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];var translatedText=providersBackstage.translate(spec.text);var icon=spec.icon.map(iconName=>renderIconFromPack$1(iconName,providersBackstage.icons));var components=[icon.getOrThunk(()=>text$2(translatedText))];var buttonType=spec.buttonType.getOr(!spec.primary&&!spec.borderless?'secondary':'primary');var baseClasses=calculateClassesFromButtonType(buttonType);var classes=[...baseClasses,...(icon.isSome()?['tox-button--icon']:[]),...(spec.borderless?['tox-button--naked']:[]),...extraClasses];var dom={tag:'button',classes,attributes:{title:translatedText}};return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage);};var renderButton$1=function renderButton$1(spec,action,providersBackstage){var extraBehaviours=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var extraClasses=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];var buttonSpec=renderButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours,extraClasses);return Button.sketch(buttonSpec);};var getAction=(name,buttonType)=>comp=>{if(buttonType==='custom'){emitWith(comp,formActionEvent,{name,value:{}});}else if(buttonType==='submit'){emit(comp,formSubmitEvent);}else if(buttonType==='cancel'){emit(comp,formCancelEvent);}else{console.error('Unknown button type: ',buttonType);}};var isMenuFooterButtonSpec=(spec,buttonType)=>buttonType==='menu';var isNormalFooterButtonSpec=(spec,buttonType)=>buttonType==='custom'||buttonType==='cancel'||buttonType==='submit';var isToggleButtonSpec=(spec,buttonType)=>buttonType==='togglebutton';var renderToggleButton=(spec,providers)=>{var _a,_b;var optMemIcon=spec.icon.map(memIcon=>renderReplaceableIconFromPack(memIcon,providers.icons)).map(record);var action=comp=>{emitWith(comp,formActionEvent,{name:spec.name,value:{setIcon:newIcon=>{optMemIcon.map(memIcon=>memIcon.getOpt(comp).each(displayIcon=>{Replacing.set(displayIcon,[renderReplaceableIconFromPack(newIcon,providers.icons)]);}));}}});};var buttonType=spec.buttonType.getOr(!spec.primary?'secondary':'primary');var buttonSpec=_objectSpread(_objectSpread({},spec),{},{name:(_a=spec.name)!==null&&_a!==void 0?_a:'',primary:buttonType==='primary',tooltip:Optional.from(spec.tooltip),enabled:(_b=spec.enabled)!==null&&_b!==void 0?_b:false,borderless:false});var tooltipAttributes=buttonSpec.tooltip.map(tooltip=>({'aria-label':providers.translate(tooltip),'title':providers.translate(tooltip)})).getOr({});var buttonTypeClasses=calculateClassesFromButtonType(buttonType!==null&&buttonType!==void 0?buttonType:'secondary');var showIconAndText=spec.icon.isSome()&&spec.text.isSome();var dom={tag:'button',classes:[...buttonTypeClasses.concat(spec.icon.isSome()?['tox-button--icon']:[]),...(spec.active?['tox-button--enabled']:[]),...(showIconAndText?['tox-button--icon-and-text']:[])],attributes:tooltipAttributes};var extraBehaviours=[];var translatedText=providers.translate(spec.text.getOr(''));var translatedTextComponed=text$2(translatedText);var iconComp=componentRenderPipeline([optMemIcon.map(memIcon=>memIcon.asSpec())]);var components=[...iconComp,...(spec.text.isSome()?[translatedTextComponed]:[])];var iconButtonSpec=renderCommonSpec(buttonSpec,Optional.some(action),extraBehaviours,dom,components,providers);return Button.sketch(iconButtonSpec);};var renderFooterButton=(spec,buttonType,backstage)=>{if(isMenuFooterButtonSpec(spec,buttonType)){var getButton=()=>memButton;var menuButtonSpec=spec;var fixedSpec=_objectSpread(_objectSpread({},spec),{},{type:'menubutton',search:Optional.none(),onSetup:api=>{api.setEnabled(spec.enabled);return noop;},fetch:getFetch(menuButtonSpec.items,getButton,backstage)});var memButton=record(renderMenuButton(fixedSpec,'tox-tbtn',backstage,Optional.none()));return memButton.asSpec();}else if(isNormalFooterButtonSpec(spec,buttonType)){var action=getAction(spec.name,buttonType);var buttonSpec=_objectSpread(_objectSpread({},spec),{},{borderless:false});return renderButton$1(buttonSpec,action,backstage.shared.providers,[]);}else if(isToggleButtonSpec(spec,buttonType)){return renderToggleButton(spec,backstage.shared.providers);}else{console.error('Unknown footer button type: ',buttonType);throw new Error('Unknown footer button type');}};var renderDialogButton=(spec,providersBackstage)=>{var action=getAction(spec.name,'custom');return renderFormField(Optional.none(),FormField.parts.field(_objectSpread({factory:Button},renderButtonSpec(spec,Optional.some(action),providersBackstage,[memory(''),ComposingConfigs.self()]))));};var separator$1={type:'separator'};var toMenuItem=target=>({type:'menuitem',value:target.url,text:target.title,meta:{attach:target.attach},onAction:noop});var staticMenuItem=(title,url)=>({type:'menuitem',value:url,text:title,meta:{attach:undefined},onAction:noop});var toMenuItems=targets=>map$2(targets,toMenuItem);var filterLinkTargets=(type,targets)=>filter$2(targets,target=>target.type===type);var filteredTargets=(type,targets)=>toMenuItems(filterLinkTargets(type,targets));var headerTargets=linkInfo=>filteredTargets('header',linkInfo.targets);var anchorTargets=linkInfo=>filteredTargets('anchor',linkInfo.targets);var anchorTargetTop=linkInfo=>Optional.from(linkInfo.anchorTop).map(url=>staticMenuItem('<top>',url)).toArray();var anchorTargetBottom=linkInfo=>Optional.from(linkInfo.anchorBottom).map(url=>staticMenuItem('<bottom>',url)).toArray();var historyTargets=history=>map$2(history,url=>staticMenuItem(url,url));var joinMenuLists=items=>{return foldl(items,(a,b)=>{var bothEmpty=a.length===0||b.length===0;return bothEmpty?a.concat(b):a.concat(separator$1,b);},[]);};var filterByQuery=(term,menuItems)=>{var lowerCaseTerm=term.toLowerCase();return filter$2(menuItems,item=>{var _a;var text=item.meta!==undefined&&item.meta.text!==undefined?item.meta.text:item.text;var value=(_a=item.value)!==null&&_a!==void 0?_a:'';return contains$1(text.toLowerCase(),lowerCaseTerm)||contains$1(value.toLowerCase(),lowerCaseTerm);});};var getItems=(fileType,input,urlBackstage)=>{var _a,_b;var urlInputValue=Representing.getValue(input);var term=(_b=(_a=urlInputValue===null||urlInputValue===void 0?void 0:urlInputValue.meta)===null||_a===void 0?void 0:_a.text)!==null&&_b!==void 0?_b:urlInputValue.value;var info=urlBackstage.getLinkInformation();return info.fold(()=>[],linkInfo=>{var history=filterByQuery(term,historyTargets(urlBackstage.getHistory(fileType)));return fileType==='file'?joinMenuLists([history,filterByQuery(term,headerTargets(linkInfo)),filterByQuery(term,flatten([anchorTargetTop(linkInfo),anchorTargets(linkInfo),anchorTargetBottom(linkInfo)]))]):history;});};var errorId=generate$6('aria-invalid');var renderUrlInput=(spec,backstage,urlBackstage,initialData)=>{var providersBackstage=backstage.shared.providers;var updateHistory=component=>{var urlEntry=Representing.getValue(component);urlBackstage.addToHistory(urlEntry.value,spec.filetype);};var typeaheadSpec=_objectSpread(_objectSpread({},initialData.map(initialData=>({initialData})).getOr({})),{},{dismissOnBlur:true,inputClasses:['tox-textfield'],sandboxClasses:['tox-dialog__popups'],inputAttributes:{'aria-errormessage':errorId,'type':'url'},minChars:0,responseTime:0,fetch:input=>{var items=getItems(spec.filetype,input,urlBackstage);var tdata=build(items,ItemResponse$1.BUBBLE_TO_SANDBOX,backstage,{isHorizontalMenu:false,search:Optional.none()});return Future.pure(tdata);},getHotspot:comp=>memUrlBox.getOpt(comp),onSetValue:(comp,_newValue)=>{if(comp.hasConfigured(Invalidating)){Invalidating.run(comp).get(noop);}},typeaheadBehaviours:derive$1([...urlBackstage.getValidationHandler().map(handler=>Invalidating.config({getRoot:comp=>parentElement(comp.element),invalidClass:'tox-control-wrap--status-invalid',notify:{onInvalid:(comp,err)=>{memInvalidIcon.getOpt(comp).each(invalidComp=>{set$9(invalidComp.element,'title',providersBackstage.translate(err));});}},validator:{validate:input=>{var urlEntry=Representing.getValue(input);return FutureResult.nu(completer=>{handler({type:spec.filetype,url:urlEntry.value},validation=>{if(validation.status==='invalid'){var err=Result.error(validation.message);completer(err);}else{var val=Result.value(validation.message);completer(val);}});});},validateOnLoad:false}})).toArray(),Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled()}),Tabstopping.config({}),config('urlinput-events',[run$1(input(),comp=>{var currentValue=get$6(comp.element);var trimmedValue=currentValue.trim();if(trimmedValue!==currentValue){set$5(comp.element,trimmedValue);}if(spec.filetype==='file'){emitWith(comp,formChangeEvent,{name:spec.name});}}),run$1(change(),comp=>{emitWith(comp,formChangeEvent,{name:spec.name});updateHistory(comp);}),run$1(postPaste(),comp=>{emitWith(comp,formChangeEvent,{name:spec.name});updateHistory(comp);})])]),eventOrder:{[input()]:['streaming','urlinput-events','invalidating']},model:{getDisplayText:itemData=>itemData.value,selectsOver:false,populateFromBrowse:false},markers:{openClass:'tox-textfield--popup-open'},lazySink:backstage.shared.getSink,parts:{menu:part(false,1,'normal')},onExecute:(_menu,component,_entry)=>{emitWith(component,formSubmitEvent,{});},onItemExecute:(typeahead,_sandbox,_item,_value)=>{updateHistory(typeahead);emitWith(typeahead,formChangeEvent,{name:spec.name});}});var pField=FormField.parts.field(_objectSpread(_objectSpread({},typeaheadSpec),{},{factory:Typeahead}));var pLabel=spec.label.map(label=>renderLabel$3(label,providersBackstage));var makeIcon=function makeIcon(name,errId){var icon=arguments.length>2&&arguments[2]!==undefined?arguments[2]:name;var label=arguments.length>3&&arguments[3]!==undefined?arguments[3]:name;return render$3(icon,{tag:'div',classes:['tox-icon','tox-control-wrap__status-icon-'+name],attributes:_objectSpread({'title':providersBackstage.translate(label),'aria-live':'polite'},errId.fold(()=>({}),id=>({id})))},providersBackstage.icons);};var memInvalidIcon=record(makeIcon('invalid',Optional.some(errorId),'warning'));var memStatus=record({dom:{tag:'div',classes:['tox-control-wrap__status-icon-wrap']},components:[memInvalidIcon.asSpec()]});var optUrlPicker=urlBackstage.getUrlPicker(spec.filetype);var browseUrlEvent=generate$6('browser.url.event');var memUrlBox=record({dom:{tag:'div',classes:['tox-control-wrap']},components:[pField,memStatus.asSpec()],behaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled()})])});var memUrlPickerButton=record(renderButton$1({name:spec.name,icon:Optional.some('browse'),text:spec.label.getOr(''),enabled:spec.enabled,primary:false,buttonType:Optional.none(),borderless:true},component=>emit(component,browseUrlEvent),providersBackstage,[],['tox-browse-url']));var controlHWrapper=()=>({dom:{tag:'div',classes:['tox-form__controls-h-stack']},components:flatten([[memUrlBox.asSpec()],optUrlPicker.map(()=>memUrlPickerButton.asSpec()).toArray()])});var openUrlPicker=comp=>{Composing.getCurrent(comp).each(field=>{var componentData=Representing.getValue(field);var urlData=_objectSpread({fieldname:spec.name},componentData);optUrlPicker.each(picker=>{picker(urlData).get(chosenData=>{Representing.setValue(field,chosenData);emitWith(comp,formChangeEvent,{name:spec.name});});});});};return FormField.sketch({dom:renderFormFieldDom(),components:pLabel.toArray().concat([controlHWrapper()]),fieldBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providersBackstage.isDisabled(),onDisabled:comp=>{FormField.getField(comp).each(Disabling.disable);memUrlPickerButton.getOpt(comp).each(Disabling.disable);},onEnabled:comp=>{FormField.getField(comp).each(Disabling.enable);memUrlPickerButton.getOpt(comp).each(Disabling.enable);}}),receivingConfig(),config('url-input-events',[run$1(browseUrlEvent,openUrlPicker)])])});};var renderAlertBanner=(spec,providersBackstage)=>{var icon=get$2(spec.icon,providersBackstage.icons);return Container.sketch({dom:{tag:'div',attributes:{role:'alert'},classes:['tox-notification','tox-notification--in',\"tox-notification--\".concat(spec.level)]},components:[{dom:{tag:'div',classes:['tox-notification__icon'],innerHtml:!spec.url?icon:undefined},components:spec.url?[Button.sketch({dom:{tag:'button',classes:['tox-button','tox-button--naked','tox-button--icon'],innerHtml:icon,attributes:{title:providersBackstage.translate(spec.iconTooltip)}},action:comp=>emitWith(comp,formActionEvent,{name:'alert-banner',value:spec.url}),buttonBehaviours:derive$1([addFocusableBehaviour()])})]:undefined},{dom:{tag:'div',classes:['tox-notification__body'],innerHtml:providersBackstage.translate(spec.text)}}]});};var set$1=(element,status)=>{element.dom.checked=status;};var get$1=element=>element.dom.checked;var renderCheckbox=(spec,providerBackstage,initialData)=>{var toggleCheckboxHandler=comp=>{comp.element.dom.click();return Optional.some(true);};var pField=FormField.parts.field({factory:{sketch:identity},dom:{tag:'input',classes:['tox-checkbox__input'],attributes:{type:'checkbox'}},behaviours:derive$1([ComposingConfigs.self(),Disabling.config({disabled:()=>!spec.enabled||providerBackstage.isDisabled(),onDisabled:component=>{parentElement(component.element).each(element=>add$2(element,'tox-checkbox--disabled'));},onEnabled:component=>{parentElement(component.element).each(element=>remove$2(element,'tox-checkbox--disabled'));}}),Tabstopping.config({}),Focusing.config({}),withElement(initialData,get$1,set$1),Keying.config({mode:'special',onEnter:toggleCheckboxHandler,onSpace:toggleCheckboxHandler,stopSpaceKeyup:true}),config('checkbox-events',[run$1(change(),(component,_)=>{emitWith(component,formChangeEvent,{name:spec.name});})])])});var pLabel=FormField.parts.label({dom:{tag:'span',classes:['tox-checkbox__label']},components:[text$2(providerBackstage.translate(spec.label))],behaviours:derive$1([Unselecting.config({})])});var makeIcon=className=>{var iconName=className==='checked'?'selected':'unselected';return render$3(iconName,{tag:'span',classes:['tox-icon','tox-checkbox-icon__'+className]},providerBackstage.icons);};var memIcons=record({dom:{tag:'div',classes:['tox-checkbox__icons']},components:[makeIcon('checked'),makeIcon('unchecked')]});return FormField.sketch({dom:{tag:'label',classes:['tox-checkbox']},components:[pField,memIcons.asSpec(),pLabel],fieldBehaviours:derive$1([Disabling.config({disabled:()=>!spec.enabled||providerBackstage.isDisabled()}),receivingConfig()])});};var renderHtmlPanel=spec=>{if(spec.presets==='presentation'){return Container.sketch({dom:{tag:'div',classes:['tox-form__group'],innerHtml:spec.html}});}else{return Container.sketch({dom:{tag:'div',classes:['tox-form__group'],innerHtml:spec.html,attributes:{role:'document'}},containerBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])});}};var make$2=render=>{return(parts,spec,dialogData,backstage)=>get$g(spec,'name').fold(()=>render(spec,backstage,Optional.none()),fieldName=>parts.field(fieldName,render(spec,backstage,get$g(dialogData,fieldName))));};var makeIframe=render=>(parts,spec,dialogData,backstage)=>{var iframeSpec=deepMerge(spec,{source:'dynamic'});return make$2(render)(parts,iframeSpec,dialogData,backstage);};var factories={bar:make$2((spec,backstage)=>renderBar(spec,backstage.shared)),collection:make$2((spec,backstage,data)=>renderCollection(spec,backstage.shared.providers,data)),alertbanner:make$2((spec,backstage)=>renderAlertBanner(spec,backstage.shared.providers)),input:make$2((spec,backstage,data)=>renderInput(spec,backstage.shared.providers,data)),textarea:make$2((spec,backstage,data)=>renderTextarea(spec,backstage.shared.providers,data)),label:make$2((spec,backstage)=>renderLabel$2(spec,backstage.shared)),iframe:makeIframe((spec,backstage,data)=>renderIFrame(spec,backstage.shared.providers,data)),button:make$2((spec,backstage)=>renderDialogButton(spec,backstage.shared.providers)),checkbox:make$2((spec,backstage,data)=>renderCheckbox(spec,backstage.shared.providers,data)),colorinput:make$2((spec,backstage,data)=>renderColorInput(spec,backstage.shared,backstage.colorinput,data)),colorpicker:make$2((spec,backstage,data)=>renderColorPicker(spec,backstage.shared.providers,data)),dropzone:make$2((spec,backstage,data)=>renderDropZone(spec,backstage.shared.providers,data)),grid:make$2((spec,backstage)=>renderGrid(spec,backstage.shared)),listbox:make$2((spec,backstage,data)=>renderListBox(spec,backstage,data)),selectbox:make$2((spec,backstage,data)=>renderSelectBox(spec,backstage.shared.providers,data)),sizeinput:make$2((spec,backstage)=>renderSizeInput(spec,backstage.shared.providers)),slider:make$2((spec,backstage,data)=>renderSlider(spec,backstage.shared.providers,data)),urlinput:make$2((spec,backstage,data)=>renderUrlInput(spec,backstage,backstage.urlinput,data)),customeditor:make$2(renderCustomEditor),htmlpanel:make$2(renderHtmlPanel),imagepreview:make$2((spec,_,data)=>renderImagePreview(spec,data)),table:make$2((spec,backstage)=>renderTable(spec,backstage.shared.providers)),tree:make$2((spec,backstage)=>renderTree(spec,backstage)),panel:make$2((spec,backstage)=>renderPanel(spec,backstage))};var noFormParts={field:(_name,spec)=>spec,record:constant$1([])};var interpretInForm=(parts,spec,dialogData,oldBackstage)=>{var newBackstage=deepMerge(oldBackstage,{shared:{interpreter:childSpec=>interpretParts(parts,childSpec,dialogData,newBackstage)}});return interpretParts(parts,spec,dialogData,newBackstage);};var interpretParts=(parts,spec,dialogData,backstage)=>get$g(factories,spec.type).fold(()=>{console.error(\"Unknown factory type \\\"\".concat(spec.type,\"\\\", defaulting to container: \"),spec);return spec;},factory=>factory(parts,spec,dialogData,backstage));var interpretWithoutForm=(spec,dialogData,backstage)=>interpretParts(noFormParts,spec,dialogData,backstage);var labelPrefix='layout-inset';var westEdgeX=anchor=>anchor.x;var middleX=(anchor,element)=>anchor.x+anchor.width/2-element.width/2;var eastEdgeX=(anchor,element)=>anchor.x+anchor.width-element.width;var northY=anchor=>anchor.y;var southY=(anchor,element)=>anchor.y+anchor.height-element.height;var centreY=(anchor,element)=>anchor.y+anchor.height/2-element.height/2;var southwest=(anchor,element,bubbles)=>nu$6(eastEdgeX(anchor,element),southY(anchor,element),bubbles.insetSouthwest(),northwest$3(),'southwest',boundsRestriction(anchor,{right:0,bottom:3}),labelPrefix);var southeast=(anchor,element,bubbles)=>nu$6(westEdgeX(anchor),southY(anchor,element),bubbles.insetSoutheast(),northeast$3(),'southeast',boundsRestriction(anchor,{left:1,bottom:3}),labelPrefix);var northwest=(anchor,element,bubbles)=>nu$6(eastEdgeX(anchor,element),northY(anchor),bubbles.insetNorthwest(),southwest$3(),'northwest',boundsRestriction(anchor,{right:0,top:2}),labelPrefix);var northeast=(anchor,element,bubbles)=>nu$6(westEdgeX(anchor),northY(anchor),bubbles.insetNortheast(),southeast$3(),'northeast',boundsRestriction(anchor,{left:1,top:2}),labelPrefix);var north=(anchor,element,bubbles)=>nu$6(middleX(anchor,element),northY(anchor),bubbles.insetNorth(),south$3(),'north',boundsRestriction(anchor,{top:2}),labelPrefix);var south=(anchor,element,bubbles)=>nu$6(middleX(anchor,element),southY(anchor,element),bubbles.insetSouth(),north$3(),'south',boundsRestriction(anchor,{bottom:3}),labelPrefix);var east=(anchor,element,bubbles)=>nu$6(eastEdgeX(anchor,element),centreY(anchor,element),bubbles.insetEast(),west$3(),'east',boundsRestriction(anchor,{right:0}),labelPrefix);var west=(anchor,element,bubbles)=>nu$6(westEdgeX(anchor),centreY(anchor,element),bubbles.insetWest(),east$3(),'west',boundsRestriction(anchor,{left:1}),labelPrefix);var lookupPreserveLayout=lastPlacement=>{switch(lastPlacement){case'north':return north;case'northeast':return northeast;case'northwest':return northwest;case'south':return south;case'southeast':return southeast;case'southwest':return southwest;case'east':return east;case'west':return west;}};var preserve=(anchor,element,bubbles,placee,bounds)=>{var layout=getPlacement(placee).map(lookupPreserveLayout).getOr(north);return layout(anchor,element,bubbles,placee,bounds);};var lookupFlippedLayout=lastPlacement=>{switch(lastPlacement){case'north':return south;case'northeast':return southeast;case'northwest':return southwest;case'south':return north;case'southeast':return northeast;case'southwest':return northwest;case'east':return west;case'west':return east;}};var flip=(anchor,element,bubbles,placee,bounds)=>{var layout=getPlacement(placee).map(lookupFlippedLayout).getOr(north);return layout(anchor,element,bubbles,placee,bounds);};var bubbleAlignments$2={valignCentre:[],alignCentre:[],alignLeft:[],alignRight:[],right:[],left:[],bottom:[],top:[]};var getInlineDialogAnchor=(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor)=>{var bubbleSize=12;var overrides={maxHeightFunction:expandable$1()};var editableAreaAnchor=()=>({type:'node',root:getContentContainer(getRootNode(contentAreaElement())),node:Optional.from(contentAreaElement()),bubble:nu$5(bubbleSize,bubbleSize,bubbleAlignments$2),layouts:{onRtl:()=>[northeast],onLtr:()=>[northwest]},overrides});var standardAnchor=()=>({type:'hotspot',hotspot:lazyAnchorbar(),bubble:nu$5(-bubbleSize,bubbleSize,bubbleAlignments$2),layouts:{onRtl:()=>[southeast$2,southwest$2,south$2],onLtr:()=>[southwest$2,southeast$2,south$2]},overrides});return()=>lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor();};var getInlineBottomDialogAnchor=(inline,contentAreaElement,lazyBottomAnchorBar,lazyUseEditableAreaAnchor)=>{var bubbleSize=12;var overrides={maxHeightFunction:expandable$1()};var editableAreaAnchor=()=>({type:'node',root:getContentContainer(getRootNode(contentAreaElement())),node:Optional.from(contentAreaElement()),bubble:nu$5(bubbleSize,bubbleSize,bubbleAlignments$2),layouts:{onRtl:()=>[north],onLtr:()=>[north]},overrides});var standardAnchor=()=>inline?{type:'node',root:getContentContainer(getRootNode(contentAreaElement())),node:Optional.from(contentAreaElement()),bubble:nu$5(0,-getOuter$2(contentAreaElement()),bubbleAlignments$2),layouts:{onRtl:()=>[north$2],onLtr:()=>[north$2]},overrides}:{type:'hotspot',hotspot:lazyBottomAnchorBar(),bubble:nu$5(0,0,bubbleAlignments$2),layouts:{onRtl:()=>[north$2],onLtr:()=>[north$2]},overrides};return()=>lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor();};var getBannerAnchor=(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor)=>{var editableAreaAnchor=()=>({type:'node',root:getContentContainer(getRootNode(contentAreaElement())),node:Optional.from(contentAreaElement()),layouts:{onRtl:()=>[north],onLtr:()=>[north]}});var standardAnchor=()=>({type:'hotspot',hotspot:lazyAnchorbar(),layouts:{onRtl:()=>[south$2],onLtr:()=>[south$2]}});return()=>lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor();};var getCursorAnchor=(editor,bodyElement)=>()=>({type:'selection',root:bodyElement(),getSelection:()=>{var rng=editor.selection.getRng();var selectedCells=editor.model.table.getSelectedCells();if(selectedCells.length>1){var firstCell=selectedCells[0];var lastCell=selectedCells[selectedCells.length-1];var selectionTableCellRange={firstCell:SugarElement.fromDom(firstCell),lastCell:SugarElement.fromDom(lastCell)};return Optional.some(selectionTableCellRange);}return Optional.some(SimSelection.range(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset));}});var getNodeAnchor$1=bodyElement=>element=>({type:'node',root:bodyElement(),node:element});var getAnchors=(editor,lazyAnchorbar,lazyBottomAnchorBar,isToolbarTop)=>{var useFixedToolbarContainer=useFixedContainer(editor);var bodyElement=()=>SugarElement.fromDom(editor.getBody());var contentAreaElement=()=>SugarElement.fromDom(editor.getContentAreaContainer());var lazyUseEditableAreaAnchor=()=>useFixedToolbarContainer||!isToolbarTop();return{inlineDialog:getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),inlineBottomDialog:getInlineBottomDialogAnchor(editor.inline,contentAreaElement,lazyBottomAnchorBar,lazyUseEditableAreaAnchor),banner:getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),cursor:getCursorAnchor(editor,bodyElement),node:getNodeAnchor$1(bodyElement)};};var colorPicker=editor=>(callback,value)=>{var dialog=colorPickerDialog(editor);dialog(callback,value);};var hasCustomColors=editor=>()=>hasCustomColors$1(editor);var getColors=editor=>id=>getColors$2(editor,id);var getColorCols=editor=>id=>getColorCols$1(editor,id);var ColorInputBackstage=editor=>({colorPicker:colorPicker(editor),hasCustomColors:hasCustomColors(editor),getColors:getColors(editor),getColorCols:getColorCols(editor)});var isDraggableModal=editor=>()=>isDraggableModal$1(editor);var DialogBackstage=editor=>({isDraggableModal:isDraggableModal(editor)});var HeaderBackstage=editor=>{var mode=Cell(isToolbarLocationBottom(editor)?'bottom':'top');return{isPositionedAtTop:()=>mode.get()==='top',getDockingMode:mode.get,setDockingMode:mode.set};};var isNestedFormat=format=>hasNonNullableKey(format,'items');var isFormatReference=format=>hasNonNullableKey(format,'format');var defaultStyleFormats=[{title:'Headings',items:[{title:'Heading 1',format:'h1'},{title:'Heading 2',format:'h2'},{title:'Heading 3',format:'h3'},{title:'Heading 4',format:'h4'},{title:'Heading 5',format:'h5'},{title:'Heading 6',format:'h6'}]},{title:'Inline',items:[{title:'Bold',format:'bold'},{title:'Italic',format:'italic'},{title:'Underline',format:'underline'},{title:'Strikethrough',format:'strikethrough'},{title:'Superscript',format:'superscript'},{title:'Subscript',format:'subscript'},{title:'Code',format:'code'}]},{title:'Blocks',items:[{title:'Paragraph',format:'p'},{title:'Blockquote',format:'blockquote'},{title:'Div',format:'div'},{title:'Pre',format:'pre'}]},{title:'Align',items:[{title:'Left',format:'alignleft'},{title:'Center',format:'aligncenter'},{title:'Right',format:'alignright'},{title:'Justify',format:'alignjustify'}]}];var isNestedFormats=format=>has$2(format,'items');var isBlockFormat=format=>has$2(format,'block');var isInlineFormat=format=>has$2(format,'inline');var isSelectorFormat=format=>has$2(format,'selector');var mapFormats=userFormats=>foldl(userFormats,(acc,fmt)=>{if(isNestedFormats(fmt)){var result=mapFormats(fmt.items);return{customFormats:acc.customFormats.concat(result.customFormats),formats:acc.formats.concat([{title:fmt.title,items:result.formats}])};}else if(isInlineFormat(fmt)||isBlockFormat(fmt)||isSelectorFormat(fmt)){var formatName=isString(fmt.name)?fmt.name:fmt.title.toLowerCase();var formatNameWithPrefix=\"custom-\".concat(formatName);return{customFormats:acc.customFormats.concat([{name:formatNameWithPrefix,format:fmt}]),formats:acc.formats.concat([{title:fmt.title,format:formatNameWithPrefix,icon:fmt.icon}])};}else{return _objectSpread(_objectSpread({},acc),{},{formats:acc.formats.concat(fmt)});}},{customFormats:[],formats:[]});var registerCustomFormats=(editor,userFormats)=>{var result=mapFormats(userFormats);var registerFormats=customFormats=>{each$1(customFormats,fmt=>{if(!editor.formatter.has(fmt.name)){editor.formatter.register(fmt.name,fmt.format);}});};if(editor.formatter){registerFormats(result.customFormats);}else{editor.on('init',()=>{registerFormats(result.customFormats);});}return result.formats;};var getStyleFormats=editor=>getUserStyleFormats(editor).map(userFormats=>{var registeredUserFormats=registerCustomFormats(editor,userFormats);return shouldMergeStyleFormats(editor)?defaultStyleFormats.concat(registeredUserFormats):registeredUserFormats;}).getOr(defaultStyleFormats);var isSeparator$1=format=>{var keys$1=keys(format);return keys$1.length===1&&contains$2(keys$1,'title');};var processBasic=(item,isSelectedFor,getPreviewFor)=>_objectSpread(_objectSpread({},item),{},{type:'formatter',isSelected:isSelectedFor(item.format),getStylePreview:getPreviewFor(item.format)});var register$a=(editor,formats,isSelectedFor,getPreviewFor)=>{var enrichSupported=item=>processBasic(item,isSelectedFor,getPreviewFor);var enrichMenu=item=>{var newItems=doEnrich(item.items);return _objectSpread(_objectSpread({},item),{},{type:'submenu',getStyleItems:constant$1(newItems)});};var enrichCustom=item=>{var formatName=isString(item.name)?item.name:generate$6(item.title);var formatNameWithPrefix=\"custom-\".concat(formatName);var newItem=_objectSpread(_objectSpread({},item),{},{type:'formatter',format:formatNameWithPrefix,isSelected:isSelectedFor(formatNameWithPrefix),getStylePreview:getPreviewFor(formatNameWithPrefix)});editor.formatter.register(formatName,newItem);return newItem;};var doEnrich=items=>map$2(items,item=>{if(isNestedFormat(item)){return enrichMenu(item);}else if(isFormatReference(item)){return enrichSupported(item);}else if(isSeparator$1(item)){return _objectSpread(_objectSpread({},item),{},{type:'separator'});}else{return enrichCustom(item);}});return doEnrich(formats);};var init$7=editor=>{var isSelectedFor=format=>()=>editor.formatter.match(format);var getPreviewFor=format=>()=>{var fmt=editor.formatter.get(format);return fmt!==undefined?Optional.some({tag:fmt.length>0?fmt[0].inline||fmt[0].block||'div':'div',styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none();};var settingsFormats=Cell([]);var eventsFormats=Cell([]);var replaceSettings=Cell(false);editor.on('PreInit',_e=>{var formats=getStyleFormats(editor);var enriched=register$a(editor,formats,isSelectedFor,getPreviewFor);settingsFormats.set(enriched);});editor.on('addStyleModifications',e=>{var modifications=register$a(editor,e.items,isSelectedFor,getPreviewFor);eventsFormats.set(modifications);replaceSettings.set(e.replace);});var getData=()=>{var fromSettings=replaceSettings.get()?[]:settingsFormats.get();var fromEvents=eventsFormats.get();return fromSettings.concat(fromEvents);};return{getData};};var isElement=node=>isNonNullable(node)&&node.nodeType===1;var trim=global$1.trim;var hasContentEditableState=value=>{return node=>{if(isElement(node)){if(node.contentEditable===value){return true;}if(node.getAttribute('data-mce-contenteditable')===value){return true;}}return false;};};var isContentEditableTrue=hasContentEditableState('true');var isContentEditableFalse=hasContentEditableState('false');var create$1=(type,title,url,level,attach)=>({type,title,url,level,attach});var isChildOfContentEditableTrue=node=>{var tempNode=node;while(tempNode=tempNode.parentNode){var _value4=tempNode.contentEditable;if(_value4&&_value4!=='inherit'){return isContentEditableTrue(tempNode);}}return false;};var select=(selector,root)=>{return map$2(descendants(SugarElement.fromDom(root),selector),element=>{return element.dom;});};var getElementText=elm=>{return elm.innerText||elm.textContent;};var getOrGenerateId=elm=>{return elm.id?elm.id:generate$6('h');};var isAnchor=elm=>{return elm&&elm.nodeName==='A'&&(elm.id||elm.name)!==undefined;};var isValidAnchor=elm=>{return isAnchor(elm)&&isEditable(elm);};var isHeader=elm=>{return elm&&/^(H[1-6])$/.test(elm.nodeName);};var isEditable=elm=>{return isChildOfContentEditableTrue(elm)&&!isContentEditableFalse(elm);};var isValidHeader=elm=>{return isHeader(elm)&&isEditable(elm);};var getLevel=elm=>{return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0;};var headerTarget=elm=>{var _a;var headerId=getOrGenerateId(elm);var attach=()=>{elm.id=headerId;};return create$1('header',(_a=getElementText(elm))!==null&&_a!==void 0?_a:'','#'+headerId,getLevel(elm),attach);};var anchorTarget=elm=>{var anchorId=elm.id||elm.name;var anchorText=getElementText(elm);return create$1('anchor',anchorText?anchorText:'#'+anchorId,'#'+anchorId,0,noop);};var getHeaderTargets=elms=>{return map$2(filter$2(elms,isValidHeader),headerTarget);};var getAnchorTargets=elms=>{return map$2(filter$2(elms,isValidAnchor),anchorTarget);};var getTargetElements=elm=>{var elms=select('h1,h2,h3,h4,h5,h6,a:not([href])',elm);return elms;};var hasTitle=target=>{return trim(target.title).length>0;};var find=elm=>{var elms=getTargetElements(elm);return filter$2(getHeaderTargets(elms).concat(getAnchorTargets(elms)),hasTitle);};var LinkTargets={find};var STORAGE_KEY='tinymce-url-history';var HISTORY_LENGTH=5;var isHttpUrl=url=>isString(url)&&/^https?/.test(url);var isArrayOfUrl=a=>isArray(a)&&a.length<=HISTORY_LENGTH&&forall(a,isHttpUrl);var isRecordOfUrlArray=r=>isObject(r)&&find$4(r,value=>!isArrayOfUrl(value)).isNone();var getAllHistory=()=>{var unparsedHistory=global$4.getItem(STORAGE_KEY);if(unparsedHistory===null){return{};}var history;try{history=JSON.parse(unparsedHistory);}catch(e){if(e instanceof SyntaxError){console.log('Local storage '+STORAGE_KEY+' was not valid JSON',e);return{};}throw e;}if(!isRecordOfUrlArray(history)){console.log('Local storage '+STORAGE_KEY+' was not valid format',history);return{};}return history;};var setAllHistory=history=>{if(!isRecordOfUrlArray(history)){throw new Error('Bad format for history:\\n'+JSON.stringify(history));}global$4.setItem(STORAGE_KEY,JSON.stringify(history));};var getHistory=fileType=>{var history=getAllHistory();return get$g(history,fileType).getOr([]);};var addToHistory=(url,fileType)=>{if(!isHttpUrl(url)){return;}var history=getAllHistory();var items=get$g(history,fileType).getOr([]);var itemsWithoutUrl=filter$2(items,item=>item!==url);history[fileType]=[url].concat(itemsWithoutUrl).slice(0,HISTORY_LENGTH);setAllHistory(history);};var isTruthy=value=>!!value;var makeMap=value=>map$1(global$1.makeMap(value,/[, ]/),isTruthy);var getPicker=editor=>Optional.from(getFilePickerCallback(editor));var getPickerTypes=editor=>{var optFileTypes=Optional.from(getFilePickerTypes(editor)).filter(isTruthy).map(makeMap);return getPicker(editor).fold(never,_picker=>optFileTypes.fold(always,types=>keys(types).length>0?types:false));};var getPickerSetting=(editor,filetype)=>{var pickerTypes=getPickerTypes(editor);if(isBoolean(pickerTypes)){return pickerTypes?getPicker(editor):Optional.none();}else{return pickerTypes[filetype]?getPicker(editor):Optional.none();}};var _getUrlPicker=(editor,filetype)=>getPickerSetting(editor,filetype).map(picker=>entry=>Future.nu(completer=>{var handler=(value,meta)=>{if(!isString(value)){throw new Error('Expected value to be string');}if(meta!==undefined&&!isObject(meta)){throw new Error('Expected meta to be a object');}var r={value,meta};completer(r);};var meta=_objectSpread({filetype,fieldname:entry.fieldname},Optional.from(entry.meta).getOr({}));picker.call(editor,handler,entry.value,meta);}));var getTextSetting=value=>Optional.from(value).filter(isString).getOrUndefined();var _getLinkInformation=editor=>{if(!useTypeaheadUrls(editor)){return Optional.none();}return Optional.some({targets:LinkTargets.find(editor.getBody()),anchorTop:getTextSetting(getAnchorTop(editor)),anchorBottom:getTextSetting(getAnchorBottom(editor))});};var _getValidationHandler=editor=>Optional.from(getFilePickerValidatorHandler(editor));var UrlInputBackstage=editor=>({getHistory,addToHistory,getLinkInformation:()=>_getLinkInformation(editor),getValidationHandler:()=>_getValidationHandler(editor),getUrlPicker:filetype=>_getUrlPicker(editor,filetype)});var init$6=(lazySinks,editor,lazyAnchorbar,lazyBottomAnchorBar)=>{var contextMenuState=Cell(false);var toolbar=HeaderBackstage(editor);var providers={icons:()=>editor.ui.registry.getAll().icons,menuItems:()=>editor.ui.registry.getAll().menuItems,translate:global$8.translate,isDisabled:()=>editor.mode.isReadOnly()||!editor.ui.isEnabled(),getOption:editor.options.get};var urlinput=UrlInputBackstage(editor);var styles=init$7(editor);var colorinput=ColorInputBackstage(editor);var dialogSettings=DialogBackstage(editor);var isContextMenuOpen=()=>contextMenuState.get();var setContextMenuState=state=>contextMenuState.set(state);var commonBackstage={shared:{providers,anchors:getAnchors(editor,lazyAnchorbar,lazyBottomAnchorBar,toolbar.isPositionedAtTop),header:toolbar},urlinput,styles,colorinput,dialog:dialogSettings,isContextMenuOpen,setContextMenuState};var popupBackstage=_objectSpread(_objectSpread({},commonBackstage),{},{shared:_objectSpread(_objectSpread({},commonBackstage.shared),{},{interpreter:s=>interpretWithoutForm(s,{},popupBackstage),getSink:lazySinks.popup})});var dialogBackstage=_objectSpread(_objectSpread({},commonBackstage),{},{shared:_objectSpread(_objectSpread({},commonBackstage.shared),{},{interpreter:s=>interpretWithoutForm(s,{},dialogBackstage),getSink:lazySinks.dialog})});return{popup:popupBackstage,dialog:dialogBackstage};};var setup$b=(editor,mothership,uiMotherships)=>{var broadcastEvent=(name,evt)=>{each$1([mothership,...uiMotherships],m=>{m.broadcastEvent(name,evt);});};var broadcastOn=(channel,message)=>{each$1([mothership,...uiMotherships],m=>{m.broadcastOn([channel],message);});};var fireDismissPopups=evt=>broadcastOn(dismissPopups(),{target:evt.target});var doc=getDocument();var onTouchstart=bind(doc,'touchstart',fireDismissPopups);var onTouchmove=bind(doc,'touchmove',evt=>broadcastEvent(documentTouchmove(),evt));var onTouchend=bind(doc,'touchend',evt=>broadcastEvent(documentTouchend(),evt));var onMousedown=bind(doc,'mousedown',fireDismissPopups);var onMouseup=bind(doc,'mouseup',evt=>{if(evt.raw.button===0){broadcastOn(mouseReleased(),{target:evt.target});}});var onContentClick=raw=>broadcastOn(dismissPopups(),{target:SugarElement.fromDom(raw.target)});var onContentMouseup=raw=>{if(raw.button===0){broadcastOn(mouseReleased(),{target:SugarElement.fromDom(raw.target)});}};var onContentMousedown=()=>{each$1(editor.editorManager.get(),loopEditor=>{if(editor!==loopEditor){loopEditor.dispatch('DismissPopups',{relatedTarget:editor});}});};var onWindowScroll=evt=>broadcastEvent(windowScroll(),fromRawEvent(evt));var onWindowResize=evt=>{broadcastOn(repositionPopups(),{});broadcastEvent(windowResize(),fromRawEvent(evt));};var dos=getRootNode(SugarElement.fromDom(editor.getElement()));var onElementScroll=capture(dos,'scroll',evt=>{requestAnimationFrame(()=>{var c=editor.getContainer();if(c!==undefined&&c!==null){var optScrollingContext=detectWhenSplitUiMode(editor,mothership.element);var scrollers=optScrollingContext.map(sc=>[sc.element,...sc.others]).getOr([]);if(exists(scrollers,s=>eq(s,evt.target))){editor.dispatch('ElementScroll',{target:evt.target.dom});broadcastEvent(externalElementScroll(),evt);}}});});var onEditorResize=()=>broadcastOn(repositionPopups(),{});var onEditorProgress=evt=>{if(evt.state){broadcastOn(dismissPopups(),{target:SugarElement.fromDom(editor.getContainer())});}};var onDismissPopups=event=>{broadcastOn(dismissPopups(),{target:SugarElement.fromDom(event.relatedTarget.getContainer())});};editor.on('PostRender',()=>{editor.on('click',onContentClick);editor.on('tap',onContentClick);editor.on('mouseup',onContentMouseup);editor.on('mousedown',onContentMousedown);editor.on('ScrollWindow',onWindowScroll);editor.on('ResizeWindow',onWindowResize);editor.on('ResizeEditor',onEditorResize);editor.on('AfterProgressState',onEditorProgress);editor.on('DismissPopups',onDismissPopups);});editor.on('remove',()=>{editor.off('click',onContentClick);editor.off('tap',onContentClick);editor.off('mouseup',onContentMouseup);editor.off('mousedown',onContentMousedown);editor.off('ScrollWindow',onWindowScroll);editor.off('ResizeWindow',onWindowResize);editor.off('ResizeEditor',onEditorResize);editor.off('AfterProgressState',onEditorProgress);editor.off('DismissPopups',onDismissPopups);onMousedown.unbind();onTouchstart.unbind();onTouchmove.unbind();onTouchend.unbind();onMouseup.unbind();onElementScroll.unbind();});editor.on('detach',()=>{each$1([mothership,...uiMotherships],detachSystem);each$1([mothership,...uiMotherships],m=>m.destroy());});};var parts$a=AlloyParts;var partType=PartType;var schema$f=constant$1([defaulted('shell',false),required$1('makeItem'),defaulted('setupItem',noop),SketchBehaviours.field('listBehaviours',[Replacing])]);var customListDetail=()=>({behaviours:derive$1([Replacing.config({})])});var itemsPart=optional({name:'items',overrides:customListDetail});var parts$9=constant$1([itemsPart]);var name=constant$1('CustomList');var factory$f=(detail,components,_spec,_external)=>{var setItems=(list,items)=>{getListContainer(list).fold(()=>{console.error('Custom List was defined to not be a shell, but no item container was specified in components');throw new Error('Custom List was defined to not be a shell, but no item container was specified in components');},container=>{var itemComps=Replacing.contents(container);var numListsRequired=items.length;var numListsToAdd=numListsRequired-itemComps.length;var itemsToAdd=numListsToAdd>0?range$2(numListsToAdd,()=>detail.makeItem()):[];var itemsToRemove=itemComps.slice(numListsRequired);each$1(itemsToRemove,item=>Replacing.remove(container,item));each$1(itemsToAdd,item=>Replacing.append(container,item));var builtLists=Replacing.contents(container);each$1(builtLists,(item,i)=>{detail.setupItem(list,item,items[i],i);});});};var extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components};var getListContainer=component=>detail.shell?Optional.some(component):getPart(component,detail,'items');return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.listBehaviours,extra.behaviours),apis:{setItems}};};var CustomList=composite({name:name(),configFields:schema$f(),partFields:parts$9(),factory:factory$f,apis:{setItems:(apis,list,items)=>{apis.setItems(list,items);}}});var schema$e=constant$1([required$1('dom'),defaulted('shell',true),field('toolbarBehaviours',[Replacing])]);var enhanceGroups=()=>({behaviours:derive$1([Replacing.config({})])});var parts$8=constant$1([optional({name:'groups',overrides:enhanceGroups})]);var factory$e=(detail,components,_spec,_externals)=>{var setGroups=(toolbar,groups)=>{getGroupContainer(toolbar).fold(()=>{console.error('Toolbar was defined to not be a shell, but no groups container was specified in components');throw new Error('Toolbar was defined to not be a shell, but no groups container was specified in components');},container=>{Replacing.set(container,groups);});};var getGroupContainer=component=>detail.shell?Optional.some(component):getPart(component,detail,'groups');var extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.toolbarBehaviours,extra.behaviours),apis:{setGroups,refresh:noop},domModification:{attributes:{role:'group'}}};};var Toolbar=composite({name:'Toolbar',configFields:schema$e(),partFields:parts$8(),factory:factory$e,apis:{setGroups:(apis,toolbar,groups)=>{apis.setGroups(toolbar,groups);}}});var setup$a=noop;var isDocked$2=never;var getBehaviours$1=constant$1([]);var StaticHeader=/*#__PURE__*/Object.freeze({__proto__:null,setup:setup$a,isDocked:isDocked$2,getBehaviours:getBehaviours$1});var getOffsetParent=element=>{var isFixed=is$1(getRaw(element,'position'),'fixed');var offsetParent$1=isFixed?Optional.none():offsetParent(element);return offsetParent$1.orThunk(()=>{var marker=SugarElement.fromTag('span');return parent(element).bind(parent=>{append$2(parent,marker);var offsetParent$1=offsetParent(marker);remove$5(marker);return offsetParent$1;});});};var getOrigin=element=>getOffsetParent(element).map(absolute$3).getOrThunk(()=>SugarPosition(0,0));var appear=(component,contextualInfo)=>{var elem=component.element;add$2(elem,contextualInfo.transitionClass);remove$2(elem,contextualInfo.fadeOutClass);add$2(elem,contextualInfo.fadeInClass);contextualInfo.onShow(component);};var disappear=(component,contextualInfo)=>{var elem=component.element;add$2(elem,contextualInfo.transitionClass);remove$2(elem,contextualInfo.fadeInClass);add$2(elem,contextualInfo.fadeOutClass);contextualInfo.onHide(component);};var isPartiallyVisible=(box,bounds)=>box.y<bounds.bottom&&box.bottom>bounds.y;var isTopCompletelyVisible=(box,bounds)=>box.y>=bounds.y;var isBottomCompletelyVisible=(box,bounds)=>box.bottom<=bounds.bottom;var forceTopPosition=(winBox,leftX,viewport)=>({location:'top',leftX,topY:viewport.bounds.y-winBox.y});var forceBottomPosition=(winBox,leftX,viewport)=>({location:'bottom',leftX,bottomY:winBox.bottom-viewport.bounds.bottom});var getDockedLeftPosition=bounds=>{return bounds.box.x-bounds.win.x;};var tryDockingPosition=(modes,bounds,viewport)=>{var winBox=bounds.win;var box=bounds.box;var leftX=getDockedLeftPosition(bounds);return findMap(modes,mode=>{switch(mode){case'bottom':return!isBottomCompletelyVisible(box,viewport.bounds)?Optional.some(forceBottomPosition(winBox,leftX,viewport)):Optional.none();case'top':return!isTopCompletelyVisible(box,viewport.bounds)?Optional.some(forceTopPosition(winBox,leftX,viewport)):Optional.none();default:return Optional.none();}}).getOr({location:'no-dock'});};var isVisibleForModes=(modes,box,viewport)=>forall(modes,mode=>{switch(mode){case'bottom':return isBottomCompletelyVisible(box,viewport.bounds);case'top':return isTopCompletelyVisible(box,viewport.bounds);}});var getXYForRestoring=(pos,viewport)=>{var priorY=viewport.optScrollEnv.fold(constant$1(pos.bounds.y),scrollEnv=>scrollEnv.scrollElmTop+(pos.bounds.y-scrollEnv.currentScrollTop));return SugarPosition(pos.bounds.x,priorY);};var getXYForSaving=(box,viewport)=>{var priorY=viewport.optScrollEnv.fold(constant$1(box.y),scrollEnv=>box.y+scrollEnv.currentScrollTop-scrollEnv.scrollElmTop);return SugarPosition(box.x,priorY);};var getPrior=(elem,viewport,state)=>state.getInitialPos().map(pos=>{var xy=getXYForRestoring(pos,viewport);return{box:bounds(xy.left,xy.top,get$c(elem),get$d(elem)),location:pos.location};});var storePrior=(elem,box,viewport,state,decision)=>{var xy=getXYForSaving(box,viewport);var bounds$1=bounds(xy.left,xy.top,box.width,box.height);state.setInitialPos({style:getAllRaw(elem),position:get$e(elem,'position')||'static',bounds:bounds$1,location:decision.location});};var storePriorIfNone=(elem,box,viewport,state,decision)=>{state.getInitialPos().fold(()=>storePrior(elem,box,viewport,state,decision),()=>noop);};var revertToOriginal=(elem,box,state)=>state.getInitialPos().bind(position=>{var _a;state.clearInitialPos();switch(position.position){case'static':return Optional.some({morph:'static'});case'absolute':var _offsetParent=getOffsetParent(elem).getOr(body());var offsetBox=box$1(_offsetParent);var scrollDelta=(_a=_offsetParent.dom.scrollTop)!==null&&_a!==void 0?_a:0;return Optional.some({morph:'absolute',positionCss:NuPositionCss('absolute',get$g(position.style,'left').map(_left=>box.x-offsetBox.x),get$g(position.style,'top').map(_top=>box.y-offsetBox.y+scrollDelta),get$g(position.style,'right').map(_right=>offsetBox.right-box.right),get$g(position.style,'bottom').map(_bottom=>offsetBox.bottom-box.bottom))});default:return Optional.none();}});var tryMorphToOriginal=(elem,viewport,state)=>getPrior(elem,viewport,state).filter(_ref12=>{var{box}=_ref12;return isVisibleForModes(state.getModes(),box,viewport);}).bind(_ref13=>{var{box}=_ref13;return revertToOriginal(elem,box,state);});var tryDecisionToFixedMorph=decision=>{switch(decision.location){case'top':{return Optional.some({morph:'fixed',positionCss:NuPositionCss('fixed',Optional.some(decision.leftX),Optional.some(decision.topY),Optional.none(),Optional.none())});}case'bottom':{return Optional.some({morph:'fixed',positionCss:NuPositionCss('fixed',Optional.some(decision.leftX),Optional.none(),Optional.none(),Optional.some(decision.bottomY))});}default:return Optional.none();}};var tryMorphToFixed=(elem,viewport,state)=>{var box=box$1(elem);var winBox=win();var decision=tryDockingPosition(state.getModes(),{win:winBox,box},viewport);if(decision.location==='top'||decision.location==='bottom'){storePrior(elem,box,viewport,state,decision);return tryDecisionToFixedMorph(decision);}else{return Optional.none();}};var tryMorphToOriginalOrUpdateFixed=(elem,viewport,state)=>{return tryMorphToOriginal(elem,viewport,state).orThunk(()=>{return viewport.optScrollEnv.bind(_=>getPrior(elem,viewport,state)).bind(_ref14=>{var{box,location}=_ref14;var winBox=win();var leftX=getDockedLeftPosition({win:winBox,box});var decision=location==='top'?forceTopPosition(winBox,leftX,viewport):forceBottomPosition(winBox,leftX,viewport);return tryDecisionToFixedMorph(decision);});});};var tryMorph=(component,viewport,state)=>{var elem=component.element;var isDocked=is$1(getRaw(elem,'position'),'fixed');return isDocked?tryMorphToOriginalOrUpdateFixed(elem,viewport,state):tryMorphToFixed(elem,viewport,state);};var calculateMorphToOriginal=(component,viewport,state)=>{var elem=component.element;return getPrior(elem,viewport,state).bind(_ref15=>{var{box}=_ref15;return revertToOriginal(elem,box,state);});};var forceDockWith=(elem,viewport,state,getDecision)=>{var box=box$1(elem);var winBox=win();var leftX=getDockedLeftPosition({win:winBox,box});var decision=getDecision(winBox,leftX,viewport);if(decision.location==='bottom'||decision.location==='top'){storePriorIfNone(elem,box,viewport,state,decision);return tryDecisionToFixedMorph(decision);}else{return Optional.none();}};var morphToStatic=(component,config,state)=>{state.setDocked(false);each$1(['left','right','top','bottom','position'],prop=>remove$6(component.element,prop));config.onUndocked(component);};var morphToCoord=(component,config,state,position)=>{var isDocked=position.position==='fixed';state.setDocked(isDocked);applyPositionCss(component.element,position);var method=isDocked?config.onDocked:config.onUndocked;method(component);};var updateVisibility=function updateVisibility(component,config,state,viewport){var morphToDocked=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;config.contextual.each(contextInfo=>{contextInfo.lazyContext(component).each(box=>{var isVisible=isPartiallyVisible(box,viewport.bounds);if(isVisible!==state.isVisible()){state.setVisible(isVisible);if(morphToDocked&&!isVisible){add$1(component.element,[contextInfo.fadeOutClass]);contextInfo.onHide(component);}else{var method=isVisible?appear:disappear;method(component,contextInfo);}}});});};var applyFixedMorph=(component,config,state,viewport,morph)=>{updateVisibility(component,config,state,viewport,true);morphToCoord(component,config,state,morph.positionCss);};var applyMorph=(component,config,state,viewport,morph)=>{switch(morph.morph){case'static':{return morphToStatic(component,config,state);}case'absolute':{return morphToCoord(component,config,state,morph.positionCss);}case'fixed':{return applyFixedMorph(component,config,state,viewport,morph);}}};var refreshInternal=(component,config,state)=>{var viewport=config.lazyViewport(component);updateVisibility(component,config,state,viewport);tryMorph(component,viewport,state).each(morph=>{applyMorph(component,config,state,viewport,morph);});};var resetInternal=(component,config,state)=>{var elem=component.element;state.setDocked(false);var viewport=config.lazyViewport(component);calculateMorphToOriginal(component,viewport,state).each(staticOrAbsoluteMorph=>{switch(staticOrAbsoluteMorph.morph){case'static':{morphToStatic(component,config,state);break;}case'absolute':{morphToCoord(component,config,state,staticOrAbsoluteMorph.positionCss);break;}}});state.setVisible(true);config.contextual.each(contextInfo=>{remove$1(elem,[contextInfo.fadeInClass,contextInfo.fadeOutClass,contextInfo.transitionClass]);contextInfo.onShow(component);});refresh$3(component,config,state);};var refresh$3=(component,config,state)=>{if(component.getSystem().isConnected()){refreshInternal(component,config,state);}};var reset=(component,config,state)=>{if(state.isDocked()){resetInternal(component,config,state);}};var forceDockWithDecision=getDecision=>(component,config,state)=>{var viewport=config.lazyViewport(component);var optMorph=forceDockWith(component.element,viewport,state,getDecision);optMorph.each(morph=>{applyFixedMorph(component,config,state,viewport,morph);});};var forceDockToTop=forceDockWithDecision(forceTopPosition);var forceDockToBottom=forceDockWithDecision(forceBottomPosition);var isDocked$1=(component,config,state)=>state.isDocked();var setModes=(component,config,state,modes)=>state.setModes(modes);var getModes=(component,config,state)=>state.getModes();var DockingApis=/*#__PURE__*/Object.freeze({__proto__:null,refresh:refresh$3,reset:reset,isDocked:isDocked$1,getModes:getModes,setModes:setModes,forceDockToTop:forceDockToTop,forceDockToBottom:forceDockToBottom});var events$4=(dockInfo,dockState)=>derive$2([runOnSource(transitionend(),(component,simulatedEvent)=>{dockInfo.contextual.each(contextInfo=>{if(has(component.element,contextInfo.transitionClass)){remove$1(component.element,[contextInfo.transitionClass,contextInfo.fadeInClass]);var notify=dockState.isVisible()?contextInfo.onShown:contextInfo.onHidden;notify(component);}simulatedEvent.stop();});}),run$1(windowScroll(),(component,_)=>{refresh$3(component,dockInfo,dockState);}),run$1(externalElementScroll(),(component,_)=>{refresh$3(component,dockInfo,dockState);}),run$1(windowResize(),(component,_)=>{reset(component,dockInfo,dockState);})]);var ActiveDocking=/*#__PURE__*/Object.freeze({__proto__:null,events:events$4});var DockingSchema=[optionObjOf('contextual',[requiredString('fadeInClass'),requiredString('fadeOutClass'),requiredString('transitionClass'),requiredFunction('lazyContext'),onHandler('onShow'),onHandler('onShown'),onHandler('onHide'),onHandler('onHidden')]),defaultedFunction('lazyViewport',()=>({bounds:win(),optScrollEnv:Optional.none()})),defaultedArrayOf('modes',['top','bottom'],string),onHandler('onDocked'),onHandler('onUndocked')];var init$5=spec=>{var docked=Cell(false);var visible=Cell(true);var initialBounds=value$2();var modes=Cell(spec.modes);var readState=()=>\"docked:  \".concat(docked.get(),\", visible: \").concat(visible.get(),\", modes: \").concat(modes.get().join(','));return nu$8({isDocked:docked.get,setDocked:docked.set,getInitialPos:initialBounds.get,setInitialPos:initialBounds.set,clearInitialPos:initialBounds.clear,isVisible:visible.get,setVisible:visible.set,getModes:modes.get,setModes:modes.set,readState});};var DockingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$5});var Docking=create$4({fields:DockingSchema,name:'docking',active:ActiveDocking,apis:DockingApis,state:DockingState});var toolbarHeightChange=constant$1(generate$6('toolbar-height-change'));var visibility={fadeInClass:'tox-editor-dock-fadein',fadeOutClass:'tox-editor-dock-fadeout',transitionClass:'tox-editor-dock-transition'};var editorStickyOnClass='tox-tinymce--toolbar-sticky-on';var editorStickyOffClass='tox-tinymce--toolbar-sticky-off';var scrollFromBehindHeader=(e,containerHeader)=>{var doc=owner$4(containerHeader);var win=defaultView(containerHeader);var viewHeight=win.dom.innerHeight;var scrollPos=get$b(doc);var markerElement=SugarElement.fromDom(e.elm);var markerPos=absolute$2(markerElement);var markerHeight=get$d(markerElement);var markerTop=markerPos.y;var markerBottom=markerTop+markerHeight;var editorHeaderPos=absolute$3(containerHeader);var editorHeaderHeight=get$d(containerHeader);var editorHeaderTop=editorHeaderPos.top;var editorHeaderBottom=editorHeaderTop+editorHeaderHeight;var editorHeaderDockedAtTop=Math.abs(editorHeaderTop-scrollPos.top)<2;var editorHeaderDockedAtBottom=Math.abs(editorHeaderBottom-(scrollPos.top+viewHeight))<2;if(editorHeaderDockedAtTop&&markerTop<editorHeaderBottom){to(scrollPos.left,markerTop-editorHeaderHeight,doc);}else if(editorHeaderDockedAtBottom&&markerBottom>editorHeaderTop){var y=markerTop-viewHeight+markerHeight+editorHeaderHeight;to(scrollPos.left,y,doc);}};var isDockedMode=(header,mode)=>contains$2(Docking.getModes(header),mode);var updateIframeContentFlow=header=>{var getOccupiedHeight=elm=>getOuter$2(elm)+(parseInt(get$e(elm,'margin-top'),10)||0)+(parseInt(get$e(elm,'margin-bottom'),10)||0);var elm=header.element;parentElement(elm).each(parentElem=>{var padding='padding-'+Docking.getModes(header)[0];if(Docking.isDocked(header)){var parentWidth=get$c(parentElem);set$8(elm,'width',parentWidth+'px');set$8(parentElem,padding,getOccupiedHeight(elm)+'px');}else{remove$6(elm,'width');remove$6(parentElem,padding);}});};var updateSinkVisibility=(sinkElem,visible)=>{if(visible){remove$2(sinkElem,visibility.fadeOutClass);add$1(sinkElem,[visibility.transitionClass,visibility.fadeInClass]);}else{remove$2(sinkElem,visibility.fadeInClass);add$1(sinkElem,[visibility.fadeOutClass,visibility.transitionClass]);}};var updateEditorClasses=(editor,docked)=>{var editorContainer=SugarElement.fromDom(editor.getContainer());if(docked){add$2(editorContainer,editorStickyOnClass);remove$2(editorContainer,editorStickyOffClass);}else{add$2(editorContainer,editorStickyOffClass);remove$2(editorContainer,editorStickyOnClass);}};var restoreFocus=(headerElem,focusedElem)=>{var ownerDoc=owner$4(focusedElem);active$1(ownerDoc).filter(activeElm=>!eq(focusedElem,activeElm)).filter(activeElm=>eq(activeElm,SugarElement.fromDom(ownerDoc.dom.body))||contains(headerElem,activeElm)).each(()=>focus$3(focusedElem));};var findFocusedElem=(rootElm,lazySink)=>search(rootElm).orThunk(()=>lazySink().toOptional().bind(sink=>search(sink.element)));var setup$9=(editor,sharedBackstage,lazyHeader)=>{if(!editor.inline){if(!sharedBackstage.header.isPositionedAtTop()){editor.on('ResizeEditor',()=>{lazyHeader().each(Docking.reset);});}editor.on('ResizeWindow ResizeEditor',()=>{lazyHeader().each(updateIframeContentFlow);});editor.on('SkinLoaded',()=>{lazyHeader().each(comp=>{Docking.isDocked(comp)?Docking.reset(comp):Docking.refresh(comp);});});editor.on('FullscreenStateChanged',()=>{lazyHeader().each(Docking.reset);});}editor.on('AfterScrollIntoView',e=>{lazyHeader().each(header=>{Docking.refresh(header);var headerElem=header.element;if(isVisible(headerElem)){scrollFromBehindHeader(e,headerElem);}});});editor.on('PostRender',()=>{updateEditorClasses(editor,false);});};var isDocked=lazyHeader=>lazyHeader().map(Docking.isDocked).getOr(false);var getIframeBehaviours=()=>[Receiving.config({channels:{[toolbarHeightChange()]:{onReceive:updateIframeContentFlow}}})];var getBehaviours=(editor,sharedBackstage)=>{var focusedElm=value$2();var lazySink=sharedBackstage.getSink;var runOnSinkElement=f=>{lazySink().each(sink=>f(sink.element));};var onDockingSwitch=comp=>{if(!editor.inline){updateIframeContentFlow(comp);}updateEditorClasses(editor,Docking.isDocked(comp));comp.getSystem().broadcastOn([repositionPopups()],{});lazySink().each(sink=>sink.getSystem().broadcastOn([repositionPopups()],{}));};var additionalBehaviours=editor.inline?[]:getIframeBehaviours();return[Focusing.config({}),Docking.config({contextual:_objectSpread({lazyContext:comp=>{var headerHeight=getOuter$2(comp.element);var container=editor.inline?editor.getContentAreaContainer():editor.getContainer();return Optional.from(container).map(c=>{var box=box$1(SugarElement.fromDom(c));var optScrollingContext=detectWhenSplitUiMode(editor,comp.element);return optScrollingContext.fold(()=>{var boxHeight=box.height-headerHeight;var topBound=box.y+(isDockedMode(comp,'top')?0:headerHeight);return bounds(box.x,topBound,box.width,boxHeight);},scrollEnv=>{var constrainedBounds=constrain(box,getBoundsFrom(scrollEnv));var constrainedBoundsY=isDockedMode(comp,'top')?constrainedBounds.y:constrainedBounds.y+headerHeight;return bounds(constrainedBounds.x,constrainedBoundsY,constrainedBounds.width,constrainedBounds.height-headerHeight);});});},onShow:()=>{runOnSinkElement(elem=>updateSinkVisibility(elem,true));},onShown:comp=>{runOnSinkElement(elem=>remove$1(elem,[visibility.transitionClass,visibility.fadeInClass]));focusedElm.get().each(elem=>{restoreFocus(comp.element,elem);focusedElm.clear();});},onHide:comp=>{findFocusedElem(comp.element,lazySink).fold(focusedElm.clear,focusedElm.set);runOnSinkElement(elem=>updateSinkVisibility(elem,false));},onHidden:()=>{runOnSinkElement(elem=>remove$1(elem,[visibility.transitionClass]));}},visibility),lazyViewport:comp=>{var optScrollingContext=detectWhenSplitUiMode(editor,comp.element);return optScrollingContext.fold(()=>{var boundsWithoutOffset=win();var offset=getStickyToolbarOffset(editor);var top=boundsWithoutOffset.y+(isDockedMode(comp,'top')?offset:0);var height=boundsWithoutOffset.height-(isDockedMode(comp,'bottom')?offset:0);return{bounds:bounds(boundsWithoutOffset.x,top,boundsWithoutOffset.width,height),optScrollEnv:Optional.none()};},sc=>{var combinedBounds=getBoundsFrom(sc);return{bounds:combinedBounds,optScrollEnv:Optional.some({currentScrollTop:sc.element.dom.scrollTop,scrollElmTop:absolute$3(sc.element).top})};});},modes:[sharedBackstage.header.getDockingMode()],onDocked:onDockingSwitch,onUndocked:onDockingSwitch}),...additionalBehaviours];};var StickyHeader=/*#__PURE__*/Object.freeze({__proto__:null,setup:setup$9,isDocked:isDocked,getBehaviours:getBehaviours});var renderHeader=spec=>{var editor=spec.editor;var getBehaviours$2=spec.sticky?getBehaviours:getBehaviours$1;return{uid:spec.uid,dom:spec.dom,components:spec.components,behaviours:derive$1(getBehaviours$2(editor,spec.sharedBackstage))};};var groupToolbarButtonSchema=objOf([type,requiredOf('items',oneOf([arrOfObj([name$1,requiredArrayOf('items',string)]),string]))].concat(baseToolbarButtonFields));var createGroupToolbarButton=spec=>asRaw('GroupToolbarButton',groupToolbarButtonSchema,spec);var baseMenuButtonFields=[optionString('text'),optionString('tooltip'),optionString('icon'),defaultedOf('search',false,oneOf([boolean,objOf([optionString('placeholder')])],x=>{if(isBoolean(x)){return x?Optional.some({placeholder:Optional.none()}):Optional.none();}else{return Optional.some(x);}})),requiredFunction('fetch'),defaultedFunction('onSetup',()=>noop)];var MenuButtonSchema=objOf([type,...baseMenuButtonFields]);var createMenuButton=spec=>asRaw('menubutton',MenuButtonSchema,spec);var splitButtonSchema=objOf([type,optionalTooltip,optionalIcon,optionalText,optionalSelect,fetch$1,onSetup,defaultedStringEnum('presets','normal',['normal','color','listpreview']),defaultedColumns(1),onAction,onItemAction]);var createSplitButton=spec=>asRaw('SplitButton',splitButtonSchema,spec);var factory$d=(detail,spec)=>{var setMenus=(comp,menus)=>{var newMenus=map$2(menus,m=>{var buttonSpec={type:'menubutton',text:m.text,fetch:callback=>{callback(m.getItems());}};var internal=createMenuButton(buttonSpec).mapError(errInfo=>formatError(errInfo)).getOrDie();return renderMenuButton(internal,'tox-mbtn',spec.backstage,Optional.some('menuitem'));});Replacing.set(comp,newMenus);};var apis={focus:Keying.focusIn,setMenus};return{uid:detail.uid,dom:detail.dom,components:[],behaviours:derive$1([Replacing.config({}),config('menubar-events',[runOnAttached(component=>{detail.onSetup(component);}),run$1(mouseover(),(comp,se)=>{descendant(comp.element,'.'+'tox-mbtn--active').each(activeButton=>{closest$1(se.event.target,'.'+'tox-mbtn').each(hoveredButton=>{if(!eq(activeButton,hoveredButton)){comp.getSystem().getByDom(activeButton).each(activeComp=>{comp.getSystem().getByDom(hoveredButton).each(hoveredComp=>{Dropdown.expand(hoveredComp);Dropdown.close(activeComp);Focusing.focus(hoveredComp);});});}});});}),run$1(focusShifted(),(comp,se)=>{se.event.prevFocus.bind(prev=>comp.getSystem().getByDom(prev).toOptional()).each(prev=>{se.event.newFocus.bind(nu=>comp.getSystem().getByDom(nu).toOptional()).each(nu=>{if(Dropdown.isOpen(prev)){Dropdown.expand(nu);Dropdown.close(prev);}});});})]),Keying.config({mode:'flow',selector:'.'+'tox-mbtn',onEscape:comp=>{detail.onEscape(comp);return Optional.some(true);}}),Tabstopping.config({})]),apis,domModification:{attributes:{role:'menubar'}}};};var SilverMenubar=single({factory:factory$d,name:'silver.Menubar',configFields:[required$1('dom'),required$1('uid'),required$1('onEscape'),required$1('backstage'),defaulted('onSetup',noop)],apis:{focus:(apis,comp)=>{apis.focus(comp);},setMenus:(apis,comp,menus)=>{apis.setMenus(comp,menus);}}});var promotionMessage='\\u26A1\\ufe0fUpgrade';var promotionLink='https://www.tiny.cloud/tinymce-self-hosted-premium-features/?utm_source=TinyMCE&utm_medium=SPAP&utm_campaign=SPAP&utm_id=editorreferral';var renderPromotion=spec=>{return{uid:spec.uid,dom:spec.dom,components:[{dom:{tag:'a',attributes:{'href':promotionLink,'rel':'noopener','target':'_blank','aria-hidden':'true'},classes:['tox-promotion-link'],innerHtml:promotionMessage}}]};};var owner='container';var schema$d=[field('slotBehaviours',[])];var getPartName=name=>'<alloy.field.'+name+'>';var sketch=sSpec=>{var parts=(()=>{var record=[];var slot=(name,config)=>{record.push(name);return generateOne$1(owner,getPartName(name),config);};return{slot,record:constant$1(record)};})();var spec=sSpec(parts);var partNames=parts.record();var fieldParts=map$2(partNames,n=>required({name:n,pname:getPartName(n)}));return composite$1(owner,schema$d,fieldParts,make$1,spec);};var make$1=(detail,components)=>{var getSlotNames=_=>getAllPartNames(detail);var getSlot=(container,key)=>getPart(container,detail,key);var onSlot=(f,def)=>(container,key)=>getPart(container,detail,key).map(slot=>f(slot,key)).getOr(def);var onSlots=f=>(container,keys)=>{each$1(keys,key=>f(container,key));};var doShowing=(comp,_key)=>get$f(comp.element,'aria-hidden')!=='true';var doShow=(comp,key)=>{if(!doShowing(comp)){var _element=comp.element;remove$6(_element,'display');remove$7(_element,'aria-hidden');emitWith(comp,slotVisibility(),{name:key,visible:true});}};var doHide=(comp,key)=>{if(doShowing(comp)){var _element2=comp.element;set$8(_element2,'display','none');set$9(_element2,'aria-hidden','true');emitWith(comp,slotVisibility(),{name:key,visible:false});}};var isShowing=onSlot(doShowing,false);var hideSlot=onSlot(doHide);var hideSlots=onSlots(hideSlot);var hideAllSlots=container=>hideSlots(container,getSlotNames());var showSlot=onSlot(doShow);var apis={getSlotNames,getSlot,isShowing,hideSlot,hideAllSlots,showSlot};return{uid:detail.uid,dom:detail.dom,components,behaviours:get$3(detail.slotBehaviours),apis};};var slotApis=map$1({getSlotNames:(apis,c)=>apis.getSlotNames(c),getSlot:(apis,c,key)=>apis.getSlot(c,key),isShowing:(apis,c,key)=>apis.isShowing(c,key),hideSlot:(apis,c,key)=>apis.hideSlot(c,key),hideAllSlots:(apis,c)=>apis.hideAllSlots(c),showSlot:(apis,c,key)=>apis.showSlot(c,key)},value=>makeApi(value));var SlotContainer=_objectSpread(_objectSpread({},slotApis),{sketch});var sidebarSchema=objOf([optionalIcon,optionalTooltip,defaultedFunction('onShow',noop),defaultedFunction('onHide',noop),onSetup]);var createSidebar=spec=>asRaw('sidebar',sidebarSchema,spec);var setup$8=editor=>{var{sidebars}=editor.ui.registry.getAll();each$1(keys(sidebars),name=>{var spec=sidebars[name];var isActive=()=>is$1(Optional.from(editor.queryCommandValue('ToggleSidebar')),name);editor.ui.registry.addToggleButton(name,{icon:spec.icon,tooltip:spec.tooltip,onAction:buttonApi=>{editor.execCommand('ToggleSidebar',false,name);buttonApi.setActive(isActive());},onSetup:buttonApi=>{buttonApi.setActive(isActive());var handleToggle=()=>buttonApi.setActive(isActive());editor.on('ToggleSidebar',handleToggle);return()=>{editor.off('ToggleSidebar',handleToggle);};}});});};var getApi=comp=>({element:()=>comp.element.dom});var makePanels=(parts,panelConfigs)=>{var specs=map$2(keys(panelConfigs),name=>{var spec=panelConfigs[name];var bridged=getOrDie(createSidebar(spec));return{name,getApi,onSetup:bridged.onSetup,onShow:bridged.onShow,onHide:bridged.onHide};});return map$2(specs,spec=>{var editorOffCell=Cell(noop);return parts.slot(spec.name,{dom:{tag:'div',classes:['tox-sidebar__pane']},behaviours:SimpleBehaviours.unnamedEvents([onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell),run$1(slotVisibility(),(sidepanel,se)=>{var data=se.event;var optSidePanelSpec=find$5(specs,config=>config.name===data.name);optSidePanelSpec.each(sidePanelSpec=>{var handler=data.visible?sidePanelSpec.onShow:sidePanelSpec.onHide;handler(sidePanelSpec.getApi(sidepanel));});})])});});};var makeSidebar=panelConfigs=>SlotContainer.sketch(parts=>({dom:{tag:'div',classes:['tox-sidebar__pane-container']},components:makePanels(parts,panelConfigs),slotBehaviours:SimpleBehaviours.unnamedEvents([runOnAttached(slotContainer=>SlotContainer.hideAllSlots(slotContainer))])}));var _setSidebar=(sidebar,panelConfigs,showSidebar)=>{var optSlider=Composing.getCurrent(sidebar);optSlider.each(slider=>{Replacing.set(slider,[makeSidebar(panelConfigs)]);var configKey=showSidebar===null||showSidebar===void 0?void 0:showSidebar.toLowerCase();if(isString(configKey)&&has$2(panelConfigs,configKey)){Composing.getCurrent(slider).each(slotContainer=>{SlotContainer.showSlot(slotContainer,configKey);Sliding.immediateGrow(slider);remove$6(slider.element,'width');updateSidebarRoleOnToggle(sidebar.element,'region');});}});};var updateSidebarRoleOnToggle=(sidebar,sidebarState)=>{set$9(sidebar,'role',sidebarState);};var _toggleSidebar=(sidebar,name)=>{var optSlider=Composing.getCurrent(sidebar);optSlider.each(slider=>{var optSlotContainer=Composing.getCurrent(slider);optSlotContainer.each(slotContainer=>{if(Sliding.hasGrown(slider)){if(SlotContainer.isShowing(slotContainer,name)){Sliding.shrink(slider);updateSidebarRoleOnToggle(sidebar.element,'presentation');}else{SlotContainer.hideAllSlots(slotContainer);SlotContainer.showSlot(slotContainer,name);updateSidebarRoleOnToggle(sidebar.element,'region');}}else{SlotContainer.hideAllSlots(slotContainer);SlotContainer.showSlot(slotContainer,name);Sliding.grow(slider);updateSidebarRoleOnToggle(sidebar.element,'region');}});});};var _whichSidebar=sidebar=>{var optSlider=Composing.getCurrent(sidebar);return optSlider.bind(slider=>{var sidebarOpen=Sliding.isGrowing(slider)||Sliding.hasGrown(slider);if(sidebarOpen){var optSlotContainer=Composing.getCurrent(slider);return optSlotContainer.bind(slotContainer=>find$5(SlotContainer.getSlotNames(slotContainer),name=>SlotContainer.isShowing(slotContainer,name)));}else{return Optional.none();}});};var fixSize=generate$6('FixSizeEvent');var autoSize=generate$6('AutoSizeEvent');var renderSidebar=spec=>({uid:spec.uid,dom:{tag:'div',classes:['tox-sidebar'],attributes:{role:'presentation'}},components:[{dom:{tag:'div',classes:['tox-sidebar__slider']},components:[],behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),Sliding.config({dimension:{property:'width'},closedClass:'tox-sidebar--sliding-closed',openClass:'tox-sidebar--sliding-open',shrinkingClass:'tox-sidebar--sliding-shrinking',growingClass:'tox-sidebar--sliding-growing',onShrunk:slider=>{var optSlotContainer=Composing.getCurrent(slider);optSlotContainer.each(SlotContainer.hideAllSlots);emit(slider,autoSize);},onGrown:slider=>{emit(slider,autoSize);},onStartGrow:slider=>{emitWith(slider,fixSize,{width:getRaw(slider.element,'width').getOr('')});},onStartShrink:slider=>{emitWith(slider,fixSize,{width:get$c(slider.element)+'px'});}}),Replacing.config({}),Composing.config({find:comp=>{var children=Replacing.contents(comp);return head(children);}})])}],behaviours:derive$1([ComposingConfigs.childAt(0),config('sidebar-sliding-events',[run$1(fixSize,(comp,se)=>{set$8(comp.element,'width',se.event.width);}),run$1(autoSize,(comp,_se)=>{remove$6(comp.element,'width');})])])});var block=(component,config,state,getBusySpec)=>{set$9(component.element,'aria-busy',true);var root=config.getRoot(component).getOr(component);var blockerBehaviours=derive$1([Keying.config({mode:'special',onTab:()=>Optional.some(true),onShiftTab:()=>Optional.some(true)}),Focusing.config({})]);var blockSpec=getBusySpec(root,blockerBehaviours);var blocker=root.getSystem().build(blockSpec);Replacing.append(root,premade(blocker));if(blocker.hasConfigured(Keying)&&config.focus){Keying.focusIn(blocker);}if(!state.isBlocked()){config.onBlock(component);}state.blockWith(()=>Replacing.remove(root,blocker));};var unblock=(component,config,state)=>{remove$7(component.element,'aria-busy');if(state.isBlocked()){config.onUnblock(component);}state.clear();};var isBlocked=(component,blockingConfig,blockingState)=>blockingState.isBlocked();var BlockingApis=/*#__PURE__*/Object.freeze({__proto__:null,block:block,unblock:unblock,isBlocked:isBlocked});var BlockingSchema=[defaultedFunction('getRoot',Optional.none),defaultedBoolean('focus',true),onHandler('onBlock'),onHandler('onUnblock')];var init$4=()=>{var blocker=destroyable();var blockWith=destroy=>{blocker.set({destroy});};return nu$8({readState:blocker.isSet,blockWith,clear:blocker.clear,isBlocked:blocker.isSet});};var BlockingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$4});var Blocking=create$4({fields:BlockingSchema,name:'blocking',apis:BlockingApis,state:BlockingState});var getAttrs=elem=>{var attributes=elem.dom.attributes!==undefined?elem.dom.attributes:[];return foldl(attributes,(b,attr)=>{if(attr.name==='class'){return b;}else{return _objectSpread(_objectSpread({},b),{},{[attr.name]:attr.value});}},{});};var getClasses=elem=>Array.prototype.slice.call(elem.dom.classList,0);var fromHtml=html=>{var elem=SugarElement.fromHtml(html);var children$1=children(elem);var attrs=getAttrs(elem);var classes=getClasses(elem);var contents=children$1.length===0?{}:{innerHtml:get$9(elem)};return _objectSpread({tag:name$3(elem),classes,attributes:attrs},contents);};var getBusySpec$1=providerBackstage=>(_root,_behaviours)=>({dom:{tag:'div',attributes:{'aria-label':providerBackstage.translate('Loading...'),'tabindex':'0'},classes:['tox-throbber__busy-spinner']},components:[{dom:fromHtml('<div class=\"tox-spinner\"><div></div><div></div><div></div></div>')}]});var focusBusyComponent=throbber=>Composing.getCurrent(throbber).each(comp=>focus$3(comp.element));var toggleEditorTabIndex=(editor,state)=>{var tabIndexAttr='tabindex';var dataTabIndexAttr=\"data-mce-\".concat(tabIndexAttr);Optional.from(editor.iframeElement).map(SugarElement.fromDom).each(iframe=>{if(state){getOpt(iframe,tabIndexAttr).each(tabIndex=>set$9(iframe,dataTabIndexAttr,tabIndex));set$9(iframe,tabIndexAttr,-1);}else{remove$7(iframe,tabIndexAttr);getOpt(iframe,dataTabIndexAttr).each(tabIndex=>{set$9(iframe,tabIndexAttr,tabIndex);remove$7(iframe,dataTabIndexAttr);});}});};var toggleThrobber=(editor,comp,state,providerBackstage)=>{var element=comp.element;toggleEditorTabIndex(editor,state);if(state){Blocking.block(comp,getBusySpec$1(providerBackstage));remove$6(element,'display');remove$7(element,'aria-hidden');if(editor.hasFocus()){focusBusyComponent(comp);}}else{var throbberFocus=Composing.getCurrent(comp).exists(busyComp=>hasFocus(busyComp.element));Blocking.unblock(comp);set$8(element,'display','none');set$9(element,'aria-hidden','true');if(throbberFocus){editor.focus();}}};var renderThrobber=spec=>({uid:spec.uid,dom:{tag:'div',attributes:{'aria-hidden':'true'},classes:['tox-throbber'],styles:{display:'none'}},behaviours:derive$1([Replacing.config({}),Blocking.config({focus:false}),Composing.config({find:comp=>head(comp.components())})]),components:[]});var isFocusEvent=event=>event.type==='focusin';var isPasteBinTarget=event=>{if(isFocusEvent(event)){var node=event.composed?head(event.composedPath()):Optional.from(event.target);return node.map(SugarElement.fromDom).filter(isElement$1).exists(targetElm=>has(targetElm,'mce-pastebin'));}else{return false;}};var setup$7=(editor,lazyThrobber,sharedBackstage)=>{var throbberState=Cell(false);var timer=value$2();var stealFocus=e=>{if(throbberState.get()&&!isPasteBinTarget(e)){e.preventDefault();focusBusyComponent(lazyThrobber());editor.editorManager.setActive(editor);}};if(!editor.inline){editor.on('PreInit',()=>{editor.dom.bind(editor.getWin(),'focusin',stealFocus);editor.on('BeforeExecCommand',e=>{if(e.command.toLowerCase()==='mcefocus'&&e.value!==true){stealFocus(e);}});});}var toggle=state=>{if(state!==throbberState.get()){throbberState.set(state);toggleThrobber(editor,lazyThrobber(),state,sharedBackstage.providers);fireAfterProgressState(editor,state);}};editor.on('ProgressState',e=>{timer.on(clearTimeout);if(isNumber(e.time)){var timerId=global$9.setEditorTimeout(editor,()=>toggle(e.state),e.time);timer.set(timerId);}else{toggle(e.state);timer.clear();}});};var generate$1=(xs,f)=>{var init={len:0,list:[]};var r=foldl(xs,(b,a)=>{var value=f(a,b.len);return value.fold(constant$1(b),v=>({len:v.finish,list:b.list.concat([v])}));},init);return r.list;};var output=(within,extra,withinWidth)=>({within,extra,withinWidth});var apportion=(units,total,len)=>{var parray=generate$1(units,(unit,current)=>{var width=len(unit);return Optional.some({element:unit,start:current,finish:current+width,width});});var within=filter$2(parray,unit=>unit.finish<=total);var withinWidth=foldr(within,(acc,el)=>acc+el.width,0);var extra=parray.slice(within.length);return{within,extra,withinWidth};};var toUnit=parray=>map$2(parray,unit=>unit.element);var fitLast=(within,extra,withinWidth)=>{var fits=toUnit(within.concat(extra));return output(fits,[],withinWidth);};var overflow=(within,extra,overflower,withinWidth)=>{var fits=toUnit(within).concat([overflower]);return output(fits,toUnit(extra),withinWidth);};var fitAll=(within,extra,withinWidth)=>output(toUnit(within),[],withinWidth);var tryFit=(total,units,len)=>{var divide=apportion(units,total,len);return divide.extra.length===0?Optional.some(divide):Optional.none();};var partition=(total,units,len,overflower)=>{var divide=tryFit(total,units,len).getOrThunk(()=>apportion(units,total-len(overflower),len));var within=divide.within;var extra=divide.extra;var withinWidth=divide.withinWidth;if(extra.length===1&&extra[0].width<=len(overflower)){return fitLast(within,extra,withinWidth);}else if(extra.length>=1){return overflow(within,extra,overflower,withinWidth);}else{return fitAll(within,extra,withinWidth);}};var setGroups$1=(toolbar,storedGroups)=>{var bGroups=map$2(storedGroups,g=>premade(g));Toolbar.setGroups(toolbar,bGroups);};var findFocusedComp=comps=>findMap(comps,comp=>search(comp.element).bind(focusedElm=>comp.getSystem().getByDom(focusedElm).toOptional()));var refresh$2=(toolbar,detail,setOverflow)=>{var builtGroups=detail.builtGroups.get();if(builtGroups.length===0){return;}var primary=getPartOrDie(toolbar,detail,'primary');var overflowGroup=Coupling.getCoupled(toolbar,'overflowGroup');set$8(primary.element,'visibility','hidden');var groups=builtGroups.concat([overflowGroup]);var focusedComp=findFocusedComp(groups);setOverflow([]);setGroups$1(primary,groups);var availableWidth=get$c(primary.element);var overflows=partition(availableWidth,detail.builtGroups.get(),comp=>get$c(comp.element),overflowGroup);if(overflows.extra.length===0){Replacing.remove(primary,overflowGroup);setOverflow([]);}else{setGroups$1(primary,overflows.within);setOverflow(overflows.extra);}remove$6(primary.element,'visibility');reflow(primary.element);focusedComp.each(Focusing.focus);};var schema$c=constant$1([field('splitToolbarBehaviours',[Coupling]),customField('builtGroups',()=>Cell([]))]);var schema$b=constant$1([markers$1(['overflowToggledClass']),optionFunction('getOverflowBounds'),required$1('lazySink'),customField('overflowGroups',()=>Cell([])),onHandler('onOpened'),onHandler('onClosed')].concat(schema$c()));var parts$7=constant$1([required({factory:Toolbar,schema:schema$e(),name:'primary'}),external({schema:schema$e(),name:'overflow'}),external({name:'overflow-button'}),external({name:'overflow-group'})]);var expandable=constant$1((element,available)=>{setMax(element,Math.floor(available));});var schema$a=constant$1([markers$1(['toggledClass']),required$1('lazySink'),requiredFunction('fetch'),optionFunction('getBounds'),optionObjOf('fireDismissalEventInstead',[defaulted('event',dismissRequested())]),schema$y(),onHandler('onToggled')]);var parts$6=constant$1([external({name:'button',overrides:detail=>({dom:{attributes:{'aria-haspopup':'true'}},buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.toggledClass,aria:{mode:'expanded'},toggleOnExecute:false,onToggled:detail.onToggled})])})}),external({factory:Toolbar,schema:schema$e(),name:'toolbar',overrides:detail=>{return{toolbarBehaviours:derive$1([Keying.config({mode:'cyclic',onEscape:comp=>{getPart(comp,detail,'button').each(Focusing.focus);return Optional.none();}})])};}})]);var shouldSkipFocus=value$2();var _toggleWithoutFocusing=(button,externals)=>{shouldSkipFocus.set(true);_toggle(button,externals);shouldSkipFocus.clear();};var _toggle=(button,externals)=>{var toolbarSandbox=Coupling.getCoupled(button,'toolbarSandbox');if(Sandboxing.isOpen(toolbarSandbox)){Sandboxing.close(toolbarSandbox);}else{Sandboxing.open(toolbarSandbox,externals.toolbar());}};var position=(button,toolbar,detail,layouts)=>{var bounds=detail.getBounds.map(bounder=>bounder());var sink=detail.lazySink(button).getOrDie();Positioning.positionWithinBounds(sink,toolbar,{anchor:{type:'hotspot',hotspot:button,layouts,overrides:{maxWidthFunction:expandable()}}},bounds);};var _setGroups=(button,toolbar,detail,layouts,groups)=>{Toolbar.setGroups(toolbar,groups);position(button,toolbar,detail,layouts);Toggling.on(button);};var makeSandbox=(button,spec,detail)=>{var ariaControls=manager();var onOpen=(sandbox,toolbar)=>{var skipFocus=shouldSkipFocus.get().getOr(false);detail.fetch().get(groups=>{_setGroups(button,toolbar,detail,spec.layouts,groups);ariaControls.link(button.element);if(!skipFocus){Keying.focusIn(toolbar);}});};var onClose=()=>{Toggling.off(button);if(!shouldSkipFocus.get().getOr(false)){Focusing.focus(button);}ariaControls.unlink(button.element);};return{dom:{tag:'div',attributes:{id:ariaControls.id}},behaviours:derive$1([Keying.config({mode:'special',onEscape:comp=>{Sandboxing.close(comp);return Optional.some(true);}}),Sandboxing.config({onOpen,onClose,isPartOf:(container,data,queryElem)=>{return isPartOf$1(data,queryElem)||isPartOf$1(button,queryElem);},getAttachPoint:()=>{return detail.lazySink(button).getOrDie();}}),Receiving.config({channels:_objectSpread(_objectSpread({},receivingChannel$1(_objectSpread({isExtraPart:never},detail.fireDismissalEventInstead.map(fe=>({fireEventInstead:{event:fe.event}})).getOr({})))),receivingChannel({doReposition:()=>{Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox')).each(toolbar=>{position(button,toolbar,detail,spec.layouts);});}}))})])};};var factory$c=(detail,components,spec,externals)=>_objectSpread(_objectSpread({},Button.sketch(_objectSpread(_objectSpread({},externals.button()),{},{action:button=>{_toggle(button,externals);},buttonBehaviours:SketchBehaviours.augment({dump:externals.button().buttonBehaviours},[Coupling.config({others:{toolbarSandbox:button=>{return makeSandbox(button,spec,detail);}}})])}))),{},{apis:{setGroups:(button,groups)=>{Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox')).each(toolbar=>{_setGroups(button,toolbar,detail,spec.layouts,groups);});},reposition:button=>{Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox')).each(toolbar=>{position(button,toolbar,detail,spec.layouts);});},toggle:button=>{_toggle(button,externals);},toggleWithoutFocusing:button=>{_toggleWithoutFocusing(button,externals);},getToolbar:button=>{return Sandboxing.getState(Coupling.getCoupled(button,'toolbarSandbox'));},isOpen:button=>{return Sandboxing.isOpen(Coupling.getCoupled(button,'toolbarSandbox'));}}});var FloatingToolbarButton=composite({name:'FloatingToolbarButton',factory:factory$c,configFields:schema$a(),partFields:parts$6(),apis:{setGroups:(apis,button,groups)=>{apis.setGroups(button,groups);},reposition:(apis,button)=>{apis.reposition(button);},toggle:(apis,button)=>{apis.toggle(button);},toggleWithoutFocusing:(apis,button)=>{apis.toggleWithoutFocusing(button);},getToolbar:(apis,button)=>apis.getToolbar(button),isOpen:(apis,button)=>apis.isOpen(button)}});var schema$9=constant$1([required$1('items'),markers$1(['itemSelector']),field('tgroupBehaviours',[Keying])]);var parts$5=constant$1([group({name:'items',unit:'item'})]);var factory$b=(detail,components,_spec,_externals)=>({uid:detail.uid,dom:detail.dom,components,behaviours:augment(detail.tgroupBehaviours,[Keying.config({mode:'flow',selector:detail.markers.itemSelector})]),domModification:{attributes:{role:'toolbar'}}});var ToolbarGroup=composite({name:'ToolbarGroup',configFields:schema$9(),partFields:parts$5(),factory:factory$b});var buildGroups=comps=>map$2(comps,g=>premade(g));var refresh$1=(toolbar,memFloatingToolbarButton,detail)=>{refresh$2(toolbar,detail,overflowGroups=>{detail.overflowGroups.set(overflowGroups);memFloatingToolbarButton.getOpt(toolbar).each(floatingToolbarButton=>{FloatingToolbarButton.setGroups(floatingToolbarButton,buildGroups(overflowGroups));});});};var factory$a=(detail,components,spec,externals)=>{var memFloatingToolbarButton=record(FloatingToolbarButton.sketch({fetch:()=>Future.nu(resolve=>{resolve(buildGroups(detail.overflowGroups.get()));}),layouts:{onLtr:()=>[southwest$2,southeast$2],onRtl:()=>[southeast$2,southwest$2],onBottomLtr:()=>[northwest$2,northeast$2],onBottomRtl:()=>[northeast$2,northwest$2]},getBounds:spec.getOverflowBounds,lazySink:detail.lazySink,fireDismissalEventInstead:{},markers:{toggledClass:detail.markers.overflowToggledClass},parts:{button:externals['overflow-button'](),toolbar:externals.overflow()},onToggled:(comp,state)=>detail[state?'onOpened':'onClosed'](comp)}));return{uid:detail.uid,dom:detail.dom,components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:()=>{return ToolbarGroup.sketch(_objectSpread(_objectSpread({},externals['overflow-group']()),{},{items:[memFloatingToolbarButton.asSpec()]}));}}})]),apis:{setGroups:(toolbar,groups)=>{detail.builtGroups.set(map$2(groups,toolbar.getSystem().build));refresh$1(toolbar,memFloatingToolbarButton,detail);},refresh:toolbar=>refresh$1(toolbar,memFloatingToolbarButton,detail),toggle:toolbar=>{memFloatingToolbarButton.getOpt(toolbar).each(floatingToolbarButton=>{FloatingToolbarButton.toggle(floatingToolbarButton);});},toggleWithoutFocusing:toolbar=>{memFloatingToolbarButton.getOpt(toolbar).each(FloatingToolbarButton.toggleWithoutFocusing);},isOpen:toolbar=>memFloatingToolbarButton.getOpt(toolbar).map(FloatingToolbarButton.isOpen).getOr(false),reposition:toolbar=>{memFloatingToolbarButton.getOpt(toolbar).each(floatingToolbarButton=>{FloatingToolbarButton.reposition(floatingToolbarButton);});},getOverflow:toolbar=>memFloatingToolbarButton.getOpt(toolbar).bind(FloatingToolbarButton.getToolbar)},domModification:{attributes:{role:'group'}}};};var SplitFloatingToolbar=composite({name:'SplitFloatingToolbar',configFields:schema$b(),partFields:parts$7(),factory:factory$a,apis:{setGroups:(apis,toolbar,groups)=>{apis.setGroups(toolbar,groups);},refresh:(apis,toolbar)=>{apis.refresh(toolbar);},reposition:(apis,toolbar)=>{apis.reposition(toolbar);},toggle:(apis,toolbar)=>{apis.toggle(toolbar);},toggleWithoutFocusing:(apis,toolbar)=>{apis.toggle(toolbar);},isOpen:(apis,toolbar)=>apis.isOpen(toolbar),getOverflow:(apis,toolbar)=>apis.getOverflow(toolbar)}});var schema$8=constant$1([markers$1(['closedClass','openClass','shrinkingClass','growingClass','overflowToggledClass']),onHandler('onOpened'),onHandler('onClosed')].concat(schema$c()));var parts$4=constant$1([required({factory:Toolbar,schema:schema$e(),name:'primary'}),required({factory:Toolbar,schema:schema$e(),name:'overflow',overrides:detail=>{return{toolbarBehaviours:derive$1([Sliding.config({dimension:{property:'height'},closedClass:detail.markers.closedClass,openClass:detail.markers.openClass,shrinkingClass:detail.markers.shrinkingClass,growingClass:detail.markers.growingClass,onShrunk:comp=>{getPart(comp,detail,'overflow-button').each(button=>{Toggling.off(button);Focusing.focus(button);});detail.onClosed(comp);},onGrown:comp=>{Keying.focusIn(comp);detail.onOpened(comp);},onStartGrow:comp=>{getPart(comp,detail,'overflow-button').each(Toggling.on);}}),Keying.config({mode:'acyclic',onEscape:comp=>{getPart(comp,detail,'overflow-button').each(Focusing.focus);return Optional.some(true);}})])};}}),external({name:'overflow-button',overrides:detail=>({buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.overflowToggledClass,aria:{mode:'pressed'},toggleOnExecute:false})])})}),external({name:'overflow-group'})]);var _isOpen=(toolbar,detail)=>getPart(toolbar,detail,'overflow').map(Sliding.hasGrown).getOr(false);var toggleToolbar=(toolbar,detail)=>{getPart(toolbar,detail,'overflow-button').bind(()=>getPart(toolbar,detail,'overflow')).each(overf=>{_refresh(toolbar,detail);Sliding.toggleGrow(overf);});};var _refresh=(toolbar,detail)=>{getPart(toolbar,detail,'overflow').each(overflow=>{refresh$2(toolbar,detail,groups=>{var builtGroups=map$2(groups,g=>premade(g));Toolbar.setGroups(overflow,builtGroups);});getPart(toolbar,detail,'overflow-button').each(button=>{if(Sliding.hasGrown(overflow)){Toggling.on(button);}});Sliding.refresh(overflow);});};var factory$9=(detail,components,spec,externals)=>{var toolbarToggleEvent='alloy.toolbar.toggle';var doSetGroups=(toolbar,groups)=>{var built=map$2(groups,toolbar.getSystem().build);detail.builtGroups.set(built);};return{uid:detail.uid,dom:detail.dom,components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:toolbar=>{return ToolbarGroup.sketch(_objectSpread(_objectSpread({},externals['overflow-group']()),{},{items:[Button.sketch(_objectSpread(_objectSpread({},externals['overflow-button']()),{},{action:_button=>{emit(toolbar,toolbarToggleEvent);}}))]}));}}}),config('toolbar-toggle-events',[run$1(toolbarToggleEvent,toolbar=>{toggleToolbar(toolbar,detail);})])]),apis:{setGroups:(toolbar,groups)=>{doSetGroups(toolbar,groups);_refresh(toolbar,detail);},refresh:toolbar=>_refresh(toolbar,detail),toggle:toolbar=>toggleToolbar(toolbar,detail),isOpen:toolbar=>_isOpen(toolbar,detail)},domModification:{attributes:{role:'group'}}};};var SplitSlidingToolbar=composite({name:'SplitSlidingToolbar',configFields:schema$8(),partFields:parts$4(),factory:factory$9,apis:{setGroups:(apis,toolbar,groups)=>{apis.setGroups(toolbar,groups);},refresh:(apis,toolbar)=>{apis.refresh(toolbar);},toggle:(apis,toolbar)=>{apis.toggle(toolbar);},isOpen:(apis,toolbar)=>apis.isOpen(toolbar)}});var renderToolbarGroupCommon=toolbarGroup=>{var attributes=toolbarGroup.title.fold(()=>({}),title=>({attributes:{title}}));return{dom:_objectSpread({tag:'div',classes:['tox-toolbar__group']},attributes),components:[ToolbarGroup.parts.items({})],items:toolbarGroup.items,markers:{itemSelector:'*:not(.tox-split-button) > .tox-tbtn:not([disabled]), '+'.tox-split-button:not([disabled]), '+'.tox-toolbar-nav-js:not([disabled]), '+'.tox-number-input:not([disabled])'},tgroupBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])};};var renderToolbarGroup=toolbarGroup=>ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup));var getToolbarBehaviours=(toolbarSpec,modeName)=>{var onAttached=runOnAttached(component=>{var groups=map$2(toolbarSpec.initGroups,renderToolbarGroup);Toolbar.setGroups(component,groups);});return derive$1([DisablingConfigs.toolbarButton(toolbarSpec.providers.isDisabled),receivingConfig(),Keying.config({mode:modeName,onEscape:toolbarSpec.onEscape,selector:'.tox-toolbar__group'}),config('toolbar-events',[onAttached])]);};var renderMoreToolbarCommon=toolbarSpec=>{var modeName=toolbarSpec.cyclicKeying?'cyclic':'acyclic';return{uid:toolbarSpec.uid,dom:{tag:'div',classes:['tox-toolbar-overlord']},parts:{'overflow-group':renderToolbarGroupCommon({title:Optional.none(),items:[]}),'overflow-button':renderIconButtonSpec({name:'more',icon:Optional.some('more-drawer'),enabled:true,tooltip:Optional.some('Reveal or hide additional toolbar items'),primary:false,buttonType:Optional.none(),borderless:false},Optional.none(),toolbarSpec.providers)},splitToolbarBehaviours:getToolbarBehaviours(toolbarSpec,modeName)};};var renderFloatingMoreToolbar=toolbarSpec=>{var baseSpec=renderMoreToolbarCommon(toolbarSpec);var overflowXOffset=4;var primary=SplitFloatingToolbar.parts.primary({dom:{tag:'div',classes:['tox-toolbar__primary']}});return SplitFloatingToolbar.sketch(_objectSpread(_objectSpread({},baseSpec),{},{lazySink:toolbarSpec.getSink,getOverflowBounds:()=>{var headerElem=toolbarSpec.moreDrawerData.lazyHeader().element;var headerBounds=absolute$2(headerElem);var docElem=documentElement(headerElem);var docBounds=absolute$2(docElem);var height=Math.max(docElem.dom.scrollHeight,docBounds.height);return bounds(headerBounds.x+overflowXOffset,docBounds.y,headerBounds.width-overflowXOffset*2,height);},parts:_objectSpread(_objectSpread({},baseSpec.parts),{},{overflow:{dom:{tag:'div',classes:['tox-toolbar__overflow'],attributes:toolbarSpec.attributes}}}),components:[primary],markers:{overflowToggledClass:'tox-tbtn--enabled'},onOpened:comp=>toolbarSpec.onToggled(comp,true),onClosed:comp=>toolbarSpec.onToggled(comp,false)}));};var renderSlidingMoreToolbar=toolbarSpec=>{var primary=SplitSlidingToolbar.parts.primary({dom:{tag:'div',classes:['tox-toolbar__primary']}});var overflow=SplitSlidingToolbar.parts.overflow({dom:{tag:'div',classes:['tox-toolbar__overflow']}});var baseSpec=renderMoreToolbarCommon(toolbarSpec);return SplitSlidingToolbar.sketch(_objectSpread(_objectSpread({},baseSpec),{},{components:[primary,overflow],markers:{openClass:'tox-toolbar__overflow--open',closedClass:'tox-toolbar__overflow--closed',growingClass:'tox-toolbar__overflow--growing',shrinkingClass:'tox-toolbar__overflow--shrinking',overflowToggledClass:'tox-tbtn--enabled'},onOpened:comp=>{comp.getSystem().broadcastOn([toolbarHeightChange()],{type:'opened'});toolbarSpec.onToggled(comp,true);},onClosed:comp=>{comp.getSystem().broadcastOn([toolbarHeightChange()],{type:'closed'});toolbarSpec.onToggled(comp,false);}}));};var renderToolbar=toolbarSpec=>{var modeName=toolbarSpec.cyclicKeying?'cyclic':'acyclic';return Toolbar.sketch({uid:toolbarSpec.uid,dom:{tag:'div',classes:['tox-toolbar'].concat(toolbarSpec.type===ToolbarMode$1.scrolling?['tox-toolbar--scrolling']:[])},components:[Toolbar.parts.groups({})],toolbarBehaviours:getToolbarBehaviours(toolbarSpec,modeName)});};var baseButtonFields=[optionalText,optionalIcon,optionString('tooltip'),defaultedStringEnum('buttonType','secondary',['primary','secondary']),defaultedBoolean('borderless',false),requiredFunction('onAction')];var normalButtonFields=[...baseButtonFields,text$1,requiredStringEnum('type',['button'])];var toggleButtonFields=[...baseButtonFields,defaultedBoolean('active',false),requiredStringEnum('type',['togglebutton'])];var schemaWithoutGroupButton={button:normalButtonFields,togglebutton:toggleButtonFields};var groupFields=[requiredStringEnum('type',['group']),defaultedArrayOf('buttons',[],choose$1('type',schemaWithoutGroupButton))];var viewButtonSchema=choose$1('type',_objectSpread(_objectSpread({},schemaWithoutGroupButton),{},{group:groupFields}));var viewSchema=objOf([defaultedArrayOf('buttons',[],viewButtonSchema),requiredFunction('onShow'),requiredFunction('onHide')]);var createView=spec=>asRaw('view',viewSchema,spec);var renderButton=(spec,providers)=>{var _a,_b;var isToggleButton=spec.type==='togglebutton';var optMemIcon=spec.icon.map(memIcon=>renderReplaceableIconFromPack(memIcon,providers.icons)).map(record);var getAction=()=>comp=>{var setIcon=newIcon=>{optMemIcon.map(memIcon=>memIcon.getOpt(comp).each(displayIcon=>{Replacing.set(displayIcon,[renderReplaceableIconFromPack(newIcon,providers.icons)]);}));};var setActive=state=>{var elm=comp.element;if(state){add$2(elm,'tox-button--enabled');set$9(elm,'aria-pressed',true);}else{remove$2(elm,'tox-button--enabled');remove$7(elm,'aria-pressed');}};var isActive=()=>has(comp.element,'tox-button--enabled');if(isToggleButton){return spec.onAction({setIcon,setActive,isActive});}if(spec.type==='button'){return spec.onAction({setIcon});}};var action=getAction();var buttonSpec=_objectSpread(_objectSpread({},spec),{},{name:isToggleButton?spec.text.getOr(spec.icon.getOr('')):(_a=spec.text)!==null&&_a!==void 0?_a:spec.icon.getOr(''),primary:spec.buttonType==='primary',buttonType:Optional.from(spec.buttonType),tooltip:spec.tooltip,icon:spec.icon,enabled:true,borderless:spec.borderless});var buttonTypeClasses=calculateClassesFromButtonType((_b=spec.buttonType)!==null&&_b!==void 0?_b:'secondary');var optTranslatedText=isToggleButton?spec.text.map(providers.translate):Optional.some(providers.translate(spec.text));var optTranslatedTextComponed=optTranslatedText.map(text$2);var tooltipAttributes=buttonSpec.tooltip.or(optTranslatedText).map(tooltip=>({'aria-label':providers.translate(tooltip),'title':providers.translate(tooltip)})).getOr({});var optIconSpec=optMemIcon.map(memIcon=>memIcon.asSpec());var components=componentRenderPipeline([optIconSpec,optTranslatedTextComponed]);var hasIconAndText=spec.icon.isSome()&&optTranslatedTextComponed.isSome();var dom={tag:'button',classes:buttonTypeClasses.concat(...(spec.icon.isSome()&&!hasIconAndText?['tox-button--icon']:[])).concat(...(hasIconAndText?['tox-button--icon-and-text']:[])).concat(...(spec.borderless?['tox-button--naked']:[])).concat(...(spec.type==='togglebutton'&&spec.active?['tox-button--enabled']:[])),attributes:tooltipAttributes};var extraBehaviours=[];var iconButtonSpec=renderCommonSpec(buttonSpec,Optional.some(action),extraBehaviours,dom,components,providers);return Button.sketch(iconButtonSpec);};var renderViewButton=(spec,providers)=>renderButton(spec,providers);var renderButtonsGroup=(spec,providers)=>{return{dom:{tag:'div',classes:['tox-view__toolbar__group']},components:map$2(spec.buttons,button=>renderViewButton(button,providers))};};var deviceDetection=detect$2().deviceType;var isPhone=deviceDetection.isPhone();var isTablet=deviceDetection.isTablet();var renderViewHeader=spec=>{var hasGroups=false;var endButtons=map$2(spec.buttons,btnspec=>{if(btnspec.type==='group'){hasGroups=true;return renderButtonsGroup(btnspec,spec.providers);}else{return renderViewButton(btnspec,spec.providers);}});return{uid:spec.uid,dom:{tag:'div',classes:[!hasGroups?'tox-view__header':'tox-view__toolbar',...(isPhone||isTablet?['tox-view--mobile','tox-view--scrolling']:[])]},behaviours:derive$1([Focusing.config({}),Keying.config({mode:'flow',selector:'button, .tox-button',focusInside:FocusInsideModes.OnEnterOrSpaceMode})]),components:hasGroups?endButtons:[Container.sketch({dom:{tag:'div',classes:['tox-view__header-start']},components:[]}),Container.sketch({dom:{tag:'div',classes:['tox-view__header-end']},components:endButtons})]};};var renderViewPane=spec=>{return{uid:spec.uid,dom:{tag:'div',classes:['tox-view__pane']}};};var factory$8=(detail,components,_spec,_externals)=>{var apis={getPane:comp=>parts$a.getPart(comp,detail,'pane'),getOnShow:_comp=>detail.viewConfig.onShow,getOnHide:_comp=>detail.viewConfig.onHide};return{uid:detail.uid,dom:detail.dom,components,apis};};var View=composite({name:'silver.View',configFields:[required$1('viewConfig')],partFields:[optional({factory:{sketch:renderViewHeader},schema:[required$1('buttons'),required$1('providers')],name:'header'}),optional({factory:{sketch:renderViewPane},schema:[],name:'pane'})],factory:factory$8,apis:{getPane:(apis,comp)=>apis.getPane(comp),getOnShow:(apis,comp)=>apis.getOnShow(comp),getOnHide:(apis,comp)=>apis.getOnHide(comp)}});var makeViews=(parts,viewConfigs,providers)=>{return mapToArray(viewConfigs,(config,name)=>{var internalViewConfig=getOrDie(createView(config));return parts.slot(name,View.sketch({dom:{tag:'div',classes:['tox-view']},viewConfig:internalViewConfig,components:[...(internalViewConfig.buttons.length>0?[View.parts.header({buttons:internalViewConfig.buttons,providers})]:[]),View.parts.pane({})]}));});};var makeSlotContainer=(viewConfigs,providers)=>SlotContainer.sketch(parts=>({dom:{tag:'div',classes:['tox-view-wrap__slot-container']},components:makeViews(parts,viewConfigs,providers),slotBehaviours:SimpleBehaviours.unnamedEvents([runOnAttached(slotContainer=>SlotContainer.hideAllSlots(slotContainer))])}));var getCurrentName=slotContainer=>{return find$5(SlotContainer.getSlotNames(slotContainer),name=>SlotContainer.isShowing(slotContainer,name));};var hideContainer=comp=>{var element=comp.element;set$8(element,'display','none');set$9(element,'aria-hidden','true');};var showContainer=comp=>{var element=comp.element;remove$6(element,'display');remove$7(element,'aria-hidden');};var makeViewInstanceApi=slot=>({getContainer:constant$1(slot)});var runOnPaneWithInstanceApi=(slotContainer,name,get)=>{SlotContainer.getSlot(slotContainer,name).each(view=>{View.getPane(view).each(pane=>{var onCallback=get(view);onCallback(makeViewInstanceApi(pane.element.dom));});});};var runOnShow=(slotContainer,name)=>runOnPaneWithInstanceApi(slotContainer,name,View.getOnShow);var runOnHide=(slotContainer,name)=>runOnPaneWithInstanceApi(slotContainer,name,View.getOnHide);var factory$7=(detail,spec)=>{var setViews=(comp,viewConfigs)=>{Replacing.set(comp,[makeSlotContainer(viewConfigs,spec.backstage.shared.providers)]);};var whichView=comp=>{return Composing.getCurrent(comp).bind(getCurrentName);};var toggleView=(comp,showMainView,hideMainView,name)=>{return Composing.getCurrent(comp).exists(slotContainer=>{var optCurrentSlotName=getCurrentName(slotContainer);var isTogglingCurrentView=optCurrentSlotName.exists(current=>name===current);var exists=SlotContainer.getSlot(slotContainer,name).isSome();if(exists){SlotContainer.hideAllSlots(slotContainer);if(!isTogglingCurrentView){hideMainView();showContainer(comp);SlotContainer.showSlot(slotContainer,name);runOnShow(slotContainer,name);}else{hideContainer(comp);showMainView();}optCurrentSlotName.each(prevName=>runOnHide(slotContainer,prevName));}return exists;});};var apis={setViews,whichView,toggleView};return{uid:detail.uid,dom:{tag:'div',classes:['tox-view-wrap'],attributes:{'aria-hidden':'true'},styles:{display:'none'}},components:[],behaviours:derive$1([Replacing.config({}),Composing.config({find:comp=>{var children=Replacing.contents(comp);return head(children);}})]),apis};};var ViewWrapper=single({factory:factory$7,name:'silver.ViewWrapper',configFields:[required$1('backstage')],apis:{setViews:(apis,comp,views)=>apis.setViews(comp,views),toggleView:(apis,comp,outerContainer,editorCont,name)=>apis.toggleView(comp,outerContainer,editorCont,name),whichView:(apis,comp)=>apis.whichView(comp)}});var factory$6=(detail,components,_spec)=>{var toolbarDrawerOpenState=false;var apis={getSocket:comp=>{return parts$a.getPart(comp,detail,'socket');},setSidebar:(comp,panelConfigs,showSidebar)=>{parts$a.getPart(comp,detail,'sidebar').each(sidebar=>_setSidebar(sidebar,panelConfigs,showSidebar));},toggleSidebar:(comp,name)=>{parts$a.getPart(comp,detail,'sidebar').each(sidebar=>_toggleSidebar(sidebar,name));},whichSidebar:comp=>{return parts$a.getPart(comp,detail,'sidebar').bind(_whichSidebar).getOrNull();},getHeader:comp=>{return parts$a.getPart(comp,detail,'header');},getToolbar:comp=>{return parts$a.getPart(comp,detail,'toolbar');},setToolbar:(comp,groups)=>{parts$a.getPart(comp,detail,'toolbar').each(toolbar=>{var renderedGroups=map$2(groups,renderToolbarGroup);toolbar.getApis().setGroups(toolbar,renderedGroups);});},setToolbars:(comp,toolbars)=>{parts$a.getPart(comp,detail,'multiple-toolbar').each(mToolbar=>{var renderedToolbars=map$2(toolbars,g=>map$2(g,renderToolbarGroup));CustomList.setItems(mToolbar,renderedToolbars);});},refreshToolbar:comp=>{var toolbar=parts$a.getPart(comp,detail,'toolbar');toolbar.each(toolbar=>toolbar.getApis().refresh(toolbar));},toggleToolbarDrawer:comp=>{parts$a.getPart(comp,detail,'toolbar').each(toolbar=>{mapFrom(toolbar.getApis().toggle,toggle=>toggle(toolbar));});},toggleToolbarDrawerWithoutFocusing:comp=>{parts$a.getPart(comp,detail,'toolbar').each(toolbar=>{mapFrom(toolbar.getApis().toggleWithoutFocusing,toggleWithoutFocusing=>toggleWithoutFocusing(toolbar));});},isToolbarDrawerToggled:comp=>{return parts$a.getPart(comp,detail,'toolbar').bind(toolbar=>Optional.from(toolbar.getApis().isOpen).map(isOpen=>isOpen(toolbar))).getOr(false);},getThrobber:comp=>{return parts$a.getPart(comp,detail,'throbber');},focusToolbar:comp=>{var optToolbar=parts$a.getPart(comp,detail,'toolbar').orThunk(()=>parts$a.getPart(comp,detail,'multiple-toolbar'));optToolbar.each(toolbar=>{Keying.focusIn(toolbar);});},setMenubar:(comp,menus)=>{parts$a.getPart(comp,detail,'menubar').each(menubar=>{SilverMenubar.setMenus(menubar,menus);});},focusMenubar:comp=>{parts$a.getPart(comp,detail,'menubar').each(menubar=>{SilverMenubar.focus(menubar);});},setViews:(comp,viewConfigs)=>{parts$a.getPart(comp,detail,'viewWrapper').each(wrapper=>{ViewWrapper.setViews(wrapper,viewConfigs);});},toggleView:(comp,name)=>{return parts$a.getPart(comp,detail,'viewWrapper').exists(wrapper=>ViewWrapper.toggleView(wrapper,()=>apis.showMainView(comp),()=>apis.hideMainView(comp),name));},whichView:comp=>{return parts$a.getPart(comp,detail,'viewWrapper').bind(ViewWrapper.whichView).getOrNull();},hideMainView:comp=>{toolbarDrawerOpenState=apis.isToolbarDrawerToggled(comp);if(toolbarDrawerOpenState){apis.toggleToolbarDrawer(comp);}parts$a.getPart(comp,detail,'editorContainer').each(editorContainer=>{var element=editorContainer.element;set$8(element,'display','none');set$9(element,'aria-hidden','true');});},showMainView:comp=>{if(toolbarDrawerOpenState){apis.toggleToolbarDrawer(comp);}parts$a.getPart(comp,detail,'editorContainer').each(editorContainer=>{var element=editorContainer.element;remove$6(element,'display');remove$7(element,'aria-hidden');});}};return{uid:detail.uid,dom:detail.dom,components,apis,behaviours:detail.behaviours};};var partMenubar=partType.optional({factory:SilverMenubar,name:'menubar',schema:[required$1('backstage')]});var toolbarFactory=spec=>{if(spec.type===ToolbarMode$1.sliding){return renderSlidingMoreToolbar;}else if(spec.type===ToolbarMode$1.floating){return renderFloatingMoreToolbar;}else{return renderToolbar;}};var partMultipleToolbar=partType.optional({factory:{sketch:spec=>CustomList.sketch({uid:spec.uid,dom:spec.dom,listBehaviours:derive$1([Keying.config({mode:'acyclic',selector:'.tox-toolbar'})]),makeItem:()=>renderToolbar({type:spec.type,uid:generate$6('multiple-toolbar-item'),cyclicKeying:false,initGroups:[],providers:spec.providers,onEscape:()=>{spec.onEscape();return Optional.some(true);}}),setupItem:(_mToolbar,tc,data,_index)=>{Toolbar.setGroups(tc,data);},shell:true})},name:'multiple-toolbar',schema:[required$1('dom'),required$1('onEscape')]});var partToolbar=partType.optional({factory:{sketch:spec=>{var renderer=toolbarFactory(spec);var toolbarSpec={type:spec.type,uid:spec.uid,onEscape:()=>{spec.onEscape();return Optional.some(true);},onToggled:(_comp,state)=>spec.onToolbarToggled(state),cyclicKeying:false,initGroups:[],getSink:spec.getSink,providers:spec.providers,moreDrawerData:{lazyToolbar:spec.lazyToolbar,lazyMoreButton:spec.lazyMoreButton,lazyHeader:spec.lazyHeader},attributes:spec.attributes};return renderer(toolbarSpec);}},name:'toolbar',schema:[required$1('dom'),required$1('onEscape'),required$1('getSink')]});var partHeader=partType.optional({factory:{sketch:renderHeader},name:'header',schema:[required$1('dom')]});var partPromotion=partType.optional({factory:{sketch:renderPromotion},name:'promotion',schema:[required$1('dom')]});var partSocket=partType.optional({name:'socket',schema:[required$1('dom')]});var partSidebar=partType.optional({factory:{sketch:renderSidebar},name:'sidebar',schema:[required$1('dom')]});var partThrobber=partType.optional({factory:{sketch:renderThrobber},name:'throbber',schema:[required$1('dom')]});var partViewWrapper=partType.optional({factory:ViewWrapper,name:'viewWrapper',schema:[required$1('backstage')]});var renderEditorContainer=spec=>({uid:spec.uid,dom:{tag:'div',classes:['tox-editor-container']},components:spec.components});var partEditorContainer=partType.optional({factory:{sketch:renderEditorContainer},name:'editorContainer',schema:[]});var OuterContainer=composite({name:'OuterContainer',factory:factory$6,configFields:[required$1('dom'),required$1('behaviours')],partFields:[partHeader,partMenubar,partToolbar,partMultipleToolbar,partSocket,partSidebar,partPromotion,partThrobber,partViewWrapper,partEditorContainer],apis:{getSocket:(apis,comp)=>{return apis.getSocket(comp);},setSidebar:(apis,comp,panelConfigs,showSidebar)=>{apis.setSidebar(comp,panelConfigs,showSidebar);},toggleSidebar:(apis,comp,name)=>{apis.toggleSidebar(comp,name);},whichSidebar:(apis,comp)=>{return apis.whichSidebar(comp);},getHeader:(apis,comp)=>{return apis.getHeader(comp);},getToolbar:(apis,comp)=>{return apis.getToolbar(comp);},setToolbar:(apis,comp,groups)=>{apis.setToolbar(comp,groups);},setToolbars:(apis,comp,toolbars)=>{apis.setToolbars(comp,toolbars);},refreshToolbar:(apis,comp)=>{return apis.refreshToolbar(comp);},toggleToolbarDrawer:(apis,comp)=>{apis.toggleToolbarDrawer(comp);},toggleToolbarDrawerWithoutFocusing:(apis,comp)=>{apis.toggleToolbarDrawerWithoutFocusing(comp);},isToolbarDrawerToggled:(apis,comp)=>{return apis.isToolbarDrawerToggled(comp);},getThrobber:(apis,comp)=>{return apis.getThrobber(comp);},setMenubar:(apis,comp,menus)=>{apis.setMenubar(comp,menus);},focusMenubar:(apis,comp)=>{apis.focusMenubar(comp);},focusToolbar:(apis,comp)=>{apis.focusToolbar(comp);},setViews:(apis,comp,views)=>{apis.setViews(comp,views);},toggleView:(apis,comp,name)=>{return apis.toggleView(comp,name);},whichView:(apis,comp)=>{return apis.whichView(comp);}}});var defaultMenubar='file edit view insert format tools table help';var defaultMenus={file:{title:'File',items:'newdocument restoredraft | preview | export print | deleteallconversations'},edit:{title:'Edit',items:'undo redo | cut copy paste pastetext | selectall | searchreplace'},view:{title:'View',items:'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments'},insert:{title:'Insert',items:'image link media addcomment pageembed template inserttemplate codesample inserttable accordion | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents footnotes | mergetags | insertdatetime'},format:{title:'Format',items:'bold italic underline strikethrough superscript subscript codeformat | styles blocks fontfamily fontsize align lineheight | forecolor backcolor | language | removeformat'},tools:{title:'Tools',items:'aidialog aishortcuts | spellchecker spellcheckerlanguage | autocorrect capitalization | a11ycheck code typography wordcount addtemplate'},table:{title:'Table',items:'inserttable | cell row column | advtablesort | tableprops deletetable'},help:{title:'Help',items:'help'}};var make=(menu,registry,editor)=>{var removedMenuItems=getRemovedMenuItems(editor).split(/[ ,]/);return{text:menu.title,getItems:()=>bind$3(menu.items,i=>{var itemName=i.toLowerCase();if(itemName.trim().length===0){return[];}else if(exists(removedMenuItems,removedMenuItem=>removedMenuItem===itemName)){return[];}else if(itemName==='separator'||itemName==='|'){return[{type:'separator'}];}else if(registry.menuItems[itemName]){return[registry.menuItems[itemName]];}else{return[];}})};};var parseItemsString=items=>{return items.split(' ');};var identifyMenus=(editor,registry)=>{var rawMenuData=_objectSpread(_objectSpread({},defaultMenus),registry.menus);var userDefinedMenus=keys(registry.menus).length>0;var menubar=registry.menubar===undefined||registry.menubar===true?parseItemsString(defaultMenubar):parseItemsString(registry.menubar===false?'':registry.menubar);var validMenus=filter$2(menubar,menuName=>{var isDefaultMenu=has$2(defaultMenus,menuName);if(userDefinedMenus){return isDefaultMenu||get$g(registry.menus,menuName).exists(menu=>has$2(menu,'items'));}else{return isDefaultMenu;}});var menus=map$2(validMenus,menuName=>{var menuData=rawMenuData[menuName];return make({title:menuData.title,items:parseItemsString(menuData.items)},registry,editor);});return filter$2(menus,menu=>{var isNotSeparator=item=>isString(item)||item.type!=='separator';return menu.getItems().length>0&&exists(menu.getItems(),isNotSeparator);});};var fireSkinLoaded=editor=>{var done=()=>{editor._skinLoaded=true;fireSkinLoaded$1(editor);};return()=>{if(editor.initialized){done();}else{editor.on('init',done);}};};var fireSkinLoadError=(editor,err)=>()=>fireSkinLoadError$1(editor,{message:err});var loadStylesheet=(editor,stylesheetUrl,styleSheetLoader)=>{editor.on('remove',()=>styleSheetLoader.unload(stylesheetUrl));return styleSheetLoader.load(stylesheetUrl);};var loadUiSkins=(editor,skinUrl)=>{var skinUiCss=skinUrl+'/skin.min.css';return loadStylesheet(editor,skinUiCss,editor.ui.styleSheetLoader);};var loadShadowDomUiSkins=(editor,skinUrl)=>{var isInShadowRoot$1=isInShadowRoot(SugarElement.fromDom(editor.getElement()));if(isInShadowRoot$1){var shadowDomSkinCss=skinUrl+'/skin.shadowdom.min.css';return loadStylesheet(editor,shadowDomSkinCss,global$7.DOM.styleSheetLoader);}else{return Promise.resolve();}};var loadSkin=(isInline,editor)=>{var skinUrl=getSkinUrl(editor);if(skinUrl){editor.contentCSS.push(skinUrl+(isInline?'/content.inline':'/content')+'.min.css');}if(!isSkinDisabled(editor)&&isString(skinUrl)){return Promise.all([loadUiSkins(editor,skinUrl),loadShadowDomUiSkins(editor,skinUrl)]).then(fireSkinLoaded(editor),fireSkinLoadError(editor,'Skin could not be loaded'));}else{return Promise.resolve(fireSkinLoaded(editor)());}};var iframe=curry(loadSkin,false);var inline=curry(loadSkin,true);var generateSelectItems=(_editor,backstage,spec)=>{var generateItem=(rawItem,response,invalid,value)=>{var translatedText=backstage.shared.providers.translate(rawItem.title);if(rawItem.type==='separator'){return Optional.some({type:'separator',text:translatedText});}else if(rawItem.type==='submenu'){var items=bind$3(rawItem.getStyleItems(),si=>validate(si,response,value));if(response===0&&items.length<=0){return Optional.none();}else{return Optional.some({type:'nestedmenuitem',text:translatedText,enabled:items.length>0,getSubmenuItems:()=>bind$3(rawItem.getStyleItems(),si=>validate(si,response,value))});}}else{return Optional.some(_objectSpread({type:'togglemenuitem',text:translatedText,icon:rawItem.icon,active:rawItem.isSelected(value),enabled:!invalid,onAction:spec.onAction(rawItem)},rawItem.getStylePreview().fold(()=>({}),preview=>({meta:{style:preview}}))));}};var validate=(item,response,value)=>{var invalid=item.type==='formatter'&&spec.isInvalid(item);if(response===0){return invalid?[]:generateItem(item,response,false,value).toArray();}else{return generateItem(item,response,invalid,value).toArray();}};var validateItems=preItems=>{var value=spec.getCurrentValue();var response=spec.shouldHide?0:1;return bind$3(preItems,item=>validate(item,response,value));};var getFetch=(backstage,getStyleItems)=>(comp,callback)=>{var preItems=getStyleItems();var items=validateItems(preItems);var menu=build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,{isHorizontalMenu:false,search:Optional.none()});callback(menu);};return{validateItems,getFetch};};var createMenuItems=(editor,backstage,spec)=>{var dataset=spec.dataset;var getStyleItems=dataset.type==='basic'?()=>map$2(dataset.data,d=>processBasic(d,spec.isSelectedFor,spec.getPreviewFor)):dataset.getData;return{items:generateSelectItems(editor,backstage,spec),getStyleItems};};var createSelectButton=(editor,backstage,spec)=>{var{items,getStyleItems}=createMenuItems(editor,backstage,spec);var getApi=comp=>({getComponent:constant$1(comp)});var onSetup=onSetupEvent(editor,'NodeChange',api=>{var comp=api.getComponent();spec.updateText(comp);Disabling.set(api.getComponent(),!editor.selection.isEditable());});return renderCommonDropdown({text:spec.icon.isSome()?Optional.none():spec.text,icon:spec.icon,tooltip:Optional.from(spec.tooltip),role:Optional.none(),fetch:items.getFetch(backstage,getStyleItems),onSetup,getApi,columns:1,presets:'normal',classes:spec.icon.isSome()?[]:['bespoke'],dropdownBehaviours:[]},'tox-tbtn',backstage.shared);};var process=rawFormats=>map$2(rawFormats,item=>{var title=item,format=item;var values=item.split('=');if(values.length>1){title=values[0];format=values[1];}return{title,format};});var buildBasicStaticDataset=data=>({type:'basic',data});var Delimiter;(function(Delimiter){Delimiter[Delimiter['SemiColon']=0]='SemiColon';Delimiter[Delimiter['Space']=1]='Space';})(Delimiter||(Delimiter={}));var split=(rawFormats,delimiter)=>{if(delimiter===Delimiter.SemiColon){return rawFormats.replace(/;$/,'').split(';');}else{return rawFormats.split(' ');}};var buildBasicSettingsDataset=(editor,settingName,delimiter)=>{var rawFormats=editor.options.get(settingName);var data=process(split(rawFormats,delimiter));return{type:'basic',data};};var alignMenuItems=[{title:'Left',icon:'align-left',format:'alignleft',command:'JustifyLeft'},{title:'Center',icon:'align-center',format:'aligncenter',command:'JustifyCenter'},{title:'Right',icon:'align-right',format:'alignright',command:'JustifyRight'},{title:'Justify',icon:'align-justify',format:'alignjustify',command:'JustifyFull'}];var getSpec$4=editor=>{var getMatchingValue=()=>find$5(alignMenuItems,item=>editor.formatter.match(item.format));var isSelectedFor=format=>()=>editor.formatter.match(format);var getPreviewFor=_format=>Optional.none;var updateSelectMenuIcon=comp=>{var match=getMatchingValue();var alignment=match.fold(constant$1('left'),item=>item.title.toLowerCase());emitWith(comp,updateMenuIcon,{icon:\"align-\".concat(alignment)});};var dataset=buildBasicStaticDataset(alignMenuItems);var onAction=rawItem=>()=>find$5(alignMenuItems,item=>item.format===rawItem.format).each(item=>editor.execCommand(item.command));return{tooltip:'Align',text:Optional.none(),icon:Optional.some('align-left'),isSelectedFor,getCurrentValue:Optional.none,getPreviewFor,onAction,updateText:updateSelectMenuIcon,dataset,shouldHide:false,isInvalid:item=>!editor.formatter.canApply(item.format)};};var createAlignButton=(editor,backstage)=>createSelectButton(editor,backstage,getSpec$4(editor));var createAlignMenu=(editor,backstage)=>{var menuItems=createMenuItems(editor,backstage,getSpec$4(editor));editor.ui.registry.addNestedMenuItem('align',{text:backstage.shared.providers.translate('Align'),onSetup:onSetupEditableToggle(editor),getSubmenuItems:()=>menuItems.items.validateItems(menuItems.getStyleItems())});};var findNearest=(editor,getStyles)=>{var styles=getStyles();var formats=map$2(styles,style=>style.format);return Optional.from(editor.formatter.closest(formats)).bind(fmt=>find$5(styles,data=>data.format===fmt)).orThunk(()=>someIf(editor.formatter.match('p'),{title:'Paragraph',format:'p'}));};var getSpec$3=editor=>{var fallbackFormat='Paragraph';var isSelectedFor=format=>()=>editor.formatter.match(format);var getPreviewFor=format=>()=>{var fmt=editor.formatter.get(format);if(fmt){return Optional.some({tag:fmt.length>0?fmt[0].inline||fmt[0].block||'div':'div',styles:editor.dom.parseStyle(editor.formatter.getCssText(format))});}else{return Optional.none();}};var updateSelectMenuText=comp=>{var detectedFormat=findNearest(editor,()=>dataset.data);var text=detectedFormat.fold(constant$1(fallbackFormat),fmt=>fmt.title);emitWith(comp,updateMenuText,{text});};var dataset=buildBasicSettingsDataset(editor,'block_formats',Delimiter.SemiColon);return{tooltip:'Blocks',text:Optional.some(fallbackFormat),icon:Optional.none(),isSelectedFor,getCurrentValue:Optional.none,getPreviewFor,onAction:onActionToggleFormat$1(editor),updateText:updateSelectMenuText,dataset,shouldHide:false,isInvalid:item=>!editor.formatter.canApply(item.format)};};var createBlocksButton=(editor,backstage)=>createSelectButton(editor,backstage,getSpec$3(editor));var createBlocksMenu=(editor,backstage)=>{var menuItems=createMenuItems(editor,backstage,getSpec$3(editor));editor.ui.registry.addNestedMenuItem('blocks',{text:'Blocks',onSetup:onSetupEditableToggle(editor),getSubmenuItems:()=>menuItems.items.validateItems(menuItems.getStyleItems())});};var systemStackFonts=['-apple-system','Segoe UI','Roboto','Helvetica Neue','sans-serif'];var splitFonts=fontFamily=>{var fonts=fontFamily.split(/\\s*,\\s*/);return map$2(fonts,font=>font.replace(/^['\"]+|['\"]+$/g,''));};var isSystemFontStack=fontFamily=>{var matchesSystemStack=()=>{var fonts=splitFonts(fontFamily.toLowerCase());return forall(systemStackFonts,font=>fonts.indexOf(font.toLowerCase())>-1);};return fontFamily.indexOf('-apple-system')===0&&matchesSystemStack();};var getSpec$2=editor=>{var systemFont='System Font';var getMatchingValue=()=>{var getFirstFont=fontFamily=>fontFamily?splitFonts(fontFamily)[0]:'';var fontFamily=editor.queryCommandValue('FontName');var items=dataset.data;var font=fontFamily?fontFamily.toLowerCase():'';var matchOpt=find$5(items,item=>{var format=item.format;return format.toLowerCase()===font||getFirstFont(format).toLowerCase()===getFirstFont(font).toLowerCase();}).orThunk(()=>{return someIf(isSystemFontStack(font),{title:systemFont,format:font});});return{matchOpt,font:fontFamily};};var isSelectedFor=item=>valueOpt=>valueOpt.exists(value=>value.format===item);var getCurrentValue=()=>{var{matchOpt}=getMatchingValue();return matchOpt;};var getPreviewFor=item=>()=>Optional.some({tag:'div',styles:item.indexOf('dings')===-1?{'font-family':item}:{}});var onAction=rawItem=>()=>{editor.undoManager.transact(()=>{editor.focus();editor.execCommand('FontName',false,rawItem.format);});};var updateSelectMenuText=comp=>{var{matchOpt,font}=getMatchingValue();var text=matchOpt.fold(constant$1(font),item=>item.title);emitWith(comp,updateMenuText,{text});};var dataset=buildBasicSettingsDataset(editor,'font_family_formats',Delimiter.SemiColon);return{tooltip:'Fonts',text:Optional.some(systemFont),icon:Optional.none(),isSelectedFor,getCurrentValue,getPreviewFor,onAction,updateText:updateSelectMenuText,dataset,shouldHide:false,isInvalid:never};};var createFontFamilyButton=(editor,backstage)=>createSelectButton(editor,backstage,getSpec$2(editor));var createFontFamilyMenu=(editor,backstage)=>{var menuItems=createMenuItems(editor,backstage,getSpec$2(editor));editor.ui.registry.addNestedMenuItem('fontfamily',{text:backstage.shared.providers.translate('Fonts'),onSetup:onSetupEditableToggle(editor),getSubmenuItems:()=>menuItems.items.validateItems(menuItems.getStyleItems())});};var units={unsupportedLength:['em','ex','cap','ch','ic','rem','lh','rlh','vw','vh','vi','vb','vmin','vmax','cm','mm','Q','in','pc','pt','px'],fixed:['px','pt'],relative:['%'],empty:['']};var pattern=(()=>{var decimalDigits='[0-9]+';var signedInteger='[+-]?'+decimalDigits;var exponentPart='[eE]'+signedInteger;var dot='\\\\.';var opt=input=>\"(?:\".concat(input,\")?\");var unsignedDecimalLiteral=['Infinity',decimalDigits+dot+opt(decimalDigits)+opt(exponentPart),dot+decimalDigits+opt(exponentPart),decimalDigits+opt(exponentPart)].join('|');var float=\"[+-]?(?:\".concat(unsignedDecimalLiteral,\")\");return new RegExp(\"^(\".concat(float,\")(.*)$\"));})();var isUnit=(unit,accepted)=>exists(accepted,acc=>exists(units[acc],check=>unit===check));var parse=(input,accepted)=>{var match=Optional.from(pattern.exec(input));return match.bind(array=>{var value=Number(array[1]);var unitRaw=array[2];if(isUnit(unitRaw,accepted)){return Optional.some({value,unit:unitRaw});}else{return Optional.none();}});};var normalise=(input,accepted)=>parse(input,accepted).map(_ref16=>{var{value,unit}=_ref16;return value+unit;});var Keys={tab:constant$1(9),escape:constant$1(27),enter:constant$1(13),backspace:constant$1(8),delete:constant$1(46),left:constant$1(37),up:constant$1(38),right:constant$1(39),down:constant$1(40),space:constant$1(32),home:constant$1(36),end:constant$1(35),pageUp:constant$1(33),pageDown:constant$1(34)};var createBespokeNumberInput=(editor,backstage,spec)=>{var currentComp=Optional.none();var getValueFromCurrentComp=comp=>comp.map(alloyComp=>Representing.getValue(alloyComp)).getOr('');var onSetup=onSetupEvent(editor,'NodeChange SwitchMode',api=>{var comp=api.getComponent();currentComp=Optional.some(comp);spec.updateInputValue(comp);Disabling.set(comp,!editor.selection.isEditable());});var getApi=comp=>({getComponent:constant$1(comp)});var editorOffCell=Cell(noop);var customEvents=generate$6('custom-number-input-events');var changeValue=(f,fromInput,focusBack)=>{var text=getValueFromCurrentComp(currentComp);var newValue=spec.getNewValue(text,f);var lenghtDelta=text.length-\"\".concat(newValue).length;var oldStart=currentComp.map(comp=>comp.element.dom.selectionStart-lenghtDelta);var oldEnd=currentComp.map(comp=>comp.element.dom.selectionEnd-lenghtDelta);spec.onAction(newValue,focusBack);currentComp.each(comp=>{Representing.setValue(comp,newValue);if(fromInput){oldStart.each(oldStart=>comp.element.dom.selectionStart=oldStart);oldEnd.each(oldEnd=>comp.element.dom.selectionEnd=oldEnd);}});};var decrease=(fromInput,focusBack)=>changeValue((n,s)=>n-s,fromInput,focusBack);var increase=(fromInput,focusBack)=>changeValue((n,s)=>n+s,fromInput,focusBack);var goToParent=comp=>parentElement(comp.element).fold(Optional.none,parent=>{focus$3(parent);return Optional.some(true);});var focusInput=comp=>{if(hasFocus(comp.element)){firstChild(comp.element).each(input=>focus$3(input));return Optional.some(true);}else{return Optional.none();}};var makeStepperButton=(action,title,tooltip,classes)=>{var translatedTooltip=backstage.shared.providers.translate(tooltip);var altExecuting=generate$6('altExecuting');var onSetup=onSetupEvent(editor,'NodeChange SwitchMode',api=>{Disabling.set(api.getComponent(),!editor.selection.isEditable());});var onClick=comp=>{if(!Disabling.isDisabled(comp)){action(true);}};return Button.sketch({dom:{tag:'button',attributes:{'title':translatedTooltip,'aria-label':translatedTooltip},classes:classes.concat(title)},components:[renderIconFromPack$1(title,backstage.shared.providers.icons)],buttonBehaviours:derive$1([Disabling.config({}),config(altExecuting,[onControlAttached({onSetup,getApi},editorOffCell),onControlDetached({getApi},editorOffCell),run$1(keydown(),(comp,se)=>{if(se.event.raw.keyCode===Keys.space()||se.event.raw.keyCode===Keys.enter()){if(!Disabling.isDisabled(comp)){action(false);}}}),run$1(click(),onClick),run$1(touchend(),onClick)])]),eventOrder:{[keydown()]:[altExecuting,'keying'],[click()]:[altExecuting,'alloy.base.behaviour'],[touchend()]:[altExecuting,'alloy.base.behaviour']}});};var memMinus=record(makeStepperButton(focusBack=>decrease(false,focusBack),'minus','Decrease font size',['highlight-on-focus']));var memPlus=record(makeStepperButton(focusBack=>increase(false,focusBack),'plus','Increase font size',['highlight-on-focus']));var memInput=record({dom:{tag:'div',classes:['tox-input-wrapper','highlight-on-focus']},components:[Input.sketch({inputBehaviours:derive$1([Disabling.config({}),config(customEvents,[onControlAttached({onSetup,getApi},editorOffCell),onControlDetached({getApi},editorOffCell)]),config('input-update-display-text',[run$1(updateMenuText,(comp,se)=>{Representing.setValue(comp,se.event.text);}),run$1(focusout(),comp=>{spec.onAction(Representing.getValue(comp));}),run$1(change(),comp=>{spec.onAction(Representing.getValue(comp));})]),Keying.config({mode:'special',onEnter:_comp=>{changeValue(identity,true,true);return Optional.some(true);},onEscape:goToParent,onUp:_comp=>{increase(true,false);return Optional.some(true);},onDown:_comp=>{decrease(true,false);return Optional.some(true);},onLeft:(_comp,se)=>{se.cut();return Optional.none();},onRight:(_comp,se)=>{se.cut();return Optional.none();}})])})],behaviours:derive$1([Focusing.config({}),Keying.config({mode:'special',onEnter:focusInput,onSpace:focusInput,onEscape:goToParent}),config('input-wrapper-events',[run$1(mouseover(),comp=>{each$1([memMinus,memPlus],button=>{var buttonNode=SugarElement.fromDom(button.get(comp).element.dom);if(hasFocus(buttonNode)){blur$1(buttonNode);}});})])])});return{dom:{tag:'div',classes:['tox-number-input']},components:[memMinus.asSpec(),memInput.asSpec(),memPlus.asSpec()],behaviours:derive$1([Focusing.config({}),Keying.config({mode:'flow',focusInside:FocusInsideModes.OnEnterOrSpaceMode,cycles:false,selector:'button, .tox-input-wrapper',onEscape:wrapperComp=>{if(hasFocus(wrapperComp.element)){return Optional.none();}else{focus$3(wrapperComp.element);return Optional.some(true);}}})])};};var legacyFontSizes={'8pt':'1','10pt':'2','12pt':'3','14pt':'4','18pt':'5','24pt':'6','36pt':'7'};var keywordFontSizes={'xx-small':'7pt','x-small':'8pt','small':'10pt','medium':'12pt','large':'14pt','x-large':'18pt','xx-large':'24pt'};var round=(number,precision)=>{var factor=Math.pow(10,precision);return Math.round(number*factor)/factor;};var toPt=(fontSize,precision)=>{if(/[0-9.]+px$/.test(fontSize)){return round(parseInt(fontSize,10)*72/96,precision||0)+'pt';}else{return get$g(keywordFontSizes,fontSize).getOr(fontSize);}};var toLegacy=fontSize=>get$g(legacyFontSizes,fontSize).getOr('');var getSpec$1=editor=>{var getMatchingValue=()=>{var matchOpt=Optional.none();var items=dataset.data;var fontSize=editor.queryCommandValue('FontSize');if(fontSize){var _loop=function _loop(){var pt=toPt(fontSize,precision);var legacy=toLegacy(pt);matchOpt=find$5(items,item=>item.format===fontSize||item.format===pt||item.format===legacy);};for(var precision=3;matchOpt.isNone()&&precision>=0;precision--){_loop();}}return{matchOpt,size:fontSize};};var isSelectedFor=item=>valueOpt=>valueOpt.exists(value=>value.format===item);var getCurrentValue=()=>{var{matchOpt}=getMatchingValue();return matchOpt;};var getPreviewFor=constant$1(Optional.none);var onAction=rawItem=>()=>{editor.undoManager.transact(()=>{editor.focus();editor.execCommand('FontSize',false,rawItem.format);});};var updateSelectMenuText=comp=>{var{matchOpt,size}=getMatchingValue();var text=matchOpt.fold(constant$1(size),match=>match.title);emitWith(comp,updateMenuText,{text});};var dataset=buildBasicSettingsDataset(editor,'font_size_formats',Delimiter.Space);return{tooltip:'Font sizes',text:Optional.some('12pt'),icon:Optional.none(),isSelectedFor,getPreviewFor,getCurrentValue,onAction,updateText:updateSelectMenuText,dataset,shouldHide:false,isInvalid:never};};var createFontSizeButton=(editor,backstage)=>createSelectButton(editor,backstage,getSpec$1(editor));var getConfigFromUnit=unit=>{var _a;var baseConfig={step:1};var configs={em:{step:0.1},cm:{step:0.1},in:{step:0.1},pc:{step:0.1},ch:{step:0.1},rem:{step:0.1}};return(_a=configs[unit])!==null&&_a!==void 0?_a:baseConfig;};var defaultValue=16;var isValidValue=value=>value>=0;var getNumberInputSpec=editor=>{var getCurrentValue=()=>editor.queryCommandValue('FontSize');var updateInputValue=comp=>emitWith(comp,updateMenuText,{text:getCurrentValue()});return{updateInputValue,onAction:(format,focusBack)=>editor.execCommand('FontSize',false,format,{skip_focus:!focusBack}),getNewValue:(text,updateFunction)=>{parse(text,['unsupportedLength','empty']);var parsedText=parse(text,['unsupportedLength','empty']).or(parse(getCurrentValue(),['unsupportedLength','empty']));var value=parsedText.map(res=>res.value).getOr(defaultValue);var defaultUnit=getFontSizeInputDefaultUnit(editor);var unit=parsedText.map(res=>res.unit).filter(u=>u!=='').getOr(defaultUnit);var newValue=updateFunction(value,getConfigFromUnit(unit).step);return\"\".concat(isValidValue(newValue)?newValue:value).concat(unit);}};};var createFontSizeInputButton=(editor,backstage)=>createBespokeNumberInput(editor,backstage,getNumberInputSpec(editor));var createFontSizeMenu=(editor,backstage)=>{var menuItems=createMenuItems(editor,backstage,getSpec$1(editor));editor.ui.registry.addNestedMenuItem('fontsize',{text:'Font sizes',onSetup:onSetupEditableToggle(editor),getSubmenuItems:()=>menuItems.items.validateItems(menuItems.getStyleItems())});};var getSpec=(editor,dataset)=>{var fallbackFormat='Paragraph';var isSelectedFor=format=>()=>editor.formatter.match(format);var getPreviewFor=format=>()=>{var fmt=editor.formatter.get(format);return fmt!==undefined?Optional.some({tag:fmt.length>0?fmt[0].inline||fmt[0].block||'div':'div',styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none();};var updateSelectMenuText=comp=>{var getFormatItems=fmt=>{if(isNestedFormat(fmt)){return bind$3(fmt.items,getFormatItems);}else if(isFormatReference(fmt)){return[{title:fmt.title,format:fmt.format}];}else{return[];}};var flattenedItems=bind$3(getStyleFormats(editor),getFormatItems);var detectedFormat=findNearest(editor,constant$1(flattenedItems));var text=detectedFormat.fold(constant$1(fallbackFormat),fmt=>fmt.title);emitWith(comp,updateMenuText,{text});};return{tooltip:'Formats',text:Optional.some(fallbackFormat),icon:Optional.none(),isSelectedFor,getCurrentValue:Optional.none,getPreviewFor,onAction:onActionToggleFormat$1(editor),updateText:updateSelectMenuText,shouldHide:shouldAutoHideStyleFormats(editor),isInvalid:item=>!editor.formatter.canApply(item.format),dataset};};var createStylesButton=(editor,backstage)=>{var dataset=_objectSpread({type:'advanced'},backstage.styles);return createSelectButton(editor,backstage,getSpec(editor,dataset));};var createStylesMenu=(editor,backstage)=>{var dataset=_objectSpread({type:'advanced'},backstage.styles);var menuItems=createMenuItems(editor,backstage,getSpec(editor,dataset));editor.ui.registry.addNestedMenuItem('styles',{text:'Formats',onSetup:onSetupEditableToggle(editor),getSubmenuItems:()=>menuItems.items.validateItems(menuItems.getStyleItems())});};var schema$7=constant$1([required$1('toggleClass'),required$1('fetch'),onStrictHandler('onExecute'),defaulted('getHotspot',Optional.some),defaulted('getAnchorOverrides',constant$1({})),schema$y(),onStrictHandler('onItemExecute'),option$3('lazySink'),required$1('dom'),onHandler('onOpen'),field('splitDropdownBehaviours',[Coupling,Keying,Focusing]),defaulted('matchWidth',false),defaulted('useMinWidth',false),defaulted('eventOrder',{}),option$3('role')].concat(sandboxFields()));var arrowPart=required({factory:Button,schema:[required$1('dom')],name:'arrow',defaults:()=>{return{buttonBehaviours:derive$1([Focusing.revoke()])};},overrides:detail=>{return{dom:{tag:'span',attributes:{role:'presentation'}},action:arrow=>{arrow.getSystem().getByUid(detail.uid).each(emitExecute);},buttonBehaviours:derive$1([Toggling.config({toggleOnExecute:false,toggleClass:detail.toggleClass})])};}});var buttonPart=required({factory:Button,schema:[required$1('dom')],name:'button',defaults:()=>{return{buttonBehaviours:derive$1([Focusing.revoke()])};},overrides:detail=>{return{dom:{tag:'span',attributes:{role:'presentation'}},action:btn=>{btn.getSystem().getByUid(detail.uid).each(splitDropdown=>{detail.onExecute(splitDropdown,btn);});}};}});var parts$3=constant$1([arrowPart,buttonPart,optional({factory:{sketch:spec=>{return{uid:spec.uid,dom:{tag:'span',styles:{display:'none'},attributes:{'aria-hidden':'true'},innerHtml:spec.text}};}},schema:[required$1('text')],name:'aria-descriptor'}),external({schema:[tieredMenuMarkers()],name:'menu',defaults:detail=>{return{onExecute:(tmenu,item)=>{tmenu.getSystem().getByUid(detail.uid).each(splitDropdown=>{detail.onItemExecute(splitDropdown,tmenu,item);});}};}}),partType$1()]);var factory$5=(detail,components,spec,externals)=>{var switchToMenu=sandbox=>{Composing.getCurrent(sandbox).each(current=>{Highlighting.highlightFirst(current);Keying.focusIn(current);});};var action=component=>{var onOpenSync=switchToMenu;togglePopup(detail,identity,component,externals,onOpenSync,HighlightOnOpen.HighlightMenuAndItem).get(noop);};var openMenu=comp=>{action(comp);return Optional.some(true);};var executeOnButton=comp=>{var button=getPartOrDie(comp,detail,'button');emitExecute(button);return Optional.some(true);};var buttonEvents=_objectSpread(_objectSpread({},derive$2([runOnAttached((component,_simulatedEvent)=>{var ariaDescriptor=getPart(component,detail,'aria-descriptor');ariaDescriptor.each(descriptor=>{var descriptorId=generate$6('aria');set$9(descriptor.element,'id',descriptorId);set$9(component.element,'aria-describedby',descriptorId);});})])),events$a(Optional.some(action)));var apis={repositionMenus:comp=>{if(Toggling.isOn(comp)){_repositionMenus(comp);}}};return{uid:detail.uid,dom:detail.dom,components,apis,eventOrder:_objectSpread(_objectSpread({},detail.eventOrder),{},{[execute$5()]:['disabling','toggling','alloy.base.behaviour']}),events:buttonEvents,behaviours:augment(detail.splitDropdownBehaviours,[Coupling.config({others:{sandbox:hotspot=>{var arrow=getPartOrDie(hotspot,detail,'arrow');var extras={onOpen:()=>{Toggling.on(arrow);Toggling.on(hotspot);},onClose:()=>{Toggling.off(arrow);Toggling.off(hotspot);}};return makeSandbox$1(detail,hotspot,extras);}}}),Keying.config({mode:'special',onSpace:executeOnButton,onEnter:executeOnButton,onDown:openMenu}),Focusing.config({}),Toggling.config({toggleOnExecute:false,aria:{mode:'expanded'}})]),domModification:{attributes:{'role':detail.role.getOr('button'),'aria-haspopup':true}}};};var SplitDropdown=composite({name:'SplitDropdown',configFields:schema$7(),partFields:parts$3(),factory:factory$5,apis:{repositionMenus:(apis,comp)=>apis.repositionMenus(comp)}});var getButtonApi=component=>({isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state),setText:text=>emitWith(component,updateMenuText,{text}),setIcon:icon=>emitWith(component,updateMenuIcon,{icon})});var getToggleApi=component=>({setActive:state=>{Toggling.set(component,state);},isActive:()=>Toggling.isOn(component),isEnabled:()=>!Disabling.isDisabled(component),setEnabled:state=>Disabling.set(component,!state),setText:text=>emitWith(component,updateMenuText,{text}),setIcon:icon=>emitWith(component,updateMenuIcon,{icon})});var getTooltipAttributes=(tooltip,providersBackstage)=>tooltip.map(tooltip=>({'aria-label':providersBackstage.translate(tooltip),'title':providersBackstage.translate(tooltip)})).getOr({});var focusButtonEvent=generate$6('focus-button');var renderCommonStructure=(optIcon,optText,tooltip,behaviours,providersBackstage)=>{var optMemDisplayText=optText.map(text=>record(renderLabel$1(text,'tox-tbtn',providersBackstage)));var optMemDisplayIcon=optIcon.map(icon=>record(renderReplaceableIconFromPack(icon,providersBackstage.icons)));return{dom:{tag:'button',classes:['tox-tbtn'].concat(optText.isSome()?['tox-tbtn--select']:[]),attributes:getTooltipAttributes(tooltip,providersBackstage)},components:componentRenderPipeline([optMemDisplayIcon.map(mem=>mem.asSpec()),optMemDisplayText.map(mem=>mem.asSpec())]),eventOrder:{[mousedown()]:['focusing','alloy.base.behaviour',commonButtonDisplayEvent],[attachedToDom()]:[commonButtonDisplayEvent,'toolbar-group-button-events']},buttonBehaviours:derive$1([DisablingConfigs.toolbarButton(providersBackstage.isDisabled),receivingConfig(),config(commonButtonDisplayEvent,[runOnAttached((comp,_se)=>forceInitialSize(comp)),run$1(updateMenuText,(comp,se)=>{optMemDisplayText.bind(mem=>mem.getOpt(comp)).each(displayText=>{Replacing.set(displayText,[text$2(providersBackstage.translate(se.event.text))]);});}),run$1(updateMenuIcon,(comp,se)=>{optMemDisplayIcon.bind(mem=>mem.getOpt(comp)).each(displayIcon=>{Replacing.set(displayIcon,[renderReplaceableIconFromPack(se.event.icon,providersBackstage.icons)]);});}),run$1(mousedown(),(button,se)=>{se.event.prevent();emit(button,focusButtonEvent);})])].concat(behaviours.getOr([])))};};var renderFloatingToolbarButton=(spec,backstage,identifyButtons,attributes)=>{var sharedBackstage=backstage.shared;var editorOffCell=Cell(noop);var specialisation={toolbarButtonBehaviours:[],getApi:getButtonApi,onSetup:spec.onSetup};var behaviours=[config('toolbar-group-button-events',[onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)])];return FloatingToolbarButton.sketch({lazySink:sharedBackstage.getSink,fetch:()=>Future.nu(resolve=>{resolve(map$2(identifyButtons(spec.items),renderToolbarGroup));}),markers:{toggledClass:'tox-tbtn--enabled'},parts:{button:renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.some(behaviours),sharedBackstage.providers),toolbar:{dom:{tag:'div',classes:['tox-toolbar__overflow'],attributes}}}});};var renderCommonToolbarButton=(spec,specialisation,providersBackstage)=>{var _d;var editorOffCell=Cell(noop);var structure=renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),providersBackstage);return Button.sketch({dom:structure.dom,components:structure.components,eventOrder:toolbarButtonEventOrder,buttonBehaviours:_objectSpread(_objectSpread({},derive$1([config('toolbar-button-events',[onToolbarButtonExecute({onAction:spec.onAction,getApi:specialisation.getApi}),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),DisablingConfigs.toolbarButton(()=>!spec.enabled||providersBackstage.isDisabled()),receivingConfig()].concat(specialisation.toolbarButtonBehaviours))),{},{[commonButtonDisplayEvent]:(_d=structure.buttonBehaviours)===null||_d===void 0?void 0:_d[commonButtonDisplayEvent]})});};var renderToolbarButton=(spec,providersBackstage)=>renderToolbarButtonWith(spec,providersBackstage,[]);var renderToolbarButtonWith=(spec,providersBackstage,bonusEvents)=>renderCommonToolbarButton(spec,{toolbarButtonBehaviours:bonusEvents.length>0?[config('toolbarButtonWith',bonusEvents)]:[],getApi:getButtonApi,onSetup:spec.onSetup},providersBackstage);var renderToolbarToggleButton=(spec,providersBackstage)=>renderToolbarToggleButtonWith(spec,providersBackstage,[]);var renderToolbarToggleButtonWith=(spec,providersBackstage,bonusEvents)=>renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[Replacing.config({}),Toggling.config({toggleClass:'tox-tbtn--enabled',aria:{mode:'pressed'},toggleOnExecute:false})].concat(bonusEvents.length>0?[config('toolbarToggleButtonWith',bonusEvents)]:[]),getApi:getToggleApi,onSetup:spec.onSetup},providersBackstage);var fetchChoices=(getApi,spec,providersBackstage)=>comp=>Future.nu(callback=>spec.fetch(callback)).map(items=>Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6('menu-value'),items,value=>{spec.onItemAction(getApi(comp),value);},spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,spec.select.getOr(never),providersBackstage),{movement:deriveMenuMovement(spec.columns,spec.presets),menuBehaviours:SimpleBehaviours.unnamedEvents(spec.columns!=='auto'?[]:[runOnAttached((comp,_se)=>{detectSize(comp,4,classForPreset(spec.presets)).each(_ref17=>{var{numRows,numColumns}=_ref17;Keying.setGridSize(comp,numRows,numColumns);});})])}))));var renderSplitButton=(spec,sharedBackstage)=>{var getApi=comp=>({isEnabled:()=>!Disabling.isDisabled(comp),setEnabled:state=>Disabling.set(comp,!state),setIconFill:(id,value)=>{descendant(comp.element,\"svg path[class=\\\"\".concat(id,\"\\\"], rect[class=\\\"\").concat(id,\"\\\"]\")).each(underlinePath=>{set$9(underlinePath,'fill',value);});},setActive:state=>{set$9(comp.element,'aria-pressed',state);descendant(comp.element,'span').each(button=>{comp.getSystem().getByDom(button).each(buttonComp=>Toggling.set(buttonComp,state));});},isActive:()=>descendant(comp.element,'span').exists(button=>comp.getSystem().getByDom(button).exists(Toggling.isOn)),setText:text=>descendant(comp.element,'span').each(button=>comp.getSystem().getByDom(button).each(buttonComp=>emitWith(buttonComp,updateMenuText,{text}))),setIcon:icon=>descendant(comp.element,'span').each(button=>comp.getSystem().getByDom(button).each(buttonComp=>emitWith(buttonComp,updateMenuIcon,{icon})))});var editorOffCell=Cell(noop);var specialisation={getApi,onSetup:spec.onSetup};return SplitDropdown.sketch({dom:{tag:'div',classes:['tox-split-button'],attributes:_objectSpread({'aria-pressed':false},getTooltipAttributes(spec.tooltip,sharedBackstage.providers))},onExecute:button=>{var api=getApi(button);if(api.isEnabled()){spec.onAction(api);}},onItemExecute:(_a,_b,_c)=>{},splitDropdownBehaviours:derive$1([DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),config('split-dropdown-events',[runOnAttached((comp,_se)=>forceInitialSize(comp)),run$1(focusButtonEvent,Focusing.focus),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),Unselecting.config({})]),eventOrder:{[attachedToDom()]:['alloy.base.behaviour','split-dropdown-events']},toggleClass:'tox-tbtn--enabled',lazySink:sharedBackstage.getSink,fetch:fetchChoices(getApi,spec,sharedBackstage.providers),parts:{menu:part(false,spec.columns,spec.presets)},components:[SplitDropdown.parts.button(renderCommonStructure(spec.icon,spec.text,Optional.none(),Optional.some([Toggling.config({toggleClass:'tox-tbtn--enabled',toggleOnExecute:false})]),sharedBackstage.providers)),SplitDropdown.parts.arrow({dom:{tag:'button',classes:['tox-tbtn','tox-split-button__chevron'],innerHtml:get$2('chevron-down',sharedBackstage.providers.icons)},buttonBehaviours:derive$1([DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),addFocusableBehaviour()])}),SplitDropdown.parts['aria-descriptor']({text:sharedBackstage.providers.translate('To open the popup, press Shift+Enter')})]});};var defaultToolbar=[{name:'history',items:['undo','redo']},{name:'ai',items:['aidialog','aishortcuts']},{name:'styles',items:['styles']},{name:'formatting',items:['bold','italic']},{name:'alignment',items:['alignleft','aligncenter','alignright','alignjustify']},{name:'indentation',items:['outdent','indent']},{name:'permanent pen',items:['permanentpen']},{name:'comments',items:['addcomment']}];var renderFromBridge=(bridgeBuilder,render)=>(spec,backstage,editor)=>{var internal=bridgeBuilder(spec).mapError(errInfo=>formatError(errInfo)).getOrDie();return render(internal,backstage,editor);};var types={button:renderFromBridge(createToolbarButton,(s,backstage)=>renderToolbarButton(s,backstage.shared.providers)),togglebutton:renderFromBridge(createToggleButton,(s,backstage)=>renderToolbarToggleButton(s,backstage.shared.providers)),menubutton:renderFromBridge(createMenuButton,(s,backstage)=>renderMenuButton(s,'tox-tbtn',backstage,Optional.none(),false)),splitbutton:renderFromBridge(createSplitButton,(s,backstage)=>renderSplitButton(s,backstage.shared)),grouptoolbarbutton:renderFromBridge(createGroupToolbarButton,(s,backstage,editor)=>{var buttons=editor.ui.registry.getAll().buttons;var identify=toolbar=>identifyButtons(editor,{buttons,toolbar,allowToolbarGroups:false},backstage,Optional.none());var attributes={[Attribute]:backstage.shared.header.isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop};switch(getToolbarMode(editor)){case ToolbarMode$1.floating:return renderFloatingToolbarButton(s,backstage,identify,attributes);default:throw new Error('Toolbar groups are only supported when using floating toolbar mode');}})};var extractFrom=(spec,backstage,editor)=>get$g(types,spec.type).fold(()=>{console.error('skipping button defined by',spec);return Optional.none();},render=>Optional.some(render(spec,backstage,editor)));var bespokeButtons={styles:createStylesButton,fontsize:createFontSizeButton,fontsizeinput:createFontSizeInputButton,fontfamily:createFontFamilyButton,blocks:createBlocksButton,align:createAlignButton};var removeUnusedDefaults=buttons=>{var filteredItemGroups=map$2(defaultToolbar,group=>{var items=filter$2(group.items,subItem=>has$2(buttons,subItem)||has$2(bespokeButtons,subItem));return{name:group.name,items};});return filter$2(filteredItemGroups,group=>group.items.length>0);};var convertStringToolbar=strToolbar=>{var groupsStrings=strToolbar.split('|');return map$2(groupsStrings,g=>({items:g.trim().split(' ')}));};var isToolbarGroupSettingArray=toolbar=>isArrayOf(toolbar,t=>has$2(t,'name')&&has$2(t,'items'));var createToolbar=toolbarConfig=>{var toolbar=toolbarConfig.toolbar;var buttons=toolbarConfig.buttons;if(toolbar===false){return[];}else if(toolbar===undefined||toolbar===true){return removeUnusedDefaults(buttons);}else if(isString(toolbar)){return convertStringToolbar(toolbar);}else if(isToolbarGroupSettingArray(toolbar)){return toolbar;}else{console.error('Toolbar type should be string, string[], boolean or ToolbarGroup[]');return[];}};var lookupButton=(editor,buttons,toolbarItem,allowToolbarGroups,backstage,prefixes)=>get$g(buttons,toolbarItem.toLowerCase()).orThunk(()=>prefixes.bind(ps=>findMap(ps,prefix=>get$g(buttons,prefix+toolbarItem.toLowerCase())))).fold(()=>get$g(bespokeButtons,toolbarItem.toLowerCase()).map(r=>r(editor,backstage)),spec=>{if(spec.type==='grouptoolbarbutton'&&!allowToolbarGroups){console.warn(\"Ignoring the '\".concat(toolbarItem,\"' toolbar button. Group toolbar buttons are only supported when using floating toolbar mode and cannot be nested.\"));return Optional.none();}else{return extractFrom(spec,backstage,editor);}});var identifyButtons=(editor,toolbarConfig,backstage,prefixes)=>{var toolbarGroups=createToolbar(toolbarConfig);var groups=map$2(toolbarGroups,group=>{var items=bind$3(group.items,toolbarItem=>{return toolbarItem.trim().length===0?[]:lookupButton(editor,toolbarConfig.buttons,toolbarItem,toolbarConfig.allowToolbarGroups,backstage,prefixes).toArray();});return{title:Optional.from(editor.translate(group.name)),items};});return filter$2(groups,group=>group.items.length>0);};var setToolbar=(editor,uiRefs,rawUiConfig,backstage)=>{var outerContainer=uiRefs.mainUi.outerContainer;var toolbarConfig=rawUiConfig.toolbar;var toolbarButtonsConfig=rawUiConfig.buttons;if(isArrayOf(toolbarConfig,isString)){var toolbars=toolbarConfig.map(t=>{var config={toolbar:t,buttons:toolbarButtonsConfig,allowToolbarGroups:rawUiConfig.allowToolbarGroups};return identifyButtons(editor,config,backstage,Optional.none());});OuterContainer.setToolbars(outerContainer,toolbars);}else{OuterContainer.setToolbar(outerContainer,identifyButtons(editor,rawUiConfig,backstage,Optional.none()));}};var detection=detect$2();var isiOS12=detection.os.isiOS()&&detection.os.version.major<=12;var setupEvents$1=(editor,uiRefs)=>{var{uiMotherships}=uiRefs;var dom=editor.dom;var contentWindow=editor.getWin();var initialDocEle=editor.getDoc().documentElement;var lastWindowDimensions=Cell(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight));var lastDocumentDimensions=Cell(SugarPosition(initialDocEle.offsetWidth,initialDocEle.offsetHeight));var resizeWindow=()=>{var outer=lastWindowDimensions.get();if(outer.left!==contentWindow.innerWidth||outer.top!==contentWindow.innerHeight){lastWindowDimensions.set(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight));fireResizeContent(editor);}};var resizeDocument=()=>{var docEle=editor.getDoc().documentElement;var inner=lastDocumentDimensions.get();if(inner.left!==docEle.offsetWidth||inner.top!==docEle.offsetHeight){lastDocumentDimensions.set(SugarPosition(docEle.offsetWidth,docEle.offsetHeight));fireResizeContent(editor);}};var scroll=e=>{fireScrollContent(editor,e);};dom.bind(contentWindow,'resize',resizeWindow);dom.bind(contentWindow,'scroll',scroll);var elementLoad=capture(SugarElement.fromDom(editor.getBody()),'load',resizeDocument);editor.on('hide',()=>{each$1(uiMotherships,m=>{set$8(m.element,'display','none');});});editor.on('show',()=>{each$1(uiMotherships,m=>{remove$6(m.element,'display');});});editor.on('NodeChange',resizeDocument);editor.on('remove',()=>{elementLoad.unbind();dom.unbind(contentWindow,'resize',resizeWindow);dom.unbind(contentWindow,'scroll',scroll);contentWindow=null;});};var attachUiMotherships=(editor,uiRoot,uiRefs)=>{if(isSplitUiMode(editor)){attachSystemAfter(uiRefs.mainUi.mothership.element,uiRefs.popupUi.mothership);}attachSystem(uiRoot,uiRefs.dialogUi.mothership);};var render$1=/*#__PURE__*/function(){var _ref18=_asyncToGenerator(function*(editor,uiRefs,rawUiConfig,backstage,args){var{mainUi,uiMotherships}=uiRefs;var lastToolbarWidth=Cell(0);var outerContainer=mainUi.outerContainer;yield iframe(editor);var eTargetNode=SugarElement.fromDom(args.targetNode);var uiRoot=getContentContainer(getRootNode(eTargetNode));attachSystemAfter(eTargetNode,mainUi.mothership);attachUiMotherships(editor,uiRoot,uiRefs);editor.on('PostRender',()=>{OuterContainer.setSidebar(outerContainer,rawUiConfig.sidebar,getSidebarShow(editor));setToolbar(editor,uiRefs,rawUiConfig,backstage);lastToolbarWidth.set(editor.getWin().innerWidth);OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig));OuterContainer.setViews(outerContainer,rawUiConfig.views);setupEvents$1(editor,uiRefs);});var socket=OuterContainer.getSocket(outerContainer).getOrDie('Could not find expected socket element');if(isiOS12){setAll(socket.element,{'overflow':'scroll','-webkit-overflow-scrolling':'touch'});var limit=first(()=>{editor.dispatch('ScrollContent');},20);var unbinder=bind(socket.element,'scroll',limit.throttle);editor.on('remove',unbinder.unbind);}setupReadonlyModeSwitch(editor,uiRefs);editor.addCommand('ToggleSidebar',(_ui,value)=>{OuterContainer.toggleSidebar(outerContainer,value);editor.dispatch('ToggleSidebar');});editor.addQueryValueHandler('ToggleSidebar',()=>{var _a;return(_a=OuterContainer.whichSidebar(outerContainer))!==null&&_a!==void 0?_a:'';});editor.addCommand('ToggleView',(_ui,value)=>{if(OuterContainer.toggleView(outerContainer,value)){var target=outerContainer.element;mainUi.mothership.broadcastOn([dismissPopups()],{target});each$1(uiMotherships,m=>{m.broadcastOn([dismissPopups()],{target});});if(isNull(OuterContainer.whichView(outerContainer))){editor.focus();editor.nodeChanged();OuterContainer.refreshToolbar(outerContainer);}}});editor.addQueryValueHandler('ToggleView',()=>{var _a;return(_a=OuterContainer.whichView(outerContainer))!==null&&_a!==void 0?_a:'';});var toolbarMode=getToolbarMode(editor);var refreshDrawer=()=>{OuterContainer.refreshToolbar(uiRefs.mainUi.outerContainer);};if(toolbarMode===ToolbarMode$1.sliding||toolbarMode===ToolbarMode$1.floating){editor.on('ResizeWindow ResizeEditor ResizeContent',()=>{var width=editor.getWin().innerWidth;if(width!==lastToolbarWidth.get()){refreshDrawer();lastToolbarWidth.set(width);}});}var api={setEnabled:state=>{broadcastReadonly(uiRefs,!state);},isEnabled:()=>!Disabling.isDisabled(outerContainer)};return{iframeContainer:socket.element.dom,editorContainer:outerContainer.element.dom,api};});return function render$1(_x,_x2,_x3,_x4,_x5){return _ref18.apply(this,arguments);};}();var Iframe=/*#__PURE__*/Object.freeze({__proto__:null,render:render$1});var parseToInt=val=>{var re=/^[0-9\\.]+(|px)$/i;if(re.test(''+val)){return Optional.some(parseInt(''+val,10));}return Optional.none();};var numToPx=val=>isNumber(val)?val+'px':val;var calcCappedSize=(size,minSize,maxSize)=>{var minOverride=minSize.filter(min=>size<min);var maxOverride=maxSize.filter(max=>size>max);return minOverride.or(maxOverride).getOr(size);};var getHeight=editor=>{var baseHeight=getHeightOption(editor);var minHeight=getMinHeightOption(editor);var maxHeight=getMaxHeightOption(editor);return parseToInt(baseHeight).map(height=>calcCappedSize(height,minHeight,maxHeight));};var getHeightWithFallback=editor=>{var height=getHeight(editor);return height.getOr(getHeightOption(editor));};var getWidth=editor=>{var baseWidth=getWidthOption(editor);var minWidth=getMinWidthOption(editor);var maxWidth=getMaxWidthOption(editor);return parseToInt(baseWidth).map(width=>calcCappedSize(width,minWidth,maxWidth));};var getWidthWithFallback=editor=>{var width=getWidth(editor);return width.getOr(getWidthOption(editor));};var{ToolbarLocation,ToolbarMode}=Options;var maximumDistanceToEdge=40;var InlineHeader=(editor,targetElm,uiRefs,backstage,floatContainer)=>{var{mainUi,uiMotherships}=uiRefs;var DOM=global$7.DOM;var useFixedToolbarContainer=useFixedContainer(editor);var isSticky=isStickyToolbar(editor);var editorMaxWidthOpt=getMaxWidthOption(editor).or(getWidth(editor));var headerBackstage=backstage.shared.header;var isPositionedAtTop=headerBackstage.isPositionedAtTop;var toolbarMode=getToolbarMode(editor);var isSplitToolbar=toolbarMode===ToolbarMode.sliding||toolbarMode===ToolbarMode.floating;var visible=Cell(false);var isVisible=()=>visible.get()&&!editor.removed;var calcToolbarOffset=toolbar=>isSplitToolbar?toolbar.fold(constant$1(0),tbar=>tbar.components().length>1?get$d(tbar.components()[1].element):0):0;var calcMode=container=>{switch(getToolbarLocation(editor)){case ToolbarLocation.auto:var toolbar=OuterContainer.getToolbar(mainUi.outerContainer);var _offset2=calcToolbarOffset(toolbar);var toolbarHeight=get$d(container.element)-_offset2;var targetBounds=box$1(targetElm);var roomAtTop=targetBounds.y>toolbarHeight;if(roomAtTop){return'top';}else{var doc=documentElement(targetElm);var docHeight=Math.max(doc.dom.scrollHeight,get$d(doc));var roomAtBottom=targetBounds.bottom<docHeight-toolbarHeight;if(roomAtBottom){return'bottom';}else{var winBounds=win();var isRoomAtBottomViewport=winBounds.bottom<targetBounds.bottom-toolbarHeight;return isRoomAtBottomViewport?'bottom':'top';}}case ToolbarLocation.bottom:return'bottom';case ToolbarLocation.top:default:return'top';}};var setupMode=mode=>{floatContainer.on(container=>{Docking.setModes(container,[mode]);headerBackstage.setDockingMode(mode);var verticalDir=isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop;set$9(container.element,Attribute,verticalDir);});};var updateChromeWidth=()=>{floatContainer.on(container=>{var maxWidth=editorMaxWidthOpt.getOrThunk(()=>{var bodyMargin=parseToInt(get$e(body(),'margin-left')).getOr(0);return get$c(body())-absolute$3(targetElm).left+bodyMargin;});set$8(container.element,'max-width',maxWidth+'px');});};var updateChromePosition=optToolbarWidth=>{floatContainer.on(container=>{var toolbar=OuterContainer.getToolbar(mainUi.outerContainer);var offset=calcToolbarOffset(toolbar);var targetBounds=box$1(targetElm);var{top,left}=getOffsetParent$1(editor,mainUi.outerContainer.element).fold(()=>{return{top:isPositionedAtTop()?Math.max(targetBounds.y-get$d(container.element)+offset,0):targetBounds.bottom,left:targetBounds.x};},offsetParent=>{var _a;var offsetBox=box$1(offsetParent);var scrollDelta=(_a=offsetParent.dom.scrollTop)!==null&&_a!==void 0?_a:0;var isOffsetParentBody=eq(offsetParent,body());var topValue=isOffsetParentBody?Math.max(targetBounds.y-get$d(container.element)+offset,0):targetBounds.y-offsetBox.y+scrollDelta-get$d(container.element)+offset;return{top:isPositionedAtTop()?topValue:targetBounds.bottom,left:isOffsetParentBody?targetBounds.x:targetBounds.x-offsetBox.x};});var baseProperties={position:'absolute',left:Math.round(left)+'px',top:Math.round(top)+'px'};var widthProperties=optToolbarWidth.map(toolbarWidth=>{var scroll=get$b();var minimumToolbarWidth=150;var availableWidth=window.innerWidth-(left-scroll.left);var width=Math.max(Math.min(toolbarWidth,availableWidth),minimumToolbarWidth);return{width:width+'px'};}).getOr({});setAll(mainUi.outerContainer.element,_objectSpread(_objectSpread({},baseProperties),widthProperties));});};var getOffsetParent$1=(editor,element)=>isSplitUiMode(editor)?getOffsetParent(element):Optional.none();var repositionPopups$1=()=>{each$1(uiMotherships,m=>{m.broadcastOn([repositionPopups()],{});});};var restoreAndGetCompleteOuterContainerWidth=()=>{if(!useFixedToolbarContainer){var toolbarCurrentRightsidePosition=absolute$3(mainUi.outerContainer.element).left+getOuter$1(mainUi.outerContainer.element);if(toolbarCurrentRightsidePosition>=window.innerWidth-maximumDistanceToEdge||getRaw(mainUi.outerContainer.element,'width').isSome()){set$8(mainUi.outerContainer.element,'position','absolute');set$8(mainUi.outerContainer.element,'left','0px');remove$6(mainUi.outerContainer.element,'width');var w=getOuter$1(mainUi.outerContainer.element);return Optional.some(w);}else{return Optional.none();}}else{return Optional.none();}};var update=stickyAction=>{if(!isVisible()){return;}if(!useFixedToolbarContainer){updateChromeWidth();}var optToolbarWidth=useFixedToolbarContainer?Optional.none():restoreAndGetCompleteOuterContainerWidth();if(isSplitToolbar){OuterContainer.refreshToolbar(mainUi.outerContainer);}if(!useFixedToolbarContainer){updateChromePosition(optToolbarWidth);}if(isSticky){floatContainer.on(stickyAction);}repositionPopups$1();};var doUpdateMode=()=>{if(useFixedToolbarContainer||!isSticky||!isVisible()){return false;}return floatContainer.get().exists(fc=>{var currentMode=headerBackstage.getDockingMode();var newMode=calcMode(fc);if(newMode!==currentMode){setupMode(newMode);return true;}else{return false;}});};var show=()=>{visible.set(true);set$8(mainUi.outerContainer.element,'display','flex');DOM.addClass(editor.getBody(),'mce-edit-focus');each$1(uiMotherships,m=>{remove$6(m.element,'display');});doUpdateMode();if(isSplitUiMode(editor)){update(elem=>Docking.isDocked(elem)?Docking.reset(elem):Docking.refresh(elem));}else{update(Docking.refresh);}};var hide=()=>{visible.set(false);set$8(mainUi.outerContainer.element,'display','none');DOM.removeClass(editor.getBody(),'mce-edit-focus');each$1(uiMotherships,m=>{set$8(m.element,'display','none');});};var updateMode=()=>{var changedMode=doUpdateMode();if(changedMode){update(Docking.reset);}};return{isVisible,isPositionedAtTop,show,hide,update,updateMode,repositionPopups:repositionPopups$1};};var getTargetPosAndBounds=(targetElm,isToolbarTop)=>{var bounds=box$1(targetElm);return{pos:isToolbarTop?bounds.y:bounds.bottom,bounds};};var setupEvents=(editor,targetElm,ui,toolbarPersist)=>{var prevPosAndBounds=Cell(getTargetPosAndBounds(targetElm,ui.isPositionedAtTop()));var resizeContent=e=>{var{pos,bounds}=getTargetPosAndBounds(targetElm,ui.isPositionedAtTop());var{pos:prevPos,bounds:prevBounds}=prevPosAndBounds.get();var hasResized=bounds.height!==prevBounds.height||bounds.width!==prevBounds.width;prevPosAndBounds.set({pos,bounds});if(hasResized){fireResizeContent(editor,e);}if(ui.isVisible()){if(prevPos!==pos){ui.update(Docking.reset);}else if(hasResized){ui.updateMode();ui.repositionPopups();}}};if(!toolbarPersist){editor.on('activate',ui.show);editor.on('deactivate',ui.hide);}editor.on('SkinLoaded ResizeWindow',()=>ui.update(Docking.reset));editor.on('NodeChange keydown',e=>{requestAnimationFrame(()=>resizeContent(e));});var lastScrollX=0;var updateUi=last(()=>ui.update(Docking.refresh),33);editor.on('ScrollWindow',()=>{var newScrollX=get$b().left;if(newScrollX!==lastScrollX){lastScrollX=newScrollX;updateUi.throttle();}ui.updateMode();});if(isSplitUiMode(editor)){editor.on('ElementScroll',_args=>{ui.update(Docking.refresh);});}var elementLoad=unbindable();elementLoad.set(capture(SugarElement.fromDom(editor.getBody()),'load',e=>resizeContent(e.raw)));editor.on('remove',()=>{elementLoad.clear();});};var render=/*#__PURE__*/function(){var _ref19=_asyncToGenerator(function*(editor,uiRefs,rawUiConfig,backstage,args){var{mainUi}=uiRefs;var floatContainer=value$2();var targetElm=SugarElement.fromDom(args.targetNode);var ui=InlineHeader(editor,targetElm,uiRefs,backstage,floatContainer);var toolbarPersist=isToolbarPersist(editor);yield inline(editor);var render=()=>{if(floatContainer.isSet()){ui.show();return;}floatContainer.set(OuterContainer.getHeader(mainUi.outerContainer).getOrDie());var uiContainer=getUiContainer(editor);if(isSplitUiMode(editor)){attachSystemAfter(targetElm,mainUi.mothership);attachSystemAfter(targetElm,uiRefs.popupUi.mothership);}else{attachSystem(uiContainer,mainUi.mothership);}attachSystem(uiContainer,uiRefs.dialogUi.mothership);setToolbar(editor,uiRefs,rawUiConfig,backstage);OuterContainer.setMenubar(mainUi.outerContainer,identifyMenus(editor,rawUiConfig));ui.show();setupEvents(editor,targetElm,ui,toolbarPersist);editor.nodeChanged();};editor.on('show',render);editor.on('hide',ui.hide);if(!toolbarPersist){editor.on('focus',render);editor.on('blur',ui.hide);}editor.on('init',()=>{if(editor.hasFocus()||toolbarPersist){render();}});setupReadonlyModeSwitch(editor,uiRefs);var api={show:render,hide:ui.hide,setEnabled:state=>{broadcastReadonly(uiRefs,!state);},isEnabled:()=>!Disabling.isDisabled(mainUi.outerContainer)};return{editorContainer:mainUi.outerContainer.element.dom,api};});return function render(_x6,_x7,_x8,_x9,_x10){return _ref19.apply(this,arguments);};}();var Inline=/*#__PURE__*/Object.freeze({__proto__:null,render:render});var LazyUiReferences=()=>{var dialogUi=value$2();var popupUi=value$2();var mainUi=value$2();var lazyGetInOuterOrDie=(label,f)=>()=>mainUi.get().bind(oc=>f(oc.outerContainer)).getOrDie(\"Could not find \".concat(label,\" element in OuterContainer\"));var getUiMotherships=()=>{var optDialogMothership=dialogUi.get().map(ui=>ui.mothership);var optPopupMothership=popupUi.get().map(ui=>ui.mothership);return optDialogMothership.fold(()=>optPopupMothership.toArray(),dm=>optPopupMothership.fold(()=>[dm],pm=>eq(dm.element,pm.element)?[dm]:[dm,pm]));};return{dialogUi,popupUi,mainUi,getUiMotherships,lazyGetInOuterOrDie};};var showContextToolbarEvent='contexttoolbar-show';var hideContextToolbarEvent='contexttoolbar-hide';var getFormApi=input=>({hide:()=>emit(input,sandboxClose()),getValue:()=>Representing.getValue(input)});var runOnExecute=(memInput,original)=>run$1(internalToolbarButtonExecute,(comp,se)=>{var input=memInput.get(comp);var formApi=getFormApi(input);original.onAction(formApi,se.event.buttonApi);});var renderContextButton=(memInput,button,providers)=>{var _button$original=button.original,{primary}=_button$original,rest=_objectWithoutProperties(_button$original,_excluded4);var bridged=getOrDie(createToolbarButton(_objectSpread(_objectSpread({},rest),{},{type:'button',onAction:noop})));return renderToolbarButtonWith(bridged,providers,[runOnExecute(memInput,button)]);};var renderContextToggleButton=(memInput,button,providers)=>{var _button$original2=button.original,{primary}=_button$original2,rest=_objectWithoutProperties(_button$original2,_excluded5);var bridged=getOrDie(createToggleButton(_objectSpread(_objectSpread({},rest),{},{type:'togglebutton',onAction:noop})));return renderToolbarToggleButtonWith(bridged,providers,[runOnExecute(memInput,button)]);};var isToggleButton=button=>button.type==='contextformtogglebutton';var generateOne=(memInput,button,providersBackstage)=>{if(isToggleButton(button)){return renderContextToggleButton(memInput,button,providersBackstage);}else{return renderContextButton(memInput,button,providersBackstage);}};var generate=(memInput,buttons,providersBackstage)=>{var mementos=map$2(buttons,button=>record(generateOne(memInput,button,providersBackstage)));var asSpecs=()=>map$2(mementos,mem=>mem.asSpec());var findPrimary=compInSystem=>findMap(buttons,(button,i)=>{if(button.primary){return Optional.from(mementos[i]).bind(mem=>mem.getOpt(compInSystem)).filter(not(Disabling.isDisabled));}else{return Optional.none();}});return{asSpecs,findPrimary};};var buildInitGroups=(ctx,providers)=>{var inputAttributes=ctx.label.fold(()=>({}),label=>({'aria-label':label}));var memInput=record(Input.sketch({inputClasses:['tox-toolbar-textfield','tox-toolbar-nav-js'],data:ctx.initValue(),inputAttributes,selectOnFocus:true,inputBehaviours:derive$1([Keying.config({mode:'special',onEnter:input=>commands.findPrimary(input).map(primary=>{emitExecute(primary);return true;}),onLeft:(comp,se)=>{se.cut();return Optional.none();},onRight:(comp,se)=>{se.cut();return Optional.none();}})])}));var commands=generate(memInput,ctx.commands,providers);return[{title:Optional.none(),items:[memInput.asSpec()]},{title:Optional.none(),items:commands.asSpecs()}];};var renderContextForm=(toolbarType,ctx,providers)=>renderToolbar({type:toolbarType,uid:generate$6('context-toolbar'),initGroups:buildInitGroups(ctx,providers),onEscape:Optional.none,cyclicKeying:true,providers});var ContextForm={renderContextForm,buildInitGroups};var isVerticalOverlap=(a,b,threshold)=>b.bottom-a.y>=threshold&&a.bottom-b.y>=threshold;var getRangeRect=rng=>{var rect=rng.getBoundingClientRect();if(rect.height<=0&&rect.width<=0){var leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset).element;var elm=isText(leaf$1)?parent(leaf$1):Optional.some(leaf$1);return elm.filter(isElement$1).map(e=>e.dom.getBoundingClientRect()).getOr(rect);}else{return rect;}};var getSelectionBounds=editor=>{var rng=editor.selection.getRng();var rect=getRangeRect(rng);if(editor.inline){var scroll=get$b();return bounds(scroll.left+rect.left,scroll.top+rect.top,rect.width,rect.height);}else{var bodyPos=absolute$2(SugarElement.fromDom(editor.getBody()));return bounds(bodyPos.x+rect.left,bodyPos.y+rect.top,rect.width,rect.height);}};var getAnchorElementBounds=(editor,lastElement)=>lastElement.filter(elem=>inBody(elem)&&isHTMLElement(elem)).map(absolute$2).getOrThunk(()=>getSelectionBounds(editor));var getHorizontalBounds=(contentAreaBox,viewportBounds,margin)=>{var x=Math.max(contentAreaBox.x+margin,viewportBounds.x);var right=Math.min(contentAreaBox.right-margin,viewportBounds.right);return{x,width:right-x};};var getVerticalBounds=(editor,contentAreaBox,viewportBounds,isToolbarLocationTop,toolbarType,margin)=>{var container=SugarElement.fromDom(editor.getContainer());var header=descendant(container,'.tox-editor-header').getOr(container);var headerBox=box$1(header);var isToolbarBelowContentArea=headerBox.y>=contentAreaBox.bottom;var isToolbarAbove=isToolbarLocationTop&&!isToolbarBelowContentArea;if(editor.inline&&isToolbarAbove){return{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:viewportBounds.bottom};}if(editor.inline&&!isToolbarAbove){return{y:viewportBounds.y,bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)};}var containerBounds=toolbarType==='line'?box$1(container):contentAreaBox;if(isToolbarAbove){return{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:Math.min(containerBounds.bottom-margin,viewportBounds.bottom)};}return{y:Math.max(containerBounds.y+margin,viewportBounds.y),bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)};};var getContextToolbarBounds=function getContextToolbarBounds(editor,sharedBackstage,toolbarType){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var viewportBounds=getBounds$3(window);var contentAreaBox=box$1(SugarElement.fromDom(editor.getContentAreaContainer()));var toolbarOrMenubarEnabled=isMenubarEnabled(editor)||isToolbarEnabled(editor)||isMultipleToolbars(editor);var{x,width}=getHorizontalBounds(contentAreaBox,viewportBounds,margin);if(editor.inline&&!toolbarOrMenubarEnabled){return bounds(x,viewportBounds.y,width,viewportBounds.height);}else{var isToolbarTop=sharedBackstage.header.isPositionedAtTop();var{y,bottom:_bottom2}=getVerticalBounds(editor,contentAreaBox,viewportBounds,isToolbarTop,toolbarType,margin);return bounds(x,y,width,_bottom2-y);}};var bubbleSize$1=12;var bubbleAlignments$1={valignCentre:[],alignCentre:[],alignLeft:['tox-pop--align-left'],alignRight:['tox-pop--align-right'],right:['tox-pop--right'],left:['tox-pop--left'],bottom:['tox-pop--bottom'],top:['tox-pop--top'],inset:['tox-pop--inset']};var anchorOverrides={maxHeightFunction:expandable$1(),maxWidthFunction:expandable()};var isEntireElementSelected=(editor,elem)=>{var rng=editor.selection.getRng();var leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset);return rng.startContainer===rng.endContainer&&rng.startOffset===rng.endOffset-1&&eq(leaf$1.element,elem);};var preservePosition=(elem,position,f)=>{var currentPosition=getRaw(elem,'position');set$8(elem,'position',position);var result=f(elem);currentPosition.each(pos=>set$8(elem,'position',pos));return result;};var shouldUseInsetLayouts=position=>position==='node';var determineInsetLayout=(editor,contextbar,elem,data,bounds)=>{var selectionBounds=getSelectionBounds(editor);var isSameAnchorElement=data.lastElement().exists(prev=>eq(elem,prev));if(isEntireElementSelected(editor,elem)){return isSameAnchorElement?preserve:north;}else if(isSameAnchorElement){return preservePosition(contextbar,data.getMode(),()=>{var isOverlapping=isVerticalOverlap(selectionBounds,box$1(contextbar),-20);return isOverlapping&&!data.isReposition()?flip:preserve;});}else{var yBounds=data.getMode()==='fixed'?bounds.y+get$b().top:bounds.y;var contextbarHeight=get$d(contextbar)+bubbleSize$1;return yBounds+contextbarHeight<=selectionBounds.y?north:south;}};var getAnchorSpec$2=(editor,mobile,data,position)=>{var smartInsetLayout=elem=>(anchor,element,bubbles,placee,bounds)=>{var layout=determineInsetLayout(editor,placee,elem,data,bounds);var newAnchor=_objectSpread(_objectSpread({},anchor),{},{y:bounds.y,height:bounds.height});return _objectSpread(_objectSpread({},layout(newAnchor,element,bubbles,placee,bounds)),{},{alwaysFit:true});};var getInsetLayouts=elem=>shouldUseInsetLayouts(position)?[smartInsetLayout(elem)]:[];var desktopAnchorSpecLayouts={onLtr:elem=>[north$2,south$2,northeast$2,southeast$2,northwest$2,southwest$2].concat(getInsetLayouts(elem)),onRtl:elem=>[north$2,south$2,northwest$2,southwest$2,northeast$2,southeast$2].concat(getInsetLayouts(elem))};var mobileAnchorSpecLayouts={onLtr:elem=>[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2].concat(getInsetLayouts(elem)),onRtl:elem=>[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2].concat(getInsetLayouts(elem))};return mobile?mobileAnchorSpecLayouts:desktopAnchorSpecLayouts;};var getAnchorLayout=(editor,position,isTouch,data)=>{if(position==='line'){return{bubble:nu$5(bubbleSize$1,0,bubbleAlignments$1),layouts:{onLtr:()=>[east$2],onRtl:()=>[west$2]},overrides:anchorOverrides};}else{return{bubble:nu$5(0,bubbleSize$1,bubbleAlignments$1,1/bubbleSize$1),layouts:getAnchorSpec$2(editor,isTouch,data,position),overrides:anchorOverrides};}};var matchTargetWith=(elem,candidates)=>{var ctxs=filter$2(candidates,toolbarApi=>toolbarApi.predicate(elem.dom));var{pass,fail}=partition$3(ctxs,t=>t.type==='contexttoolbar');return{contextToolbars:pass,contextForms:fail};};var filterByPositionForStartNode=toolbars=>{if(toolbars.length<=1){return toolbars;}else{var doesPositionExist=value=>exists(toolbars,t=>t.position===value);var filterToolbarsByPosition=value=>filter$2(toolbars,t=>t.position===value);var hasSelectionToolbars=doesPositionExist('selection');var hasNodeToolbars=doesPositionExist('node');if(hasSelectionToolbars||hasNodeToolbars){if(hasNodeToolbars&&hasSelectionToolbars){var nodeToolbars=filterToolbarsByPosition('node');var selectionToolbars=map$2(filterToolbarsByPosition('selection'),t=>_objectSpread(_objectSpread({},t),{},{position:'node'}));return nodeToolbars.concat(selectionToolbars);}else{return hasSelectionToolbars?filterToolbarsByPosition('selection'):filterToolbarsByPosition('node');}}else{return filterToolbarsByPosition('line');}}};var filterByPositionForAncestorNode=toolbars=>{if(toolbars.length<=1){return toolbars;}else{var findPosition=value=>find$5(toolbars,t=>t.position===value);var basePosition=findPosition('selection').orThunk(()=>findPosition('node')).orThunk(()=>findPosition('line')).map(t=>t.position);return basePosition.fold(()=>[],pos=>filter$2(toolbars,t=>t.position===pos));}};var matchStartNode=(elem,nodeCandidates,editorCandidates)=>{var nodeMatches=matchTargetWith(elem,nodeCandidates);if(nodeMatches.contextForms.length>0){return Optional.some({elem,toolbars:[nodeMatches.contextForms[0]]});}else{var editorMatches=matchTargetWith(elem,editorCandidates);if(editorMatches.contextForms.length>0){return Optional.some({elem,toolbars:[editorMatches.contextForms[0]]});}else if(nodeMatches.contextToolbars.length>0||editorMatches.contextToolbars.length>0){var toolbars=filterByPositionForStartNode(nodeMatches.contextToolbars.concat(editorMatches.contextToolbars));return Optional.some({elem,toolbars});}else{return Optional.none();}}};var matchAncestor=(isRoot,startNode,scopes)=>{if(isRoot(startNode)){return Optional.none();}else{return ancestor$2(startNode,ancestorElem=>{if(isElement$1(ancestorElem)){var{contextToolbars,contextForms}=matchTargetWith(ancestorElem,scopes.inNodeScope);var toolbars=contextForms.length>0?contextForms:filterByPositionForAncestorNode(contextToolbars);return toolbars.length>0?Optional.some({elem:ancestorElem,toolbars}):Optional.none();}else{return Optional.none();}},isRoot);}};var lookup$1=(scopes,editor)=>{var rootElem=SugarElement.fromDom(editor.getBody());var isRoot=elem=>eq(elem,rootElem);var isOutsideRoot=startNode=>!isRoot(startNode)&&!contains(rootElem,startNode);var startNode=SugarElement.fromDom(editor.selection.getNode());if(isOutsideRoot(startNode)){return Optional.none();}return matchStartNode(startNode,scopes.inNodeScope,scopes.inEditorScope).orThunk(()=>matchAncestor(isRoot,startNode,scopes));};var categorise=(contextToolbars,navigate)=>{var forms={};var inNodeScope=[];var inEditorScope=[];var formNavigators={};var lookupTable={};var registerForm=(key,toolbarSpec)=>{var contextForm=getOrDie(createContextForm(toolbarSpec));forms[key]=contextForm;contextForm.launch.map(launch=>{formNavigators['form:'+key+'']=_objectSpread(_objectSpread({},toolbarSpec.launch),{},{type:launch.type==='contextformtogglebutton'?'togglebutton':'button',onAction:()=>{navigate(contextForm);}});});if(contextForm.scope==='editor'){inEditorScope.push(contextForm);}else{inNodeScope.push(contextForm);}lookupTable[key]=contextForm;};var registerToolbar=(key,toolbarSpec)=>{createContextToolbar(toolbarSpec).each(contextToolbar=>{if(toolbarSpec.scope==='editor'){inEditorScope.push(contextToolbar);}else{inNodeScope.push(contextToolbar);}lookupTable[key]=contextToolbar;});};var keys$1=keys(contextToolbars);each$1(keys$1,key=>{var toolbarApi=contextToolbars[key];if(toolbarApi.type==='contextform'){registerForm(key,toolbarApi);}else if(toolbarApi.type==='contexttoolbar'){registerToolbar(key,toolbarApi);}});return{forms,inNodeScope,inEditorScope,lookupTable,formNavigators};};var forwardSlideEvent=generate$6('forward-slide');var backSlideEvent=generate$6('backward-slide');var changeSlideEvent=generate$6('change-slide-event');var resizingClass='tox-pop--resizing';var renderContextToolbar=spec=>{var stack=Cell([]);return InlineView.sketch({dom:{tag:'div',classes:['tox-pop']},fireDismissalEventInstead:{event:'doNotDismissYet'},onShow:comp=>{stack.set([]);InlineView.getContent(comp).each(c=>{remove$6(c.element,'visibility');});remove$2(comp.element,resizingClass);remove$6(comp.element,'width');},inlineBehaviours:derive$1([config('context-toolbar-events',[runOnSource(transitionend(),(comp,se)=>{if(se.event.raw.propertyName==='width'){remove$2(comp.element,resizingClass);remove$6(comp.element,'width');}}),run$1(changeSlideEvent,(comp,se)=>{var elem=comp.element;remove$6(elem,'width');var currentWidth=get$c(elem);InlineView.setContent(comp,se.event.contents);add$2(elem,resizingClass);var newWidth=get$c(elem);set$8(elem,'width',currentWidth+'px');InlineView.getContent(comp).each(newContents=>{se.event.focus.bind(f=>{focus$3(f);return search(elem);}).orThunk(()=>{Keying.focusIn(newContents);return active$1(getRootNode(elem));});});setTimeout(()=>{set$8(comp.element,'width',newWidth+'px');},0);}),run$1(forwardSlideEvent,(comp,se)=>{InlineView.getContent(comp).each(oldContents=>{stack.set(stack.get().concat([{bar:oldContents,focus:active$1(getRootNode(comp.element))}]));});emitWith(comp,changeSlideEvent,{contents:se.event.forwardContents,focus:Optional.none()});}),run$1(backSlideEvent,(comp,_se)=>{last$1(stack.get()).each(last=>{stack.set(stack.get().slice(0,stack.get().length-1));emitWith(comp,changeSlideEvent,{contents:premade(last.bar),focus:last.focus});});})]),Keying.config({mode:'special',onEscape:comp=>last$1(stack.get()).fold(()=>spec.onEscape(),_=>{emit(comp,backSlideEvent);return Optional.some(true);})})]),lazySink:()=>Result.value(spec.sink)});};var transitionClass='tox-pop--transition';var register$9=(editor,registryContextToolbars,sink,extras)=>{var backstage=extras.backstage;var sharedBackstage=backstage.shared;var isTouch=detect$2().deviceType.isTouch;var lastElement=value$2();var lastTrigger=value$2();var lastContextPosition=value$2();var contextbar=build$1(renderContextToolbar({sink,onEscape:()=>{editor.focus();return Optional.some(true);}}));var getBounds=()=>{var position=lastContextPosition.get().getOr('node');var margin=shouldUseInsetLayouts(position)?1:0;return getContextToolbarBounds(editor,sharedBackstage,position,margin);};var canLaunchToolbar=()=>{return!editor.removed&&!(isTouch()&&backstage.isContextMenuOpen());};var isSameLaunchElement=elem=>is$1(lift2(elem,lastElement.get(),eq),true);var shouldContextToolbarHide=()=>{if(!canLaunchToolbar()){return true;}else{var contextToolbarBounds=getBounds();var anchorBounds=is$1(lastContextPosition.get(),'node')?getAnchorElementBounds(editor,lastElement.get()):getSelectionBounds(editor);return contextToolbarBounds.height<=0||!isVerticalOverlap(anchorBounds,contextToolbarBounds,0.01);}};var close=()=>{lastElement.clear();lastTrigger.clear();lastContextPosition.clear();InlineView.hide(contextbar);};var hideOrRepositionIfNecessary=()=>{if(InlineView.isOpen(contextbar)){var contextBarEle=contextbar.element;remove$6(contextBarEle,'display');if(shouldContextToolbarHide()){set$8(contextBarEle,'display','none');}else{lastTrigger.set(0);InlineView.reposition(contextbar);}}};var wrapInPopDialog=toolbarSpec=>({dom:{tag:'div',classes:['tox-pop__dialog']},components:[toolbarSpec],behaviours:derive$1([Keying.config({mode:'acyclic'}),config('pop-dialog-wrap-events',[runOnAttached(comp=>{editor.shortcuts.add('ctrl+F9','focus statusbar',()=>Keying.focusIn(comp));}),runOnDetached(_comp=>{editor.shortcuts.remove('ctrl+F9');})])])});var getScopes=cached(()=>categorise(registryContextToolbars,toolbarApi=>{var alloySpec=buildToolbar([toolbarApi]);emitWith(contextbar,forwardSlideEvent,{forwardContents:wrapInPopDialog(alloySpec)});}));var buildContextToolbarGroups=(allButtons,ctx)=>identifyButtons(editor,{buttons:allButtons,toolbar:ctx.items,allowToolbarGroups:false},extras.backstage,Optional.some(['form:']));var buildContextFormGroups=(ctx,providers)=>ContextForm.buildInitGroups(ctx,providers);var buildToolbar=toolbars=>{var{buttons}=editor.ui.registry.getAll();var scopes=getScopes();var allButtons=_objectSpread(_objectSpread({},buttons),scopes.formNavigators);var toolbarType=getToolbarMode(editor)===ToolbarMode$1.scrolling?ToolbarMode$1.scrolling:ToolbarMode$1.default;var initGroups=flatten(map$2(toolbars,ctx=>ctx.type==='contexttoolbar'?buildContextToolbarGroups(allButtons,ctx):buildContextFormGroups(ctx,sharedBackstage.providers)));return renderToolbar({type:toolbarType,uid:generate$6('context-toolbar'),initGroups,onEscape:Optional.none,cyclicKeying:true,providers:sharedBackstage.providers});};var getAnchor=(position,element)=>{var anchorage=position==='node'?sharedBackstage.anchors.node(element):sharedBackstage.anchors.cursor();var anchorLayout=getAnchorLayout(editor,position,isTouch(),{lastElement:lastElement.get,isReposition:()=>is$1(lastTrigger.get(),0),getMode:()=>Positioning.getMode(sink)});return deepMerge(anchorage,anchorLayout);};var launchContext=(toolbarApi,elem)=>{launchContextToolbar.cancel();if(!canLaunchToolbar()){return;}var toolbarSpec=buildToolbar(toolbarApi);var position=toolbarApi[0].position;var anchor=getAnchor(position,elem);lastContextPosition.set(position);lastTrigger.set(1);var contextBarEle=contextbar.element;remove$6(contextBarEle,'display');if(!isSameLaunchElement(elem)){remove$2(contextBarEle,transitionClass);Positioning.reset(sink,contextbar);}InlineView.showWithinBounds(contextbar,wrapInPopDialog(toolbarSpec),{anchor,transition:{classes:[transitionClass],mode:'placement'}},()=>Optional.some(getBounds()));elem.fold(lastElement.clear,lastElement.set);if(shouldContextToolbarHide()){set$8(contextBarEle,'display','none');}};var isDragging=false;var launchContextToolbar=last(()=>{if(!editor.hasFocus()||editor.removed||isDragging){return;}if(has(contextbar.element,transitionClass)){launchContextToolbar.throttle();}else{var scopes=getScopes();lookup$1(scopes,editor).fold(close,info=>{launchContext(info.toolbars,Optional.some(info.elem));});}},17);editor.on('init',()=>{editor.on('remove',close);editor.on('ScrollContent ScrollWindow ObjectResized ResizeEditor longpress',hideOrRepositionIfNecessary);editor.on('click keyup focus SetContent',launchContextToolbar.throttle);editor.on(hideContextToolbarEvent,close);editor.on(showContextToolbarEvent,e=>{var scopes=getScopes();get$g(scopes.lookupTable,e.toolbarKey).each(ctx=>{launchContext([ctx],someIf(e.target!==editor,e.target));InlineView.getContent(contextbar).each(Keying.focusIn);});});editor.on('focusout',_e=>{global$9.setEditorTimeout(editor,()=>{if(search(sink.element).isNone()&&search(contextbar.element).isNone()){close();}},0);});editor.on('SwitchMode',()=>{if(editor.mode.isReadOnly()){close();}});editor.on('AfterProgressState',event=>{if(event.state){close();}else if(editor.hasFocus()){launchContextToolbar.throttle();}});editor.on('dragstart',()=>{isDragging=true;});editor.on('dragend drop',()=>{isDragging=false;});editor.on('NodeChange',_e=>{search(contextbar.element).fold(launchContextToolbar.throttle,noop);});});};var register$8=editor=>{var alignToolbarButtons=[{name:'alignleft',text:'Align left',cmd:'JustifyLeft',icon:'align-left'},{name:'aligncenter',text:'Align center',cmd:'JustifyCenter',icon:'align-center'},{name:'alignright',text:'Align right',cmd:'JustifyRight',icon:'align-right'},{name:'alignjustify',text:'Justify',cmd:'JustifyFull',icon:'align-justify'}];each$1(alignToolbarButtons,item=>{editor.ui.registry.addToggleButton(item.name,{tooltip:item.text,icon:item.icon,onAction:onActionExecCommand(editor,item.cmd),onSetup:onSetupStateToggle(editor,item.name)});});editor.ui.registry.addButton('alignnone',{tooltip:'No alignment',icon:'align-none',onSetup:onSetupEditableToggle(editor),onAction:onActionExecCommand(editor,'JustifyNone')});};var registerController=(editor,spec)=>{var getMenuItems=()=>{var options=spec.getOptions(editor);var initial=spec.getCurrent(editor).map(spec.hash);var current=value$2();return map$2(options,value=>({type:'togglemenuitem',text:spec.display(value),onSetup:api=>{var setActive=active=>{if(active){current.on(oldApi=>oldApi.setActive(false));current.set(api);}api.setActive(active);};setActive(is$1(initial,spec.hash(value)));var unbindWatcher=spec.watcher(editor,value,setActive);return()=>{current.clear();unbindWatcher();};},onAction:()=>spec.setCurrent(editor,value)}));};editor.ui.registry.addMenuButton(spec.name,{tooltip:spec.text,icon:spec.icon,fetch:callback=>callback(getMenuItems()),onSetup:spec.onToolbarSetup});editor.ui.registry.addNestedMenuItem(spec.name,{type:'nestedmenuitem',text:spec.text,getSubmenuItems:getMenuItems,onSetup:spec.onMenuSetup});};var lineHeightSpec=editor=>({name:'lineheight',text:'Line height',icon:'line-height',getOptions:getLineHeightFormats,hash:input=>normalise(input,['fixed','relative','empty']).getOr(input),display:identity,watcher:(editor,value,callback)=>editor.formatter.formatChanged('lineheight',callback,false,{value}).unbind,getCurrent:editor=>Optional.from(editor.queryCommandValue('LineHeight')),setCurrent:(editor,value)=>editor.execCommand('LineHeight',false,value),onToolbarSetup:onSetupEditableToggle(editor),onMenuSetup:onSetupEditableToggle(editor)});var languageSpec=editor=>{var settingsOpt=Optional.from(getContentLanguages(editor));return settingsOpt.map(settings=>({name:'language',text:'Language',icon:'language',getOptions:constant$1(settings),hash:input=>isUndefined(input.customCode)?input.code:\"\".concat(input.code,\"/\").concat(input.customCode),display:input=>input.title,watcher:(editor,value,callback)=>{var _a;return editor.formatter.formatChanged('lang',callback,false,{value:value.code,customValue:(_a=value.customCode)!==null&&_a!==void 0?_a:null}).unbind;},getCurrent:editor=>{var node=SugarElement.fromDom(editor.selection.getNode());return closest$4(node,n=>Optional.some(n).filter(isElement$1).bind(ele=>{var codeOpt=getOpt(ele,'lang');return codeOpt.map(code=>{var customCode=getOpt(ele,'data-mce-lang').getOrUndefined();return{code,customCode,title:''};});}));},setCurrent:(editor,lang)=>editor.execCommand('Lang',false,lang),onToolbarSetup:api=>{var unbinder=unbindable();api.setActive(editor.formatter.match('lang',{},undefined,true));unbinder.set(editor.formatter.formatChanged('lang',api.setActive,true));return composeUnbinders(unbinder.clear,onSetupEditableToggle(editor)(api));},onMenuSetup:onSetupEditableToggle(editor)}));};var register$7=editor=>{registerController(editor,lineHeightSpec(editor));languageSpec(editor).each(spec=>registerController(editor,spec));};var register$6=(editor,backstage)=>{createAlignMenu(editor,backstage);createFontFamilyMenu(editor,backstage);createStylesMenu(editor,backstage);createBlocksMenu(editor,backstage);createFontSizeMenu(editor,backstage);};var onSetupOutdentState=editor=>onSetupEvent(editor,'NodeChange',api=>{api.setEnabled(editor.queryCommandState('outdent')&&editor.selection.isEditable());});var registerButtons$2=editor=>{editor.ui.registry.addButton('outdent',{tooltip:'Decrease indent',icon:'outdent',onSetup:onSetupOutdentState(editor),onAction:onActionExecCommand(editor,'outdent')});editor.ui.registry.addButton('indent',{tooltip:'Increase indent',icon:'indent',onSetup:onSetupEditableToggle(editor),onAction:onActionExecCommand(editor,'indent')});};var register$5=editor=>{registerButtons$2(editor);};var makeSetupHandler=(editor,pasteAsText)=>api=>{api.setActive(pasteAsText.get());var pastePlainTextToggleHandler=e=>{pasteAsText.set(e.state);api.setActive(e.state);};editor.on('PastePlainTextToggle',pastePlainTextToggleHandler);return composeUnbinders(()=>editor.off('PastePlainTextToggle',pastePlainTextToggleHandler),onSetupEditableToggle(editor)(api));};var register$4=editor=>{var pasteAsText=Cell(getPasteAsText(editor));var onAction=()=>editor.execCommand('mceTogglePlainTextPaste');editor.ui.registry.addToggleButton('pastetext',{active:false,icon:'paste-text',tooltip:'Paste as text',onAction,onSetup:makeSetupHandler(editor,pasteAsText)});editor.ui.registry.addToggleMenuItem('pastetext',{text:'Paste as text',icon:'paste-text',onAction,onSetup:makeSetupHandler(editor,pasteAsText)});};var onActionToggleFormat=(editor,fmt)=>()=>{editor.execCommand('mceToggleFormat',false,fmt);};var registerFormatButtons=editor=>{global$1.each([{name:'bold',text:'Bold',icon:'bold'},{name:'italic',text:'Italic',icon:'italic'},{name:'underline',text:'Underline',icon:'underline'},{name:'strikethrough',text:'Strikethrough',icon:'strike-through'},{name:'subscript',text:'Subscript',icon:'subscript'},{name:'superscript',text:'Superscript',icon:'superscript'}],(btn,_idx)=>{editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onSetup:onSetupStateToggle(editor,btn.name),onAction:onActionToggleFormat(editor,btn.name)});});for(var i=1;i<=6;i++){var _name2='h'+i;editor.ui.registry.addToggleButton(_name2,{text:_name2.toUpperCase(),tooltip:'Heading '+i,onSetup:onSetupStateToggle(editor,_name2),onAction:onActionToggleFormat(editor,_name2)});}};var registerCommandButtons=editor=>{global$1.each([{name:'copy',text:'Copy',action:'Copy',icon:'copy'},{name:'help',text:'Help',action:'mceHelp',icon:'help'},{name:'selectall',text:'Select all',action:'SelectAll',icon:'select-all'},{name:'newdocument',text:'New document',action:'mceNewDocument',icon:'new-document'},{name:'print',text:'Print',action:'mcePrint',icon:'print'}],btn=>{editor.ui.registry.addButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action)});});global$1.each([{name:'cut',text:'Cut',action:'Cut',icon:'cut'},{name:'paste',text:'Paste',action:'Paste',icon:'paste'},{name:'removeformat',text:'Clear formatting',action:'RemoveFormat',icon:'remove-formatting'},{name:'remove',text:'Remove',action:'Delete',icon:'remove'},{name:'hr',text:'Horizontal line',action:'InsertHorizontalRule',icon:'horizontal-rule'}],btn=>{editor.ui.registry.addButton(btn.name,{tooltip:btn.text,icon:btn.icon,onSetup:onSetupEditableToggle(editor),onAction:onActionExecCommand(editor,btn.action)});});};var registerCommandToggleButtons=editor=>{global$1.each([{name:'blockquote',text:'Blockquote',action:'mceBlockQuote',icon:'quote'}],btn=>{editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action),onSetup:onSetupStateToggle(editor,btn.name)});});};var registerButtons$1=editor=>{registerFormatButtons(editor);registerCommandButtons(editor);registerCommandToggleButtons(editor);};var registerMenuItems$2=editor=>{global$1.each([{name:'newdocument',text:'New document',action:'mceNewDocument',icon:'new-document'},{name:'copy',text:'Copy',action:'Copy',icon:'copy',shortcut:'Meta+C'},{name:'selectall',text:'Select all',action:'SelectAll',icon:'select-all',shortcut:'Meta+A'},{name:'print',text:'Print...',action:'mcePrint',icon:'print',shortcut:'Meta+P'}],menuitem=>{editor.ui.registry.addMenuItem(menuitem.name,{text:menuitem.text,icon:menuitem.icon,shortcut:menuitem.shortcut,onAction:onActionExecCommand(editor,menuitem.action)});});global$1.each([{name:'bold',text:'Bold',action:'Bold',icon:'bold',shortcut:'Meta+B'},{name:'italic',text:'Italic',action:'Italic',icon:'italic',shortcut:'Meta+I'},{name:'underline',text:'Underline',action:'Underline',icon:'underline',shortcut:'Meta+U'},{name:'strikethrough',text:'Strikethrough',action:'Strikethrough',icon:'strike-through'},{name:'subscript',text:'Subscript',action:'Subscript',icon:'subscript'},{name:'superscript',text:'Superscript',action:'Superscript',icon:'superscript'},{name:'removeformat',text:'Clear formatting',action:'RemoveFormat',icon:'remove-formatting'},{name:'cut',text:'Cut',action:'Cut',icon:'cut',shortcut:'Meta+X'},{name:'paste',text:'Paste',action:'Paste',icon:'paste',shortcut:'Meta+V'},{name:'hr',text:'Horizontal line',action:'InsertHorizontalRule',icon:'horizontal-rule'}],menuitem=>{editor.ui.registry.addMenuItem(menuitem.name,{text:menuitem.text,icon:menuitem.icon,shortcut:menuitem.shortcut,onSetup:onSetupEditableToggle(editor),onAction:onActionExecCommand(editor,menuitem.action)});});editor.ui.registry.addMenuItem('codeformat',{text:'Code',icon:'sourcecode',onSetup:onSetupEditableToggle(editor),onAction:onActionToggleFormat(editor,'code')});};var register$3=editor=>{registerButtons$1(editor);registerMenuItems$2(editor);};var onSetupUndoRedoState=(editor,type)=>onSetupEvent(editor,'Undo Redo AddUndo TypingUndo ClearUndos SwitchMode',api=>{api.setEnabled(!editor.mode.isReadOnly()&&editor.undoManager[type]());});var registerMenuItems$1=editor=>{editor.ui.registry.addMenuItem('undo',{text:'Undo',icon:'undo',shortcut:'Meta+Z',onSetup:onSetupUndoRedoState(editor,'hasUndo'),onAction:onActionExecCommand(editor,'undo')});editor.ui.registry.addMenuItem('redo',{text:'Redo',icon:'redo',shortcut:'Meta+Y',onSetup:onSetupUndoRedoState(editor,'hasRedo'),onAction:onActionExecCommand(editor,'redo')});};var registerButtons=editor=>{editor.ui.registry.addButton('undo',{tooltip:'Undo',icon:'undo',enabled:false,onSetup:onSetupUndoRedoState(editor,'hasUndo'),onAction:onActionExecCommand(editor,'undo')});editor.ui.registry.addButton('redo',{tooltip:'Redo',icon:'redo',enabled:false,onSetup:onSetupUndoRedoState(editor,'hasRedo'),onAction:onActionExecCommand(editor,'redo')});};var register$2=editor=>{registerMenuItems$1(editor);registerButtons(editor);};var onSetupVisualAidState=editor=>onSetupEvent(editor,'VisualAid',api=>{api.setActive(editor.hasVisual);});var registerMenuItems=editor=>{editor.ui.registry.addToggleMenuItem('visualaid',{text:'Visual aids',onSetup:onSetupVisualAidState(editor),onAction:onActionExecCommand(editor,'mceToggleVisualAid')});};var registerToolbarButton=editor=>{editor.ui.registry.addButton('visualaid',{tooltip:'Visual aids',text:'Visual aids',onAction:onActionExecCommand(editor,'mceToggleVisualAid')});};var register$1=editor=>{registerToolbarButton(editor);registerMenuItems(editor);};var setup$6=(editor,backstage)=>{register$8(editor);register$3(editor);register$6(editor,backstage);register$2(editor);register$c(editor);register$1(editor);register$5(editor);register$7(editor);register$4(editor);};var patchPipeConfig=config=>isString(config)?config.split(/[ ,]/):config;var option=name=>editor=>editor.options.get(name);var register=editor=>{var registerOption=editor.options.register;registerOption('contextmenu_avoid_overlap',{processor:'string',default:''});registerOption('contextmenu_never_use_native',{processor:'boolean',default:false});registerOption('contextmenu',{processor:value=>{if(value===false){return{value:[],valid:true};}else if(isString(value)||isArrayOf(value,isString)){return{value:patchPipeConfig(value),valid:true};}else{return{valid:false,message:'Must be false or a string.'};}},default:'link linkchecker image editimage table spellchecker configurepermanentpen'});};var shouldNeverUseNative=option('contextmenu_never_use_native');var getAvoidOverlapSelector=option('contextmenu_avoid_overlap');var isContextMenuDisabled=editor=>getContextMenu(editor).length===0;var getContextMenu=editor=>{var contextMenus=editor.ui.registry.getAll().contextMenus;var contextMenu=editor.options.get('contextmenu');if(editor.options.isSet('contextmenu')){return contextMenu;}else{return filter$2(contextMenu,item=>has$2(contextMenus,item));}};var nu=(x,y)=>({type:'makeshift',x,y});var transpose=(pos,dx,dy)=>{return nu(pos.x+dx,pos.y+dy);};var isTouchEvent$1=e=>e.type==='longpress'||e.type.indexOf('touch')===0;var fromPageXY=e=>{if(isTouchEvent$1(e)){var _touch=e.touches[0];return nu(_touch.pageX,_touch.pageY);}else{return nu(e.pageX,e.pageY);}};var fromClientXY=e=>{if(isTouchEvent$1(e)){var _touch2=e.touches[0];return nu(_touch2.clientX,_touch2.clientY);}else{return nu(e.clientX,e.clientY);}};var transposeContentAreaContainer=(element,pos)=>{var containerPos=global$7.DOM.getPos(element);return transpose(pos,containerPos.x,containerPos.y);};var getPointAnchor=(editor,e)=>{if(e.type==='contextmenu'||e.type==='longpress'){if(editor.inline){return fromPageXY(e);}else{return transposeContentAreaContainer(editor.getContentAreaContainer(),fromClientXY(e));}}else{return getSelectionAnchor(editor);}};var getSelectionAnchor=editor=>{return{type:'selection',root:SugarElement.fromDom(editor.selection.getNode())};};var getNodeAnchor=editor=>({type:'node',node:Optional.some(SugarElement.fromDom(editor.selection.getNode())),root:SugarElement.fromDom(editor.getBody())});var getAnchorSpec$1=(editor,e,anchorType)=>{switch(anchorType){case'node':return getNodeAnchor(editor);case'point':return getPointAnchor(editor,e);case'selection':return getSelectionAnchor(editor);}};var initAndShow$1=(editor,e,buildMenu,backstage,contextmenu,anchorType)=>{var items=buildMenu();var anchorSpec=getAnchorSpec$1(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,{isHorizontalMenu:false,search:Optional.none()}).map(menuData=>{e.preventDefault();InlineView.showMenuAt(contextmenu,{anchor:anchorSpec},{menu:{markers:markers('normal')},data:menuData});});};var layouts={onLtr:()=>[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2,north,south,northeast,southeast,northwest,southwest],onRtl:()=>[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2,north,south,northwest,southwest,northeast,southeast]};var bubbleSize=12;var bubbleAlignments={valignCentre:[],alignCentre:[],alignLeft:['tox-pop--align-left'],alignRight:['tox-pop--align-right'],right:['tox-pop--right'],left:['tox-pop--left'],bottom:['tox-pop--bottom'],top:['tox-pop--top']};var isTouchWithinSelection=(editor,e)=>{var selection=editor.selection;if(selection.isCollapsed()||e.touches.length<1){return false;}else{var _touch3=e.touches[0];var rng=selection.getRng();var rngRectOpt=getFirstRect(editor.getWin(),SimSelection.domRange(rng));return rngRectOpt.exists(rngRect=>rngRect.left<=_touch3.clientX&&rngRect.right>=_touch3.clientX&&rngRect.top<=_touch3.clientY&&rngRect.bottom>=_touch3.clientY);}};var setupiOSOverrides=editor=>{var originalSelection=editor.selection.getRng();var selectionReset=()=>{global$9.setEditorTimeout(editor,()=>{editor.selection.setRng(originalSelection);},10);unbindEventListeners();};editor.once('touchend',selectionReset);var preventMousedown=e=>{e.preventDefault();e.stopImmediatePropagation();};editor.on('mousedown',preventMousedown,true);var clearSelectionReset=()=>unbindEventListeners();editor.once('longpresscancel',clearSelectionReset);var unbindEventListeners=()=>{editor.off('touchend',selectionReset);editor.off('longpresscancel',clearSelectionReset);editor.off('mousedown',preventMousedown);};};var getAnchorSpec=(editor,e,anchorType)=>{var anchorSpec=getAnchorSpec$1(editor,e,anchorType);var bubbleYOffset=anchorType==='point'?bubbleSize:0;return _objectSpread({bubble:nu$5(0,bubbleYOffset,bubbleAlignments),layouts,overrides:{maxWidthFunction:expandable(),maxHeightFunction:expandable$1()}},anchorSpec);};var show=(editor,e,items,backstage,contextmenu,anchorType,highlightImmediately)=>{var anchorSpec=getAnchorSpec(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,{isHorizontalMenu:true,search:Optional.none()}).map(menuData=>{e.preventDefault();var highlightOnOpen=highlightImmediately?HighlightOnOpen.HighlightMenuAndItem:HighlightOnOpen.HighlightNone;InlineView.showMenuWithinBounds(contextmenu,{anchor:anchorSpec},{menu:{markers:markers('normal'),highlightOnOpen},data:menuData,type:'horizontal'},()=>Optional.some(getContextToolbarBounds(editor,backstage.shared,anchorType==='node'?'node':'selection')));editor.dispatch(hideContextToolbarEvent);});};var initAndShow=(editor,e,buildMenu,backstage,contextmenu,anchorType)=>{var detection=detect$2();var isiOS=detection.os.isiOS();var isMacOS=detection.os.isMacOS();var isAndroid=detection.os.isAndroid();var isTouch=detection.deviceType.isTouch();var shouldHighlightImmediately=()=>!(isAndroid||isiOS||isMacOS&&isTouch);var open=()=>{var items=buildMenu();show(editor,e,items,backstage,contextmenu,anchorType,shouldHighlightImmediately());};if((isMacOS||isiOS)&&anchorType!=='node'){var openiOS=()=>{setupiOSOverrides(editor);open();};if(isTouchWithinSelection(editor,e)){openiOS();}else{editor.once('selectionchange',openiOS);editor.once('touchend',()=>editor.off('selectionchange',openiOS));}}else{open();}};var isSeparator=item=>isString(item)?item==='|':item.type==='separator';var separator={type:'separator'};var makeContextItem=item=>{var commonMenuItem=item=>({text:item.text,icon:item.icon,enabled:item.enabled,shortcut:item.shortcut});if(isString(item)){return item;}else{switch(item.type){case'separator':return separator;case'submenu':return _objectSpread(_objectSpread({type:'nestedmenuitem'},commonMenuItem(item)),{},{getSubmenuItems:()=>{var items=item.getSubmenuItems();if(isString(items)){return items;}else{return map$2(items,makeContextItem);}}});default:var commonItem=item;return _objectSpread(_objectSpread({type:'menuitem'},commonMenuItem(commonItem)),{},{onAction:noarg(commonItem.onAction)});}}};var addContextMenuGroup=(xs,groupItems)=>{if(groupItems.length===0){return xs;}var lastMenuItem=last$1(xs).filter(item=>!isSeparator(item));var before=lastMenuItem.fold(()=>[],_=>[separator]);return xs.concat(before).concat(groupItems).concat([separator]);};var generateContextMenu=(contextMenus,menuConfig,selectedElement)=>{var sections=foldl(menuConfig,(acc,name)=>{return get$g(contextMenus,name.toLowerCase()).map(menu=>{var items=menu.update(selectedElement);if(isString(items)&&isNotEmpty(trim$1(items))){return addContextMenuGroup(acc,items.split(' '));}else if(isArray(items)&&items.length>0){var allItems=map$2(items,makeContextItem);return addContextMenuGroup(acc,allItems);}else{return acc;}}).getOrThunk(()=>acc.concat([name]));},[]);if(sections.length>0&&isSeparator(sections[sections.length-1])){sections.pop();}return sections;};var isNativeOverrideKeyEvent=(editor,e)=>e.ctrlKey&&!shouldNeverUseNative(editor);var isTouchEvent=e=>e.type==='longpress'||has$2(e,'touches');var isTriggeredByKeyboard=(editor,e)=>!isTouchEvent(e)&&(e.button!==2||e.target===editor.getBody()&&e.pointerType==='');var getSelectedElement=(editor,e)=>isTriggeredByKeyboard(editor,e)?editor.selection.getStart(true):e.target;var getAnchorType=(editor,e)=>{var selector=getAvoidOverlapSelector(editor);var anchorType=isTriggeredByKeyboard(editor,e)?'selection':'point';if(isNotEmpty(selector)){var target=getSelectedElement(editor,e);var selectorExists=closest(SugarElement.fromDom(target),selector);return selectorExists?'node':anchorType;}else{return anchorType;}};var setup$5=(editor,lazySink,backstage)=>{var detection=detect$2();var isTouch=detection.deviceType.isTouch;var contextmenu=build$1(InlineView.sketch({dom:{tag:'div'},lazySink,onEscape:()=>editor.focus(),onShow:()=>backstage.setContextMenuState(true),onHide:()=>backstage.setContextMenuState(false),fireDismissalEventInstead:{},inlineBehaviours:derive$1([config('dismissContextMenu',[run$1(dismissRequested(),(comp,_se)=>{Sandboxing.close(comp);editor.focus();})])])}));var hideContextMenu=()=>InlineView.hide(contextmenu);var showContextMenu=e=>{if(shouldNeverUseNative(editor)){e.preventDefault();}if(isNativeOverrideKeyEvent(editor,e)||isContextMenuDisabled(editor)){return;}var anchorType=getAnchorType(editor,e);var buildMenu=()=>{var selectedElement=getSelectedElement(editor,e);var registry=editor.ui.registry.getAll();var menuConfig=getContextMenu(editor);return generateContextMenu(registry.contextMenus,menuConfig,selectedElement);};var initAndShow$2=isTouch()?initAndShow:initAndShow$1;initAndShow$2(editor,e,buildMenu,backstage,contextmenu,anchorType);};editor.on('init',()=>{var hideEvents='ResizeEditor ScrollContent ScrollWindow longpresscancel'+(isTouch()?'':' ResizeWindow');editor.on(hideEvents,hideContextMenu);editor.on('longpress contextmenu',showContextMenu);});};var adt=Adt.generate([{offset:['x','y']},{absolute:['x','y']},{fixed:['x','y']}]);var subtract=change=>point=>point.translate(-change.left,-change.top);var add=change=>point=>point.translate(change.left,change.top);var transform=changes=>(x,y)=>foldl(changes,(rest,f)=>f(rest),SugarPosition(x,y));var asFixed=(coord,scroll,origin)=>coord.fold(transform([add(origin),subtract(scroll)]),transform([subtract(scroll)]),transform([]));var asAbsolute=(coord,scroll,origin)=>coord.fold(transform([add(origin)]),transform([]),transform([add(scroll)]));var asOffset=(coord,scroll,origin)=>coord.fold(transform([]),transform([subtract(origin)]),transform([add(scroll),subtract(origin)]));var withinRange=(coord1,coord2,xRange,yRange,scroll,origin)=>{var a1=asAbsolute(coord1,scroll,origin);var a2=asAbsolute(coord2,scroll,origin);return Math.abs(a1.left-a2.left)<=xRange&&Math.abs(a1.top-a2.top)<=yRange;};var getDeltas=(coord1,coord2,xRange,yRange,scroll,origin)=>{var a1=asAbsolute(coord1,scroll,origin);var a2=asAbsolute(coord2,scroll,origin);var left=Math.abs(a1.left-a2.left);var top=Math.abs(a1.top-a2.top);return SugarPosition(left,top);};var toStyles=(coord,scroll,origin)=>{var stylesOpt=coord.fold((x,y)=>({position:Optional.some('absolute'),left:Optional.some(x+'px'),top:Optional.some(y+'px')}),(x,y)=>({position:Optional.some('absolute'),left:Optional.some(x-origin.left+'px'),top:Optional.some(y-origin.top+'px')}),(x,y)=>({position:Optional.some('fixed'),left:Optional.some(x+'px'),top:Optional.some(y+'px')}));return _objectSpread({right:Optional.none(),bottom:Optional.none()},stylesOpt);};var translate=(coord,deltaX,deltaY)=>coord.fold((x,y)=>offset(x+deltaX,y+deltaY),(x,y)=>absolute(x+deltaX,y+deltaY),(x,y)=>fixed(x+deltaX,y+deltaY));var absorb=(partialCoord,originalCoord,scroll,origin)=>{var absorbOne=(stencil,nu)=>(optX,optY)=>{var original=stencil(originalCoord,scroll,origin);return nu(optX.getOr(original.left),optY.getOr(original.top));};return partialCoord.fold(absorbOne(asOffset,offset),absorbOne(asAbsolute,absolute),absorbOne(asFixed,fixed));};var offset=adt.offset;var absolute=adt.absolute;var fixed=adt.fixed;var parseAttrToInt=(element,name)=>{var value=get$f(element,name);return isUndefined(value)?NaN:parseInt(value,10);};var get=(component,snapsInfo)=>{var element=component.element;var x=parseAttrToInt(element,snapsInfo.leftAttr);var y=parseAttrToInt(element,snapsInfo.topAttr);return isNaN(x)||isNaN(y)?Optional.none():Optional.some(SugarPosition(x,y));};var set=(component,snapsInfo,pt)=>{var element=component.element;set$9(element,snapsInfo.leftAttr,pt.left+'px');set$9(element,snapsInfo.topAttr,pt.top+'px');};var clear=(component,snapsInfo)=>{var element=component.element;remove$7(element,snapsInfo.leftAttr);remove$7(element,snapsInfo.topAttr);};var getCoords=(component,snapInfo,coord,delta)=>get(component,snapInfo).fold(()=>coord,fixed$1=>fixed(fixed$1.left+delta.left,fixed$1.top+delta.top));var moveOrSnap=(component,snapInfo,coord,delta,scroll,origin)=>{var newCoord=getCoords(component,snapInfo,coord,delta);var snap=snapInfo.mustSnap?findClosestSnap(component,snapInfo,newCoord,scroll,origin):findSnap(component,snapInfo,newCoord,scroll,origin);var fixedCoord=asFixed(newCoord,scroll,origin);set(component,snapInfo,fixedCoord);return snap.fold(()=>({coord:fixed(fixedCoord.left,fixedCoord.top),extra:Optional.none()}),spanned=>({coord:spanned.output,extra:spanned.extra}));};var stopDrag=(component,snapInfo)=>{clear(component,snapInfo);};var findMatchingSnap=(snaps,newCoord,scroll,origin)=>findMap(snaps,snap=>{var sensor=snap.sensor;var inRange=withinRange(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return inRange?Optional.some({output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}):Optional.none();});var findClosestSnap=(component,snapInfo,newCoord,scroll,origin)=>{var snaps=snapInfo.getSnapPoints(component);var matchSnap=findMatchingSnap(snaps,newCoord,scroll,origin);return matchSnap.orThunk(()=>{var bestSnap=foldl(snaps,(acc,snap)=>{var sensor=snap.sensor;var deltas=getDeltas(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return acc.deltas.fold(()=>({deltas:Optional.some(deltas),snap:Optional.some(snap)}),bestDeltas=>{var currAvg=(deltas.left+deltas.top)/2;var bestAvg=(bestDeltas.left+bestDeltas.top)/2;if(currAvg<=bestAvg){return{deltas:Optional.some(deltas),snap:Optional.some(snap)};}else{return acc;}});},{deltas:Optional.none(),snap:Optional.none()});return bestSnap.snap.map(snap=>({output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}));});};var findSnap=(component,snapInfo,newCoord,scroll,origin)=>{var snaps=snapInfo.getSnapPoints(component);return findMatchingSnap(snaps,newCoord,scroll,origin);};var snapTo$1=(snap,scroll,origin)=>({coord:absorb(snap.output,snap.output,scroll,origin),extra:snap.extra});var snapTo=(component,dragConfig,_state,snap)=>{var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element);var scroll=get$b(doc);var origin=getOrigin(target);var snapPin=snapTo$1(snap,scroll,origin);var styles=toStyles(snapPin.coord,scroll,origin);setOptions(target,styles);}};var DraggingApis=/*#__PURE__*/Object.freeze({__proto__:null,snapTo:snapTo});var initialAttribute='data-initial-z-index';var resetZIndex=blocker=>{parent(blocker.element).filter(isElement$1).each(root=>{getOpt(root,initialAttribute).fold(()=>remove$6(root,'z-index'),zIndex=>set$8(root,'z-index',zIndex));remove$7(root,initialAttribute);});};var changeZIndex=blocker=>{parent(blocker.element).filter(isElement$1).each(root=>{getRaw(root,'z-index').each(zindex=>{set$9(root,initialAttribute,zindex);});set$8(root,'z-index',get$e(blocker.element,'z-index'));});};var instigate=(anyComponent,blocker)=>{anyComponent.getSystem().addToGui(blocker);changeZIndex(blocker);};var discard=blocker=>{resetZIndex(blocker);blocker.getSystem().removeFromGui(blocker);};var createComponent=(component,blockerClass,blockerEvents)=>component.getSystem().build(Container.sketch({dom:{styles:{'left':'0px','top':'0px','width':'100%','height':'100%','position':'fixed','z-index':'1000000000000000'},classes:[blockerClass]},events:blockerEvents}));var SnapSchema=optionObjOf('snaps',[required$1('getSnapPoints'),onHandler('onSensor'),required$1('leftAttr'),required$1('topAttr'),defaulted('lazyViewport',win),defaulted('mustSnap',false)]);var schema$6=[defaulted('useFixed',never),required$1('blockerClass'),defaulted('getTarget',identity),defaulted('onDrag',noop),defaulted('repositionTarget',true),defaulted('onDrop',noop),defaultedFunction('getBounds',win),SnapSchema];var getCurrentCoord=target=>lift3(getRaw(target,'left'),getRaw(target,'top'),getRaw(target,'position'),(left,top,position)=>{var nu=position==='fixed'?fixed:offset;return nu(parseInt(left,10),parseInt(top,10));}).getOrThunk(()=>{var location=absolute$3(target);return absolute(location.left,location.top);});var clampCoords=(component,coords,scroll,origin,startData)=>{var bounds=startData.bounds;var absoluteCoord=asAbsolute(coords,scroll,origin);var newX=clamp(absoluteCoord.left,bounds.x,bounds.x+bounds.width-startData.width);var newY=clamp(absoluteCoord.top,bounds.y,bounds.y+bounds.height-startData.height);var newCoords=absolute(newX,newY);return coords.fold(()=>{var offset$1=asOffset(newCoords,scroll,origin);return offset(offset$1.left,offset$1.top);},constant$1(newCoords),()=>{var fixed$1=asFixed(newCoords,scroll,origin);return fixed(fixed$1.left,fixed$1.top);});};var calcNewCoord=(component,optSnaps,currentCoord,scroll,origin,delta,startData)=>{var newCoord=optSnaps.fold(()=>{var translated=translate(currentCoord,delta.left,delta.top);var fixedCoord=asFixed(translated,scroll,origin);return fixed(fixedCoord.left,fixedCoord.top);},snapInfo=>{var snapping=moveOrSnap(component,snapInfo,currentCoord,delta,scroll,origin);snapping.extra.each(extra=>{snapInfo.onSensor(component,extra);});return snapping.coord;});return clampCoords(component,newCoord,scroll,origin,startData);};var dragBy=(component,dragConfig,startData,delta)=>{var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element);var scroll=get$b(doc);var origin=getOrigin(target);var currentCoord=getCurrentCoord(target);var newCoord=calcNewCoord(component,dragConfig.snaps,currentCoord,scroll,origin,delta,startData);var styles=toStyles(newCoord,scroll,origin);setOptions(target,styles);}dragConfig.onDrag(component,target,delta);};var calcStartData=(dragConfig,comp)=>({bounds:dragConfig.getBounds(),height:getOuter$2(comp.element),width:getOuter$1(comp.element)});var _move=(component,dragConfig,dragState,dragMode,event)=>{var delta=dragState.update(dragMode,event);var dragStartData=dragState.getStartData().getOrThunk(()=>calcStartData(dragConfig,component));delta.each(dlt=>{dragBy(component,dragConfig,dragStartData,dlt);});};var stop=(component,blocker,dragConfig,dragState)=>{blocker.each(discard);dragConfig.snaps.each(snapInfo=>{stopDrag(component,snapInfo);});var target=dragConfig.getTarget(component.element);dragState.reset();dragConfig.onDrop(component,target);};var handlers=events=>(dragConfig,dragState)=>{var updateStartState=comp=>{dragState.setStartData(calcStartData(dragConfig,comp));};return derive$2([run$1(windowScroll(),comp=>{dragState.getStartData().each(()=>updateStartState(comp));}),...events(dragConfig,dragState,updateStartState)]);};var init$3=dragApi=>derive$2([run$1(mousedown(),dragApi.forceDrop),run$1(mouseup(),dragApi.drop),run$1(mousemove(),(comp,simulatedEvent)=>{dragApi.move(simulatedEvent.event);}),run$1(mouseout(),dragApi.delayDrop)]);var getData$1=event=>Optional.from(SugarPosition(event.x,event.y));var getDelta$1=(old,nu)=>SugarPosition(nu.left-old.left,nu.top-old.top);var MouseData=/*#__PURE__*/Object.freeze({__proto__:null,getData:getData$1,getDelta:getDelta$1});var events$3=(dragConfig,dragState,updateStartState)=>[run$1(mousedown(),(component,simulatedEvent)=>{var raw=simulatedEvent.event.raw;if(raw.button!==0){return;}simulatedEvent.stop();var stop$1=()=>stop(component,Optional.some(blocker),dragConfig,dragState);var delayDrop=DelayedFunction(stop$1,200);var dragApi={drop:stop$1,delayDrop:delayDrop.schedule,forceDrop:stop$1,move:event=>{delayDrop.cancel();_move(component,dragConfig,dragState,MouseData,event);}};var blocker=createComponent(component,dragConfig.blockerClass,init$3(dragApi));var start=()=>{updateStartState(component);instigate(component,blocker);};start();})];var schema$5=[...schema$6,output$1('dragger',{handlers:handlers(events$3)})];var init$2=dragApi=>derive$2([run$1(touchstart(),dragApi.forceDrop),run$1(touchend(),dragApi.drop),run$1(touchcancel(),dragApi.drop),run$1(touchmove(),(comp,simulatedEvent)=>{dragApi.move(simulatedEvent.event);})]);var getDataFrom=touches=>{var touch=touches[0];return Optional.some(SugarPosition(touch.clientX,touch.clientY));};var getData=event=>{var raw=event.raw;var touches=raw.touches;return touches.length===1?getDataFrom(touches):Optional.none();};var getDelta=(old,nu)=>SugarPosition(nu.left-old.left,nu.top-old.top);var TouchData=/*#__PURE__*/Object.freeze({__proto__:null,getData:getData,getDelta:getDelta});var events$2=(dragConfig,dragState,updateStartState)=>{var blockerSingleton=value$2();var stopBlocking=component=>{stop(component,blockerSingleton.get(),dragConfig,dragState);blockerSingleton.clear();};return[run$1(touchstart(),(component,simulatedEvent)=>{simulatedEvent.stop();var stop=()=>stopBlocking(component);var dragApi={drop:stop,delayDrop:noop,forceDrop:stop,move:event=>{_move(component,dragConfig,dragState,TouchData,event);}};var blocker=createComponent(component,dragConfig.blockerClass,init$2(dragApi));blockerSingleton.set(blocker);var start=()=>{updateStartState(component);instigate(component,blocker);};start();}),run$1(touchmove(),(component,simulatedEvent)=>{simulatedEvent.stop();_move(component,dragConfig,dragState,TouchData,simulatedEvent.event);}),run$1(touchend(),(component,simulatedEvent)=>{simulatedEvent.stop();stopBlocking(component);}),run$1(touchcancel(),stopBlocking)];};var schema$4=[...schema$6,output$1('dragger',{handlers:handlers(events$2)})];var events$1=(dragConfig,dragState,updateStartState)=>[...events$3(dragConfig,dragState,updateStartState),...events$2(dragConfig,dragState,updateStartState)];var schema$3=[...schema$6,output$1('dragger',{handlers:handlers(events$1)})];var mouse=schema$5;var touch=schema$4;var mouseOrTouch=schema$3;var DraggingBranches=/*#__PURE__*/Object.freeze({__proto__:null,mouse:mouse,touch:touch,mouseOrTouch:mouseOrTouch});var init$1=()=>{var previous=Optional.none();var startData=Optional.none();var reset=()=>{previous=Optional.none();startData=Optional.none();};var calculateDelta=(mode,nu)=>{var result=previous.map(old=>mode.getDelta(old,nu));previous=Optional.some(nu);return result;};var update=(mode,dragEvent)=>mode.getData(dragEvent).bind(nuData=>calculateDelta(mode,nuData));var setStartData=data=>{startData=Optional.some(data);};var getStartData=()=>startData;var readState=constant$1({});return nu$8({readState,reset,update,getStartData,setStartData});};var DragState=/*#__PURE__*/Object.freeze({__proto__:null,init:init$1});var Dragging=createModes({branchKey:'mode',branches:DraggingBranches,name:'dragging',active:{events:(dragConfig,dragState)=>{var dragger=dragConfig.dragger;return dragger.handlers(dragConfig,dragState);}},extra:{snap:sConfig=>({sensor:sConfig.sensor,range:sConfig.range,output:sConfig.output,extra:Optional.from(sConfig.extra)})},state:DragState,apis:DraggingApis});var snapWidth=40;var snapOffset=snapWidth/2;var calcSnap=(selectorOpt,td,x,y,width,height)=>selectorOpt.fold(()=>Dragging.snap({sensor:absolute(x-snapOffset,y-snapOffset),range:SugarPosition(width,height),output:absolute(Optional.some(x),Optional.some(y)),extra:{td}}),selectorHandle=>{var sensorLeft=x-snapOffset;var sensorTop=y-snapOffset;var sensorWidth=snapWidth;var sensorHeight=snapWidth;var rect=selectorHandle.element.dom.getBoundingClientRect();return Dragging.snap({sensor:absolute(sensorLeft,sensorTop),range:SugarPosition(sensorWidth,sensorHeight),output:absolute(Optional.some(x-rect.width/2),Optional.some(y-rect.height/2)),extra:{td}});});var getSnapsConfig=(getSnapPoints,cell,onChange)=>{var isSameCell=(cellOpt,td)=>cellOpt.exists(currentTd=>eq(currentTd,td));return{getSnapPoints,leftAttr:'data-drag-left',topAttr:'data-drag-top',onSensor:(component,extra)=>{var td=extra.td;if(!isSameCell(cell.get(),td)){cell.set(td);onChange(td);}},mustSnap:true};};var createSelector=snaps=>record(Button.sketch({dom:{tag:'div',classes:['tox-selector']},buttonBehaviours:derive$1([Dragging.config({mode:'mouseOrTouch',blockerClass:'blocker',snaps}),Unselecting.config({})]),eventOrder:{mousedown:['dragging','alloy.base.behaviour'],touchstart:['dragging','alloy.base.behaviour']}}));var setup$4=(editor,sink)=>{var tlTds=Cell([]);var brTds=Cell([]);var isVisible=Cell(false);var startCell=value$2();var finishCell=value$2();var getTopLeftSnap=td=>{var box=absolute$2(td);return calcSnap(memTopLeft.getOpt(sink),td,box.x,box.y,box.width,box.height);};var getTopLeftSnaps=()=>map$2(tlTds.get(),td=>getTopLeftSnap(td));var getBottomRightSnap=td=>{var box=absolute$2(td);return calcSnap(memBottomRight.getOpt(sink),td,box.right,box.bottom,box.width,box.height);};var getBottomRightSnaps=()=>map$2(brTds.get(),td=>getBottomRightSnap(td));var topLeftSnaps=getSnapsConfig(getTopLeftSnaps,startCell,start=>{finishCell.get().each(finish=>{editor.dispatch('TableSelectorChange',{start,finish});});});var bottomRightSnaps=getSnapsConfig(getBottomRightSnaps,finishCell,finish=>{startCell.get().each(start=>{editor.dispatch('TableSelectorChange',{start,finish});});});var memTopLeft=createSelector(topLeftSnaps);var memBottomRight=createSelector(bottomRightSnaps);var topLeft=build$1(memTopLeft.asSpec());var bottomRight=build$1(memBottomRight.asSpec());var showOrHideHandle=(selector,cell,isAbove,isBelow)=>{var cellRect=cell.dom.getBoundingClientRect();remove$6(selector.element,'display');var viewportHeight=defaultView(SugarElement.fromDom(editor.getBody())).dom.innerHeight;var aboveViewport=isAbove(cellRect);var belowViewport=isBelow(cellRect,viewportHeight);if(aboveViewport||belowViewport){set$8(selector.element,'display','none');}};var snapTo=(selector,cell,getSnapConfig,pos)=>{var snap=getSnapConfig(cell);Dragging.snapTo(selector,snap);var isAbove=rect=>rect[pos]<0;var isBelow=(rect,viewportHeight)=>rect[pos]>viewportHeight;showOrHideHandle(selector,cell,isAbove,isBelow);};var snapTopLeft=cell=>snapTo(topLeft,cell,getTopLeftSnap,'top');var snapLastTopLeft=()=>startCell.get().each(snapTopLeft);var snapBottomRight=cell=>snapTo(bottomRight,cell,getBottomRightSnap,'bottom');var snapLastBottomRight=()=>finishCell.get().each(snapBottomRight);if(detect$2().deviceType.isTouch()){editor.on('TableSelectionChange',e=>{if(!isVisible.get()){attach(sink,topLeft);attach(sink,bottomRight);isVisible.set(true);}startCell.set(e.start);finishCell.set(e.finish);e.otherCells.each(otherCells=>{tlTds.set(otherCells.upOrLeftCells);brTds.set(otherCells.downOrRightCells);snapTopLeft(e.start);snapBottomRight(e.finish);});});editor.on('ResizeEditor ResizeWindow ScrollContent',()=>{snapLastTopLeft();snapLastBottomRight();});editor.on('TableSelectionClear',()=>{if(isVisible.get()){detach(topLeft);detach(bottomRight);isVisible.set(false);}startCell.clear();finishCell.clear();});}};var Logo=\"<svg width=\\\"50px\\\" height=\\\"16px\\\" viewBox=\\\"0 0 50 16\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n  <path fill-rule=\\\"evenodd\\\" clip-rule=\\\"evenodd\\\" d=\\\"M10.143 0c2.608.015 5.186 2.178 5.186 5.331 0 0 .077 3.812-.084 4.87-.361 2.41-2.164 4.074-4.65 4.496-1.453.284-2.523.49-3.212.623-.373.071-.634.122-.785.152-.184.038-.997.145-1.35.145-2.732 0-5.21-2.04-5.248-5.33 0 0 0-3.514.03-4.442.093-2.4 1.758-4.342 4.926-4.963 0 0 3.875-.752 4.036-.782.368-.07.775-.1 1.15-.1Zm1.826 2.8L5.83 3.989v2.393l-2.455.475v5.968l6.137-1.189V9.243l2.456-.476V2.8ZM5.83 6.382l3.682-.713v3.574l-3.682.713V6.382Zm27.173-1.64-.084-1.066h-2.226v9.132h2.456V7.743c-.008-1.151.998-2.064 2.149-2.072 1.15-.008 1.987.92 1.995 2.072v5.065h2.455V7.359c-.015-2.18-1.657-3.929-3.837-3.913a3.993 3.993 0 0 0-2.908 1.296Zm-6.3-4.266L29.16 0v2.387l-2.456.475V.476Zm0 3.2v9.132h2.456V3.676h-2.456Zm18.179 11.787L49.11 3.676H46.58l-1.612 4.527-.46 1.382-.384-1.382-1.611-4.527H39.98l3.3 9.132L42.15 16l2.732-.537ZM22.867 9.738c0 .752.568 1.075.921 1.075.353 0 .668-.047.998-.154l.537 1.765c-.23.154-.92.537-2.225.537-1.305 0-2.655-.997-2.686-2.686a136.877 136.877 0 0 1 0-4.374H18.8V3.676h1.612v-1.98l2.455-.476v2.456h2.302V5.9h-2.302v3.837Z\\\"/>\\n</svg>\\n\";var isHidden=elm=>elm.nodeName==='BR'||!!elm.getAttribute('data-mce-bogus')||elm.getAttribute('data-mce-type')==='bookmark';var renderElementPath=(editor,settings,providersBackstage)=>{var _a;var delimiter=(_a=settings.delimiter)!==null&&_a!==void 0?_a:'\\u203A';var renderElement=(name,element,index)=>Button.sketch({dom:{tag:'div',classes:['tox-statusbar__path-item'],attributes:{'data-index':index,'aria-level':index+1}},components:[text$2(name)],action:_btn=>{editor.focus();editor.selection.select(element);editor.nodeChanged();},buttonBehaviours:derive$1([DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig()])});var renderDivider=()=>({dom:{tag:'div',classes:['tox-statusbar__path-divider'],attributes:{'aria-hidden':true}},components:[text$2(\" \".concat(delimiter,\" \"))]});var renderPathData=data=>foldl(data,(acc,path,index)=>{var element=renderElement(path.name,path.element,index);if(index===0){return acc.concat([element]);}else{return acc.concat([renderDivider(),element]);}},[]);var updatePath=parents=>{var newPath=[];var i=parents.length;while(i-->0){var _parent=parents[i];if(_parent.nodeType===1&&!isHidden(_parent)){var args=fireResolveName(editor,_parent);if(!args.isDefaultPrevented()){newPath.push({name:args.name,element:_parent});}if(args.isPropagationStopped()){break;}}}return newPath;};return{dom:{tag:'div',classes:['tox-statusbar__path'],attributes:{role:'navigation'}},behaviours:derive$1([Keying.config({mode:'flow',selector:'div[role=button]'}),Disabling.config({disabled:providersBackstage.isDisabled}),receivingConfig(),Tabstopping.config({}),Replacing.config({}),config('elementPathEvents',[runOnAttached((comp,_e)=>{editor.shortcuts.add('alt+F11','focus statusbar elementpath',()=>Keying.focusIn(comp));editor.on('NodeChange',e=>{var newPath=updatePath(e.parents);var newChildren=newPath.length>0?renderPathData(newPath):[];Replacing.set(comp,newChildren);});})])]),components:[]};};var ResizeTypes;(function(ResizeTypes){ResizeTypes[ResizeTypes['None']=0]='None';ResizeTypes[ResizeTypes['Both']=1]='Both';ResizeTypes[ResizeTypes['Vertical']=2]='Vertical';})(ResizeTypes||(ResizeTypes={}));var getDimensions=(editor,deltas,resizeType,originalHeight,originalWidth)=>{var dimensions={height:calcCappedSize(originalHeight+deltas.top,getMinHeightOption(editor),getMaxHeightOption(editor))};if(resizeType===ResizeTypes.Both){dimensions.width=calcCappedSize(originalWidth+deltas.left,getMinWidthOption(editor),getMaxWidthOption(editor));}return dimensions;};var resize=(editor,deltas,resizeType)=>{var container=SugarElement.fromDom(editor.getContainer());var dimensions=getDimensions(editor,deltas,resizeType,get$d(container),get$c(container));each(dimensions,(val,dim)=>{if(isNumber(val)){set$8(container,dim,numToPx(val));}});fireResizeEditor(editor);};var getResizeType=editor=>{var resize=getResize(editor);if(resize===false){return ResizeTypes.None;}else if(resize==='both'){return ResizeTypes.Both;}else{return ResizeTypes.Vertical;}};var keyboardHandler=(editor,resizeType,x,y)=>{var scale=20;var delta=SugarPosition(x*scale,y*scale);resize(editor,delta,resizeType);return Optional.some(true);};var renderResizeHandler=(editor,providersBackstage)=>{var resizeType=getResizeType(editor);if(resizeType===ResizeTypes.None){return Optional.none();}var resizeLabel=resizeType===ResizeTypes.Both?'Press the arrow keys to resize the editor.':'Press the Up and Down arrow keys to resize the editor.';return Optional.some(render$3('resize-handle',{tag:'div',classes:['tox-statusbar__resize-handle'],attributes:{'title':providersBackstage.translate('Resize'),'aria-label':providersBackstage.translate(resizeLabel)},behaviours:[Dragging.config({mode:'mouse',repositionTarget:false,onDrag:(_comp,_target,delta)=>resize(editor,delta,resizeType),blockerClass:'tox-blocker'}),Keying.config({mode:'special',onLeft:()=>keyboardHandler(editor,resizeType,-1,0),onRight:()=>keyboardHandler(editor,resizeType,1,0),onUp:()=>keyboardHandler(editor,resizeType,0,-1),onDown:()=>keyboardHandler(editor,resizeType,0,1)}),Tabstopping.config({}),Focusing.config({})]},providersBackstage.icons));};var renderWordCount=(editor,providersBackstage)=>{var replaceCountText=(comp,count,mode)=>Replacing.set(comp,[text$2(providersBackstage.translate(['{0} '+mode,count[mode]]))]);return Button.sketch({dom:{tag:'button',classes:['tox-statusbar__wordcount']},components:[],buttonBehaviours:derive$1([DisablingConfigs.button(providersBackstage.isDisabled),receivingConfig(),Tabstopping.config({}),Replacing.config({}),Representing.config({store:{mode:'memory',initialValue:{mode:'words',count:{words:0,characters:0}}}}),config('wordcount-events',[runOnExecute$1(comp=>{var currentVal=Representing.getValue(comp);var newMode=currentVal.mode==='words'?'characters':'words';Representing.setValue(comp,{mode:newMode,count:currentVal.count});replaceCountText(comp,currentVal.count,newMode);}),runOnAttached(comp=>{editor.on('wordCountUpdate',e=>{var{mode}=Representing.getValue(comp);Representing.setValue(comp,{mode,count:e.wordCount});replaceCountText(comp,e.wordCount,mode);});})])]),eventOrder:{[execute$5()]:['disabling','alloy.base.behaviour','wordcount-events']}});};var renderStatusbar=(editor,providersBackstage)=>{var renderBranding=()=>{return{dom:{tag:'span',classes:['tox-statusbar__branding']},components:[{dom:{tag:'a',attributes:{'href':'https://www.tiny.cloud/powered-by-tiny?utm_campaign=editor_referral&utm_medium=poweredby&utm_source=tinymce&utm_content=v6','rel':'noopener','target':'_blank','aria-label':global$8.translate(['Powered by {0}','Tiny'])},innerHtml:Logo.trim()},behaviours:derive$1([Focusing.config({})])}]};};var renderHelpAccessibility=()=>{var shortcutText=convertText('Alt+0');var text=\"Press {0} for help\";return{dom:{tag:'div',classes:['tox-statusbar__help-text']},components:[text$2(global$8.translate([text,shortcutText]))]};};var renderRightContainer=()=>{var components=[];if(editor.hasPlugin('wordcount')){components.push(renderWordCount(editor,providersBackstage));}if(useBranding(editor)){components.push(renderBranding());}return{dom:{tag:'div',classes:['tox-statusbar__right-container']},components};};var getTextComponents=()=>{var components=[];var shouldRenderHelp=useHelpAccessibility(editor);var shouldRenderElementPath=useElementPath(editor);var shouldRenderRightContainer=useBranding(editor)||editor.hasPlugin('wordcount');var getTextComponentClasses=()=>{var flexStart='tox-statusbar__text-container--flex-start';var flexEnd='tox-statusbar__text-container--flex-end';var spaceAround='tox-statusbar__text-container--space-around';if(shouldRenderHelp){var container3Columns='tox-statusbar__text-container-3-cols';if(!shouldRenderRightContainer&&!shouldRenderElementPath){return[container3Columns,spaceAround];}if(shouldRenderRightContainer&&!shouldRenderElementPath){return[container3Columns,flexEnd];}return[container3Columns,flexStart];}return[shouldRenderRightContainer&&!shouldRenderElementPath?flexEnd:flexStart];};if(shouldRenderElementPath){components.push(renderElementPath(editor,{},providersBackstage));}if(shouldRenderHelp){components.push(renderHelpAccessibility());}if(shouldRenderRightContainer){components.push(renderRightContainer());}if(components.length>0){return[{dom:{tag:'div',classes:['tox-statusbar__text-container',...getTextComponentClasses()]},components}];}return[];};var getComponents=()=>{var components=getTextComponents();var resizeHandler=renderResizeHandler(editor,providersBackstage);return components.concat(resizeHandler.toArray());};return{dom:{tag:'div',classes:['tox-statusbar']},components:getComponents()};};var getLazyMothership=(label,singleton)=>singleton.get().getOrDie(\"UI for \".concat(label,\" has not been rendered\"));var setup$3=(editor,setupForTheme)=>{var isInline=editor.inline;var mode=isInline?Inline:Iframe;var header=isStickyToolbar(editor)?StickyHeader:StaticHeader;var lazyUiRefs=LazyUiReferences();var lazyMothership=value$2();var lazyDialogMothership=value$2();var lazyPopupMothership=value$2();var platform=detect$2();var isTouch=platform.deviceType.isTouch();var touchPlatformClass='tox-platform-touch';var deviceClasses=isTouch?[touchPlatformClass]:[];var isToolbarBottom=isToolbarLocationBottom(editor);var toolbarMode=getToolbarMode(editor);var memAnchorBar=record({dom:{tag:'div',classes:['tox-anchorbar']}});var memBottomAnchorBar=record({dom:{tag:'div',classes:['tox-bottom-anchorbar']}});var _lazyHeader=()=>lazyUiRefs.mainUi.get().map(ui=>ui.outerContainer).bind(OuterContainer.getHeader);var lazyDialogSinkResult=()=>Result.fromOption(lazyUiRefs.dialogUi.get().map(ui=>ui.sink),'UI has not been rendered');var lazyPopupSinkResult=()=>Result.fromOption(lazyUiRefs.popupUi.get().map(ui=>ui.sink),'(popup) UI has not been rendered');var lazyAnchorBar=lazyUiRefs.lazyGetInOuterOrDie('anchor bar',memAnchorBar.getOpt);var lazyBottomAnchorBar=lazyUiRefs.lazyGetInOuterOrDie('bottom anchor bar',memBottomAnchorBar.getOpt);var lazyToolbar=lazyUiRefs.lazyGetInOuterOrDie('toolbar',OuterContainer.getToolbar);var lazyThrobber=lazyUiRefs.lazyGetInOuterOrDie('throbber',OuterContainer.getThrobber);var backstages=init$6({popup:lazyPopupSinkResult,dialog:lazyDialogSinkResult},editor,lazyAnchorBar,lazyBottomAnchorBar);var makeHeaderPart=()=>{var verticalDirAttributes={attributes:{[Attribute]:isToolbarBottom?AttributeValue.BottomToTop:AttributeValue.TopToBottom}};var partMenubar=OuterContainer.parts.menubar({dom:{tag:'div',classes:['tox-menubar']},backstage:backstages.popup,onEscape:()=>{editor.focus();}});var partToolbar=OuterContainer.parts.toolbar(_objectSpread({dom:{tag:'div',classes:['tox-toolbar']},getSink:backstages.popup.shared.getSink,providers:backstages.popup.shared.providers,onEscape:()=>{editor.focus();},onToolbarToggled:state=>{fireToggleToolbarDrawer(editor,state);},type:toolbarMode,lazyToolbar,lazyHeader:()=>_lazyHeader().getOrDie('Could not find header element')},verticalDirAttributes));var partMultipleToolbar=OuterContainer.parts['multiple-toolbar']({dom:{tag:'div',classes:['tox-toolbar-overlord']},providers:backstages.popup.shared.providers,onEscape:()=>{editor.focus();},type:toolbarMode});var hasMultipleToolbar=isMultipleToolbars(editor);var hasToolbar=isToolbarEnabled(editor);var hasMenubar=isMenubarEnabled(editor);var shouldHavePromotion=promotionEnabled(editor);var partPromotion=makePromotion();var hasAnyContents=hasMultipleToolbar||hasToolbar||hasMenubar;var getPartToolbar=()=>{if(hasMultipleToolbar){return[partMultipleToolbar];}else if(hasToolbar){return[partToolbar];}else{return[];}};var menubarCollection=shouldHavePromotion?[partPromotion,partMenubar]:[partMenubar];return OuterContainer.parts.header({dom:_objectSpread({tag:'div',classes:['tox-editor-header'].concat(hasAnyContents?[]:['tox-editor-header--empty'])},verticalDirAttributes),components:flatten([hasMenubar?menubarCollection:[],getPartToolbar(),useFixedContainer(editor)?[]:[memAnchorBar.asSpec()]]),sticky:isStickyToolbar(editor),editor,sharedBackstage:backstages.popup.shared});};var makePromotion=()=>{return OuterContainer.parts.promotion({dom:{tag:'div',classes:['tox-promotion']}});};var makeSidebarDefinition=()=>{var partSocket=OuterContainer.parts.socket({dom:{tag:'div',classes:['tox-edit-area']}});var partSidebar=OuterContainer.parts.sidebar({dom:{tag:'div',classes:['tox-sidebar']}});return{dom:{tag:'div',classes:['tox-sidebar-wrap']},components:[partSocket,partSidebar]};};var renderDialogUi=()=>{var uiContainer=getUiContainer(editor);var isGridUiContainer=eq(body(),uiContainer)&&get$e(uiContainer,'display')==='grid';var sinkSpec={dom:{tag:'div',classes:['tox','tox-silver-sink','tox-tinymce-aux'].concat(deviceClasses),attributes:_objectSpread({},global$8.isRtl()?{dir:'rtl'}:{})},behaviours:derive$1([Positioning.config({useFixed:()=>header.isDocked(_lazyHeader)})])};var reactiveWidthSpec={dom:{styles:{width:document.body.clientWidth+'px'}},events:derive$2([run$1(windowResize(),comp=>{set$8(comp.element,'width',document.body.clientWidth+'px');})])};var sink=build$1(deepMerge(sinkSpec,isGridUiContainer?reactiveWidthSpec:{}));var uiMothership=takeover(sink);lazyDialogMothership.set(uiMothership);return{sink,mothership:uiMothership};};var renderPopupUi=()=>{var sinkSpec={dom:{tag:'div',classes:['tox','tox-silver-sink','tox-silver-popup-sink','tox-tinymce-aux'].concat(deviceClasses),attributes:_objectSpread({},global$8.isRtl()?{dir:'rtl'}:{})},behaviours:derive$1([Positioning.config({useFixed:()=>header.isDocked(_lazyHeader),getBounds:()=>setupForTheme.getPopupSinkBounds()})])};var sink=build$1(sinkSpec);var uiMothership=takeover(sink);lazyPopupMothership.set(uiMothership);return{sink,mothership:uiMothership};};var renderMainUi=()=>{var partHeader=makeHeaderPart();var sidebarContainer=makeSidebarDefinition();var partThrobber=OuterContainer.parts.throbber({dom:{tag:'div',classes:['tox-throbber']},backstage:backstages.popup});var partViewWrapper=OuterContainer.parts.viewWrapper({backstage:backstages.popup});var statusbar=useStatusBar(editor)&&!isInline?Optional.some(renderStatusbar(editor,backstages.popup.shared.providers)):Optional.none();var editorComponents=flatten([isToolbarBottom?[]:[partHeader],isInline?[]:[sidebarContainer],isToolbarBottom?[partHeader]:[]]);var editorContainer=OuterContainer.parts.editorContainer({components:flatten([editorComponents,isInline?[]:[memBottomAnchorBar.asSpec(),...statusbar.toArray()]])});var isHidden=isDistractionFree(editor);var attributes=_objectSpread(_objectSpread({role:'application'},global$8.isRtl()?{dir:'rtl'}:{}),isHidden?{'aria-hidden':'true'}:{});var outerContainer=build$1(OuterContainer.sketch({dom:{tag:'div',classes:['tox','tox-tinymce'].concat(isInline?['tox-tinymce-inline']:[]).concat(isToolbarBottom?['tox-tinymce--toolbar-bottom']:[]).concat(deviceClasses),styles:_objectSpread({visibility:'hidden'},isHidden?{opacity:'0',border:'0'}:{}),attributes},components:[editorContainer,...(isInline?[]:[partViewWrapper]),partThrobber],behaviours:derive$1([receivingConfig(),Disabling.config({disableClass:'tox-tinymce--disabled'}),Keying.config({mode:'cyclic',selector:'.tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a, .tox-statusbar__resize-handle'})])}));var mothership=takeover(outerContainer);lazyMothership.set(mothership);return{mothership,outerContainer};};var setEditorSize=outerContainer=>{var parsedHeight=numToPx(getHeightWithFallback(editor));var parsedWidth=numToPx(getWidthWithFallback(editor));if(!editor.inline){if(isValidValue$1('div','width',parsedWidth)){set$8(outerContainer.element,'width',parsedWidth);}if(isValidValue$1('div','height',parsedHeight)){set$8(outerContainer.element,'height',parsedHeight);}else{set$8(outerContainer.element,'height','400px');}}return parsedHeight;};var setupShortcutsAndCommands=outerContainer=>{editor.addShortcut('alt+F9','focus menubar',()=>{OuterContainer.focusMenubar(outerContainer);});editor.addShortcut('alt+F10','focus toolbar',()=>{OuterContainer.focusToolbar(outerContainer);});editor.addCommand('ToggleToolbarDrawer',(_ui,options)=>{if(options===null||options===void 0?void 0:options.skipFocus){OuterContainer.toggleToolbarDrawerWithoutFocusing(outerContainer);}else{OuterContainer.toggleToolbarDrawer(outerContainer);}});editor.addQueryStateHandler('ToggleToolbarDrawer',()=>OuterContainer.isToolbarDrawerToggled(outerContainer));};var renderUIWithRefs=uiRefs=>{var{mainUi,popupUi,uiMotherships}=uiRefs;map$1(getToolbarGroups(editor),(toolbarGroupButtonConfig,name)=>{editor.ui.registry.addGroupToolbarButton(name,toolbarGroupButtonConfig);});var{buttons,menuItems,contextToolbars,sidebars,views}=editor.ui.registry.getAll();var toolbarOpt=getMultipleToolbarsOption(editor);var rawUiConfig={menuItems,menus:getMenus(editor),menubar:getMenubar(editor),toolbar:toolbarOpt.getOrThunk(()=>getToolbar(editor)),allowToolbarGroups:toolbarMode===ToolbarMode$1.floating,buttons,sidebar:sidebars,views};setupShortcutsAndCommands(mainUi.outerContainer);setup$b(editor,mainUi.mothership,uiMotherships);header.setup(editor,backstages.popup.shared,_lazyHeader);setup$6(editor,backstages.popup);setup$5(editor,backstages.popup.shared.getSink,backstages.popup);setup$8(editor);setup$7(editor,lazyThrobber,backstages.popup.shared);register$9(editor,contextToolbars,popupUi.sink,{backstage:backstages.popup});setup$4(editor,popupUi.sink);var elm=editor.getElement();var height=setEditorSize(mainUi.outerContainer);var args={targetNode:elm,height};return mode.render(editor,uiRefs,rawUiConfig,backstages.popup,args);};var reuseDialogUiForPopuUi=dialogUi=>{lazyPopupMothership.set(dialogUi.mothership);return dialogUi;};var renderUI=()=>{var mainUi=renderMainUi();var dialogUi=renderDialogUi();var popupUi=isSplitUiMode(editor)?renderPopupUi():reuseDialogUiForPopuUi(dialogUi);lazyUiRefs.dialogUi.set(dialogUi);lazyUiRefs.popupUi.set(popupUi);lazyUiRefs.mainUi.set(mainUi);var uiRefs={popupUi,dialogUi,mainUi,uiMotherships:lazyUiRefs.getUiMotherships()};return renderUIWithRefs(uiRefs);};return{popups:{backstage:backstages.popup,getMothership:()=>getLazyMothership('popups',lazyPopupMothership)},dialogs:{backstage:backstages.dialog,getMothership:()=>getLazyMothership('dialogs',lazyDialogMothership)},renderUI};};var labelledBy=(labelledElement,labelElement)=>{var labelId=getOpt(labelledElement,'id').fold(()=>{var id=generate$6('dialog-label');set$9(labelElement,'id',id);return id;},identity);set$9(labelledElement,'aria-labelledby',labelId);};var schema$2=constant$1([required$1('lazySink'),option$3('dragBlockClass'),defaultedFunction('getBounds',win),defaulted('useTabstopAt',always),defaulted('firstTabstop',0),defaulted('eventOrder',{}),field('modalBehaviours',[Keying]),onKeyboardHandler('onExecute'),onStrictKeyboardHandler('onEscape')]);var basic={sketch:identity};var parts$2=constant$1([optional({name:'draghandle',overrides:(detail,spec)=>{return{behaviours:derive$1([Dragging.config({mode:'mouse',getTarget:handle=>{return ancestor(handle,'[role=\"dialog\"]').getOr(handle);},blockerClass:detail.dragBlockClass.getOrDie(new Error('The drag blocker class was not specified for a dialog with a drag handle: \\n'+JSON.stringify(spec,null,2)).message),getBounds:detail.getDragBounds})])};}}),required({schema:[required$1('dom')],name:'title'}),required({factory:basic,schema:[required$1('dom')],name:'close'}),required({factory:basic,schema:[required$1('dom')],name:'body'}),optional({factory:basic,schema:[required$1('dom')],name:'footer'}),external({factory:{sketch:(spec,detail)=>_objectSpread(_objectSpread({},spec),{},{dom:detail.dom,components:detail.components})},schema:[defaulted('dom',{tag:'div',styles:{position:'fixed',left:'0px',top:'0px',right:'0px',bottom:'0px'}}),defaulted('components',[])],name:'blocker'})]);var factory$4=(detail,components,spec,externals)=>{var dialogComp=value$2();var showDialog=dialog=>{dialogComp.set(dialog);var sink=detail.lazySink(dialog).getOrDie();var externalBlocker=externals.blocker();var blocker=sink.getSystem().build(_objectSpread(_objectSpread({},externalBlocker),{},{components:externalBlocker.components.concat([premade(dialog)]),behaviours:derive$1([Focusing.config({}),config('dialog-blocker-events',[runOnSource(focusin(),()=>{Blocking.isBlocked(dialog)?noop():Keying.focusIn(dialog);})])])}));attach(sink,blocker);Keying.focusIn(dialog);};var hideDialog=dialog=>{dialogComp.clear();parent(dialog.element).each(blockerDom=>{dialog.getSystem().getByDom(blockerDom).each(blocker=>{detach(blocker);});});};var getDialogBody=dialog=>getPartOrDie(dialog,detail,'body');var getDialogFooter=dialog=>getPart(dialog,detail,'footer');var setBusy=(dialog,getBusySpec)=>{Blocking.block(dialog,getBusySpec);};var setIdle=dialog=>{Blocking.unblock(dialog);};var modalEventsId=generate$6('modal-events');var eventOrder=_objectSpread(_objectSpread({},detail.eventOrder),{},{[attachedToDom()]:[modalEventsId].concat(detail.eventOrder['alloy.system.attached']||[])});return{uid:detail.uid,dom:detail.dom,components,apis:{show:showDialog,hide:hideDialog,getBody:getDialogBody,getFooter:getDialogFooter,setIdle,setBusy},eventOrder,domModification:{attributes:{'role':'dialog','aria-modal':'true'}},behaviours:augment(detail.modalBehaviours,[Replacing.config({}),Keying.config({mode:'cyclic',onEnter:detail.onExecute,onEscape:detail.onEscape,useTabstopAt:detail.useTabstopAt,firstTabstop:detail.firstTabstop}),Blocking.config({getRoot:dialogComp.get}),config(modalEventsId,[runOnAttached(c=>{labelledBy(c.element,getPartOrDie(c,detail,'title').element);})])])};};var ModalDialog=composite({name:'ModalDialog',configFields:schema$2(),partFields:parts$2(),factory:factory$4,apis:{show:(apis,dialog)=>{apis.show(dialog);},hide:(apis,dialog)=>{apis.hide(dialog);},getBody:(apis,dialog)=>apis.getBody(dialog),getFooter:(apis,dialog)=>apis.getFooter(dialog),setBusy:(apis,dialog,getBusySpec)=>{apis.setBusy(dialog,getBusySpec);},setIdle:(apis,dialog)=>{apis.setIdle(dialog);}}});var dialogToggleMenuItemSchema=objOf([type,name$1].concat(commonMenuItemFields));var dialogToggleMenuItemDataProcessor=boolean;var baseFooterButtonFields=[generatedName('button'),optionalIcon,defaultedStringEnum('align','end',['start','end']),primary,enabled,optionStringEnum('buttonType',['primary','secondary'])];var dialogFooterButtonFields=[...baseFooterButtonFields,text$1];var normalFooterButtonFields=[requiredStringEnum('type',['submit','cancel','custom']),...dialogFooterButtonFields];var menuFooterButtonFields=[requiredStringEnum('type',['menu']),optionalText,optionalTooltip,optionalIcon,requiredArrayOf('items',dialogToggleMenuItemSchema),...baseFooterButtonFields];var toggleButtonSpecFields=[...baseFooterButtonFields,requiredStringEnum('type',['togglebutton']),requiredString('tooltip'),optionalIcon,optionalText,defaultedBoolean('active',false)];var dialogFooterButtonSchema=choose$1('type',{submit:normalFooterButtonFields,cancel:normalFooterButtonFields,custom:normalFooterButtonFields,menu:menuFooterButtonFields,togglebutton:toggleButtonSpecFields});var alertBannerFields=[type,text$1,requiredStringEnum('level',['info','warn','error','success']),icon,defaulted('url','')];var alertBannerSchema=objOf(alertBannerFields);var createBarFields=itemsField=>[type,itemsField];var buttonFields=[type,text$1,enabled,generatedName('button'),optionalIcon,borderless,optionStringEnum('buttonType',['primary','secondary','toolbar']),primary];var buttonSchema=objOf(buttonFields);var formComponentFields=[type,name$1];var formComponentWithLabelFields=formComponentFields.concat([optionalLabel]);var checkboxFields=formComponentFields.concat([label,enabled]);var checkboxSchema=objOf(checkboxFields);var checkboxDataProcessor=boolean;var collectionFields=formComponentWithLabelFields.concat([defaultedColumns('auto')]);var collectionSchema=objOf(collectionFields);var collectionDataProcessor=arrOfObj([value$1,text$1,icon]);var colorInputFields=formComponentWithLabelFields.concat([defaultedString('storageKey','default')]);var colorInputSchema=objOf(colorInputFields);var colorInputDataProcessor=string;var colorPickerFields=formComponentWithLabelFields;var colorPickerSchema=objOf(colorPickerFields);var colorPickerDataProcessor=string;var customEditorFields=formComponentFields.concat([defaultedString('tag','textarea'),requiredString('scriptId'),requiredString('scriptUrl'),defaultedPostMsg('settings',undefined)]);var customEditorFieldsOld=formComponentFields.concat([defaultedString('tag','textarea'),requiredFunction('init')]);var customEditorSchema=valueOf(v=>asRaw('customeditor.old',objOfOnly(customEditorFieldsOld),v).orThunk(()=>asRaw('customeditor.new',objOfOnly(customEditorFields),v)));var customEditorDataProcessor=string;var dropZoneFields=formComponentWithLabelFields;var dropZoneSchema=objOf(dropZoneFields);var dropZoneDataProcessor=arrOfVal();var createGridFields=itemsField=>[type,requiredNumber('columns'),itemsField];var htmlPanelFields=[type,requiredString('html'),defaultedStringEnum('presets','presentation',['presentation','document'])];var htmlPanelSchema=objOf(htmlPanelFields);var iframeFields=formComponentWithLabelFields.concat([defaultedBoolean('border',false),defaultedBoolean('sandboxed',true),defaultedBoolean('streamContent',false),defaultedBoolean('transparent',true)]);var iframeSchema=objOf(iframeFields);var iframeDataProcessor=string;var imagePreviewSchema=objOf(formComponentFields.concat([optionString('height')]));var imagePreviewDataProcessor=objOf([requiredString('url'),optionNumber('zoom'),optionNumber('cachedWidth'),optionNumber('cachedHeight')]);var inputFields=formComponentWithLabelFields.concat([optionString('inputMode'),optionString('placeholder'),defaultedBoolean('maximized',false),enabled]);var inputSchema=objOf(inputFields);var inputDataProcessor=string;var createLabelFields=itemsField=>[type,label,itemsField,defaultedStringEnum('align','start',['start','center','end'])];var listBoxSingleItemFields=[text$1,value$1];var listBoxNestedItemFields=[text$1,requiredArrayOf('items',thunkOf('items',()=>listBoxItemSchema))];var listBoxItemSchema=oneOf([objOf(listBoxSingleItemFields),objOf(listBoxNestedItemFields)]);var listBoxFields=formComponentWithLabelFields.concat([requiredArrayOf('items',listBoxItemSchema),enabled]);var listBoxSchema=objOf(listBoxFields);var listBoxDataProcessor=string;var selectBoxFields=formComponentWithLabelFields.concat([requiredArrayOfObj('items',[text$1,value$1]),defaultedNumber('size',1),enabled]);var selectBoxSchema=objOf(selectBoxFields);var selectBoxDataProcessor=string;var sizeInputFields=formComponentWithLabelFields.concat([defaultedBoolean('constrain',true),enabled]);var sizeInputSchema=objOf(sizeInputFields);var sizeInputDataProcessor=objOf([requiredString('width'),requiredString('height')]);var sliderFields=formComponentFields.concat([label,defaultedNumber('min',0),defaultedNumber('max',0)]);var sliderSchema=objOf(sliderFields);var sliderInputDataProcessor=number;var tableFields=[type,requiredArrayOf('header',string),requiredArrayOf('cells',arrOf(string))];var tableSchema=objOf(tableFields);var textAreaFields=formComponentWithLabelFields.concat([optionString('placeholder'),defaultedBoolean('maximized',false),enabled]);var textAreaSchema=objOf(textAreaFields);var textAreaDataProcessor=string;var baseTreeItemFields=[requiredStringEnum('type',['directory','leaf']),title,requiredString('id'),optionOf('menu',MenuButtonSchema)];var treeItemLeafFields=baseTreeItemFields;var treeItemLeafSchema=objOf(treeItemLeafFields);var treeItemDirectoryFields=baseTreeItemFields.concat([requiredArrayOf('children',thunkOf('children',()=>{return choose$2('type',{directory:treeItemDirectorySchema,leaf:treeItemLeafSchema});}))]);var treeItemDirectorySchema=objOf(treeItemDirectoryFields);var treeItemSchema=choose$2('type',{directory:treeItemDirectorySchema,leaf:treeItemLeafSchema});var treeFields=[type,requiredArrayOf('items',treeItemSchema),optionFunction('onLeafAction'),optionFunction('onToggleExpand'),defaultedArrayOf('defaultExpandedIds',[],string),optionString('defaultSelectedId')];var treeSchema=objOf(treeFields);var urlInputFields=formComponentWithLabelFields.concat([defaultedStringEnum('filetype','file',['image','media','file']),enabled]);var urlInputSchema=objOf(urlInputFields);var urlInputDataProcessor=objOf([value$1,defaultedMeta]);var createItemsField=name=>field$1('items','items',required$2(),arrOf(valueOf(v=>asRaw(\"Checking item of \".concat(name),itemSchema,v).fold(sErr=>Result.error(formatError(sErr)),passValue=>Result.value(passValue)))));var itemSchema=valueThunk(()=>choose$2('type',{alertbanner:alertBannerSchema,bar:objOf(createBarFields(createItemsField('bar'))),button:buttonSchema,checkbox:checkboxSchema,colorinput:colorInputSchema,colorpicker:colorPickerSchema,dropzone:dropZoneSchema,grid:objOf(createGridFields(createItemsField('grid'))),iframe:iframeSchema,input:inputSchema,listbox:listBoxSchema,selectbox:selectBoxSchema,sizeinput:sizeInputSchema,slider:sliderSchema,textarea:textAreaSchema,urlinput:urlInputSchema,customeditor:customEditorSchema,htmlpanel:htmlPanelSchema,imagepreview:imagePreviewSchema,collection:collectionSchema,label:objOf(createLabelFields(createItemsField('label'))),table:tableSchema,tree:treeSchema,panel:panelSchema}));var panelFields=[type,defaulted('classes',[]),requiredArrayOf('items',itemSchema)];var panelSchema=objOf(panelFields);var tabFields=[generatedName('tab'),title,requiredArrayOf('items',itemSchema)];var tabPanelFields=[type,requiredArrayOfObj('tabs',tabFields)];var tabPanelSchema=objOf(tabPanelFields);var dialogButtonFields=dialogFooterButtonFields;var dialogButtonSchema=dialogFooterButtonSchema;var dialogSchema=objOf([requiredString('title'),requiredOf('body',choose$2('type',{panel:panelSchema,tabpanel:tabPanelSchema})),defaultedString('size','normal'),defaultedArrayOf('buttons',[],dialogButtonSchema),defaulted('initialData',{}),defaultedFunction('onAction',noop),defaultedFunction('onChange',noop),defaultedFunction('onSubmit',noop),defaultedFunction('onClose',noop),defaultedFunction('onCancel',noop),defaultedFunction('onTabChange',noop)]);var createDialog=spec=>asRaw('dialog',dialogSchema,spec);var urlDialogButtonSchema=objOf([requiredStringEnum('type',['cancel','custom']),...dialogButtonFields]);var urlDialogSchema=objOf([requiredString('title'),requiredString('url'),optionNumber('height'),optionNumber('width'),optionArrayOf('buttons',urlDialogButtonSchema),defaultedFunction('onAction',noop),defaultedFunction('onCancel',noop),defaultedFunction('onClose',noop),defaultedFunction('onMessage',noop)]);var createUrlDialog=spec=>asRaw('dialog',urlDialogSchema,spec);var getAllObjects=obj=>{if(isObject(obj)){return[obj].concat(bind$3(values(obj),getAllObjects));}else if(isArray(obj)){return bind$3(obj,getAllObjects);}else{return[];}};var isNamedItem=obj=>isString(obj.type)&&isString(obj.name);var dataProcessors={checkbox:checkboxDataProcessor,colorinput:colorInputDataProcessor,colorpicker:colorPickerDataProcessor,dropzone:dropZoneDataProcessor,input:inputDataProcessor,iframe:iframeDataProcessor,imagepreview:imagePreviewDataProcessor,selectbox:selectBoxDataProcessor,sizeinput:sizeInputDataProcessor,slider:sliderInputDataProcessor,listbox:listBoxDataProcessor,size:sizeInputDataProcessor,textarea:textAreaDataProcessor,urlinput:urlInputDataProcessor,customeditor:customEditorDataProcessor,collection:collectionDataProcessor,togglemenuitem:dialogToggleMenuItemDataProcessor};var getDataProcessor=item=>Optional.from(dataProcessors[item.type]);var getNamedItems=structure=>filter$2(getAllObjects(structure),isNamedItem);var createDataValidator=structure=>{var namedItems=getNamedItems(structure);var fields=bind$3(namedItems,item=>getDataProcessor(item).fold(()=>[],schema=>[requiredOf(item.name,schema)]));return objOf(fields);};var extract=structure=>{var _a;var internalDialog=getOrDie(createDialog(structure));var dataValidator=createDataValidator(structure);var initialData=(_a=structure.initialData)!==null&&_a!==void 0?_a:{};return{internalDialog,dataValidator,initialData};};var DialogManager={open:(factory,structure)=>{var extraction=extract(structure);return factory(extraction.internalDialog,extraction.initialData,extraction.dataValidator);},openUrl:(factory,structure)=>{var internalDialog=getOrDie(createUrlDialog(structure));return factory(internalDialog);},redial:structure=>extract(structure)};var events=(reflectingConfig,reflectingState)=>{var update=(component,data)=>{reflectingConfig.updateState.each(updateState=>{var newState=updateState(component,data);reflectingState.set(newState);});reflectingConfig.renderComponents.each(renderComponents=>{var newComponents=renderComponents(data,reflectingState.get());var replacer=reflectingConfig.reuseDom?withReuse:withoutReuse;replacer(component,newComponents);});};return derive$2([run$1(receive(),(component,message)=>{var receivingData=message;if(!receivingData.universal){var channel=reflectingConfig.channel;if(contains$2(receivingData.channels,channel)){update(component,receivingData.data);}}}),runOnAttached((comp,_se)=>{reflectingConfig.initialData.each(rawData=>{update(comp,rawData);});})]);};var ActiveReflecting=/*#__PURE__*/Object.freeze({__proto__:null,events:events});var getState=(component,replaceConfig,reflectState)=>reflectState;var ReflectingApis=/*#__PURE__*/Object.freeze({__proto__:null,getState:getState});var ReflectingSchema=[required$1('channel'),option$3('renderComponents'),option$3('updateState'),option$3('initialData'),defaultedBoolean('reuseDom',true)];var init=()=>{var cell=Cell(Optional.none());var clear=()=>cell.set(Optional.none());var readState=()=>cell.get().getOr('none');return{readState,get:cell.get,set:cell.set,clear};};var ReflectingState=/*#__PURE__*/Object.freeze({__proto__:null,init:init});var Reflecting=create$4({fields:ReflectingSchema,name:'reflecting',active:ActiveReflecting,apis:ReflectingApis,state:ReflectingState});var toValidValues=values=>{var errors=[];var result={};each(values,(value,name)=>{value.fold(()=>{errors.push(name);},v=>{result[name]=v;});});return errors.length>0?Result.error(errors):Result.value(result);};var renderBodyPanel=(spec,dialogData,backstage)=>{var memForm=record(Form.sketch(parts=>({dom:{tag:'div',classes:['tox-form'].concat(spec.classes)},components:map$2(spec.items,item=>interpretInForm(parts,item,dialogData,backstage))})));return{dom:{tag:'div',classes:['tox-dialog__body']},components:[{dom:{tag:'div',classes:['tox-dialog__body-content']},components:[memForm.asSpec()]}],behaviours:derive$1([Keying.config({mode:'acyclic',useTabstopAt:not(isPseudoStop)}),ComposingConfigs.memento(memForm),memento(memForm,{postprocess:formValue=>toValidValues(formValue).fold(err=>{console.error(err);return{};},identity)}),config('dialog-body-panel',[run$1(focusin(),(comp,se)=>{comp.getSystem().broadcastOn([dialogFocusShiftedChannel],{newFocus:Optional.some(se.event.target)});})])])};};var factory$3=(detail,_spec)=>({uid:detail.uid,dom:detail.dom,components:detail.components,events:events$a(detail.action),behaviours:augment(detail.tabButtonBehaviours,[Focusing.config({}),Keying.config({mode:'execution',useSpace:true,useEnter:true}),Representing.config({store:{mode:'memory',initialValue:detail.value}})]),domModification:detail.domModification});var TabButton=single({name:'TabButton',configFields:[defaulted('uid',undefined),required$1('value'),field$1('dom','dom',mergeWithThunk(()=>({attributes:{'role':'tab','id':generate$6('aria'),'aria-selected':'false'}})),anyValue()),option$3('action'),defaulted('domModification',{}),field('tabButtonBehaviours',[Focusing,Keying,Representing]),required$1('view')],factory:factory$3});var schema$1=constant$1([required$1('tabs'),required$1('dom'),defaulted('clickToDismiss',false),field('tabbarBehaviours',[Highlighting,Keying]),markers$1(['tabClass','selectedClass'])]);var tabsPart=group({factory:TabButton,name:'tabs',unit:'tab',overrides:barDetail=>{var dismissTab$1=(tabbar,button)=>{Highlighting.dehighlight(tabbar,button);emitWith(tabbar,dismissTab(),{tabbar,button});};var changeTab$1=(tabbar,button)=>{Highlighting.highlight(tabbar,button);emitWith(tabbar,changeTab(),{tabbar,button});};return{action:button=>{var tabbar=button.getSystem().getByUid(barDetail.uid).getOrDie();var activeButton=Highlighting.isHighlighted(tabbar,button);var response=(()=>{if(activeButton&&barDetail.clickToDismiss){return dismissTab$1;}else if(!activeButton){return changeTab$1;}else{return noop;}})();response(tabbar,button);},domModification:{classes:[barDetail.markers.tabClass]}};}});var parts$1=constant$1([tabsPart]);var factory$2=(detail,components,_spec,_externals)=>({'uid':detail.uid,'dom':detail.dom,components,'debug.sketcher':'Tabbar','domModification':{attributes:{role:'tablist'}},'behaviours':augment(detail.tabbarBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedClass,itemClass:detail.markers.tabClass,onHighlight:(tabbar,tab)=>{set$9(tab.element,'aria-selected','true');},onDehighlight:(tabbar,tab)=>{set$9(tab.element,'aria-selected','false');}}),Keying.config({mode:'flow',getInitial:tabbar=>{return Highlighting.getHighlighted(tabbar).map(tab=>tab.element);},selector:'.'+detail.markers.tabClass,executeOnMove:true})])});var Tabbar=composite({name:'Tabbar',configFields:schema$1(),partFields:parts$1(),factory:factory$2});var factory$1=(detail,_spec)=>({uid:detail.uid,dom:detail.dom,behaviours:augment(detail.tabviewBehaviours,[Replacing.config({})]),domModification:{attributes:{role:'tabpanel'}}});var Tabview=single({name:'Tabview',configFields:[field('tabviewBehaviours',[Replacing])],factory:factory$1});var schema=constant$1([defaulted('selectFirst',true),onHandler('onChangeTab'),onHandler('onDismissTab'),defaulted('tabs',[]),field('tabSectionBehaviours',[])]);var barPart=required({factory:Tabbar,schema:[required$1('dom'),requiredObjOf('markers',[required$1('tabClass'),required$1('selectedClass')])],name:'tabbar',defaults:detail=>{return{tabs:detail.tabs};}});var viewPart=required({factory:Tabview,name:'tabview'});var parts=constant$1([barPart,viewPart]);var factory=(detail,components,_spec,_externals)=>{var changeTab$1=button=>{var tabValue=Representing.getValue(button);getPart(button,detail,'tabview').each(tabview=>{var tabWithValue=find$5(detail.tabs,t=>t.value===tabValue);tabWithValue.each(tabData=>{var panel=tabData.view();getOpt(button.element,'id').each(id=>{set$9(tabview.element,'aria-labelledby',id);});Replacing.set(tabview,panel);detail.onChangeTab(tabview,button,panel);});});};var changeTabBy=(section,byPred)=>{getPart(section,detail,'tabbar').each(tabbar=>{byPred(tabbar).each(emitExecute);});};return{uid:detail.uid,dom:detail.dom,components,behaviours:get$3(detail.tabSectionBehaviours),events:derive$2(flatten([detail.selectFirst?[runOnAttached((section,_simulatedEvent)=>{changeTabBy(section,Highlighting.getFirst);})]:[],[run$1(changeTab(),(section,simulatedEvent)=>{var button=simulatedEvent.event.button;changeTab$1(button);}),run$1(dismissTab(),(section,simulatedEvent)=>{var button=simulatedEvent.event.button;detail.onDismissTab(section,button);})]])),apis:{getViewItems:section=>{return getPart(section,detail,'tabview').map(tabview=>Replacing.contents(tabview)).getOr([]);},showTab:(section,tabKey)=>{var getTabIfNotActive=tabbar=>{var candidates=Highlighting.getCandidates(tabbar);var optTab=find$5(candidates,c=>Representing.getValue(c)===tabKey);return optTab.filter(tab=>!Highlighting.isHighlighted(tabbar,tab));};changeTabBy(section,getTabIfNotActive);}}};};var TabSection=composite({name:'TabSection',configFields:schema(),partFields:parts(),factory,apis:{getViewItems:(apis,component)=>apis.getViewItems(component),showTab:(apis,component,tabKey)=>{apis.showTab(component,tabKey);}}});var measureHeights=(allTabs,tabview,tabviewComp)=>map$2(allTabs,(_tab,i)=>{Replacing.set(tabviewComp,allTabs[i].view());var rect=tabview.dom.getBoundingClientRect();Replacing.set(tabviewComp,[]);return rect.height;});var getMaxHeight=heights=>head(sort(heights,(a,b)=>{if(a>b){return-1;}else if(a<b){return+1;}else{return 0;}}));var getMaxTabviewHeight=(dialog,tabview,tablist)=>{var documentElement$1=documentElement(dialog).dom;var rootElm=ancestor(dialog,'.tox-dialog-wrap').getOr(dialog);var isFixed=get$e(rootElm,'position')==='fixed';var maxHeight;if(isFixed){maxHeight=Math.max(documentElement$1.clientHeight,window.innerHeight);}else{maxHeight=Math.max(documentElement$1.offsetHeight,documentElement$1.scrollHeight);}var tabviewHeight=get$d(tabview);var isTabListBeside=tabview.dom.offsetLeft>=tablist.dom.offsetLeft+get$c(tablist);var currentTabHeight=isTabListBeside?Math.max(get$d(tablist),tabviewHeight):tabviewHeight;var dialogTopMargin=parseInt(get$e(dialog,'margin-top'),10)||0;var dialogBottomMargin=parseInt(get$e(dialog,'margin-bottom'),10)||0;var dialogHeight=get$d(dialog)+dialogTopMargin+dialogBottomMargin;var chromeHeight=dialogHeight-currentTabHeight;return maxHeight-chromeHeight;};var showTab=(allTabs,comp)=>{head(allTabs).each(tab=>TabSection.showTab(comp,tab.value));};var setTabviewHeight=(tabview,height)=>{set$8(tabview,'height',height+'px');set$8(tabview,'flex-basis',height+'px');};var updateTabviewHeight=(dialogBody,tabview,maxTabHeight)=>{ancestor(dialogBody,'[role=\"dialog\"]').each(dialog=>{descendant(dialog,'[role=\"tablist\"]').each(tablist=>{maxTabHeight.get().map(height=>{set$8(tabview,'height','0');set$8(tabview,'flex-basis','0');return Math.min(height,getMaxTabviewHeight(dialog,tabview,tablist));}).each(height=>{setTabviewHeight(tabview,height);});});});};var getTabview=dialog=>descendant(dialog,'[role=\"tabpanel\"]');var smartMode=allTabs=>{var maxTabHeight=value$2();var extraEvents=[runOnAttached(comp=>{var dialog=comp.element;getTabview(dialog).each(tabview=>{set$8(tabview,'visibility','hidden');comp.getSystem().getByDom(tabview).toOptional().each(tabviewComp=>{var heights=measureHeights(allTabs,tabview,tabviewComp);var maxTabHeightOpt=getMaxHeight(heights);maxTabHeightOpt.fold(maxTabHeight.clear,maxTabHeight.set);});updateTabviewHeight(dialog,tabview,maxTabHeight);remove$6(tabview,'visibility');showTab(allTabs,comp);requestAnimationFrame(()=>{updateTabviewHeight(dialog,tabview,maxTabHeight);});});}),run$1(windowResize(),comp=>{var dialog=comp.element;getTabview(dialog).each(tabview=>{updateTabviewHeight(dialog,tabview,maxTabHeight);});}),run$1(formResizeEvent,(comp,_se)=>{var dialog=comp.element;getTabview(dialog).each(tabview=>{var oldFocus=active$1(getRootNode(tabview));set$8(tabview,'visibility','hidden');var oldHeight=getRaw(tabview,'height').map(h=>parseInt(h,10));remove$6(tabview,'height');remove$6(tabview,'flex-basis');var newHeight=tabview.dom.getBoundingClientRect().height;var hasGrown=oldHeight.forall(h=>newHeight>h);if(hasGrown){maxTabHeight.set(newHeight);updateTabviewHeight(dialog,tabview,maxTabHeight);}else{oldHeight.each(h=>{setTabviewHeight(tabview,h);});}remove$6(tabview,'visibility');oldFocus.each(focus$3);});})];var selectFirst=false;return{extraEvents,selectFirst};};var SendDataToSectionChannel='send-data-to-section';var SendDataToViewChannel='send-data-to-view';var renderTabPanel=(spec,dialogData,backstage)=>{var storedValue=Cell({});var updateDataWithForm=form=>{var formData=Representing.getValue(form);var validData=toValidValues(formData).getOr({});var currentData=storedValue.get();var newData=deepMerge(currentData,validData);storedValue.set(newData);};var setDataOnForm=form=>{var tabData=storedValue.get();Representing.setValue(form,tabData);};var oldTab=Cell(null);var allTabs=map$2(spec.tabs,tab=>{return{value:tab.name,dom:{tag:'div',classes:['tox-dialog__body-nav-item']},components:[text$2(backstage.shared.providers.translate(tab.title))],view:()=>{return[Form.sketch(parts=>({dom:{tag:'div',classes:['tox-form']},components:map$2(tab.items,item=>interpretInForm(parts,item,dialogData,backstage)),formBehaviours:derive$1([Keying.config({mode:'acyclic',useTabstopAt:not(isPseudoStop)}),config('TabView.form.events',[runOnAttached(setDataOnForm),runOnDetached(updateDataWithForm)]),Receiving.config({channels:wrapAll([{key:SendDataToSectionChannel,value:{onReceive:updateDataWithForm}},{key:SendDataToViewChannel,value:{onReceive:setDataOnForm}}])})])}))];}};});var tabMode=smartMode(allTabs);return TabSection.sketch({dom:{tag:'div',classes:['tox-dialog__body']},onChangeTab:(section,button,_viewItems)=>{var name=Representing.getValue(button);emitWith(section,formTabChangeEvent,{name,oldName:oldTab.get()});oldTab.set(name);},tabs:allTabs,components:[TabSection.parts.tabbar({dom:{tag:'div',classes:['tox-dialog__body-nav']},components:[Tabbar.parts.tabs({})],markers:{tabClass:'tox-tab',selectedClass:'tox-dialog__body-nav-item--active'},tabbarBehaviours:derive$1([Tabstopping.config({})])}),TabSection.parts.tabview({dom:{tag:'div',classes:['tox-dialog__body-content']}})],selectFirst:tabMode.selectFirst,tabSectionBehaviours:derive$1([config('tabpanel',tabMode.extraEvents),Keying.config({mode:'acyclic'}),Composing.config({find:comp=>head(TabSection.getViewItems(comp))}),withComp(Optional.none(),tsection=>{tsection.getSystem().broadcastOn([SendDataToSectionChannel],{});return storedValue.get();},(tsection,value)=>{storedValue.set(value);tsection.getSystem().broadcastOn([SendDataToViewChannel],{});})])});};var renderBody=(spec,dialogId,contentId,backstage,ariaAttrs)=>{var renderComponents=incoming=>{var body=incoming.body;switch(body.type){case'tabpanel':{return[renderTabPanel(body,incoming.initialData,backstage)];}default:{return[renderBodyPanel(body,incoming.initialData,backstage)];}}};var updateState=(_comp,incoming)=>Optional.some({isTabPanel:()=>incoming.body.type==='tabpanel'});var ariaAttributes={'aria-live':'polite'};return{dom:{tag:'div',classes:['tox-dialog__content-js'],attributes:_objectSpread(_objectSpread({},contentId.map(x=>({id:x})).getOr({})),ariaAttrs?ariaAttributes:{})},components:[],behaviours:derive$1([ComposingConfigs.childAt(0),Reflecting.config({channel:\"\".concat(bodyChannel,\"-\").concat(dialogId),updateState,renderComponents,initialData:spec})])};};var renderInlineBody=(spec,dialogId,contentId,backstage,ariaAttrs)=>renderBody(spec,dialogId,Optional.some(contentId),backstage,ariaAttrs);var renderModalBody=(spec,dialogId,backstage)=>{var bodySpec=renderBody(spec,dialogId,Optional.none(),backstage,false);return ModalDialog.parts.body(bodySpec);};var renderIframeBody=spec=>{var bodySpec={dom:{tag:'div',classes:['tox-dialog__content-js']},components:[{dom:{tag:'div',classes:['tox-dialog__body-iframe']},components:[craft(Optional.none(),{dom:{tag:'iframe',attributes:{src:spec.url}},behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})]}],behaviours:derive$1([Keying.config({mode:'acyclic',useTabstopAt:not(isPseudoStop)})])};return ModalDialog.parts.body(bodySpec);};function _typeof(obj){'@babel/helpers - typeof';return _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj;},_typeof(obj);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _isNativeReflectConstruct(){if(typeof Reflect==='undefined'||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==='function')return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _iterableToArray(iter){if(typeof Symbol!=='undefined'&&iter[Symbol.iterator]!=null||iter['@@iterator']!=null)return Array.from(iter);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==='string')return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==='Object'&&o.constructor)n=o.constructor.name;if(n==='Map'||n==='Set')return Array.from(o);if(n==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _nonIterableSpread(){throw new TypeError('Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.');}var hasOwnProperty=Object.hasOwnProperty,setPrototypeOf=Object.setPrototypeOf,isFrozen=Object.isFrozen,getPrototypeOf=Object.getPrototypeOf,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var freeze=Object.freeze,seal=Object.seal,create=Object.create;var _ref=typeof Reflect!=='undefined'&&Reflect,apply=_ref.apply,construct=_ref.construct;if(!apply){apply=function apply(fun,thisValue,args){return fun.apply(thisValue,args);};}if(!freeze){freeze=function freeze(x){return x;};}if(!seal){seal=function seal(x){return x;};}if(!construct){construct=function construct(Func,args){return _construct(Func,_toConsumableArray(args));};}var arrayForEach=unapply(Array.prototype.forEach);var arrayPop=unapply(Array.prototype.pop);var arrayPush=unapply(Array.prototype.push);var stringToLowerCase=unapply(String.prototype.toLowerCase);var stringMatch=unapply(String.prototype.match);var stringReplace=unapply(String.prototype.replace);var stringIndexOf=unapply(String.prototype.indexOf);var stringTrim=unapply(String.prototype.trim);var regExpTest=unapply(RegExp.prototype.test);var typeErrorCreate=unconstruct(TypeError);function unapply(func){return function(thisArg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return apply(func,thisArg,args);};}function unconstruct(func){return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return construct(func,args);};}function addToSet(set,array){if(setPrototypeOf){setPrototypeOf(set,null);}var l=array.length;while(l--){var element=array[l];if(typeof element==='string'){var lcElement=stringToLowerCase(element);if(lcElement!==element){if(!isFrozen(array)){array[l]=lcElement;}element=lcElement;}}set[element]=true;}return set;}function clone(object){var newObject=create(null);var property;for(property in object){if(apply(hasOwnProperty,object,[property])){newObject[property]=object[property];}}return newObject;}function lookupGetter(object,prop){while(object!==null){var desc=getOwnPropertyDescriptor(object,prop);if(desc){if(desc.get){return unapply(desc.get);}if(typeof desc.value==='function'){return unapply(desc.value);}}object=getPrototypeOf(object);}function fallbackValue(element){console.warn('fallback value for',element);return null;}return fallbackValue;}var html$1=freeze(['a','abbr','acronym','address','area','article','aside','audio','b','bdi','bdo','big','blink','blockquote','body','br','button','canvas','caption','center','cite','code','col','colgroup','content','data','datalist','dd','decorator','del','details','dfn','dialog','dir','div','dl','dt','element','em','fieldset','figcaption','figure','font','footer','form','h1','h2','h3','h4','h5','h6','head','header','hgroup','hr','html','i','img','input','ins','kbd','label','legend','li','main','map','mark','marquee','menu','menuitem','meter','nav','nobr','ol','optgroup','option','output','p','picture','pre','progress','q','rp','rt','ruby','s','samp','section','select','shadow','small','source','spacer','span','strike','strong','style','sub','summary','sup','table','tbody','td','template','textarea','tfoot','th','thead','time','tr','track','tt','u','ul','var','video','wbr']);var svg$1=freeze(['svg','a','altglyph','altglyphdef','altglyphitem','animatecolor','animatemotion','animatetransform','circle','clippath','defs','desc','ellipse','filter','font','g','glyph','glyphref','hkern','image','line','lineargradient','marker','mask','metadata','mpath','path','pattern','polygon','polyline','radialgradient','rect','stop','style','switch','symbol','text','textpath','title','tref','tspan','view','vkern']);var svgFilters=freeze(['feBlend','feColorMatrix','feComponentTransfer','feComposite','feConvolveMatrix','feDiffuseLighting','feDisplacementMap','feDistantLight','feFlood','feFuncA','feFuncB','feFuncG','feFuncR','feGaussianBlur','feImage','feMerge','feMergeNode','feMorphology','feOffset','fePointLight','feSpecularLighting','feSpotLight','feTile','feTurbulence']);var svgDisallowed=freeze(['animate','color-profile','cursor','discard','fedropshadow','font-face','font-face-format','font-face-name','font-face-src','font-face-uri','foreignobject','hatch','hatchpath','mesh','meshgradient','meshpatch','meshrow','missing-glyph','script','set','solidcolor','unknown','use']);var mathMl$1=freeze(['math','menclose','merror','mfenced','mfrac','mglyph','mi','mlabeledtr','mmultiscripts','mn','mo','mover','mpadded','mphantom','mroot','mrow','ms','mspace','msqrt','mstyle','msub','msup','msubsup','mtable','mtd','mtext','mtr','munder','munderover']);var mathMlDisallowed=freeze(['maction','maligngroup','malignmark','mlongdiv','mscarries','mscarry','msgroup','mstack','msline','msrow','semantics','annotation','annotation-xml','mprescripts','none']);var text=freeze(['#text']);var html=freeze(['accept','action','align','alt','autocapitalize','autocomplete','autopictureinpicture','autoplay','background','bgcolor','border','capture','cellpadding','cellspacing','checked','cite','class','clear','color','cols','colspan','controls','controlslist','coords','crossorigin','datetime','decoding','default','dir','disabled','disablepictureinpicture','disableremoteplayback','download','draggable','enctype','enterkeyhint','face','for','headers','height','hidden','high','href','hreflang','id','inputmode','integrity','ismap','kind','label','lang','list','loading','loop','low','max','maxlength','media','method','min','minlength','multiple','muted','name','nonce','noshade','novalidate','nowrap','open','optimum','pattern','placeholder','playsinline','poster','preload','pubdate','radiogroup','readonly','rel','required','rev','reversed','role','rows','rowspan','spellcheck','scope','selected','shape','size','sizes','span','srclang','start','src','srcset','step','style','summary','tabindex','title','translate','type','usemap','valign','value','width','xmlns','slot']);var svg=freeze(['accent-height','accumulate','additive','alignment-baseline','ascent','attributename','attributetype','azimuth','basefrequency','baseline-shift','begin','bias','by','class','clip','clippathunits','clip-path','clip-rule','color','color-interpolation','color-interpolation-filters','color-profile','color-rendering','cx','cy','d','dx','dy','diffuseconstant','direction','display','divisor','dur','edgemode','elevation','end','fill','fill-opacity','fill-rule','filter','filterunits','flood-color','flood-opacity','font-family','font-size','font-size-adjust','font-stretch','font-style','font-variant','font-weight','fx','fy','g1','g2','glyph-name','glyphref','gradientunits','gradienttransform','height','href','id','image-rendering','in','in2','k','k1','k2','k3','k4','kerning','keypoints','keysplines','keytimes','lang','lengthadjust','letter-spacing','kernelmatrix','kernelunitlength','lighting-color','local','marker-end','marker-mid','marker-start','markerheight','markerunits','markerwidth','maskcontentunits','maskunits','max','mask','media','method','mode','min','name','numoctaves','offset','operator','opacity','order','orient','orientation','origin','overflow','paint-order','path','pathlength','patterncontentunits','patterntransform','patternunits','points','preservealpha','preserveaspectratio','primitiveunits','r','rx','ry','radius','refx','refy','repeatcount','repeatdur','restart','result','rotate','scale','seed','shape-rendering','specularconstant','specularexponent','spreadmethod','startoffset','stddeviation','stitchtiles','stop-color','stop-opacity','stroke-dasharray','stroke-dashoffset','stroke-linecap','stroke-linejoin','stroke-miterlimit','stroke-opacity','stroke','stroke-width','style','surfacescale','systemlanguage','tabindex','targetx','targety','transform','transform-origin','text-anchor','text-decoration','text-rendering','textlength','type','u1','u2','unicode','values','viewbox','visibility','version','vert-adv-y','vert-origin-x','vert-origin-y','width','word-spacing','wrap','writing-mode','xchannelselector','ychannelselector','x','x1','x2','xmlns','y','y1','y2','z','zoomandpan']);var mathMl=freeze(['accent','accentunder','align','bevelled','close','columnsalign','columnlines','columnspan','denomalign','depth','dir','display','displaystyle','encoding','fence','frame','height','href','id','largeop','length','linethickness','lspace','lquote','mathbackground','mathcolor','mathsize','mathvariant','maxsize','minsize','movablelimits','notation','numalign','open','rowalign','rowlines','rowspacing','rowspan','rspace','rquote','scriptlevel','scriptminsize','scriptsizemultiplier','selection','separator','separators','stretchy','subscriptshift','supscriptshift','symmetric','voffset','width','xmlns']);var xml=freeze(['xlink:href','xml:id','xlink:title','xml:space','xmlns:xlink']);var MUSTACHE_EXPR=seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm);var ERB_EXPR=seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);var DATA_ATTR=seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]/);var ARIA_ATTR=seal(/^aria-[\\-\\w]+$/);var IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i);var IS_SCRIPT_OR_DATA=seal(/^(?:\\w+script|data):/i);var ATTR_WHITESPACE=seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g);var DOCTYPE_NAME=seal(/^html$/i);var getGlobal=function getGlobal(){return typeof window==='undefined'?null:window;};var _createTrustedTypesPolicy=function _createTrustedTypesPolicy(trustedTypes,document){if(_typeof(trustedTypes)!=='object'||typeof trustedTypes.createPolicy!=='function'){return null;}var suffix=null;var ATTR_NAME='data-tt-policy-suffix';if(document.currentScript&&document.currentScript.hasAttribute(ATTR_NAME)){suffix=document.currentScript.getAttribute(ATTR_NAME);}var policyName='dompurify'+(suffix?'#'+suffix:'');try{return trustedTypes.createPolicy(policyName,{createHTML:function createHTML(html){return html;}});}catch(_){console.warn('TrustedTypes policy '+policyName+' could not be created.');return null;}};function createDOMPurify(){var window=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getGlobal();var DOMPurify=function DOMPurify(root){return createDOMPurify(root);};DOMPurify.version='2.3.8';DOMPurify.removed=[];if(!window||!window.document||window.document.nodeType!==9){DOMPurify.isSupported=false;return DOMPurify;}var originalDocument=window.document;var document=window.document;var DocumentFragment=window.DocumentFragment,HTMLTemplateElement=window.HTMLTemplateElement,Node=window.Node,Element=window.Element,NodeFilter=window.NodeFilter,_window$NamedNodeMap=window.NamedNodeMap,NamedNodeMap=_window$NamedNodeMap===void 0?window.NamedNodeMap||window.MozNamedAttrMap:_window$NamedNodeMap,HTMLFormElement=window.HTMLFormElement,DOMParser=window.DOMParser,trustedTypes=window.trustedTypes;var ElementPrototype=Element.prototype;var cloneNode=lookupGetter(ElementPrototype,'cloneNode');var getNextSibling=lookupGetter(ElementPrototype,'nextSibling');var getChildNodes=lookupGetter(ElementPrototype,'childNodes');var getParentNode=lookupGetter(ElementPrototype,'parentNode');if(typeof HTMLTemplateElement==='function'){var template=document.createElement('template');if(template.content&&template.content.ownerDocument){document=template.content.ownerDocument;}}var trustedTypesPolicy=_createTrustedTypesPolicy(trustedTypes,originalDocument);var emptyHTML=trustedTypesPolicy?trustedTypesPolicy.createHTML(''):'';var _document=document,implementation=_document.implementation,createNodeIterator=_document.createNodeIterator,createDocumentFragment=_document.createDocumentFragment,getElementsByTagName=_document.getElementsByTagName;var importNode=originalDocument.importNode;var documentMode={};try{documentMode=clone(document).documentMode?document.documentMode:{};}catch(_){}var hooks={};DOMPurify.isSupported=typeof getParentNode==='function'&&implementation&&typeof implementation.createHTMLDocument!=='undefined'&&documentMode!==9;var MUSTACHE_EXPR$1=MUSTACHE_EXPR,ERB_EXPR$1=ERB_EXPR,DATA_ATTR$1=DATA_ATTR,ARIA_ATTR$1=ARIA_ATTR,IS_SCRIPT_OR_DATA$1=IS_SCRIPT_OR_DATA,ATTR_WHITESPACE$1=ATTR_WHITESPACE;var IS_ALLOWED_URI$1=IS_ALLOWED_URI;var ALLOWED_TAGS=null;var DEFAULT_ALLOWED_TAGS=addToSet({},[].concat(_toConsumableArray(html$1),_toConsumableArray(svg$1),_toConsumableArray(svgFilters),_toConsumableArray(mathMl$1),_toConsumableArray(text)));var ALLOWED_ATTR=null;var DEFAULT_ALLOWED_ATTR=addToSet({},[].concat(_toConsumableArray(html),_toConsumableArray(svg),_toConsumableArray(mathMl),_toConsumableArray(xml)));var CUSTOM_ELEMENT_HANDLING=Object.seal(Object.create(null,{tagNameCheck:{writable:true,configurable:false,enumerable:true,value:null},attributeNameCheck:{writable:true,configurable:false,enumerable:true,value:null},allowCustomizedBuiltInElements:{writable:true,configurable:false,enumerable:true,value:false}}));var FORBID_TAGS=null;var FORBID_ATTR=null;var ALLOW_ARIA_ATTR=true;var ALLOW_DATA_ATTR=true;var ALLOW_UNKNOWN_PROTOCOLS=false;var SAFE_FOR_TEMPLATES=false;var WHOLE_DOCUMENT=false;var SET_CONFIG=false;var FORCE_BODY=false;var RETURN_DOM=false;var RETURN_DOM_FRAGMENT=false;var RETURN_TRUSTED_TYPE=false;var SANITIZE_DOM=true;var KEEP_CONTENT=true;var IN_PLACE=false;var USE_PROFILES={};var FORBID_CONTENTS=null;var DEFAULT_FORBID_CONTENTS=addToSet({},['annotation-xml','audio','colgroup','desc','foreignobject','head','iframe','math','mi','mn','mo','ms','mtext','noembed','noframes','noscript','plaintext','script','style','svg','template','thead','title','video','xmp']);var DATA_URI_TAGS=null;var DEFAULT_DATA_URI_TAGS=addToSet({},['audio','video','img','source','image','track']);var URI_SAFE_ATTRIBUTES=null;var DEFAULT_URI_SAFE_ATTRIBUTES=addToSet({},['alt','class','for','id','label','name','pattern','placeholder','role','summary','title','value','style','xmlns']);var MATHML_NAMESPACE='http://www.w3.org/1998/Math/MathML';var SVG_NAMESPACE='http://www.w3.org/2000/svg';var HTML_NAMESPACE='http://www.w3.org/1999/xhtml';var NAMESPACE=HTML_NAMESPACE;var IS_EMPTY_INPUT=false;var PARSER_MEDIA_TYPE;var SUPPORTED_PARSER_MEDIA_TYPES=['application/xhtml+xml','text/html'];var DEFAULT_PARSER_MEDIA_TYPE='text/html';var transformCaseFunc;var CONFIG=null;var formElement=document.createElement('form');var isRegexOrFunction=function isRegexOrFunction(testValue){return testValue instanceof RegExp||testValue instanceof Function;};var _parseConfig=function _parseConfig(cfg){if(CONFIG&&CONFIG===cfg){return;}if(!cfg||_typeof(cfg)!=='object'){cfg={};}cfg=clone(cfg);ALLOWED_TAGS='ALLOWED_TAGS'in cfg?addToSet({},cfg.ALLOWED_TAGS):DEFAULT_ALLOWED_TAGS;ALLOWED_ATTR='ALLOWED_ATTR'in cfg?addToSet({},cfg.ALLOWED_ATTR):DEFAULT_ALLOWED_ATTR;URI_SAFE_ATTRIBUTES='ADD_URI_SAFE_ATTR'in cfg?addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES),cfg.ADD_URI_SAFE_ATTR):DEFAULT_URI_SAFE_ATTRIBUTES;DATA_URI_TAGS='ADD_DATA_URI_TAGS'in cfg?addToSet(clone(DEFAULT_DATA_URI_TAGS),cfg.ADD_DATA_URI_TAGS):DEFAULT_DATA_URI_TAGS;FORBID_CONTENTS='FORBID_CONTENTS'in cfg?addToSet({},cfg.FORBID_CONTENTS):DEFAULT_FORBID_CONTENTS;FORBID_TAGS='FORBID_TAGS'in cfg?addToSet({},cfg.FORBID_TAGS):{};FORBID_ATTR='FORBID_ATTR'in cfg?addToSet({},cfg.FORBID_ATTR):{};USE_PROFILES='USE_PROFILES'in cfg?cfg.USE_PROFILES:false;ALLOW_ARIA_ATTR=cfg.ALLOW_ARIA_ATTR!==false;ALLOW_DATA_ATTR=cfg.ALLOW_DATA_ATTR!==false;ALLOW_UNKNOWN_PROTOCOLS=cfg.ALLOW_UNKNOWN_PROTOCOLS||false;SAFE_FOR_TEMPLATES=cfg.SAFE_FOR_TEMPLATES||false;WHOLE_DOCUMENT=cfg.WHOLE_DOCUMENT||false;RETURN_DOM=cfg.RETURN_DOM||false;RETURN_DOM_FRAGMENT=cfg.RETURN_DOM_FRAGMENT||false;RETURN_TRUSTED_TYPE=cfg.RETURN_TRUSTED_TYPE||false;FORCE_BODY=cfg.FORCE_BODY||false;SANITIZE_DOM=cfg.SANITIZE_DOM!==false;KEEP_CONTENT=cfg.KEEP_CONTENT!==false;IN_PLACE=cfg.IN_PLACE||false;IS_ALLOWED_URI$1=cfg.ALLOWED_URI_REGEXP||IS_ALLOWED_URI$1;NAMESPACE=cfg.NAMESPACE||HTML_NAMESPACE;if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)){CUSTOM_ELEMENT_HANDLING.tagNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)){CUSTOM_ELEMENT_HANDLING.attributeNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements==='boolean'){CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;}PARSER_MEDIA_TYPE=SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE)===-1?PARSER_MEDIA_TYPE=DEFAULT_PARSER_MEDIA_TYPE:PARSER_MEDIA_TYPE=cfg.PARSER_MEDIA_TYPE;transformCaseFunc=PARSER_MEDIA_TYPE==='application/xhtml+xml'?function(x){return x;}:stringToLowerCase;if(SAFE_FOR_TEMPLATES){ALLOW_DATA_ATTR=false;}if(RETURN_DOM_FRAGMENT){RETURN_DOM=true;}if(USE_PROFILES){ALLOWED_TAGS=addToSet({},_toConsumableArray(text));ALLOWED_ATTR=[];if(USE_PROFILES.html===true){addToSet(ALLOWED_TAGS,html$1);addToSet(ALLOWED_ATTR,html);}if(USE_PROFILES.svg===true){addToSet(ALLOWED_TAGS,svg$1);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.svgFilters===true){addToSet(ALLOWED_TAGS,svgFilters);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.mathMl===true){addToSet(ALLOWED_TAGS,mathMl$1);addToSet(ALLOWED_ATTR,mathMl);addToSet(ALLOWED_ATTR,xml);}}if(cfg.ADD_TAGS){if(ALLOWED_TAGS===DEFAULT_ALLOWED_TAGS){ALLOWED_TAGS=clone(ALLOWED_TAGS);}addToSet(ALLOWED_TAGS,cfg.ADD_TAGS);}if(cfg.ADD_ATTR){if(ALLOWED_ATTR===DEFAULT_ALLOWED_ATTR){ALLOWED_ATTR=clone(ALLOWED_ATTR);}addToSet(ALLOWED_ATTR,cfg.ADD_ATTR);}if(cfg.ADD_URI_SAFE_ATTR){addToSet(URI_SAFE_ATTRIBUTES,cfg.ADD_URI_SAFE_ATTR);}if(cfg.FORBID_CONTENTS){if(FORBID_CONTENTS===DEFAULT_FORBID_CONTENTS){FORBID_CONTENTS=clone(FORBID_CONTENTS);}addToSet(FORBID_CONTENTS,cfg.FORBID_CONTENTS);}if(KEEP_CONTENT){ALLOWED_TAGS['#text']=true;}if(WHOLE_DOCUMENT){addToSet(ALLOWED_TAGS,['html','head','body']);}if(ALLOWED_TAGS.table){addToSet(ALLOWED_TAGS,['tbody']);delete FORBID_TAGS.tbody;}if(freeze){freeze(cfg);}CONFIG=cfg;};var MATHML_TEXT_INTEGRATION_POINTS=addToSet({},['mi','mo','mn','ms','mtext']);var HTML_INTEGRATION_POINTS=addToSet({},['foreignobject','desc','title','annotation-xml']);var COMMON_SVG_AND_HTML_ELEMENTS=addToSet({},['title','style','font','a','script']);var ALL_SVG_TAGS=addToSet({},svg$1);addToSet(ALL_SVG_TAGS,svgFilters);addToSet(ALL_SVG_TAGS,svgDisallowed);var ALL_MATHML_TAGS=addToSet({},mathMl$1);addToSet(ALL_MATHML_TAGS,mathMlDisallowed);var _checkValidNamespace=function _checkValidNamespace(element){var parent=getParentNode(element);if(!parent||!parent.tagName){parent={namespaceURI:HTML_NAMESPACE,tagName:'template'};}var tagName=stringToLowerCase(element.tagName);var parentTagName=stringToLowerCase(parent.tagName);if(element.namespaceURI===SVG_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='svg';}if(parent.namespaceURI===MATHML_NAMESPACE){return tagName==='svg'&&(parentTagName==='annotation-xml'||MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);}return Boolean(ALL_SVG_TAGS[tagName]);}if(element.namespaceURI===MATHML_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='math';}if(parent.namespaceURI===SVG_NAMESPACE){return tagName==='math'&&HTML_INTEGRATION_POINTS[parentTagName];}return Boolean(ALL_MATHML_TAGS[tagName]);}if(element.namespaceURI===HTML_NAMESPACE){if(parent.namespaceURI===SVG_NAMESPACE&&!HTML_INTEGRATION_POINTS[parentTagName]){return false;}if(parent.namespaceURI===MATHML_NAMESPACE&&!MATHML_TEXT_INTEGRATION_POINTS[parentTagName]){return false;}return!ALL_MATHML_TAGS[tagName]&&(COMMON_SVG_AND_HTML_ELEMENTS[tagName]||!ALL_SVG_TAGS[tagName]);}return false;};var _forceRemove=function _forceRemove(node){arrayPush(DOMPurify.removed,{element:node});try{node.parentNode.removeChild(node);}catch(_){try{node.outerHTML=emptyHTML;}catch(_){node.remove();}}};var _removeAttribute=function _removeAttribute(name,node){try{arrayPush(DOMPurify.removed,{attribute:node.getAttributeNode(name),from:node});}catch(_){arrayPush(DOMPurify.removed,{attribute:null,from:node});}node.removeAttribute(name);if(name==='is'&&!ALLOWED_ATTR[name]){if(RETURN_DOM||RETURN_DOM_FRAGMENT){try{_forceRemove(node);}catch(_){}}else{try{node.setAttribute(name,'');}catch(_){}}}};var _initDocument=function _initDocument(dirty){var doc;var leadingWhitespace;if(FORCE_BODY){dirty='<remove></remove>'+dirty;}else{var matches=stringMatch(dirty,/^[\\r\\n\\t ]+/);leadingWhitespace=matches&&matches[0];}if(PARSER_MEDIA_TYPE==='application/xhtml+xml'){dirty='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+dirty+'</body></html>';}var dirtyPayload=trustedTypesPolicy?trustedTypesPolicy.createHTML(dirty):dirty;if(NAMESPACE===HTML_NAMESPACE){try{doc=new DOMParser().parseFromString(dirtyPayload,PARSER_MEDIA_TYPE);}catch(_){}}if(!doc||!doc.documentElement){doc=implementation.createDocument(NAMESPACE,'template',null);try{doc.documentElement.innerHTML=IS_EMPTY_INPUT?'':dirtyPayload;}catch(_){}}var body=doc.body||doc.documentElement;if(dirty&&leadingWhitespace){body.insertBefore(document.createTextNode(leadingWhitespace),body.childNodes[0]||null);}if(NAMESPACE===HTML_NAMESPACE){return getElementsByTagName.call(doc,WHOLE_DOCUMENT?'html':'body')[0];}return WHOLE_DOCUMENT?doc.documentElement:body;};var _createIterator=function _createIterator(root){return createNodeIterator.call(root.ownerDocument||root,root,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null,false);};var _isClobbered=function _isClobbered(elm){return elm instanceof HTMLFormElement&&(typeof elm.nodeName!=='string'||typeof elm.textContent!=='string'||typeof elm.removeChild!=='function'||!(elm.attributes instanceof NamedNodeMap)||typeof elm.removeAttribute!=='function'||typeof elm.setAttribute!=='function'||typeof elm.namespaceURI!=='string'||typeof elm.insertBefore!=='function');};var _isNode=function _isNode(object){return _typeof(Node)==='object'?object instanceof Node:object&&_typeof(object)==='object'&&typeof object.nodeType==='number'&&typeof object.nodeName==='string';};var _executeHook=function _executeHook(entryPoint,currentNode,data){if(!hooks[entryPoint]){return;}arrayForEach(hooks[entryPoint],function(hook){hook.call(DOMPurify,currentNode,data,CONFIG);});};var _sanitizeElements=function _sanitizeElements(currentNode){var content;_executeHook('beforeSanitizeElements',currentNode,null);if(_isClobbered(currentNode)){_forceRemove(currentNode);return true;}if(regExpTest(/[\\u0080-\\uFFFF]/,currentNode.nodeName)){_forceRemove(currentNode);return true;}var tagName=transformCaseFunc(currentNode.nodeName);_executeHook('uponSanitizeElement',currentNode,{tagName:tagName,allowedTags:ALLOWED_TAGS});if(currentNode.hasChildNodes()&&!_isNode(currentNode.firstElementChild)&&(!_isNode(currentNode.content)||!_isNode(currentNode.content.firstElementChild))&&regExpTest(/<[/\\w]/g,currentNode.innerHTML)&&regExpTest(/<[/\\w]/g,currentNode.textContent)){_forceRemove(currentNode);return true;}if(tagName==='select'&&regExpTest(/<template/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){if(!FORBID_TAGS[tagName]&&_basicCustomElementTest(tagName)){if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,tagName))return false;if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName))return false;}if(KEEP_CONTENT&&!FORBID_CONTENTS[tagName]){var parentNode=getParentNode(currentNode)||currentNode.parentNode;var childNodes=getChildNodes(currentNode)||currentNode.childNodes;if(childNodes&&parentNode){var childCount=childNodes.length;for(var i=childCount-1;i>=0;--i){parentNode.insertBefore(cloneNode(childNodes[i],true),getNextSibling(currentNode));}}}_forceRemove(currentNode);return true;}if(currentNode instanceof Element&&!_checkValidNamespace(currentNode)){_forceRemove(currentNode);return true;}if((tagName==='noscript'||tagName==='noembed')&&regExpTest(/<\\/no(script|embed)/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(SAFE_FOR_TEMPLATES&&currentNode.nodeType===3){content=currentNode.textContent;content=stringReplace(content,MUSTACHE_EXPR$1,' ');content=stringReplace(content,ERB_EXPR$1,' ');if(currentNode.textContent!==content){arrayPush(DOMPurify.removed,{element:currentNode.cloneNode()});currentNode.textContent=content;}}_executeHook('afterSanitizeElements',currentNode,null);return false;};var _isValidAttribute=function _isValidAttribute(lcTag,lcName,value){if(SANITIZE_DOM&&(lcName==='id'||lcName==='name')&&(value in document||value in formElement)){return false;}if(ALLOW_DATA_ATTR&&!FORBID_ATTR[lcName]&&regExpTest(DATA_ATTR$1,lcName));else if(ALLOW_ARIA_ATTR&&regExpTest(ARIA_ATTR$1,lcName));else if(!ALLOWED_ATTR[lcName]||FORBID_ATTR[lcName]){if(_basicCustomElementTest(lcTag)&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,lcTag)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))&&(CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck,lcName)||CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName))||lcName==='is'&&CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,value)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(value)));else{return false;}}else if(URI_SAFE_ATTRIBUTES[lcName]);else if(regExpTest(IS_ALLOWED_URI$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if((lcName==='src'||lcName==='xlink:href'||lcName==='href')&&lcTag!=='script'&&stringIndexOf(value,'data:')===0&&DATA_URI_TAGS[lcTag]);else if(ALLOW_UNKNOWN_PROTOCOLS&&!regExpTest(IS_SCRIPT_OR_DATA$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if(!value);else{return false;}return true;};var _basicCustomElementTest=function _basicCustomElementTest(tagName){return tagName.indexOf('-')>0;};var _sanitizeAttributes=function _sanitizeAttributes(currentNode){var attr;var value;var lcName;var l;_executeHook('beforeSanitizeAttributes',currentNode,null);var attributes=currentNode.attributes;if(!attributes){return;}var hookEvent={attrName:'',attrValue:'',keepAttr:true,allowedAttributes:ALLOWED_ATTR};l=attributes.length;while(l--){attr=attributes[l];var _attr=attr,name=_attr.name,namespaceURI=_attr.namespaceURI;value=name==='value'?attr.value:stringTrim(attr.value);lcName=transformCaseFunc(name);var initValue=value;hookEvent.attrName=lcName;hookEvent.attrValue=value;hookEvent.keepAttr=true;hookEvent.forceKeepAttr=undefined;_executeHook('uponSanitizeAttribute',currentNode,hookEvent);value=hookEvent.attrValue;if(hookEvent.forceKeepAttr){continue;}if(!hookEvent.keepAttr){_removeAttribute(name,currentNode);continue;}if(regExpTest(/\\/>/i,value)){_removeAttribute(name,currentNode);continue;}if(SAFE_FOR_TEMPLATES){value=stringReplace(value,MUSTACHE_EXPR$1,' ');value=stringReplace(value,ERB_EXPR$1,' ');}var lcTag=transformCaseFunc(currentNode.nodeName);if(!_isValidAttribute(lcTag,lcName,value)){_removeAttribute(name,currentNode);continue;}if(value!==initValue){try{if(namespaceURI){currentNode.setAttributeNS(namespaceURI,name,value);}else{currentNode.setAttribute(name,value);}}catch(_){_removeAttribute(name,currentNode);}}}_executeHook('afterSanitizeAttributes',currentNode,null);};var _sanitizeShadowDOM=function _sanitizeShadowDOM(fragment){var shadowNode;var shadowIterator=_createIterator(fragment);_executeHook('beforeSanitizeShadowDOM',fragment,null);while(shadowNode=shadowIterator.nextNode()){_executeHook('uponSanitizeShadowNode',shadowNode,null);if(_sanitizeElements(shadowNode)){continue;}if(shadowNode.content instanceof DocumentFragment){_sanitizeShadowDOM(shadowNode.content);}_sanitizeAttributes(shadowNode);}_executeHook('afterSanitizeShadowDOM',fragment,null);};DOMPurify.sanitize=function(dirty,cfg){var body;var importedNode;var currentNode;var oldNode;var returnNode;IS_EMPTY_INPUT=!dirty;if(IS_EMPTY_INPUT){dirty='<!-->';}if(typeof dirty!=='string'&&!_isNode(dirty)){if(typeof dirty.toString!=='function'){throw typeErrorCreate('toString is not a function');}else{dirty=dirty.toString();if(typeof dirty!=='string'){throw typeErrorCreate('dirty is not a string, aborting');}}}if(!DOMPurify.isSupported){if(_typeof(window.toStaticHTML)==='object'||typeof window.toStaticHTML==='function'){if(typeof dirty==='string'){return window.toStaticHTML(dirty);}if(_isNode(dirty)){return window.toStaticHTML(dirty.outerHTML);}}return dirty;}if(!SET_CONFIG){_parseConfig(cfg);}DOMPurify.removed=[];if(typeof dirty==='string'){IN_PLACE=false;}if(IN_PLACE){if(dirty.nodeName){var tagName=transformCaseFunc(dirty.nodeName);if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');}}}else if(dirty instanceof Node){body=_initDocument('<!---->');importedNode=body.ownerDocument.importNode(dirty,true);if(importedNode.nodeType===1&&importedNode.nodeName==='BODY'){body=importedNode;}else if(importedNode.nodeName==='HTML'){body=importedNode;}else{body.appendChild(importedNode);}}else{if(!RETURN_DOM&&!SAFE_FOR_TEMPLATES&&!WHOLE_DOCUMENT&&dirty.indexOf('<')===-1){return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(dirty):dirty;}body=_initDocument(dirty);if(!body){return RETURN_DOM?null:RETURN_TRUSTED_TYPE?emptyHTML:'';}}if(body&&FORCE_BODY){_forceRemove(body.firstChild);}var nodeIterator=_createIterator(IN_PLACE?dirty:body);while(currentNode=nodeIterator.nextNode()){if(currentNode.nodeType===3&&currentNode===oldNode){continue;}if(_sanitizeElements(currentNode)){continue;}if(currentNode.content instanceof DocumentFragment){_sanitizeShadowDOM(currentNode.content);}_sanitizeAttributes(currentNode);oldNode=currentNode;}oldNode=null;if(IN_PLACE){return dirty;}if(RETURN_DOM){if(RETURN_DOM_FRAGMENT){returnNode=createDocumentFragment.call(body.ownerDocument);while(body.firstChild){returnNode.appendChild(body.firstChild);}}else{returnNode=body;}if(ALLOWED_ATTR.shadowroot){returnNode=importNode.call(originalDocument,returnNode,true);}return returnNode;}var serializedHTML=WHOLE_DOCUMENT?body.outerHTML:body.innerHTML;if(WHOLE_DOCUMENT&&ALLOWED_TAGS['!doctype']&&body.ownerDocument&&body.ownerDocument.doctype&&body.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,body.ownerDocument.doctype.name)){serializedHTML='<!DOCTYPE '+body.ownerDocument.doctype.name+'>\\n'+serializedHTML;}if(SAFE_FOR_TEMPLATES){serializedHTML=stringReplace(serializedHTML,MUSTACHE_EXPR$1,' ');serializedHTML=stringReplace(serializedHTML,ERB_EXPR$1,' ');}return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(serializedHTML):serializedHTML;};DOMPurify.setConfig=function(cfg){_parseConfig(cfg);SET_CONFIG=true;};DOMPurify.clearConfig=function(){CONFIG=null;SET_CONFIG=false;};DOMPurify.isValidAttribute=function(tag,attr,value){if(!CONFIG){_parseConfig({});}var lcTag=transformCaseFunc(tag);var lcName=transformCaseFunc(attr);return _isValidAttribute(lcTag,lcName,value);};DOMPurify.addHook=function(entryPoint,hookFunction){if(typeof hookFunction!=='function'){return;}hooks[entryPoint]=hooks[entryPoint]||[];arrayPush(hooks[entryPoint],hookFunction);};DOMPurify.removeHook=function(entryPoint){if(hooks[entryPoint]){return arrayPop(hooks[entryPoint]);}};DOMPurify.removeHooks=function(entryPoint){if(hooks[entryPoint]){hooks[entryPoint]=[];}};DOMPurify.removeAllHooks=function(){hooks={};};return DOMPurify;}var purify=createDOMPurify();var sanitizeHtmlString=html=>purify().sanitize(html);var isTouch=global$5.deviceType.isTouch();var hiddenHeader=(title,close)=>({dom:{tag:'div',styles:{display:'none'},classes:['tox-dialog__header']},components:[title,close]});var pClose=(onClose,providersBackstage)=>ModalDialog.parts.close(Button.sketch({dom:{tag:'button',classes:['tox-button','tox-button--icon','tox-button--naked'],attributes:{'type':'button','aria-label':providersBackstage.translate('Close')}},action:onClose,buttonBehaviours:derive$1([Tabstopping.config({})])}));var pUntitled=()=>ModalDialog.parts.title({dom:{tag:'div',classes:['tox-dialog__title'],innerHtml:'',styles:{display:'none'}}});var pBodyMessage=(message,providersBackstage)=>ModalDialog.parts.body({dom:{tag:'div',classes:['tox-dialog__body']},components:[{dom:{tag:'div',classes:['tox-dialog__body-content']},components:[{dom:fromHtml(\"<p>\".concat(sanitizeHtmlString(providersBackstage.translate(message)),\"</p>\"))}]}]});var pFooter=buttons=>ModalDialog.parts.footer({dom:{tag:'div',classes:['tox-dialog__footer']},components:buttons});var pFooterGroup=(startButtons,endButtons)=>[Container.sketch({dom:{tag:'div',classes:['tox-dialog__footer-start']},components:startButtons}),Container.sketch({dom:{tag:'div',classes:['tox-dialog__footer-end']},components:endButtons})];var renderDialog$1=spec=>{var dialogClass='tox-dialog';var blockerClass=dialogClass+'-wrap';var blockerBackdropClass=blockerClass+'__backdrop';var scrollLockClass=dialogClass+'__disable-scroll';return ModalDialog.sketch({lazySink:spec.lazySink,onEscape:comp=>{spec.onEscape(comp);return Optional.some(true);},useTabstopAt:elem=>!isPseudoStop(elem),firstTabstop:spec.firstTabstop,dom:{tag:'div',classes:[dialogClass].concat(spec.extraClasses),styles:_objectSpread({position:'relative'},spec.extraStyles)},components:[spec.header,spec.body,...spec.footer.toArray()],parts:{blocker:{dom:fromHtml(\"<div class=\\\"\".concat(blockerClass,\"\\\"></div>\")),components:[{dom:{tag:'div',classes:isTouch?[blockerBackdropClass,blockerBackdropClass+'--opaque']:[blockerBackdropClass]}}]}},dragBlockClass:blockerClass,modalBehaviours:derive$1([Focusing.config({}),config('dialog-events',spec.dialogEvents.concat([runOnSource(focusin(),(comp,_se)=>{Blocking.isBlocked(comp)?noop():Keying.focusIn(comp);}),run$1(focusShifted(),(comp,se)=>{comp.getSystem().broadcastOn([dialogFocusShiftedChannel],{newFocus:se.event.newFocus});})])),config('scroll-lock',[runOnAttached(()=>{add$2(body(),scrollLockClass);}),runOnDetached(()=>{remove$2(body(),scrollLockClass);})]),...spec.extraBehaviours]),eventOrder:_objectSpread({[execute$5()]:['dialog-events'],[attachedToDom()]:['scroll-lock','dialog-events','alloy.base.behaviour'],[detachedFromDom()]:['alloy.base.behaviour','dialog-events','scroll-lock']},spec.eventOrder)});};var renderClose=providersBackstage=>Button.sketch({dom:{tag:'button',classes:['tox-button','tox-button--icon','tox-button--naked'],attributes:{'type':'button','aria-label':providersBackstage.translate('Close'),'title':providersBackstage.translate('Close')}},buttonBehaviours:derive$1([Tabstopping.config({})]),components:[render$3('close',{tag:'span',classes:['tox-icon']},providersBackstage.icons)],action:comp=>{emit(comp,formCancelEvent);}});var renderTitle=(spec,dialogId,titleId,providersBackstage)=>{var renderComponents=data=>[text$2(providersBackstage.translate(data.title))];return{dom:{tag:'div',classes:['tox-dialog__title'],attributes:_objectSpread({},titleId.map(x=>({id:x})).getOr({}))},components:[],behaviours:derive$1([Reflecting.config({channel:\"\".concat(titleChannel,\"-\").concat(dialogId),initialData:spec,renderComponents})])};};var renderDragHandle=()=>({dom:fromHtml('<div class=\"tox-dialog__draghandle\"></div>')});var renderInlineHeader=(spec,dialogId,titleId,providersBackstage)=>Container.sketch({dom:fromHtml('<div class=\"tox-dialog__header\"></div>'),components:[renderTitle(spec,dialogId,Optional.some(titleId),providersBackstage),renderDragHandle(),renderClose(providersBackstage)],containerBehaviours:derive$1([Dragging.config({mode:'mouse',blockerClass:'blocker',getTarget:handle=>{return closest$1(handle,'[role=\"dialog\"]').getOrDie();},snaps:{getSnapPoints:()=>[],leftAttr:'data-drag-left',topAttr:'data-drag-top'}})])});var renderModalHeader=(spec,dialogId,providersBackstage)=>{var pTitle=ModalDialog.parts.title(renderTitle(spec,dialogId,Optional.none(),providersBackstage));var pHandle=ModalDialog.parts.draghandle(renderDragHandle());var pClose=ModalDialog.parts.close(renderClose(providersBackstage));var components=[pTitle].concat(spec.draggable?[pHandle]:[]).concat([pClose]);return Container.sketch({dom:fromHtml('<div class=\"tox-dialog__header\"></div>'),components});};var getHeader=(title,dialogId,backstage)=>renderModalHeader({title:backstage.shared.providers.translate(title),draggable:backstage.dialog.isDraggableModal()},dialogId,backstage.shared.providers);var getBusySpec=(message,bs,providers,headerHeight)=>({dom:{tag:'div',classes:['tox-dialog__busy-spinner'],attributes:{'aria-label':providers.translate(message)},styles:{left:'0px',right:'0px',bottom:'0px',top:\"\".concat(headerHeight.getOr(0),\"px\"),position:'absolute'}},behaviours:bs,components:[{dom:fromHtml('<div class=\"tox-spinner\"><div></div><div></div><div></div></div>')}]});var getEventExtras=(lazyDialog,providers,extra)=>({onClose:()=>extra.closeWindow(),onBlock:blockEvent=>{var headerHeight=descendant(lazyDialog().element,'.tox-dialog__header').map(header=>get$d(header));ModalDialog.setBusy(lazyDialog(),(_comp,bs)=>getBusySpec(blockEvent.message,bs,providers,headerHeight));},onUnblock:()=>{ModalDialog.setIdle(lazyDialog());}});var renderModalDialog=(spec,initialData,dialogEvents,backstage)=>{var updateState=(_comp,incoming)=>Optional.some(incoming);return build$1(renderDialog$1(_objectSpread(_objectSpread({},spec),{},{firstTabstop:1,lazySink:backstage.shared.getSink,extraBehaviours:[Reflecting.config({channel:\"\".concat(dialogChannel,\"-\").concat(spec.id),updateState,initialData}),memory({}),...spec.extraBehaviours],onEscape:comp=>{emit(comp,formCancelEvent);},dialogEvents,eventOrder:{[receive()]:[Reflecting.name(),Receiving.name()],[attachedToDom()]:['scroll-lock',Reflecting.name(),'messages','dialog-events','alloy.base.behaviour'],[detachedFromDom()]:['alloy.base.behaviour','dialog-events','messages',Reflecting.name(),'scroll-lock']}})));};var mapMenuButtons=function mapMenuButtons(buttons){var menuItemStates=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var mapItems=button=>{var items=map$2(button.items,item=>{var cell=get$g(menuItemStates,item.name).getOr(Cell(false));return _objectSpread(_objectSpread({},item),{},{storage:cell});});return _objectSpread(_objectSpread({},button),{},{items});};return map$2(buttons,button=>{return button.type==='menu'?mapItems(button):button;});};var extractCellsToObject=buttons=>foldl(buttons,(acc,button)=>{if(button.type==='menu'){var menuButton=button;return foldl(menuButton.items,(innerAcc,item)=>{innerAcc[item.name]=item.storage;return innerAcc;},acc);}return acc;},{});var initCommonEvents=(fireApiEvent,extras)=>[runWithTarget(focusin(),onFocus),fireApiEvent(formCloseEvent,(_api,spec,_event,self)=>{active$1(getRootNode(self.element)).fold(noop,blur$1);extras.onClose();spec.onClose();}),fireApiEvent(formCancelEvent,(api,spec,_event,self)=>{spec.onCancel(api);emit(self,formCloseEvent);}),run$1(formUnblockEvent,(_c,_se)=>extras.onUnblock()),run$1(formBlockEvent,(_c,se)=>extras.onBlock(se.event))];var initUrlDialog=(getInstanceApi,extras)=>{var fireApiEvent=(eventName,f)=>run$1(eventName,(c,se)=>{withSpec(c,(spec,_c)=>{f(getInstanceApi(),spec,se.event,c);});});var withSpec=(c,f)=>{Reflecting.getState(c).get().each(currentDialog=>{f(currentDialog,c);});};return[...initCommonEvents(fireApiEvent,extras),fireApiEvent(formActionEvent,(api,spec,event)=>{spec.onAction(api,{name:event.name});})];};var initDialog=(getInstanceApi,extras,getSink)=>{var fireApiEvent=(eventName,f)=>run$1(eventName,(c,se)=>{withSpec(c,(spec,_c)=>{f(getInstanceApi(),spec,se.event,c);});});var withSpec=(c,f)=>{Reflecting.getState(c).get().each(currentDialogInit=>{f(currentDialogInit.internalDialog,c);});};return[...initCommonEvents(fireApiEvent,extras),fireApiEvent(formSubmitEvent,(api,spec)=>spec.onSubmit(api)),fireApiEvent(formChangeEvent,(api,spec,event)=>{spec.onChange(api,{name:event.name});}),fireApiEvent(formActionEvent,(api,spec,event,component)=>{var focusIn=()=>component.getSystem().isConnected()?Keying.focusIn(component):undefined;var isDisabled=focused=>has$1(focused,'disabled')||getOpt(focused,'aria-disabled').exists(val=>val==='true');var rootNode=getRootNode(component.element);var current=active$1(rootNode);spec.onAction(api,{name:event.name,value:event.value});active$1(rootNode).fold(focusIn,focused=>{if(isDisabled(focused)){focusIn();}else if(current.exists(cur=>contains(focused,cur)&&isDisabled(cur))){focusIn();}else{getSink().toOptional().filter(sink=>!contains(sink.element,focused)).each(focusIn);}});}),fireApiEvent(formTabChangeEvent,(api,spec,event)=>{spec.onTabChange(api,{newTabName:event.name,oldTabName:event.oldName});}),runOnDetached(component=>{var api=getInstanceApi();Representing.setValue(component,api.getData());})];};var makeButton=(button,backstage)=>renderFooterButton(button,button.type,backstage);var lookup=(compInSystem,footerButtons,buttonName)=>find$5(footerButtons,button=>button.name===buttonName).bind(memButton=>memButton.memento.getOpt(compInSystem));var renderComponents=(_data,state)=>{var footerButtons=state.map(s=>s.footerButtons).getOr([]);var buttonGroups=partition$3(footerButtons,button=>button.align==='start');var makeGroup=(edge,buttons)=>Container.sketch({dom:{tag:'div',classes:[\"tox-dialog__footer-\".concat(edge)]},components:map$2(buttons,button=>button.memento.asSpec())});var startButtons=makeGroup('start',buttonGroups.pass);var endButtons=makeGroup('end',buttonGroups.fail);return[startButtons,endButtons];};var renderFooter=(initSpec,dialogId,backstage)=>{var updateState=(comp,data)=>{var footerButtons=map$2(data.buttons,button=>{var memButton=record(makeButton(button,backstage));return{name:button.name,align:button.align,memento:memButton};});var lookupByName=buttonName=>lookup(comp,footerButtons,buttonName);return Optional.some({lookupByName,footerButtons});};return{dom:fromHtml('<div class=\"tox-dialog__footer\"></div>'),components:[],behaviours:derive$1([Reflecting.config({channel:\"\".concat(footerChannel,\"-\").concat(dialogId),initialData:initSpec,updateState,renderComponents})])};};var renderInlineFooter=(initSpec,dialogId,backstage)=>renderFooter(initSpec,dialogId,backstage);var renderModalFooter=(initSpec,dialogId,backstage)=>ModalDialog.parts.footer(renderFooter(initSpec,dialogId,backstage));var getCompByName=(access,name)=>{var root=access.getRoot();if(root.getSystem().isConnected()){var form=Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper());return Form.getField(form,name).orThunk(()=>{var footer=access.getFooter();var footerState=footer.bind(f=>Reflecting.getState(f).get());return footerState.bind(f=>f.lookupByName(name));});}else{return Optional.none();}};var validateData$1=(access,data)=>{var root=access.getRoot();return Reflecting.getState(root).get().map(dialogState=>getOrDie(asRaw('data',dialogState.dataValidator,data))).getOr(data);};var getDialogApi=(access,doRedial,menuItemStates)=>{var withRoot=f=>{var root=access.getRoot();if(root.getSystem().isConnected()){f(root);}};var getData=()=>{var root=access.getRoot();var valueComp=root.getSystem().isConnected()?access.getFormWrapper():root;var representedValues=Representing.getValue(valueComp);var menuItemCurrentState=map$1(menuItemStates,cell=>cell.get());return _objectSpread(_objectSpread({},representedValues),menuItemCurrentState);};var setData=newData=>{withRoot(_=>{var prevData=instanceApi.getData();var mergedData=deepMerge(prevData,newData);var newInternalData=validateData$1(access,mergedData);var form=access.getFormWrapper();Representing.setValue(form,newInternalData);each(menuItemStates,(v,k)=>{if(has$2(mergedData,k)){v.set(mergedData[k]);}});});};var setEnabled=(name,state)=>{getCompByName(access,name).each(state?Disabling.enable:Disabling.disable);};var focus=name=>{getCompByName(access,name).each(Focusing.focus);};var block=message=>{if(!isString(message)){throw new Error('The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument');}withRoot(root=>{emitWith(root,formBlockEvent,{message});});};var unblock=()=>{withRoot(root=>{emit(root,formUnblockEvent);});};var showTab=name=>{withRoot(_=>{var body=access.getBody();var bodyState=Reflecting.getState(body);if(bodyState.get().exists(b=>b.isTabPanel())){Composing.getCurrent(body).each(tabSection=>{TabSection.showTab(tabSection,name);});}});};var redial=d=>{withRoot(root=>{var id=access.getId();var dialogInit=doRedial(d);var storedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons,menuItemStates);root.getSystem().broadcastOn([\"\".concat(dialogChannel,\"-\").concat(id)],dialogInit);root.getSystem().broadcastOn([\"\".concat(titleChannel,\"-\").concat(id)],dialogInit.internalDialog);root.getSystem().broadcastOn([\"\".concat(bodyChannel,\"-\").concat(id)],dialogInit.internalDialog);root.getSystem().broadcastOn([\"\".concat(footerChannel,\"-\").concat(id)],_objectSpread(_objectSpread({},dialogInit.internalDialog),{},{buttons:storedMenuButtons}));instanceApi.setData(dialogInit.initialData);});};var close=()=>{withRoot(root=>{emit(root,formCloseEvent);});};var instanceApi={getData,setData,setEnabled,focus,block,unblock,showTab,redial,close,toggleFullscreen:access.toggleFullscreen};return instanceApi;};var getDialogSizeClasses=size=>{switch(size){case'large':return['tox-dialog--width-lg'];case'medium':return['tox-dialog--width-md'];default:return[];}};var renderDialog=(dialogInit,extra,backstage)=>{var dialogId=generate$6('dialog');var internalDialog=dialogInit.internalDialog;var header=getHeader(internalDialog.title,dialogId,backstage);var body=renderModalBody({body:internalDialog.body,initialData:internalDialog.initialData},dialogId,backstage);var storedMenuButtons=mapMenuButtons(internalDialog.buttons);var objOfCells=extractCellsToObject(storedMenuButtons);var footer=someIf(storedMenuButtons.length!==0,renderModalFooter({buttons:storedMenuButtons},dialogId,backstage));var dialogEvents=initDialog(()=>instanceApi,getEventExtras(()=>dialog,backstage.shared.providers,extra),backstage.shared.getSink);var dialogSize=getDialogSizeClasses(internalDialog.size);var spec={id:dialogId,header,body,footer,extraClasses:dialogSize,extraBehaviours:[],extraStyles:{}};var dialog=renderModalDialog(spec,dialogInit,dialogEvents,backstage);var modalAccess=(()=>{var getForm=()=>{var outerForm=ModalDialog.getBody(dialog);return Composing.getCurrent(outerForm).getOr(outerForm);};var toggleFullscreen=()=>{var fullscreenClass='tox-dialog--fullscreen';var sugarBody=SugarElement.fromDom(dialog.element.dom);if(!has(sugarBody,fullscreenClass)){remove$1(sugarBody,dialogSize);add$2(sugarBody,fullscreenClass);}else{remove$2(sugarBody,fullscreenClass);add$1(sugarBody,dialogSize);}};return{getId:constant$1(dialogId),getRoot:constant$1(dialog),getBody:()=>ModalDialog.getBody(dialog),getFooter:()=>ModalDialog.getFooter(dialog),getFormWrapper:getForm,toggleFullscreen};})();var instanceApi=getDialogApi(modalAccess,extra.redial,objOfCells);return{dialog,instanceApi};};var getInlineDialogSizeClass=size=>{switch(size){case'medium':return Optional.some('tox-dialog--width-md');default:return Optional.none();}};var renderInlineDialog=function renderInlineDialog(dialogInit,extra,backstage){var ariaAttrs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var dialogId=generate$6('dialog');var dialogLabelId=generate$6('dialog-label');var dialogContentId=generate$6('dialog-content');var internalDialog=dialogInit.internalDialog;var dialogSize=getInlineDialogSizeClass(internalDialog.size);var updateState=(_comp,incoming)=>Optional.some(incoming);var memHeader=record(renderInlineHeader({title:internalDialog.title,draggable:true},dialogId,dialogLabelId,backstage.shared.providers));var memBody=record(renderInlineBody({body:internalDialog.body,initialData:internalDialog.initialData},dialogId,dialogContentId,backstage,ariaAttrs));var storagedMenuButtons=mapMenuButtons(internalDialog.buttons);var objOfCells=extractCellsToObject(storagedMenuButtons);var optMemFooter=someIf(storagedMenuButtons.length!==0,record(renderInlineFooter({buttons:storagedMenuButtons},dialogId,backstage)));var dialogEvents=initDialog(()=>instanceApi,{onBlock:event=>{Blocking.block(dialog,(_comp,bs)=>{var headerHeight=memHeader.getOpt(dialog).map(dialog=>get$d(dialog.element));return getBusySpec(event.message,bs,backstage.shared.providers,headerHeight);});},onUnblock:()=>{Blocking.unblock(dialog);},onClose:()=>extra.closeWindow()},backstage.shared.getSink);var inlineClass='tox-dialog-inline';var dialog=build$1({dom:{tag:'div',classes:['tox-dialog',inlineClass,...dialogSize.toArray()],attributes:{role:'dialog',['aria-labelledby']:dialogLabelId}},eventOrder:{[receive()]:[Reflecting.name(),Receiving.name()],[execute$5()]:['execute-on-form'],[attachedToDom()]:['reflecting','execute-on-form']},behaviours:derive$1([Keying.config({mode:'cyclic',onEscape:c=>{emit(c,formCloseEvent);return Optional.some(true);},useTabstopAt:elem=>!isPseudoStop(elem)&&(name$3(elem)!=='button'||get$f(elem,'disabled')!=='disabled'),firstTabstop:1}),Reflecting.config({channel:\"\".concat(dialogChannel,\"-\").concat(dialogId),updateState,initialData:dialogInit}),Focusing.config({}),config('execute-on-form',dialogEvents.concat([runOnSource(focusin(),(comp,_se)=>{Keying.focusIn(comp);}),run$1(focusShifted(),(comp,se)=>{comp.getSystem().broadcastOn([dialogFocusShiftedChannel],{newFocus:se.event.newFocus});})])),Blocking.config({getRoot:()=>Optional.some(dialog)}),Replacing.config({}),memory({})]),components:[memHeader.asSpec(),memBody.asSpec(),...optMemFooter.map(memFooter=>memFooter.asSpec()).toArray()]});var toggleFullscreen=()=>{var fullscreenClass='tox-dialog--fullscreen';var sugarBody=SugarElement.fromDom(dialog.element.dom);if(!hasAll(sugarBody,[fullscreenClass])){remove$1(sugarBody,[inlineClass]);add$1(sugarBody,[fullscreenClass]);}else{remove$1(sugarBody,[fullscreenClass]);add$1(sugarBody,[inlineClass]);}};var instanceApi=getDialogApi({getId:constant$1(dialogId),getRoot:constant$1(dialog),getFooter:()=>optMemFooter.map(memFooter=>memFooter.get(dialog)),getBody:()=>memBody.get(dialog),getFormWrapper:()=>{var body=memBody.get(dialog);return Composing.getCurrent(body).getOr(body);},toggleFullscreen},extra.redial,objOfCells);return{dialog,instanceApi};};var global=tinymce.util.Tools.resolve('tinymce.util.URI');var getUrlDialogApi=root=>{var withRoot=f=>{if(root.getSystem().isConnected()){f(root);}};var block=message=>{if(!isString(message)){throw new Error('The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument');}withRoot(root=>{emitWith(root,formBlockEvent,{message});});};var unblock=()=>{withRoot(root=>{emit(root,formUnblockEvent);});};var close=()=>{withRoot(root=>{emit(root,formCloseEvent);});};var sendMessage=data=>{withRoot(root=>{root.getSystem().broadcastOn([bodySendMessageChannel],data);});};return{block,unblock,close,sendMessage};};var SUPPORTED_MESSAGE_ACTIONS=['insertContent','setContent','execCommand','close','block','unblock'];var isSupportedMessage=data=>isObject(data)&&SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction)!==-1;var isCustomMessage=data=>!isSupportedMessage(data)&&isObject(data)&&has$2(data,'mceAction');var handleMessage=(editor,api,data)=>{switch(data.mceAction){case'insertContent':editor.insertContent(data.content);break;case'setContent':editor.setContent(data.content);break;case'execCommand':var ui=isBoolean(data.ui)?data.ui:false;editor.execCommand(data.cmd,ui,data.value);break;case'close':api.close();break;case'block':api.block(data.message);break;case'unblock':api.unblock();break;}};var renderUrlDialog=(internalDialog,extra,editor,backstage)=>{var dialogId=generate$6('dialog');var header=getHeader(internalDialog.title,dialogId,backstage);var body=renderIframeBody(internalDialog);var footer=internalDialog.buttons.bind(buttons=>{if(buttons.length===0){return Optional.none();}else{return Optional.some(renderModalFooter({buttons},dialogId,backstage));}});var dialogEvents=initUrlDialog(()=>instanceApi,getEventExtras(()=>dialog,backstage.shared.providers,extra));var styles=_objectSpread(_objectSpread({},internalDialog.height.fold(()=>({}),height=>({'height':height+'px','max-height':height+'px'}))),internalDialog.width.fold(()=>({}),width=>({'width':width+'px','max-width':width+'px'})));var classes=internalDialog.width.isNone()&&internalDialog.height.isNone()?['tox-dialog--width-lg']:[];var iframeUri=new global(internalDialog.url,{base_uri:new global(window.location.href)});var iframeDomain=\"\".concat(iframeUri.protocol,\"://\").concat(iframeUri.host).concat(iframeUri.port?':'+iframeUri.port:'');var messageHandlerUnbinder=unbindable();var extraBehaviours=[config('messages',[runOnAttached(()=>{var unbind=bind(SugarElement.fromDom(window),'message',e=>{if(iframeUri.isSameOrigin(new global(e.raw.origin))){var data=e.raw.data;if(isSupportedMessage(data)){handleMessage(editor,instanceApi,data);}else if(isCustomMessage(data)){internalDialog.onMessage(instanceApi,data);}}});messageHandlerUnbinder.set(unbind);}),runOnDetached(messageHandlerUnbinder.clear)]),Receiving.config({channels:{[bodySendMessageChannel]:{onReceive:(comp,data)=>{descendant(comp.element,'iframe').each(iframeEle=>{var iframeWin=iframeEle.dom.contentWindow;if(isNonNullable(iframeWin)){iframeWin.postMessage(data,iframeDomain);}});}}}})];var spec={id:dialogId,header,body,footer,extraClasses:classes,extraBehaviours,extraStyles:styles};var dialog=renderModalDialog(spec,internalDialog,dialogEvents,backstage);var instanceApi=getUrlDialogApi(dialog);return{dialog,instanceApi};};var setup$2=backstage=>{var sharedBackstage=backstage.shared;var open=(message,callback)=>{var closeDialog=()=>{ModalDialog.hide(alertDialog);callback();};var memFooterClose=record(renderFooterButton({name:'close-alert',text:'OK',primary:true,buttonType:Optional.some('primary'),align:'end',enabled:true,icon:Optional.none()},'cancel',backstage));var titleSpec=pUntitled();var closeSpec=pClose(closeDialog,sharedBackstage.providers);var alertDialog=build$1(renderDialog$1({lazySink:()=>sharedBackstage.getSink(),header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[memFooterClose.asSpec()]))),onEscape:closeDialog,extraClasses:['tox-alert-dialog'],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,closeDialog)],eventOrder:{}}));ModalDialog.show(alertDialog);var footerCloseButton=memFooterClose.get(alertDialog);Focusing.focus(footerCloseButton);};return{open};};var setup$1=backstage=>{var sharedBackstage=backstage.shared;var open=(message,callback)=>{var closeDialog=state=>{ModalDialog.hide(confirmDialog);callback(state);};var memFooterYes=record(renderFooterButton({name:'yes',text:'Yes',primary:true,buttonType:Optional.some('primary'),align:'end',enabled:true,icon:Optional.none()},'submit',backstage));var footerNo=renderFooterButton({name:'no',text:'No',primary:false,buttonType:Optional.some('secondary'),align:'end',enabled:true,icon:Optional.none()},'cancel',backstage);var titleSpec=pUntitled();var closeSpec=pClose(()=>closeDialog(false),sharedBackstage.providers);var confirmDialog=build$1(renderDialog$1({lazySink:()=>sharedBackstage.getSink(),header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[footerNo,memFooterYes.asSpec()]))),onEscape:()=>closeDialog(false),extraClasses:['tox-confirm-dialog'],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,()=>closeDialog(false)),run$1(formSubmitEvent,()=>closeDialog(true))],eventOrder:{}}));ModalDialog.show(confirmDialog);var footerYesButton=memFooterYes.get(confirmDialog);Focusing.focus(footerYesButton);};return{open};};var validateData=(data,validator)=>getOrDie(asRaw('data',validator,data));var isAlertOrConfirmDialog=target=>closest(target,'.tox-alert-dialog')||closest(target,'.tox-confirm-dialog');var inlineAdditionalBehaviours=(editor,isStickyToolbar,isToolbarLocationTop)=>{if(isStickyToolbar&&isToolbarLocationTop){return[];}else{return[Docking.config({contextual:{lazyContext:()=>Optional.some(box$1(SugarElement.fromDom(editor.getContentAreaContainer()))),fadeInClass:'tox-dialog-dock-fadein',fadeOutClass:'tox-dialog-dock-fadeout',transitionClass:'tox-dialog-dock-transition'},modes:['top'],lazyViewport:comp=>{var optScrollingContext=detectWhenSplitUiMode(editor,comp.element);return optScrollingContext.map(sc=>{var combinedBounds=getBoundsFrom(sc);return{bounds:combinedBounds,optScrollEnv:Optional.some({currentScrollTop:sc.element.dom.scrollTop,scrollElmTop:absolute$3(sc.element).top})};}).getOrThunk(()=>({bounds:win(),optScrollEnv:Optional.none()}));}})];}};var setup=extras=>{var editor=extras.editor;var isStickyToolbar$1=isStickyToolbar(editor);var alertDialog=setup$2(extras.backstages.dialog);var confirmDialog=setup$1(extras.backstages.dialog);var open=(config,params,closeWindow)=>{if(!isUndefined(params)){if(params.inline==='toolbar'){return openInlineDialog(config,extras.backstages.popup.shared.anchors.inlineDialog(),closeWindow,params);}else if(params.inline==='bottom'){return openBottomInlineDialog(config,extras.backstages.popup.shared.anchors.inlineBottomDialog(),closeWindow,params);}else if(params.inline==='cursor'){return openInlineDialog(config,extras.backstages.popup.shared.anchors.cursor(),closeWindow,params);}}return openModalDialog(config,closeWindow);};var openUrl=(config,closeWindow)=>openModalUrlDialog(config,closeWindow);var openModalUrlDialog=(config,_closeWindow)=>{var factory=contents=>{var dialog=renderUrlDialog(contents,{closeWindow:()=>{ModalDialog.hide(dialog.dialog);_closeWindow(dialog.instanceApi);}},editor,extras.backstages.dialog);ModalDialog.show(dialog.dialog);return dialog.instanceApi;};return DialogManager.openUrl(factory,config);};var openModalDialog=(config,_closeWindow2)=>{var factory=(contents,internalInitialData,dataValidator)=>{var initialData=internalInitialData;var dialogInit={dataValidator,initialData,internalDialog:contents};var dialog=renderDialog(dialogInit,{redial:DialogManager.redial,closeWindow:()=>{ModalDialog.hide(dialog.dialog);_closeWindow2(dialog.instanceApi);}},extras.backstages.dialog);ModalDialog.show(dialog.dialog);dialog.instanceApi.setData(initialData);return dialog.instanceApi;};return DialogManager.open(factory,config);};var openInlineDialog=(config$1,anchor,_closeWindow3,windowParams)=>{var factory=(contents,internalInitialData,dataValidator)=>{var initialData=validateData(internalInitialData,dataValidator);var inlineDialog=value$2();var isToolbarLocationTop=extras.backstages.popup.shared.header.isPositionedAtTop();var dialogInit={dataValidator,initialData,internalDialog:contents};var refreshDocking=()=>inlineDialog.on(dialog=>{InlineView.reposition(dialog);Docking.refresh(dialog);});var dialogUi=renderInlineDialog(dialogInit,{redial:DialogManager.redial,closeWindow:()=>{inlineDialog.on(InlineView.hide);editor.off('ResizeEditor',refreshDocking);inlineDialog.clear();_closeWindow3(dialogUi.instanceApi);}},extras.backstages.popup,windowParams.ariaAttrs);var inlineDialogComp=build$1(InlineView.sketch(_objectSpread(_objectSpread({lazySink:extras.backstages.popup.shared.getSink,dom:{tag:'div',classes:[]},fireDismissalEventInstead:windowParams.persistent?{event:'doNotDismissYet'}:{}},isToolbarLocationTop?{}:{fireRepositionEventInstead:{}}),{},{inlineBehaviours:derive$1([config('window-manager-inline-events',[run$1(dismissRequested(),(_comp,_se)=>{emit(dialogUi.dialog,formCancelEvent);})]),...inlineAdditionalBehaviours(editor,isStickyToolbar$1,isToolbarLocationTop)]),isExtraPart:(_comp,target)=>isAlertOrConfirmDialog(target)})));inlineDialog.set(inlineDialogComp);var getInlineDialogBounds=()=>{var elem=editor.inline?body():SugarElement.fromDom(editor.getContainer());var bounds=box$1(elem);return Optional.some(bounds);};InlineView.showWithinBounds(inlineDialogComp,premade(dialogUi.dialog),{anchor},getInlineDialogBounds);if(!isStickyToolbar$1||!isToolbarLocationTop){Docking.refresh(inlineDialogComp);editor.on('ResizeEditor',refreshDocking);}dialogUi.instanceApi.setData(initialData);Keying.focusIn(dialogUi.dialog);return dialogUi.instanceApi;};return DialogManager.open(factory,config$1);};var openBottomInlineDialog=(config$1,anchor,_closeWindow4,windowParams)=>{var factory=(contents,internalInitialData,dataValidator)=>{var initialData=validateData(internalInitialData,dataValidator);var inlineDialog=value$2();var isToolbarLocationTop=extras.backstages.popup.shared.header.isPositionedAtTop();var dialogInit={dataValidator,initialData,internalDialog:contents};var refreshDocking=()=>inlineDialog.on(dialog=>{InlineView.reposition(dialog);Docking.refresh(dialog);});var dialogUi=renderInlineDialog(dialogInit,{redial:DialogManager.redial,closeWindow:()=>{inlineDialog.on(InlineView.hide);editor.off('ResizeEditor ScrollWindow ElementScroll',refreshDocking);inlineDialog.clear();_closeWindow4(dialogUi.instanceApi);}},extras.backstages.popup,windowParams.ariaAttrs);var inlineDialogComp=build$1(InlineView.sketch(_objectSpread(_objectSpread({lazySink:extras.backstages.popup.shared.getSink,dom:{tag:'div',classes:[]},fireDismissalEventInstead:windowParams.persistent?{event:'doNotDismissYet'}:{}},isToolbarLocationTop?{}:{fireRepositionEventInstead:{}}),{},{inlineBehaviours:derive$1([config('window-manager-inline-events',[run$1(dismissRequested(),(_comp,_se)=>{emit(dialogUi.dialog,formCancelEvent);})]),Docking.config({contextual:{lazyContext:()=>Optional.some(box$1(SugarElement.fromDom(editor.getContentAreaContainer()))),fadeInClass:'tox-dialog-dock-fadein',fadeOutClass:'tox-dialog-dock-fadeout',transitionClass:'tox-dialog-dock-transition'},modes:['top','bottom'],lazyViewport:comp=>{var optScrollingContext=detectWhenSplitUiMode(editor,comp.element);return optScrollingContext.map(sc=>{var combinedBounds=getBoundsFrom(sc);return{bounds:combinedBounds,optScrollEnv:Optional.some({currentScrollTop:sc.element.dom.scrollTop,scrollElmTop:absolute$3(sc.element).top})};}).getOrThunk(()=>({bounds:win(),optScrollEnv:Optional.none()}));}})]),isExtraPart:(_comp,target)=>isAlertOrConfirmDialog(target)})));inlineDialog.set(inlineDialogComp);var getInlineDialogBounds=()=>{return extras.backstages.popup.shared.getSink().toOptional().bind(s=>{var optScrollingContext=detectWhenSplitUiMode(editor,s.element);var margin=15;var bounds$1=optScrollingContext.map(sc=>getBoundsFrom(sc)).getOr(win());var contentAreaContainer=box$1(SugarElement.fromDom(editor.getContentAreaContainer()));var constrainedBounds=constrain(contentAreaContainer,bounds$1);return Optional.some(bounds(constrainedBounds.x,constrainedBounds.y,constrainedBounds.width,constrainedBounds.height-margin));});};InlineView.showWithinBounds(inlineDialogComp,premade(dialogUi.dialog),{anchor},getInlineDialogBounds);Docking.refresh(inlineDialogComp);editor.on('ResizeEditor ScrollWindow ElementScroll',refreshDocking);dialogUi.instanceApi.setData(initialData);Keying.focusIn(dialogUi.dialog);return dialogUi.instanceApi;};return DialogManager.open(factory,config$1);};var confirm=(message,callback)=>{confirmDialog.open(message,callback);};var alert=(message,callback)=>{alertDialog.open(message,callback);};var close=instanceApi=>{instanceApi.close();};return{open,openUrl,alert,close,confirm};};var registerOptions=editor=>{register$e(editor);register$d(editor);register(editor);};var Theme=()=>{global$a.add('silver',editor=>{registerOptions(editor);var popupSinkBounds=()=>win();var{dialogs,popups,renderUI:renderModeUI}=setup$3(editor,{getPopupSinkBounds:()=>popupSinkBounds()});var renderUI=/*#__PURE__*/function(){var _ref20=_asyncToGenerator(function*(){var renderResult=yield renderModeUI();var optScrollingContext=detectWhenSplitUiMode(editor,popups.getMothership().element);optScrollingContext.each(sc=>{popupSinkBounds=()=>{return getBoundsFrom(sc);};});return renderResult;});return function renderUI(){return _ref20.apply(this,arguments);};}();Autocompleter.register(editor,popups.backstage.shared);var windowMgr=setup({editor,backstages:{popup:popups.backstage,dialog:dialogs.backstage}});var getNotificationManagerImpl=()=>NotificationManagerImpl(editor,{backstage:popups.backstage},popups.getMothership());return{renderUI,getWindowManagerImpl:constant$1(windowMgr),getNotificationManagerImpl};});};Theme();})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/themes/silver/theme.js?");

/***/ }),

/***/ "./node_modules/tinymce/tinymce.js":
/*!*****************************************!*\
  !*** ./node_modules/tinymce/tinymce.js ***!
  \*****************************************/
/***/ ((module) => {

eval("var _excluded=[\"uid\"];function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,\"next\",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,\"throw\",err);}_next(undefined);});};}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}/**\n * TinyMCE version 6.7.0 (2023-08-30)\n */(function(){'use strict';var typeOf$1=function typeOf$1(x){if(x===null){return'null';}if(x===undefined){return'undefined';}var t=typeof x;if(t==='object'&&(Array.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='Array')){return'array';}if(t==='object'&&(String.prototype.isPrototypeOf(x)||x.constructor&&x.constructor.name==='String')){return'string';}return t;};var isEquatableType=function isEquatableType(x){return['undefined','boolean','number','string','function','xml','null'].indexOf(x)!==-1;};var sort$1=function sort$1(xs,compareFn){var clone=Array.prototype.slice.call(xs);return clone.sort(compareFn);};var contramap=function contramap(eqa,f){return eq$2(function(x,y){return eqa.eq(f(x),f(y));});};var eq$2=function eq$2(f){return{eq:f};};var tripleEq=eq$2(function(x,y){return x===y;});var eqString=tripleEq;var eqArray=function eqArray(eqa){return eq$2(function(x,y){if(x.length!==y.length){return false;}var len=x.length;for(var i=0;i<len;i++){if(!eqa.eq(x[i],y[i])){return false;}}return true;});};var eqSortedArray=function eqSortedArray(eqa,compareFn){return contramap(eqArray(eqa),function(xs){return sort$1(xs,compareFn);});};var eqRecord=function eqRecord(eqa){return eq$2(function(x,y){var kx=Object.keys(x);var ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky)){return false;}var len=kx.length;for(var i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q])){return false;}}return true;});};var eqAny=eq$2(function(x,y){if(x===y){return true;}var tx=typeOf$1(x);var ty=typeOf$1(y);if(tx!==ty){return false;}if(isEquatableType(tx)){return x===y;}else if(tx==='array'){return eqArray(eqAny).eq(x,y);}else if(tx==='object'){return eqRecord(eqAny).eq(x,y);}return false;});var getPrototypeOf$2=Object.getPrototypeOf;var hasProto=(v,constructor,predicate)=>{var _a;if(predicate(v,constructor.prototype)){return true;}else{return((_a=v.constructor)===null||_a===void 0?void 0:_a.name)===constructor.name;}};var typeOf=x=>{var t=typeof x;if(x===null){return'null';}else if(t==='object'&&Array.isArray(x)){return'array';}else if(t==='object'&&hasProto(x,String,(o,proto)=>proto.isPrototypeOf(o))){return'string';}else{return t;}};var isType$1=type=>value=>typeOf(value)===type;var isSimpleType=type=>value=>typeof value===type;var eq$1=t=>a=>t===a;var is$4=(value,constructor)=>isObject(value)&&hasProto(value,constructor,(o,proto)=>getPrototypeOf$2(o)===proto);var isString=isType$1('string');var isObject=isType$1('object');var isPlainObject=value=>is$4(value,Object);var isArray$1=isType$1('array');var isNull=eq$1(null);var isBoolean=isSimpleType('boolean');var isUndefined=eq$1(undefined);var isNullable=a=>a===null||a===undefined;var isNonNullable=a=>!isNullable(a);var isFunction=isSimpleType('function');var isNumber=isSimpleType('number');var isArrayOf=(value,pred)=>{if(isArray$1(value)){for(var i=0,len=value.length;i<len;++i){if(!pred(value[i])){return false;}}return true;}return false;};var noop=()=>{};var compose=(fa,fb)=>{return function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}return fa(fb.apply(null,args));};};var compose1=(fbc,fab)=>a=>fbc(fab(a));var constant=value=>{return()=>{return value;};};var identity=x=>{return x;};var tripleEquals=(a,b)=>{return a===b;};function curry(fn){for(var _len4=arguments.length,initialArgs=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){initialArgs[_key4-1]=arguments[_key4];}return function(){for(var _len5=arguments.length,restArgs=new Array(_len5),_key5=0;_key5<_len5;_key5++){restArgs[_key5]=arguments[_key5];}var all=initialArgs.concat(restArgs);return fn.apply(null,all);};}var not=f=>t=>!f(t);var die=msg=>{return()=>{throw new Error(msg);};};var apply$1=f=>{return f();};var call=f=>{f();};var never=constant(false);var always=constant(true);class Optional{constructor(tag,value){this.tag=tag;this.value=value;}static some(value){return new Optional(true,value);}static none(){return Optional.singletonNone;}fold(onNone,onSome){if(this.tag){return onSome(this.value);}else{return onNone();}}isSome(){return this.tag;}isNone(){return!this.tag;}map(mapper){if(this.tag){return Optional.some(mapper(this.value));}else{return Optional.none();}}bind(binder){if(this.tag){return binder(this.value);}else{return Optional.none();}}exists(predicate){return this.tag&&predicate(this.value);}forall(predicate){return!this.tag||predicate(this.value);}filter(predicate){if(!this.tag||predicate(this.value)){return this;}else{return Optional.none();}}getOr(replacement){return this.tag?this.value:replacement;}or(replacement){return this.tag?this:replacement;}getOrThunk(thunk){return this.tag?this.value:thunk();}orThunk(thunk){return this.tag?this:thunk();}getOrDie(message){if(!this.tag){throw new Error(message!==null&&message!==void 0?message:'Called getOrDie on None');}else{return this.value;}}static from(value){return isNonNullable(value)?Optional.some(value):Optional.none();}getOrNull(){return this.tag?this.value:null;}getOrUndefined(){return this.value;}each(worker){if(this.tag){worker(this.value);}}toArray(){return this.tag?[this.value]:[];}toString(){return this.tag?\"some(\".concat(this.value,\")\"):'none()';}}Optional.singletonNone=new Optional(false);var nativeSlice=Array.prototype.slice;var nativeIndexOf=Array.prototype.indexOf;var nativePush=Array.prototype.push;var rawIndexOf=(ts,t)=>nativeIndexOf.call(ts,t);var indexOf$1=(xs,x)=>{var r=rawIndexOf(xs,x);return r===-1?Optional.none():Optional.some(r);};var contains$2=(xs,x)=>rawIndexOf(xs,x)>-1;var exists=(xs,pred)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return true;}}return false;};var map$3=(xs,f)=>{var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i);}return r;};var each$e=(xs,f)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i);}};var eachr=(xs,f)=>{for(var i=xs.length-1;i>=0;i--){var x=xs[i];f(x,i);}};var partition$2=(xs,pred)=>{var pass=[];var fail=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];var arr=pred(x,i)?pass:fail;arr.push(x);}return{pass,fail};};var filter$5=(xs,pred)=>{var r=[];for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){r.push(x);}}return r;};var foldr=(xs,f,acc)=>{eachr(xs,(x,i)=>{acc=f(acc,x,i);});return acc;};var foldl=(xs,f,acc)=>{each$e(xs,(x,i)=>{acc=f(acc,x,i);});return acc;};var findUntil$1=(xs,pred,until)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(x);}else if(until(x,i)){break;}}return Optional.none();};var find$2=(xs,pred)=>{return findUntil$1(xs,pred,never);};var findIndex$2=(xs,pred)=>{for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return Optional.some(i);}}return Optional.none();};var flatten=xs=>{var r=[];for(var i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i])){throw new Error('Arr.flatten item '+i+' was not an array, input: '+xs);}nativePush.apply(r,xs[i]);}return r;};var bind$3=(xs,f)=>flatten(map$3(xs,f));var forall=(xs,pred)=>{for(var i=0,len=xs.length;i<len;++i){var x=xs[i];if(pred(x,i)!==true){return false;}}return true;};var reverse=xs=>{var r=nativeSlice.call(xs,0);r.reverse();return r;};var difference=(a1,a2)=>filter$5(a1,x=>!contains$2(a2,x));var mapToObject=(xs,f)=>{var r={};for(var i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i);}return r;};var sort=(xs,comparator)=>{var copy=nativeSlice.call(xs,0);copy.sort(comparator);return copy;};var get$b=(xs,i)=>i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none();var head=xs=>get$b(xs,0);var last$3=xs=>get$b(xs,xs.length-1);var from=isFunction(Array.from)?Array.from:x=>nativeSlice.call(x);var findMap=(arr,f)=>{for(var i=0;i<arr.length;i++){var _r=f(arr[i],i);if(_r.isSome()){return _r;}}return Optional.none();};var unique$1=(xs,comparator)=>{var r=[];var isDuplicated=isFunction(comparator)?x=>exists(r,i=>comparator(i,x)):x=>contains$2(r,x);for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(!isDuplicated(x)){r.push(x);}}return r;};var keys=Object.keys;var hasOwnProperty$2=Object.hasOwnProperty;var each$d=(obj,f)=>{var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i);}};var map$2=(obj,f)=>{return tupleMap(obj,(x,i)=>({k:i,v:f(x,i)}));};var tupleMap=(obj,f)=>{var r={};each$d(obj,(x,i)=>{var tuple=f(x,i);r[tuple.k]=tuple.v;});return r;};var objAcc=r=>(x,i)=>{r[i]=x;};var internalFilter=(obj,pred,onTrue,onFalse)=>{each$d(obj,(x,i)=>{(pred(x,i)?onTrue:onFalse)(x,i);});};var bifilter=(obj,pred)=>{var t={};var f={};internalFilter(obj,pred,objAcc(t),objAcc(f));return{t,f};};var filter$4=(obj,pred)=>{var t={};internalFilter(obj,pred,objAcc(t),noop);return t;};var mapToArray=(obj,f)=>{var r=[];each$d(obj,(value,name)=>{r.push(f(value,name));});return r;};var values=obj=>{return mapToArray(obj,identity);};var get$a=(obj,key)=>{return has$2(obj,key)?Optional.from(obj[key]):Optional.none();};var has$2=(obj,key)=>hasOwnProperty$2.call(obj,key);var hasNonNullableKey=(obj,key)=>has$2(obj,key)&&obj[key]!==undefined&&obj[key]!==null;var equal$1=function equal$1(a1,a2){var eq=arguments.length>2&&arguments[2]!==undefined?arguments[2]:eqAny;return eqRecord(eq).eq(a1,a2);};var stringArray=a=>{var all={};each$e(a,key=>{all[key]={};});return keys(all);};var isArrayLike=o=>o.length!==undefined;var isArray=Array.isArray;var toArray$1=obj=>{if(!isArray(obj)){var array=[];for(var i=0,l=obj.length;i<l;i++){array[i]=obj[i];}return array;}else{return obj;}};var each$c=(o,cb,s)=>{if(!o){return false;}s=s||o;if(isArrayLike(o)){for(var n=0,l=o.length;n<l;n++){if(cb.call(s,o[n],n,o)===false){return false;}}}else{for(var _n in o){if(has$2(o,_n)){if(cb.call(s,o[_n],_n,o)===false){return false;}}}}return true;};var map$1=(array,callback)=>{var out=[];each$c(array,(item,index)=>{out.push(callback(item,index,array));});return out;};var filter$3=(a,f)=>{var o=[];each$c(a,(v,index)=>{if(!f||f(v,index,a)){o.push(v);}});return o;};var indexOf=(a,v)=>{if(a){for(var i=0,l=a.length;i<l;i++){if(a[i]===v){return i;}}}return-1;};var reduce=(collection,iteratee,accumulator,thisArg)=>{var acc=isUndefined(accumulator)?collection[0]:accumulator;for(var i=0;i<collection.length;i++){acc=iteratee.call(thisArg,acc,collection[i],i);}return acc;};var findIndex$1=(array,predicate,thisArg)=>{for(var i=0,l=array.length;i<l;i++){if(predicate.call(thisArg,array[i],i,array)){return i;}}return-1;};var last$2=collection=>collection[collection.length-1];var cached=f=>{var called=false;var r;return function(){if(!called){called=true;for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}r=f.apply(null,args);}return r;};};var DeviceType=(os,browser,userAgent,mediaMatch)=>{var isiPad=os.isiOS()&&/ipad/i.test(userAgent)===true;var isiPhone=os.isiOS()&&!isiPad;var isMobile=os.isiOS()||os.isAndroid();var isTouch=isMobile||mediaMatch('(pointer:coarse)');var isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch('(min-device-width:768px)');var isPhone=isiPhone||isMobile&&!isTablet;var iOSwebview=browser.isSafari()&&os.isiOS()&&/safari/i.test(userAgent)===false;var isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)};};var firstMatch=(regexes,s)=>{for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s)){return x;}}return undefined;};var find$1=(regexes,agent)=>{var r=firstMatch(regexes,agent);if(!r){return{major:0,minor:0};}var group=i=>{return Number(agent.replace(r,'$'+i));};return nu$3(group(1),group(2));};var detect$5=(versionRegexes,agent)=>{var cleanedAgent=String(agent).toLowerCase();if(versionRegexes.length===0){return unknown$2();}return find$1(versionRegexes,cleanedAgent);};var unknown$2=()=>{return nu$3(0,0);};var nu$3=(major,minor)=>{return{major,minor};};var Version={nu:nu$3,detect:detect$5,unknown:unknown$2};var detectBrowser$1=(browsers,userAgentData)=>{return findMap(userAgentData.brands,uaBrand=>{var lcBrand=uaBrand.brand.toLowerCase();return find$2(browsers,browser=>{var _a;return lcBrand===((_a=browser.brand)===null||_a===void 0?void 0:_a.toLowerCase());}).map(info=>({current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}));});};var detect$4=(candidates,userAgent)=>{var agent=String(userAgent).toLowerCase();return find$2(candidates,candidate=>{return candidate.search(agent);});};var detectBrowser=(browsers,userAgent)=>{return detect$4(browsers,userAgent).map(browser=>{var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version};});};var detectOs=(oses,userAgent)=>{return detect$4(oses,userAgent).map(os=>{var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version};});};var removeFromStart=(str,numChars)=>{return str.substring(numChars);};var checkRange=(str,substr,start)=>substr===''||str.length>=substr.length&&str.substr(start,start+substr.length)===substr;var removeLeading=(str,prefix)=>{return startsWith(str,prefix)?removeFromStart(str,prefix.length):str;};var contains$1=function contains$1(str,substr){var start=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var end=arguments.length>3?arguments[3]:undefined;var idx=str.indexOf(substr,start);if(idx!==-1){return isUndefined(end)?true:idx+substr.length<=end;}else{return false;}};var startsWith=(str,prefix)=>{return checkRange(str,prefix,0);};var endsWith=(str,suffix)=>{return checkRange(str,suffix,str.length-suffix.length);};var blank=r=>s=>s.replace(r,'');var trim$3=blank(/^\\s+|\\s+$/g);var lTrim=blank(/^\\s+/g);var rTrim=blank(/\\s+$/g);var isNotEmpty=s=>s.length>0;var isEmpty$3=s=>!isNotEmpty(s);var repeat=(s,count)=>count<=0?'':new Array(count+1).join(s);var toInt=function toInt(value){var radix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;var num=parseInt(value,radix);return isNaN(num)?Optional.none():Optional.some(num);};var normalVersionRegex=/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;var checkContains=target=>{return uastring=>{return contains$1(uastring,target);};};var browsers=[{name:'Edge',versionRegexes:[/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],search:uastring=>{return contains$1(uastring,'edge/')&&contains$1(uastring,'chrome')&&contains$1(uastring,'safari')&&contains$1(uastring,'applewebkit');}},{name:'Chromium',brand:'Chromium',versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/,normalVersionRegex],search:uastring=>{return contains$1(uastring,'chrome')&&!contains$1(uastring,'chromeframe');}},{name:'IE',versionRegexes:[/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,/.*?rv:([0-9]+)\\.([0-9]+).*/],search:uastring=>{return contains$1(uastring,'msie')||contains$1(uastring,'trident');}},{name:'Opera',versionRegexes:[normalVersionRegex,/.*?opera\\/([0-9]+)\\.([0-9]+).*/],search:checkContains('opera')},{name:'Firefox',versionRegexes:[/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],search:checkContains('firefox')},{name:'Safari',versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:uastring=>{return(contains$1(uastring,'safari')||contains$1(uastring,'mobile/'))&&contains$1(uastring,'applewebkit');}}];var oses=[{name:'Windows',search:checkContains('win'),versionRegexes:[/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'iOS',search:uastring=>{return contains$1(uastring,'iphone')||contains$1(uastring,'ipad');},versionRegexes:[/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:'Android',search:checkContains('android'),versionRegexes:[/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]},{name:'macOS',search:checkContains('mac os x'),versionRegexes:[/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]},{name:'Linux',search:checkContains('linux'),versionRegexes:[]},{name:'Solaris',search:checkContains('sunos'),versionRegexes:[]},{name:'FreeBSD',search:checkContains('freebsd'),versionRegexes:[]},{name:'ChromeOS',search:checkContains('cros'),versionRegexes:[/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]}];var PlatformInfo={browsers:constant(browsers),oses:constant(oses)};var edge='Edge';var chromium='Chromium';var ie='IE';var opera='Opera';var firefox='Firefox';var safari='Safari';var unknown$1=()=>{return nu$2({current:undefined,version:Version.unknown()});};var nu$2=info=>{var current=info.current;var version=info.version;var isBrowser=name=>()=>current===name;return{current,version,isEdge:isBrowser(edge),isChromium:isBrowser(chromium),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)};};var Browser={unknown:unknown$1,nu:nu$2,edge:constant(edge),chromium:constant(chromium),ie:constant(ie),opera:constant(opera),firefox:constant(firefox),safari:constant(safari)};var windows='Windows';var ios='iOS';var android='Android';var linux='Linux';var macos='macOS';var solaris='Solaris';var freebsd='FreeBSD';var chromeos='ChromeOS';var unknown=()=>{return nu$1({current:undefined,version:Version.unknown()});};var nu$1=info=>{var current=info.current;var version=info.version;var isOS=name=>()=>current===name;return{current,version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isMacOS:isOS(macos),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)};};var OperatingSystem={unknown,nu:nu$1,windows:constant(windows),ios:constant(ios),android:constant(android),linux:constant(linux),macos:constant(macos),solaris:constant(solaris),freebsd:constant(freebsd),chromeos:constant(chromeos)};var detect$3=(userAgent,userAgentDataOpt,mediaMatch)=>{var browsers=PlatformInfo.browsers();var oses=PlatformInfo.oses();var browser=userAgentDataOpt.bind(userAgentData=>detectBrowser$1(browsers,userAgentData)).orThunk(()=>detectBrowser(browsers,userAgent)).fold(Browser.unknown,Browser.nu);var os=detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu);var deviceType=DeviceType(os,browser,userAgent,mediaMatch);return{browser,os,deviceType};};var PlatformDetection={detect:detect$3};var mediaMatch=query=>window.matchMedia(query).matches;var platform$4=cached(()=>PlatformDetection.detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch));var detect$2=()=>platform$4();var userAgent=navigator.userAgent;var platform$3=detect$2();var browser$3=platform$3.browser;var os$1=platform$3.os;var deviceType=platform$3.deviceType;var windowsPhone=userAgent.indexOf('Windows Phone')!==-1;var Env={transparentSrc:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',documentMode:browser$3.isIE()?document.documentMode||7:10,cacheSuffix:null,container:null,canHaveCSP:!browser$3.isIE(),windowsPhone,browser:{current:browser$3.current,version:browser$3.version,isChromium:browser$3.isChromium,isEdge:browser$3.isEdge,isFirefox:browser$3.isFirefox,isIE:browser$3.isIE,isOpera:browser$3.isOpera,isSafari:browser$3.isSafari},os:{current:os$1.current,version:os$1.version,isAndroid:os$1.isAndroid,isChromeOS:os$1.isChromeOS,isFreeBSD:os$1.isFreeBSD,isiOS:os$1.isiOS,isLinux:os$1.isLinux,isMacOS:os$1.isMacOS,isSolaris:os$1.isSolaris,isWindows:os$1.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}};var whiteSpaceRegExp$1=/^\\s*|\\s*$/g;var trim$2=str=>{return isNullable(str)?'':(''+str).replace(whiteSpaceRegExp$1,'');};var is$3=(obj,type)=>{if(!type){return obj!==undefined;}if(type==='array'&&isArray(obj)){return true;}return typeof obj===type;};var makeMap$4=function makeMap$4(items,delim){var map=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var resolvedItems=isString(items)?items.split(delim||','):items||[];var i=resolvedItems.length;while(i--){map[resolvedItems[i]]={};}return map;};var hasOwnProperty$1=has$2;var extend$3=function extend$3(obj){for(var i=0;i<(arguments.length<=1?0:arguments.length-1);i++){var ext=i+1<1||arguments.length<=i+1?undefined:arguments[i+1];for(var _name in ext){if(has$2(ext,_name)){var _value2=ext[_name];if(_value2!==undefined){obj[_name]=_value2;}}}}return obj;};var walk$4=function walk$4(o,f,n,s){s=s||this;if(o){if(n){o=o[n];}each$c(o,(o,i)=>{if(f.call(s,o,i,n)===false){return false;}else{walk$4(o,f,n,s);return true;}});}};var resolve$3=function resolve$3(n){var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window;var path=n.split('.');for(var i=0,l=path.length;i<l;i++){o=o[path[i]];if(!o){break;}}return o;};var explode$3=(s,d)=>{if(isArray$1(s)){return s;}else if(s===''){return[];}else{return map$1(s.split(d||','),trim$2);}};var _addCacheSuffix=url=>{var cacheSuffix=Env.cacheSuffix;if(cacheSuffix){url+=(url.indexOf('?')===-1?'?':'&')+cacheSuffix;}return url;};var Tools={trim:trim$2,isArray:isArray,is:is$3,toArray:toArray$1,makeMap:makeMap$4,each:each$c,map:map$1,grep:filter$3,inArray:indexOf,hasOwn:hasOwnProperty$1,extend:extend$3,walk:walk$4,resolve:resolve$3,explode:explode$3,_addCacheSuffix};var is$2=function is$2(lhs,rhs){var comparator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:tripleEquals;return lhs.exists(left=>comparator(left,rhs));};var equals=function equals(lhs,rhs){var comparator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:tripleEquals;return lift2(lhs,rhs,comparator).getOr(lhs.isNone()&&rhs.isNone());};var cat=arr=>{var r=[];var push=x=>{r.push(x);};for(var i=0;i<arr.length;i++){arr[i].each(push);}return r;};var lift2=(oa,ob,f)=>oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none();var lift3=(oa,ob,oc,f)=>oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none();var someIf=(b,a)=>b?Optional.some(a):Optional.none();var Global=typeof window!=='undefined'?window:Function('return this;')();var path=(parts,scope)=>{var o=scope!==undefined&&scope!==null?scope:Global;for(var i=0;i<parts.length&&o!==undefined&&o!==null;++i){o=o[parts[i]];}return o;};var resolve$2=(p,scope)=>{var parts=p.split('.');return path(parts,scope);};var unsafe=(name,scope)=>{return resolve$2(name,scope);};var getOrDie=(name,scope)=>{var actual=unsafe(name,scope);if(actual===undefined||actual===null){throw new Error(name+' not available on this browser');}return actual;};var getPrototypeOf$1=Object.getPrototypeOf;var sandHTMLElement=scope=>{return getOrDie('HTMLElement',scope);};var isPrototypeOf=x=>{var scope=resolve$2('ownerDocument.defaultView',x);return isObject(x)&&(sandHTMLElement(scope).prototype.isPrototypeOf(x)||/^HTML\\w*Element$/.test(getPrototypeOf$1(x).constructor.name));};var COMMENT=8;var DOCUMENT=9;var DOCUMENT_FRAGMENT=11;var ELEMENT=1;var TEXT=3;var name=element=>{var r=element.dom.nodeName;return r.toLowerCase();};var type$1=element=>element.dom.nodeType;var isType=t=>element=>type$1(element)===t;var isComment$1=element=>type$1(element)===COMMENT||name(element)==='#comment';var isHTMLElement=element=>isElement$7(element)&&isPrototypeOf(element.dom);var isElement$7=isType(ELEMENT);var isText$b=isType(TEXT);var isDocument$2=isType(DOCUMENT);var isDocumentFragment$1=isType(DOCUMENT_FRAGMENT);var isTag=tag=>e=>isElement$7(e)&&name(e)===tag;var rawSet=(dom,key,value)=>{if(isString(value)||isBoolean(value)||isNumber(value)){dom.setAttribute(key,value+'');}else{console.error('Invalid call to Attribute.set. Key ',key,':: Value ',value,':: Element ',dom);throw new Error('Attribute value was not simple');}};var set$3=(element,key,value)=>{rawSet(element.dom,key,value);};var setAll$1=(element,attrs)=>{var dom=element.dom;each$d(attrs,(v,k)=>{rawSet(dom,k,v);});};var get$9=(element,key)=>{var v=element.dom.getAttribute(key);return v===null?undefined:v;};var getOpt=(element,key)=>Optional.from(get$9(element,key));var has$1=(element,key)=>{var dom=element.dom;return dom&&dom.hasAttribute?dom.hasAttribute(key):false;};var remove$a=(element,key)=>{element.dom.removeAttribute(key);};var hasNone=element=>{var attrs=element.dom.attributes;return attrs===undefined||attrs===null||attrs.length===0;};var clone$4=element=>foldl(element.dom.attributes,(acc,attr)=>{acc[attr.name]=attr.value;return acc;},{});var read$4=(element,attr)=>{var value=get$9(element,attr);return value===undefined||value===''?[]:value.split(' ');};var add$4=(element,attr,id)=>{var old=read$4(element,attr);var nu=old.concat([id]);set$3(element,attr,nu.join(' '));return true;};var remove$9=(element,attr,id)=>{var nu=filter$5(read$4(element,attr),v=>v!==id);if(nu.length>0){set$3(element,attr,nu.join(' '));}else{remove$a(element,attr);}return false;};var supports=element=>element.dom.classList!==undefined;var get$8=element=>read$4(element,'class');var add$3=(element,clazz)=>add$4(element,'class',clazz);var remove$8=(element,clazz)=>remove$9(element,'class',clazz);var toggle$2=(element,clazz)=>{if(contains$2(get$8(element),clazz)){return remove$8(element,clazz);}else{return add$3(element,clazz);}};var add$2=(element,clazz)=>{if(supports(element)){element.dom.classList.add(clazz);}else{add$3(element,clazz);}};var cleanClass=element=>{var classList=supports(element)?element.dom.classList:get$8(element);if(classList.length===0){remove$a(element,'class');}};var remove$7=(element,clazz)=>{if(supports(element)){var classList=element.dom.classList;classList.remove(clazz);}else{remove$8(element,clazz);}cleanClass(element);};var toggle$1=(element,clazz)=>{var result=supports(element)?element.dom.classList.toggle(clazz):toggle$2(element,clazz);cleanClass(element);return result;};var has=(element,clazz)=>supports(element)&&element.dom.classList.contains(clazz);var fromHtml$1=(html,scope)=>{var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;if(!div.hasChildNodes()||div.childNodes.length>1){var message='HTML does not have a single root node';console.error(message,html);throw new Error(message);}return fromDom$2(div.childNodes[0]);};var fromTag=(tag,scope)=>{var doc=scope||document;var node=doc.createElement(tag);return fromDom$2(node);};var fromText=(text,scope)=>{var doc=scope||document;var node=doc.createTextNode(text);return fromDom$2(node);};var fromDom$2=node=>{if(node===null||node===undefined){throw new Error('Node cannot be null or undefined');}return{dom:node};};var fromPoint$2=(docElm,x,y)=>Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2);var SugarElement={fromHtml:fromHtml$1,fromTag,fromText,fromDom:fromDom$2,fromPoint:fromPoint$2};var toArray=(target,f)=>{var r=[];var recurse=e=>{r.push(e);return f(e);};var cur=f(target);do{cur=cur.bind(recurse);}while(cur.isSome());return r;};var is$1=(element,selector)=>{var dom=element.dom;if(dom.nodeType!==ELEMENT){return false;}else{var elem=dom;if(elem.matches!==undefined){return elem.matches(selector);}else if(elem.msMatchesSelector!==undefined){return elem.msMatchesSelector(selector);}else if(elem.webkitMatchesSelector!==undefined){return elem.webkitMatchesSelector(selector);}else if(elem.mozMatchesSelector!==undefined){return elem.mozMatchesSelector(selector);}else{throw new Error('Browser lacks native selectors');}}};var bypassSelector=dom=>dom.nodeType!==ELEMENT&&dom.nodeType!==DOCUMENT&&dom.nodeType!==DOCUMENT_FRAGMENT||dom.childElementCount===0;var all=(selector,scope)=>{var base=scope===undefined?document:scope.dom;return bypassSelector(base)?[]:map$3(base.querySelectorAll(selector),SugarElement.fromDom);};var one=(selector,scope)=>{var base=scope===undefined?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);};var eq=(e1,e2)=>e1.dom===e2.dom;var contains=(e1,e2)=>{var d1=e1.dom;var d2=e2.dom;return d1===d2?false:d1.contains(d2);};var owner$1=element=>SugarElement.fromDom(element.dom.ownerDocument);var documentOrOwner=dos=>isDocument$2(dos)?dos:owner$1(dos);var documentElement=element=>SugarElement.fromDom(documentOrOwner(element).dom.documentElement);var defaultView=element=>SugarElement.fromDom(documentOrOwner(element).dom.defaultView);var parent=element=>Optional.from(element.dom.parentNode).map(SugarElement.fromDom);var parentElement=element=>Optional.from(element.dom.parentElement).map(SugarElement.fromDom);var parents$1=(element,isRoot)=>{var stop=isFunction(isRoot)?isRoot:never;var dom=element.dom;var ret=[];while(dom.parentNode!==null&&dom.parentNode!==undefined){var rawParent=dom.parentNode;var p=SugarElement.fromDom(rawParent);ret.push(p);if(stop(p)===true){break;}else{dom=rawParent;}}return ret;};var siblings=element=>{var filterSelf=elements=>filter$5(elements,x=>!eq(element,x));return parent(element).map(children$1).map(filterSelf).getOr([]);};var prevSibling=element=>Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);var nextSibling=element=>Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);var prevSiblings=element=>reverse(toArray(element,prevSibling));var nextSiblings=element=>toArray(element,nextSibling);var children$1=element=>map$3(element.dom.childNodes,SugarElement.fromDom);var child$1=(element,index)=>{var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom);};var firstChild=element=>child$1(element,0);var lastChild=element=>child$1(element,element.dom.childNodes.length-1);var childNodesCount=element=>element.dom.childNodes.length;var hasChildNodes=element=>element.dom.hasChildNodes();var getHead=doc=>{var b=doc.dom.head;if(b===null||b===undefined){throw new Error('Head is not available yet');}return SugarElement.fromDom(b);};var isShadowRoot=dos=>isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host);var supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode);var isSupported$1=constant(supported);var getRootNode=supported?e=>SugarElement.fromDom(e.dom.getRootNode()):documentOrOwner;var getStyleContainer=dos=>isShadowRoot(dos)?dos:getHead(documentOrOwner(dos));var getContentContainer=dos=>isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body);var getShadowRoot=e=>{var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none();};var getShadowHost=e=>SugarElement.fromDom(e.dom.host);var getOriginalEventTarget=event=>{if(isSupported$1()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$7(el)&&isOpenShadowHost(el)){if(event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath){return head(composedPath);}}}}return Optional.from(event.target);};var isOpenShadowHost=element=>isNonNullable(element.dom.shadowRoot);var inBody=element=>{var dom=isText$b(element)?element.dom.parentNode:element.dom;if(dom===undefined||dom===null||dom.ownerDocument===null){return false;}var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold(()=>doc.body.contains(dom),compose1(inBody,getShadowHost));};var ClosestOrAncestor=(is,ancestor,scope,a,isRoot)=>{if(is(scope,a)){return Optional.some(scope);}else if(isFunction(isRoot)&&isRoot(scope)){return Optional.none();}else{return ancestor(scope,a,isRoot);}};var ancestor$4=(scope,predicate,isRoot)=>{var element=scope.dom;var stop=isFunction(isRoot)?isRoot:never;while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el)){return Optional.some(el);}else if(stop(el)){break;}}return Optional.none();};var closest$4=(scope,predicate,isRoot)=>{var is=(s,test)=>test(s);return ClosestOrAncestor(is,ancestor$4,scope,predicate,isRoot);};var sibling$1=(scope,predicate)=>{var element=scope.dom;if(!element.parentNode){return Optional.none();}return child(SugarElement.fromDom(element.parentNode),x=>!eq(scope,x)&&predicate(x));};var child=(scope,predicate)=>{var pred=node=>predicate(SugarElement.fromDom(node));var result=find$2(scope.dom.childNodes,pred);return result.map(SugarElement.fromDom);};var descendant$1=(scope,predicate)=>{var descend=node=>{for(var i=0;i<node.childNodes.length;i++){var _child=SugarElement.fromDom(node.childNodes[i]);if(predicate(_child)){return Optional.some(_child);}var res=descend(node.childNodes[i]);if(res.isSome()){return res;}}return Optional.none();};return descend(scope.dom);};var ancestor$3=(scope,selector,isRoot)=>ancestor$4(scope,e=>is$1(e,selector),isRoot);var descendant=(scope,selector)=>one(selector,scope);var closest$3=(scope,selector,isRoot)=>{var is=(element,selector)=>is$1(element,selector);return ClosestOrAncestor(is,ancestor$3,scope,selector,isRoot);};var closest$2=target=>closest$3(target,'[contenteditable]');var isEditable$3=function isEditable$3(element){var assumeEditable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(inBody(element)){return element.dom.isContentEditable;}else{return closest$2(element).fold(constant(assumeEditable),editable=>getRaw$1(editable)==='true');}};var getRaw$1=element=>element.dom.contentEditable;var isSupported=dom=>dom.style!==undefined&&isFunction(dom.style.getPropertyValue);var internalSet=(dom,property,value)=>{if(!isString(value)){console.error('Invalid call to CSS.set. Property ',property,':: Value ',value,':: Element ',dom);throw new Error('CSS value must be a string: '+value);}if(isSupported(dom)){dom.style.setProperty(property,value);}};var internalRemove=(dom,property)=>{if(isSupported(dom)){dom.style.removeProperty(property);}};var set$2=(element,property,value)=>{var dom=element.dom;internalSet(dom,property,value);};var setAll=(element,css)=>{var dom=element.dom;each$d(css,(v,k)=>{internalSet(dom,k,v);});};var get$7=(element,property)=>{var dom=element.dom;var styles=window.getComputedStyle(dom);var r=styles.getPropertyValue(property);return r===''&&!inBody(element)?getUnsafeProperty(dom,property):r;};var getUnsafeProperty=(dom,property)=>isSupported(dom)?dom.style.getPropertyValue(property):'';var getRaw=(element,property)=>{var dom=element.dom;var raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter(r=>r.length>0);};var getAllRaw=element=>{var css={};var dom=element.dom;if(isSupported(dom)){for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName];}}return css;};var remove$6=(element,property)=>{var dom=element.dom;internalRemove(dom,property);if(is$2(getOpt(element,'style').map(trim$3),'')){remove$a(element,'style');}};var reflow=e=>e.dom.offsetWidth;var before$3=(marker,element)=>{var parent$1=parent(marker);parent$1.each(v=>{v.dom.insertBefore(element.dom,marker.dom);});};var after$4=(marker,element)=>{var sibling=nextSibling(marker);sibling.fold(()=>{var parent$1=parent(marker);parent$1.each(v=>{append$1(v,element);});},v=>{before$3(v,element);});};var prepend=(parent,element)=>{var firstChild$1=firstChild(parent);firstChild$1.fold(()=>{append$1(parent,element);},v=>{parent.dom.insertBefore(element.dom,v.dom);});};var append$1=(parent,element)=>{parent.dom.appendChild(element.dom);};var wrap$2=(element,wrapper)=>{before$3(element,wrapper);append$1(wrapper,element);};var after$3=(marker,elements)=>{each$e(elements,(x,i)=>{var e=i===0?marker:elements[i-1];after$4(e,x);});};var append=(parent,elements)=>{each$e(elements,x=>{append$1(parent,x);});};var empty=element=>{element.dom.textContent='';each$e(children$1(element),rogue=>{remove$5(rogue);});};var remove$5=element=>{var dom=element.dom;if(dom.parentNode!==null){dom.parentNode.removeChild(dom);}};var unwrap=wrapper=>{var children=children$1(wrapper);if(children.length>0){after$3(wrapper,children);}remove$5(wrapper);};var fromHtml=(html,scope)=>{var doc=scope||document;var div=doc.createElement('div');div.innerHTML=html;return children$1(SugarElement.fromDom(div));};var fromDom$1=nodes=>map$3(nodes,SugarElement.fromDom);var get$6=element=>element.dom.innerHTML;var set$1=(element,content)=>{var owner=owner$1(element);var docDom=owner.dom;var fragment=SugarElement.fromDom(docDom.createDocumentFragment());var contentElements=fromHtml(content,docDom);append(fragment,contentElements);empty(element);append$1(element,fragment);};var getOuter=element=>{var container=SugarElement.fromTag('div');var clone=SugarElement.fromDom(element.dom.cloneNode(true));append$1(container,clone);return get$6(container);};var mkEvent=(target,x,y,stop,prevent,kill,raw)=>({target,x,y,stop,prevent,kill,raw});var fromRawEvent=rawEvent=>{var target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));var stop=()=>rawEvent.stopPropagation();var prevent=()=>rawEvent.preventDefault();var kill=compose(prevent,stop);return mkEvent(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent);};var handle$1=(filter,handler)=>rawEvent=>{if(filter(rawEvent)){handler(fromRawEvent(rawEvent));}};var binder=(element,event,filter,handler,useCapture)=>{var wrapped=handle$1(filter,handler);element.dom.addEventListener(event,wrapped,useCapture);return{unbind:curry(unbind,element,event,wrapped,useCapture)};};var bind$2=(element,event,filter,handler)=>binder(element,event,filter,handler,false);var unbind=(element,event,handler,useCapture)=>{element.dom.removeEventListener(event,handler,useCapture);};var r=(left,top)=>{var translate=(x,y)=>r(left+x,top+y);return{left,top,translate};};var SugarPosition=r;var boxPosition=dom=>{var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top);};var firstDefinedOrZero=(a,b)=>{if(a!==undefined){return a;}else{return b!==undefined?b:0;}};var absolute=element=>{var doc=element.dom.ownerDocument;var body=doc.body;var win=doc.defaultView;var html=doc.documentElement;if(body===element.dom){return SugarPosition(body.offsetLeft,body.offsetTop);}var scrollTop=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageYOffset,html.scrollTop);var scrollLeft=firstDefinedOrZero(win===null||win===void 0?void 0:win.pageXOffset,html.scrollLeft);var clientTop=firstDefinedOrZero(html.clientTop,body.clientTop);var clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop);};var viewport=element=>{var dom=element.dom;var doc=dom.ownerDocument;var body=doc.body;if(body===dom){return SugarPosition(body.offsetLeft,body.offsetTop);}if(!inBody(element)){return SugarPosition(0,0);}return boxPosition(dom);};var get$5=_DOC=>{var doc=_DOC!==undefined?_DOC.dom:document;var x=doc.body.scrollLeft||doc.documentElement.scrollLeft;var y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y);};var to=(x,y,_DOC)=>{var doc=_DOC!==undefined?_DOC.dom:document;var win=doc.defaultView;if(win){win.scrollTo(x,y);}};var intoView=(element,alignToTop)=>{var isSafari=detect$2().browser.isSafari();if(isSafari&&isFunction(element.dom.scrollIntoViewIfNeeded)){element.dom.scrollIntoViewIfNeeded(false);}else{element.dom.scrollIntoView(alignToTop);}};var get$4=_win=>{var win=_win===undefined?window:_win;if(detect$2().browser.isFirefox()){return Optional.none();}else{return Optional.from(win.visualViewport);}};var bounds=(x,y,width,height)=>({x,y,width,height,right:x+width,bottom:y+height});var getBounds=_win=>{var win=_win===undefined?window:_win;var doc=win.document;var scroll=get$5(SugarElement.fromDom(doc));return get$4(win).fold(()=>{var html=win.document.documentElement;var width=html.clientWidth;var height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height);},visualViewport=>bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height));};var children=(scope,predicate)=>filter$5(children$1(scope),predicate);var descendants$1=(scope,predicate)=>{var result=[];each$e(children$1(scope),x=>{if(predicate(x)){result=result.concat([x]);}result=result.concat(descendants$1(x,predicate));});return result;};var descendants=(scope,selector)=>all(selector,scope);var ancestor$2=(scope,selector,isRoot)=>ancestor$3(scope,selector,isRoot).isSome();class DomTreeWalker{constructor(startNode,rootNode){this.node=startNode;this.rootNode=rootNode;this.current=this.current.bind(this);this.next=this.next.bind(this);this.prev=this.prev.bind(this);this.prev2=this.prev2.bind(this);}current(){return this.node;}next(shallow){this.node=this.findSibling(this.node,'firstChild','nextSibling',shallow);return this.node;}prev(shallow){this.node=this.findSibling(this.node,'lastChild','previousSibling',shallow);return this.node;}prev2(shallow){this.node=this.findPreviousNode(this.node,shallow);return this.node;}findSibling(node,startName,siblingName,shallow){if(node){if(!shallow&&node[startName]){return node[startName];}if(node!==this.rootNode){var _sibling=node[siblingName];if(_sibling){return _sibling;}for(var _parent=node.parentNode;_parent&&_parent!==this.rootNode;_parent=_parent.parentNode){_sibling=_parent[siblingName];if(_sibling){return _sibling;}}}}return undefined;}findPreviousNode(node,shallow){if(node){var _sibling2=node.previousSibling;if(this.rootNode&&_sibling2===this.rootNode){return;}if(_sibling2){if(!shallow){for(var _child2=_sibling2.lastChild;_child2;_child2=_child2.lastChild){if(!_child2.lastChild){return _child2;}}}return _sibling2;}var _parent2=node.parentNode;if(_parent2&&_parent2!==this.rootNode){return _parent2;}}return undefined;}}var isNodeType=type=>{return node=>{return!!node&&node.nodeType===type;};};var isRestrictedNode=node=>!!node&&!Object.getPrototypeOf(node);var isElement$6=isNodeType(1);var matchNodeName=name=>{var lowerCasedName=name.toLowerCase();return node=>isNonNullable(node)&&node.nodeName.toLowerCase()===lowerCasedName;};var matchNodeNames=names=>{var lowerCasedNames=names.map(s=>s.toLowerCase());return node=>{if(node&&node.nodeName){var nodeName=node.nodeName.toLowerCase();return contains$2(lowerCasedNames,nodeName);}return false;};};var matchStyleValues=(name,values)=>{var items=values.toLowerCase().split(' ');return node=>{if(isElement$6(node)){var win=node.ownerDocument.defaultView;if(win){for(var i=0;i<items.length;i++){var computed=win.getComputedStyle(node,null);var cssValue=computed?computed.getPropertyValue(name):null;if(cssValue===items[i]){return true;}}}}return false;};};var hasAttribute=attrName=>{return node=>{return isElement$6(node)&&node.hasAttribute(attrName);};};var hasAttributeValue=(attrName,attrValue)=>{return node=>{return isElement$6(node)&&node.getAttribute(attrName)===attrValue;};};var isBogus$2=node=>isElement$6(node)&&node.hasAttribute('data-mce-bogus');var isBogusAll$1=node=>isElement$6(node)&&node.getAttribute('data-mce-bogus')==='all';var isTable$2=node=>isElement$6(node)&&node.tagName==='TABLE';var hasContentEditableState=value=>{return node=>{if(isElement$6(node)){if(node.contentEditable===value){return true;}if(node.getAttribute('data-mce-contenteditable')===value){return true;}}return false;};};var isTextareaOrInput=matchNodeNames(['textarea','input']);var isText$a=isNodeType(3);var isCData=isNodeType(4);var isPi=isNodeType(7);var isComment=isNodeType(8);var isDocument$1=isNodeType(9);var isDocumentFragment=isNodeType(11);var isBr$6=matchNodeName('br');var isImg=matchNodeName('img');var isContentEditableTrue$3=hasContentEditableState('true');var isContentEditableFalse$b=hasContentEditableState('false');var isTableCell$3=matchNodeNames(['td','th']);var isTableCellOrCaption=matchNodeNames(['td','th','caption']);var isMedia$2=matchNodeNames(['video','audio','object','embed']);var isListItem$2=matchNodeName('li');var isDetails=matchNodeName('details');var isSummary=matchNodeName('summary');var zeroWidth='\\uFEFF';var nbsp='\\xA0';var isZwsp$2=char=>char===zeroWidth;var removeZwsp=s=>s.replace(/\\uFEFF/g,'');var NodeValue=(is,name)=>{var get=element=>{if(!is(element)){throw new Error('Can only get '+name+' value of a '+name+' node');}return getOption(element).getOr('');};var getOption=element=>is(element)?Optional.from(element.dom.nodeValue):Optional.none();var set=(element,value)=>{if(!is(element)){throw new Error('Can only set raw '+name+' value of a '+name+' node');}element.dom.nodeValue=value;};return{get,getOption,set};};var api$1=NodeValue(isText$b,'text');var get$3=element=>api$1.get(element);var getOption=element=>api$1.getOption(element);var set=(element,value)=>api$1.set(element,value);var blocks=['article','aside','details','div','dt','figcaption','footer','form','fieldset','header','hgroup','html','main','nav','section','summary','body','p','dl','multicol','dd','figure','address','center','blockquote','h1','h2','h3','h4','h5','h6','listing','xmp','pre','plaintext','menu','dir','ul','ol','li','hr','table','tbody','thead','tfoot','th','tr','td','caption'];var tableCells=['td','th'];var tableSections=['thead','tbody','tfoot'];var textBlocks=['h1','h2','h3','h4','h5','h6','p','div','address','pre','form','blockquote','center','dir','fieldset','header','footer','article','section','hgroup','aside','nav','figure'];var headings=['h1','h2','h3','h4','h5','h6'];var listItems$1=['li','dd','dt'];var lists=['ul','ol','dl'];var wsElements=['pre','script','textarea','style'];var wrapBlockElements=['pre'].concat(headings);var lazyLookup=items=>{var lookup;return node=>{lookup=lookup?lookup:mapToObject(items,always);return has$2(lookup,name(node));};};var isBlock$2=lazyLookup(blocks);var isTable$1=node=>name(node)==='table';var isInline$1=node=>isElement$7(node)&&!isBlock$2(node);var isBr$5=node=>isElement$7(node)&&name(node)==='br';var isTextBlock$2=lazyLookup(textBlocks);var isList=lazyLookup(lists);var isListItem$1=lazyLookup(listItems$1);var isTableSection=lazyLookup(tableSections);var isTableCell$2=lazyLookup(tableCells);var isWsPreserveElement=lazyLookup(wsElements);var isWrapBlockElement=lazyLookup(wrapBlockElements);var isWrapElement=node=>isWrapBlockElement(node)||isInline$1(node);var getLastChildren$1=elm=>{var children=[];var rawNode=elm.dom;while(rawNode){children.push(SugarElement.fromDom(rawNode));rawNode=rawNode.lastChild;}return children;};var removeTrailingBr=elm=>{var allBrs=descendants(elm,'br');var brs=filter$5(getLastChildren$1(elm).slice(-1),isBr$5);if(allBrs.length===brs.length){each$e(brs,remove$5);}};var createPaddingBr=()=>{var br=SugarElement.fromTag('br');set$3(br,'data-mce-bogus','1');return br;};var fillWithPaddingBr=elm=>{empty(elm);append$1(elm,createPaddingBr());};var trimBlockTrailingBr=elm=>{lastChild(elm).each(lastChild=>{prevSibling(lastChild).each(lastChildPrevSibling=>{if(isBlock$2(elm)&&isBr$5(lastChild)&&isBlock$2(lastChildPrevSibling)){remove$5(lastChild);}});});};var ZWSP$1=zeroWidth;var isZwsp$1=isZwsp$2;var trim$1=removeZwsp;var isElement$5=isElement$6;var isText$9=isText$a;var isCaretContainerBlock$1=node=>{if(isText$9(node)){node=node.parentNode;}return isElement$5(node)&&node.hasAttribute('data-mce-caret');};var isCaretContainerInline=node=>isText$9(node)&&isZwsp$1(node.data);var isCaretContainer$2=node=>isCaretContainerBlock$1(node)||isCaretContainerInline(node);var hasContent=node=>node.firstChild!==node.lastChild||!isBr$6(node.firstChild);var insertInline$1=(node,before)=>{var _a;var doc=(_a=node.ownerDocument)!==null&&_a!==void 0?_a:document;var textNode=doc.createTextNode(ZWSP$1);var parentNode=node.parentNode;if(!before){var _sibling3=node.nextSibling;if(isText$9(_sibling3)){if(isCaretContainer$2(_sibling3)){return _sibling3;}if(startsWithCaretContainer$1(_sibling3)){_sibling3.splitText(1);return _sibling3;}}if(node.nextSibling){parentNode===null||parentNode===void 0?void 0:parentNode.insertBefore(textNode,node.nextSibling);}else{parentNode===null||parentNode===void 0?void 0:parentNode.appendChild(textNode);}}else{var _sibling4=node.previousSibling;if(isText$9(_sibling4)){if(isCaretContainer$2(_sibling4)){return _sibling4;}if(endsWithCaretContainer$1(_sibling4)){return _sibling4.splitText(_sibling4.data.length-1);}}parentNode===null||parentNode===void 0?void 0:parentNode.insertBefore(textNode,node);}return textNode;};var isBeforeInline=pos=>{var container=pos.container();if(!isText$a(container)){return false;}return container.data.charAt(pos.offset())===ZWSP$1||pos.isAtStart()&&isCaretContainerInline(container.previousSibling);};var isAfterInline=pos=>{var container=pos.container();if(!isText$a(container)){return false;}return container.data.charAt(pos.offset()-1)===ZWSP$1||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling);};var insertBlock=(blockName,node,before)=>{var _a;var doc=(_a=node.ownerDocument)!==null&&_a!==void 0?_a:document;var blockNode=doc.createElement(blockName);blockNode.setAttribute('data-mce-caret',before?'before':'after');blockNode.setAttribute('data-mce-bogus','all');blockNode.appendChild(createPaddingBr().dom);var parentNode=node.parentNode;if(!before){if(node.nextSibling){parentNode===null||parentNode===void 0?void 0:parentNode.insertBefore(blockNode,node.nextSibling);}else{parentNode===null||parentNode===void 0?void 0:parentNode.appendChild(blockNode);}}else{parentNode===null||parentNode===void 0?void 0:parentNode.insertBefore(blockNode,node);}return blockNode;};var startsWithCaretContainer$1=node=>isText$9(node)&&node.data[0]===ZWSP$1;var endsWithCaretContainer$1=node=>isText$9(node)&&node.data[node.data.length-1]===ZWSP$1;var trimBogusBr=elm=>{var _a;var brs=elm.getElementsByTagName('br');var lastBr=brs[brs.length-1];if(isBogus$2(lastBr)){(_a=lastBr.parentNode)===null||_a===void 0?void 0:_a.removeChild(lastBr);}};var showCaretContainerBlock=caretContainer=>{if(caretContainer&&caretContainer.hasAttribute('data-mce-caret')){trimBogusBr(caretContainer);caretContainer.removeAttribute('data-mce-caret');caretContainer.removeAttribute('data-mce-bogus');caretContainer.removeAttribute('style');caretContainer.removeAttribute('data-mce-style');caretContainer.removeAttribute('_moz_abspos');return caretContainer;}return null;};var isRangeInCaretContainerBlock=range=>isCaretContainerBlock$1(range.startContainer);var isContentEditableTrue$2=isContentEditableTrue$3;var isContentEditableFalse$a=isContentEditableFalse$b;var isBr$4=isBr$6;var isText$8=isText$a;var isInvalidTextElement=matchNodeNames(['script','style','textarea']);var isAtomicInline=matchNodeNames(['img','input','textarea','hr','iframe','video','audio','object','embed']);var isTable=matchNodeNames(['table']);var isCaretContainer$1=isCaretContainer$2;var isCaretCandidate$3=node=>{if(isCaretContainer$1(node)){return false;}if(isText$8(node)){return!isInvalidTextElement(node.parentNode);}return isAtomicInline(node)||isBr$4(node)||isTable(node)||isNonUiContentEditableFalse(node);};var isUnselectable=node=>isElement$6(node)&&node.getAttribute('unselectable')==='true';var isNonUiContentEditableFalse=node=>!isUnselectable(node)&&isContentEditableFalse$a(node);var isInEditable=(node,root)=>{for(var tempNode=node.parentNode;tempNode&&tempNode!==root;tempNode=tempNode.parentNode){if(isNonUiContentEditableFalse(tempNode)){return false;}if(isContentEditableTrue$2(tempNode)){return true;}}return true;};var isAtomicContentEditableFalse=node=>{if(!isNonUiContentEditableFalse(node)){return false;}return!foldl(from(node.getElementsByTagName('*')),(result,elm)=>{return result||isContentEditableTrue$2(elm);},false);};var isAtomic$1=node=>isAtomicInline(node)||isAtomicContentEditableFalse(node);var isEditableCaretCandidate$1=(node,root)=>isCaretCandidate$3(node)&&isInEditable(node,root);var whiteSpaceRegExp=/^[ \\t\\r\\n]*$/;var isWhitespaceText=text=>whiteSpaceRegExp.test(text);var isZwsp=text=>{for(var c of text){if(!isZwsp$2(c)){return false;}}return true;};var isCollapsibleWhitespace$1=c=>' \\f\\t\\x0B'.indexOf(c)!==-1;var isNewLineChar=c=>c==='\\n'||c==='\\r';var isNewline=(text,idx)=>idx<text.length&&idx>=0?isNewLineChar(text[idx]):false;var normalize$4=function normalize$4(text){var tabSpaces=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var isStartOfContent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var isEndOfContent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var tabSpace=repeat(' ',tabSpaces);var normalizedText=text.replace(/\\t/g,tabSpace);var result=foldl(normalizedText,(acc,c)=>{if(isCollapsibleWhitespace$1(c)||c===nbsp){if(acc.pcIsSpace||acc.str===''&&isStartOfContent||acc.str.length===normalizedText.length-1&&isEndOfContent||isNewline(normalizedText,acc.str.length+1)){return{pcIsSpace:false,str:acc.str+nbsp};}else{return{pcIsSpace:true,str:acc.str+' '};}}else{return{pcIsSpace:isNewLineChar(c),str:acc.str+c};}},{pcIsSpace:false,str:''});return result.str;};var hasWhitespacePreserveParent=(node,rootNode)=>{var rootElement=SugarElement.fromDom(rootNode);var startNode=SugarElement.fromDom(node);return ancestor$2(startNode,'pre,code',curry(eq,rootElement));};var isWhitespace$1=(node,rootNode)=>{return isText$a(node)&&isWhitespaceText(node.data)&&!hasWhitespacePreserveParent(node,rootNode);};var isNamedAnchor=node=>{return isElement$6(node)&&node.nodeName==='A'&&!node.hasAttribute('href')&&(node.hasAttribute('name')||node.hasAttribute('id'));};var isContent$1=(node,rootNode)=>{return isCaretCandidate$3(node)&&!isWhitespace$1(node,rootNode)||isNamedAnchor(node)||isBookmark(node);};var isBookmark=hasAttribute('data-mce-bookmark');var isBogus$1=hasAttribute('data-mce-bogus');var isBogusAll=hasAttributeValue('data-mce-bogus','all');var isEmptyNode=(targetNode,skipBogus)=>{var brCount=0;if(isContent$1(targetNode,targetNode)){return false;}else{var node=targetNode.firstChild;if(!node){return true;}var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(true);continue;}if(isBogus$1(node)){node=walker.next();continue;}}if(isBr$6(node)){brCount++;node=walker.next();continue;}if(isContent$1(node,targetNode)){return false;}node=walker.next();}while(node);return brCount<=1;}};var isEmpty$2=function isEmpty$2(elm){var skipBogus=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return isEmptyNode(elm.dom,skipBogus);};var transparentBlockAttr='data-mce-block';var elementNames=map=>filter$5(keys(map),key=>!/[A-Z]/.test(key));var makeSelectorFromSchemaMap=map=>elementNames(map).join(',');var updateTransparent=(blocksSelector,transparent)=>{if(isNonNullable(transparent.querySelector(blocksSelector))){transparent.setAttribute(transparentBlockAttr,'true');if(transparent.getAttribute('data-mce-selected')==='inline-boundary'){transparent.removeAttribute('data-mce-selected');}return true;}else{transparent.removeAttribute(transparentBlockAttr);return false;}};var updateBlockStateOnChildren=(schema,scope)=>{var transparentSelector=makeSelectorFromSchemaMap(schema.getTransparentElements());var blocksSelector=makeSelectorFromSchemaMap(schema.getBlockElements());return filter$5(scope.querySelectorAll(transparentSelector),transparent=>updateTransparent(blocksSelector,transparent));};var trimEdge=(el,leftSide)=>{var _a;var childPropertyName=leftSide?'lastChild':'firstChild';for(var _child3=el[childPropertyName];_child3;_child3=_child3[childPropertyName]){if(isEmpty$2(SugarElement.fromDom(_child3))){(_a=_child3.parentNode)===null||_a===void 0?void 0:_a.removeChild(_child3);return;}}};var split$2=(parentElm,splitElm)=>{var range=document.createRange();var parentNode=parentElm.parentNode;if(parentNode){range.setStartBefore(parentElm);range.setEndBefore(splitElm);var beforeFragment=range.extractContents();trimEdge(beforeFragment,true);range.setStartAfter(splitElm);range.setEndAfter(parentElm);var afterFragment=range.extractContents();trimEdge(afterFragment,false);if(!isEmpty$2(SugarElement.fromDom(beforeFragment))){parentNode.insertBefore(beforeFragment,parentElm);}if(!isEmpty$2(SugarElement.fromDom(splitElm))){parentNode.insertBefore(splitElm,parentElm);}if(!isEmpty$2(SugarElement.fromDom(afterFragment))){parentNode.insertBefore(afterFragment,parentElm);}parentNode.removeChild(parentElm);}};var splitInvalidChildren=(schema,scope,transparentBlocks)=>{var blocksElements=schema.getBlockElements();var rootNode=SugarElement.fromDom(scope);var isBlock=el=>name(el)in blocksElements;var isRoot=el=>eq(el,rootNode);each$e(fromDom$1(transparentBlocks),transparentBlock=>{ancestor$4(transparentBlock,isBlock,isRoot).each(parentBlock=>{var invalidChildren=children(transparentBlock,el=>isBlock(el)&&!schema.isValidChild(name(parentBlock),name(el)));if(invalidChildren.length>0){var stateScope=parentElement(parentBlock);each$e(invalidChildren,child=>{ancestor$4(child,isBlock,isRoot).each(parentBlock=>{split$2(parentBlock.dom,child.dom);});});stateScope.each(scope=>updateBlockStateOnChildren(schema,scope.dom));}});});};var unwrapInvalidChildren=(schema,scope,transparentBlocks)=>{each$e([...transparentBlocks,...(isTransparentBlock(schema,scope)?[scope]:[])],block=>each$e(descendants(SugarElement.fromDom(block),block.nodeName.toLowerCase()),elm=>{if(isTransparentInline(schema,elm.dom)){unwrap(elm);}}));};var updateChildren=(schema,scope)=>{var transparentBlocks=updateBlockStateOnChildren(schema,scope);splitInvalidChildren(schema,scope,transparentBlocks);unwrapInvalidChildren(schema,scope,transparentBlocks);};var updateElement=(schema,target)=>{if(isTransparentElement(schema,target)){var blocksSelector=makeSelectorFromSchemaMap(schema.getBlockElements());updateTransparent(blocksSelector,target);}};var updateCaret=(schema,root,caretParent)=>{var isRoot=el=>eq(el,SugarElement.fromDom(root));var parents=parents$1(SugarElement.fromDom(caretParent),isRoot);get$b(parents,parents.length-2).filter(isElement$7).fold(()=>updateChildren(schema,root),scope=>updateChildren(schema,scope.dom));};var hasBlockAttr=el=>el.hasAttribute(transparentBlockAttr);var isTransparentElementName=(schema,name)=>has$2(schema.getTransparentElements(),name);var isTransparentElement=(schema,node)=>isElement$6(node)&&isTransparentElementName(schema,node.nodeName);var isTransparentBlock=(schema,node)=>isTransparentElement(schema,node)&&hasBlockAttr(node);var isTransparentInline=(schema,node)=>isTransparentElement(schema,node)&&!hasBlockAttr(node);var isTransparentAstBlock=(schema,node)=>node.type===1&&isTransparentElementName(schema,node.name)&&isString(node.attr(transparentBlockAttr));var browser$2=detect$2().browser;var firstElement=nodes=>find$2(nodes,isElement$7);var getTableCaptionDeltaY=elm=>{if(browser$2.isFirefox()&&name(elm)==='table'){return firstElement(children$1(elm)).filter(elm=>{return name(elm)==='caption';}).bind(caption=>{return firstElement(nextSiblings(caption)).map(body=>{var bodyTop=body.dom.offsetTop;var captionTop=caption.dom.offsetTop;var captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0;});}).getOr(0);}else{return 0;}};var hasChild=(elm,child)=>elm.children&&contains$2(elm.children,child);var getPos=(body,elm,rootElm)=>{var x=0,y=0;var doc=body.ownerDocument;rootElm=rootElm?rootElm:body;if(elm){if(rootElm===body&&elm.getBoundingClientRect&&get$7(SugarElement.fromDom(body),'position')==='static'){var pos=elm.getBoundingClientRect();x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft;y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop;return{x,y};}var offsetParent=elm;while(offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm)){var castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0;y+=castOffsetParent.offsetTop||0;offsetParent=castOffsetParent.offsetParent;}offsetParent=elm.parentNode;while(offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm)){x-=offsetParent.scrollLeft||0;y-=offsetParent.scrollTop||0;offsetParent=offsetParent.parentNode;}y+=getTableCaptionDeltaY(SugarElement.fromDom(elm));}return{x,y};};var StyleSheetLoader=function StyleSheetLoader(documentOrShadowRoot){var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var idCount=0;var loadedStates={};var edos=SugarElement.fromDom(documentOrShadowRoot);var doc=documentOrOwner(edos);var _setReferrerPolicy=referrerPolicy=>{settings.referrerPolicy=referrerPolicy;};var _setContentCssCors=contentCssCors=>{settings.contentCssCors=contentCssCors;};var addStyle=element=>{append$1(getStyleContainer(edos),element);};var removeStyle=id=>{var styleContainer=getStyleContainer(edos);descendant(styleContainer,'#'+id).each(remove$5);};var getOrCreateState=url=>get$a(loadedStates,url).getOrThunk(()=>({id:'mce-u'+idCount++,passed:[],failed:[],count:0}));var load=url=>new Promise((success,failure)=>{var link;var urlWithSuffix=Tools._addCacheSuffix(url);var state=getOrCreateState(urlWithSuffix);loadedStates[urlWithSuffix]=state;state.count++;var resolve=(callbacks,status)=>{each$e(callbacks,call);state.status=status;state.passed=[];state.failed=[];if(link){link.onload=null;link.onerror=null;link=null;}};var passed=()=>resolve(state.passed,2);var failed=()=>resolve(state.failed,3);if(success){state.passed.push(success);}if(failure){state.failed.push(failure);}if(state.status===1){return;}if(state.status===2){passed();return;}if(state.status===3){failed();return;}state.status=1;var linkElem=SugarElement.fromTag('link',doc.dom);setAll$1(linkElem,{rel:'stylesheet',type:'text/css',id:state.id});if(settings.contentCssCors){set$3(linkElem,'crossOrigin','anonymous');}if(settings.referrerPolicy){set$3(linkElem,'referrerpolicy',settings.referrerPolicy);}link=linkElem.dom;link.onload=passed;link.onerror=failed;addStyle(linkElem);set$3(linkElem,'href',urlWithSuffix);});var loadAll=urls=>{var loadedUrls=Promise.allSettled(map$3(urls,url=>load(url).then(constant(url))));return loadedUrls.then(results=>{var parts=partition$2(results,r=>r.status==='fulfilled');if(parts.fail.length>0){return Promise.reject(map$3(parts.fail,result=>result.reason));}else{return map$3(parts.pass,result=>result.value);}});};var unload=url=>{var urlWithSuffix=Tools._addCacheSuffix(url);get$a(loadedStates,urlWithSuffix).each(state=>{var count=--state.count;if(count===0){delete loadedStates[urlWithSuffix];removeStyle(state.id);}});};var unloadAll=urls=>{each$e(urls,url=>{unload(url);});};return{load,loadAll,unload,unloadAll,_setReferrerPolicy,_setContentCssCors};};var create$d=()=>{var map=new WeakMap();var forElement=(referenceElement,settings)=>{var root=getRootNode(referenceElement);var rootDom=root.dom;return Optional.from(map.get(rootDom)).getOrThunk(()=>{var sl=StyleSheetLoader(rootDom,settings);map.set(rootDom,sl);return sl;});};return{forElement};};var instance=create$d();var isSpan=node=>node.nodeName.toLowerCase()==='span';var isInlineContent=(node,root)=>isNonNullable(node)&&(isContent$1(node,root)||isInline$1(SugarElement.fromDom(node)));var surroundedByInlineContent=(node,root)=>{var prev=new DomTreeWalker(node,root).prev(false);var next=new DomTreeWalker(node,root).next(false);var prevIsInline=isUndefined(prev)||isInlineContent(prev,root);var nextIsInline=isUndefined(next)||isInlineContent(next,root);return prevIsInline&&nextIsInline;};var isBookmarkNode$2=node=>isSpan(node)&&node.getAttribute('data-mce-type')==='bookmark';var isKeepTextNode=(node,root)=>isText$a(node)&&node.data.length>0&&surroundedByInlineContent(node,root);var isKeepElement=node=>isElement$6(node)?node.childNodes.length>0:false;var isDocument=node=>isDocumentFragment(node)||isDocument$1(node);var trimNode=(dom,node,root)=>{var _a;var rootNode=root||node;if(isElement$6(node)&&isBookmarkNode$2(node)){return node;}var children=node.childNodes;for(var i=children.length-1;i>=0;i--){trimNode(dom,children[i],rootNode);}if(isElement$6(node)){var currentChildren=node.childNodes;if(currentChildren.length===1&&isBookmarkNode$2(currentChildren[0])){(_a=node.parentNode)===null||_a===void 0?void 0:_a.insertBefore(currentChildren[0],node);}}if(!isDocument(node)&&!isContent$1(node,rootNode)&&!isKeepElement(node)&&!isKeepTextNode(node,rootNode)){dom.remove(node);}return node;};var makeMap$3=Tools.makeMap;var attrsCharsRegExp=/[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;var textCharsRegExp=/[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;var rawCharsRegExp=/[<>&\\\"\\']/g;var entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi;var asciiMap={128:'\\u20AC',130:'\\u201A',131:'\\u0192',132:'\\u201E',133:'\\u2026',134:'\\u2020',135:'\\u2021',136:'\\u02c6',137:'\\u2030',138:'\\u0160',139:'\\u2039',140:'\\u0152',142:'\\u017d',145:'\\u2018',146:'\\u2019',147:'\\u201C',148:'\\u201D',149:'\\u2022',150:'\\u2013',151:'\\u2014',152:'\\u02DC',153:'\\u2122',154:'\\u0161',155:'\\u203A',156:'\\u0153',158:'\\u017e',159:'\\u0178'};var baseEntities={'\"':'&quot;','\\'':'&#39;','<':'&lt;','>':'&gt;','&':'&amp;','`':'&#96;'};var reverseEntities={'&lt;':'<','&gt;':'>','&amp;':'&','&quot;':'\"','&apos;':\"'\"};var nativeDecode=text=>{var elm=SugarElement.fromTag('div').dom;elm.innerHTML=text;return elm.textContent||elm.innerText||text;};var buildEntitiesLookup=(items,radix)=>{var lookup={};if(items){var itemList=items.split(',');radix=radix||10;for(var i=0;i<itemList.length;i+=2){var chr=String.fromCharCode(parseInt(itemList[i],radix));if(!baseEntities[chr]){var entity='&'+itemList[i+1]+';';lookup[chr]=entity;lookup[entity]=chr;}}return lookup;}else{return undefined;}};var namedEntities=buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,'+'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,'+'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,'+'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,'+'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,'+'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,'+'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,'+'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,'+'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,'+'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,'+'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,'+'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,'+'t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,'+'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,'+'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,'+'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,'+'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,'+'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,'+'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,'+'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,'+'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,'+'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,'+'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,'+'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,'+'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro',32);var encodeRaw=(text,attr)=>text.replace(attr?attrsCharsRegExp:textCharsRegExp,chr=>{return baseEntities[chr]||chr;});var encodeAllRaw=text=>(''+text).replace(rawCharsRegExp,chr=>{return baseEntities[chr]||chr;});var encodeNumeric=(text,attr)=>text.replace(attr?attrsCharsRegExp:textCharsRegExp,chr=>{if(chr.length>1){return'&#'+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+';';}return baseEntities[chr]||'&#'+chr.charCodeAt(0)+';';});var encodeNamed=(text,attr,entities)=>{var resolveEntities=entities||namedEntities;return text.replace(attr?attrsCharsRegExp:textCharsRegExp,chr=>{return baseEntities[chr]||resolveEntities[chr]||chr;});};var getEncodeFunc=(name,entities)=>{var entitiesMap=buildEntitiesLookup(entities)||namedEntities;var encodeNamedAndNumeric=(text,attr)=>text.replace(attr?attrsCharsRegExp:textCharsRegExp,chr=>{if(baseEntities[chr]!==undefined){return baseEntities[chr];}if(entitiesMap[chr]!==undefined){return entitiesMap[chr];}if(chr.length>1){return'&#'+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+';';}return'&#'+chr.charCodeAt(0)+';';});var encodeCustomNamed=(text,attr)=>{return encodeNamed(text,attr,entitiesMap);};var nameMap=makeMap$3(name.replace(/\\+/g,','));if(nameMap.named&&nameMap.numeric){return encodeNamedAndNumeric;}if(nameMap.named){if(entities){return encodeCustomNamed;}return encodeNamed;}if(nameMap.numeric){return encodeNumeric;}return encodeRaw;};var decode=text=>text.replace(entityRegExp,(all,numeric)=>{if(numeric){if(numeric.charAt(0).toLowerCase()==='x'){numeric=parseInt(numeric.substr(1),16);}else{numeric=parseInt(numeric,10);}if(numeric>65535){numeric-=65536;return String.fromCharCode(55296+(numeric>>10),56320+(numeric&1023));}return asciiMap[numeric]||String.fromCharCode(numeric);}return reverseEntities[all]||namedEntities[all]||nativeDecode(all);});var Entities={encodeRaw,encodeAllRaw,encodeNumeric,encodeNamed,getEncodeFunc,decode};var split$1=(items,delim)=>{items=Tools.trim(items);return items?items.split(delim||' '):[];};var patternToRegExp=str=>new RegExp('^'+str.replace(/([?+*])/g,'.$1')+'$');var parseCustomElementsRules=value=>{var customElementRegExp=/^(~)?(.+)$/;return bind$3(split$1(value,','),rule=>{var matches=customElementRegExp.exec(rule);if(matches){var inline=matches[1]==='~';var cloneName=inline?'span':'div';var _name2=matches[2];return[{inline,cloneName,name:_name2}];}else{return[];}});};var getElementSetsAsStrings=type=>{var globalAttributes,blockContent;var phrasingContent,flowContent;globalAttributes='id accesskey class dir lang style tabindex title role';blockContent='address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';phrasingContent='a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd '+'label map noscript object q s samp script select small span strong sub sup '+'textarea u var #text #comment';if(type!=='html4'){var transparentContent='a ins del canvas map';globalAttributes+=' contenteditable contextmenu draggable dropzone '+'hidden spellcheck translate';blockContent+=' article aside details dialog figure main header footer hgroup section nav '+transparentContent;phrasingContent+=' audio canvas command datalist mark meter output picture '+'progress time wbr video ruby bdi keygen';}if(type!=='html5-strict'){globalAttributes+=' xml:lang';var html4PhrasingContent='acronym applet basefont big font strike tt';phrasingContent=[phrasingContent,html4PhrasingContent].join(' ');var html4BlockContent='center dir isindex noframes';blockContent=[blockContent,html4BlockContent].join(' ');flowContent=[blockContent,phrasingContent].join(' ');}flowContent=flowContent||[blockContent,phrasingContent].join(' ');return{globalAttributes,blockContent,phrasingContent,flowContent};};var makeSchema=type=>{var{globalAttributes,phrasingContent,flowContent}=getElementSetsAsStrings(type);var schema={};var add=function add(name){var attributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var childNames=split$1(children);var names=split$1(name);var ni=names.length;while(ni--){var attributesOrder=split$1([globalAttributes,attributes].join(' '));schema[names[ni]]={attributes:mapToObject(attributesOrder,constant({})),attributesOrder,children:mapToObject(childNames,constant({}))};}};var addAttrs=(name,attributes)=>{var names=split$1(name);var attrs=split$1(attributes);var ni=names.length;while(ni--){var schemaItem=schema[names[ni]];for(var i=0,l=attrs.length;i<l;i++){schemaItem.attributes[attrs[i]]={};schemaItem.attributesOrder.push(attrs[i]);}}};if(type!=='html5-strict'){var html4PhrasingContent='acronym applet basefont big font strike tt';each$e(split$1(html4PhrasingContent),name=>{add(name,'',phrasingContent);});var html4BlockContent='center dir isindex noframes';each$e(split$1(html4BlockContent),name=>{add(name,'',flowContent);});}add('html','manifest','head body');add('head','','base command link meta noscript script style title');add('title hr noscript br');add('base','href target');add('link','href rel media hreflang type sizes hreflang');add('meta','name http-equiv content charset');add('style','media type scoped');add('script','src async defer type charset');add('body','onafterprint onbeforeprint onbeforeunload onblur onerror onfocus '+'onhashchange onload onmessage onoffline ononline onpagehide onpageshow '+'onpopstate onresize onscroll onstorage onunload',flowContent);add('dd div','',flowContent);add('address dt caption','',type==='html4'?phrasingContent:flowContent);add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn','',phrasingContent);add('blockquote','cite',flowContent);add('ol','reversed start type','li');add('ul','','li');add('li','value',flowContent);add('dl','','dt dd');add('a','href target rel media hreflang type',type==='html4'?phrasingContent:flowContent);add('q','cite',phrasingContent);add('ins del','cite datetime',flowContent);add('img','src sizes srcset alt usemap ismap width height');add('iframe','src name width height',flowContent);add('embed','src type width height');add('object','data type typemustmatch name usemap form width height',[flowContent,'param'].join(' '));add('param','name value');add('map','name',[flowContent,'area'].join(' '));add('area','alt coords shape href target rel media hreflang type');add('table','border','caption colgroup thead tfoot tbody tr'+(type==='html4'?' col':''));add('colgroup','span','col');add('col','span');add('tbody thead tfoot','','tr');add('tr','','td th');add('td','colspan rowspan headers',flowContent);add('th','colspan rowspan headers scope abbr',flowContent);add('form','accept-charset action autocomplete enctype method name novalidate target',flowContent);add('fieldset','disabled form name',[flowContent,'legend'].join(' '));add('label','form for',phrasingContent);add('input','accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate '+'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');add('button','disabled form formaction formenctype formmethod formnovalidate formtarget name type value',type==='html4'?flowContent:phrasingContent);add('select','disabled form multiple name required size','option optgroup');add('optgroup','disabled label','option');add('option','disabled label selected value');add('textarea','cols dirname disabled form maxlength name readonly required rows wrap');add('menu','type label',[flowContent,'li'].join(' '));add('noscript','',flowContent);if(type!=='html4'){add('wbr');add('ruby','',[phrasingContent,'rt rp'].join(' '));add('figcaption','',flowContent);add('mark rt rp summary bdi','',phrasingContent);add('canvas','width height',flowContent);add('video','src crossorigin poster preload autoplay mediagroup loop '+'muted controls width height buffered',[flowContent,'track source'].join(' '));add('audio','src crossorigin preload autoplay mediagroup loop muted controls '+'buffered volume',[flowContent,'track source'].join(' '));add('picture','','img source');add('source','src srcset type media sizes');add('track','kind src srclang label default');add('datalist','',[phrasingContent,'option'].join(' '));add('article section nav aside main header footer','',flowContent);add('hgroup','','h1 h2 h3 h4 h5 h6');add('figure','',[flowContent,'figcaption'].join(' '));add('time','datetime',phrasingContent);add('dialog','open',flowContent);add('command','type label icon disabled checked radiogroup command');add('output','for form name',phrasingContent);add('progress','value max',phrasingContent);add('meter','value min max low high optimum',phrasingContent);add('details','open',[flowContent,'summary'].join(' '));add('keygen','autofocus challenge disabled form keytype name');}if(type!=='html5-strict'){addAttrs('script','language xml:space');addAttrs('style','xml:space');addAttrs('object','declare classid code codebase codetype archive standby align border hspace vspace');addAttrs('embed','align name hspace vspace');addAttrs('param','valuetype type');addAttrs('a','charset name rev shape coords');addAttrs('br','clear');addAttrs('applet','codebase archive code object alt name width height align hspace vspace');addAttrs('img','name longdesc align border hspace vspace');addAttrs('iframe','longdesc frameborder marginwidth marginheight scrolling align');addAttrs('font basefont','size color face');addAttrs('input','usemap align');addAttrs('select');addAttrs('textarea');addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption','align');addAttrs('ul','type compact');addAttrs('li','type');addAttrs('ol dl menu dir','compact');addAttrs('pre','width xml:space');addAttrs('hr','align noshade size width');addAttrs('isindex','prompt');addAttrs('table','summary width frame rules cellspacing cellpadding align bgcolor');addAttrs('col','width align char charoff valign');addAttrs('colgroup','width align char charoff valign');addAttrs('thead','align char charoff valign');addAttrs('tr','align char charoff valign bgcolor');addAttrs('th','axis align char charoff valign nowrap bgcolor width height');addAttrs('form','accept');addAttrs('td','abbr axis scope align char charoff valign nowrap bgcolor width height');addAttrs('tfoot','align char charoff valign');addAttrs('tbody','align char charoff valign');addAttrs('area','nohref');addAttrs('body','background bgcolor text link vlink alink');}if(type!=='html4'){addAttrs('input button select textarea','autofocus');addAttrs('input textarea','placeholder');addAttrs('a','download');addAttrs('link script img','crossorigin');addAttrs('img','loading');addAttrs('iframe','sandbox seamless allow allowfullscreen loading');}if(type!=='html4'){each$e([schema.video,schema.audio],item=>{delete item.children.audio;delete item.children.video;});}each$e(split$1('a form meter progress dfn'),name=>{if(schema[name]){delete schema[name].children[name];}});delete schema.caption.children.table;delete schema.script;return schema;};var prefixToOperation=prefix=>prefix==='-'?'remove':'add';var parseValidChildrenRules=value=>{var childRuleRegExp=/^([+\\-]?)([A-Za-z0-9_\\-.\\u00b7\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u037d\\u037f-\\u1fff\\u200c-\\u200d\\u203f-\\u2040\\u2070-\\u218f\\u2c00-\\u2fef\\u3001-\\ud7ff\\uf900-\\ufdcf\\ufdf0-\\ufffd]+)\\[([^\\]]+)]$/;return bind$3(split$1(value,','),rule=>{var matches=childRuleRegExp.exec(rule);if(matches){var prefix=matches[1];var operation=prefix?prefixToOperation(prefix):'replace';var _name3=matches[2];var validChildren=split$1(matches[3],'|');return[{operation,name:_name3,validChildren}];}else{return[];}});};var parseValidElementsAttrDataIntoElement=(attrData,targetElement)=>{var attrRuleRegExp=/^([!\\-])?(\\w+[\\\\:]:\\w+|[^=~<]+)?(?:([=~<])(.*))?$/;var hasPatternsRegExp=/[*?+]/;var{attributes,attributesOrder}=targetElement;return each$e(split$1(attrData,'|'),rule=>{var matches=attrRuleRegExp.exec(rule);if(matches){var attr={};var attrType=matches[1];var attrName=matches[2].replace(/[\\\\:]:/g,':');var attrPrefix=matches[3];var _value3=matches[4];if(attrType==='!'){targetElement.attributesRequired=targetElement.attributesRequired||[];targetElement.attributesRequired.push(attrName);attr.required=true;}if(attrType==='-'){delete attributes[attrName];attributesOrder.splice(Tools.inArray(attributesOrder,attrName),1);return;}if(attrPrefix){if(attrPrefix==='='){targetElement.attributesDefault=targetElement.attributesDefault||[];targetElement.attributesDefault.push({name:attrName,value:_value3});attr.defaultValue=_value3;}else if(attrPrefix==='~'){targetElement.attributesForced=targetElement.attributesForced||[];targetElement.attributesForced.push({name:attrName,value:_value3});attr.forcedValue=_value3;}else if(attrPrefix==='<'){attr.validValues=Tools.makeMap(_value3,'?');}}if(hasPatternsRegExp.test(attrName)){var attrPattern=attr;targetElement.attributePatterns=targetElement.attributePatterns||[];attrPattern.pattern=patternToRegExp(attrName);targetElement.attributePatterns.push(attrPattern);}else{if(!attributes[attrName]){attributesOrder.push(attrName);}attributes[attrName]=attr;}}});};var cloneAttributesInto=(from,to)=>{each$d(from.attributes,(value,key)=>{to.attributes[key]=value;});to.attributesOrder.push(...from.attributesOrder);};var parseValidElementsRules=(globalElement,validElements)=>{var elementRuleRegExp=/^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)])?$/;return bind$3(split$1(validElements,','),rule=>{var matches=elementRuleRegExp.exec(rule);if(matches){var prefix=matches[1];var elementName=matches[2];var outputName=matches[3];var attrsPrefix=matches[4];var attrData=matches[5];var element={attributes:{},attributesOrder:[]};globalElement.each(el=>cloneAttributesInto(el,element));if(prefix==='#'){element.paddEmpty=true;}else if(prefix==='-'){element.removeEmpty=true;}if(attrsPrefix==='!'){element.removeEmptyAttrs=true;}if(attrData){parseValidElementsAttrDataIntoElement(attrData,element);}if(outputName){element.outputName=elementName;}if(elementName==='@'){if(globalElement.isNone()){globalElement=Optional.some(element);}else{return[];}}return[outputName?{name:elementName,element,aliasName:outputName}:{name:elementName,element}];}else{return[];}});};var mapCache={};var makeMap$2=Tools.makeMap,each$b=Tools.each,extend$2=Tools.extend,explode$2=Tools.explode;var createMap=function createMap(defaultValue){var extendWith=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var value=makeMap$2(defaultValue,' ',makeMap$2(defaultValue.toUpperCase(),' '));return extend$2(value,extendWith);};var getTextRootBlockElements=schema=>createMap('td th li dt dd figcaption caption details summary',schema.getTextBlockElements());var compileElementMap=(value,mode)=>{if(value){var styles={};if(isString(value)){value={'*':value};}each$b(value,(value,key)=>{styles[key]=styles[key.toUpperCase()]=mode==='map'?makeMap$2(value,/[, ]/):explode$2(value,/[, ]/);});return styles;}else{return undefined;}};var Schema=function Schema(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _a;var elements={};var children={};var patternElements=[];var customElementsMap={};var specialElements={};var createLookupTable=(option,defaultValue,extendWith)=>{var value=settings[option];if(!value){var newValue=mapCache[option];if(!newValue){newValue=createMap(defaultValue,extendWith);mapCache[option]=newValue;}return newValue;}else{return makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/));}};var schemaType=(_a=settings.schema)!==null&&_a!==void 0?_a:'html5';var schemaItems=makeSchema(schemaType);if(settings.verify_html===false){settings.valid_elements='*[*]';}var validStyles=compileElementMap(settings.valid_styles);var invalidStyles=compileElementMap(settings.invalid_styles,'map');var validClasses=compileElementMap(settings.valid_classes,'map');var whitespaceElementsMap=createLookupTable('whitespace_elements','pre script noscript style textarea video audio iframe object code');var selfClosingElementsMap=createLookupTable('self_closing_elements','colgroup dd dt li option p td tfoot th thead tr');var voidElementsMap=createLookupTable('void_elements','area base basefont br col frame hr img input isindex link '+'meta param embed source wbr track');var boolAttrMap=createLookupTable('boolean_attributes','checked compact declare defer disabled ismap multiple nohref noresize '+'noshade nowrap readonly selected autoplay loop controls allowfullscreen');var nonEmptyOrMoveCaretBeforeOnEnter='td th iframe video audio object script code';var nonEmptyElementsMap=createLookupTable('non_empty_elements',nonEmptyOrMoveCaretBeforeOnEnter+' pre',voidElementsMap);var moveCaretBeforeOnEnterElementsMap=createLookupTable('move_caret_before_on_enter_elements',nonEmptyOrMoveCaretBeforeOnEnter+' table',voidElementsMap);var textBlockElementsMap=createLookupTable('text_block_elements','h1 h2 h3 h4 h5 h6 p div address pre form '+'blockquote center dir fieldset header footer article section hgroup aside main nav figure');var blockElementsMap=createLookupTable('block_elements','hr table tbody thead tfoot '+'th tr td li ol ul caption dl dt dd noscript menu isindex option '+'datalist select optgroup figcaption details summary',textBlockElementsMap);var textInlineElementsMap=createLookupTable('text_inline_elements','span strong b em i font s strike u var cite '+'dfn code mark q sup sub samp');var transparentElementsMap=createLookupTable('transparent_elements','a ins del canvas map');each$b('script noscript iframe noframes noembed title style textarea xmp plaintext'.split(' '),name=>{specialElements[name]=new RegExp('</'+name+'[^>]*>','gi');});var addValidElements=validElements=>{var globalElement=Optional.from(elements['@']);var hasPatternsRegExp=/[*?+]/;each$e(parseValidElementsRules(globalElement,validElements!==null&&validElements!==void 0?validElements:''),_ref2=>{var{name,element,aliasName}=_ref2;if(aliasName){elements[aliasName]=element;}if(hasPatternsRegExp.test(name)){var patternElement=element;patternElement.pattern=patternToRegExp(name);patternElements.push(patternElement);}else{elements[name]=element;}});};var setValidElements=validElements=>{patternElements=[];each$e(keys(elements),name=>{delete elements[name];});addValidElements(validElements);};var addCustomElements=customElements=>{delete mapCache.text_block_elements;delete mapCache.block_elements;each$e(parseCustomElementsRules(customElements!==null&&customElements!==void 0?customElements:''),_ref3=>{var{inline,name,cloneName}=_ref3;children[name]=children[cloneName];customElementsMap[name]=cloneName;nonEmptyElementsMap[name.toUpperCase()]={};nonEmptyElementsMap[name]={};if(!inline){blockElementsMap[name.toUpperCase()]={};blockElementsMap[name]={};}if(!elements[name]){var customRule=elements[cloneName];customRule=extend$2({},customRule);delete customRule.removeEmptyAttrs;delete customRule.removeEmpty;elements[name]=customRule;}each$d(children,(element,elmName)=>{if(element[cloneName]){children[elmName]=element=extend$2({},children[elmName]);element[name]=element[cloneName];}});});};var addValidChildren=validChildren=>{each$e(parseValidChildrenRules(validChildren!==null&&validChildren!==void 0?validChildren:''),_ref4=>{var{operation,name,validChildren}=_ref4;var parent=operation==='replace'?{'#comment':{}}:children[name];each$e(validChildren,child=>{if(operation==='remove'){delete parent[child];}else{parent[child]={};}});children[name]=parent;});};var getElementRule=name=>{var element=elements[name];if(element){return element;}var i=patternElements.length;while(i--){var patternElement=patternElements[i];if(patternElement.pattern.test(name)){return patternElement;}}return undefined;};if(!settings.valid_elements){each$b(schemaItems,(element,name)=>{elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder};children[name]=element.children;});each$b(split$1('strong/b em/i'),item=>{var items=split$1(item,'/');elements[items[1]].outputName=items[0];});each$b(textInlineElementsMap,(_val,name)=>{if(elements[name]){if(settings.padd_empty_block_inline_children){elements[name].paddInEmptyBlock=true;}elements[name].removeEmpty=true;}});each$b(split$1('ol ul blockquote a table tbody'),name=>{if(elements[name]){elements[name].removeEmpty=true;}});each$b(split$1('p h1 h2 h3 h4 h5 h6 th td pre div address caption li summary'),name=>{if(elements[name]){elements[name].paddEmpty=true;}});each$b(split$1('span'),name=>{elements[name].removeEmptyAttrs=true;});}else{setValidElements(settings.valid_elements);each$b(schemaItems,(element,name)=>{children[name]=element.children;});}addCustomElements(settings.custom_elements);addValidChildren(settings.valid_children);addValidElements(settings.extended_valid_elements);addValidChildren('+ol[ul|ol],+ul[ul|ol]');each$b({dd:'dl',dt:'dl',li:'ul ol',td:'tr',th:'tr',tr:'tbody thead tfoot',tbody:'table',thead:'table',tfoot:'table',legend:'fieldset',area:'map',param:'video audio object'},(parents,item)=>{if(elements[item]){elements[item].parentsRequired=split$1(parents);}});if(settings.invalid_elements){each$b(explode$2(settings.invalid_elements),item=>{if(elements[item]){delete elements[item];}});}if(!getElementRule('span')){addValidElements('span[!data-mce-type|*]');}var getValidStyles=constant(validStyles);var getInvalidStyles=constant(invalidStyles);var getValidClasses=constant(validClasses);var getBoolAttrs=constant(boolAttrMap);var getBlockElements=constant(blockElementsMap);var getTextBlockElements=constant(textBlockElementsMap);var getTextInlineElements=constant(textInlineElementsMap);var getVoidElements=constant(Object.seal(voidElementsMap));var getSelfClosingElements=constant(selfClosingElementsMap);var getNonEmptyElements=constant(nonEmptyElementsMap);var getMoveCaretBeforeOnEnterElements=constant(moveCaretBeforeOnEnterElementsMap);var getWhitespaceElements=constant(whitespaceElementsMap);var getTransparentElements=constant(transparentElementsMap);var getSpecialElements=constant(Object.seal(specialElements));var isValidChild=(name,child)=>{var parent=children[name.toLowerCase()];return!!(parent&&parent[child.toLowerCase()]);};var isValid=(name,attr)=>{var rule=getElementRule(name);if(rule){if(attr){if(rule.attributes[attr]){return true;}var attrPatterns=rule.attributePatterns;if(attrPatterns){var i=attrPatterns.length;while(i--){if(attrPatterns[i].pattern.test(attr)){return true;}}}}else{return true;}}return false;};var getCustomElements=constant(customElementsMap);return{type:schemaType,children,elements,getValidStyles,getValidClasses,getBlockElements,getInvalidStyles,getVoidElements,getTextBlockElements,getTextInlineElements,getBoolAttrs,getElementRule,getSelfClosingElements,getNonEmptyElements,getMoveCaretBeforeOnEnterElements,getWhitespaceElements,getTransparentElements,getSpecialElements,isValidChild,isValid,getCustomElements,addValidElements,setValidElements,addCustomElements,addValidChildren};};var Styles=function Styles(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var schema=arguments.length>1?arguments[1]:undefined;var urlOrStrRegExp=/(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;var styleRegExp=/\\s*([^:]+):\\s*([^;]+);?/g;var trimRightRegExp=/\\s+$/;var encodingLookup={};var validStyles;var invalidStyles;var invisibleChar=zeroWidth;if(schema){validStyles=schema.getValidStyles();invalidStyles=schema.getInvalidStyles();}var encodingItems=(\"\\\\\\\" \\\\' \\\\; \\\\: ; : \"+invisibleChar).split(' ');for(var i=0;i<encodingItems.length;i++){encodingLookup[encodingItems[i]]=invisibleChar+i;encodingLookup[invisibleChar+i]=encodingItems[i];}var self={parse:css=>{var styles={};var isEncoded=false;var urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope||self;var compress=(prefix,suffix,noJoin)=>{var top=styles[prefix+'-top'+suffix];if(!top){return;}var right=styles[prefix+'-right'+suffix];if(!right){return;}var bottom=styles[prefix+'-bottom'+suffix];if(!bottom){return;}var left=styles[prefix+'-left'+suffix];if(!left){return;}var box=[top,right,bottom,left];var i=box.length-1;while(i--){if(box[i]!==box[i+1]){break;}}if(i>-1&&noJoin){return;}styles[prefix+suffix]=i===-1?box[0]:box.join(' ');delete styles[prefix+'-top'+suffix];delete styles[prefix+'-right'+suffix];delete styles[prefix+'-bottom'+suffix];delete styles[prefix+'-left'+suffix];};var canCompress=key=>{var value=styles[key];if(!value){return;}var values=value.indexOf(',')>-1?[value]:value.split(' ');var i=values.length;while(i--){if(values[i]!==values[0]){return false;}}styles[key]=values[0];return true;};var compress2=(target,a,b,c)=>{if(!canCompress(a)){return;}if(!canCompress(b)){return;}if(!canCompress(c)){return;}styles[target]=styles[a]+' '+styles[b]+' '+styles[c];delete styles[a];delete styles[b];delete styles[c];};var encode=str=>{isEncoded=true;return encodingLookup[str];};var decode=(str,keepSlashes)=>{if(isEncoded){str=str.replace(/\\uFEFF[0-9]/g,str=>{return encodingLookup[str];});}if(!keepSlashes){str=str.replace(/\\\\([\\'\\\";:])/g,'$1');}return str;};var decodeSingleHexSequence=escSeq=>{return String.fromCharCode(parseInt(escSeq.slice(1),16));};var decodeHexSequences=value=>{return value.replace(/\\\\[0-9a-f]+/gi,decodeSingleHexSequence);};var processUrl=(match,url,url2,url3,str,str2)=>{str=str||str2;if(str){str=decode(str);return\"'\"+str.replace(/\\'/g,\"\\\\'\")+\"'\";}url=decode(url||url2||url3||'');if(!settings.allow_script_urls){var scriptUrl=url.replace(/[\\s\\r\\n]+/g,'');if(/(java|vb)script:/i.test(scriptUrl)){return'';}if(!settings.allow_svg_data_urls&&/^data:image\\/svg/i.test(scriptUrl)){return'';}}if(urlConverter){url=urlConverter.call(urlConverterScope,url,'style');}return\"url('\"+url.replace(/\\'/g,\"\\\\'\")+\"')\";};if(css){css=css.replace(/[\\u0000-\\u001F]/g,'');css=css.replace(/\\\\[\\\"\\';:\\uFEFF]/g,encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g,str=>{return str.replace(/[;:]/g,encode);});var matches;while(matches=styleRegExp.exec(css)){styleRegExp.lastIndex=matches.index+matches[0].length;var _name4=matches[1].replace(trimRightRegExp,'').toLowerCase();var _value4=matches[2].replace(trimRightRegExp,'');if(_name4&&_value4){_name4=decodeHexSequences(_name4);_value4=decodeHexSequences(_value4);if(_name4.indexOf(invisibleChar)!==-1||_name4.indexOf('\"')!==-1){continue;}if(!settings.allow_script_urls&&(_name4==='behavior'||/expression\\s*\\(|\\/\\*|\\*\\//.test(_value4))){continue;}if(_name4==='font-weight'&&_value4==='700'){_value4='bold';}else if(_name4==='color'||_name4==='background-color'){_value4=_value4.toLowerCase();}_value4=_value4.replace(urlOrStrRegExp,processUrl);styles[_name4]=isEncoded?decode(_value4,true):_value4;}}compress('border','',true);compress('border','-width');compress('border','-color');compress('border','-style');compress('padding','');compress('margin','');compress2('border','border-width','border-style','border-color');if(styles.border==='medium none'){delete styles.border;}if(styles['border-image']==='none'){delete styles['border-image'];}}return styles;},serialize:(styles,elementName)=>{var css='';var serializeStyles=(elemName,validStyleList)=>{var styleList=validStyleList[elemName];if(styleList){for(var _i=0,l=styleList.length;_i<l;_i++){var _name5=styleList[_i];var _value5=styles[_name5];if(_value5){css+=(css.length>0?' ':'')+_name5+': '+_value5+';';}}}};var isValid=(name,elemName)=>{if(!invalidStyles||!elemName){return true;}var styleMap=invalidStyles['*'];if(styleMap&&styleMap[name]){return false;}styleMap=invalidStyles[elemName];return!(styleMap&&styleMap[name]);};if(elementName&&validStyles){serializeStyles('*',validStyles);serializeStyles(elementName,validStyles);}else{each$d(styles,(value,name)=>{if(value&&isValid(name,elementName)){css+=(css.length>0?' ':'')+name+': '+value+';';}});}return css;}};return self;};var deprecated={keyLocation:true,layerX:true,layerY:true,returnValue:true,webkitMovementX:true,webkitMovementY:true,keyIdentifier:true,mozPressure:true};var isNativeEvent=event=>event instanceof Event||isFunction(event.initEvent);var hasIsDefaultPrevented=event=>event.isDefaultPrevented===always||event.isDefaultPrevented===never;var needsNormalizing=event=>isNullable(event.preventDefault)||isNativeEvent(event);var clone$3=(originalEvent,data)=>{var event=data!==null&&data!==void 0?data:{};for(var _name6 in originalEvent){if(!has$2(deprecated,_name6)){event[_name6]=originalEvent[_name6];}}if(isNonNullable(originalEvent.composedPath)){event.composedPath=()=>originalEvent.composedPath();}return event;};var normalize$3=(type,originalEvent,fallbackTarget,data)=>{var _a;var event=clone$3(originalEvent,data);event.type=type;if(isNullable(event.target)){event.target=(_a=event.srcElement)!==null&&_a!==void 0?_a:fallbackTarget;}if(needsNormalizing(originalEvent)){event.preventDefault=()=>{event.defaultPrevented=true;event.isDefaultPrevented=always;if(isFunction(originalEvent.preventDefault)){originalEvent.preventDefault();}};event.stopPropagation=()=>{event.cancelBubble=true;event.isPropagationStopped=always;if(isFunction(originalEvent.stopPropagation)){originalEvent.stopPropagation();}};event.stopImmediatePropagation=()=>{event.isImmediatePropagationStopped=always;event.stopPropagation();};if(!hasIsDefaultPrevented(event)){event.isDefaultPrevented=event.defaultPrevented===true?always:never;event.isPropagationStopped=event.cancelBubble===true?always:never;event.isImmediatePropagationStopped=never;}}return event;};var eventExpandoPrefix='mce-data-';var mouseEventRe=/^(?:mouse|contextmenu)|click/;var addEvent=(target,name,callback,capture)=>{target.addEventListener(name,callback,capture||false);};var removeEvent=(target,name,callback,capture)=>{target.removeEventListener(name,callback,capture||false);};var isMouseEvent=event=>isNonNullable(event)&&mouseEventRe.test(event.type);var fix=(originalEvent,data)=>{var event=normalize$3(originalEvent.type,originalEvent,document,data);if(isMouseEvent(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)){var eventDoc=event.target.ownerDocument||document;var doc=eventDoc.documentElement;var body=eventDoc.body;var mouseEvent=event;mouseEvent.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}return event;};var bindOnReady=(win,callback,eventUtils)=>{var doc=win.document,event={type:'ready'};if(eventUtils.domLoaded){callback(event);return;}var isDocReady=()=>{return doc.readyState==='complete'||doc.readyState==='interactive'&&doc.body;};var readyHandler=()=>{removeEvent(win,'DOMContentLoaded',readyHandler);removeEvent(win,'load',readyHandler);if(!eventUtils.domLoaded){eventUtils.domLoaded=true;callback(event);}win=null;};if(isDocReady()){readyHandler();}else{addEvent(win,'DOMContentLoaded',readyHandler);}if(!eventUtils.domLoaded){addEvent(win,'load',readyHandler);}};class EventUtils{constructor(){this.domLoaded=false;this.events={};this.count=1;this.expando=eventExpandoPrefix+(+new Date()).toString(32);this.hasFocusIn='onfocusin'in document.documentElement;this.count=1;}bind(target,names,callback,scope){var self=this;var callbackList;var win=window;var defaultNativeHandler=evt=>{self.executeHandlers(fix(evt||win.event),id);};if(!target||isText$a(target)||isComment(target)){return callback;}var id;if(!target[self.expando]){id=self.count++;target[self.expando]=id;self.events[id]={};}else{id=target[self.expando];}scope=scope||target;var namesList=names.split(' ');var i=namesList.length;while(i--){var _name7=namesList[i];var nativeHandler=defaultNativeHandler;var capture=false;var fakeName=false;if(_name7==='DOMContentLoaded'){_name7='ready';}if(self.domLoaded&&_name7==='ready'&&target.readyState==='complete'){callback.call(scope,fix({type:_name7}));continue;}if(!self.hasFocusIn&&(_name7==='focusin'||_name7==='focusout')){capture=true;fakeName=_name7==='focusin'?'focus':'blur';nativeHandler=evt=>{var event=fix(evt||win.event);event.type=event.type==='focus'?'focusin':'focusout';self.executeHandlers(event,id);};}callbackList=self.events[id][_name7];if(!callbackList){self.events[id][_name7]=callbackList=[{func:callback,scope}];callbackList.fakeName=fakeName;callbackList.capture=capture;callbackList.nativeHandler=nativeHandler;if(_name7==='ready'){bindOnReady(target,nativeHandler,self);}else{addEvent(target,fakeName||_name7,nativeHandler,capture);}}else{if(_name7==='ready'&&self.domLoaded){callback(fix({type:_name7}));}else{callbackList.push({func:callback,scope});}}}target=callbackList=null;return callback;}unbind(target,names,callback){if(!target||isText$a(target)||isComment(target)){return this;}var id=target[this.expando];if(id){var eventMap=this.events[id];if(names){var namesList=names.split(' ');var i=namesList.length;while(i--){var _name8=namesList[i];var callbackList=eventMap[_name8];if(callbackList){if(callback){var ci=callbackList.length;while(ci--){if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler;var fakeName=callbackList.fakeName,capture=callbackList.capture;var newCallbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1));newCallbackList.nativeHandler=nativeHandler;newCallbackList.fakeName=fakeName;newCallbackList.capture=capture;eventMap[_name8]=newCallbackList;}}}if(!callback||callbackList.length===0){delete eventMap[_name8];removeEvent(target,callbackList.fakeName||_name8,callbackList.nativeHandler,callbackList.capture);}}}}else{each$d(eventMap,(callbackList,name)=>{removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);});eventMap={};}for(var _name9 in eventMap){if(has$2(eventMap,_name9)){return this;}}delete this.events[id];try{delete target[this.expando];}catch(ex){target[this.expando]=null;}}return this;}fire(target,name,args){return this.dispatch(target,name,args);}dispatch(target,name,args){if(!target||isText$a(target)||isComment(target)){return this;}var event=fix({type:name,target},args);do{var id=target[this.expando];if(id){this.executeHandlers(event,id);}target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow;}while(target&&!event.isPropagationStopped());return this;}clean(target){if(!target||isText$a(target)||isComment(target)){return this;}if(target[this.expando]){this.unbind(target);}if(!target.getElementsByTagName){target=target.document;}if(target&&target.getElementsByTagName){this.unbind(target);var _children=target.getElementsByTagName('*');var i=_children.length;while(i--){target=_children[i];if(target[this.expando]){this.unbind(target);}}}return this;}destroy(){this.events={};}cancel(e){if(e){e.preventDefault();e.stopImmediatePropagation();}return false;}executeHandlers(evt,id){var container=this.events[id];var callbackList=container&&container[evt.type];if(callbackList){for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&callback.func.call(callback.scope,evt)===false){evt.preventDefault();}if(evt.isImmediatePropagationStopped()){return;}}}}}EventUtils.Event=new EventUtils();var each$a=Tools.each;var grep=Tools.grep;var internalStyleName='data-mce-style';var numericalCssMap=Tools.makeMap('fill-opacity font-weight line-height opacity orphans widows z-index zoom',' ');var legacySetAttribute=(elm,name,value)=>{if(isNullable(value)||value===''){remove$a(elm,name);}else{set$3(elm,name,value);}};var camelCaseToHyphens=name=>name.replace(/[A-Z]/g,v=>'-'+v.toLowerCase());var findNodeIndex=(node,normalized)=>{var idx=0;if(node){for(var lastNodeType=node.nodeType,tempNode=node.previousSibling;tempNode;tempNode=tempNode.previousSibling){var nodeType=tempNode.nodeType;if(normalized&&isText$a(tempNode)){if(nodeType===lastNodeType||!tempNode.data.length){continue;}}idx++;lastNodeType=nodeType;}}return idx;};var updateInternalStyleAttr=(styles,elm)=>{var rawValue=get$9(elm,'style');var value=styles.serialize(styles.parse(rawValue),name(elm));legacySetAttribute(elm,internalStyleName,value);};var convertStyleToString=(cssValue,cssName)=>{if(isNumber(cssValue)){return has$2(numericalCssMap,cssName)?cssValue+'':cssValue+'px';}else{return cssValue;}};var applyStyle$1=($elm,cssName,cssValue)=>{var normalizedName=camelCaseToHyphens(cssName);if(isNullable(cssValue)||cssValue===''){remove$6($elm,normalizedName);}else{set$2($elm,normalizedName,convertStyleToString(cssValue,normalizedName));}};var setupAttrHooks=(styles,settings,getContext)=>{var keepValues=settings.keep_values;var keepUrlHook={set:(elm,value,name)=>{var sugarElm=SugarElement.fromDom(elm);if(isFunction(settings.url_converter)&&isNonNullable(value)){value=settings.url_converter.call(settings.url_converter_scope||getContext(),String(value),name,elm);}var internalName='data-mce-'+name;legacySetAttribute(sugarElm,internalName,value);legacySetAttribute(sugarElm,name,value);},get:(elm,name)=>{var sugarElm=SugarElement.fromDom(elm);return get$9(sugarElm,'data-mce-'+name)||get$9(sugarElm,name);}};var attrHooks={style:{set:(elm,value)=>{var sugarElm=SugarElement.fromDom(elm);if(keepValues){legacySetAttribute(sugarElm,internalStyleName,value);}remove$a(sugarElm,'style');if(isString(value)){setAll(sugarElm,styles.parse(value));}},get:elm=>{var sugarElm=SugarElement.fromDom(elm);var value=get$9(sugarElm,internalStyleName)||get$9(sugarElm,'style');return styles.serialize(styles.parse(value),name(sugarElm));}}};if(keepValues){attrHooks.href=attrHooks.src=keepUrlHook;}return attrHooks;};var DOMUtils=function DOMUtils(doc){var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var addedStyles={};var win=window;var files={};var counter=0;var stdMode=true;var boxModel=true;var styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy});var boundEvents=[];var schema=settings.schema?settings.schema:Schema({});var styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema);var events=settings.ownEvents?new EventUtils():EventUtils.Event;var blockElementsMap=schema.getBlockElements();var isBlock=node=>{if(isString(node)){return has$2(blockElementsMap,node);}else{return isElement$6(node)&&(has$2(blockElementsMap,node.nodeName)||isTransparentBlock(schema,node));}};var get=elm=>elm&&doc&&isString(elm)?doc.getElementById(elm):elm;var _get=elm=>{var value=get(elm);return isNonNullable(value)?SugarElement.fromDom(value):null;};var getAttrib=function getAttrib(elm,name){var defaultVal=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var value;var $elm=_get(elm);if(isNonNullable($elm)&&isElement$7($elm)){var hook=attrHooks[name];if(hook&&hook.get){value=hook.get($elm.dom,name);}else{value=get$9($elm,name);}}return isNonNullable(value)?value:defaultVal;};var getAttribs=elm=>{var node=get(elm);return isNullable(node)?[]:node.attributes;};var setAttrib=(elm,name,value)=>{run(elm,e=>{if(isElement$6(e)){var $elm=SugarElement.fromDom(e);var val=value===''?null:value;var originalValue=get$9($elm,name);var hook=attrHooks[name];if(hook&&hook.set){hook.set($elm.dom,val,name);}else{legacySetAttribute($elm,name,val);}if(originalValue!==val&&settings.onSetAttrib){settings.onSetAttrib({attrElm:$elm.dom,attrName:name,attrValue:val});}}});};var clone=(node,deep)=>{return node.cloneNode(deep);};var getRoot=()=>settings.root_element||doc.body;var getViewPort=argWin=>{var vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height};};var getPos$1=(elm,rootElm)=>getPos(doc.body,get(elm),rootElm);var setStyle=(elm,name,value)=>{run(elm,e=>{var $elm=SugarElement.fromDom(e);applyStyle$1($elm,name,value);if(settings.update_styles){updateInternalStyleAttr(styles,$elm);}});};var setStyles=(elm,stylesArg)=>{run(elm,e=>{var $elm=SugarElement.fromDom(e);each$d(stylesArg,(v,n)=>{applyStyle$1($elm,n,v);});if(settings.update_styles){updateInternalStyleAttr(styles,$elm);}});};var getStyle=(elm,name,computed)=>{var $elm=get(elm);if(isNullable($elm)||!isElement$6($elm)){return undefined;}if(computed){return get$7(SugarElement.fromDom($elm),camelCaseToHyphens(name));}else{name=name.replace(/-(\\D)/g,(a,b)=>b.toUpperCase());if(name==='float'){name='cssFloat';}return $elm.style?$elm.style[name]:undefined;}};var getSize=elm=>{var $elm=get(elm);if(!$elm){return{w:0,h:0};}var w=getStyle($elm,'width');var h=getStyle($elm,'height');if(!w||w.indexOf('px')===-1){w='0';}if(!h||h.indexOf('px')===-1){h='0';}return{w:parseInt(w,10)||$elm.offsetWidth||$elm.clientWidth,h:parseInt(h,10)||$elm.offsetHeight||$elm.clientHeight};};var getRect=elm=>{var $elm=get(elm);var pos=getPos$1($elm);var size=getSize($elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h};};var is=(elm,selector)=>{if(!elm){return false;}var elms=isArray$1(elm)?elm:[elm];return exists(elms,e=>{return is$1(SugarElement.fromDom(e),selector);});};var getParents=(elm,selector,root,collect)=>{var result=[];var node=get(elm);collect=collect===undefined;var resolvedRoot=root||(getRoot().nodeName!=='BODY'?getRoot().parentNode:null);if(isString(selector)){if(selector==='*'){selector=isElement$6;}else{var selectorVal=selector;selector=node=>is(node,selectorVal);}}while(node){if(node===resolvedRoot||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node)){break;}if(!selector||selector(node)){if(collect){result.push(node);}else{return[node];}}node=node.parentNode;}return collect?result:null;};var getParent=(node,selector,root)=>{var parents=getParents(node,selector,root,false);return parents&&parents.length>0?parents[0]:null;};var _findSib=(node,selector,name)=>{var func=selector;if(node){if(isString(selector)){func=node=>{return is(node,selector);};}for(var tempNode=node[name];tempNode;tempNode=tempNode[name]){if(isFunction(func)&&func(tempNode)){return tempNode;}}}return null;};var getNext=(node,selector)=>_findSib(node,selector,'nextSibling');var getPrev=(node,selector)=>_findSib(node,selector,'previousSibling');var isParentNode=node=>isFunction(node.querySelectorAll);var select=(selector,scope)=>{var _a,_b;var elm=(_b=(_a=get(scope))!==null&&_a!==void 0?_a:settings.root_element)!==null&&_b!==void 0?_b:doc;return isParentNode(elm)?from(elm.querySelectorAll(selector)):[];};var run=function run(elm,func,scope){var context=scope!==null&&scope!==void 0?scope:this;if(isArray$1(elm)){var result=[];each$a(elm,(e,i)=>{var node=get(e);if(node){result.push(func.call(context,node,i));}});return result;}else{var node=get(elm);return!node?false:func.call(context,node);}};var setAttribs=(elm,attrs)=>{run(elm,$elm=>{each$d(attrs,(value,name)=>{setAttrib($elm,name,value);});});};var setHTML=(elm,html)=>{run(elm,e=>{var $elm=SugarElement.fromDom(e);set$1($elm,html);});};var add=(parentElm,name,attrs,html,create)=>run(parentElm,parentElm=>{var newElm=isString(name)?doc.createElement(name):name;if(isNonNullable(attrs)){setAttribs(newElm,attrs);}if(html){if(!isString(html)&&html.nodeType){newElm.appendChild(html);}else if(isString(html)){setHTML(newElm,html);}}return!create?parentElm.appendChild(newElm):newElm;});var create=(name,attrs,html)=>add(doc.createElement(name),name,attrs,html,true);var decode=Entities.decode;var encode=Entities.encodeAllRaw;var createHTML=function createHTML(name,attrs){var html=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var outHtml='<'+name;for(var key in attrs){if(hasNonNullableKey(attrs,key)){outHtml+=' '+key+'=\"'+encode(attrs[key])+'\"';}}if(isEmpty$3(html)&&has$2(schema.getVoidElements(),name)){return outHtml+' />';}else{return outHtml+'>'+html+'</'+name+'>';}};var createFragment=html=>{var container=doc.createElement('div');var frag=doc.createDocumentFragment();frag.appendChild(container);if(html){container.innerHTML=html;}var node;while(node=container.firstChild){frag.appendChild(node);}frag.removeChild(container);return frag;};var remove=(node,keepChildren)=>{return run(node,n=>{var $node=SugarElement.fromDom(n);if(keepChildren){each$e(children$1($node),child=>{if(isText$b(child)&&child.dom.length===0){remove$5(child);}else{before$3($node,child);}});}remove$5($node);return $node.dom;});};var removeAllAttribs=e=>run(e,e=>{var attrs=e.attributes;for(var i=attrs.length-1;i>=0;i--){e.removeAttributeNode(attrs.item(i));}});var parseStyle=cssText=>styles.parse(cssText);var serializeStyle=(stylesArg,name)=>styles.serialize(stylesArg,name);var addStyle=cssText=>{if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText]){return;}addedStyles[cssText]=true;}var styleElm=doc.getElementById('mceDefaultStyles');if(!styleElm){styleElm=doc.createElement('style');styleElm.id='mceDefaultStyles';styleElm.type='text/css';var _head=doc.head;if(_head.firstChild){_head.insertBefore(styleElm,_head.firstChild);}else{_head.appendChild(styleElm);}}if(styleElm.styleSheet){styleElm.styleSheet.cssText+=cssText;}else{styleElm.appendChild(doc.createTextNode(cssText));}};var loadCSS=urls=>{if(!urls){urls='';}each$e(urls.split(','),url=>{files[url]=true;styleSheetLoader.load(url).catch(noop);});};var toggleClass=(elm,cls,state)=>{run(elm,e=>{if(isElement$6(e)){var $elm=SugarElement.fromDom(e);var classes=cls.split(' ');each$e(classes,c=>{if(isNonNullable(state)){var fn=state?add$2:remove$7;fn($elm,c);}else{toggle$1($elm,c);}});}});};var addClass=(elm,cls)=>{toggleClass(elm,cls,true);};var removeClass=(elm,cls)=>{toggleClass(elm,cls,false);};var hasClass=(elm,cls)=>{var $elm=_get(elm);var classes=cls.split(' ');return isNonNullable($elm)&&forall(classes,c=>has($elm,c));};var show=elm=>{run(elm,e=>remove$6(SugarElement.fromDom(e),'display'));};var hide=elm=>{run(elm,e=>set$2(SugarElement.fromDom(e),'display','none'));};var isHidden=elm=>{var $elm=_get(elm);return isNonNullable($elm)&&is$2(getRaw($elm,'display'),'none');};var uniqueId=prefix=>(!prefix?'mce_':prefix)+counter++;var getOuterHTML=elm=>{var $elm=_get(elm);if(isNonNullable($elm)){return isElement$6($elm.dom)?$elm.dom.outerHTML:getOuter($elm);}else{return'';}};var setOuterHTML=(elm,html)=>{run(elm,$elm=>{if(isElement$6($elm)){$elm.outerHTML=html;}});};var insertAfter=(node,reference)=>{var referenceNode=get(reference);return run(node,node=>{var parent=referenceNode===null||referenceNode===void 0?void 0:referenceNode.parentNode;var nextSibling=referenceNode===null||referenceNode===void 0?void 0:referenceNode.nextSibling;if(parent){if(nextSibling){parent.insertBefore(node,nextSibling);}else{parent.appendChild(node);}}return node;});};var replace=(newElm,oldElm,keepChildren)=>run(oldElm,elm=>{var _a;var replacee=isArray$1(oldElm)?newElm.cloneNode(true):newElm;if(keepChildren){each$a(grep(elm.childNodes),node=>{replacee.appendChild(node);});}(_a=elm.parentNode)===null||_a===void 0?void 0:_a.replaceChild(replacee,elm);return elm;});var rename=(elm,name)=>{if(elm.nodeName!==name.toUpperCase()){var newElm=create(name);each$a(getAttribs(elm),attrNode=>{setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName));});replace(newElm,elm,true);return newElm;}else{return elm;}};var findCommonAncestor=(a,b)=>{var ps=a;while(ps){var pe=b;while(pe&&ps!==pe){pe=pe.parentNode;}if(ps===pe){break;}ps=ps.parentNode;}if(!ps&&a.ownerDocument){return a.ownerDocument.documentElement;}else{return ps;}};var isNonEmptyElement=node=>{if(isElement$6(node)){var _isNamedAnchor=node.nodeName.toLowerCase()==='a'&&!getAttrib(node,'href')&&getAttrib(node,'id');if(getAttrib(node,'name')||getAttrib(node,'data-mce-bookmark')||_isNamedAnchor){return true;}}return false;};var isEmpty=(node,elements,options)=>{var brCount=0;if(isNonEmptyElement(node)){return false;}var firstChild=node.firstChild;if(firstChild){var walker=new DomTreeWalker(firstChild,node);var whitespaceElements=schema?schema.getWhitespaceElements():{};var nonEmptyElements=elements||(schema?schema.getNonEmptyElements():null);var tempNode=firstChild;do{if(isElement$6(tempNode)){var bogusVal=tempNode.getAttribute('data-mce-bogus');if(bogusVal){tempNode=walker.next(bogusVal==='all');continue;}var _name10=tempNode.nodeName.toLowerCase();if(nonEmptyElements&&nonEmptyElements[_name10]){if(_name10==='br'){brCount++;tempNode=walker.next();continue;}return false;}if(isNonEmptyElement(tempNode)){return false;}}if(isComment(tempNode)){return false;}if(isText$a(tempNode)&&!isWhitespaceText(tempNode.data)&&(!(options===null||options===void 0?void 0:options.includeZwsp)||!isZwsp(tempNode.data))){return false;}if(isText$a(tempNode)&&tempNode.parentNode&&whitespaceElements[tempNode.parentNode.nodeName]&&isWhitespaceText(tempNode.data)){return false;}tempNode=walker.next();}while(tempNode);}return brCount<=1;};var createRng=()=>doc.createRange();var split=(parentElm,splitElm,replacementElm)=>{var range=createRng();var beforeFragment;var afterFragment;if(parentElm&&splitElm&&parentElm.parentNode&&splitElm.parentNode){var parentNode=parentElm.parentNode;range.setStart(parentNode,findNodeIndex(parentElm));range.setEnd(splitElm.parentNode,findNodeIndex(splitElm));beforeFragment=range.extractContents();range=createRng();range.setStart(splitElm.parentNode,findNodeIndex(splitElm)+1);range.setEnd(parentNode,findNodeIndex(parentElm)+1);afterFragment=range.extractContents();parentNode.insertBefore(trimNode(self,beforeFragment),parentElm);if(replacementElm){parentNode.insertBefore(replacementElm,parentElm);}else{parentNode.insertBefore(splitElm,parentElm);}parentNode.insertBefore(trimNode(self,afterFragment),parentElm);remove(parentElm);return replacementElm||splitElm;}else{return undefined;}};var bind=(target,name,func,scope)=>{if(isArray$1(target)){var i=target.length;var rv=[];while(i--){rv[i]=bind(target[i],name,func,scope);}return rv;}else{if(settings.collect&&(target===doc||target===win)){boundEvents.push([target,name,func,scope]);}return events.bind(target,name,func,scope||self);}};var unbind=(target,name,func)=>{if(isArray$1(target)){var i=target.length;var rv=[];while(i--){rv[i]=unbind(target[i],name,func);}return rv;}else{if(boundEvents.length>0&&(target===doc||target===win)){var _i2=boundEvents.length;while(_i2--){var[boundTarget,boundName,boundFunc]=boundEvents[_i2];if(target===boundTarget&&(!name||name===boundName)&&(!func||func===boundFunc)){events.unbind(boundTarget,boundName,boundFunc);}}}return events.unbind(target,name,func);}};var dispatch=(target,name,evt)=>events.dispatch(target,name,evt);var fire=(target,name,evt)=>events.dispatch(target,name,evt);var getContentEditable=node=>{if(node&&isElement$6(node)){var contentEditable=node.getAttribute('data-mce-contenteditable');if(contentEditable&&contentEditable!=='inherit'){return contentEditable;}return node.contentEditable!=='inherit'?node.contentEditable:null;}else{return null;}};var getContentEditableParent=node=>{var root=getRoot();var state=null;for(var tempNode=node;tempNode&&tempNode!==root;tempNode=tempNode.parentNode){state=getContentEditable(tempNode);if(state!==null){break;}}return state;};var isEditable=node=>{if(isNonNullable(node)){var scope=isElement$6(node)?node:node.parentElement;return isNonNullable(scope)&&isEditable$3(SugarElement.fromDom(scope));}else{return false;}};var destroy=()=>{if(boundEvents.length>0){var i=boundEvents.length;while(i--){var[boundTarget,boundName,boundFunc]=boundEvents[i];events.unbind(boundTarget,boundName,boundFunc);}}each$d(files,(_,url)=>{styleSheetLoader.unload(url);delete files[url];});};var isChildOf=(node,parent)=>{return node===parent||parent.contains(node);};var dumpRng=r=>'startContainer: '+r.startContainer.nodeName+', startOffset: '+r.startOffset+', endContainer: '+r.endContainer.nodeName+', endOffset: '+r.endOffset;var self={doc,settings,win,files,stdMode,boxModel,styleSheetLoader,boundEvents,styles,schema,events,isBlock:isBlock,root:null,clone,getRoot,getViewPort,getRect,getSize,getParent,getParents:getParents,get,getNext,getPrev,select,is,add,create,createHTML,createFragment,remove,setStyle,getStyle:getStyle,setStyles,removeAllAttribs,setAttrib,setAttribs,getAttrib,getPos:getPos$1,parseStyle,serializeStyle,addStyle,loadCSS,addClass,removeClass,hasClass,toggleClass,show,hide,isHidden,uniqueId,setHTML,getOuterHTML,setOuterHTML,decode,encode,insertAfter,replace,rename,findCommonAncestor,run,getAttribs,isEmpty,createRng,nodeIndex:findNodeIndex,split,bind:bind,unbind:unbind,fire,dispatch,getContentEditable,getContentEditableParent,isEditable,destroy,isChildOf,dumpRng};var attrHooks=setupAttrHooks(styles,settings,constant(self));return self;};DOMUtils.DOM=DOMUtils(document);DOMUtils.nodeIndex=findNodeIndex;var DOM$b=DOMUtils.DOM;var QUEUED=0;var LOADING=1;var LOADED=2;var FAILED=3;class ScriptLoader{constructor(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.states={};this.queue=[];this.scriptLoadedCallbacks={};this.queueLoadedCallbacks=[];this.loading=false;this.settings=settings;}_setReferrerPolicy(referrerPolicy){this.settings.referrerPolicy=referrerPolicy;}loadScript(url){return new Promise((resolve,reject)=>{var dom=DOM$b;var elm;var cleanup=()=>{dom.remove(id);if(elm){elm.onerror=elm.onload=elm=null;}};var done=()=>{cleanup();resolve();};var error=()=>{cleanup();reject('Failed to load script: '+url);};var id=dom.uniqueId();elm=document.createElement('script');elm.id=id;elm.type='text/javascript';elm.src=Tools._addCacheSuffix(url);if(this.settings.referrerPolicy){dom.setAttrib(elm,'referrerpolicy',this.settings.referrerPolicy);}elm.onload=done;elm.onerror=error;(document.getElementsByTagName('head')[0]||document.body).appendChild(elm);});}isDone(url){return this.states[url]===LOADED;}markDone(url){this.states[url]=LOADED;}add(url){var self=this;self.queue.push(url);var state=self.states[url];if(state===undefined){self.states[url]=QUEUED;}return new Promise((resolve,reject)=>{if(!self.scriptLoadedCallbacks[url]){self.scriptLoadedCallbacks[url]=[];}self.scriptLoadedCallbacks[url].push({resolve,reject});});}load(url){return this.add(url);}remove(url){delete this.states[url];delete this.scriptLoadedCallbacks[url];}loadQueue(){var queue=this.queue;this.queue=[];return this.loadScripts(queue);}loadScripts(scripts){var self=this;var execCallbacks=(name,url)=>{get$a(self.scriptLoadedCallbacks,url).each(callbacks=>{each$e(callbacks,callback=>callback[name](url));});delete self.scriptLoadedCallbacks[url];};var processResults=results=>{var failures=filter$5(results,result=>result.status==='rejected');if(failures.length>0){return Promise.reject(bind$3(failures,_ref5=>{var{reason}=_ref5;return isArray$1(reason)?reason:[reason];}));}else{return Promise.resolve();}};var load=urls=>Promise.allSettled(map$3(urls,url=>{if(self.states[url]===LOADED){execCallbacks('resolve',url);return Promise.resolve();}else if(self.states[url]===FAILED){execCallbacks('reject',url);return Promise.reject(url);}else{self.states[url]=LOADING;return self.loadScript(url).then(()=>{self.states[url]=LOADED;execCallbacks('resolve',url);var queue=self.queue;if(queue.length>0){self.queue=[];return load(queue).then(processResults);}else{return Promise.resolve();}},()=>{self.states[url]=FAILED;execCallbacks('reject',url);return Promise.reject(url);});}}));var processQueue=urls=>{self.loading=true;return load(urls).then(results=>{self.loading=false;var nextQueuedItem=self.queueLoadedCallbacks.shift();Optional.from(nextQueuedItem).each(call);return processResults(results);});};var uniqueScripts=stringArray(scripts);if(self.loading){return new Promise((resolve,reject)=>{self.queueLoadedCallbacks.push(()=>{processQueue(uniqueScripts).then(resolve,reject);});});}else{return processQueue(uniqueScripts);}}}ScriptLoader.ScriptLoader=new ScriptLoader();var Cell=initial=>{var value=initial;var get=()=>{return value;};var set=v=>{value=v;};return{get,set};};var isDuplicated=(items,item)=>{var firstIndex=items.indexOf(item);return firstIndex!==-1&&items.indexOf(item,firstIndex+1)>firstIndex;};var isRaw=str=>isObject(str)&&has$2(str,'raw');var isTokenised=str=>isArray$1(str)&&str.length>1;var data={};var currentCode=Cell('en');var getLanguageData=()=>get$a(data,currentCode.get());var getData$1=()=>map$2(data,value=>_objectSpread({},value));var setCode=newCode=>{if(newCode){currentCode.set(newCode);}};var getCode=()=>currentCode.get();var add$1=(code,items)=>{var langData=data[code];if(!langData){data[code]=langData={};}var lcNames=map$3(keys(items),name=>name.toLowerCase());each$d(items,(translation,name)=>{var lcName=name.toLowerCase();if(lcName!==name&&isDuplicated(lcNames,lcName)){if(!has$2(items,lcName)){langData[lcName]=translation;}langData[name]=translation;}else{langData[lcName]=translation;}});};var translate=text=>{var langData=getLanguageData().getOr({});var toString=obj=>{if(isFunction(obj)){return Object.prototype.toString.call(obj);}return!isEmpty(obj)?''+obj:'';};var isEmpty=text=>text===''||text===null||text===undefined;var getLangData=text=>{var textStr=toString(text);return has$2(langData,textStr)?toString(langData[textStr]):get$a(langData,textStr.toLowerCase()).map(toString).getOr(textStr);};var removeContext=str=>str.replace(/{context:\\w+}$/,'');if(isEmpty(text)){return'';}if(isRaw(text)){return toString(text.raw);}if(isTokenised(text)){var _values=text.slice(1);var substitued=getLangData(text[0]).replace(/\\{([0-9]+)\\}/g,($1,$2)=>has$2(_values,$2)?toString(_values[$2]):$1);return removeContext(substitued);}return removeContext(getLangData(text));};var isRtl$1=()=>getLanguageData().bind(items=>get$a(items,'_dir')).exists(dir=>dir==='rtl');var hasCode=code=>has$2(data,code);var I18n={getData:getData$1,setCode,getCode,add:add$1,translate,isRtl:isRtl$1,hasCode};var AddOnManager=()=>{var items=[];var urls={};var lookup={};var _listeners=[];var runListeners=(name,state)=>{var matchedListeners=filter$5(_listeners,listener=>listener.name===name&&listener.state===state);each$e(matchedListeners,listener=>listener.resolve());};var isLoaded=name=>has$2(urls,name);var isAdded=name=>has$2(lookup,name);var get=name=>{if(lookup[name]){return lookup[name].instance;}return undefined;};var loadLanguagePack=(name,languages)=>{var language=I18n.getCode();var wrappedLanguages=','+(languages||'')+',';if(!language||languages&&wrappedLanguages.indexOf(','+language+',')===-1){return;}ScriptLoader.ScriptLoader.add(urls[name]+'/langs/'+language+'.js');};var requireLangPack=(name,languages)=>{if(AddOnManager.languageLoad!==false){if(isLoaded(name)){loadLanguagePack(name,languages);}else{waitFor(name,'loaded').then(()=>loadLanguagePack(name,languages));}}};var add=(id,addOn)=>{items.push(addOn);lookup[id]={instance:addOn};runListeners(id,'added');return addOn;};var remove=name=>{delete urls[name];delete lookup[name];};var createUrl=(baseUrl,dep)=>{if(isString(dep)){return isString(baseUrl)?{prefix:'',resource:dep,suffix:''}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix};}else{return dep;}};var load=(name,addOnUrl)=>{if(urls[name]){return Promise.resolve();}var urlString=isString(addOnUrl)?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;if(urlString.indexOf('/')!==0&&urlString.indexOf('://')===-1){urlString=AddOnManager.baseURL+'/'+urlString;}urls[name]=urlString.substring(0,urlString.lastIndexOf('/'));var done=()=>{runListeners(name,'loaded');return Promise.resolve();};if(lookup[name]){return done();}else{return ScriptLoader.ScriptLoader.add(urlString).then(done);}};var waitFor=function waitFor(name){var state=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'added';if(state==='added'&&isAdded(name)){return Promise.resolve();}else if(state==='loaded'&&isLoaded(name)){return Promise.resolve();}else{return new Promise(resolve=>{_listeners.push({name,state,resolve});});}};return{items,urls,lookup,get,requireLangPack,add,remove,createUrl,load,waitFor};};AddOnManager.languageLoad=true;AddOnManager.baseURL='';AddOnManager.PluginManager=AddOnManager();AddOnManager.ThemeManager=AddOnManager();AddOnManager.ModelManager=AddOnManager();var singleton=doRevoke=>{var subject=Cell(Optional.none());var revoke=()=>subject.get().each(doRevoke);var clear=()=>{revoke();subject.set(Optional.none());};var isSet=()=>subject.get().isSome();var get=()=>subject.get();var set=s=>{revoke();subject.set(Optional.some(s));};return{clear,isSet,get,set};};var repeatable=delay=>{var intervalId=Cell(Optional.none());var revoke=()=>intervalId.get().each(id=>clearInterval(id));var clear=()=>{revoke();intervalId.set(Optional.none());};var isSet=()=>intervalId.get().isSome();var get=()=>intervalId.get();var set=functionToRepeat=>{revoke();intervalId.set(Optional.some(setInterval(functionToRepeat,delay)));};return{clear,isSet,get,set};};var value$2=()=>{var subject=singleton(noop);var on=f=>subject.get().each(f);return _objectSpread(_objectSpread({},subject),{},{on});};var first$1=(fn,rate)=>{var timer=null;var cancel=()=>{if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7];}if(isNull(timer)){timer=setTimeout(()=>{timer=null;fn.apply(null,args);},rate);}};return{cancel,throttle};};var last$1=(fn,rate)=>{var timer=null;var cancel=()=>{if(!isNull(timer)){clearTimeout(timer);timer=null;}};var throttle=function throttle(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}cancel();timer=setTimeout(()=>{timer=null;fn.apply(null,args);},rate);};return{cancel,throttle};};var annotation=constant('mce-annotation');var dataAnnotation=constant('data-mce-annotation');var dataAnnotationId=constant('data-mce-annotation-uid');var dataAnnotationActive=constant('data-mce-annotation-active');var dataAnnotationClasses=constant('data-mce-annotation-classes');var dataAnnotationAttributes=constant('data-mce-annotation-attrs');var isRoot$1=root=>node=>eq(node,root);var identify=(editor,annotationName)=>{var rng=editor.selection.getRng();var start=SugarElement.fromDom(rng.startContainer);var root=SugarElement.fromDom(editor.getBody());var selector=annotationName.fold(()=>'.'+annotation(),an=>\"[\".concat(dataAnnotation(),\"=\\\"\").concat(an,\"\\\"]\"));var newStart=child$1(start,rng.startOffset).getOr(start);var closest=closest$3(newStart,selector,isRoot$1(root));return closest.bind(c=>getOpt(c,\"\".concat(dataAnnotationId())).bind(uid=>getOpt(c,\"\".concat(dataAnnotation())).map(name=>{var elements=findMarkers(editor,uid);return{uid,name,elements};})));};var isAnnotation=elem=>isElement$7(elem)&&has(elem,annotation());var isBogusElement=(elem,root)=>has$1(elem,'data-mce-bogus')||ancestor$2(elem,'[data-mce-bogus=\"all\"]',isRoot$1(root));var findMarkers=(editor,uid)=>{var body=SugarElement.fromDom(editor.getBody());var descendants$1=descendants(body,\"[\".concat(dataAnnotationId(),\"=\\\"\").concat(uid,\"\\\"]\"));return filter$5(descendants$1,descendant=>!isBogusElement(descendant,body));};var findAll=(editor,name)=>{var body=SugarElement.fromDom(editor.getBody());var markers=descendants(body,\"[\".concat(dataAnnotation(),\"=\\\"\").concat(name,\"\\\"]\"));var directory={};each$e(markers,m=>{if(!isBogusElement(m,body)){var _uid=get$9(m,dataAnnotationId());var nodesAlready=get$a(directory,_uid).getOr([]);directory[_uid]=nodesAlready.concat([m]);}});return directory;};var setup$x=(editor,registry)=>{var changeCallbacks=Cell({});var initData=()=>({listeners:[],previous:value$2()});var withCallbacks=(name,f)=>{updateCallbacks(name,data=>{f(data);return data;});};var updateCallbacks=(name,f)=>{var callbackMap=changeCallbacks.get();var data=get$a(callbackMap,name).getOrThunk(initData);var outputData=f(data);callbackMap[name]=outputData;changeCallbacks.set(callbackMap);};var fireCallbacks=(name,uid,elements)=>{withCallbacks(name,data=>{each$e(data.listeners,f=>f(true,name,{uid,nodes:map$3(elements,elem=>elem.dom)}));});};var fireNoAnnotation=name=>{withCallbacks(name,data=>{each$e(data.listeners,f=>f(false,name));});};var toggleActiveAttr=(uid,state)=>{each$e(findMarkers(editor,uid),elem=>{if(state){set$3(elem,dataAnnotationActive(),'true');}else{remove$a(elem,dataAnnotationActive());}});};var onNodeChange=last$1(()=>{var annotations=sort(registry.getNames());each$e(annotations,name=>{updateCallbacks(name,data=>{var prev=data.previous.get();identify(editor,Optional.some(name)).fold(()=>{prev.each(uid=>{fireNoAnnotation(name);data.previous.clear();toggleActiveAttr(uid,false);});},_ref6=>{var{uid,name,elements}=_ref6;if(!is$2(prev,uid)){prev.each(uid=>toggleActiveAttr(uid,false));fireCallbacks(name,uid,elements);data.previous.set(uid);toggleActiveAttr(uid,true);}});return{previous:data.previous,listeners:data.listeners};});});},30);editor.on('remove',()=>{onNodeChange.cancel();});editor.on('NodeChange',()=>{onNodeChange.throttle();});var addListener=(name,f)=>{updateCallbacks(name,data=>({previous:data.previous,listeners:data.listeners.concat([f])}));};return{addListener};};var setup$w=(editor,registry)=>{var dataAnnotation$1=dataAnnotation();var identifyParserNode=node=>Optional.from(node.attr(dataAnnotation$1)).bind(registry.lookup);var removeDirectAnnotation=node=>{var _a,_b;node.attr(dataAnnotationId(),null);node.attr(dataAnnotation(),null);node.attr(dataAnnotationActive(),null);var customAttrNames=Optional.from(node.attr(dataAnnotationAttributes())).map(names=>names.split(',')).getOr([]);var customClasses=Optional.from(node.attr(dataAnnotationClasses())).map(names=>names.split(',')).getOr([]);each$e(customAttrNames,name=>node.attr(name,null));var classList=(_b=(_a=node.attr('class'))===null||_a===void 0?void 0:_a.split(' '))!==null&&_b!==void 0?_b:[];var newClassList=difference(classList,[annotation()].concat(customClasses));node.attr('class',newClassList.length>0?newClassList.join(' '):null);node.attr(dataAnnotationClasses(),null);node.attr(dataAnnotationAttributes(),null);};editor.serializer.addTempAttr(dataAnnotationActive());editor.serializer.addAttributeFilter(dataAnnotation$1,nodes=>{var _loop=function _loop(node){identifyParserNode(node).each(settings=>{if(settings.persistent===false){if(node.name==='span'){node.unwrap();}else{removeDirectAnnotation(node);}}});};for(var node of nodes){_loop(node);}});};var create$c=()=>{var annotations={};var register=(name,settings)=>{annotations[name]={name,settings};};var lookup=name=>get$a(annotations,name).map(a=>a.settings);var getNames=()=>keys(annotations);return{register,lookup,getNames};};var unique=0;var generate$1=prefix=>{var date=new Date();var time=date.getTime();var random=Math.floor(Math.random()*1000000000);unique++;return prefix+'_'+random+unique+String(time);};var add=(element,classes)=>{each$e(classes,x=>{add$2(element,x);});};var remove$4=(element,classes)=>{each$e(classes,x=>{remove$7(element,x);});};var clone$2=(original,isDeep)=>SugarElement.fromDom(original.dom.cloneNode(isDeep));var shallow$1=original=>clone$2(original,false);var deep$1=original=>clone$2(original,true);var shallowAs=(original,tag)=>{var nu=SugarElement.fromTag(tag);var attributes=clone$4(original);setAll$1(nu,attributes);return nu;};var mutate=(original,tag)=>{var nu=shallowAs(original,tag);after$4(original,nu);var children=children$1(original);append(nu,children);remove$5(original);return nu;};var TextWalker=function TextWalker(startNode,rootNode){var isBoundary=arguments.length>2&&arguments[2]!==undefined?arguments[2]:never;var walker=new DomTreeWalker(startNode,rootNode);var walk=direction=>{var next;do{next=walker[direction]();}while(next&&!isText$a(next)&&!isBoundary(next));return Optional.from(next).filter(isText$a);};return{current:()=>Optional.from(walker.current()).filter(isText$a),next:()=>walk('next'),prev:()=>walk('prev'),prev2:()=>walk('prev2')};};var TextSeeker=(dom,isBoundary)=>{var isBlockBoundary=isBoundary?isBoundary:node=>dom.isBlock(node)||isBr$6(node)||isContentEditableFalse$b(node);var walk=(node,offset,walker,process)=>{if(isText$a(node)){var newOffset=process(node,offset,node.data);if(newOffset!==-1){return Optional.some({container:node,offset:newOffset});}}return walker().bind(next=>walk(next.container,next.offset,walker,process));};var backwards=(node,offset,process,root)=>{var walker=TextWalker(node,root!==null&&root!==void 0?root:dom.getRoot(),isBlockBoundary);return walk(node,offset,()=>walker.prev().map(prev=>({container:prev,offset:prev.length})),process).getOrNull();};var forwards=(node,offset,process,root)=>{var walker=TextWalker(node,root!==null&&root!==void 0?root:dom.getRoot(),isBlockBoundary);return walk(node,offset,()=>walker.next().map(next=>({container:next,offset:0})),process).getOrNull();};return{backwards,forwards};};var round$2=Math.round;var clone$1=rect=>{if(!rect){return{left:0,top:0,bottom:0,right:0,width:0,height:0};}return{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)};};var collapse=(rect,toStart)=>{rect=clone$1(rect);if(toStart){rect.right=rect.left;}else{rect.left=rect.left+rect.width;rect.right=rect.left;}rect.width=0;return rect;};var isEqual=(rect1,rect2)=>rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right;var isValidOverflow=(overflowY,rect1,rect2)=>overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2;var isAbove$1=(rect1,rect2)=>{var halfHeight=Math.min(rect2.height/2,rect1.height/2);if(rect1.bottom-halfHeight<rect2.top){return true;}if(rect1.top>rect2.bottom){return false;}return isValidOverflow(rect2.top-rect1.bottom,rect1,rect2);};var isBelow$1=(rect1,rect2)=>{if(rect1.top>rect2.bottom){return true;}if(rect1.bottom<rect2.top){return false;}return isValidOverflow(rect2.bottom-rect1.top,rect1,rect2);};var containsXY=(rect,clientX,clientY)=>clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom;var boundingClientRectFromRects=rects=>{return foldl(rects,(acc,rect)=>{return acc.fold(()=>Optional.some(rect),prevRect=>{var left=Math.min(rect.left,prevRect.left);var top=Math.min(rect.top,prevRect.top);var right=Math.max(rect.right,prevRect.right);var bottom=Math.max(rect.bottom,prevRect.bottom);return Optional.some({top,right,bottom,left,width:right-left,height:bottom-top});});},Optional.none());};var distanceToRectEdgeFromXY=(rect,x,y)=>{var cx=Math.max(Math.min(x,rect.left+rect.width),rect.left);var cy=Math.max(Math.min(y,rect.top+rect.height),rect.top);return Math.sqrt((x-cx)*(x-cx)+(y-cy)*(y-cy));};var overlapY=(r1,r2)=>Math.max(0,Math.min(r1.bottom,r2.bottom)-Math.max(r1.top,r2.top));var clamp$2=(value,min,max)=>Math.min(Math.max(value,min),max);var getSelectedNode=range=>{var startContainer=range.startContainer,startOffset=range.startOffset;if(startContainer===range.endContainer&&startContainer.hasChildNodes()&&range.endOffset===startOffset+1){return startContainer.childNodes[startOffset];}return null;};var getNode$1=(container,offset)=>{if(isElement$6(container)&&container.hasChildNodes()){var childNodes=container.childNodes;var safeOffset=clamp$2(offset,0,childNodes.length-1);return childNodes[safeOffset];}else{return container;}};var getNodeUnsafe=(container,offset)=>{if(offset<0&&isElement$6(container)&&container.hasChildNodes()){return undefined;}else{return getNode$1(container,offset);}};var extendingChars=new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a'+'\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0'+'\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e3-\\u0902\\u093a\\u093c'+'\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3'+'\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc'+'\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57'+'\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56'+'\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44'+'\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9'+'\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97'+'\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074'+'\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5'+'\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18'+'\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34'+'\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9'+'\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9'+'\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1'+'\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\ua69e-\\ua69f\\ua6f0-\\ua6f1'+'\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc'+'\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1'+'\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe2f\\uff9e-\\uff9f]');var isExtendingChar=ch=>isString(ch)&&ch.charCodeAt(0)>=768&&extendingChars.test(ch);var or=function or(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9];}return x=>{for(var i=0;i<args.length;i++){if(args[i](x)){return true;}}return false;};};var and=function and(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++){args[_key10]=arguments[_key10];}return x=>{for(var i=0;i<args.length;i++){if(!args[i](x)){return false;}}return true;};};var isElement$4=isElement$6;var isCaretCandidate$2=isCaretCandidate$3;var isBlock$1=matchStyleValues('display','block table');var isFloated=matchStyleValues('float','left right');var isValidElementCaretCandidate=and(isElement$4,isCaretCandidate$2,not(isFloated));var isNotPre=not(matchStyleValues('white-space','pre pre-line pre-wrap'));var isText$7=isText$a;var isBr$3=isBr$6;var nodeIndex$1=DOMUtils.nodeIndex;var resolveIndex$1=getNodeUnsafe;var createRange$1=doc=>doc?doc.createRange():DOMUtils.DOM.createRng();var isWhiteSpace$1=chr=>isString(chr)&&/[\\r\\n\\t ]/.test(chr);var isRange=rng=>!!rng.setStart&&!!rng.setEnd;var isHiddenWhiteSpaceRange=range=>{var container=range.startContainer;var offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$a(container)){var _text=container.data;if(isWhiteSpace$1(_text[offset-1])||isWhiteSpace$1(_text[offset+1])){return true;}}return false;};var getBrClientRect=brNode=>{var doc=brNode.ownerDocument;var rng=createRange$1(doc);var nbsp$1=doc.createTextNode(nbsp);var parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode);rng.setStart(nbsp$1,0);rng.setEnd(nbsp$1,1);var clientRect=clone$1(rng.getBoundingClientRect());parentNode.removeChild(nbsp$1);return clientRect;};var getBoundingClientRectWebKitText=rng=>{var sc=rng.startContainer;var ec=rng.endContainer;var so=rng.startOffset;var eo=rng.endOffset;if(sc===ec&&isText$a(ec)&&so===0&&eo===1){var newRng=rng.cloneRange();newRng.setEndAfter(ec);return getBoundingClientRect$1(newRng);}else{return null;}};var isZeroRect=r=>r.left===0&&r.right===0&&r.top===0&&r.bottom===0;var getBoundingClientRect$1=item=>{var _a;var clientRect;var clientRects=item.getClientRects();if(clientRects.length>0){clientRect=clone$1(clientRects[0]);}else{clientRect=clone$1(item.getBoundingClientRect());}if(!isRange(item)&&isBr$3(item)&&isZeroRect(clientRect)){return getBrClientRect(item);}if(isZeroRect(clientRect)&&isRange(item)){return(_a=getBoundingClientRectWebKitText(item))!==null&&_a!==void 0?_a:clientRect;}return clientRect;};var collapseAndInflateWidth=(clientRect,toStart)=>{var newClientRect=collapse(clientRect,toStart);newClientRect.width=1;newClientRect.right=newClientRect.left+1;return newClientRect;};var getCaretPositionClientRects=caretPosition=>{var clientRects=[];var addUniqueAndValidRect=clientRect=>{if(clientRect.height===0){return;}if(clientRects.length>0){if(isEqual(clientRect,clientRects[clientRects.length-1])){return;}}clientRects.push(clientRect);};var addCharacterOffset=(container,offset)=>{var range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset])){return;}if(isExtendingChar(container.data[offset-1])){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),false));return;}}}if(offset>0){range.setStart(container,offset-1);range.setEnd(container,offset);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),false));}}if(offset<container.data.length){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),true));}}};var container=caretPosition.container();var offset=caretPosition.offset();if(isText$7(container)){addCharacterOffset(container,offset);return clientRects;}if(isElement$4(container)){if(caretPosition.isAtEnd()){var node=resolveIndex$1(container,offset);if(isText$7(node)){addCharacterOffset(node,node.data.length);}if(isValidElementCaretCandidate(node)&&!isBr$3(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),false));}}else{var _node2=resolveIndex$1(container,offset);if(isText$7(_node2)){addCharacterOffset(_node2,0);}if(isValidElementCaretCandidate(_node2)&&caretPosition.isAtEnd()){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(_node2),false));return clientRects;}var beforeNode=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);if(isValidElementCaretCandidate(beforeNode)&&!isBr$3(beforeNode)){if(isBlock$1(beforeNode)||isBlock$1(_node2)||!isValidElementCaretCandidate(_node2)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(beforeNode),false));}}if(isValidElementCaretCandidate(_node2)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(_node2),true));}}}return clientRects;};var CaretPosition=(container,offset,clientRects)=>{var isAtStart=()=>{if(isText$7(container)){return offset===0;}return offset===0;};var isAtEnd=()=>{if(isText$7(container)){return offset>=container.data.length;}return offset>=container.childNodes.length;};var toRange=()=>{var range=createRange$1(container.ownerDocument);range.setStart(container,offset);range.setEnd(container,offset);return range;};var getClientRects=()=>{if(!clientRects){clientRects=getCaretPositionClientRects(CaretPosition(container,offset));}return clientRects;};var isVisible=()=>getClientRects().length>0;var isEqual=caretPosition=>caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset();var getNode=before=>resolveIndex$1(container,before?offset-1:offset);return{container:constant(container),offset:constant(offset),toRange,getClientRects,isVisible,isAtStart,isAtEnd,isEqual,getNode};};CaretPosition.fromRangeStart=range=>CaretPosition(range.startContainer,range.startOffset);CaretPosition.fromRangeEnd=range=>CaretPosition(range.endContainer,range.endOffset);CaretPosition.after=node=>CaretPosition(node.parentNode,nodeIndex$1(node)+1);CaretPosition.before=node=>CaretPosition(node.parentNode,nodeIndex$1(node));CaretPosition.isAbove=(pos1,pos2)=>lift2(head(pos2.getClientRects()),last$3(pos1.getClientRects()),isAbove$1).getOr(false);CaretPosition.isBelow=(pos1,pos2)=>lift2(last$3(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(false);CaretPosition.isAtStart=pos=>pos?pos.isAtStart():false;CaretPosition.isAtEnd=pos=>pos?pos.isAtEnd():false;CaretPosition.isTextPosition=pos=>pos?isText$a(pos.container()):false;CaretPosition.isElementPosition=pos=>!CaretPosition.isTextPosition(pos);var trimEmptyTextNode$1=(dom,node)=>{if(isText$a(node)&&node.data.length===0){dom.remove(node);}};var insertNode=(dom,rng,node)=>{rng.insertNode(node);trimEmptyTextNode$1(dom,node.previousSibling);trimEmptyTextNode$1(dom,node.nextSibling);};var insertFragment=(dom,rng,frag)=>{var firstChild=Optional.from(frag.firstChild);var lastChild=Optional.from(frag.lastChild);rng.insertNode(frag);firstChild.each(child=>trimEmptyTextNode$1(dom,child.previousSibling));lastChild.each(child=>trimEmptyTextNode$1(dom,child.nextSibling));};var rangeInsertNode=(dom,rng,node)=>{if(isDocumentFragment(node)){insertFragment(dom,rng,node);}else{insertNode(dom,rng,node);}};var isText$6=isText$a;var isBogus=isBogus$2;var nodeIndex=DOMUtils.nodeIndex;var normalizedParent=node=>{var parentNode=node.parentNode;if(isBogus(parentNode)){return normalizedParent(parentNode);}return parentNode;};var getChildNodes=node=>{if(!node){return[];}return reduce(node.childNodes,(result,node)=>{if(isBogus(node)&&node.nodeName!=='BR'){result=result.concat(getChildNodes(node));}else{result.push(node);}return result;},[]);};var normalizedTextOffset=(node,offset)=>{var tempNode=node;while(tempNode=tempNode.previousSibling){if(!isText$6(tempNode)){break;}offset+=tempNode.data.length;}return offset;};var equal=a=>b=>a===b;var normalizedNodeIndex=node=>{var nodes,index;nodes=getChildNodes(normalizedParent(node));index=findIndex$1(nodes,equal(node),node);nodes=nodes.slice(0,index+1);var numTextFragments=reduce(nodes,(result,node,i)=>{if(isText$6(node)&&isText$6(nodes[i-1])){result++;}return result;},0);nodes=filter$3(nodes,matchNodeNames([node.nodeName]));index=findIndex$1(nodes,equal(node),node);return index-numTextFragments;};var createPathItem=node=>{var name=isText$6(node)?'text()':node.nodeName.toLowerCase();return name+'['+normalizedNodeIndex(node)+']';};var parentsUntil$1=(root,node,predicate)=>{var parents=[];for(var tempNode=node.parentNode;tempNode&&tempNode!==root;tempNode=tempNode.parentNode){if(predicate&&predicate(tempNode)){break;}parents.push(tempNode);}return parents;};var create$b=(root,caretPosition)=>{var path=[];var container=caretPosition.container();var offset=caretPosition.offset();var outputOffset;if(isText$6(container)){outputOffset=normalizedTextOffset(container,offset);}else{var childNodes=container.childNodes;if(offset>=childNodes.length){outputOffset='after';offset=childNodes.length-1;}else{outputOffset='before';}container=childNodes[offset];}path.push(createPathItem(container));var parents=parentsUntil$1(root,container);parents=filter$3(parents,not(isBogus$2));path=path.concat(map$1(parents,node=>{return createPathItem(node);}));return path.reverse().join('/')+','+outputOffset;};var resolvePathItem=(node,name,index)=>{var nodes=getChildNodes(node);nodes=filter$3(nodes,(node,index)=>{return!isText$6(node)||!isText$6(nodes[index-1]);});nodes=filter$3(nodes,matchNodeNames([name]));return nodes[index];};var findTextPosition=(container,offset)=>{var node=container;var targetOffset=0;while(isText$6(node)){var dataLen=node.data.length;if(offset>=targetOffset&&offset<=targetOffset+dataLen){container=node;offset=offset-targetOffset;break;}if(!isText$6(node.nextSibling)){container=node;offset=dataLen;break;}targetOffset+=dataLen;node=node.nextSibling;}if(isText$6(container)&&offset>container.data.length){offset=container.data.length;}return CaretPosition(container,offset);};var resolve$1=(root,path)=>{if(!path){return null;}var parts=path.split(',');var paths=parts[0].split('/');var offset=parts.length>1?parts[1]:'before';var container=reduce(paths,(result,value)=>{var match=/([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);if(!match){return null;}if(match[1]==='text()'){match[1]='#text';}return resolvePathItem(result,match[1],parseInt(match[2],10));},root);if(!container){return null;}if(!isText$6(container)&&container.parentNode){var nodeOffset;if(offset==='after'){nodeOffset=nodeIndex(container)+1;}else{nodeOffset=nodeIndex(container);}return CaretPosition(container.parentNode,nodeOffset);}return findTextPosition(container,parseInt(offset,10));};var isContentEditableFalse$9=isContentEditableFalse$b;var getNormalizedTextOffset$1=(trim,container,offset)=>{var trimmedOffset=trim(container.data.slice(0,offset)).length;for(var node=container.previousSibling;node&&isText$a(node);node=node.previousSibling){trimmedOffset+=trim(node.data).length;}return trimmedOffset;};var getPoint=(dom,trim,normalized,rng,start)=>{var container=start?rng.startContainer:rng.endContainer;var offset=start?rng.startOffset:rng.endOffset;var point=[];var root=dom.getRoot();if(isText$a(container)){point.push(normalized?getNormalizedTextOffset$1(trim,container,offset):offset);}else{var _after=0;var childNodes=container.childNodes;if(offset>=childNodes.length&&childNodes.length){_after=1;offset=Math.max(0,childNodes.length-1);}point.push(dom.nodeIndex(childNodes[offset],normalized)+_after);}for(var node=container;node&&node!==root;node=node.parentNode){point.push(dom.nodeIndex(node,normalized));}return point;};var getLocation=(trim,selection,normalized,rng)=>{var dom=selection.dom;var start=getPoint(dom,trim,normalized,rng,true);var forward=selection.isForward();var fakeCaret=isRangeInCaretContainerBlock(rng)?{isFakeCaret:true}:{};if(!selection.isCollapsed()){var _end=getPoint(dom,trim,normalized,rng,false);return _objectSpread({start,end:_end,forward},fakeCaret);}else{return _objectSpread({start,forward},fakeCaret);}};var findIndex=(dom,name,element)=>{var count=0;Tools.each(dom.select(name),node=>{if(node.getAttribute('data-mce-bogus')==='all'){return;}else if(node===element){return false;}else{count++;return;}});return count;};var moveEndPoint$1=(rng,start)=>{var container=start?rng.startContainer:rng.endContainer;var offset=start?rng.startOffset:rng.endOffset;if(isElement$6(container)&&container.nodeName==='TR'){var childNodes=container.childNodes;container=childNodes[Math.min(start?offset:offset-1,childNodes.length-1)];if(container){offset=start?0:container.childNodes.length;if(start){rng.setStart(container,offset);}else{rng.setEnd(container,offset);}}}};var normalizeTableCellSelection=rng=>{moveEndPoint$1(rng,true);moveEndPoint$1(rng,false);return rng;};var findSibling=(node,offset)=>{if(isElement$6(node)){node=getNode$1(node,offset);if(isContentEditableFalse$9(node)){return node;}}if(isCaretContainer$2(node)){if(isText$a(node)&&isCaretContainerBlock$1(node)){node=node.parentNode;}var _sibling5=node.previousSibling;if(isContentEditableFalse$9(_sibling5)){return _sibling5;}_sibling5=node.nextSibling;if(isContentEditableFalse$9(_sibling5)){return _sibling5;}}return undefined;};var findAdjacentContentEditableFalseElm=rng=>{return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset);};var getOffsetBookmark=(trim,normalized,selection)=>{var element=selection.getNode();var rng=selection.getRng();if(element.nodeName==='IMG'||isContentEditableFalse$9(element)){var _name11=element.nodeName;return{name:_name11,index:findIndex(selection.dom,_name11,element)};}var sibling=findAdjacentContentEditableFalseElm(rng);if(sibling){var _name12=sibling.tagName;return{name:_name12,index:findIndex(selection.dom,_name12,sibling)};}return getLocation(trim,selection,normalized,rng);};var getCaretBookmark=selection=>{var rng=selection.getRng();return{start:create$b(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$b(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng)),forward:selection.isForward()};};var getRangeBookmark=selection=>{return{rng:selection.getRng(),forward:selection.isForward()};};var createBookmarkSpan=(dom,id,filled)=>{var args={'data-mce-type':'bookmark',id,'style':'overflow:hidden;line-height:0px'};return filled?dom.create('span',args,'&#xFEFF;'):dom.create('span',args);};var getPersistentBookmark=(selection,filled)=>{var dom=selection.dom;var rng=selection.getRng();var id=dom.uniqueId();var collapsed=selection.isCollapsed();var element=selection.getNode();var name=element.nodeName;var forward=selection.isForward();if(name==='IMG'){return{name,index:findIndex(dom,name,element)};}var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(false);var endBookmarkNode=createBookmarkSpan(dom,id+'_end',filled);rangeInsertNode(dom,rng2,endBookmarkNode);}rng=normalizeTableCellSelection(rng);rng.collapse(true);var startBookmarkNode=createBookmarkSpan(dom,id+'_start',filled);rangeInsertNode(dom,rng,startBookmarkNode);selection.moveToBookmark({id,keep:true,forward});return{id,forward};};var getBookmark$2=function getBookmark$2(selection,type){var normalized=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(type===2){return getOffsetBookmark(trim$1,normalized,selection);}else if(type===3){return getCaretBookmark(selection);}else if(type){return getRangeBookmark(selection);}else{return getPersistentBookmark(selection,false);}};var getUndoBookmark=curry(getOffsetBookmark,identity,true);var value$1=value=>{var applyHelper=fn=>fn(value);var constHelper=constant(value);var outputHelper=()=>output;var output={tag:true,inner:value,fold:(_onError,onValue)=>onValue(value),isValue:always,isError:never,map:mapper=>Result.value(mapper(value)),mapError:outputHelper,bind:applyHelper,exists:applyHelper,forall:applyHelper,getOr:constHelper,or:outputHelper,getOrThunk:constHelper,orThunk:outputHelper,getOrDie:constHelper,each:fn=>{fn(value);},toOptional:()=>Optional.some(value)};return output;};var error=error=>{var outputHelper=()=>output;var output={tag:false,inner:error,fold:(onError,_onValue)=>onError(error),isValue:never,isError:always,map:outputHelper,mapError:mapper=>Result.error(mapper(error)),bind:outputHelper,exists:never,forall:always,getOr:identity,or:identity,getOrThunk:apply$1,orThunk:apply$1,getOrDie:die(String(error)),each:noop,toOptional:Optional.none};return output;};var fromOption=(optional,err)=>optional.fold(()=>error(err),value$1);var Result={value:value$1,error,fromOption};var generate=cases=>{if(!isArray$1(cases)){throw new Error('cases must be an array');}if(cases.length===0){throw new Error('there must be at least one case');}var constructors=[];var adt={};each$e(cases,(acase,count)=>{var keys$1=keys(acase);if(keys$1.length!==1){throw new Error('one and only one name per case');}var key=keys$1[0];var value=acase[key];if(adt[key]!==undefined){throw new Error('duplicate key detected:'+key);}else if(key==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!isArray$1(value)){throw new Error('case arguments must be an array');}constructors.push(key);adt[key]=function(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++){args[_key11]=arguments[_key11];}var argLength=args.length;if(argLength!==value.length){throw new Error('Wrong number of arguments to case '+key+'. Expected '+value.length+' ('+value+'), got '+argLength);}var match=branches=>{var branchKeys=keys(branches);if(constructors.length!==branchKeys.length){throw new Error('Wrong number of arguments to match. Expected: '+constructors.join(',')+'\\nActual: '+branchKeys.join(','));}var allReqd=forall(constructors,reqKey=>{return contains$2(branchKeys,reqKey);});if(!allReqd){throw new Error('Not all branches were specified when using match. Specified: '+branchKeys.join(', ')+'\\nRequired: '+constructors.join(', '));}return branches[key].apply(null,args);};return{fold:function fold(){for(var _len12=arguments.length,foldArgs=new Array(_len12),_key12=0;_key12<_len12;_key12++){foldArgs[_key12]=arguments[_key12];}if(foldArgs.length!==cases.length){throw new Error('Wrong number of arguments to fold. Expected '+cases.length+', got '+foldArgs.length);}var target=foldArgs[count];return target.apply(null,args);},match,log:label=>{console.log(label,{constructors,constructor:key,params:args});}};};});return adt;};var Adt={generate};Adt.generate([{bothErrors:['error1','error2']},{firstError:['error1','value2']},{secondError:['value1','error2']},{bothValues:['value1','value2']}]);var partition$1=results=>{var errors=[];var values=[];each$e(results,result=>{result.fold(err=>{errors.push(err);},value=>{values.push(value);});});return{errors,values};};var isInlinePattern=pattern=>pattern.type==='inline-command'||pattern.type==='inline-format';var isBlockPattern=pattern=>pattern.type==='block-command'||pattern.type==='block-format';var normalizePattern=pattern=>{var err=message=>Result.error({message,pattern});var formatOrCmd=(name,onFormat,onCommand)=>{if(pattern.format!==undefined){var formats;if(isArray$1(pattern.format)){if(!forall(pattern.format,isString)){return err(name+' pattern has non-string items in the `format` array');}formats=pattern.format;}else if(isString(pattern.format)){formats=[pattern.format];}else{return err(name+' pattern has non-string `format` parameter');}return Result.value(onFormat(formats));}else if(pattern.cmd!==undefined){if(!isString(pattern.cmd)){return err(name+' pattern has non-string `cmd` parameter');}return Result.value(onCommand(pattern.cmd,pattern.value));}else{return err(name+' pattern is missing both `format` and `cmd` parameters');}};if(!isObject(pattern)){return err('Raw pattern is not an object');}if(!isString(pattern.start)){return err('Raw pattern is missing `start` parameter');}if(pattern.end!==undefined){if(!isString(pattern.end)){return err('Inline pattern has non-string `end` parameter');}if(pattern.start.length===0&&pattern.end.length===0){return err('Inline pattern has empty `start` and `end` parameters');}var _start=pattern.start;var _end2=pattern.end;if(_end2.length===0){_end2=_start;_start='';}return formatOrCmd('Inline',format=>({type:'inline-format',start:_start,end:_end2,format}),(cmd,value)=>({type:'inline-command',start:_start,end:_end2,cmd,value}));}else if(pattern.replacement!==undefined){if(!isString(pattern.replacement)){return err('Replacement pattern has non-string `replacement` parameter');}if(pattern.start.length===0){return err('Replacement pattern has empty `start` parameter');}return Result.value({type:'inline-command',start:'',end:pattern.start,cmd:'mceInsertContent',value:pattern.replacement});}else{if(pattern.start.length===0){return err('Block pattern has empty `start` parameter');}return formatOrCmd('Block',formats=>({type:'block-format',start:pattern.start,format:formats[0]}),(command,commandValue)=>({type:'block-command',start:pattern.start,cmd:command,value:commandValue}));}};var getBlockPatterns=patterns=>filter$5(patterns,isBlockPattern);var getInlinePatterns=patterns=>filter$5(patterns,isInlinePattern);var createPatternSet=(patterns,dynamicPatternsLookup)=>({inlinePatterns:getInlinePatterns(patterns),blockPatterns:getBlockPatterns(patterns),dynamicPatternsLookup});var fromRawPatterns=patterns=>{var normalized=partition$1(map$3(patterns,normalizePattern));each$e(normalized.errors,err=>console.error(err.message,err.pattern));return normalized.values;};var fromRawPatternsLookup=lookupFn=>{return ctx=>{var rawPatterns=lookupFn(ctx);return fromRawPatterns(rawPatterns);};};var deviceDetection$1=detect$2().deviceType;var isTouch=deviceDetection$1.isTouch();var DOM$a=DOMUtils.DOM;var getHash=value=>{var items=value.indexOf('=')>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(',');return foldl(items,(output,item)=>{var arr=item.split('=');var key=arr[0];var val=arr.length>1?arr[1]:key;output[trim$3(key)]=trim$3(val);return output;},{});};var isRegExp=x=>is$4(x,RegExp);var option=name=>editor=>editor.options.get(name);var stringOrObjectProcessor=value=>isString(value)||isObject(value);var bodyOptionProcessor=function bodyOptionProcessor(editor){var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';return value=>{var valid=isString(value);if(valid){if(value.indexOf('=')!==-1){var bodyObj=getHash(value);return{value:get$a(bodyObj,editor.id).getOr(defaultValue),valid};}else{return{value,valid};}}else{return{valid:false,message:'Must be a string.'};}};};var register$7=editor=>{var registerOption=editor.options.register;registerOption('id',{processor:'string',default:editor.id});registerOption('selector',{processor:'string'});registerOption('target',{processor:'object'});registerOption('suffix',{processor:'string'});registerOption('cache_suffix',{processor:'string'});registerOption('base_url',{processor:'string'});registerOption('referrer_policy',{processor:'string',default:''});registerOption('language_load',{processor:'boolean',default:true});registerOption('inline',{processor:'boolean',default:false});registerOption('iframe_attrs',{processor:'object',default:{}});registerOption('doctype',{processor:'string',default:'<!DOCTYPE html>'});registerOption('document_base_url',{processor:'string',default:editor.documentBaseUrl});registerOption('body_id',{processor:bodyOptionProcessor(editor,'tinymce'),default:'tinymce'});registerOption('body_class',{processor:bodyOptionProcessor(editor),default:''});registerOption('content_security_policy',{processor:'string',default:''});registerOption('br_in_pre',{processor:'boolean',default:true});registerOption('forced_root_block',{processor:value=>{var valid=isString(value)&&isNotEmpty(value);if(valid){return{value,valid};}else{return{valid:false,message:'Must be a non-empty string.'};}},default:'p'});registerOption('forced_root_block_attrs',{processor:'object',default:{}});registerOption('newline_behavior',{processor:value=>{var valid=contains$2(['block','linebreak','invert','default'],value);return valid?{value,valid}:{valid:false,message:'Must be one of: block, linebreak, invert or default.'};},default:'default'});registerOption('br_newline_selector',{processor:'string',default:'.mce-toc h2,figcaption,caption'});registerOption('no_newline_selector',{processor:'string',default:''});registerOption('keep_styles',{processor:'boolean',default:true});registerOption('end_container_on_empty_block',{processor:value=>{if(isBoolean(value)){return{valid:true,value};}else if(isString(value)){return{valid:true,value};}else{return{valid:false,message:'Must be boolean or a string'};}},default:'blockquote'});registerOption('font_size_style_values',{processor:'string',default:'xx-small,x-small,small,medium,large,x-large,xx-large'});registerOption('font_size_legacy_values',{processor:'string',default:'xx-small,small,medium,large,x-large,xx-large,300%'});registerOption('font_size_classes',{processor:'string',default:''});registerOption('automatic_uploads',{processor:'boolean',default:true});registerOption('images_reuse_filename',{processor:'boolean',default:false});registerOption('images_replace_blob_uris',{processor:'boolean',default:true});registerOption('icons',{processor:'string',default:''});registerOption('icons_url',{processor:'string',default:''});registerOption('images_upload_url',{processor:'string',default:''});registerOption('images_upload_base_path',{processor:'string',default:''});registerOption('images_upload_credentials',{processor:'boolean',default:false});registerOption('images_upload_handler',{processor:'function'});registerOption('language',{processor:'string',default:'en'});registerOption('language_url',{processor:'string',default:''});registerOption('entity_encoding',{processor:'string',default:'named'});registerOption('indent',{processor:'boolean',default:true});registerOption('indent_before',{processor:'string',default:'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,details,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist'});registerOption('indent_after',{processor:'string',default:'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,'+'tfoot,tbody,tr,section,details,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist'});registerOption('indent_use_margin',{processor:'boolean',default:false});registerOption('indentation',{processor:'string',default:'40px'});registerOption('content_css',{processor:value=>{var valid=value===false||isString(value)||isArrayOf(value,isString);if(valid){if(isString(value)){return{value:map$3(value.split(','),trim$3),valid};}else if(isArray$1(value)){return{value,valid};}else if(value===false){return{value:[],valid};}else{return{value,valid};}}else{return{valid:false,message:'Must be false, a string or an array of strings.'};}},default:isInline(editor)?[]:['default']});registerOption('content_style',{processor:'string'});registerOption('content_css_cors',{processor:'boolean',default:false});registerOption('font_css',{processor:value=>{var valid=isString(value)||isArrayOf(value,isString);if(valid){var newValue=isArray$1(value)?value:map$3(value.split(','),trim$3);return{value:newValue,valid};}else{return{valid:false,message:'Must be a string or an array of strings.'};}},default:[]});registerOption('inline_boundaries',{processor:'boolean',default:true});registerOption('inline_boundaries_selector',{processor:'string',default:'a[href],code,span.mce-annotation'});registerOption('object_resizing',{processor:value=>{var valid=isBoolean(value)||isString(value);if(valid){if(value===false||deviceDetection$1.isiPhone()||deviceDetection$1.isiPad()){return{value:'',valid};}else{return{value:value===true?'table,img,figure.image,div,video,iframe':value,valid};}}else{return{valid:false,message:'Must be boolean or a string'};}},default:!isTouch});registerOption('resize_img_proportional',{processor:'boolean',default:true});registerOption('event_root',{processor:'object'});registerOption('service_message',{processor:'string'});registerOption('theme',{processor:value=>value===false||isString(value)||isFunction(value),default:'silver'});registerOption('theme_url',{processor:'string'});registerOption('formats',{processor:'object'});registerOption('format_empty_lines',{processor:'boolean',default:false});registerOption('format_noneditable_selector',{processor:'string',default:''});registerOption('preview_styles',{processor:value=>{var valid=value===false||isString(value);if(valid){return{value:value===false?'':value,valid};}else{return{valid:false,message:'Must be false or a string'};}},default:'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow'});registerOption('custom_ui_selector',{processor:'string',default:''});registerOption('hidden_input',{processor:'boolean',default:true});registerOption('submit_patch',{processor:'boolean',default:true});registerOption('encoding',{processor:'string'});registerOption('add_form_submit_trigger',{processor:'boolean',default:true});registerOption('add_unload_trigger',{processor:'boolean',default:true});registerOption('custom_undo_redo_levels',{processor:'number',default:0});registerOption('disable_nodechange',{processor:'boolean',default:false});registerOption('readonly',{processor:'boolean',default:false});registerOption('editable_root',{processor:'boolean',default:true});registerOption('plugins',{processor:'string[]',default:[]});registerOption('external_plugins',{processor:'object'});registerOption('forced_plugins',{processor:'string[]'});registerOption('model',{processor:'string',default:editor.hasPlugin('rtc')?'plugin':'dom'});registerOption('model_url',{processor:'string'});registerOption('block_unsupported_drop',{processor:'boolean',default:true});registerOption('visual',{processor:'boolean',default:true});registerOption('visual_table_class',{processor:'string',default:'mce-item-table'});registerOption('visual_anchor_class',{processor:'string',default:'mce-item-anchor'});registerOption('iframe_aria_text',{processor:'string',default:'Rich Text Area. Press ALT-0 for help.'});registerOption('setup',{processor:'function'});registerOption('init_instance_callback',{processor:'function'});registerOption('url_converter',{processor:'function',default:editor.convertURL});registerOption('url_converter_scope',{processor:'object',default:editor});registerOption('urlconverter_callback',{processor:'function'});registerOption('allow_conditional_comments',{processor:'boolean',default:false});registerOption('allow_html_data_urls',{processor:'boolean',default:false});registerOption('allow_svg_data_urls',{processor:'boolean'});registerOption('allow_html_in_named_anchor',{processor:'boolean',default:false});registerOption('allow_script_urls',{processor:'boolean',default:false});registerOption('allow_unsafe_link_target',{processor:'boolean',default:false});registerOption('convert_fonts_to_spans',{processor:'boolean',default:true,deprecated:true});registerOption('fix_list_elements',{processor:'boolean',default:false});registerOption('preserve_cdata',{processor:'boolean',default:false});registerOption('remove_trailing_brs',{processor:'boolean',default:true});registerOption('pad_empty_with_br',{processor:'boolean',default:false});registerOption('inline_styles',{processor:'boolean',default:true,deprecated:true});registerOption('element_format',{processor:'string',default:'html'});registerOption('entities',{processor:'string'});registerOption('schema',{processor:'string',default:'html5'});registerOption('convert_urls',{processor:'boolean',default:true});registerOption('relative_urls',{processor:'boolean',default:true});registerOption('remove_script_host',{processor:'boolean',default:true});registerOption('custom_elements',{processor:'string'});registerOption('extended_valid_elements',{processor:'string'});registerOption('invalid_elements',{processor:'string'});registerOption('invalid_styles',{processor:stringOrObjectProcessor});registerOption('valid_children',{processor:'string'});registerOption('valid_classes',{processor:stringOrObjectProcessor});registerOption('valid_elements',{processor:'string'});registerOption('valid_styles',{processor:stringOrObjectProcessor});registerOption('verify_html',{processor:'boolean',default:true});registerOption('auto_focus',{processor:value=>isString(value)||value===true});registerOption('browser_spellcheck',{processor:'boolean',default:false});registerOption('protect',{processor:'array'});registerOption('images_file_types',{processor:'string',default:'jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp'});registerOption('deprecation_warnings',{processor:'boolean',default:true});registerOption('a11y_advanced_options',{processor:'boolean',default:false});registerOption('api_key',{processor:'string'});registerOption('paste_block_drop',{processor:'boolean',default:false});registerOption('paste_data_images',{processor:'boolean',default:true});registerOption('paste_preprocess',{processor:'function'});registerOption('paste_postprocess',{processor:'function'});registerOption('paste_webkit_styles',{processor:'string',default:'none'});registerOption('paste_remove_styles_if_webkit',{processor:'boolean',default:true});registerOption('paste_merge_formats',{processor:'boolean',default:true});registerOption('smart_paste',{processor:'boolean',default:true});registerOption('paste_as_text',{processor:'boolean',default:false});registerOption('paste_tab_spaces',{processor:'number',default:4});registerOption('text_patterns',{processor:value=>{if(isArrayOf(value,isObject)||value===false){var patterns=value===false?[]:value;return{value:fromRawPatterns(patterns),valid:true};}else{return{valid:false,message:'Must be an array of objects or false.'};}},default:[{start:'*',end:'*',format:'italic'},{start:'**',end:'**',format:'bold'},{start:'#',format:'h1'},{start:'##',format:'h2'},{start:'###',format:'h3'},{start:'####',format:'h4'},{start:'#####',format:'h5'},{start:'######',format:'h6'},{start:'1. ',cmd:'InsertOrderedList'},{start:'* ',cmd:'InsertUnorderedList'},{start:'- ',cmd:'InsertUnorderedList'}]});registerOption('text_patterns_lookup',{processor:value=>{if(isFunction(value)){return{value:fromRawPatternsLookup(value),valid:true};}else{return{valid:false,message:'Must be a single function'};}},default:_ctx=>[]});registerOption('noneditable_class',{processor:'string',default:'mceNonEditable'});registerOption('editable_class',{processor:'string',default:'mceEditable'});registerOption('noneditable_regexp',{processor:value=>{if(isArrayOf(value,isRegExp)){return{value,valid:true};}else if(isRegExp(value)){return{value:[value],valid:true};}else{return{valid:false,message:'Must be a RegExp or an array of RegExp.'};}},default:[]});registerOption('table_tab_navigation',{processor:'boolean',default:true});registerOption('highlight_on_focus',{processor:'boolean',default:false});registerOption('xss_sanitization',{processor:'boolean',default:true});registerOption('details_initial_state',{processor:value=>{var valid=contains$2(['inherited','collapsed','expanded'],value);return valid?{value,valid}:{valid:false,message:'Must be one of: inherited, collapsed, or expanded.'};},default:'inherited'});registerOption('details_serialized_state',{processor:value=>{var valid=contains$2(['inherited','collapsed','expanded'],value);return valid?{value,valid}:{valid:false,message:'Must be one of: inherited, collapsed, or expanded.'};},default:'inherited'});registerOption('init_content_sync',{processor:'boolean',default:false});registerOption('newdocument_content',{processor:'string',default:''});editor.on('ScriptsLoaded',()=>{registerOption('directionality',{processor:'string',default:I18n.isRtl()?'rtl':undefined});registerOption('placeholder',{processor:'string',default:DOM$a.getAttrib(editor.getElement(),'placeholder')});});};var getIframeAttrs=option('iframe_attrs');var getDocType=option('doctype');var getDocumentBaseUrl=option('document_base_url');var getBodyId=option('body_id');var getBodyClass=option('body_class');var getContentSecurityPolicy=option('content_security_policy');var shouldPutBrInPre$1=option('br_in_pre');var getForcedRootBlock=option('forced_root_block');var getForcedRootBlockAttrs=option('forced_root_block_attrs');var getNewlineBehavior=option('newline_behavior');var getBrNewLineSelector=option('br_newline_selector');var getNoNewLineSelector=option('no_newline_selector');var shouldKeepStyles=option('keep_styles');var shouldEndContainerOnEmptyBlock=option('end_container_on_empty_block');var isAutomaticUploadsEnabled=option('automatic_uploads');var shouldReuseFileName=option('images_reuse_filename');var shouldReplaceBlobUris=option('images_replace_blob_uris');var getIconPackName=option('icons');var getIconsUrl=option('icons_url');var getImageUploadUrl=option('images_upload_url');var getImageUploadBasePath=option('images_upload_base_path');var getImagesUploadCredentials=option('images_upload_credentials');var getImagesUploadHandler=option('images_upload_handler');var shouldUseContentCssCors=option('content_css_cors');var getReferrerPolicy=option('referrer_policy');var getLanguageCode=option('language');var getLanguageUrl=option('language_url');var shouldIndentUseMargin=option('indent_use_margin');var getIndentation=option('indentation');var getContentCss=option('content_css');var getContentStyle=option('content_style');var getFontCss=option('font_css');var getDirectionality=option('directionality');var getInlineBoundarySelector=option('inline_boundaries_selector');var getObjectResizing=option('object_resizing');var getResizeImgProportional=option('resize_img_proportional');var getPlaceholder=option('placeholder');var getEventRoot=option('event_root');var getServiceMessage=option('service_message');var getTheme=option('theme');var getThemeUrl=option('theme_url');var getModel=option('model');var getModelUrl=option('model_url');var isInlineBoundariesEnabled=option('inline_boundaries');var getFormats=option('formats');var getPreviewStyles=option('preview_styles');var canFormatEmptyLines=option('format_empty_lines');var getFormatNoneditableSelector=option('format_noneditable_selector');var getCustomUiSelector=option('custom_ui_selector');var isInline=option('inline');var hasHiddenInput=option('hidden_input');var shouldPatchSubmit=option('submit_patch');var shouldAddFormSubmitTrigger=option('add_form_submit_trigger');var shouldAddUnloadTrigger=option('add_unload_trigger');var getCustomUndoRedoLevels=option('custom_undo_redo_levels');var shouldDisableNodeChange=option('disable_nodechange');var isReadOnly$1=option('readonly');var hasEditableRoot$1=option('editable_root');var hasContentCssCors=option('content_css_cors');var getPlugins=option('plugins');var getExternalPlugins$1=option('external_plugins');var shouldBlockUnsupportedDrop=option('block_unsupported_drop');var isVisualAidsEnabled=option('visual');var getVisualAidsTableClass=option('visual_table_class');var getVisualAidsAnchorClass=option('visual_anchor_class');var getIframeAriaText=option('iframe_aria_text');var getSetupCallback=option('setup');var getInitInstanceCallback=option('init_instance_callback');var getUrlConverterCallback=option('urlconverter_callback');var getAutoFocus=option('auto_focus');var shouldBrowserSpellcheck=option('browser_spellcheck');var getProtect=option('protect');var shouldPasteBlockDrop=option('paste_block_drop');var shouldPasteDataImages=option('paste_data_images');var getPastePreProcess=option('paste_preprocess');var getPastePostProcess=option('paste_postprocess');var getNewDocumentContent=option('newdocument_content');var getPasteWebkitStyles=option('paste_webkit_styles');var shouldPasteRemoveWebKitStyles=option('paste_remove_styles_if_webkit');var shouldPasteMergeFormats=option('paste_merge_formats');var isSmartPasteEnabled=option('smart_paste');var isPasteAsTextEnabled=option('paste_as_text');var getPasteTabSpaces=option('paste_tab_spaces');var shouldAllowHtmlDataUrls=option('allow_html_data_urls');var getTextPatterns=option('text_patterns');var getTextPatternsLookup=option('text_patterns_lookup');var getNonEditableClass=option('noneditable_class');var getEditableClass=option('editable_class');var getNonEditableRegExps=option('noneditable_regexp');var shouldPreserveCData=option('preserve_cdata');var shouldHighlightOnFocus=option('highlight_on_focus');var shouldSanitizeXss=option('xss_sanitization');var shouldUseDocumentWrite=option('init_content_sync');var hasTextPatternsLookup=editor=>editor.options.isSet('text_patterns_lookup');var getFontStyleValues=editor=>Tools.explode(editor.options.get('font_size_style_values'));var getFontSizeClasses=editor=>Tools.explode(editor.options.get('font_size_classes'));var isEncodingXml=editor=>editor.options.get('encoding')==='xml';var getAllowedImageFileTypes=editor=>Tools.explode(editor.options.get('images_file_types'));var hasTableTabNavigation=option('table_tab_navigation');var getDetailsInitialState=option('details_initial_state');var getDetailsSerializedState=option('details_serialized_state');var isElement$3=isElement$6;var isText$5=isText$a;var removeNode$1=node=>{var parentNode=node.parentNode;if(parentNode){parentNode.removeChild(node);}};var trimCount=text=>{var trimmedText=trim$1(text);return{count:text.length-trimmedText.length,text:trimmedText};};var deleteZwspChars=caretContainer=>{var idx;while((idx=caretContainer.data.lastIndexOf(ZWSP$1))!==-1){caretContainer.deleteData(idx,1);}};var removeUnchanged=(caretContainer,pos)=>{remove$3(caretContainer);return pos;};var removeTextAndReposition=(caretContainer,pos)=>{var before=trimCount(caretContainer.data.substr(0,pos.offset()));var after=trimCount(caretContainer.data.substr(pos.offset()));var text=before.text+after.text;if(text.length>0){deleteZwspChars(caretContainer);return CaretPosition(caretContainer,pos.offset()-before.count);}else{return pos;}};var removeElementAndReposition=(caretContainer,pos)=>{var parentNode=pos.container();var newPosition=indexOf$1(from(parentNode.childNodes),caretContainer).map(index=>{return index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos;}).getOr(pos);remove$3(caretContainer);return newPosition;};var removeTextCaretContainer=(caretContainer,pos)=>isText$5(caretContainer)&&pos.container()===caretContainer?removeTextAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);var removeElementCaretContainer=(caretContainer,pos)=>pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos);var removeAndReposition=(container,pos)=>CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos);var remove$3=caretContainerNode=>{if(isElement$3(caretContainerNode)&&isCaretContainer$2(caretContainerNode)){if(hasContent(caretContainerNode)){caretContainerNode.removeAttribute('data-mce-caret');}else{removeNode$1(caretContainerNode);}}if(isText$5(caretContainerNode)){deleteZwspChars(caretContainerNode);if(caretContainerNode.data.length===0){removeNode$1(caretContainerNode);}}};var isContentEditableFalse$8=isContentEditableFalse$b;var isMedia$1=isMedia$2;var isTableCell$1=isTableCell$3;var inlineFakeCaretSelector='*[contentEditable=false],video,audio,embed,object';var getAbsoluteClientRect=(root,element,before)=>{var clientRect=collapse(element.getBoundingClientRect(),before);var scrollX;var scrollY;if(root.tagName==='BODY'){var docElm=root.ownerDocument.documentElement;scrollX=root.scrollLeft||docElm.scrollLeft;scrollY=root.scrollTop||docElm.scrollTop;}else{var rootRect=root.getBoundingClientRect();scrollX=root.scrollLeft-rootRect.left;scrollY=root.scrollTop-rootRect.top;}clientRect.left+=scrollX;clientRect.right+=scrollX;clientRect.top+=scrollY;clientRect.bottom+=scrollY;clientRect.width=1;var margin=element.offsetWidth-element.clientWidth;if(margin>0){if(before){margin*=-1;}clientRect.left+=margin;clientRect.right+=margin;}return clientRect;};var trimInlineCaretContainers=root=>{var _a,_b;var fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),inlineFakeCaretSelector);for(var i=0;i<fakeCaretTargetNodes.length;i++){var node=fakeCaretTargetNodes[i].dom;var _sibling6=node.previousSibling;if(endsWithCaretContainer$1(_sibling6)){var _data=_sibling6.data;if(_data.length===1){(_a=_sibling6.parentNode)===null||_a===void 0?void 0:_a.removeChild(_sibling6);}else{_sibling6.deleteData(_data.length-1,1);}}_sibling6=node.nextSibling;if(startsWithCaretContainer$1(_sibling6)){var _data2=_sibling6.data;if(_data2.length===1){(_b=_sibling6.parentNode)===null||_b===void 0?void 0:_b.removeChild(_sibling6);}else{_sibling6.deleteData(0,1);}}}};var FakeCaret=(editor,root,isBlock,hasFocus)=>{var lastVisualCaret=value$2();var cursorInterval;var caretContainerNode;var caretBlock=getForcedRootBlock(editor);var dom=editor.dom;var show=(before,element)=>{var rng;hide();if(isTableCell$1(element)){return null;}if(isBlock(element)){var caretContainer=insertBlock(caretBlock,element,before);var clientRect=getAbsoluteClientRect(root,element,before);dom.setStyle(caretContainer,'top',clientRect.top);caretContainerNode=caretContainer;var caret=dom.create('div',{'class':'mce-visual-caret','data-mce-bogus':'all'});dom.setStyles(caret,_objectSpread({},clientRect));dom.add(root,caret);lastVisualCaret.set({caret,element,before});if(before){dom.addClass(caret,'mce-visual-caret-before');}startBlink();rng=element.ownerDocument.createRange();rng.setStart(caretContainer,0);rng.setEnd(caretContainer,0);}else{caretContainerNode=insertInline$1(element,before);rng=element.ownerDocument.createRange();if(isInlineFakeCaretTarget(caretContainerNode.nextSibling)){rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0);}else{rng.setStart(caretContainerNode,1);rng.setEnd(caretContainerNode,1);}return rng;}return rng;};var hide=()=>{trimInlineCaretContainers(root);if(caretContainerNode){remove$3(caretContainerNode);caretContainerNode=null;}lastVisualCaret.on(caretState=>{dom.remove(caretState.caret);lastVisualCaret.clear();});if(cursorInterval){clearInterval(cursorInterval);cursorInterval=undefined;}};var startBlink=()=>{cursorInterval=setInterval(()=>{lastVisualCaret.on(caretState=>{if(hasFocus()){dom.toggleClass(caretState.caret,'mce-visual-caret-hidden');}else{dom.addClass(caretState.caret,'mce-visual-caret-hidden');}});},500);};var reposition=()=>{lastVisualCaret.on(caretState=>{var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);dom.setStyles(caretState.caret,_objectSpread({},clientRect));});};var destroy=()=>clearInterval(cursorInterval);var getCss=()=>'.mce-visual-caret {'+'position: absolute;'+'background-color: black;'+'background-color: currentcolor;'+'}'+'.mce-visual-caret-hidden {'+'display: none;'+'}'+'*[data-mce-caret] {'+'position: absolute;'+'left: -1000px;'+'right: auto;'+'top: 0;'+'margin: 0;'+'padding: 0;'+'}';return{show,hide,getCss,reposition,destroy};};var isFakeCaretTableBrowser=()=>Env.browser.isFirefox();var isInlineFakeCaretTarget=node=>isContentEditableFalse$8(node)||isMedia$1(node);var isFakeCaretTarget=node=>{var isTarget=isInlineFakeCaretTarget(node)||isTable$2(node)&&isFakeCaretTableBrowser();return isTarget&&parentElement(SugarElement.fromDom(node)).exists(isEditable$3);};var isContentEditableTrue$1=isContentEditableTrue$3;var isContentEditableFalse$7=isContentEditableFalse$b;var isMedia=isMedia$2;var isBlockLike=matchStyleValues('display','block table table-cell table-caption list-item');var isCaretContainer=isCaretContainer$2;var isCaretContainerBlock=isCaretContainerBlock$1;var isElement$2=isElement$6;var isText$4=isText$a;var isCaretCandidate$1=isCaretCandidate$3;var isForwards=direction=>direction>0;var isBackwards=direction=>direction<0;var skipCaretContainers=(walk,shallow)=>{var node;while(node=walk(shallow)){if(!isCaretContainerBlock(node)){return node;}}return null;};var findNode=(node,direction,predicateFn,rootNode,shallow)=>{var walker=new DomTreeWalker(node,rootNode);var isCefOrCaretContainer=isContentEditableFalse$7(node)||isCaretContainerBlock(node);var tempNode;if(isBackwards(direction)){if(isCefOrCaretContainer){tempNode=skipCaretContainers(walker.prev.bind(walker),true);if(predicateFn(tempNode)){return tempNode;}}while(tempNode=skipCaretContainers(walker.prev.bind(walker),shallow)){if(predicateFn(tempNode)){return tempNode;}}}if(isForwards(direction)){if(isCefOrCaretContainer){tempNode=skipCaretContainers(walker.next.bind(walker),true);if(predicateFn(tempNode)){return tempNode;}}while(tempNode=skipCaretContainers(walker.next.bind(walker),shallow)){if(predicateFn(tempNode)){return tempNode;}}}return null;};var getEditingHost=(node,rootNode)=>{var isCETrue=node=>isContentEditableTrue$1(node.dom);var isRoot=node=>node.dom===rootNode;return ancestor$4(SugarElement.fromDom(node),isCETrue,isRoot).map(elm=>elm.dom).getOr(rootNode);};var getParentBlock$3=(node,rootNode)=>{while(node&&node!==rootNode){if(isBlockLike(node)){return node;}node=node.parentNode;}return null;};var isInSameBlock=(caretPosition1,caretPosition2,rootNode)=>getParentBlock$3(caretPosition1.container(),rootNode)===getParentBlock$3(caretPosition2.container(),rootNode);var getChildNodeAtRelativeOffset=(relativeOffset,caretPosition)=>{if(!caretPosition){return Optional.none();}var container=caretPosition.container();var offset=caretPosition.offset();if(!isElement$2(container)){return Optional.none();}return Optional.from(container.childNodes[offset+relativeOffset]);};var beforeAfter=(before,node)=>{var _a;var doc=(_a=node.ownerDocument)!==null&&_a!==void 0?_a:document;var range=doc.createRange();if(before){range.setStartBefore(node);range.setEndBefore(node);}else{range.setStartAfter(node);range.setEndAfter(node);}return range;};var isNodesInSameBlock=(root,node1,node2)=>getParentBlock$3(node1,root)===getParentBlock$3(node2,root);var lean=(left,root,node)=>{var siblingName=left?'previousSibling':'nextSibling';var tempNode=node;while(tempNode&&tempNode!==root){var _sibling7=tempNode[siblingName];if(_sibling7&&isCaretContainer(_sibling7)){_sibling7=_sibling7[siblingName];}if(isContentEditableFalse$7(_sibling7)||isMedia(_sibling7)){if(isNodesInSameBlock(root,_sibling7,tempNode)){return _sibling7;}break;}if(isCaretCandidate$1(_sibling7)){break;}tempNode=tempNode.parentNode;}return null;};var before$2=curry(beforeAfter,true);var after$2=curry(beforeAfter,false);var normalizeRange=(direction,root,range)=>{var node;var leanLeft=curry(lean,true,root);var leanRight=curry(lean,false,root);var container=range.startContainer;var offset=range.startOffset;if(isCaretContainerBlock$1(container)){var block=isText$4(container)?container.parentNode:container;var location=block.getAttribute('data-mce-caret');if(location==='before'){node=block.nextSibling;if(isFakeCaretTarget(node)){return before$2(node);}}if(location==='after'){node=block.previousSibling;if(isFakeCaretTarget(node)){return after$2(node);}}}if(!range.collapsed){return range;}if(isText$a(container)){if(isCaretContainer(container)){if(direction===1){node=leanRight(container);if(node){return before$2(node);}node=leanLeft(container);if(node){return after$2(node);}}if(direction===-1){node=leanLeft(container);if(node){return after$2(node);}node=leanRight(container);if(node){return before$2(node);}}return range;}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1){if(direction===1){node=leanRight(container);if(node){return before$2(node);}}return range;}if(startsWithCaretContainer$1(container)&&offset<=1){if(direction===-1){node=leanLeft(container);if(node){return after$2(node);}}return range;}if(offset===container.data.length){node=leanRight(container);if(node){return before$2(node);}return range;}if(offset===0){node=leanLeft(container);if(node){return after$2(node);}return range;}}return range;};var getRelativeCefElm=(forward,caretPosition)=>getChildNodeAtRelativeOffset(forward?0:-1,caretPosition).filter(isContentEditableFalse$7);var getNormalizedRangeEndPoint=(direction,root,range)=>{var normalizedRange=normalizeRange(direction,root,range);return direction===-1?CaretPosition.fromRangeStart(normalizedRange):CaretPosition.fromRangeEnd(normalizedRange);};var getElementFromPosition=pos=>Optional.from(pos.getNode()).map(SugarElement.fromDom);var getElementFromPrevPosition=pos=>Optional.from(pos.getNode(true)).map(SugarElement.fromDom);var getVisualCaretPosition=(walkFn,caretPosition)=>{var pos=caretPosition;while(pos=walkFn(pos)){if(pos.isVisible()){return pos;}}return pos;};var isMoveInsideSameBlock=(from,to)=>{var inSameBlock=isInSameBlock(from,to);if(!inSameBlock&&isBr$6(from.getNode())){return true;}return inSameBlock;};var HDirection;(function(HDirection){HDirection[HDirection['Backwards']=-1]='Backwards';HDirection[HDirection['Forwards']=1]='Forwards';})(HDirection||(HDirection={}));var isContentEditableFalse$6=isContentEditableFalse$b;var isText$3=isText$a;var isElement$1=isElement$6;var isBr$2=isBr$6;var isCaretCandidate=isCaretCandidate$3;var isAtomic=isAtomic$1;var isEditableCaretCandidate=isEditableCaretCandidate$1;var getParents$3=(node,root)=>{var parents=[];var tempNode=node;while(tempNode&&tempNode!==root){parents.push(tempNode);tempNode=tempNode.parentNode;}return parents;};var nodeAtIndex=(container,offset)=>{if(container.hasChildNodes()&&offset<container.childNodes.length){return container.childNodes[offset];}return null;};var getCaretCandidatePosition=(direction,node)=>{if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$3(node.previousSibling)){return CaretPosition.before(node);}if(isText$3(node)){return CaretPosition(node,0);}}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$3(node.nextSibling)){return CaretPosition.after(node);}if(isText$3(node)){return CaretPosition(node,node.data.length);}}if(isBackwards(direction)){if(isBr$2(node)){return CaretPosition.before(node);}return CaretPosition.after(node);}return CaretPosition.before(node);};var moveForwardFromBr=(root,nextNode)=>{var nextSibling=nextNode.nextSibling;if(nextSibling&&isCaretCandidate(nextSibling)){if(isText$3(nextSibling)){return CaretPosition(nextSibling,0);}else{return CaretPosition.before(nextSibling);}}else{return findCaretPosition$1(HDirection.Forwards,CaretPosition.after(nextNode),root);}};var findCaretPosition$1=(direction,startPos,root)=>{var node;var nextNode;var innerNode;var caretPosition;if(!isElement$1(root)||!startPos){return null;}if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){caretPosition=CaretPosition.after(root.lastChild);if(isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement$1(root.lastChild)){return isBr$2(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition;}}else{caretPosition=startPos;}var container=caretPosition.container();var offset=caretPosition.offset();if(isText$3(container)){if(isBackwards(direction)&&offset>0){return CaretPosition(container,--offset);}if(isForwards(direction)&&offset<container.length){return CaretPosition(container,++offset);}node=container;}else{if(isBackwards(direction)&&offset>0){nextNode=nodeAtIndex(container,offset-1);if(isCaretCandidate(nextNode)){if(!isAtomic(nextNode)){innerNode=findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText$3(innerNode)){return CaretPosition(innerNode,innerNode.data.length);}return CaretPosition.after(innerNode);}}if(isText$3(nextNode)){return CaretPosition(nextNode,nextNode.data.length);}return CaretPosition.before(nextNode);}}if(isForwards(direction)&&offset<container.childNodes.length){nextNode=nodeAtIndex(container,offset);if(isCaretCandidate(nextNode)){if(isBr$2(nextNode)){return moveForwardFromBr(root,nextNode);}if(!isAtomic(nextNode)){innerNode=findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText$3(innerNode)){return CaretPosition(innerNode,0);}return CaretPosition.before(innerNode);}}if(isText$3(nextNode)){return CaretPosition(nextNode,0);}return CaretPosition.after(nextNode);}}node=nextNode?nextNode:caretPosition.getNode();}if(node&&(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())){node=findNode(node,direction,always,root,true);if(isEditableCaretCandidate(node,root)){return getCaretCandidatePosition(direction,node);}}nextNode=node?findNode(node,direction,isEditableCaretCandidate,root):node;var rootContentEditableFalseElm=last$2(filter$5(getParents$3(container,root),isContentEditableFalse$6));if(rootContentEditableFalseElm&&(!nextNode||!rootContentEditableFalseElm.contains(nextNode))){if(isForwards(direction)){caretPosition=CaretPosition.after(rootContentEditableFalseElm);}else{caretPosition=CaretPosition.before(rootContentEditableFalseElm);}return caretPosition;}if(nextNode){return getCaretCandidatePosition(direction,nextNode);}return null;};var CaretWalker=root=>({next:caretPosition=>{return findCaretPosition$1(HDirection.Forwards,caretPosition,root);},prev:caretPosition=>{return findCaretPosition$1(HDirection.Backwards,caretPosition,root);}});var walkToPositionIn=(forward,root,start)=>{var position=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,position);};var afterElement=node=>isBr$6(node)?CaretPosition.before(node):CaretPosition.after(node);var isBeforeOrStart=position=>{if(CaretPosition.isTextPosition(position)){return position.offset()===0;}else{return isCaretCandidate$3(position.getNode());}};var isAfterOrEnd=position=>{if(CaretPosition.isTextPosition(position)){var container=position.container();return position.offset()===container.data.length;}else{return isCaretCandidate$3(position.getNode(true));}};var isBeforeAfterSameElement=(from,to)=>!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(true);var isAtBr=position=>!CaretPosition.isTextPosition(position)&&isBr$6(position.getNode());var shouldSkipPosition=(forward,from,to)=>{if(forward){return!isBeforeAfterSameElement(from,to)&&!isAtBr(from)&&isAfterOrEnd(from)&&isBeforeOrStart(to);}else{return!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to);}};var fromPosition=(forward,root,pos)=>{var walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos));};var navigate=(forward,root,from)=>fromPosition(forward,root,from).bind(to=>{if(isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)){return fromPosition(forward,root,to);}else{return Optional.some(to);}});var navigateIgnore=(forward,root,from,ignoreFilter)=>navigate(forward,root,from).bind(pos=>ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos));var positionIn=(forward,element)=>{var startNode=forward?element.firstChild:element.lastChild;if(isText$a(startNode)){return Optional.some(CaretPosition(startNode,forward?0:startNode.data.length));}else if(startNode){if(isCaretCandidate$3(startNode)){return Optional.some(forward?CaretPosition.before(startNode):afterElement(startNode));}else{return walkToPositionIn(forward,element,startNode);}}else{return Optional.none();}};var nextPosition=curry(fromPosition,true);var prevPosition=curry(fromPosition,false);var firstPositionIn=curry(positionIn,true);var lastPositionIn=curry(positionIn,false);var CARET_ID='_mce_caret';var isCaretNode=node=>isElement$6(node)&&node.id===CARET_ID;var getParentCaretContainer=(body,node)=>{var currentNode=node;while(currentNode&&currentNode!==body){if(isCaretNode(currentNode)){return currentNode;}currentNode=currentNode.parentNode;}return null;};var isStringPathBookmark=bookmark=>isString(bookmark.start);var isRangeBookmark=bookmark=>has$2(bookmark,'rng');var isIdBookmark=bookmark=>has$2(bookmark,'id');var isIndexBookmark=bookmark=>has$2(bookmark,'name');var isPathBookmark=bookmark=>Tools.isArray(bookmark.start);var isForwardBookmark=bookmark=>!isIndexBookmark(bookmark)&&isBoolean(bookmark.forward)?bookmark.forward:true;var addBogus=(dom,node)=>{if(isElement$6(node)&&dom.isBlock(node)&&!node.innerHTML){node.innerHTML='<br data-mce-bogus=\"1\" />';}return node;};var resolveCaretPositionBookmark=(dom,bookmark)=>{var startPos=Optional.from(resolve$1(dom.getRoot(),bookmark.start));var endPos=Optional.from(resolve$1(dom.getRoot(),bookmark.end));return lift2(startPos,endPos,(start,end)=>{var range=dom.createRng();range.setStart(start.container(),start.offset());range.setEnd(end.container(),end.offset());return{range,forward:isForwardBookmark(bookmark)};});};var insertZwsp=(node,rng)=>{var _a;var doc=(_a=node.ownerDocument)!==null&&_a!==void 0?_a:document;var textNode=doc.createTextNode(ZWSP$1);node.appendChild(textNode);rng.setStart(textNode,0);rng.setEnd(textNode,0);};var isEmpty$1=node=>!node.hasChildNodes();var tryFindRangePosition=(node,rng)=>lastPositionIn(node).fold(never,pos=>{rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());return true;});var padEmptyCaretContainer=(root,node,rng)=>{if(isEmpty$1(node)&&getParentCaretContainer(root,node)){insertZwsp(node,rng);return true;}else{return false;}};var setEndPoint=(dom,start,bookmark,rng)=>{var point=bookmark[start?'start':'end'];var root=dom.getRoot();if(point){var node=root;var offset=point[0];for(var i=point.length-1;node&&i>=1;i--){var _children2=node.childNodes;if(padEmptyCaretContainer(root,node,rng)){return true;}if(point[i]>_children2.length-1){if(padEmptyCaretContainer(root,node,rng)){return true;}return tryFindRangePosition(node,rng);}node=_children2[point[i]];}if(isText$a(node)){offset=Math.min(point[0],node.data.length);}if(isElement$6(node)){offset=Math.min(point[0],node.childNodes.length);}if(start){rng.setStart(node,offset);}else{rng.setEnd(node,offset);}}return true;};var isValidTextNode=node=>isText$a(node)&&node.data.length>0;var restoreEndPoint=(dom,suffix,bookmark)=>{var marker=dom.get(bookmark.id+'_'+suffix);var markerParent=marker===null||marker===void 0?void 0:marker.parentNode;var keep=bookmark.keep;if(marker&&markerParent){var container;var offset;if(suffix==='start'){if(!keep){container=markerParent;offset=dom.nodeIndex(marker);}else{if(marker.hasChildNodes()){container=marker.firstChild;offset=1;}else if(isValidTextNode(marker.nextSibling)){container=marker.nextSibling;offset=0;}else if(isValidTextNode(marker.previousSibling)){container=marker.previousSibling;offset=marker.previousSibling.data.length;}else{container=markerParent;offset=dom.nodeIndex(marker)+1;}}}else{if(!keep){container=markerParent;offset=dom.nodeIndex(marker);}else{if(marker.hasChildNodes()){container=marker.firstChild;offset=1;}else if(isValidTextNode(marker.previousSibling)){container=marker.previousSibling;offset=marker.previousSibling.data.length;}else{container=markerParent;offset=dom.nodeIndex(marker);}}}if(!keep){var _prev=marker.previousSibling;var _next=marker.nextSibling;Tools.each(Tools.grep(marker.childNodes),node=>{if(isText$a(node)){node.data=node.data.replace(/\\uFEFF/g,'');}});var otherMarker;while(otherMarker=dom.get(bookmark.id+'_'+suffix)){dom.remove(otherMarker,true);}if(isText$a(_next)&&isText$a(_prev)&&!Env.browser.isOpera()){var idx=_prev.data.length;_prev.appendData(_next.data);dom.remove(_next);container=_prev;offset=idx;}}return Optional.some(CaretPosition(container,offset));}else{return Optional.none();}};var resolvePaths=(dom,bookmark)=>{var range=dom.createRng();if(setEndPoint(dom,true,bookmark,range)&&setEndPoint(dom,false,bookmark,range)){return Optional.some({range,forward:isForwardBookmark(bookmark)});}else{return Optional.none();}};var resolveId=(dom,bookmark)=>{var startPos=restoreEndPoint(dom,'start',bookmark);var endPos=restoreEndPoint(dom,'end',bookmark);return lift2(startPos,endPos.or(startPos),(spos,epos)=>{var range=dom.createRng();range.setStart(addBogus(dom,spos.container()),spos.offset());range.setEnd(addBogus(dom,epos.container()),epos.offset());return{range,forward:isForwardBookmark(bookmark)};});};var resolveIndex=(dom,bookmark)=>Optional.from(dom.select(bookmark.name)[bookmark.index]).map(elm=>{var range=dom.createRng();range.selectNode(elm);return{range,forward:true};});var resolve=(selection,bookmark)=>{var dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark)){return resolvePaths(dom,bookmark);}else if(isStringPathBookmark(bookmark)){return resolveCaretPositionBookmark(dom,bookmark);}else if(isIdBookmark(bookmark)){return resolveId(dom,bookmark);}else if(isIndexBookmark(bookmark)){return resolveIndex(dom,bookmark);}else if(isRangeBookmark(bookmark)){return Optional.some({range:bookmark.rng,forward:isForwardBookmark(bookmark)});}}return Optional.none();};var getBookmark$1=(selection,type,normalized)=>{return getBookmark$2(selection,type,normalized);};var moveToBookmark=(selection,bookmark)=>{resolve(selection,bookmark).each(_ref7=>{var{range,forward}=_ref7;selection.setRng(range,forward);});};var isBookmarkNode$1=node=>{return isElement$6(node)&&node.tagName==='SPAN'&&node.getAttribute('data-mce-type')==='bookmark';};var is=expected=>actual=>expected===actual;var isNbsp=is(nbsp);var isWhiteSpace=chr=>chr!==''&&' \\f\\n\\r\\t\\x0B'.indexOf(chr)!==-1;var isContent=chr=>!isWhiteSpace(chr)&&!isNbsp(chr)&&!isZwsp$2(chr);var hexColour=value=>({value:normalizeHex(value)});var normalizeHex=hex=>removeLeading(hex,'#').toUpperCase();var toHex=component=>{var hex=component.toString(16);return(hex.length===1?'0'+hex:hex).toUpperCase();};var fromRgba=rgbaColour=>{var value=toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue);return hexColour(value);};var rgbRegex=/^\\s*rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)\\s*$/i;var rgbaRegex=/^\\s*rgba\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?(?:\\.\\d+)?)\\s*\\)\\s*$/i;var rgbaColour=(red,green,blue,alpha)=>({red,green,blue,alpha});var fromStringValues=(red,green,blue,alpha)=>{var r=parseInt(red,10);var g=parseInt(green,10);var b=parseInt(blue,10);var a=parseFloat(alpha);return rgbaColour(r,g,b,a);};var fromString=rgbaString=>{if(rgbaString==='transparent'){return Optional.some(rgbaColour(0,0,0,0));}var rgbMatch=rgbRegex.exec(rgbaString);if(rgbMatch!==null){return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],'1'));}var rgbaMatch=rgbaRegex.exec(rgbaString);if(rgbaMatch!==null){return Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4]));}return Optional.none();};var rgbaToHexString=color=>fromString(color).map(fromRgba).map(h=>'#'+h.value).getOr(color);var getRanges$1=selection=>{var ranges=[];if(selection){for(var i=0;i<selection.rangeCount;i++){ranges.push(selection.getRangeAt(i));}}return ranges;};var getSelectedNodes=ranges=>{return bind$3(ranges,range=>{var node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[];});};var hasMultipleRanges=selection=>{return getRanges$1(selection).length>1;};var getCellsFromRanges=ranges=>filter$5(getSelectedNodes(ranges),isTableCell$2);var getCellsFromElement=elm=>descendants(elm,'td[data-mce-selected],th[data-mce-selected]');var getCellsFromElementOrRanges=(ranges,element)=>{var selectedCells=getCellsFromElement(element);return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges);};var getCellsFromEditor=editor=>getCellsFromElementOrRanges(getRanges$1(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()));var getClosestTable=(cell,isRoot)=>ancestor$3(cell,'table',isRoot);var getStartNode=rng=>{var sc=rng.startContainer,so=rng.startOffset;if(isText$a(sc)){return so===0?Optional.some(SugarElement.fromDom(sc)):Optional.none();}else{return Optional.from(sc.childNodes[so]).map(SugarElement.fromDom);}};var getEndNode=rng=>{var ec=rng.endContainer,eo=rng.endOffset;if(isText$a(ec)){return eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none();}else{return Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom);}};var getFirstChildren=node=>{return firstChild(node).fold(constant([node]),child=>{return[node].concat(getFirstChildren(child));});};var getLastChildren=node=>{return lastChild(node).fold(constant([node]),child=>{if(name(child)==='br'){return prevSibling(child).map(sibling=>{return[node].concat(getLastChildren(sibling));}).getOr([]);}else{return[node].concat(getLastChildren(child));}});};var hasAllContentsSelected=(elm,rng)=>{return lift2(getStartNode(rng),getEndNode(rng),(startNode,endNode)=>{var start=find$2(getFirstChildren(elm),curry(eq,startNode));var end=find$2(getLastChildren(elm),curry(eq,endNode));return start.isSome()&&end.isSome();}).getOr(false);};var moveEndPoint=(dom,rng,node,start)=>{var root=node;var walker=new DomTreeWalker(node,root);var moveCaretBeforeOnEnterElementsMap=filter$4(dom.schema.getMoveCaretBeforeOnEnterElements(),(_,name)=>!contains$2(['td','th','table'],name.toLowerCase()));var currentNode=node;do{if(isText$a(currentNode)&&Tools.trim(currentNode.data).length!==0){if(start){rng.setStart(currentNode,0);}else{rng.setEnd(currentNode,currentNode.data.length);}return;}if(moveCaretBeforeOnEnterElementsMap[currentNode.nodeName]){if(start){rng.setStartBefore(currentNode);}else{if(currentNode.nodeName==='BR'){rng.setEndBefore(currentNode);}else{rng.setEndAfter(currentNode);}}return;}}while(currentNode=start?walker.next():walker.prev());if(root.nodeName==='BODY'){if(start){rng.setStart(root,0);}else{rng.setEnd(root,root.childNodes.length);}}};var hasAnyRanges=editor=>{var sel=editor.selection.getSel();return isNonNullable(sel)&&sel.rangeCount>0;};var runOnRanges=(editor,executor)=>{var fakeSelectionNodes=getCellsFromEditor(editor);if(fakeSelectionNodes.length>0){each$e(fakeSelectionNodes,elem=>{var node=elem.dom;var fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node);fakeNodeRng.setEndAfter(node);executor(fakeNodeRng,true);});}else{executor(editor.selection.getRng(),false);}};var preserve=(selection,fillBookmark,executor)=>{var bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark);selection.moveToBookmark(bookmark);};var isNode=node=>isNumber(node===null||node===void 0?void 0:node.nodeType);var isElementNode$1=node=>isElement$6(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node);var isElementDirectlySelected=(dom,node)=>{if(isElementNode$1(node)&&!/^(TD|TH)$/.test(node.nodeName)){var selectedAttr=dom.getAttrib(node,'data-mce-selected');var _value6=parseInt(selectedAttr,10);return!isNaN(_value6)&&_value6>0;}else{return false;}};var isEditable$2=elm=>elm.isContentEditable===true;var preserveSelection=(editor,action,shouldMoveStart)=>{var{selection,dom}=editor;var selectedNodeBeforeAction=selection.getNode();var isSelectedBeforeNodeNoneditable=isContentEditableFalse$b(selectedNodeBeforeAction);preserve(selection,true,()=>{action();});var isBeforeNodeStillNoneditable=isSelectedBeforeNodeNoneditable&&isContentEditableFalse$b(selectedNodeBeforeAction);if(isBeforeNodeStillNoneditable&&dom.isChildOf(selectedNodeBeforeAction,editor.getBody())){editor.selection.select(selectedNodeBeforeAction);}else if(shouldMoveStart(selection.getStart())){moveStartToNearestText(dom,selection);}};var moveStartToNearestText=(dom,selection)=>{var _a,_b;var rng=selection.getRng();var{startContainer,startOffset}=rng;var selectedNode=selection.getNode();if(isElementDirectlySelected(dom,selectedNode)){return;}if(isElement$6(startContainer)){var nodes=startContainer.childNodes;var root=dom.getRoot();var walker;if(startOffset<nodes.length){var startNode=nodes[startOffset];walker=new DomTreeWalker(startNode,(_a=dom.getParent(startNode,dom.isBlock))!==null&&_a!==void 0?_a:root);}else{var _startNode=nodes[nodes.length-1];walker=new DomTreeWalker(_startNode,(_b=dom.getParent(_startNode,dom.isBlock))!==null&&_b!==void 0?_b:root);walker.next(true);}for(var node=walker.current();node;node=walker.next()){if(dom.getContentEditable(node)==='false'){return;}else if(isText$a(node)&&!isWhiteSpaceNode$1(node)){rng.setStart(node,0);selection.setRng(rng);return;}}}};var getNonWhiteSpaceSibling=(node,next,inc)=>{if(node){var nextName=next?'nextSibling':'previousSibling';for(node=inc?node:node[nextName];node;node=node[nextName]){if(isElement$6(node)||!isWhiteSpaceNode$1(node)){return node;}}}return undefined;};var isTextBlock$1=(schema,node)=>!!schema.getTextBlockElements()[node.nodeName.toLowerCase()]||isTransparentBlock(schema,node);var isValid=(ed,parent,child)=>{return ed.schema.isValidChild(parent,child);};var isWhiteSpaceNode$1=function isWhiteSpaceNode$1(node){var allowSpaces=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(isNonNullable(node)&&isText$a(node)){var _data3=allowSpaces?node.data.replace(/ /g,'\\xA0'):node.data;return isWhitespaceText(_data3);}else{return false;}};var isEmptyTextNode$1=node=>{return isNonNullable(node)&&isText$a(node)&&node.length===0;};var isWrapNoneditableTarget=(editor,node)=>{var baseDataSelector='[data-mce-cef-wrappable]';var formatNoneditableSelector=getFormatNoneditableSelector(editor);var selector=isEmpty$3(formatNoneditableSelector)?baseDataSelector:\"\".concat(baseDataSelector,\",\").concat(formatNoneditableSelector);return is$1(SugarElement.fromDom(node),selector);};var isWrappableNoneditable=(editor,node)=>{var dom=editor.dom;return isElementNode$1(node)&&dom.getContentEditable(node)==='false'&&isWrapNoneditableTarget(editor,node)&&dom.select('[contenteditable=\"true\"]',node).length===0;};var replaceVars=(value,vars)=>{if(isFunction(value)){return value(vars);}else if(isNonNullable(vars)){value=value.replace(/%(\\w+)/g,(str,name)=>{return vars[name]||str;});}return value;};var isEq$5=(str1,str2)=>{str1=str1||'';str2=str2||'';str1=''+(str1.nodeName||str1);str2=''+(str2.nodeName||str2);return str1.toLowerCase()===str2.toLowerCase();};var normalizeStyleValue=(value,name)=>{if(isNullable(value)){return null;}else{var strValue=String(value);if(name==='color'||name==='backgroundColor'){strValue=rgbaToHexString(strValue);}if(name==='fontWeight'&&value===700){strValue='bold';}if(name==='fontFamily'){strValue=strValue.replace(/[\\'\\\"]/g,'').replace(/,\\s+/g,',');}return strValue;}};var getStyle=(dom,node,name)=>{var style=dom.getStyle(node,name);return normalizeStyleValue(style,name);};var getTextDecoration=(dom,node)=>{var decoration;dom.getParent(node,n=>{if(isElement$6(n)){decoration=dom.getStyle(n,'text-decoration');return!!decoration&&decoration!=='none';}else{return false;}});return decoration;};var getParents$2=(dom,node,selector)=>{return dom.getParents(node,selector,dom.getRoot());};var isFormatPredicate=(editor,formatName,predicate)=>{var formats=editor.formatter.get(formatName);return isNonNullable(formats)&&exists(formats,predicate);};var isVariableFormatName=(editor,formatName)=>{var hasVariableValues=format=>{var isVariableValue=val=>isFunction(val)||val.length>1&&val.charAt(0)==='%';return exists(['styles','attributes'],key=>get$a(format,key).exists(field=>{var fieldValues=isArray$1(field)?field:values(field);return exists(fieldValues,isVariableValue);}));};return isFormatPredicate(editor,formatName,hasVariableValues);};var areSimilarFormats=(editor,formatName,otherFormatName)=>{var validKeys=['inline','block','selector','attributes','styles','classes'];var filterObj=format=>filter$4(format,(_,key)=>exists(validKeys,validKey=>validKey===key));return isFormatPredicate(editor,formatName,fmt1=>{var filteredFmt1=filterObj(fmt1);return isFormatPredicate(editor,otherFormatName,fmt2=>{var filteredFmt2=filterObj(fmt2);return equal$1(filteredFmt1,filteredFmt2);});});};var isBlockFormat=format=>hasNonNullableKey(format,'block');var isWrappingBlockFormat=format=>isBlockFormat(format)&&format.wrapper===true;var isNonWrappingBlockFormat=format=>isBlockFormat(format)&&format.wrapper!==true;var isSelectorFormat=format=>hasNonNullableKey(format,'selector');var isInlineFormat=format=>hasNonNullableKey(format,'inline');var isMixedFormat=format=>isSelectorFormat(format)&&isInlineFormat(format)&&is$2(get$a(format,'mixed'),true);var shouldExpandToSelector=format=>isSelectorFormat(format)&&format.expand!==false&&!isInlineFormat(format);var isBookmarkNode=isBookmarkNode$1;var getParents$1=getParents$2;var isWhiteSpaceNode=isWhiteSpaceNode$1;var isTextBlock=isTextBlock$1;var isBogusBr=node=>{return isBr$6(node)&&node.getAttribute('data-mce-bogus')&&!node.nextSibling;};var findParentContentEditable=(dom,node)=>{var parent=node;while(parent){if(isElement$6(parent)&&dom.getContentEditable(parent)){return dom.getContentEditable(parent)==='false'?parent:node;}parent=parent.parentNode;}return node;};var walkText=(start,node,offset,predicate)=>{var str=node.data;if(start){for(var i=offset;i>0;i--){if(predicate(str.charAt(i-1))){return i;}}}else{for(var _i3=offset;_i3<str.length;_i3++){if(predicate(str.charAt(_i3))){return _i3;}}}return-1;};var findSpace=(start,node,offset)=>walkText(start,node,offset,c=>isNbsp(c)||isWhiteSpace(c));var findContent=(start,node,offset)=>walkText(start,node,offset,isContent);var findWordEndPoint=(dom,body,container,offset,start,includeTrailingSpaces)=>{var lastTextNode;var rootNode=dom.getParent(container,dom.isBlock)||body;var walk=(container,offset,pred)=>{var textSeeker=TextSeeker(dom);var walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,(text,textOffset)=>{if(isBookmarkNode(text.parentNode)){return-1;}else{lastTextNode=text;return pred(start,text,textOffset);}},rootNode));};var spaceResult=walk(container,offset,findSpace);return spaceResult.bind(result=>includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result)).orThunk(()=>lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none());};var findSelectorEndPoint=(dom,formatList,rng,container,siblingName)=>{var sibling=container[siblingName];if(isText$a(container)&&isEmpty$3(container.data)&&sibling){container=sibling;}var parents=getParents$1(dom,container);for(var i=0;i<parents.length;i++){for(var y=0;y<formatList.length;y++){var curFormat=formatList[y];if(isNonNullable(curFormat.collapsed)&&curFormat.collapsed!==rng.collapsed){continue;}if(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)){return parents[i];}}}return container;};var findBlockEndPoint=(dom,formatList,container,siblingName)=>{var _a;var node=container;var root=dom.getRoot();var format=formatList[0];if(isBlockFormat(format)){node=format.wrapper?null:dom.getParent(container,format.block,root);}if(!node){var scopeRoot=(_a=dom.getParent(container,'LI,TD,TH'))!==null&&_a!==void 0?_a:root;node=dom.getParent(isText$a(container)?container.parentNode:container,node=>node!==root&&isTextBlock(dom.schema,node),scopeRoot);}if(node&&isBlockFormat(format)&&format.wrapper){node=getParents$1(dom,node,'ul,ol').reverse()[0]||node;}if(!node){node=container;while(node&&node[siblingName]&&!dom.isBlock(node[siblingName])){node=node[siblingName];if(isEq$5(node,'br')){break;}}}return node||container;};var isAtBlockBoundary$1=(dom,root,container,siblingName)=>{var parent=container.parentNode;if(isNonNullable(container[siblingName])){return false;}else if(parent===root||isNullable(parent)||dom.isBlock(parent)){return true;}else{return isAtBlockBoundary$1(dom,root,parent,siblingName);}};var findParentContainer=(dom,formatList,container,offset,start)=>{var parent=container;var siblingName=start?'previousSibling':'nextSibling';var root=dom.getRoot();if(isText$a(container)&&!isWhiteSpaceNode(container)){if(start?offset>0:offset<container.data.length){return container;}}while(parent){if(!formatList[0].block_expand&&dom.isBlock(parent)){return parent;}for(var _sibling8=parent[siblingName];_sibling8;_sibling8=_sibling8[siblingName]){var allowSpaces=isText$a(_sibling8)&&!isAtBlockBoundary$1(dom,root,_sibling8,siblingName);if(!isBookmarkNode(_sibling8)&&!isBogusBr(_sibling8)&&!isWhiteSpaceNode(_sibling8,allowSpaces)){return parent;}}if(parent===root||parent.parentNode===root){container=parent;break;}parent=parent.parentNode;}return container;};var isSelfOrParentBookmark=container=>isBookmarkNode(container.parentNode)||isBookmarkNode(container);var expandRng=function expandRng(dom,rng,formatList){var includeTrailingSpace=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var{startContainer,startOffset,endContainer,endOffset}=rng;var format=formatList[0];if(isElement$6(startContainer)&&startContainer.hasChildNodes()){startContainer=getNode$1(startContainer,startOffset);if(isText$a(startContainer)){startOffset=0;}}if(isElement$6(endContainer)&&endContainer.hasChildNodes()){endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1);if(isText$a(endContainer)){endOffset=endContainer.data.length;}}startContainer=findParentContentEditable(dom,startContainer);endContainer=findParentContentEditable(dom,endContainer);if(isSelfOrParentBookmark(startContainer)){startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode;if(rng.collapsed){startContainer=startContainer.previousSibling||startContainer;}else{startContainer=startContainer.nextSibling||startContainer;}if(isText$a(startContainer)){startOffset=rng.collapsed?startContainer.length:0;}}if(isSelfOrParentBookmark(endContainer)){endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode;if(rng.collapsed){endContainer=endContainer.nextSibling||endContainer;}else{endContainer=endContainer.previousSibling||endContainer;}if(isText$a(endContainer)){endOffset=rng.collapsed?0:endContainer.length;}}if(rng.collapsed){var startPoint=findWordEndPoint(dom,dom.getRoot(),startContainer,startOffset,true,includeTrailingSpace);startPoint.each(_ref8=>{var{container,offset}=_ref8;startContainer=container;startOffset=offset;});var endPoint=findWordEndPoint(dom,dom.getRoot(),endContainer,endOffset,false,includeTrailingSpace);endPoint.each(_ref9=>{var{container,offset}=_ref9;endContainer=container;endOffset=offset;});}if(isInlineFormat(format)||format.block_expand){if(!isInlineFormat(format)||!isText$a(startContainer)||startOffset===0){startContainer=findParentContainer(dom,formatList,startContainer,startOffset,true);}if(!isInlineFormat(format)||!isText$a(endContainer)||endOffset===endContainer.data.length){endContainer=findParentContainer(dom,formatList,endContainer,endOffset,false);}}if(shouldExpandToSelector(format)){startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,'previousSibling');endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,'nextSibling');}if(isBlockFormat(format)||isSelectorFormat(format)){startContainer=findBlockEndPoint(dom,formatList,startContainer,'previousSibling');endContainer=findBlockEndPoint(dom,formatList,endContainer,'nextSibling');if(isBlockFormat(format)){if(!dom.isBlock(startContainer)){startContainer=findParentContainer(dom,formatList,startContainer,startOffset,true);}if(!dom.isBlock(endContainer)){endContainer=findParentContainer(dom,formatList,endContainer,endOffset,false);}}}if(isElement$6(startContainer)&&startContainer.parentNode){startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(isElement$6(endContainer)&&endContainer.parentNode){endOffset=dom.nodeIndex(endContainer)+1;endContainer=endContainer.parentNode;}return{startContainer,startOffset,endContainer,endOffset};};var walk$3=(dom,rng,callback)=>{var _a;var startOffset=rng.startOffset;var startContainer=getNode$1(rng.startContainer,startOffset);var endOffset=rng.endOffset;var endContainer=getNode$1(rng.endContainer,endOffset-1);var exclude=nodes=>{var firstNode=nodes[0];if(isText$a(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length){nodes.splice(0,1);}var lastNode=nodes[nodes.length-1];if(endOffset===0&&nodes.length>0&&lastNode===endContainer&&isText$a(lastNode)){nodes.splice(nodes.length-1,1);}return nodes;};var collectSiblings=(node,name,endNode)=>{var siblings=[];for(;node&&node!==endNode;node=node[name]){siblings.push(node);}return siblings;};var findEndPoint=(node,root)=>dom.getParent(node,node=>node.parentNode===root,root);var walkBoundary=(startNode,endNode,next)=>{var siblingName=next?'nextSibling':'previousSibling';for(var node=startNode,_parent3=node.parentNode;node&&node!==endNode;node=_parent3){_parent3=node.parentNode;var _siblings=collectSiblings(node===startNode?node:node[siblingName],siblingName);if(_siblings.length){if(!next){_siblings.reverse();}callback(exclude(_siblings));}}};if(startContainer===endContainer){return callback(exclude([startContainer]));}var ancestor=(_a=dom.findCommonAncestor(startContainer,endContainer))!==null&&_a!==void 0?_a:dom.getRoot();if(dom.isChildOf(startContainer,endContainer)){return walkBoundary(startContainer,ancestor,true);}if(dom.isChildOf(endContainer,startContainer)){return walkBoundary(endContainer,ancestor);}var startPoint=findEndPoint(startContainer,ancestor)||startContainer;var endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,true);var siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,'nextSibling',endPoint===endContainer?endPoint.nextSibling:endPoint);if(siblings.length){callback(exclude(siblings));}walkBoundary(endContainer,endPoint);};var validBlocks=['pre[class*=language-][contenteditable=\"false\"]','figure.image','div[data-ephox-embed-iri]','div.tiny-pageembed','div.mce-toc','div[data-mce-toc]'];var isZeroWidth=elem=>isText$b(elem)&&get$3(elem)===ZWSP$1;var context=(editor,elem,wrapName,nodeName)=>parent(elem).fold(()=>'skipping',parent=>{if(nodeName==='br'||isZeroWidth(elem)){return'valid';}else if(isAnnotation(elem)){return'existing';}else if(isCaretNode(elem.dom)){return'caret';}else if(exists(validBlocks,selector=>is$1(elem,selector))){return'valid-block';}else if(!isValid(editor,wrapName,nodeName)||!isValid(editor,name(parent),wrapName)){return'invalid-child';}else{return'valid';}});var applyWordGrab=(editor,rng)=>{var r=expandRng(editor.dom,rng,[{inline:'span'}]);rng.setStart(r.startContainer,r.startOffset);rng.setEnd(r.endContainer,r.endOffset);editor.selection.setRng(rng);};var applyAnnotation=(elem,masterUId,data,annotationName,decorate,directAnnotation)=>{var{uid=masterUId}=data,otherData=_objectWithoutProperties(data,_excluded);add$2(elem,annotation());set$3(elem,\"\".concat(dataAnnotationId()),uid);set$3(elem,\"\".concat(dataAnnotation()),annotationName);var{attributes={},classes=[]}=decorate(uid,otherData);setAll$1(elem,attributes);add(elem,classes);if(directAnnotation){if(classes.length>0){set$3(elem,\"\".concat(dataAnnotationClasses()),classes.join(','));}var attributeNames=keys(attributes);if(attributeNames.length>0){set$3(elem,\"\".concat(dataAnnotationAttributes()),attributeNames.join(','));}}};var removeDirectAnnotation=elem=>{remove$7(elem,annotation());remove$a(elem,\"\".concat(dataAnnotationId()));remove$a(elem,\"\".concat(dataAnnotation()));remove$a(elem,\"\".concat(dataAnnotationActive()));var customAttrNames=getOpt(elem,\"\".concat(dataAnnotationAttributes())).map(names=>names.split(',')).getOr([]);var customClasses=getOpt(elem,\"\".concat(dataAnnotationClasses())).map(names=>names.split(',')).getOr([]);each$e(customAttrNames,name=>remove$a(elem,name));remove$4(elem,customClasses);remove$a(elem,\"\".concat(dataAnnotationClasses()));remove$a(elem,\"\".concat(dataAnnotationAttributes()));};var makeAnnotation=(eDoc,uid,data,annotationName,decorate)=>{var master=SugarElement.fromTag('span',eDoc);applyAnnotation(master,uid,data,annotationName,decorate,false);return master;};var annotate=(editor,rng,uid,annotationName,decorate,data)=>{var newWrappers=[];var master=makeAnnotation(editor.getDoc(),uid,data,annotationName,decorate);var wrapper=value$2();var finishWrapper=()=>{wrapper.clear();};var getOrOpenWrapper=()=>wrapper.get().getOrThunk(()=>{var nu=shallow$1(master);newWrappers.push(nu);wrapper.set(nu);return nu;});var processElements=elems=>{each$e(elems,processElement);};var processElement=elem=>{var ctx=context(editor,elem,'span',name(elem));switch(ctx){case'invalid-child':{finishWrapper();var _children3=children$1(elem);processElements(_children3);finishWrapper();break;}case'valid-block':{finishWrapper();applyAnnotation(elem,uid,data,annotationName,decorate,true);break;}case'valid':{var w=getOrOpenWrapper();wrap$2(elem,w);break;}}};var processNodes=nodes=>{var elems=map$3(nodes,SugarElement.fromDom);processElements(elems);};walk$3(editor.dom,rng,nodes=>{finishWrapper();processNodes(nodes);});return newWrappers;};var annotateWithBookmark=(editor,name,settings,data)=>{editor.undoManager.transact(()=>{var selection=editor.selection;var initialRng=selection.getRng();var hasFakeSelection=getCellsFromEditor(editor).length>0;var masterUid=generate$1('mce-annotation');if(initialRng.collapsed&&!hasFakeSelection){applyWordGrab(editor,initialRng);}if(selection.getRng().collapsed&&!hasFakeSelection){var wrapper=makeAnnotation(editor.getDoc(),masterUid,data,name,settings.decorate);set$1(wrapper,nbsp);selection.getRng().insertNode(wrapper.dom);selection.select(wrapper.dom);}else{preserve(selection,false,()=>{runOnRanges(editor,selectionRng=>{annotate(editor,selectionRng,masterUid,name,settings.decorate,data);});});}});};var Annotator=editor=>{var registry=create$c();setup$w(editor,registry);var changes=setup$x(editor,registry);var isSpan=isTag('span');var removeAnnotations=elements=>{each$e(elements,element=>{if(isSpan(element)){unwrap(element);}else{removeDirectAnnotation(element);}});};return{register:(name,settings)=>{registry.register(name,settings);},annotate:(name,data)=>{registry.lookup(name).each(settings=>{annotateWithBookmark(editor,name,settings,data);});},annotationChanged:(name,callback)=>{changes.addListener(name,callback);},remove:name=>{identify(editor,Optional.some(name)).each(_ref10=>{var{elements}=_ref10;var bookmark=editor.selection.getBookmark();removeAnnotations(elements);editor.selection.moveToBookmark(bookmark);});},removeAll:name=>{var bookmark=editor.selection.getBookmark();each$d(findAll(editor,name),(elements,_)=>{removeAnnotations(elements);});editor.selection.moveToBookmark(bookmark);},getAll:name=>{var directory=findAll(editor,name);return map$2(directory,elems=>map$3(elems,elem=>elem.dom));}};};var BookmarkManager=selection=>{return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)};};BookmarkManager.isBookmarkNode=isBookmarkNode$1;var isXYWithinRange=(clientX,clientY,range)=>{if(range.collapsed){return false;}else{return exists(range.getClientRects(),rect=>containsXY(rect,clientX,clientY));}};var firePreProcess=(editor,args)=>editor.dispatch('PreProcess',args);var firePostProcess=(editor,args)=>editor.dispatch('PostProcess',args);var fireRemove=editor=>{editor.dispatch('remove');};var fireDetach=editor=>{editor.dispatch('detach');};var fireSwitchMode=(editor,mode)=>{editor.dispatch('SwitchMode',{mode});};var fireObjectResizeStart=(editor,target,width,height,origin)=>{editor.dispatch('ObjectResizeStart',{target,width,height,origin});};var fireObjectResized=(editor,target,width,height,origin)=>{editor.dispatch('ObjectResized',{target,width,height,origin});};var firePreInit=editor=>{editor.dispatch('PreInit');};var firePostRender=editor=>{editor.dispatch('PostRender');};var fireInit=editor=>{editor.dispatch('Init');};var firePlaceholderToggle=(editor,state)=>{editor.dispatch('PlaceholderToggle',{state});};var fireError=(editor,errorType,error)=>{editor.dispatch(errorType,error);};var fireFormatApply=(editor,format,node,vars)=>{editor.dispatch('FormatApply',{format,node,vars});};var fireFormatRemove=(editor,format,node,vars)=>{editor.dispatch('FormatRemove',{format,node,vars});};var fireBeforeSetContent=(editor,args)=>editor.dispatch('BeforeSetContent',args);var fireSetContent=(editor,args)=>editor.dispatch('SetContent',args);var fireBeforeGetContent=(editor,args)=>editor.dispatch('BeforeGetContent',args);var fireGetContent=(editor,args)=>editor.dispatch('GetContent',args);var fireAutocompleterStart=(editor,args)=>{editor.dispatch('AutocompleterStart',args);};var fireAutocompleterUpdate=(editor,args)=>{editor.dispatch('AutocompleterUpdate',args);};var fireAutocompleterEnd=editor=>{editor.dispatch('AutocompleterEnd');};var firePastePreProcess=(editor,html,internal)=>editor.dispatch('PastePreProcess',{content:html,internal});var firePastePostProcess=(editor,node,internal)=>editor.dispatch('PastePostProcess',{node,internal});var firePastePlainTextToggle=(editor,state)=>editor.dispatch('PastePlainTextToggle',{state});var fireEditableRootStateChange=(editor,state)=>editor.dispatch('EditableRootStateChange',{state});var VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:e=>{return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e);},metaKeyPressed:e=>{return Env.os.isMacOS()||Env.os.isiOS()?e.metaKey:e.ctrlKey&&!e.altKey;}};var elementSelectionAttr='data-mce-selected';var controlElmSelector='table,img,figure.image,hr,video,span.mce-preview-object,details';var abs=Math.abs;var round$1=Math.round;var resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var isTouchEvent=evt=>evt.type==='longpress'||evt.type.indexOf('touch')===0;var ControlSelection=(selection,editor)=>{var dom=editor.dom;var editableDoc=editor.getDoc();var rootDocument=document;var rootElement=editor.getBody();var selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop;var startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted;var width;var height;var startScrollWidth;var startScrollHeight;var isImage=elm=>isNonNullable(elm)&&(isImg(elm)||dom.is(elm,'figure.image'));var isMedia=elm=>isMedia$2(elm)||dom.hasClass(elm,'mce-preview-object');var isEventOnImageOutsideRange=(evt,range)=>{if(isTouchEvent(evt)){var touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range);}else{return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range);}};var contextMenuSelectImage=evt=>{var target=evt.target;if(isEventOnImageOutsideRange(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()){editor.selection.select(target);}};var getResizeTargets=elm=>{if(dom.hasClass(elm,'mce-preview-object')&&isNonNullable(elm.firstElementChild)){return[elm,elm.firstElementChild];}else if(dom.is(elm,'figure.image')){return[elm.querySelector('img')];}else{return[elm];}};var isResizable=elm=>{var selector=getObjectResizing(editor);if(!selector){return false;}if(elm.getAttribute('data-mce-resize')==='false'){return false;}if(elm===editor.getBody()){return false;}if(dom.hasClass(elm,'mce-preview-object')&&isNonNullable(elm.firstElementChild)){return is$1(SugarElement.fromDom(elm.firstElementChild),selector);}else{return is$1(SugarElement.fromDom(elm),selector);}};var createGhostElement=elm=>{if(isMedia(elm)){return dom.create('img',{src:Env.transparentSrc});}else{return elm.cloneNode(true);}};var setSizeProp=(element,name,value)=>{if(isNonNullable(value)){var targets=getResizeTargets(element);each$e(targets,target=>{if(target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)){dom.setStyle(target,name,value);}else{dom.setAttrib(target,name,''+value);}});}};var setGhostElmSize=(ghostElm,width,height)=>{setSizeProp(ghostElm,'width',width);setSizeProp(ghostElm,'height',height);};var resizeGhostElement=e=>{var deltaX,deltaY,proportional;var resizeHelperX,resizeHelperY;deltaX=e.screenX-startX;deltaY=e.screenY-startY;width=deltaX*selectedHandle[2]+startW;height=deltaY*selectedHandle[3]+startH;width=width<5?5:width;height=height<5?5:height;if((isImage(selectedElm)||isMedia(selectedElm))&&getResizeImgProportional(editor)!==false){proportional=!VK.modifierPressed(e);}else{proportional=VK.modifierPressed(e);}if(proportional){if(abs(deltaX)>abs(deltaY)){height=round$1(width*ratio);width=round$1(height/ratio);}else{width=round$1(height/ratio);height=round$1(width*ratio);}}setGhostElmSize(selectedElmGhost,width,height);resizeHelperX=selectedHandle.startPos.x+deltaX;resizeHelperY=selectedHandle.startPos.y+deltaY;resizeHelperX=resizeHelperX>0?resizeHelperX:0;resizeHelperY=resizeHelperY>0?resizeHelperY:0;dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:'block'});resizeHelper.innerHTML=width+' &times; '+height;if(selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width){dom.setStyle(selectedElmGhost,'left',selectedElmX+(startW-width));}if(selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height){dom.setStyle(selectedElmGhost,'top',selectedElmY+(startH-height));}deltaX=rootElement.scrollWidth-startScrollWidth;deltaY=rootElement.scrollHeight-startScrollHeight;if(deltaX+deltaY!==0){dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY});}if(!resizeStarted){fireObjectResizeStart(editor,selectedElm,startW,startH,'corner-'+selectedHandle.name);resizeStarted=true;}};var endGhostResize=()=>{var wasResizeStarted=resizeStarted;resizeStarted=false;if(wasResizeStarted){setSizeProp(selectedElm,'width',width);setSizeProp(selectedElm,'height',height);}dom.unbind(editableDoc,'mousemove',resizeGhostElement);dom.unbind(editableDoc,'mouseup',endGhostResize);if(rootDocument!==editableDoc){dom.unbind(rootDocument,'mousemove',resizeGhostElement);dom.unbind(rootDocument,'mouseup',endGhostResize);}dom.remove(selectedElmGhost);dom.remove(resizeHelper);dom.remove(resizeBackdrop);showResizeRect(selectedElm);if(wasResizeStarted){fireObjectResized(editor,selectedElm,width,height,'corner-'+selectedHandle.name);dom.setAttrib(selectedElm,'style',dom.getAttrib(selectedElm,'style'));}editor.nodeChanged();};var showResizeRect=targetElm=>{unbindResizeHandleEvents();var position=dom.getPos(targetElm,rootElement);var selectedElmX=position.x;var selectedElmY=position.y;var rect=targetElm.getBoundingClientRect();var targetWidth=rect.width||rect.right-rect.left;var targetHeight=rect.height||rect.bottom-rect.top;if(selectedElm!==targetElm){hideResizeRect();selectedElm=targetElm;width=height=0;}var e=editor.dispatch('ObjectSelected',{target:targetElm});if(isResizable(targetElm)&&!e.isDefaultPrevented()){each$d(resizeHandles,(handle,name)=>{var startDrag=e=>{var target=getResizeTargets(selectedElm)[0];startX=e.screenX;startY=e.screenY;startW=target.clientWidth;startH=target.clientHeight;ratio=startH/startW;selectedHandle=handle;selectedHandle.name=name;selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY};startScrollWidth=rootElement.scrollWidth;startScrollHeight=rootElement.scrollHeight;resizeBackdrop=dom.add(rootElement,'div',{'class':'mce-resize-backdrop','data-mce-bogus':'all'});dom.setStyles(resizeBackdrop,{position:'fixed',left:'0',top:'0',width:'100%',height:'100%'});selectedElmGhost=createGhostElement(selectedElm);dom.addClass(selectedElmGhost,'mce-clonedresizable');dom.setAttrib(selectedElmGhost,'data-mce-bogus','all');selectedElmGhost.contentEditable='false';dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0});setGhostElmSize(selectedElmGhost,targetWidth,targetHeight);selectedElmGhost.removeAttribute(elementSelectionAttr);rootElement.appendChild(selectedElmGhost);dom.bind(editableDoc,'mousemove',resizeGhostElement);dom.bind(editableDoc,'mouseup',endGhostResize);if(rootDocument!==editableDoc){dom.bind(rootDocument,'mousemove',resizeGhostElement);dom.bind(rootDocument,'mouseup',endGhostResize);}resizeHelper=dom.add(rootElement,'div',{'class':'mce-resize-helper','data-mce-bogus':'all'},startW+' &times; '+startH);};var handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.remove(handleElm);}handleElm=dom.add(rootElement,'div',{'id':'mceResizeHandle'+name,'data-mce-bogus':'all','class':'mce-resizehandle','unselectable':true,'style':'cursor:'+name+'-resize; margin:0; padding:0'});dom.bind(handleElm,'mousedown',e=>{e.stopImmediatePropagation();e.preventDefault();startDrag(e);});handle.elm=handleElm;dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2});});}else{hideResizeRect(false);}};var throttledShowResizeRect=first$1(showResizeRect,0);var hideResizeRect=function hideResizeRect(){var removeSelected=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;throttledShowResizeRect.cancel();unbindResizeHandleEvents();if(selectedElm&&removeSelected){selectedElm.removeAttribute(elementSelectionAttr);}each$d(resizeHandles,(value,name)=>{var handleElm=dom.get('mceResizeHandle'+name);if(handleElm){dom.unbind(handleElm);dom.remove(handleElm);}});};var isChildOrEqual=(node,parent)=>dom.isChildOf(node,parent);var updateResizeRect=e=>{if(resizeStarted||editor.removed||editor.composing){return;}var targetElm=e.type==='mousedown'?e.target:selection.getNode();var controlElm=closest$3(SugarElement.fromDom(targetElm),controlElmSelector).map(e=>e.dom).filter(e=>dom.isEditable(e.parentElement)).getOrUndefined();var selectedValue=isNonNullable(controlElm)?dom.getAttrib(controlElm,elementSelectionAttr,'1'):'1';each$e(dom.select(\"img[\".concat(elementSelectionAttr,\"],hr[\").concat(elementSelectionAttr,\"]\")),img=>{img.removeAttribute(elementSelectionAttr);});if(isNonNullable(controlElm)&&isChildOrEqual(controlElm,rootElement)&&editor.hasFocus()){disableGeckoResize();var startElm=selection.getStart(true);if(isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(true),controlElm)){dom.setAttrib(controlElm,elementSelectionAttr,selectedValue);throttledShowResizeRect.throttle(controlElm);return;}}hideResizeRect();};var unbindResizeHandleEvents=()=>{each$d(resizeHandles,handle=>{if(handle.elm){dom.unbind(handle.elm);delete handle.elm;}});};var disableGeckoResize=()=>{try{editor.getDoc().execCommand('enableObjectResizing',false,'false');}catch(ex){}};editor.on('init',()=>{disableGeckoResize();editor.on('NodeChange ResizeEditor ResizeWindow ResizeContent drop',updateResizeRect);editor.on('keyup compositionend',e=>{if(selectedElm&&selectedElm.nodeName==='TABLE'){updateResizeRect(e);}});editor.on('hide blur',hideResizeRect);editor.on('contextmenu longpress',contextMenuSelectImage,true);});editor.on('remove',unbindResizeHandleEvents);var destroy=()=>{throttledShowResizeRect.cancel();selectedElm=selectedElmGhost=resizeBackdrop=null;};return{isResizable,showResizeRect,hideResizeRect,updateResizeRect,destroy};};var setStart=(rng,situ)=>{situ.fold(e=>{rng.setStartBefore(e.dom);},(e,o)=>{rng.setStart(e.dom,o);},e=>{rng.setStartAfter(e.dom);});};var setFinish=(rng,situ)=>{situ.fold(e=>{rng.setEndBefore(e.dom);},(e,o)=>{rng.setEnd(e.dom,o);},e=>{rng.setEndAfter(e.dom);});};var relativeToNative=(win,startSitu,finishSitu)=>{var range=win.document.createRange();setStart(range,startSitu);setFinish(range,finishSitu);return range;};var exactToNative=(win,start,soffset,finish,foffset)=>{var rng=win.document.createRange();rng.setStart(start.dom,soffset);rng.setEnd(finish.dom,foffset);return rng;};var adt$3=Adt.generate([{ltr:['start','soffset','finish','foffset']},{rtl:['start','soffset','finish','foffset']}]);var fromRange=(win,type,range)=>type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset);var getRanges=(win,selection)=>selection.match({domRange:rng=>{return{ltr:constant(rng),rtl:Optional.none};},relative:(startSitu,finishSitu)=>{return{ltr:cached(()=>relativeToNative(win,startSitu,finishSitu)),rtl:cached(()=>Optional.some(relativeToNative(win,finishSitu,startSitu)))};},exact:(start,soffset,finish,foffset)=>{return{ltr:cached(()=>exactToNative(win,start,soffset,finish,foffset)),rtl:cached(()=>Optional.some(exactToNative(win,finish,foffset,start,soffset)))};}});var doDiagnose=(win,ranges)=>{var rng=ranges.ltr();if(rng.collapsed){var reversed=ranges.rtl().filter(rev=>rev.collapsed===false);return reversed.map(rev=>adt$3.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)).getOrThunk(()=>fromRange(win,adt$3.ltr,rng));}else{return fromRange(win,adt$3.ltr,rng);}};var diagnose=(win,selection)=>{var ranges=getRanges(win,selection);return doDiagnose(win,ranges);};adt$3.ltr;adt$3.rtl;var create$a=(start,soffset,finish,foffset)=>({start,soffset,finish,foffset});var SimRange={create:create$a};var caretPositionFromPoint=(doc,x,y)=>{var _a,_b;return Optional.from((_b=(_a=doc.dom).caretPositionFromPoint)===null||_b===void 0?void 0:_b.call(_a,x,y)).bind(pos=>{if(pos.offsetNode===null){return Optional.none();}var r=doc.dom.createRange();r.setStart(pos.offsetNode,pos.offset);r.collapse();return Optional.some(r);});};var caretRangeFromPoint=(doc,x,y)=>{var _a,_b;return Optional.from((_b=(_a=doc.dom).caretRangeFromPoint)===null||_b===void 0?void 0:_b.call(_a,x,y));};var availableSearch=(()=>{if(document.caretPositionFromPoint){return caretPositionFromPoint;}else if(document.caretRangeFromPoint){return caretRangeFromPoint;}else{return Optional.none;}})();var fromPoint$1=(win,x,y)=>{var doc=SugarElement.fromDom(win.document);return availableSearch(doc,x,y).map(rng=>SimRange.create(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset));};var adt$2=Adt.generate([{before:['element']},{on:['element','offset']},{after:['element']}]);var cata=(subject,onBefore,onOn,onAfter)=>subject.fold(onBefore,onOn,onAfter);var getStart$2=situ=>situ.fold(identity,identity,identity);var before$1=adt$2.before;var on=adt$2.on;var after$1=adt$2.after;var Situ={before:before$1,on,after:after$1,cata,getStart:getStart$2};var adt$1=Adt.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var exactFromRange=simRange=>adt$1.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset);var getStart$1=selection=>selection.match({domRange:rng=>SugarElement.fromDom(rng.startContainer),relative:(startSitu,_finishSitu)=>Situ.getStart(startSitu),exact:(start,_soffset,_finish,_foffset)=>start});var domRange=adt$1.domRange;var relative=adt$1.relative;var exact=adt$1.exact;var getWin=selection=>{var start=getStart$1(selection);return defaultView(start);};var range=SimRange.create;var SimSelection={domRange,relative,exact,exactFromRange,getWin,range};var beforeSpecial=(element,offset)=>{var name$1=name(element);if('input'===name$1){return Situ.after(element);}else if(!contains$2(['br','img'],name$1)){return Situ.on(element,offset);}else{return offset===0?Situ.before(element):Situ.after(element);}};var preprocessRelative=(startSitu,finishSitu)=>{var start=startSitu.fold(Situ.before,beforeSpecial,Situ.after);var finish=finishSitu.fold(Situ.before,beforeSpecial,Situ.after);return SimSelection.relative(start,finish);};var preprocessExact=(start,soffset,finish,foffset)=>{var startSitu=beforeSpecial(start,soffset);var finishSitu=beforeSpecial(finish,foffset);return SimSelection.relative(startSitu,finishSitu);};var preprocess=selection=>selection.match({domRange:rng=>{var start=SugarElement.fromDom(rng.startContainer);var finish=SugarElement.fromDom(rng.endContainer);return preprocessExact(start,rng.startOffset,finish,rng.endOffset);},relative:preprocessRelative,exact:preprocessExact});var fromElements=(elements,scope)=>{var doc=scope||document;var fragment=doc.createDocumentFragment();each$e(elements,element=>{fragment.appendChild(element.dom);});return SugarElement.fromDom(fragment);};var toNative=selection=>{var win=SimSelection.getWin(selection).dom;var getDomRange=(start,soffset,finish,foffset)=>exactToNative(win,start,soffset,finish,foffset);var filtered=preprocess(selection);return diagnose(win,filtered).match({ltr:getDomRange,rtl:getDomRange});};var getAtPoint=(win,x,y)=>fromPoint$1(win,x,y);var fromPoint=(clientX,clientY,doc)=>{var win=defaultView(SugarElement.fromDom(doc));return getAtPoint(win.dom,clientX,clientY).map(simRange=>{var rng=doc.createRange();rng.setStart(simRange.start.dom,simRange.soffset);rng.setEnd(simRange.finish.dom,simRange.foffset);return rng;}).getOrUndefined();};var isEq$4=(rng1,rng2)=>{return isNonNullable(rng1)&&isNonNullable(rng2)&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset;};var findParent=(node,rootNode,predicate)=>{var currentNode=node;while(currentNode&&currentNode!==rootNode){if(predicate(currentNode)){return currentNode;}currentNode=currentNode.parentNode;}return null;};var hasParent$1=(node,rootNode,predicate)=>findParent(node,rootNode,predicate)!==null;var hasParentWithName=(node,rootNode,name)=>hasParent$1(node,rootNode,node=>node.nodeName===name);var isCeFalseCaretContainer=(node,rootNode)=>isCaretContainer$2(node)&&!hasParent$1(node,rootNode,isCaretNode);var hasBrBeforeAfter=(dom,node,left)=>{var parentNode=node.parentNode;if(parentNode){var walker=new DomTreeWalker(node,dom.getParent(parentNode,dom.isBlock)||dom.getRoot());var currentNode;while(currentNode=walker[left?'prev':'next']()){if(isBr$6(currentNode)){return true;}}}return false;};var isPrevNode=(node,name)=>{var _a;return((_a=node.previousSibling)===null||_a===void 0?void 0:_a.nodeName)===name;};var hasContentEditableFalseParent=(root,node)=>{var currentNode=node;while(currentNode&&currentNode!==root){if(isContentEditableFalse$b(currentNode)){return true;}currentNode=currentNode.parentNode;}return false;};var findTextNodeRelative=(dom,isAfterNode,collapsed,left,startNode)=>{var body=dom.getRoot();var nonEmptyElementsMap=dom.schema.getNonEmptyElements();var parentNode=startNode.parentNode;var lastInlineElement;var node;if(!parentNode){return Optional.none();}var parentBlockContainer=dom.getParent(parentNode,dom.isBlock)||body;if(left&&isBr$6(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer)){return Optional.some(CaretPosition(parentNode,dom.nodeIndex(startNode)));}var walker=new DomTreeWalker(startNode,parentBlockContainer);while(node=walker[left?'prev':'next']()){if(dom.getContentEditableParent(node)==='false'||isCeFalseCaretContainer(node,body)){return Optional.none();}if(isText$a(node)&&node.data.length>0){if(!hasParentWithName(node,body,'A')){return Optional.some(CaretPosition(node,left?node.data.length:0));}return Optional.none();}if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()]){return Optional.none();}lastInlineElement=node;}if(isComment(lastInlineElement)){return Optional.none();}if(collapsed&&lastInlineElement){return Optional.some(CaretPosition(lastInlineElement,0));}return Optional.none();};var normalizeEndPoint=(dom,collapsed,start,rng)=>{var body=dom.getRoot();var node;var normalized=false;var container=start?rng.startContainer:rng.endContainer;var offset=start?rng.startOffset:rng.endOffset;var isAfterNode=isElement$6(container)&&offset===container.childNodes.length;var nonEmptyElementsMap=dom.schema.getNonEmptyElements();var directionLeft=start;if(isCaretContainer$2(container)){return Optional.none();}if(isElement$6(container)&&offset>container.childNodes.length-1){directionLeft=false;}if(isDocument$1(container)){container=body;offset=0;}if(container===body){if(directionLeft){node=container.childNodes[offset>0?offset-1:0];if(node){if(isCaretContainer$2(node)){return Optional.none();}if(nonEmptyElementsMap[node.nodeName]||isTable$2(node)){return Optional.none();}}}if(container.hasChildNodes()){offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1);container=container.childNodes[offset];offset=isText$a(container)&&isAfterNode?container.data.length:0;if(!collapsed&&container===body.lastChild&&isTable$2(container)){return Optional.none();}if(hasContentEditableFalseParent(body,container)||isCaretContainer$2(container)){return Optional.none();}if(container.hasChildNodes()&&!isTable$2(container)){node=container;var walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=false;break;}if(isText$a(node)&&node.data.length>0){offset=directionLeft?0:node.data.length;container=node;normalized=true;break;}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCellOrCaption(node)){offset=dom.nodeIndex(node);container=node.parentNode;if(!directionLeft){offset++;}normalized=true;break;}}while(node=directionLeft?walker.next():walker.prev());}}}if(collapsed){if(isText$a(container)&&offset===0){findTextNodeRelative(dom,isAfterNode,collapsed,true,container).each(pos=>{container=pos.container();offset=pos.offset();normalized=true;});}if(isElement$6(container)){node=container.childNodes[offset];if(!node){node=container.childNodes[offset-1];}if(node&&isBr$6(node)&&!isPrevNode(node,'A')&&!hasBrBeforeAfter(dom,node,false)&&!hasBrBeforeAfter(dom,node,true)){findTextNodeRelative(dom,isAfterNode,collapsed,true,node).each(pos=>{container=pos.container();offset=pos.offset();normalized=true;});}}}if(directionLeft&&!collapsed&&isText$a(container)&&offset===container.data.length){findTextNodeRelative(dom,isAfterNode,collapsed,false,container).each(pos=>{container=pos.container();offset=pos.offset();normalized=true;});}return normalized&&container?Optional.some(CaretPosition(container,offset)):Optional.none();};var normalize$2=(dom,rng)=>{var collapsed=rng.collapsed,normRng=rng.cloneRange();var startPos=CaretPosition.fromRangeStart(rng);normalizeEndPoint(dom,collapsed,true,normRng).each(pos=>{if(!collapsed||!CaretPosition.isAbove(startPos,pos)){normRng.setStart(pos.container(),pos.offset());}});if(!collapsed){normalizeEndPoint(dom,collapsed,false,normRng).each(pos=>{normRng.setEnd(pos.container(),pos.offset());});}if(collapsed){normRng.collapse(true);}return isEq$4(rng,normRng)?Optional.none():Optional.some(normRng);};var splitText=(node,offset)=>{return node.splitText(offset);};var split=rng=>{var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(startContainer===endContainer&&isText$a(startContainer)){if(startOffset>0&&startOffset<startContainer.data.length){endContainer=splitText(startContainer,startOffset);startContainer=endContainer.previousSibling;if(endOffset>startOffset){endOffset=endOffset-startOffset;var newContainer=splitText(endContainer,endOffset).previousSibling;startContainer=endContainer=newContainer;endOffset=newContainer.data.length;startOffset=0;}else{endOffset=0;}}}else{if(isText$a(startContainer)&&startOffset>0&&startOffset<startContainer.data.length){startContainer=splitText(startContainer,startOffset);startOffset=0;}if(isText$a(endContainer)&&endOffset>0&&endOffset<endContainer.data.length){var _newContainer=splitText(endContainer,endOffset).previousSibling;endContainer=_newContainer;endOffset=_newContainer.data.length;}}return{startContainer,startOffset,endContainer,endOffset};};var RangeUtils=dom=>{var walk=(rng,callback)=>{return walk$3(dom,rng,callback);};var split$1=split;var normalize=rng=>{return normalize$2(dom,rng).fold(never,normalizedRng=>{rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset);rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset);return true;});};var expand=function expand(rng){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{type:'word'};if(options.type==='word'){var rangeLike=expandRng(dom,rng,[{inline:'span'}]);var newRange=dom.createRng();newRange.setStart(rangeLike.startContainer,rangeLike.startOffset);newRange.setEnd(rangeLike.endContainer,rangeLike.endOffset);return newRange;}return rng;};return{walk,split:split$1,expand,normalize};};RangeUtils.compareRanges=isEq$4;RangeUtils.getCaretRangeFromPoint=fromPoint;RangeUtils.getSelectedNode=getSelectedNode;RangeUtils.getNode=getNode$1;var Dimension=(name,getOffset)=>{var set=(element,h)=>{if(!isNumber(h)&&!h.match(/^[0-9]+$/)){throw new Error(name+'.set accepts only positive integer values. Value was '+h);}var dom=element.dom;if(isSupported(dom)){dom.style[name]=h+'px';}};var get=element=>{var r=getOffset(element);if(r<=0||r===null){var css=get$7(element,name);return parseFloat(css)||0;}return r;};var getOuter=get;var aggregate=(element,properties)=>foldl(properties,(acc,property)=>{var val=get$7(element,property);var value=val===undefined?0:parseInt(val,10);return isNaN(value)?acc:acc+value;},0);var max=(element,value,properties)=>{var cumulativeInclusions=aggregate(element,properties);var absoluteMax=value>cumulativeInclusions?value-cumulativeInclusions:0;return absoluteMax;};return{set,get,getOuter,aggregate,max};};var api=Dimension('height',element=>{var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight;});var get$2=element=>api.get(element);var getDocument=()=>SugarElement.fromDom(document);var walkUp=(navigation,doc)=>{var frame=navigation.view(doc);return frame.fold(constant([]),f=>{var parent=navigation.owner(f);var rest=walkUp(navigation,parent);return[f].concat(rest);});};var pathTo=(element,navigation)=>{var d=navigation.owner(element);return walkUp(navigation,d);};var view=doc=>{var _a;var element=doc.dom===document?Optional.none():Optional.from((_a=doc.dom.defaultView)===null||_a===void 0?void 0:_a.frameElement);return element.map(SugarElement.fromDom);};var owner=element=>documentOrOwner(element);var Navigation=/*#__PURE__*/Object.freeze({__proto__:null,view:view,owner:owner});var find=element=>{var doc=getDocument();var scroll=get$5(doc);var frames=pathTo(element,Navigation);var offset=viewport(element);var r=foldr(frames,(b,a)=>{var loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top};},{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top);};var excludeFromDescend=element=>name(element)==='textarea';var fireScrollIntoViewEvent=(editor,data)=>{var scrollEvent=editor.dispatch('ScrollIntoView',data);return scrollEvent.isDefaultPrevented();};var fireAfterScrollIntoViewEvent=(editor,data)=>{editor.dispatch('AfterScrollIntoView',data);};var descend=(element,offset)=>{var children=children$1(element);if(children.length===0||excludeFromDescend(element)){return{element,offset};}else if(offset<children.length&&!excludeFromDescend(children[offset])){return{element:children[offset],offset:0};}else{var _last=children[children.length-1];if(excludeFromDescend(_last)){return{element,offset};}else{if(name(_last)==='img'){return{element:_last,offset:1};}else if(isText$b(_last)){return{element:_last,offset:get$3(_last).length};}else{return{element:_last,offset:children$1(_last).length};}}}};var markerInfo=(element,cleanupFun)=>{var pos=absolute(element);var height=get$2(element);return{element,bottom:pos.top+height,height,pos,cleanup:cleanupFun};};var createMarker$1=(element,offset)=>{var startPoint=descend(element,offset);var span=SugarElement.fromHtml('<span data-mce-bogus=\"all\" style=\"display: inline-block;\">'+ZWSP$1+'</span>');before$3(startPoint.element,span);return markerInfo(span,()=>remove$5(span));};var elementMarker=element=>markerInfo(SugarElement.fromDom(element),noop);var withMarker=(editor,f,rng,alignToTop)=>{preserveWith(editor,(_s,_e)=>applyWithMarker(editor,f,rng,alignToTop),rng);};var withScrollEvents=(editor,doc,f,marker,alignToTop)=>{var data={elm:marker.element.dom,alignToTop};if(fireScrollIntoViewEvent(editor,data)){return;}var scrollTop=get$5(doc).top;f(editor,doc,scrollTop,marker,alignToTop);fireAfterScrollIntoViewEvent(editor,data);};var applyWithMarker=(editor,f,rng,alignToTop)=>{var body=SugarElement.fromDom(editor.getBody());var doc=SugarElement.fromDom(editor.getDoc());reflow(body);var marker=createMarker$1(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop);marker.cleanup();};var withElement=(editor,element,f,alignToTop)=>{var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,elementMarker(element),alignToTop);};var preserveWith=(editor,f,rng)=>{var startElement=rng.startContainer;var startOffset=rng.startOffset;var endElement=rng.endContainer;var endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));var newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset);newRng.setEnd(endElement,endOffset);editor.selection.setRng(rng);};var scrollToMarker=(editor,marker,viewHeight,alignToTop,doc)=>{var pos=marker.pos;if(alignToTop){to(pos.left,pos.top,doc);}else{var y=pos.top-viewHeight+marker.height;to(-editor.getBody().getBoundingClientRect().left,y,doc);}};var intoWindowIfNeeded=(editor,doc,scrollTop,viewHeight,marker,alignToTop)=>{var viewportBottom=viewHeight+scrollTop;var markerTop=marker.pos.top;var markerBottom=marker.bottom;var largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop){scrollToMarker(editor,marker,viewHeight,alignToTop!==false,doc);}else if(markerTop>viewportBottom){var align=largerThanViewport?alignToTop!==false:alignToTop===true;scrollToMarker(editor,marker,viewHeight,align,doc);}else if(markerBottom>viewportBottom&&!largerThanViewport){scrollToMarker(editor,marker,viewHeight,alignToTop===true,doc);}};var intoWindow=(editor,doc,scrollTop,marker,alignToTop)=>{var viewHeight=defaultView(doc).dom.innerHeight;intoWindowIfNeeded(editor,doc,scrollTop,viewHeight,marker,alignToTop);};var intoFrame=(editor,doc,scrollTop,marker,alignToTop)=>{var frameViewHeight=defaultView(doc).dom.innerHeight;intoWindowIfNeeded(editor,doc,scrollTop,frameViewHeight,marker,alignToTop);var op=find(marker.element);var viewportBounds=getBounds(window);if(op.top<viewportBounds.y){intoView(marker.element,alignToTop!==false);}else if(op.top>viewportBounds.bottom){intoView(marker.element,alignToTop===true);}};var rangeIntoWindow=(editor,rng,alignToTop)=>withMarker(editor,intoWindow,rng,alignToTop);var elementIntoWindow=(editor,element,alignToTop)=>withElement(editor,element,intoWindow,alignToTop);var rangeIntoFrame=(editor,rng,alignToTop)=>withMarker(editor,intoFrame,rng,alignToTop);var elementIntoFrame=(editor,element,alignToTop)=>withElement(editor,element,intoFrame,alignToTop);var scrollElementIntoView=(editor,element,alignToTop)=>{var scroller=editor.inline?elementIntoWindow:elementIntoFrame;scroller(editor,element,alignToTop);};var scrollRangeIntoView=(editor,rng,alignToTop)=>{var scroller=editor.inline?rangeIntoWindow:rangeIntoFrame;scroller(editor,rng,alignToTop);};var focus$1=element=>element.dom.focus();var hasFocus$1=element=>{var root=getRootNode(element).dom;return element.dom===root.activeElement;};var active$1=function active$1(){var root=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getDocument();return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);};var search=element=>active$1(getRootNode(element)).filter(e=>element.dom.contains(e.dom));var clamp$1=(offset,element)=>{var max=isText$b(element)?get$3(element).length:children$1(element).length+1;if(offset>max){return max;}else if(offset<0){return 0;}return offset;};var normalizeRng=rng=>SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish));var isOrContains=(root,elm)=>!isRestrictedNode(elm.dom)&&(contains(root,elm)||eq(root,elm));var isRngInRoot=root=>rng=>isOrContains(root,rng.start)&&isOrContains(root,rng.finish);var shouldStore=editor=>editor.inline||Env.browser.isFirefox();var nativeRangeToSelectionRange=r=>SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset);var readRange=win=>{var selection=win.getSelection();var rng=!selection||selection.rangeCount===0?Optional.none():Optional.from(selection.getRangeAt(0));return rng.map(nativeRangeToSelectionRange);};var getBookmark=root=>{var win=defaultView(root);return readRange(win.dom).filter(isRngInRoot(root));};var validate=(root,bookmark)=>Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);var bookmarkToNativeRng=bookmark=>{var rng=document.createRange();try{rng.setStart(bookmark.start.dom,bookmark.soffset);rng.setEnd(bookmark.finish.dom,bookmark.foffset);return Optional.some(rng);}catch(_){return Optional.none();}};var store=editor=>{var newBookmark=shouldStore(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark;};var getRng=editor=>{var bookmark=editor.bookmark?editor.bookmark:Optional.none();return bookmark.bind(x=>validate(SugarElement.fromDom(editor.getBody()),x)).bind(bookmarkToNativeRng);};var restore=editor=>{getRng(editor).each(rng=>editor.selection.setRng(rng));};var isEditorUIElement$1=elm=>{var className=elm.className.toString();return className.indexOf('tox-')!==-1||className.indexOf('mce-')!==-1;};var FocusManager={isEditorUIElement:isEditorUIElement$1};var wrappedSetTimeout=(callback,time)=>{if(!isNumber(time)){time=0;}return setTimeout(callback,time);};var wrappedSetInterval=(callback,time)=>{if(!isNumber(time)){time=0;}return setInterval(callback,time);};var Delay={setEditorTimeout:(editor,callback,time)=>{return wrappedSetTimeout(()=>{if(!editor.removed){callback();}},time);},setEditorInterval:(editor,callback,time)=>{var timer=wrappedSetInterval(()=>{if(!editor.removed){callback();}else{clearInterval(timer);}},time);return timer;}};var isManualNodeChange=e=>{return e.type==='nodechange'&&e.selectionChange;};var registerPageMouseUp=(editor,throttledStore)=>{var mouseUpPage=()=>{throttledStore.throttle();};DOMUtils.DOM.bind(document,'mouseup',mouseUpPage);editor.on('remove',()=>{DOMUtils.DOM.unbind(document,'mouseup',mouseUpPage);});};var registerMouseUp=(editor,throttledStore)=>{editor.on('mouseup touchend',_e=>{throttledStore.throttle();});};var registerEditorEvents=(editor,throttledStore)=>{registerMouseUp(editor,throttledStore);editor.on('keyup NodeChange AfterSetSelectionRange',e=>{if(!isManualNodeChange(e)){store(editor);}});};var register$6=editor=>{var throttledStore=first$1(()=>{store(editor);},0);editor.on('init',()=>{if(editor.inline){registerPageMouseUp(editor,throttledStore);}registerEditorEvents(editor,throttledStore);});editor.on('remove',()=>{throttledStore.cancel();});};var documentFocusInHandler;var DOM$9=DOMUtils.DOM;var isEditorUIElement=elm=>{return isElement$6(elm)&&FocusManager.isEditorUIElement(elm);};var isEditorContentAreaElement=elm=>{var classList=elm.classList;if(classList!==undefined){return classList.contains('tox-edit-area')||classList.contains('tox-edit-area__iframe')||classList.contains('mce-content-body');}else{return false;}};var isUIElement=(editor,elm)=>{var customSelector=getCustomUiSelector(editor);var parent=DOM$9.getParent(elm,elm=>{return isEditorUIElement(elm)||(customSelector?editor.dom.is(elm,customSelector):false);});return parent!==null;};var getActiveElement=editor=>{try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active$1(root).fold(()=>document.body,x=>x.dom);}catch(ex){return document.body;}};var registerEvents$1=(editorManager,e)=>{var editor=e.editor;register$6(editor);var toggleContentAreaOnFocus=(editor,fn)=>{if(shouldHighlightOnFocus(editor)&&editor.inline!==true){var contentArea=SugarElement.fromDom(editor.getContainer());fn(contentArea,'tox-edit-focus');}};editor.on('focusin',()=>{var focusedEditor=editorManager.focusedEditor;if(isEditorContentAreaElement(getActiveElement(editor))){toggleContentAreaOnFocus(editor,add$2);}if(focusedEditor!==editor){if(focusedEditor){focusedEditor.dispatch('blur',{focusedEditor:editor});}editorManager.setActive(editor);editorManager.focusedEditor=editor;editor.dispatch('focus',{blurredEditor:focusedEditor});editor.focus(true);}});editor.on('focusout',()=>{Delay.setEditorTimeout(editor,()=>{var focusedEditor=editorManager.focusedEditor;if(!isEditorContentAreaElement(getActiveElement(editor))||focusedEditor!==editor){toggleContentAreaOnFocus(editor,remove$7);}if(!isUIElement(editor,getActiveElement(editor))&&focusedEditor===editor){editor.dispatch('blur',{focusedEditor:null});editorManager.focusedEditor=null;}});});if(!documentFocusInHandler){documentFocusInHandler=e=>{var activeEditor=editorManager.activeEditor;if(activeEditor){getOriginalEventTarget(e).each(target=>{var elem=target;if(elem.ownerDocument===document){if(elem!==document.body&&!isUIElement(activeEditor,elem)&&editorManager.focusedEditor===activeEditor){activeEditor.dispatch('blur',{focusedEditor:null});editorManager.focusedEditor=null;}}});}};DOM$9.bind(document,'focusin',documentFocusInHandler);}};var unregisterDocumentEvents=(editorManager,e)=>{if(editorManager.focusedEditor===e.editor){editorManager.focusedEditor=null;}if(!editorManager.activeEditor&&documentFocusInHandler){DOM$9.unbind(document,'focusin',documentFocusInHandler);documentFocusInHandler=null;}};var setup$v=editorManager=>{editorManager.on('AddEditor',curry(registerEvents$1,editorManager));editorManager.on('RemoveEditor',curry(unregisterDocumentEvents,editorManager));};var getContentEditableHost=(editor,node)=>editor.dom.getParent(node,node=>editor.dom.getContentEditable(node)==='true');var getCollapsedNode=rng=>rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none();var getFocusInElement=(root,rng)=>getCollapsedNode(rng).bind(node=>{if(isTableSection(node)){return Optional.some(node);}else if(!contains(root,node)){return Optional.some(root);}else{return Optional.none();}});var normalizeSelection=(editor,rng)=>{getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind(elm=>{return firstPositionIn(elm.dom);}).fold(()=>{editor.selection.normalize();},caretPos=>editor.selection.setRng(caretPos.toRange()));};var focusBody=body=>{if(body.setActive){try{body.setActive();}catch(ex){body.focus();}}else{body.focus();}};var hasElementFocus=elm=>hasFocus$1(elm)||search(elm).isSome();var hasIframeFocus=editor=>isNonNullable(editor.iframeElement)&&hasFocus$1(SugarElement.fromDom(editor.iframeElement));var hasInlineFocus=editor=>{var rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody));};var hasUiFocus=editor=>{var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active$1(dos).filter(elem=>!isEditorContentAreaElement(elem.dom)&&isUIElement(editor,elem.dom)).isSome();};var hasFocus=editor=>editor.inline?hasInlineFocus(editor):hasIframeFocus(editor);var hasEditorOrUiFocus=editor=>hasFocus(editor)||hasUiFocus(editor);var focusEditor=editor=>{var selection=editor.selection;var body=editor.getBody();var rng=selection.getRng();editor.quirks.refreshContentEditable();if(isNonNullable(editor.bookmark)&&!hasFocus(editor)){getRng(editor).each(bookmarkRng=>{editor.selection.setRng(bookmarkRng);rng=bookmarkRng;});}var contentEditableHost=getContentEditableHost(editor,selection.getNode());if(contentEditableHost&&editor.dom.isChildOf(contentEditableHost,body)){focusBody(contentEditableHost);normalizeSelection(editor,rng);activateEditor(editor);return;}if(!editor.inline){if(!Env.browser.isOpera()){focusBody(body);}editor.getWin().focus();}if(Env.browser.isFirefox()||editor.inline){focusBody(body);normalizeSelection(editor,rng);}activateEditor(editor);};var activateEditor=editor=>editor.editorManager.setActive(editor);var focus=(editor,skipFocus)=>{if(editor.removed){return;}if(skipFocus){activateEditor(editor);}else{focusEditor(editor);}};var getEndpointElement=(root,rng,start,real,resolve)=>{var container=start?rng.startContainer:rng.endContainer;var offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map(elm=>!real||!rng.collapsed?child$1(elm,resolve(elm,offset)).getOr(elm):elm).bind(elm=>isElement$7(elm)?Optional.some(elm):parent(elm).filter(isElement$7)).map(elm=>elm.dom).getOr(root);};var getStart=function getStart(root,rng){var real=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return getEndpointElement(root,rng,true,real,(elm,offset)=>Math.min(childNodesCount(elm),offset));};var getEnd$1=function getEnd$1(root,rng){var real=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return getEndpointElement(root,rng,false,real,(elm,offset)=>offset>0?offset-1:offset);};var skipEmptyTextNodes=(node,forwards)=>{var orig=node;while(node&&isText$a(node)&&node.length===0){node=forwards?node.nextSibling:node.previousSibling;}return node||orig;};var getNode=(root,rng)=>{if(!rng){return root;}var startContainer=rng.startContainer;var endContainer=rng.endContainer;var startOffset=rng.startOffset;var endOffset=rng.endOffset;var node=rng.commonAncestorContainer;if(!rng.collapsed){if(startContainer===endContainer){if(endOffset-startOffset<2){if(startContainer.hasChildNodes()){node=startContainer.childNodes[startOffset];}}}if(isText$a(startContainer)&&isText$a(endContainer)){if(startContainer.length===startOffset){startContainer=skipEmptyTextNodes(startContainer.nextSibling,true);}else{startContainer=startContainer.parentNode;}if(endOffset===0){endContainer=skipEmptyTextNodes(endContainer.previousSibling,false);}else{endContainer=endContainer.parentNode;}if(startContainer&&startContainer===endContainer){node=startContainer;}}}var elm=isText$a(node)?node.parentNode:node;return isElement$6(elm)?elm:root;};var getSelectedBlocks=(dom,rng,startElm,endElm)=>{var selectedBlocks=[];var root=dom.getRoot();var start=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock);var end=dom.getParent(endElm||getEnd$1(root,rng,rng.collapsed),dom.isBlock);if(start&&start!==root){selectedBlocks.push(start);}if(start&&end&&start!==end){var node;var walker=new DomTreeWalker(start,root);while((node=walker.next())&&node!==end){if(dom.isBlock(node)){selectedBlocks.push(node);}}}if(end&&start!==end&&end!==root){selectedBlocks.push(end);}return selectedBlocks;};var select=(dom,node,content)=>Optional.from(node).bind(node=>Optional.from(node.parentNode).map(parent=>{var idx=dom.nodeIndex(node);var rng=dom.createRng();rng.setStart(parent,idx);rng.setEnd(parent,idx+1);if(content){moveEndPoint(dom,rng,node,true);moveEndPoint(dom,rng,node,false);}return rng;}));var processRanges=(editor,ranges)=>map$3(ranges,range=>{var evt=editor.dispatch('GetSelectionRange',{range});return evt.range!==range?evt.range:range;});var getEnd=element=>name(element)==='img'?1:getOption(element).fold(()=>children$1(element).length,v=>v.length);var isTextNodeWithCursorPosition=el=>getOption(el).filter(text=>text.trim().length!==0||text.indexOf(nbsp)>-1).isSome();var isContentEditableFalse$5=elem=>isHTMLElement(elem)&&get$9(elem,'contenteditable')==='false';var elementsWithCursorPosition=['img','br'];var isCursorPosition=elem=>{var hasCursorPosition=isTextNodeWithCursorPosition(elem);return hasCursorPosition||contains$2(elementsWithCursorPosition,name(elem))||isContentEditableFalse$5(elem);};var first=element=>descendant$1(element,isCursorPosition);var last=element=>descendantRtl(element,isCursorPosition);var descendantRtl=(scope,predicate)=>{var descend=element=>{var children=children$1(element);for(var i=children.length-1;i>=0;i--){var _child4=children[i];if(predicate(_child4)){return Optional.some(_child4);}var res=descend(_child4);if(res.isSome()){return res;}}return Optional.none();};return descend(scope);};var autocompleteSelector='[data-mce-autocompleter]';var create$9=(editor,range)=>{if(findIn(SugarElement.fromDom(editor.getBody())).isNone()){var wrapper=SugarElement.fromHtml('<span data-mce-autocompleter=\"1\" data-mce-bogus=\"1\"></span>',editor.getDoc());append$1(wrapper,SugarElement.fromDom(range.extractContents()));range.insertNode(wrapper.dom);parent(wrapper).each(elm=>elm.dom.normalize());last(wrapper).map(last=>{editor.selection.setCursorLocation(last.dom,getEnd(last));});}};var detect$1=elm=>closest$3(elm,autocompleteSelector);var findIn=elm=>descendant(elm,autocompleteSelector);var remove$2=(editor,elm)=>findIn(elm).each(wrapper=>{var bookmark=editor.selection.getBookmark();unwrap(wrapper);editor.selection.moveToBookmark(bookmark);});var typeLookup={'#text':3,'#comment':8,'#cdata':4,'#pi':7,'#doctype':10,'#document-fragment':11};var walk$2=(node,root,prev)=>{var startName=prev?'lastChild':'firstChild';var siblingName=prev?'prev':'next';if(node[startName]){return node[startName];}if(node!==root){var _sibling9=node[siblingName];if(_sibling9){return _sibling9;}for(var _parent4=node.parent;_parent4&&_parent4!==root;_parent4=_parent4.parent){_sibling9=_parent4[siblingName];if(_sibling9){return _sibling9;}}}return undefined;};var isEmptyTextNode=node=>{var _a;var text=(_a=node.value)!==null&&_a!==void 0?_a:'';if(!isWhitespaceText(text)){return false;}var parentNode=node.parent;if(parentNode&&(parentNode.name!=='span'||parentNode.attr('style'))&&/^[ ]+$/.test(text)){return false;}return true;};var isNonEmptyElement=node=>{var isNamedAnchor=node.name==='a'&&!node.attr('href')&&node.attr('id');return node.attr('name')||node.attr('id')&&!node.firstChild||node.attr('data-mce-bookmark')||isNamedAnchor;};class AstNode{static create(name,attrs){var node=new AstNode(name,typeLookup[name]||1);if(attrs){each$d(attrs,(value,attrName)=>{node.attr(attrName,value);});}return node;}constructor(name,type){this.name=name;this.type=type;if(type===1){this.attributes=[];this.attributes.map={};}}replace(node){var self=this;if(node.parent){node.remove();}self.insert(node,self);self.remove();return self;}attr(name,value){var self=this;if(!isString(name)){if(isNonNullable(name)){each$d(name,(value,key)=>{self.attr(key,value);});}return self;}var attrs=self.attributes;if(attrs){if(value!==undefined){if(value===null){if(name in attrs.map){delete attrs.map[name];var i=attrs.length;while(i--){if(attrs[i].name===name){attrs.splice(i,1);return self;}}}return self;}if(name in attrs.map){var _i4=attrs.length;while(_i4--){if(attrs[_i4].name===name){attrs[_i4].value=value;break;}}}else{attrs.push({name,value});}attrs.map[name]=value;return self;}return attrs.map[name];}return undefined;}clone(){var self=this;var clone=new AstNode(self.name,self.type);var selfAttrs=self.attributes;if(selfAttrs){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];if(selfAttr.name!=='id'){cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value};cloneAttrs.map[selfAttr.name]=selfAttr.value;}}clone.attributes=cloneAttrs;}clone.value=self.value;return clone;}wrap(wrapper){var self=this;if(self.parent){self.parent.insert(wrapper,self);wrapper.append(self);}return self;}unwrap(){var self=this;for(var node=self.firstChild;node;){var _next2=node.next;self.insert(node,self,true);node=_next2;}self.remove();}remove(){var self=this,parent=self.parent,next=self.next,prev=self.prev;if(parent){if(parent.firstChild===self){parent.firstChild=next;if(next){next.prev=null;}}else if(prev){prev.next=next;}if(parent.lastChild===self){parent.lastChild=prev;if(prev){prev.next=null;}}else if(next){next.prev=prev;}self.parent=self.next=self.prev=null;}return self;}append(node){var self=this;if(node.parent){node.remove();}var last=self.lastChild;if(last){last.next=node;node.prev=last;self.lastChild=node;}else{self.lastChild=self.firstChild=node;}node.parent=self;return node;}insert(node,refNode,before){if(node.parent){node.remove();}var parent=refNode.parent||this;if(before){if(refNode===parent.firstChild){parent.firstChild=node;}else if(refNode.prev){refNode.prev.next=node;}node.prev=refNode.prev;node.next=refNode;refNode.prev=node;}else{if(refNode===parent.lastChild){parent.lastChild=node;}else if(refNode.next){refNode.next.prev=node;}node.next=refNode.next;node.prev=refNode;refNode.next=node;}node.parent=parent;return node;}getAll(name){var self=this;var collection=[];for(var node=self.firstChild;node;node=walk$2(node,self)){if(node.name===name){collection.push(node);}}return collection;}children(){var self=this;var collection=[];for(var node=self.firstChild;node;node=node.next){collection.push(node);}return collection;}empty(){var self=this;if(self.firstChild){var nodes=[];for(var node=self.firstChild;node;node=walk$2(node,self)){nodes.push(node);}var i=nodes.length;while(i--){var _node3=nodes[i];_node3.parent=_node3.firstChild=_node3.lastChild=_node3.next=_node3.prev=null;}}self.firstChild=self.lastChild=null;return self;}isEmpty(elements){var whitespace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var predicate=arguments.length>2?arguments[2]:undefined;var _a;var self=this;var node=self.firstChild;if(isNonEmptyElement(self)){return false;}if(node){do{if(node.type===1){if(node.attr('data-mce-bogus')){continue;}if(elements[node.name]){return false;}if(isNonEmptyElement(node)){return false;}}if(node.type===8){return false;}if(node.type===3&&!isEmptyTextNode(node)){return false;}if(node.type===3&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText((_a=node.value)!==null&&_a!==void 0?_a:'')){return false;}if(predicate&&predicate(node)){return false;}}while(node=walk$2(node,self));}return true;}walk(prev){return walk$2(this,null,prev);}}var isConditionalComment=(html,startIndex)=>/^\\s*\\[if [\\w\\W]+\\]>.*<!\\[endif\\](--!?)?>/.test(html.substr(startIndex));var findCommentEndIndex=function findCommentEndIndex(html,isBogus){var startIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var lcHtml=html.toLowerCase();if(lcHtml.indexOf('[if ',startIndex)!==-1&&isConditionalComment(lcHtml,startIndex)){var endIfIndex=lcHtml.indexOf('[endif]',startIndex);return lcHtml.indexOf('>',endIfIndex);}else{if(isBogus){var endIndex=lcHtml.indexOf('>',startIndex);return endIndex!==-1?endIndex:lcHtml.length;}else{var endCommentRegexp=/--!?>/g;endCommentRegexp.lastIndex=startIndex;var _match=endCommentRegexp.exec(html);return _match?_match.index+_match[0].length:lcHtml.length;}}};var findMatchingEndTagIndex=(schema,html,startIndex)=>{var startTagRegExp=/<([!?\\/])?([A-Za-z0-9\\-_:.]+)/g;var endTagRegExp=/(?:\\s(?:[^'\">]+(?:\"[^\"]*\"|'[^']*'))*[^\"'>]*(?:\"[^\">]*|'[^'>]*)?|\\s*|\\/)>/g;var voidElements=schema.getVoidElements();var count=1,index=startIndex;while(count!==0){startTagRegExp.lastIndex=index;while(true){var startMatch=startTagRegExp.exec(html);if(startMatch===null){return index;}else if(startMatch[1]==='!'){if(startsWith(startMatch[2],'--')){index=findCommentEndIndex(html,false,startMatch.index+'!--'.length);}else{index=findCommentEndIndex(html,true,startMatch.index+1);}break;}else{endTagRegExp.lastIndex=startTagRegExp.lastIndex;var endMatch=endTagRegExp.exec(html);if(isNull(endMatch)||endMatch.index!==startTagRegExp.lastIndex){continue;}if(startMatch[1]==='/'){count-=1;}else if(!has$2(voidElements,startMatch[2])){count+=1;}index=startTagRegExp.lastIndex+endMatch[0].length;break;}}}return index;};var trimHtml$1=(tempAttrs,html)=>{var trimContentRegExp=new RegExp(['\\\\s?('+tempAttrs.join('|')+')=\"[^\"]+\"'].join('|'),'gi');return html.replace(trimContentRegExp,'');};var trimInternal=(serializer,html)=>{var bogusAllRegExp=/<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;var schema=serializer.schema;var content=trimHtml$1(serializer.getTempAttrs(),html);var voidElements=schema.getVoidElements();var matches;while(matches=bogusAllRegExp.exec(content)){var index=bogusAllRegExp.lastIndex;var matchLength=matches[0].length;var endTagIndex=void 0;if(voidElements[matches[1]]){endTagIndex=index;}else{endTagIndex=findMatchingEndTagIndex(schema,content,index);}content=content.substring(0,index-matchLength)+content.substring(endTagIndex);bogusAllRegExp.lastIndex=index-matchLength;}return trim$1(content);};var trimExternal=trimInternal;var cleanupBogusElements=parent=>{var bogusElements=descendants(parent,'[data-mce-bogus]');each$e(bogusElements,elem=>{var bogusValue=get$9(elem,'data-mce-bogus');if(bogusValue==='all'){remove$5(elem);}else if(isBr$5(elem)){before$3(elem,SugarElement.fromText(zeroWidth));remove$5(elem);}else{unwrap(elem);}});};var cleanupInputNames=parent=>{var inputs=descendants(parent,'input');each$e(inputs,input=>{remove$a(input,'name');});};var trimEmptyContents=(editor,html)=>{var blockName=getForcedRootBlock(editor);var emptyRegExp=new RegExp(\"^(<\".concat(blockName,\"[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/\").concat(blockName,\">[\\r\\n]*|<br \\\\/>[\\r\\n]*)$\"));return html.replace(emptyRegExp,'');};var getPlainTextContent=(editor,body)=>{var doc=editor.getDoc();var dos=getRootNode(SugarElement.fromDom(editor.getBody()));var offscreenDiv=SugarElement.fromTag('div',doc);set$3(offscreenDiv,'data-mce-bogus','all');setAll(offscreenDiv,{position:'fixed',left:'-9999999px',top:'0'});set$1(offscreenDiv,body.innerHTML);cleanupBogusElements(offscreenDiv);cleanupInputNames(offscreenDiv);var root=getContentContainer(dos);append$1(root,offscreenDiv);var content=trim$1(offscreenDiv.dom.innerText);remove$5(offscreenDiv);return content;};var getContentFromBody=(editor,args,body)=>{var content;if(args.format==='raw'){content=Tools.trim(trimExternal(editor.serializer,body.innerHTML));}else if(args.format==='text'){content=getPlainTextContent(editor,body);}else if(args.format==='tree'){content=editor.serializer.serialize(body,args);}else{content=trimEmptyContents(editor,editor.serializer.serialize(body,args));}var shouldTrim=args.format!=='text'&&!isWsPreserveElement(SugarElement.fromDom(body));return shouldTrim&&isString(content)?Tools.trim(content):content;};var getContentInternal=(editor,args)=>Optional.from(editor.getBody()).fold(constant(args.format==='tree'?new AstNode('body',11):''),body=>getContentFromBody(editor,args,body));var makeMap$1=Tools.makeMap;var Writer=settings=>{var html=[];settings=settings||{};var indent=settings.indent;var indentBefore=makeMap$1(settings.indent_before||'');var indentAfter=makeMap$1(settings.indent_after||'');var encode=Entities.getEncodeFunc(settings.entity_encoding||'raw',settings.entities);var htmlOutput=settings.element_format!=='xhtml';return{start:(name,attrs,empty)=>{if(indent&&indentBefore[name]&&html.length>0){var _value7=html[html.length-1];if(_value7.length>0&&_value7!=='\\n'){html.push('\\n');}}html.push('<',name);if(attrs){for(var i=0,l=attrs.length;i<l;i++){var attr=attrs[i];html.push(' ',attr.name,'=\"',encode(attr.value,true),'\"');}}if(!empty||htmlOutput){html[html.length]='>';}else{html[html.length]=' />';}if(empty&&indent&&indentAfter[name]&&html.length>0){var _value8=html[html.length-1];if(_value8.length>0&&_value8!=='\\n'){html.push('\\n');}}},end:name=>{var value;html.push('</',name,'>');if(indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=='\\n'){html.push('\\n');}}},text:(_text2,raw)=>{if(_text2.length>0){html[html.length]=raw?_text2:encode(_text2);}},cdata:text=>{html.push('<![CDATA[',text,']]>');},comment:text=>{html.push('<!--',text,'-->');},pi:(name,text)=>{if(text){html.push('<?',name,' ',encode(text),'?>');}else{html.push('<?',name,'?>');}if(indent){html.push('\\n');}},doctype:text=>{html.push('<!DOCTYPE',text,'>',indent?'\\n':'');},reset:()=>{html.length=0;},getContent:()=>{return html.join('').replace(/\\n$/,'');}};};var HtmlSerializer=function HtmlSerializer(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var schema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Schema();var writer=Writer(settings);settings.validate='validate'in settings?settings.validate:true;var serialize=node=>{var validate=settings.validate;var handlers={3:node=>{var _a;writer.text((_a=node.value)!==null&&_a!==void 0?_a:'',node.raw);},8:node=>{var _a;writer.comment((_a=node.value)!==null&&_a!==void 0?_a:'');},7:node=>{writer.pi(node.name,node.value);},10:node=>{var _a;writer.doctype((_a=node.value)!==null&&_a!==void 0?_a:'');},4:node=>{var _a;writer.cdata((_a=node.value)!==null&&_a!==void 0?_a:'');},11:node=>{var tempNode=node;if(tempNode=tempNode.firstChild){do{walk(tempNode);}while(tempNode=tempNode.next);}}};writer.reset();var walk=node=>{var _a;var handler=handlers[node.type];if(!handler){var _name13=node.name;var _isEmpty=(_name13 in schema.getVoidElements());var attrs=node.attributes;if(validate&&attrs&&attrs.length>1){var sortedAttrs=[];sortedAttrs.map={};var elementRule=schema.getElementRule(node.name);if(elementRule){for(var i=0,l=elementRule.attributesOrder.length;i<l;i++){var attrName=elementRule.attributesOrder[i];if(attrName in attrs.map){var attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue});}}for(var _i5=0,_l=attrs.length;_i5<_l;_i5++){var _attrName=attrs[_i5].name;if(!(_attrName in sortedAttrs.map)){var _attrValue=attrs.map[_attrName];sortedAttrs.map[_attrName]=_attrValue;sortedAttrs.push({name:_attrName,value:_attrValue});}}attrs=sortedAttrs;}}writer.start(_name13,attrs,_isEmpty);if(!_isEmpty){var _child5=node.firstChild;if(_child5){if((_name13==='pre'||_name13==='textarea')&&_child5.type===3&&((_a=_child5.value)===null||_a===void 0?void 0:_a[0])==='\\n'){writer.text('\\n',true);}do{walk(_child5);}while(_child5=_child5.next);}writer.end(_name13);}}else{handler(node);}};if(node.type===1&&!settings.inner){walk(node);}else if(node.type===3){handlers[3](node);}else{handlers[11](node);}return writer.getContent();};return{serialize};};var nonInheritableStyles=new Set();(()=>{var nonInheritableStylesArr=['margin','margin-left','margin-right','margin-top','margin-bottom','padding','padding-left','padding-right','padding-top','padding-bottom','border','border-width','border-style','border-color','background','background-attachment','background-clip','background-color','background-image','background-origin','background-position','background-repeat','background-size','float','position','left','right','top','bottom','z-index','display','transform','width','max-width','min-width','height','max-height','min-height','overflow','overflow-x','overflow-y','text-overflow','vertical-align','transition','transition-delay','transition-duration','transition-property','transition-timing-function'];each$e(nonInheritableStylesArr,style=>{nonInheritableStyles.add(style);});})();var shorthandStyleProps=['font','text-decoration','text-emphasis'];var getStyleProps=(dom,node)=>keys(dom.parseStyle(dom.getAttrib(node,'style')));var isNonInheritableStyle=style=>nonInheritableStyles.has(style);var hasInheritableStyles=(dom,node)=>forall(getStyleProps(dom,node),style=>!isNonInheritableStyle(style));var getLonghandStyleProps=styles=>filter$5(styles,style=>exists(shorthandStyleProps,prop=>startsWith(style,prop)));var hasStyleConflict=(dom,node,parentNode)=>{var nodeStyleProps=getStyleProps(dom,node);var parentNodeStyleProps=getStyleProps(dom,parentNode);var valueMismatch=prop=>{var _a,_b;var nodeValue=(_a=dom.getStyle(node,prop))!==null&&_a!==void 0?_a:'';var parentValue=(_b=dom.getStyle(parentNode,prop))!==null&&_b!==void 0?_b:'';return isNotEmpty(nodeValue)&&isNotEmpty(parentValue)&&nodeValue!==parentValue;};return exists(nodeStyleProps,nodeStyleProp=>{var propExists=props=>exists(props,prop=>prop===nodeStyleProp);if(!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)){var longhandProps=getLonghandStyleProps(parentNodeStyleProps);return exists(longhandProps,valueMismatch);}else{return valueMismatch(nodeStyleProp);}});};var isChar=(forward,predicate,pos)=>Optional.from(pos.container()).filter(isText$a).exists(text=>{var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta));});var isBeforeSpace=curry(isChar,true,isWhiteSpace);var isAfterSpace=curry(isChar,false,isWhiteSpace);var isEmptyText=pos=>{var container=pos.container();return isText$a(container)&&(container.data.length===0||isZwsp$1(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode));};var matchesElementPosition=(before,predicate)=>pos=>getChildNodeAtRelativeOffset(before?0:-1,pos).filter(predicate).isSome();var isImageBlock=node=>isImg(node)&&get$7(SugarElement.fromDom(node),'display')==='block';var isCefNode=node=>isContentEditableFalse$b(node)&&!isBogusAll$1(node);var isBeforeImageBlock=matchesElementPosition(true,isImageBlock);var isAfterImageBlock=matchesElementPosition(false,isImageBlock);var isBeforeMedia=matchesElementPosition(true,isMedia$2);var isAfterMedia=matchesElementPosition(false,isMedia$2);var isBeforeTable=matchesElementPosition(true,isTable$2);var isAfterTable=matchesElementPosition(false,isTable$2);var isBeforeContentEditableFalse=matchesElementPosition(true,isCefNode);var isAfterContentEditableFalse=matchesElementPosition(false,isCefNode);var dropLast=xs=>xs.slice(0,-1);var parentsUntil=(start,root,predicate)=>{if(contains(root,start)){return dropLast(parents$1(start,elm=>{return predicate(elm)||eq(elm,root);}));}else{return[];}};var parents=(start,root)=>parentsUntil(start,root,never);var parentsAndSelf=(start,root)=>[start].concat(parents(start,root));var navigateIgnoreEmptyTextNodes=(forward,root,from)=>navigateIgnore(forward,root,from,isEmptyText);var getClosestBlock$1=(root,pos)=>find$2(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);var isAtBeforeAfterBlockBoundary=(forward,root,pos)=>navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(newPos=>getClosestBlock$1(root,pos).fold(()=>!isInSameBlock(newPos,pos,root.dom),fromBlock=>!isInSameBlock(newPos,pos,root.dom)&&contains(fromBlock,SugarElement.fromDom(newPos.container()))));var isAtBlockBoundary=(forward,root,pos)=>getClosestBlock$1(root,pos).fold(()=>navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall(newPos=>!isInSameBlock(newPos,pos,root.dom)),parent=>navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone());var isAtStartOfBlock=curry(isAtBlockBoundary,false);var isAtEndOfBlock=curry(isAtBlockBoundary,true);var isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,false);var isAfterBlock=curry(isAtBeforeAfterBlockBoundary,true);var isBr$1=pos=>getElementFromPosition(pos).exists(isBr$5);var findBr=(forward,root,pos)=>{var parentBlocks=filter$5(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);var scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr$1);};var isBeforeBr$1=(root,pos)=>getElementFromPosition(pos).exists(isBr$5)||findBr(true,root,pos).isSome();var isAfterBr=(root,pos)=>getElementFromPrevPosition(pos).exists(isBr$5)||findBr(false,root,pos).isSome();var findPreviousBr=curry(findBr,false);var findNextBr=curry(findBr,true);var isInMiddleOfText=pos=>CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd();var getClosestBlock=(root,pos)=>{var parentBlocks=filter$5(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock$2);return head(parentBlocks).getOr(root);};var hasSpaceBefore=(root,pos)=>{if(isInMiddleOfText(pos)){return isAfterSpace(pos);}else{return isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos).dom,pos).exists(isAfterSpace);}};var hasSpaceAfter=(root,pos)=>{if(isInMiddleOfText(pos)){return isBeforeSpace(pos);}else{return isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos).dom,pos).exists(isBeforeSpace);}};var isPreValue=value=>contains$2(['pre','pre-wrap'],value);var isInPre=pos=>getElementFromPosition(pos).bind(elm=>closest$4(elm,isElement$7)).exists(elm=>isPreValue(get$7(elm,'white-space')));var isAtBeginningOfBody=(root,pos)=>prevPosition(root.dom,pos).isNone();var isAtEndOfBody=(root,pos)=>nextPosition(root.dom,pos).isNone();var isAtLineBoundary=(root,pos)=>isAtBeginningOfBody(root,pos)||isAtEndOfBody(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr$1(root,pos);var isCefBlock=node=>isNonNullable(node)&&isContentEditableFalse$b(node)&&isBlockLike(node);var isSiblingCefBlock=(root,direction)=>container=>{return isCefBlock(new DomTreeWalker(container,root)[direction]());};var isBeforeCefBlock=(root,pos)=>{var nextPos=nextPosition(root.dom,pos).getOr(pos);var isNextCefBlock=isSiblingCefBlock(root.dom,'next');return pos.isAtEnd()&&(isNextCefBlock(pos.container())||isNextCefBlock(nextPos.container()));};var isAfterCefBlock=(root,pos)=>{var prevPos=prevPosition(root.dom,pos).getOr(pos);var isPrevCefBlock=isSiblingCefBlock(root.dom,'prev');return pos.isAtStart()&&(isPrevCefBlock(pos.container())||isPrevCefBlock(prevPos.container()));};var needsToHaveNbsp=(root,pos)=>{if(isInPre(pos)){return false;}else{return isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos);}};var needsToBeNbspLeft=(root,pos)=>{if(isInPre(pos)){return false;}else{return isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos)||isAfterCefBlock(root,pos);}};var leanRight=pos=>{var container=pos.container();var offset=pos.offset();if(isText$a(container)&&offset<container.data.length){return CaretPosition(container,offset+1);}else{return pos;}};var needsToBeNbspRight=(root,pos)=>{if(isInPre(pos)){return false;}else{return isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr$1(root,pos)||hasSpaceAfter(root,pos)||isBeforeCefBlock(root,pos);}};var needsToBeNbsp=(root,pos)=>needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,leanRight(pos));var isNbspAt=(text,offset)=>isNbsp(text.charAt(offset));var isWhiteSpaceAt=(text,offset)=>isWhiteSpace(text.charAt(offset));var hasNbsp=pos=>{var container=pos.container();return isText$a(container)&&contains$1(container.data,nbsp);};var normalizeNbspMiddle=text=>{var chars=text.split('');return map$3(chars,(chr,i)=>{if(isNbsp(chr)&&i>0&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])){return' ';}else{return chr;}}).join('');};var normalizeNbspAtStart=(root,node,makeNbsp)=>{var text=node.data;var firstPos=CaretPosition(node,0);if(!makeNbsp&&isNbspAt(text,0)&&!needsToBeNbsp(root,firstPos)){node.data=' '+text.slice(1);return true;}else if(makeNbsp&&isWhiteSpaceAt(text,0)&&needsToBeNbspLeft(root,firstPos)){node.data=nbsp+text.slice(1);return true;}else{return false;}};var normalizeNbspInMiddleOfTextNode=node=>{var text=node.data;var newText=normalizeNbspMiddle(text);if(newText!==text){node.data=newText;return true;}else{return false;}};var normalizeNbspAtEnd=(root,node,makeNbsp)=>{var text=node.data;var lastPos=CaretPosition(node,text.length-1);if(!makeNbsp&&isNbspAt(text,text.length-1)&&!needsToBeNbsp(root,lastPos)){node.data=text.slice(0,-1)+' ';return true;}else if(makeNbsp&&isWhiteSpaceAt(text,text.length-1)&&needsToBeNbspRight(root,lastPos)){node.data=text.slice(0,-1)+nbsp;return true;}else{return false;}};var normalizeNbsps=(root,pos)=>{var container=pos.container();if(!isText$a(container)){return Optional.none();}if(hasNbsp(pos)){var normalized=normalizeNbspAtStart(root,container,false)||normalizeNbspInMiddleOfTextNode(container)||normalizeNbspAtEnd(root,container,false);return someIf(normalized,pos);}else if(needsToBeNbsp(root,pos)){var _normalized=normalizeNbspAtStart(root,container,true)||normalizeNbspAtEnd(root,container,true);return someIf(_normalized,pos);}else{return Optional.none();}};var normalizeNbspsInEditor=editor=>{var root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng())).each(pos=>{editor.selection.setRng(pos.toRange());});}};var normalize$1=(node,offset,count)=>{if(count===0){return;}var elm=SugarElement.fromDom(node);var root=ancestor$4(elm,isBlock$2).getOr(elm);var whitespace=node.data.slice(offset,offset+count);var isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,CaretPosition(node,node.data.length));var isStartOfContent=offset===0&&needsToBeNbspLeft(root,CaretPosition(node,0));node.replaceData(offset,count,normalize$4(whitespace,4,isStartOfContent,isEndOfContent));};var normalizeWhitespaceAfter=(node,offset)=>{var content=node.data.slice(offset);var whitespaceCount=content.length-lTrim(content).length;normalize$1(node,offset,whitespaceCount);};var normalizeWhitespaceBefore=(node,offset)=>{var content=node.data.slice(0,offset);var whitespaceCount=content.length-rTrim(content).length;normalize$1(node,offset-whitespaceCount,whitespaceCount);};var mergeTextNodes=function mergeTextNodes(prevNode,nextNode,normalizeWhitespace){var mergeToPrev=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var whitespaceOffset=rTrim(prevNode.data).length;var newNode=mergeToPrev?prevNode:nextNode;var removeNode=mergeToPrev?nextNode:prevNode;if(mergeToPrev){newNode.appendData(removeNode.data);}else{newNode.insertData(0,removeNode.data);}remove$5(SugarElement.fromDom(removeNode));if(normalizeWhitespace){normalizeWhitespaceAfter(newNode,whitespaceOffset);}return newNode;};var needsReposition=(pos,elm)=>{var container=pos.container();var offset=pos.offset();return!CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset();};var reposition=(elm,pos)=>needsReposition(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos;var beforeOrStartOf=node=>isText$a(node)?CaretPosition(node,0):CaretPosition.before(node);var afterOrEndOf=node=>isText$a(node)?CaretPosition(node,node.data.length):CaretPosition.after(node);var getPreviousSiblingCaretPosition=elm=>{if(isCaretCandidate$3(elm.previousSibling)){return Optional.some(afterOrEndOf(elm.previousSibling));}else{return elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();}};var getNextSiblingCaretPosition=elm=>{if(isCaretCandidate$3(elm.nextSibling)){return Optional.some(beforeOrStartOf(elm.nextSibling));}else{return elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();}};var findCaretPositionBackwardsFromElm=(rootElement,elm)=>{return Optional.from(elm.previousSibling?elm.previousSibling:elm.parentNode).bind(node=>prevPosition(rootElement,CaretPosition.before(node))).orThunk(()=>nextPosition(rootElement,CaretPosition.after(elm)));};var findCaretPositionForwardsFromElm=(rootElement,elm)=>nextPosition(rootElement,CaretPosition.after(elm)).orThunk(()=>prevPosition(rootElement,CaretPosition.before(elm)));var findCaretPositionBackwards=(rootElement,elm)=>getPreviousSiblingCaretPosition(elm).orThunk(()=>getNextSiblingCaretPosition(elm)).orThunk(()=>findCaretPositionBackwardsFromElm(rootElement,elm));var findCaretPositionForward=(rootElement,elm)=>getNextSiblingCaretPosition(elm).orThunk(()=>getPreviousSiblingCaretPosition(elm)).orThunk(()=>findCaretPositionForwardsFromElm(rootElement,elm));var findCaretPosition=(forward,rootElement,elm)=>forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm);var findCaretPosOutsideElmAfterDelete=(forward,rootElement,elm)=>findCaretPosition(forward,rootElement,elm).map(curry(reposition,elm));var setSelection$1=(editor,forward,pos)=>{pos.fold(()=>{editor.focus();},pos=>{editor.selection.setRng(pos.toRange(),forward);});};var eqRawNode=rawNode=>elm=>elm.dom===rawNode;var isBlock=(editor,elm)=>elm&&has$2(editor.schema.getBlockElements(),name(elm));var paddEmptyBlock=elm=>{if(isEmpty$2(elm)){var br=SugarElement.fromHtml('<br data-mce-bogus=\"1\">');empty(elm);append$1(elm,br);return Optional.some(CaretPosition.before(br.dom));}else{return Optional.none();}};var deleteNormalized=(elm,afterDeletePosOpt,normalizeWhitespace)=>{var prevTextOpt=prevSibling(elm).filter(isText$b);var nextTextOpt=nextSibling(elm).filter(isText$b);remove$5(elm);return lift3(prevTextOpt,nextTextOpt,afterDeletePosOpt,(prev,next,pos)=>{var prevNode=prev.dom,nextNode=next.dom;var offset=prevNode.data.length;mergeTextNodes(prevNode,nextNode,normalizeWhitespace);return pos.container()===nextNode?CaretPosition(prevNode,offset):pos;}).orThunk(()=>{if(normalizeWhitespace){prevTextOpt.each(elm=>normalizeWhitespaceBefore(elm.dom,elm.dom.length));nextTextOpt.each(elm=>normalizeWhitespaceAfter(elm.dom,0));}return afterDeletePosOpt;});};var isInlineElement=(editor,element)=>has$2(editor.schema.getTextInlineElements(),name(element));var deleteElement$2=function deleteElement$2(editor,forward,elm){var moveCaret=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom);var parentBlock=ancestor$4(elm,curry(isBlock,editor),eqRawNode(editor.getBody()));var normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,isInlineElement(editor,elm));if(editor.dom.isEmpty(editor.getBody())){editor.setContent('');editor.selection.setCursorLocation();}else{parentBlock.bind(paddEmptyBlock).fold(()=>{if(moveCaret){setSelection$1(editor,forward,normalizedAfterDeletePos);}},paddPos=>{if(moveCaret){setSelection$1(editor,forward,Optional.some(paddPos));}});}};var strongRtl=/[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;var hasStrongRtl=text=>strongRtl.test(text);var isInlineTarget=(editor,elm)=>is$1(SugarElement.fromDom(elm),getInlineBoundarySelector(editor))&&!isTransparentBlock(editor.schema,elm)&&editor.dom.isEditable(elm);var isRtl=element=>{var _a;return DOMUtils.DOM.getStyle(element,'direction',true)==='rtl'||hasStrongRtl((_a=element.textContent)!==null&&_a!==void 0?_a:'');};var findInlineParents=(isInlineTarget,rootNode,pos)=>filter$5(DOMUtils.DOM.getParents(pos.container(),'*',rootNode),isInlineTarget);var findRootInline=(isInlineTarget,rootNode,pos)=>{var parents=findInlineParents(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1]);};var hasSameParentBlock=(rootNode,node1,node2)=>{var block1=getParentBlock$3(node1,rootNode);var block2=getParentBlock$3(node2,rootNode);return isNonNullable(block1)&&block1===block2;};var isAtZwsp=pos=>isBeforeInline(pos)||isAfterInline(pos);var normalizePosition=(forward,pos)=>{var container=pos.container(),offset=pos.offset();if(forward){if(isCaretContainerInline(container)){if(isText$a(container.nextSibling)){return CaretPosition(container.nextSibling,0);}else{return CaretPosition.after(container);}}else{return isBeforeInline(pos)?CaretPosition(container,offset+1):pos;}}else{if(isCaretContainerInline(container)){if(isText$a(container.previousSibling)){return CaretPosition(container.previousSibling,container.previousSibling.data.length);}else{return CaretPosition.before(container);}}else{return isAfterInline(pos)?CaretPosition(container,offset-1):pos;}}};var normalizeForwards=curry(normalizePosition,true);var normalizeBackwards=curry(normalizePosition,false);var execCommandIgnoreInputEvents=(editor,command)=>{var inputBlocker=e=>e.stopImmediatePropagation();editor.on('beforeinput input',inputBlocker,true);editor.getDoc().execCommand(command);editor.off('beforeinput input',inputBlocker);};var execEditorDeleteCommand=editor=>{editor.execCommand('delete');};var execNativeDeleteCommand=editor=>execCommandIgnoreInputEvents(editor,'Delete');var execNativeForwardDeleteCommand=editor=>execCommandIgnoreInputEvents(editor,'ForwardDelete');var isBeforeRoot=rootNode=>elm=>is$2(parent(elm),rootNode,eq);var isTextBlockOrListItem=element=>isTextBlock$2(element)||isListItem$1(element);var getParentBlock$2=(rootNode,elm)=>{if(contains(rootNode,elm)){return closest$4(elm,isTextBlockOrListItem,isBeforeRoot(rootNode));}else{return Optional.none();}};var paddEmptyBody=function paddEmptyBody(editor){var moveSelection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(editor.dom.isEmpty(editor.getBody())){editor.setContent('',{no_selection:!moveSelection});}};var willDeleteLastPositionInElement=(forward,fromPos,elm)=>lift2(firstPositionIn(elm),lastPositionIn(elm),(firstPos,lastPos)=>{var normalizedFirstPos=normalizePosition(true,firstPos);var normalizedLastPos=normalizePosition(false,lastPos);var normalizedFromPos=normalizePosition(false,fromPos);if(forward){return nextPosition(elm,normalizedFromPos).exists(nextPos=>nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos));}else{return prevPosition(elm,normalizedFromPos).exists(prevPos=>prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos));}}).getOr(true);var freefallRtl=root=>{var child=isComment$1(root)?prevSibling(root):lastChild(root);return child.bind(freefallRtl).orThunk(()=>Optional.some(root));};var deleteRangeContents=function deleteRangeContents(editor,rng,root){var moveSelection=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var _a;rng.deleteContents();var lastNode=freefallRtl(root).getOr(root);var lastBlock=SugarElement.fromDom((_a=editor.dom.getParent(lastNode.dom,editor.dom.isBlock))!==null&&_a!==void 0?_a:root.dom);if(lastBlock.dom===editor.getBody()){paddEmptyBody(editor,moveSelection);}else if(isEmpty$2(lastBlock)){fillWithPaddingBr(lastBlock);if(moveSelection){editor.selection.setCursorLocation(lastBlock.dom,0);}}if(!eq(root,lastBlock)){var additionalCleanupNodes=is$2(parent(lastBlock),root)?[]:siblings(lastBlock);each$e(additionalCleanupNodes.concat(children$1(root)),node=>{if(!eq(node,lastBlock)&&!contains(node,lastBlock)&&isEmpty$2(node)){remove$5(node);}});}};var isRootFromElement=root=>cur=>eq(root,cur);var getTableCells=table=>descendants(table,'td,th');var getTableDetailsFromRange=(rng,isRoot)=>{var getTable=node=>getClosestTable(SugarElement.fromDom(node),isRoot);var startTable=getTable(rng.startContainer);var endTable=getTable(rng.endContainer);var isStartInTable=startTable.isSome();var isEndInTable=endTable.isSome();var isSameTable=lift2(startTable,endTable,eq).getOr(false);var isMultiTable=!isSameTable&&isStartInTable&&isEndInTable;return{startTable,endTable,isStartInTable,isEndInTable,isSameTable,isMultiTable};};var tableCellRng=(start,end)=>({start,end});var tableSelection=(rng,table,cells)=>({rng,table,cells});var deleteAction=Adt.generate([{singleCellTable:['rng','cell']},{fullTable:['table']},{partialTable:['cells','outsideDetails']},{multiTable:['startTableCells','endTableCells','betweenRng']}]);var getClosestCell$1=(container,isRoot)=>closest$3(SugarElement.fromDom(container),'td,th',isRoot);var isExpandedCellRng=cellRng=>!eq(cellRng.start,cellRng.end);var getTableFromCellRng=(cellRng,isRoot)=>getClosestTable(cellRng.start,isRoot).bind(startParentTable=>getClosestTable(cellRng.end,isRoot).bind(endParentTable=>someIf(eq(startParentTable,endParentTable),startParentTable)));var isSingleCellTable=(cellRng,isRoot)=>!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists(table=>{var rows=table.dom.rows;return rows.length===1&&rows[0].cells.length===1;});var getCellRng=(rng,isRoot)=>{var startCell=getClosestCell$1(rng.startContainer,isRoot);var endCell=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng);};var getCellRangeFromStartTable=isRoot=>startCell=>getClosestTable(startCell,isRoot).bind(table=>last$3(getTableCells(table)).map(endCell=>tableCellRng(startCell,endCell)));var getCellRangeFromEndTable=isRoot=>endCell=>getClosestTable(endCell,isRoot).bind(table=>head(getTableCells(table)).map(startCell=>tableCellRng(startCell,endCell)));var getTableSelectionFromCellRng=isRoot=>cellRng=>getTableFromCellRng(cellRng,isRoot).map(table=>tableSelection(cellRng,table,getTableCells(table)));var getTableSelections=(cellRng,selectionDetails,rng,isRoot)=>{if(rng.collapsed||!cellRng.forall(isExpandedCellRng)){return Optional.none();}else if(selectionDetails.isSameTable){var sameTableSelection=cellRng.bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:sameTableSelection,end:sameTableSelection});}else{var startCell=getClosestCell$1(rng.startContainer,isRoot);var endCell=getClosestCell$1(rng.endContainer,isRoot);var startTableSelection=startCell.bind(getCellRangeFromStartTable(isRoot)).bind(getTableSelectionFromCellRng(isRoot));var endTableSelection=endCell.bind(getCellRangeFromEndTable(isRoot)).bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:startTableSelection,end:endTableSelection});}};var getCellIndex=(cells,cell)=>findIndex$2(cells,x=>eq(x,cell));var getSelectedCells=tableSelection=>lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),(startIndex,endIndex)=>tableSelection.cells.slice(startIndex,endIndex+1));var isSingleCellTableContentSelected=(optCellRng,rng,isRoot)=>optCellRng.exists(cellRng=>isSingleCellTable(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng));var unselectCells=(rng,selectionDetails)=>{var{startTable,endTable}=selectionDetails;var otherContentRng=rng.cloneRange();startTable.each(table=>otherContentRng.setStartAfter(table.dom));endTable.each(table=>otherContentRng.setEndBefore(table.dom));return otherContentRng;};var handleSingleTable=(cellRng,selectionDetails,rng,isRoot)=>getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(_ref11=>{var{start,end}=_ref11;return start.or(end);}).bind(tableSelection=>{var{isSameTable}=selectionDetails;var selectedCells=getSelectedCells(tableSelection).getOr([]);if(isSameTable&&tableSelection.cells.length===selectedCells.length){return Optional.some(deleteAction.fullTable(tableSelection.table));}else if(selectedCells.length>0){if(isSameTable){return Optional.some(deleteAction.partialTable(selectedCells,Optional.none()));}else{var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.partialTable(selectedCells,Optional.some(_objectSpread(_objectSpread({},selectionDetails),{},{rng:otherContentRng}))));}}else{return Optional.none();}});var handleMultiTable=(cellRng,selectionDetails,rng,isRoot)=>getTableSelections(cellRng,selectionDetails,rng,isRoot).bind(_ref12=>{var{start,end}=_ref12;var startTableSelectedCells=start.bind(getSelectedCells).getOr([]);var endTableSelectedCells=end.bind(getSelectedCells).getOr([]);if(startTableSelectedCells.length>0&&endTableSelectedCells.length>0){var otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.multiTable(startTableSelectedCells,endTableSelectedCells,otherContentRng));}else{return Optional.none();}});var getActionFromRange=(root,rng)=>{var isRoot=isRootFromElement(root);var optCellRng=getCellRng(rng,isRoot);var selectionDetails=getTableDetailsFromRange(rng,isRoot);if(isSingleCellTableContentSelected(optCellRng,rng,isRoot)){return optCellRng.map(cellRng=>deleteAction.singleCellTable(rng,cellRng.start));}else if(selectionDetails.isMultiTable){return handleMultiTable(optCellRng,selectionDetails,rng,isRoot);}else{return handleSingleTable(optCellRng,selectionDetails,rng,isRoot);}};var cleanCells=cells=>each$e(cells,cell=>{remove$a(cell,'contenteditable');fillWithPaddingBr(cell);});var getOutsideBlock=(editor,container)=>Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom);var handleEmptyBlock=(editor,startInTable,emptyBlock)=>{emptyBlock.each(block=>{if(startInTable){remove$5(block);}else{fillWithPaddingBr(block);editor.selection.setCursorLocation(block.dom,0);}});};var deleteContentInsideCell=(editor,cell,rng,isFirstCellInSelection)=>{var insideTableRng=rng.cloneRange();if(isFirstCellInSelection){insideTableRng.setStart(rng.startContainer,rng.startOffset);insideTableRng.setEndAfter(cell.dom.lastChild);}else{insideTableRng.setStartBefore(cell.dom.firstChild);insideTableRng.setEnd(rng.endContainer,rng.endOffset);}deleteCellContents(editor,insideTableRng,cell,false).each(action=>action());};var collapseAndRestoreCellSelection=editor=>{var selectedCells=getCellsFromEditor(editor);var selectedNode=SugarElement.fromDom(editor.selection.getNode());if(isTableCell$3(selectedNode.dom)&&isEmpty$2(selectedNode)){editor.selection.setCursorLocation(selectedNode.dom,0);}else{editor.selection.collapse(true);}if(selectedCells.length>1&&exists(selectedCells,cell=>eq(cell,selectedNode))){set$3(selectedNode,'data-mce-selected','1');}};var emptySingleTableCells=(editor,cells,outsideDetails)=>Optional.some(()=>{var editorRng=editor.selection.getRng();var cellsToClean=outsideDetails.bind(_ref13=>{var{rng,isStartInTable}=_ref13;var outsideBlock=getOutsideBlock(editor,isStartInTable?rng.endContainer:rng.startContainer);rng.deleteContents();handleEmptyBlock(editor,isStartInTable,outsideBlock.filter(isEmpty$2));var endPointCell=isStartInTable?cells[0]:cells[cells.length-1];deleteContentInsideCell(editor,endPointCell,editorRng,isStartInTable);if(!isEmpty$2(endPointCell)){return Optional.some(isStartInTable?cells.slice(1):cells.slice(0,-1));}else{return Optional.none();}}).getOr(cells);cleanCells(cellsToClean);collapseAndRestoreCellSelection(editor);});var emptyMultiTableCells=(editor,startTableCells,endTableCells,betweenRng)=>Optional.some(()=>{var rng=editor.selection.getRng();var startCell=startTableCells[0];var endCell=endTableCells[endTableCells.length-1];deleteContentInsideCell(editor,startCell,rng,true);deleteContentInsideCell(editor,endCell,rng,false);var startTableCellsToClean=isEmpty$2(startCell)?startTableCells:startTableCells.slice(1);var endTableCellsToClean=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);cleanCells(startTableCellsToClean.concat(endTableCellsToClean));betweenRng.deleteContents();collapseAndRestoreCellSelection(editor);});var deleteCellContents=function deleteCellContents(editor,rng,cell){var moveSelection=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return Optional.some(()=>{deleteRangeContents(editor,rng,cell,moveSelection);});};var deleteTableElement=(editor,table)=>Optional.some(()=>deleteElement$2(editor,false,table));var deleteCellRange=(editor,rootElm,rng)=>getActionFromRange(rootElm,rng).bind(action=>action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor)));var deleteCaptionRange=(editor,caption)=>emptyElement(editor,caption);var deleteTableRange=(editor,rootElm,rng,startElm)=>getParentCaption(rootElm,startElm).fold(()=>deleteCellRange(editor,rootElm,rng),caption=>deleteCaptionRange(editor,caption));var deleteRange$3=(editor,startElm,selectedCells)=>{var rootNode=SugarElement.fromDom(editor.getBody());var rng=editor.selection.getRng();return selectedCells.length!==0?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm);};var getParentCell=(rootElm,elm)=>find$2(parentsAndSelf(elm,rootElm),isTableCell$2);var getParentCaption=(rootElm,elm)=>find$2(parentsAndSelf(elm,rootElm),isTag('caption'));var deleteBetweenCells=(editor,rootElm,forward,fromCell,from)=>navigate(forward,editor.getBody(),from).bind(to=>getParentCell(rootElm,SugarElement.fromDom(to.getNode())).bind(toCell=>eq(toCell,fromCell)?Optional.none():Optional.some(noop)));var emptyElement=(editor,elm)=>Optional.some(()=>{fillWithPaddingBr(elm);editor.selection.setCursorLocation(elm.dom,0);});var isDeleteOfLastCharPos=(fromCaption,forward,from,to)=>firstPositionIn(fromCaption.dom).bind(first=>lastPositionIn(fromCaption.dom).map(last=>forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first))).getOr(true);var emptyCaretCaption=(editor,elm)=>emptyElement(editor,elm);var validateCaretCaption=(rootElm,fromCaption,to)=>getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).fold(()=>Optional.some(noop),toCaption=>someIf(!eq(toCaption,fromCaption),noop));var deleteCaretInsideCaption=(editor,rootElm,forward,fromCaption,from)=>navigate(forward,editor.getBody(),from).fold(()=>Optional.some(noop),to=>isDeleteOfLastCharPos(fromCaption,forward,from,to)?emptyCaretCaption(editor,fromCaption):validateCaretCaption(rootElm,fromCaption,to));var deleteCaretCells=(editor,forward,rootElm,startElm)=>{var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind(fromCell=>isEmpty$2(fromCell)?emptyElement(editor,fromCell):deleteBetweenCells(editor,rootElm,forward,fromCell,from));};var deleteCaretCaption=(editor,forward,rootElm,fromCaption)=>{var from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from);};var isNearTable=(forward,pos)=>forward?isBeforeTable(pos):isAfterTable(pos);var isBeforeOrAfterTable=(editor,forward)=>{var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists(pos=>isNearTable(forward,pos));};var deleteCaret$3=(editor,forward,startElm)=>{var rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold(()=>deleteCaretCells(editor,forward,rootElm,startElm).orThunk(()=>someIf(isBeforeOrAfterTable(editor,forward),noop)),fromCaption=>deleteCaretCaption(editor,forward,rootElm,fromCaption));};var backspaceDelete$a=(editor,forward)=>{var startElm=SugarElement.fromDom(editor.selection.getStart(true));var cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&cells.length===0?deleteCaret$3(editor,forward,startElm):deleteRange$3(editor,startElm,cells);};var getContentEditableRoot$1=(root,node)=>{var tempNode=node;while(tempNode&&tempNode!==root){if(isContentEditableTrue$3(tempNode)||isContentEditableFalse$b(tempNode)){return tempNode;}tempNode=tempNode.parentNode;}return null;};var internalAttributesPrefixes=['data-ephox-','data-mce-','data-alloy-','data-snooker-','_'];var each$9=Tools.each;var ElementUtils=editor=>{var dom=editor.dom;var internalAttributes=new Set(editor.serializer.getTempAttrs());var compare=(node1,node2)=>{if(node1.nodeName!==node2.nodeName||node1.nodeType!==node2.nodeType){return false;}var getAttribs=node=>{var attribs={};each$9(dom.getAttribs(node),attr=>{var name=attr.nodeName.toLowerCase();if(name!=='style'&&!isAttributeInternal(name)){attribs[name]=dom.getAttrib(node,name);}});return attribs;};var compareObjects=(obj1,obj2)=>{for(var _name14 in obj1){if(has$2(obj1,_name14)){var _value9=obj2[_name14];if(isUndefined(_value9)){return false;}if(obj1[_name14]!==_value9){return false;}delete obj2[_name14];}}for(var _name15 in obj2){if(has$2(obj2,_name15)){return false;}}return true;};if(isElement$6(node1)&&isElement$6(node2)){if(!compareObjects(getAttribs(node1),getAttribs(node2))){return false;}if(!compareObjects(dom.parseStyle(dom.getAttrib(node1,'style')),dom.parseStyle(dom.getAttrib(node2,'style')))){return false;}}return!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2);};var isAttributeInternal=attributeName=>exists(internalAttributesPrefixes,value=>startsWith(attributeName,value))||internalAttributes.has(attributeName);return{compare,isAttributeInternal};};var traverse=(root,fn)=>{var node=root;while(node=node.walk()){fn(node);}};var matchNode$1=(nodeFilters,attributeFilters,node,matches)=>{var name=node.name;for(var ni=0,nl=nodeFilters.length;ni<nl;ni++){var _filter=nodeFilters[ni];if(_filter.name===name){var _match2=matches.nodes[name];if(_match2){_match2.nodes.push(node);}else{matches.nodes[name]={filter:_filter,nodes:[node]};}}}if(node.attributes){for(var ai=0,al=attributeFilters.length;ai<al;ai++){var _filter2=attributeFilters[ai];var attrName=_filter2.name;if(attrName in node.attributes.map){var _match3=matches.attributes[attrName];if(_match3){_match3.nodes.push(node);}else{matches.attributes[attrName]={filter:_filter2,nodes:[node]};}}}}};var findMatchingNodes=(nodeFilters,attributeFilters,node)=>{var matches={nodes:{},attributes:{}};if(node.firstChild){traverse(node,childNode=>{matchNode$1(nodeFilters,attributeFilters,childNode,matches);});}return matches;};var runFilters=(matches,args)=>{var run=(matchRecord,filteringAttributes)=>{each$d(matchRecord,match=>{var nodes=from(match.nodes);each$e(match.filter.callbacks,callback=>{for(var i=nodes.length-1;i>=0;i--){var node=nodes[i];var valueMatches=filteringAttributes?node.attr(match.filter.name)!==undefined:node.name===match.filter.name;if(!valueMatches||isNullable(node.parent)){nodes.splice(i,1);}}if(nodes.length>0){callback(nodes,match.filter.name,args);}});});};run(matches.nodes,false);run(matches.attributes,true);};var filter$2=function filter$2(nodeFilters,attributeFilters,node){var args=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var matches=findMatchingNodes(nodeFilters,attributeFilters,node);runFilters(matches,args);};var paddEmptyNode=(settings,args,isBlock,node)=>{var brPreferred=settings.pad_empty_with_br||args.insert;if(brPreferred&&isBlock(node)){var astNode=new AstNode('br',1);if(args.insert){astNode.attr('data-mce-bogus','1');}node.empty().append(astNode);}else{node.empty().append(new AstNode('#text',3)).value=nbsp;}};var isPaddedWithNbsp=node=>{var _a;return hasOnlyChild(node,'#text')&&((_a=node===null||node===void 0?void 0:node.firstChild)===null||_a===void 0?void 0:_a.value)===nbsp;};var hasOnlyChild=(node,name)=>{var firstChild=node===null||node===void 0?void 0:node.firstChild;return isNonNullable(firstChild)&&firstChild===node.lastChild&&firstChild.name===name;};var isPadded=(schema,node)=>{var rule=schema.getElementRule(node.name);return(rule===null||rule===void 0?void 0:rule.paddEmpty)===true;};var isEmpty=(schema,nonEmptyElements,whitespaceElements,node)=>node.isEmpty(nonEmptyElements,whitespaceElements,node=>isPadded(schema,node));var isLineBreakNode=(node,isBlock)=>isNonNullable(node)&&(isBlock(node)||node.name==='br');var findClosestEditingHost=scope=>{var editableNode;for(var node=scope;node;node=node.parent){var contentEditable=node.attr('contenteditable');if(contentEditable==='false'){break;}else if(contentEditable==='true'){editableNode=node;}}return Optional.from(editableNode);};var removeOrUnwrapInvalidNode=function removeOrUnwrapInvalidNode(node,schema){var originalNodeParent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:node.parent;if(schema.getSpecialElements()[node.name]){node.empty().remove();}else{var _children4=node.children();for(var childNode of _children4){if(originalNodeParent&&!schema.isValidChild(originalNodeParent.name,childNode.name)){removeOrUnwrapInvalidNode(childNode,schema,originalNodeParent);}}node.unwrap();}};var cleanInvalidNodes=function cleanInvalidNodes(nodes,schema,rootNode){var onCreate=arguments.length>3&&arguments[3]!==undefined?arguments[3]:noop;var textBlockElements=schema.getTextBlockElements();var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhitespaceElements();var nonSplittableElements=Tools.makeMap('tr,td,th,tbody,thead,tfoot,table,summary');var fixed=new Set();var isSplittableElement=node=>node!==rootNode&&!nonSplittableElements[node.name];for(var ni=0;ni<nodes.length;ni++){var node=nodes[ni];var _parent5=void 0;var newParent=void 0;var tempNode=void 0;if(!node.parent||fixed.has(node)){continue;}if(textBlockElements[node.name]&&node.parent.name==='li'){var _sibling10=node.next;while(_sibling10){if(textBlockElements[_sibling10.name]){_sibling10.name='li';fixed.add(_sibling10);node.parent.insert(_sibling10,node.parent);}else{break;}_sibling10=_sibling10.next;}node.unwrap();continue;}var _parents=[node];for(_parent5=node.parent;_parent5&&!schema.isValidChild(_parent5.name,node.name)&&isSplittableElement(_parent5);_parent5=_parent5.parent){_parents.push(_parent5);}if(_parent5&&_parents.length>1){if(schema.isValidChild(_parent5.name,node.name)){_parents.reverse();newParent=_parents[0].clone();onCreate(newParent);var currentNode=newParent;for(var i=0;i<_parents.length-1;i++){if(schema.isValidChild(currentNode.name,_parents[i].name)&&i>0){tempNode=_parents[i].clone();onCreate(tempNode);currentNode.append(tempNode);}else{tempNode=currentNode;}for(var childNode=_parents[i].firstChild;childNode&&childNode!==_parents[i+1];){var nextNode=childNode.next;tempNode.append(childNode);childNode=nextNode;}currentNode=tempNode;}if(!isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)){_parent5.insert(newParent,_parents[0],true);_parent5.insert(node,newParent);}else{_parent5.insert(node,_parents[0],true);}_parent5=_parents[0];if(isEmpty(schema,nonEmptyElements,whitespaceElements,_parent5)||hasOnlyChild(_parent5,'br')){_parent5.empty().remove();}}else{removeOrUnwrapInvalidNode(node,schema);}}else if(node.parent){if(node.name==='li'){var _sibling11=node.prev;if(_sibling11&&(_sibling11.name==='ul'||_sibling11.name==='ol')){_sibling11.append(node);continue;}_sibling11=node.next;if(_sibling11&&(_sibling11.name==='ul'||_sibling11.name==='ol')&&_sibling11.firstChild){_sibling11.insert(node,_sibling11.firstChild,true);continue;}var wrapper=new AstNode('ul',1);onCreate(wrapper);node.wrap(wrapper);continue;}if(schema.isValidChild(node.parent.name,'div')&&schema.isValidChild('div',node.name)){var _wrapper=new AstNode('div',1);onCreate(_wrapper);node.wrap(_wrapper);}else{removeOrUnwrapInvalidNode(node,schema);}}}};var hasClosest=(node,parentName)=>{var tempNode=node;while(tempNode){if(tempNode.name===parentName){return true;}tempNode=tempNode.parent;}return false;};var isInvalid=function isInvalid(schema,node){var parent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:node.parent;if(parent&&schema.children[node.name]&&!schema.isValidChild(parent.name,node.name)){return true;}else if(parent&&node.name==='a'&&hasClosest(parent,'a')){return true;}else{return false;}};var createRange=(sc,so,ec,eo)=>{var rng=document.createRange();rng.setStart(sc,so);rng.setEnd(ec,eo);return rng;};var normalizeBlockSelectionRange=rng=>{var startPos=CaretPosition.fromRangeStart(rng);var endPos=CaretPosition.fromRangeEnd(rng);var rootNode=rng.commonAncestorContainer;return fromPosition(false,rootNode,endPos).map(newEndPos=>{if(!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)){return createRange(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset());}else{return rng;}}).getOr(rng);};var normalize=rng=>rng.collapsed?rng:normalizeBlockSelectionRange(rng);var hasOnlyOneChild$1=node=>{return isNonNullable(node.firstChild)&&node.firstChild===node.lastChild;};var isPaddingNode=node=>{return node.name==='br'||node.value===nbsp;};var isPaddedEmptyBlock=(schema,node)=>{var blockElements=schema.getBlockElements();return blockElements[node.name]&&hasOnlyOneChild$1(node)&&isPaddingNode(node.firstChild);};var isEmptyFragmentElement=(schema,node)=>{var nonEmptyElements=schema.getNonEmptyElements();return isNonNullable(node)&&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node));};var isListFragment=(schema,fragment)=>{var firstChild=fragment.firstChild;var lastChild=fragment.lastChild;if(firstChild&&firstChild.name==='meta'){firstChild=firstChild.next;}if(lastChild&&lastChild.attr('id')==='mce_marker'){lastChild=lastChild.prev;}if(isEmptyFragmentElement(schema,lastChild)){lastChild=lastChild===null||lastChild===void 0?void 0:lastChild.prev;}if(!firstChild||firstChild!==lastChild){return false;}return firstChild.name==='ul'||firstChild.name==='ol';};var cleanupDomFragment=domFragment=>{var _a,_b;var firstChild=domFragment.firstChild;var lastChild=domFragment.lastChild;if(firstChild&&firstChild.nodeName==='META'){(_a=firstChild.parentNode)===null||_a===void 0?void 0:_a.removeChild(firstChild);}if(lastChild&&lastChild.id==='mce_marker'){(_b=lastChild.parentNode)===null||_b===void 0?void 0:_b.removeChild(lastChild);}return domFragment;};var toDomFragment=(dom,serializer,fragment)=>{var html=serializer.serialize(fragment);var domFragment=dom.createFragment(html);return cleanupDomFragment(domFragment);};var listItems=elm=>{var _a;return filter$5((_a=elm===null||elm===void 0?void 0:elm.childNodes)!==null&&_a!==void 0?_a:[],child=>{return child.nodeName==='LI';});};var isPadding=node=>{return node.data===nbsp||isBr$6(node);};var isListItemPadded=node=>{return isNonNullable(node===null||node===void 0?void 0:node.firstChild)&&node.firstChild===node.lastChild&&isPadding(node.firstChild);};var isEmptyOrPadded=elm=>{return!elm.firstChild||isListItemPadded(elm);};var trimListItems=elms=>{return elms.length>0&&isEmptyOrPadded(elms[elms.length-1])?elms.slice(0,-1):elms;};var getParentLi=(dom,node)=>{var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&parentBlock.nodeName==='LI'?parentBlock:null;};var isParentBlockLi=(dom,node)=>{return!!getParentLi(dom,node);};var getSplit=(parentNode,rng)=>{var beforeRng=rng.cloneRange();var afterRng=rng.cloneRange();beforeRng.setStartBefore(parentNode);afterRng.setEndAfter(parentNode);return[beforeRng.cloneContents(),afterRng.cloneContents()];};var findFirstIn=(node,rootNode)=>{var caretPos=CaretPosition.before(node);var caretWalker=CaretWalker(rootNode);var newCaretPos=caretWalker.next(caretPos);return newCaretPos?newCaretPos.toRange():null;};var findLastOf=(node,rootNode)=>{var caretPos=CaretPosition.after(node);var caretWalker=CaretWalker(rootNode);var newCaretPos=caretWalker.prev(caretPos);return newCaretPos?newCaretPos.toRange():null;};var insertMiddle=(target,elms,rootNode,rng)=>{var parts=getSplit(target,rng);var parentElm=target.parentNode;if(parentElm){parentElm.insertBefore(parts[0],target);Tools.each(elms,li=>{parentElm.insertBefore(li,target);});parentElm.insertBefore(parts[1],target);parentElm.removeChild(target);}return findLastOf(elms[elms.length-1],rootNode);};var insertBefore$2=(target,elms,rootNode)=>{var parentElm=target.parentNode;if(parentElm){Tools.each(elms,elm=>{parentElm.insertBefore(elm,target);});}return findFirstIn(target,rootNode);};var insertAfter$2=(target,elms,rootNode,dom)=>{dom.insertAfter(elms.reverse(),target);return findLastOf(elms[0],rootNode);};var insertAtCaret$1=(serializer,dom,rng,fragment)=>{var domFragment=toDomFragment(dom,serializer,fragment);var liTarget=getParentLi(dom,rng.startContainer);var liElms=trimListItems(listItems(domFragment.firstChild));var BEGINNING=1,END=2;var rootNode=dom.getRoot();var isAt=location=>{var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=CaretWalker(dom.getRoot());var newPos=location===BEGINNING?caretWalker.prev(caretPos):caretWalker.next(caretPos);var newPosNode=newPos===null||newPos===void 0?void 0:newPos.getNode();return newPosNode?getParentLi(dom,newPosNode)!==liTarget:true;};if(!liTarget){return null;}else if(isAt(BEGINNING)){return insertBefore$2(liTarget,liElms,rootNode);}else if(isAt(END)){return insertAfter$2(liTarget,liElms,rootNode,dom);}else{return insertMiddle(liTarget,liElms,rootNode,rng);}};var mergeableWrappedElements=['pre'];var shouldPasteContentOnly=(dom,fragment,parentNode,root)=>{var _a;var firstNode=fragment.firstChild;var lastNode=fragment.lastChild;var last=lastNode.attr('data-mce-type')==='bookmark'?lastNode.prev:lastNode;var isPastingSingleElement=firstNode===last;var isWrappedElement=contains$2(mergeableWrappedElements,firstNode.name);if(isPastingSingleElement&&isWrappedElement){var _isContentEditable=firstNode.attr('contenteditable')!=='false';var isPastingInTheSameBlockTag=((_a=dom.getParent(parentNode,dom.isBlock))===null||_a===void 0?void 0:_a.nodeName.toLowerCase())===firstNode.name;var isPastingInContentEditable=Optional.from(getContentEditableRoot$1(root,parentNode)).forall(isContentEditableTrue$3);return _isContentEditable&&isPastingInTheSameBlockTag&&isPastingInContentEditable;}else{return false;}};var isTableCell=isTableCell$3;var isTableCellContentSelected=(dom,rng,cell)=>{if(isNonNullable(cell)){var endCell=dom.getParent(rng.endContainer,isTableCell);return cell===endCell&&hasAllContentsSelected(SugarElement.fromDom(cell),rng);}else{return false;}};var validInsertion=(editor,value,parentNode)=>{var _a;if(parentNode.getAttribute('data-mce-bogus')==='all'){(_a=parentNode.parentNode)===null||_a===void 0?void 0:_a.insertBefore(editor.dom.createFragment(value),parentNode);}else{var node=parentNode.firstChild;var node2=parentNode.lastChild;if(!node||node===node2&&node.nodeName==='BR'){editor.dom.setHTML(parentNode,value);}else{editor.selection.setContent(value,{no_events:true});}}};var trimBrsFromTableCell=(dom,elm)=>{Optional.from(dom.getParent(elm,'td,th')).map(SugarElement.fromDom).each(trimBlockTrailingBr);};var reduceInlineTextElements=(editor,merge)=>{var textInlineElements=editor.schema.getTextInlineElements();var dom=editor.dom;if(merge){var root=editor.getBody();var elementUtils=ElementUtils(editor);Tools.each(dom.select('*[data-mce-fragment]'),node=>{var isInline=isNonNullable(textInlineElements[node.nodeName.toLowerCase()]);if(isInline&&hasInheritableStyles(dom,node)){for(var parentNode=node.parentElement;isNonNullable(parentNode)&&parentNode!==root;parentNode=parentNode.parentElement){var styleConflict=hasStyleConflict(dom,node,parentNode);if(styleConflict){break;}if(elementUtils.compare(parentNode,node)){dom.remove(node,true);break;}}}});}};var markFragmentElements=fragment=>{var node=fragment;while(node=node.walk()){if(node.type===1){node.attr('data-mce-fragment','1');}}};var unmarkFragmentElements=elm=>{Tools.each(elm.getElementsByTagName('*'),elm=>{elm.removeAttribute('data-mce-fragment');});};var isPartOfFragment=node=>{return!!node.getAttribute('data-mce-fragment');};var canHaveChildren=(editor,node)=>{return isNonNullable(node)&&!editor.schema.getVoidElements()[node.nodeName];};var moveSelectionToMarker=(editor,marker)=>{var _a,_b,_c;var nextRng;var dom=editor.dom;var selection=editor.selection;if(!marker){return;}selection.scrollIntoView(marker);var parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if(parentEditableElm&&dom.getContentEditable(parentEditableElm)==='false'){dom.remove(marker);selection.select(parentEditableElm);return;}var rng=dom.createRng();var node=marker.previousSibling;if(isText$a(node)){rng.setStart(node,(_b=(_a=node.nodeValue)===null||_a===void 0?void 0:_a.length)!==null&&_b!==void 0?_b:0);var node2=marker.nextSibling;if(isText$a(node2)){node.appendData(node2.data);(_c=node2.parentNode)===null||_c===void 0?void 0:_c.removeChild(node2);}}else{rng.setStartBefore(marker);rng.setEndBefore(marker);}var findNextCaretRng=rng=>{var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=CaretWalker(editor.getBody());caretPos=caretWalker.next(caretPos);return caretPos===null||caretPos===void 0?void 0:caretPos.toRange();};var parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker);if(parentBlock&&dom.isEmpty(parentBlock)){var isCell=isTableCell(parentBlock);empty(SugarElement.fromDom(parentBlock));rng.setStart(parentBlock,0);rng.setEnd(parentBlock,0);if(!isCell&&!isPartOfFragment(parentBlock)&&(nextRng=findNextCaretRng(rng))){rng=nextRng;dom.remove(parentBlock);}else{dom.add(parentBlock,dom.create('br',isCell?{}:{'data-mce-bogus':'1'}));}}selection.setRng(rng);};var deleteSelectedContent=editor=>{var dom=editor.dom;var rng=normalize(editor.selection.getRng());editor.selection.setRng(rng);var startCell=dom.getParent(rng.startContainer,isTableCell);if(isTableCellContentSelected(dom,rng,startCell)){deleteCellContents(editor,rng,SugarElement.fromDom(startCell));}else if(rng.startContainer===rng.endContainer&&rng.endOffset-rng.startOffset===1&&isText$a(rng.startContainer.childNodes[rng.startOffset])){rng.deleteContents();}else{editor.getDoc().execCommand('Delete',false);}};var findMarkerNode=scope=>{for(var markerNode=scope;markerNode;markerNode=markerNode.walk()){if(markerNode.attr('id')==='mce_marker'){return Optional.some(markerNode);}}return Optional.none();};var insertHtmlAtCaret=(editor,value,details)=>{var _a,_b;var selection=editor.selection;var dom=editor.dom;var parser=editor.parser;var merge=details.merge;var serializer=HtmlSerializer({validate:true},editor.schema);var bookmarkHtml='<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;</span>';if(value.indexOf('{$caret}')===-1){value+='{$caret}';}value=value.replace(/\\{\\$caret\\}/,bookmarkHtml);var rng=selection.getRng();var caretElement=rng.startContainer;var body=editor.getBody();if(caretElement===body&&selection.isCollapsed()){if(dom.isBlock(body.firstChild)&&canHaveChildren(editor,body.firstChild)&&dom.isEmpty(body.firstChild)){rng=dom.createRng();rng.setStart(body.firstChild,0);rng.setEnd(body.firstChild,0);selection.setRng(rng);}}if(!selection.isCollapsed()){deleteSelectedContent(editor);}var parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase(),data:details.data,insert:true};var fragment=parser.parse(value,parserArgs);if(details.paste===true&&isListFragment(editor.schema,fragment)&&isParentBlockLi(dom,parentNode)){rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment);if(rng){selection.setRng(rng);}return value;}if(details.paste===true&&shouldPasteContentOnly(dom,fragment,parentNode,editor.getBody())){(_a=fragment.firstChild)===null||_a===void 0?void 0:_a.unwrap();}markFragmentElements(fragment);var node=fragment.lastChild;if(node&&node.attr('id')==='mce_marker'){var marker=node;for(node=node.prev;node;node=node.walk(true)){if(node.type===3||!dom.isBlock(node.name)){if(node.parent&&editor.schema.isValidChild(node.parent.name,'span')){node.parent.insert(marker,node,node.name==='br');}break;}}}editor._selectionOverrides.showBlockCaretContainer(parentNode);if(!parserArgs.invalid){value=serializer.serialize(fragment);validInsertion(editor,value,parentNode);}else{editor.selection.setContent(bookmarkHtml);var _parentNode=selection.getNode();var tempNode;var rootNode=editor.getBody();if(isDocument$1(_parentNode)){_parentNode=tempNode=rootNode;}else{tempNode=_parentNode;}while(tempNode&&tempNode!==rootNode){_parentNode=tempNode;tempNode=tempNode.parentNode;}value=_parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(_parentNode);var root=parser.parse(value);var markerNode=findMarkerNode(root);var editingHost=markerNode.bind(findClosestEditingHost).getOr(root);markerNode.each(marker=>marker.replace(fragment));var toExtract=fragment.children();var _parent6=(_b=fragment.parent)!==null&&_b!==void 0?_b:root;fragment.unwrap();var invalidChildren=filter$5(toExtract,node=>isInvalid(editor.schema,node,_parent6));cleanInvalidNodes(invalidChildren,editor.schema,editingHost);filter$2(parser.getNodeFilters(),parser.getAttributeFilters(),root);value=serializer.serialize(root);if(_parentNode===rootNode){dom.setHTML(rootNode,value);}else{dom.setOuterHTML(_parentNode,value);}}reduceInlineTextElements(editor,merge);moveSelectionToMarker(editor,dom.get('mce_marker'));unmarkFragmentElements(editor.getBody());trimBrsFromTableCell(dom,selection.getStart());updateCaret(editor.schema,editor.getBody(),selection.getStart());return value;};var isTreeNode=content=>content instanceof AstNode;var moveSelection=editor=>{if(hasFocus(editor)){firstPositionIn(editor.getBody()).each(pos=>{var node=pos.getNode();var caretPos=isTable$2(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange());});}};var setEditorHtml=(editor,html,noSelection)=>{editor.dom.setHTML(editor.getBody(),html);if(noSelection!==true){moveSelection(editor);}};var setContentString=(editor,body,content,args)=>{if(content.length===0||/^\\s+$/.test(content)){var padd='<br data-mce-bogus=\"1\">';if(body.nodeName==='TABLE'){content='<tr><td>'+padd+'</td></tr>';}else if(/^(UL|OL)$/.test(body.nodeName)){content='<li>'+padd+'</li>';}var forcedRootBlockName=getForcedRootBlock(editor);if(editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())){content=padd;content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content);}else if(!content){content=padd;}setEditorHtml(editor,content,args.no_selection);return{content,html:content};}else{if(args.format!=='raw'){content=HtmlSerializer({validate:false},editor.schema).serialize(editor.parser.parse(content,{isRootContent:true,insert:true}));}var trimmedHtml=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content);setEditorHtml(editor,trimmedHtml,args.no_selection);return{content:trimmedHtml,html:trimmedHtml};}};var setContentTree=(editor,body,content,args)=>{filter$2(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:false},editor.schema).serialize(content);var trimmedHtml=isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html);setEditorHtml(editor,trimmedHtml,args.no_selection);return{content,html:trimmedHtml};};var setContentInternal=(editor,content,args)=>{return Optional.from(editor.getBody()).map(body=>{if(isTreeNode(content)){return setContentTree(editor,body,content,args);}else{return setContentString(editor,body,content,args);}}).getOr({content,html:isTreeNode(args.content)?'':args.content});};var ancestor$1=(scope,predicate,isRoot)=>ancestor$4(scope,predicate,isRoot).isSome();var sibling=(scope,predicate)=>sibling$1(scope,predicate).isSome();var ensureIsRoot=isRoot=>isFunction(isRoot)?isRoot:never;var ancestor=(scope,transform,isRoot)=>{var element=scope.dom;var stop=ensureIsRoot(isRoot);while(element.parentNode){element=element.parentNode;var el=SugarElement.fromDom(element);var transformed=transform(el);if(transformed.isSome()){return transformed;}else if(stop(el)){break;}}return Optional.none();};var closest$1=(scope,transform,isRoot)=>{var current=transform(scope);var stop=ensureIsRoot(isRoot);return current.orThunk(()=>stop(scope)?Optional.none():ancestor(scope,transform,stop));};var isEq$3=isEq$5;var matchesUnInheritedFormatSelector=(ed,node,name)=>{var formatList=ed.formatter.get(name);if(formatList){for(var i=0;i<formatList.length;i++){var format=formatList[i];if(isSelectorFormat(format)&&format.inherit===false&&ed.dom.is(node,format.selector)){return true;}}}return false;};var matchParents=(editor,node,name,vars,similar)=>{var root=editor.dom.getRoot();if(node===root){return false;}var matchedNode=editor.dom.getParent(node,elm=>{if(matchesUnInheritedFormatSelector(editor,elm,name)){return true;}return elm.parentNode===root||!!_matchNode(editor,elm,name,vars,true);});return!!_matchNode(editor,matchedNode,name,vars,similar);};var matchName=(dom,node,format)=>{if(isInlineFormat(format)&&isEq$3(node,format.inline)){return true;}if(isBlockFormat(format)&&isEq$3(node,format.block)){return true;}if(isSelectorFormat(format)){return isElement$6(node)&&dom.is(node,format.selector);}return false;};var matchItems=(dom,node,format,itemName,similar,vars)=>{var items=format[itemName];var matchAttributes=itemName==='attributes';if(isFunction(format.onmatch)){return format.onmatch(node,format,itemName);}if(items){if(!isArrayLike(items)){for(var key in items){if(has$2(items,key)){var _value10=matchAttributes?dom.getAttrib(node,key):getStyle(dom,node,key);var expectedValue=replaceVars(items[key],vars);var isEmptyValue=isNullable(_value10)||isEmpty$3(_value10);if(isEmptyValue&&isNullable(expectedValue)){continue;}if(similar&&isEmptyValue&&!format.exact){return false;}if((!similar||format.exact)&&!isEq$3(_value10,normalizeStyleValue(expectedValue,key))){return false;}}}}else{for(var i=0;i<items.length;i++){if(matchAttributes?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i])){return true;}}}}return true;};var _matchNode=(ed,node,name,vars,similar)=>{var formatList=ed.formatter.get(name);var dom=ed.dom;if(formatList&&isElement$6(node)){for(var i=0;i<formatList.length;i++){var format=formatList[i];if(matchName(ed.dom,node,format)&&matchItems(dom,node,format,'attributes',similar,vars)&&matchItems(dom,node,format,'styles',similar,vars)){var classes=format.classes;if(classes){for(var x=0;x<classes.length;x++){if(!ed.dom.hasClass(node,replaceVars(classes[x],vars))){return;}}}return format;}}}return undefined;};var match$2=(editor,name,vars,node,similar)=>{if(node){return matchParents(editor,node,name,vars,similar);}node=editor.selection.getNode();if(matchParents(editor,node,name,vars,similar)){return true;}var startNode=editor.selection.getStart();if(startNode!==node){if(matchParents(editor,startNode,name,vars,similar)){return true;}}return false;};var _matchAll=(editor,names,vars)=>{var matchedFormatNames=[];var checkedMap={};var startElement=editor.selection.getStart();editor.dom.getParent(startElement,node=>{for(var i=0;i<names.length;i++){var _name16=names[i];if(!checkedMap[_name16]&&_matchNode(editor,node,_name16,vars)){checkedMap[_name16]=true;matchedFormatNames.push(_name16);}}},editor.dom.getRoot());return matchedFormatNames;};var _closest=(editor,names)=>{var isRoot=elm=>eq(elm,SugarElement.fromDom(editor.getBody()));var match=(elm,name)=>_matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none();return Optional.from(editor.selection.getStart(true)).bind(rawElm=>closest$1(SugarElement.fromDom(rawElm),elm=>findMap(names,name=>match(elm,name)),isRoot)).getOrNull();};var _canApply=(editor,name)=>{var formatList=editor.formatter.get(name);var dom=editor.dom;if(formatList&&editor.selection.isEditable()){var startNode=editor.selection.getStart();var _parents2=getParents$2(dom,startNode);for(var x=formatList.length-1;x>=0;x--){var format=formatList[x];if(!isSelectorFormat(format)){return true;}for(var i=_parents2.length-1;i>=0;i--){if(dom.is(_parents2[i],format.selector)){return true;}}}}return false;};var matchAllOnNode=(editor,node,formatNames)=>foldl(formatNames,(acc,name)=>{var matchSimilar=isVariableFormatName(editor,name);if(editor.formatter.matchNode(node,name,{},matchSimilar)){return acc.concat([name]);}else{return acc;}},[]);var ZWSP=ZWSP$1;var importNode=(ownerDocument,node)=>{return ownerDocument.importNode(node,true);};var getEmptyCaretContainers=node=>{var nodes=[];var tempNode=node;while(tempNode){if(isText$a(tempNode)&&tempNode.data!==ZWSP||tempNode.childNodes.length>1){return[];}if(isElement$6(tempNode)){nodes.push(tempNode);}tempNode=tempNode.firstChild;}return nodes;};var isCaretContainerEmpty=node=>{return getEmptyCaretContainers(node).length>0;};var findFirstTextNode=node=>{if(node){var walker=new DomTreeWalker(node,node);for(var tempNode=walker.current();tempNode;tempNode=walker.next()){if(isText$a(tempNode)){return tempNode;}}}return null;};var createCaretContainer=fill=>{var caretContainer=SugarElement.fromTag('span');setAll$1(caretContainer,{'id':CARET_ID,'data-mce-bogus':'1','data-mce-type':'format-caret'});if(fill){append$1(caretContainer,SugarElement.fromText(ZWSP));}return caretContainer;};var trimZwspFromCaretContainer=caretContainerNode=>{var textNode=findFirstTextNode(caretContainerNode);if(textNode&&textNode.data.charAt(0)===ZWSP){textNode.deleteData(0,1);}return textNode;};var removeCaretContainerNode=function removeCaretContainerNode(editor,node){var moveCaret=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node)){deleteElement$2(editor,false,SugarElement.fromDom(node),moveCaret);}else{var rng=selection.getRng();var block=dom.getParent(node,dom.isBlock);var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;var textNode=trimZwspFromCaretContainer(node);dom.remove(node,true);if(startContainer===textNode&&startOffset>0){rng.setStart(textNode,startOffset-1);}if(endContainer===textNode&&endOffset>0){rng.setEnd(textNode,endOffset-1);}if(block&&dom.isEmpty(block)){fillWithPaddingBr(SugarElement.fromDom(block));}selection.setRng(rng);}};var removeCaretContainer=function removeCaretContainer(editor,node){var moveCaret=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var dom=editor.dom,selection=editor.selection;if(!node){node=getParentCaretContainer(editor.getBody(),selection.getStart());if(!node){while(node=dom.get(CARET_ID)){removeCaretContainerNode(editor,node,moveCaret);}}}else{removeCaretContainerNode(editor,node,moveCaret);}};var insertCaretContainerNode=(editor,caretContainer,formatNode)=>{var _a,_b;var dom=editor.dom;var block=dom.getParent(formatNode,curry(isTextBlock$1,editor.schema));if(block&&dom.isEmpty(block)){(_a=formatNode.parentNode)===null||_a===void 0?void 0:_a.replaceChild(caretContainer,formatNode);}else{removeTrailingBr(SugarElement.fromDom(formatNode));if(dom.isEmpty(formatNode)){(_b=formatNode.parentNode)===null||_b===void 0?void 0:_b.replaceChild(caretContainer,formatNode);}else{dom.insertAfter(caretContainer,formatNode);}}};var appendNode=(parentNode,node)=>{parentNode.appendChild(node);return node;};var insertFormatNodesIntoCaretContainer=(formatNodes,caretContainer)=>{var _a;var innerMostFormatNode=foldr(formatNodes,(parentNode,formatNode)=>{return appendNode(parentNode,formatNode.cloneNode(false));},caretContainer);var doc=(_a=innerMostFormatNode.ownerDocument)!==null&&_a!==void 0?_a:document;return appendNode(innerMostFormatNode,doc.createTextNode(ZWSP));};var cleanFormatNode=(editor,caretContainer,formatNode,name,vars,similar)=>{var formatter=editor.formatter;var dom=editor.dom;var validFormats=filter$5(keys(formatter.get()),formatName=>formatName!==name&&!contains$1(formatName,'removeformat'));var matchedFormats=matchAllOnNode(editor,formatNode,validFormats);var uniqueFormats=filter$5(matchedFormats,fmtName=>!areSimilarFormats(editor,fmtName,name));if(uniqueFormats.length>0){var clonedFormatNode=formatNode.cloneNode(false);dom.add(caretContainer,clonedFormatNode);formatter.remove(name,vars,clonedFormatNode,similar);dom.remove(clonedFormatNode);return Optional.some(clonedFormatNode);}else{return Optional.none();}};var applyCaretFormat=(editor,name,vars)=>{var caretContainer;var selection=editor.selection;var formatList=editor.formatter.get(name);if(!formatList){return;}var selectionRng=selection.getRng();var offset=selectionRng.startOffset;var container=selectionRng.startContainer;var text=container.nodeValue;caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart());var wordcharRegex=/[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){var bookmark=selection.getBookmark();selectionRng.collapse(true);var rng=expandRng(editor.dom,selectionRng,formatList);rng=split(rng);editor.formatter.apply(name,vars,rng);selection.moveToBookmark(bookmark);}else{var textNode=caretContainer?findFirstTextNode(caretContainer):null;if(!caretContainer||(textNode===null||textNode===void 0?void 0:textNode.data)!==ZWSP){caretContainer=importNode(editor.getDoc(),createCaretContainer(true).dom);textNode=caretContainer.firstChild;selectionRng.insertNode(caretContainer);offset=1;editor.formatter.apply(name,vars,caretContainer);}else{editor.formatter.apply(name,vars,caretContainer);}selection.setCursorLocation(textNode,offset);}};var removeCaretFormat=(editor,name,vars,similar)=>{var dom=editor.dom;var selection=editor.selection;var hasContentAfter=false;var formatList=editor.formatter.get(name);if(!formatList){return;}var rng=selection.getRng();var container=rng.startContainer;var offset=rng.startOffset;var node=container;if(isText$a(container)){if(offset!==container.data.length){hasContentAfter=true;}node=node.parentNode;}var parents=[];var formatNode;while(node){if(_matchNode(editor,node,name,vars,similar)){formatNode=node;break;}if(node.nextSibling){hasContentAfter=true;}parents.push(node);node=node.parentNode;}if(!formatNode){return;}if(hasContentAfter){var bookmark=selection.getBookmark();rng.collapse(true);var expandedRng=expandRng(dom,rng,formatList,true);expandedRng=split(expandedRng);editor.formatter.remove(name,vars,expandedRng,similar);selection.moveToBookmark(bookmark);}else{var caretContainer=getParentCaretContainer(editor.getBody(),formatNode);var newCaretContainer=createCaretContainer(false).dom;insertCaretContainerNode(editor,newCaretContainer,caretContainer!==null&&caretContainer!==void 0?caretContainer:formatNode);var cleanedFormatNode=cleanFormatNode(editor,newCaretContainer,formatNode,name,vars,similar);var caretTextNode=insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()),newCaretContainer);if(caretContainer){removeCaretContainerNode(editor,caretContainer,false);}selection.setCursorLocation(caretTextNode,1);if(dom.isEmpty(formatNode)){dom.remove(formatNode);}}};var disableCaretContainer=(editor,keyCode,moveCaret)=>{var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,moveCaret);if((keyCode===8||keyCode===46)&&selection.isCollapsed()&&selection.getStart().innerHTML===ZWSP){removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()));}if(keyCode===37||keyCode===39){removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()));}};var endsWithNbsp=element=>isText$a(element)&&endsWith(element.data,nbsp);var setup$u=editor=>{editor.on('mouseup keydown',e=>{disableCaretContainer(editor,e.keyCode,endsWithNbsp(editor.selection.getRng().endContainer));});};var createCaretFormat=formatNodes=>{var caretContainer=createCaretContainer(false);var innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);return{caretContainer,caretPosition:CaretPosition(innerMost,0)};};var replaceWithCaretFormat=(targetNode,formatNodes)=>{var{caretContainer,caretPosition}=createCaretFormat(formatNodes);before$3(SugarElement.fromDom(targetNode),caretContainer);remove$5(SugarElement.fromDom(targetNode));return caretPosition;};var createCaretFormatAtStart$1=(rng,formatNodes)=>{var{caretContainer,caretPosition}=createCaretFormat(formatNodes);rng.insertNode(caretContainer.dom);return caretPosition;};var isFormatElement=(editor,element)=>{var inlineElements=editor.schema.getTextInlineElements();return has$2(inlineElements,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom);};var isEmptyCaretFormatElement=element=>{return isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom);};var postProcessHooks={};var isPre=matchNodeNames(['pre']);var addPostProcessHook=(name,hook)=>{var hooks=postProcessHooks[name];if(!hooks){postProcessHooks[name]=[];}postProcessHooks[name].push(hook);};var postProcess$1=(name,editor)=>{if(has$2(postProcessHooks,name)){each$e(postProcessHooks[name],hook=>{hook(editor);});}};addPostProcessHook('pre',editor=>{var rng=editor.selection.getRng();var hasPreSibling=blocks=>pre=>{var prev=pre.previousSibling;return isPre(prev)&&contains$2(blocks,prev);};var joinPre=(pre1,pre2)=>{var sPre2=SugarElement.fromDom(pre2);var doc=documentOrOwner(sPre2).dom;remove$5(sPre2);append(SugarElement.fromDom(pre1),[SugarElement.fromTag('br',doc),SugarElement.fromTag('br',doc),...children$1(sPre2)]);};if(!rng.collapsed){var _blocks=editor.selection.getSelectedBlocks();var preBlocks=filter$5(filter$5(_blocks,isPre),hasPreSibling(_blocks));each$e(preBlocks,pre=>{joinPre(pre.previousSibling,pre);});}});var listItemStyles=['fontWeight','fontStyle','color','fontSize','fontFamily'];var hasListStyles=fmt=>isObject(fmt.styles)&&exists(keys(fmt.styles),name=>contains$2(listItemStyles,name));var findExpandedListItemFormat=formats=>find$2(formats,fmt=>isInlineFormat(fmt)&&fmt.inline==='span'&&hasListStyles(fmt));var getExpandedListItemFormat=(formatter,format)=>{var formatList=formatter.get(format);return isArray$1(formatList)?findExpandedListItemFormat(formatList):Optional.none();};var isRngStartAtStartOfElement=(rng,elm)=>prevPosition(elm,CaretPosition.fromRangeStart(rng)).isNone();var isRngEndAtEndOfElement=(rng,elm)=>{return nextPosition(elm,CaretPosition.fromRangeEnd(rng)).exists(pos=>!isBr$6(pos.getNode())||nextPosition(elm,pos).isSome())===false;};var isEditableListItem=dom=>elm=>isListItem$2(elm)&&dom.isEditable(elm);var getFullySelectedBlocks=selection=>{var blocks=selection.getSelectedBlocks();var rng=selection.getRng();if(selection.isCollapsed()){return[];}if(blocks.length===1){return isRngStartAtStartOfElement(rng,blocks[0])&&isRngEndAtEndOfElement(rng,blocks[0])?blocks:[];}else{var _first=head(blocks).filter(elm=>isRngStartAtStartOfElement(rng,elm)).toArray();var _last2=last$3(blocks).filter(elm=>isRngEndAtEndOfElement(rng,elm)).toArray();var middle=blocks.slice(1,-1);return _first.concat(middle).concat(_last2);}};var getFullySelectedListItems=selection=>filter$5(getFullySelectedBlocks(selection),isEditableListItem(selection.dom));var getPartiallySelectedListItems=selection=>filter$5(selection.getSelectedBlocks(),isEditableListItem(selection.dom));var each$8=Tools.each;var isElementNode=node=>isElement$6(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node);var findElementSibling=(node,siblingName)=>{for(var _sibling12=node;_sibling12;_sibling12=_sibling12[siblingName]){if(isText$a(_sibling12)&&isNotEmpty(_sibling12.data)){return node;}if(isElement$6(_sibling12)&&!isBookmarkNode$1(_sibling12)){return _sibling12;}}return node;};var mergeSiblingsNodes=(editor,prev,next)=>{var elementUtils=ElementUtils(editor);var isPrevEditable=isElement$6(prev)&&isEditable$2(prev);var isNextEditable=isElement$6(next)&&isEditable$2(next);if(isPrevEditable&&isNextEditable){var _prevSibling=findElementSibling(prev,'previousSibling');var _nextSibling=findElementSibling(next,'nextSibling');if(elementUtils.compare(_prevSibling,_nextSibling)){for(var _sibling13=_prevSibling.nextSibling;_sibling13&&_sibling13!==_nextSibling;){var tmpSibling=_sibling13;_sibling13=_sibling13.nextSibling;_prevSibling.appendChild(tmpSibling);}editor.dom.remove(_nextSibling);Tools.each(Tools.grep(_nextSibling.childNodes),node=>{_prevSibling.appendChild(node);});return _prevSibling;}}return next;};var mergeSiblings=(editor,format,vars,node)=>{var _a;if(node&&format.merge_siblings!==false){var newNode=(_a=mergeSiblingsNodes(editor,getNonWhiteSpaceSibling(node),node))!==null&&_a!==void 0?_a:node;mergeSiblingsNodes(editor,newNode,getNonWhiteSpaceSibling(newNode,true));}};var clearChildStyles=(dom,format,node)=>{if(format.clear_child_styles){var selector=format.links?'*:not(a)':'*';each$8(dom.select(selector,node),childNode=>{if(isElementNode(childNode)&&isEditable$2(childNode)){each$8(format.styles,(_value,name)=>{dom.setStyle(childNode,name,'');});}});}};var processChildElements=(node,filter,process)=>{each$8(node.childNodes,node=>{if(isElementNode(node)){if(filter(node)){process(node);}if(node.hasChildNodes()){processChildElements(node,filter,process);}}});};var unwrapEmptySpan=(dom,node)=>{if(node.nodeName==='SPAN'&&dom.getAttribs(node).length===0){dom.remove(node,true);}};var hasStyle=(dom,name)=>node=>!!(node&&getStyle(dom,node,name));var applyStyle=(dom,name,value)=>node=>{dom.setStyle(node,name,value);if(node.getAttribute('style')===''){node.removeAttribute('style');}unwrapEmptySpan(dom,node);};var removeResult=Adt.generate([{keep:[]},{rename:['name']},{removed:[]}]);var MCE_ATTR_RE=/^(src|href|style)$/;var each$7=Tools.each;var isEq$2=isEq$5;var isTableCellOrRow=node=>/^(TR|TH|TD)$/.test(node.nodeName);var isChildOfInlineParent=(dom,node,parent)=>dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent);var getContainer=(ed,rng,start)=>{var container=rng[start?'startContainer':'endContainer'];var offset=rng[start?'startOffset':'endOffset'];if(isElement$6(container)){var lastIdx=container.childNodes.length-1;if(!start&&offset){offset--;}container=container.childNodes[offset>lastIdx?lastIdx:offset];}if(isText$a(container)&&start&&offset>=container.data.length){container=new DomTreeWalker(container,ed.getBody()).next()||container;}if(isText$a(container)&&!start&&offset===0){container=new DomTreeWalker(container,ed.getBody()).prev()||container;}return container;};var normalizeTableSelection=(node,start)=>{var prop=start?'firstChild':'lastChild';var childNode=node[prop];if(isTableCellOrRow(node)&&childNode){if(node.nodeName==='TR'){return childNode[prop]||childNode;}else{return childNode;}}return node;};var wrap$1=(dom,node,name,attrs)=>{var _a;var wrapper=dom.create(name,attrs);(_a=node.parentNode)===null||_a===void 0?void 0:_a.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper;};var wrapWithSiblings=(dom,node,next,name,attrs)=>{var start=SugarElement.fromDom(node);var wrapper=SugarElement.fromDom(dom.create(name,attrs));var siblings=next?nextSiblings(start):prevSiblings(start);append(wrapper,siblings);if(next){before$3(start,wrapper);prepend(wrapper,start);}else{after$4(start,wrapper);append$1(wrapper,start);}return wrapper.dom;};var isColorFormatAndAnchor=(node,format)=>format.links&&node.nodeName==='A';var removeNode=(ed,node,format)=>{var parentNode=node.parentNode;var rootBlockElm;var dom=ed.dom;var forcedRootBlock=getForcedRootBlock(ed);if(isBlockFormat(format)){if(parentNode===dom.getRoot()){if(!format.list_block||!isEq$2(node,format.list_block)){each$e(from(node.childNodes),node=>{if(isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())){if(!rootBlockElm){rootBlockElm=wrap$1(dom,node,forcedRootBlock);dom.setAttribs(rootBlockElm,getForcedRootBlockAttrs(ed));}else{rootBlockElm.appendChild(node);}}else{rootBlockElm=null;}});}}}if(isMixedFormat(format)&&!isEq$2(format.inline,node)){return;}dom.remove(node,true);};var processFormatAttrOrStyle=(name,value,vars)=>{if(isNumber(name)){return{name:value,value:null};}else{return{name,value:replaceVars(value,vars)};}};var removeEmptyStyleAttributeIfNeeded=(dom,elm)=>{if(dom.getAttrib(elm,'style')===''){elm.removeAttribute('style');elm.removeAttribute('data-mce-style');}};var removeStyles=(dom,elm,format,vars,compareNode)=>{var stylesModified=false;each$7(format.styles,(value,name)=>{var{name:styleName,value:styleValue}=processFormatAttrOrStyle(name,value,vars);var normalizedStyleValue=normalizeStyleValue(styleValue,styleName);if(format.remove_similar||isNull(styleValue)||!isElement$6(compareNode)||isEq$2(getStyle(dom,compareNode,styleName),normalizedStyleValue)){dom.setStyle(elm,styleName,'');}stylesModified=true;});if(stylesModified){removeEmptyStyleAttributeIfNeeded(dom,elm);}};var removeListStyleFormats=(editor,name,vars)=>{if(name==='removeformat'){each$e(getPartiallySelectedListItems(editor.selection),li=>{each$e(listItemStyles,name=>editor.dom.setStyle(li,name,''));removeEmptyStyleAttributeIfNeeded(editor.dom,li);});}else{getExpandedListItemFormat(editor.formatter,name).each(liFmt=>{each$e(getPartiallySelectedListItems(editor.selection),li=>removeStyles(editor.dom,li,liFmt,vars,null));});}};var removeNodeFormatInternal=(ed,format,vars,node,compareNode)=>{var dom=ed.dom;var elementUtils=ElementUtils(ed);var schema=ed.schema;if(isInlineFormat(format)&&isTransparentElementName(schema,format.inline)&&isTransparentBlock(schema,node)&&node.parentElement===ed.getBody()){removeNode(ed,node,format);return removeResult.removed();}if(!format.ceFalseOverride&&node&&dom.getContentEditableParent(node)==='false'){return removeResult.keep();}if(node&&!matchName(dom,node,format)&&!isColorFormatAndAnchor(node,format)){return removeResult.keep();}var elm=node;var preserveAttributes=format.preserve_attributes;if(isInlineFormat(format)&&format.remove==='all'&&isArray$1(preserveAttributes)){var attrsToPreserve=filter$5(dom.getAttribs(elm),attr=>contains$2(preserveAttributes,attr.name.toLowerCase()));dom.removeAllAttribs(elm);each$e(attrsToPreserve,attr=>dom.setAttrib(elm,attr.name,attr.value));if(attrsToPreserve.length>0){return removeResult.rename('span');}}if(format.remove!=='all'){removeStyles(dom,elm,format,vars,compareNode);each$7(format.attributes,(value,name)=>{var{name:attrName,value:attrValue}=processFormatAttrOrStyle(name,value,vars);if(format.remove_similar||isNull(attrValue)||!isElement$6(compareNode)||isEq$2(dom.getAttrib(compareNode,attrName),attrValue)){if(attrName==='class'){var currentValue=dom.getAttrib(elm,attrName);if(currentValue){var valueOut='';each$e(currentValue.split(/\\s+/),cls=>{if(/mce\\-\\w+/.test(cls)){valueOut+=(valueOut?' ':'')+cls;}});if(valueOut){dom.setAttrib(elm,attrName,valueOut);return;}}}if(MCE_ATTR_RE.test(attrName)){elm.removeAttribute('data-mce-'+attrName);}if(attrName==='style'&&matchNodeNames(['li'])(elm)&&dom.getStyle(elm,'list-style-type')==='none'){elm.removeAttribute(attrName);dom.setStyle(elm,'list-style-type','none');return;}if(attrName==='class'){elm.removeAttribute('className');}elm.removeAttribute(attrName);}});each$7(format.classes,value=>{value=replaceVars(value,vars);if(!isElement$6(compareNode)||dom.hasClass(compareNode,value)){dom.removeClass(elm,value);}});var attrs=dom.getAttribs(elm);for(var i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(!elementUtils.isAttributeInternal(attrName)){return removeResult.keep();}}}if(format.remove!=='none'){removeNode(ed,elm,format);return removeResult.removed();}return removeResult.keep();};var findFormatRoot=(editor,container,name,vars,similar)=>{var formatRoot;if(container.parentNode){each$e(getParents$2(editor.dom,container.parentNode).reverse(),parent=>{if(!formatRoot&&isElement$6(parent)&&parent.id!=='_start'&&parent.id!=='_end'){var format=_matchNode(editor,parent,name,vars,similar);if(format&&format.split!==false){formatRoot=parent;}}});}return formatRoot;};var removeNodeFormatFromClone=(editor,format,vars,clone)=>removeNodeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),newName=>{var fragment=editor.dom.createFragment();fragment.appendChild(clone);return editor.dom.rename(clone,newName);},constant(null));var wrapAndSplit=(editor,formatList,formatRoot,container,target,split,format,vars)=>{var _a,_b;var lastClone;var firstClone;var dom=editor.dom;if(formatRoot){var formatRootParent=formatRoot.parentNode;for(var _parent7=container.parentNode;_parent7&&_parent7!==formatRootParent;_parent7=_parent7.parentNode){var _clone=dom.clone(_parent7,false);for(var i=0;i<formatList.length;i++){_clone=removeNodeFormatFromClone(editor,formatList[i],vars,_clone);if(_clone===null){break;}}if(_clone){if(lastClone){_clone.appendChild(lastClone);}if(!firstClone){firstClone=_clone;}lastClone=_clone;}}if(split&&(!format.mixed||!dom.isBlock(formatRoot))){container=(_a=dom.split(formatRoot,container))!==null&&_a!==void 0?_a:container;}if(lastClone&&firstClone){(_b=target.parentNode)===null||_b===void 0?void 0:_b.insertBefore(lastClone,target);firstClone.appendChild(target);if(isInlineFormat(format)){mergeSiblings(editor,format,vars,lastClone);}}}return container;};var removeFormatInternal=(ed,name,vars,node,similar)=>{var formatList=ed.formatter.get(name);var format=formatList[0];var dom=ed.dom;var selection=ed.selection;var splitToFormatRoot=container=>{var formatRoot=findFormatRoot(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,true,format,vars);};var isRemoveBookmarkNode=node=>isBookmarkNode$1(node)&&isElement$6(node)&&(node.id==='_start'||node.id==='_end');var removeFormatOnNode=node=>exists(formatList,fmt=>removeNodeFormat(ed,fmt,vars,node,node));var process=node=>{var children=from(node.childNodes);var removed=removeFormatOnNode(node);var currentNodeMatches=removed||exists(formatList,f=>matchName(dom,node,f));var parentNode=node.parentNode;if(!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)){removeFormatOnNode(parentNode);}if(format.deep){if(children.length){for(var i=0;i<children.length;i++){process(children[i]);}}}var textDecorations=['underline','line-through','overline'];each$e(textDecorations,decoration=>{if(isElement$6(node)&&ed.dom.getStyle(node,'text-decoration')===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration){removeNodeFormat(ed,{deep:false,exact:true,inline:'span',styles:{textDecoration:decoration}},undefined,node);}});};var unwrap=start=>{var node=dom.get(start?'_start':'_end');if(node){var out=node[start?'firstChild':'lastChild'];if(isRemoveBookmarkNode(out)){out=out[start?'firstChild':'lastChild'];}if(isText$a(out)&&out.data.length===0){out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling;}dom.remove(node,true);return out;}else{return null;}};var removeRngStyle=rng=>{var startContainer;var endContainer;var expandedRng=expandRng(dom,rng,formatList,rng.collapsed);if(format.split){expandedRng=split(expandedRng);startContainer=getContainer(ed,expandedRng,true);endContainer=getContainer(ed,expandedRng);if(startContainer!==endContainer){startContainer=normalizeTableSelection(startContainer,true);endContainer=normalizeTableSelection(endContainer,false);if(isChildOfInlineParent(dom,startContainer,endContainer)){var marker=Optional.from(startContainer.firstChild).getOr(startContainer);splitToFormatRoot(wrapWithSiblings(dom,marker,true,'span',{'id':'_start','data-mce-type':'bookmark'}));unwrap(true);return;}if(isChildOfInlineParent(dom,endContainer,startContainer)){var _marker=Optional.from(endContainer.lastChild).getOr(endContainer);splitToFormatRoot(wrapWithSiblings(dom,_marker,false,'span',{'id':'_end','data-mce-type':'bookmark'}));unwrap(false);return;}startContainer=wrap$1(dom,startContainer,'span',{'id':'_start','data-mce-type':'bookmark'});endContainer=wrap$1(dom,endContainer,'span',{'id':'_end','data-mce-type':'bookmark'});var newRng=dom.createRng();newRng.setStartAfter(startContainer);newRng.setEndBefore(endContainer);walk$3(dom,newRng,nodes=>{each$e(nodes,n=>{if(!isBookmarkNode$1(n)&&!isBookmarkNode$1(n.parentNode)){splitToFormatRoot(n);}});});splitToFormatRoot(startContainer);splitToFormatRoot(endContainer);startContainer=unwrap(true);endContainer=unwrap();}else{startContainer=endContainer=splitToFormatRoot(startContainer);}expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer;expandedRng.startOffset=dom.nodeIndex(startContainer);expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer;expandedRng.endOffset=dom.nodeIndex(endContainer)+1;}walk$3(dom,expandedRng,nodes=>{each$e(nodes,process);});};if(node){if(isNode(node)){var rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);removeRngStyle(rng);}else{removeRngStyle(node);}fireFormatRemove(ed,name,node,vars);return;}if(!selection.isCollapsed()||!isInlineFormat(format)||getCellsFromEditor(ed).length){preserveSelection(ed,()=>runOnRanges(ed,removeRngStyle),startNode=>isInlineFormat(format)&&match$2(ed,name,vars,startNode));ed.nodeChanged();}else{removeCaretFormat(ed,name,vars,similar);}removeListStyleFormats(ed,name,vars);fireFormatRemove(ed,name,node,vars);};var removeFormat$1=(ed,name,vars,node,similar)=>{if(node||ed.selection.isEditable()){removeFormatInternal(ed,name,vars,node,similar);}};var removeNodeFormat=(editor,format,vars,node,compareNode)=>{return removeNodeFormatInternal(editor,format,vars,node,compareNode).fold(never,newName=>{editor.dom.rename(node,newName);return true;},always);};var each$6=Tools.each;var mergeTextDecorationsAndColor=(dom,format,vars,node)=>{var processTextDecorationsAndColor=n=>{if(isElement$6(n)&&isElement$6(n.parentNode)&&isEditable$2(n)){var parentTextDecoration=getTextDecoration(dom,n.parentNode);if(dom.getStyle(n,'color')&&parentTextDecoration){dom.setStyle(n,'text-decoration',parentTextDecoration);}else if(dom.getStyle(n,'text-decoration')===parentTextDecoration){dom.setStyle(n,'text-decoration',null);}}};if(format.styles&&(format.styles.color||format.styles.textDecoration)){Tools.walk(node,processTextDecorationsAndColor,'childNodes');processTextDecorationsAndColor(node);}};var mergeBackgroundColorAndFontSize=(dom,format,vars,node)=>{if(format.styles&&format.styles.backgroundColor){var hasFontSize=hasStyle(dom,'fontSize');processChildElements(node,elm=>hasFontSize(elm)&&isEditable$2(elm),applyStyle(dom,'backgroundColor',replaceVars(format.styles.backgroundColor,vars)));}};var mergeSubSup=(dom,format,vars,node)=>{if(isInlineFormat(format)&&(format.inline==='sub'||format.inline==='sup')){var hasFontSize=hasStyle(dom,'fontSize');processChildElements(node,elm=>hasFontSize(elm)&&isEditable$2(elm),applyStyle(dom,'fontSize',''));var inverseTagDescendants=filter$5(dom.select(format.inline==='sup'?'sub':'sup',node),isEditable$2);dom.remove(inverseTagDescendants,true);}};var mergeWithChildren=(editor,formatList,vars,node)=>{each$6(formatList,format=>{if(isInlineFormat(format)){each$6(editor.dom.select(format.inline,node),child=>{if(isElementNode(child)){removeNodeFormat(editor,format,vars,child,format.exact?child:null);}});}clearChildStyles(editor.dom,format,node);});};var mergeWithParents=(editor,format,name,vars,node)=>{var parentNode=node.parentNode;if(_matchNode(editor,parentNode,name,vars)){if(removeNodeFormat(editor,format,vars,node)){return;}}if(format.merge_with_parents&&parentNode){editor.dom.getParent(parentNode,parent=>{if(_matchNode(editor,parent,name,vars)){removeNodeFormat(editor,format,vars,node);return true;}else{return false;}});}};var each$5=Tools.each;var canFormatBR=(editor,format,node,parentName)=>{if(canFormatEmptyLines(editor)&&isInlineFormat(format)&&node.parentNode){var validBRParentElements=getTextRootBlockElements(editor.schema);var hasCaretNodeSibling=sibling(SugarElement.fromDom(node),sibling=>isCaretNode(sibling.dom));return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),false)&&!hasCaretNodeSibling;}else{return false;}};var applyStyles=(dom,elm,format,vars)=>{each$5(format.styles,(value,name)=>{dom.setStyle(elm,name,replaceVars(value,vars));});if(format.styles){var styleVal=dom.getAttrib(elm,'style');if(styleVal){dom.setAttrib(elm,'data-mce-style',styleVal);}}};var applyFormatAction=(ed,name,vars,node)=>{var formatList=ed.formatter.get(name);var format=formatList[0];var isCollapsed=!node&&ed.selection.isCollapsed();var dom=ed.dom;var selection=ed.selection;var setElementFormat=function setElementFormat(elm){var fmt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:format;if(isFunction(fmt.onformat)){fmt.onformat(elm,fmt,vars,node);}applyStyles(dom,elm,fmt,vars);each$5(fmt.attributes,(value,name)=>{dom.setAttrib(elm,name,replaceVars(value,vars));});each$5(fmt.classes,value=>{var newValue=replaceVars(value,vars);if(!dom.hasClass(elm,newValue)){dom.addClass(elm,newValue);}});};var applyNodeStyle=(formatList,node)=>{var found=false;each$5(formatList,format=>{if(!isSelectorFormat(format)){return false;}if(dom.getContentEditable(node)==='false'&&!format.ceFalseOverride){return true;}if(isNonNullable(format.collapsed)&&format.collapsed!==isCollapsed){return true;}if(dom.is(node,format.selector)&&!isCaretNode(node)){setElementFormat(node,format);found=true;return false;}return true;});return found;};var createWrapElement=wrapName=>{if(isString(wrapName)){var wrapElm=dom.create(wrapName);setElementFormat(wrapElm);return wrapElm;}else{return null;}};var applyRngStyle=(dom,rng,nodeSpecific)=>{var newWrappers=[];var contentEditable=true;var wrapName=format.inline||format.block;var wrapElm=createWrapElement(wrapName);var isMatchingWrappingBlock=node=>isWrappingBlockFormat(format)&&_matchNode(ed,node,name,vars);var canRenameBlock=(node,parentName,isEditableDescendant)=>{var isValidBlockFormatForNode=isNonWrappingBlockFormat(format)&&isTextBlock$1(ed.schema,node)&&isValid(ed,parentName,wrapName);return isEditableDescendant&&isValidBlockFormatForNode;};var canWrapNode=(node,parentName,isEditableDescendant,isWrappableNoneditableElm)=>{var nodeName=node.nodeName.toLowerCase();var isValidWrapNode=isValid(ed,wrapName,nodeName)&&isValid(ed,parentName,wrapName);var isZwsp=!nodeSpecific&&isText$a(node)&&isZwsp$1(node.data);var isCaret=isCaretNode(node);var isCorrectFormatForNode=!isInlineFormat(format)||!dom.isBlock(node);return(isEditableDescendant||isWrappableNoneditableElm)&&isValidWrapNode&&!isZwsp&&!isCaret&&isCorrectFormatForNode;};walk$3(dom,rng,nodes=>{var currentWrapElm;var process=node=>{var hasContentEditableState=false;var lastContentEditable=contentEditable;var isWrappableNoneditableElm=false;var parentNode=node.parentNode;var parentName=parentNode.nodeName.toLowerCase();var contentEditableValue=dom.getContentEditable(node);if(isNonNullable(contentEditableValue)){lastContentEditable=contentEditable;contentEditable=contentEditableValue==='true';hasContentEditableState=true;isWrappableNoneditableElm=isWrappableNoneditable(ed,node);}var isEditableDescendant=contentEditable&&!hasContentEditableState;if(isBr$6(node)&&!canFormatBR(ed,format,node,parentName)){currentWrapElm=null;if(isBlockFormat(format)){dom.remove(node);}return;}if(isMatchingWrappingBlock(node)){currentWrapElm=null;return;}if(canRenameBlock(node,parentName,isEditableDescendant)){var elm=dom.rename(node,wrapName);setElementFormat(elm);newWrappers.push(elm);currentWrapElm=null;return;}if(isSelectorFormat(format)){var found=applyNodeStyle(formatList,node);if(!found&&isNonNullable(parentNode)&&shouldExpandToSelector(format)){found=applyNodeStyle(formatList,parentNode);}if(!isInlineFormat(format)||found){currentWrapElm=null;return;}}if(isNonNullable(wrapElm)&&canWrapNode(node,parentName,isEditableDescendant,isWrappableNoneditableElm)){if(!currentWrapElm){currentWrapElm=dom.clone(wrapElm,false);parentNode.insertBefore(currentWrapElm,node);newWrappers.push(currentWrapElm);}if(isWrappableNoneditableElm&&hasContentEditableState){contentEditable=lastContentEditable;}currentWrapElm.appendChild(node);}else{currentWrapElm=null;each$e(from(node.childNodes),process);if(hasContentEditableState){contentEditable=lastContentEditable;}currentWrapElm=null;}};each$e(nodes,process);});if(format.links===true){each$e(newWrappers,node=>{var process=node=>{if(node.nodeName==='A'){setElementFormat(node,format);}each$e(from(node.childNodes),process);};process(node);});}each$e(newWrappers,node=>{var getChildCount=node=>{var count=0;each$e(node.childNodes,node=>{if(!isEmptyTextNode$1(node)&&!isBookmarkNode$1(node)){count++;}});return count;};var mergeStyles=node=>{var childElement=find$2(node.childNodes,isElementNode$1).filter(child=>dom.getContentEditable(child)!=='false'&&matchName(dom,child,format));return childElement.map(child=>{var clone=dom.clone(child,false);setElementFormat(clone);dom.replace(clone,node,true);dom.remove(child,true);return clone;}).getOr(node);};var childCount=getChildCount(node);if((newWrappers.length>1||!dom.isBlock(node))&&childCount===0){dom.remove(node,true);return;}if(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper){if(!format.exact&&childCount===1){node=mergeStyles(node);}mergeWithChildren(ed,formatList,vars,node);mergeWithParents(ed,format,name,vars,node);mergeBackgroundColorAndFontSize(dom,format,vars,node);mergeTextDecorationsAndColor(dom,format,vars,node);mergeSubSup(dom,format,vars,node);mergeSiblings(ed,format,vars,node);}});};var targetNode=isNode(node)?node:selection.getNode();if(dom.getContentEditable(targetNode)==='false'&&!isWrappableNoneditable(ed,targetNode)){node=targetNode;applyNodeStyle(formatList,node);fireFormatApply(ed,name,node,vars);return;}if(format){if(node){if(isNode(node)){if(!applyNodeStyle(formatList,node)){var rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);applyRngStyle(dom,expandRng(dom,rng,formatList),true);}}else{applyRngStyle(dom,node,true);}}else{if(!isCollapsed||!isInlineFormat(format)||getCellsFromEditor(ed).length){selection.setRng(normalize(selection.getRng()));preserveSelection(ed,()=>{runOnRanges(ed,(selectionRng,fake)=>{var expandedRng=fake?selectionRng:expandRng(dom,selectionRng,formatList);applyRngStyle(dom,expandedRng,false);});},always);ed.nodeChanged();}else{applyCaretFormat(ed,name,vars);}getExpandedListItemFormat(ed.formatter,name).each(liFmt=>{each$e(getFullySelectedListItems(ed.selection),li=>applyStyles(dom,li,liFmt,vars));});}postProcess$1(name,ed);}fireFormatApply(ed,name,node,vars);};var applyFormat$1=(editor,name,vars,node)=>{if(node||editor.selection.isEditable()){applyFormatAction(editor,name,vars,node);}};var hasVars=value=>has$2(value,'vars');var setup$t=(registeredFormatListeners,editor)=>{registeredFormatListeners.set({});editor.on('NodeChange',e=>{updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get());});editor.on('FormatApply FormatRemove',e=>{var element=Optional.from(e.node).map(nodeOrRange=>isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer).bind(node=>isElement$6(node)?Optional.some(node):Optional.from(node.parentElement)).getOrThunk(()=>fallbackElement(editor));updateAndFireChangeCallbacks(editor,element,registeredFormatListeners.get());});};var fallbackElement=editor=>editor.selection.getStart();var matchingNode=(editor,parents,format,similar,vars)=>{var isMatchingNode=node=>{var matchingFormat=editor.formatter.matchNode(node,format,vars!==null&&vars!==void 0?vars:{},similar);return!isUndefined(matchingFormat);};var isUnableToMatch=node=>{if(matchesUnInheritedFormatSelector(editor,node,format)){return true;}else{if(!similar){return isNonNullable(editor.formatter.matchNode(node,format,vars,true));}else{return false;}}};return findUntil$1(parents,isMatchingNode,isUnableToMatch);};var getParents=(editor,elm)=>{var element=elm!==null&&elm!==void 0?elm:fallbackElement(editor);return filter$5(getParents$2(editor.dom,element),node=>isElement$6(node)&&!isBogus$2(node));};var updateAndFireChangeCallbacks=(editor,elm,registeredCallbacks)=>{var parents=getParents(editor,elm);each$d(registeredCallbacks,(data,format)=>{var runIfChanged=spec=>{var match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:undefined);var isSet=match.isSome();if(spec.state.get()!==isSet){spec.state.set(isSet);var node=match.getOr(elm);if(hasVars(spec)){spec.callback(isSet,{node,format,parents});}else{each$e(spec.callbacks,callback=>callback(isSet,{node,format,parents}));}}};each$e([data.withSimilar,data.withoutSimilar],runIfChanged);each$e(data.withVars,runIfChanged);});};var addListeners=(editor,registeredFormatListeners,formats,callback,similar,vars)=>{var formatChangeItems=registeredFormatListeners.get();each$e(formats.split(','),format=>{var group=get$a(formatChangeItems,format).getOrThunk(()=>{var base={withSimilar:{state:Cell(false),similar:true,callbacks:[]},withoutSimilar:{state:Cell(false),similar:false,callbacks:[]},withVars:[]};formatChangeItems[format]=base;return base;});var getCurrent=()=>{var parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome();};if(isUndefined(vars)){var toAppendTo=similar?group.withSimilar:group.withoutSimilar;toAppendTo.callbacks.push(callback);if(toAppendTo.callbacks.length===1){toAppendTo.state.set(getCurrent());}}else{group.withVars.push({state:Cell(getCurrent()),similar,vars,callback});}});registeredFormatListeners.set(formatChangeItems);};var removeListeners=(registeredFormatListeners,formats,callback)=>{var formatChangeItems=registeredFormatListeners.get();each$e(formats.split(','),format=>get$a(formatChangeItems,format).each(group=>{formatChangeItems[format]={withSimilar:_objectSpread(_objectSpread({},group.withSimilar),{},{callbacks:filter$5(group.withSimilar.callbacks,cb=>cb!==callback)}),withoutSimilar:_objectSpread(_objectSpread({},group.withoutSimilar),{},{callbacks:filter$5(group.withoutSimilar.callbacks,cb=>cb!==callback)}),withVars:filter$5(group.withVars,item=>item.callback!==callback)};}));registeredFormatListeners.set(formatChangeItems);};var formatChangedInternal=(editor,registeredFormatListeners,formats,callback,similar,vars)=>{addListeners(editor,registeredFormatListeners,formats,callback,similar,vars);return{unbind:()=>removeListeners(registeredFormatListeners,formats,callback)};};var _toggle=(editor,name,vars,node)=>{var fmt=editor.formatter.get(name);if(fmt){if(match$2(editor,name,vars,node)&&(!('toggle'in fmt[0])||fmt[0].toggle)){removeFormat$1(editor,name,vars,node);}else{applyFormat$1(editor,name,vars,node);}}};var explode$1=Tools.explode;var create$8=()=>{var filters={};var addFilter=(name,callback)=>{each$e(explode$1(name),name=>{if(!has$2(filters,name)){filters[name]={name,callbacks:[]};}filters[name].callbacks.push(callback);});};var getFilters=()=>values(filters);var removeFilter=(name,callback)=>{each$e(explode$1(name),name=>{if(has$2(filters,name)){if(isNonNullable(callback)){var _filter3=filters[name];var newCallbacks=filter$5(_filter3.callbacks,c=>c!==callback);if(newCallbacks.length>0){_filter3.callbacks=newCallbacks;}else{delete filters[name];}}else{delete filters[name];}}});};return{addFilter,getFilters,removeFilter};};var removeAttrs=(node,names)=>{each$e(names,name=>{node.attr(name,null);});};var addFontToSpansFilter=(domParser,styles,fontSizes)=>{domParser.addNodeFilter('font',nodes=>{each$e(nodes,node=>{var props=styles.parse(node.attr('style'));var color=node.attr('color');var face=node.attr('face');var size=node.attr('size');if(color){props.color=color;}if(face){props['font-family']=face;}if(size){toInt(size).each(num=>{props['font-size']=fontSizes[num-1];});}node.name='span';node.attr('style',styles.serialize(props));removeAttrs(node,['color','face','size']);});});};var addStrikeFilter=(domParser,schema,styles)=>{domParser.addNodeFilter('strike',nodes=>{var convertToSTag=schema.type!=='html4';each$e(nodes,node=>{if(convertToSTag){node.name='s';}else{var props=styles.parse(node.attr('style'));props['text-decoration']='line-through';node.name='span';node.attr('style',styles.serialize(props));}});});};var addFilters=(domParser,settings,schema)=>{var _a;var styles=Styles();if(settings.convert_fonts_to_spans){addFontToSpansFilter(domParser,styles,Tools.explode((_a=settings.font_size_legacy_values)!==null&&_a!==void 0?_a:''));}addStrikeFilter(domParser,schema,styles);};var register$5=(domParser,settings,schema)=>{if(settings.inline_styles){addFilters(domParser,settings,schema);}};var addNodeFilter=(settings,htmlParser,schema)=>{htmlParser.addNodeFilter('br',(nodes,_,args)=>{var blockElements=Tools.extend({},schema.getBlockElements());var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhitespaceElements();blockElements.body=1;var isBlock=node=>node.name in blockElements||isTransparentAstBlock(schema,node);for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];var _parent8=node.parent;if(_parent8&&isBlock(_parent8)&&node===_parent8.lastChild){var _prev2=node.prev;while(_prev2){var prevName=_prev2.name;if(prevName!=='span'||_prev2.attr('data-mce-type')!=='bookmark'){if(prevName==='br'){node=null;}break;}_prev2=_prev2.prev;}if(node){node.remove();if(isEmpty(schema,nonEmptyElements,whitespaceElements,_parent8)){var elementRule=schema.getElementRule(_parent8.name);if(elementRule){if(elementRule.removeEmpty){_parent8.remove();}else if(elementRule.paddEmpty){paddEmptyNode(settings,args,isBlock,_parent8);}}}}}else{var lastParent=node;while(_parent8&&_parent8.firstChild===lastParent&&_parent8.lastChild===lastParent){lastParent=_parent8;if(blockElements[_parent8.name]){break;}_parent8=_parent8.parent;}if(lastParent===_parent8){var textNode=new AstNode('#text',3);textNode.value=nbsp;node.replace(textNode);}}}});};var blobUriToBlob=url=>fetch(url).then(res=>res.ok?res.blob():Promise.reject()).catch(()=>Promise.reject({message:\"Cannot convert \".concat(url,\" to Blob. Resource might not exist or is inaccessible.\"),uriType:'blob'}));var extractBase64Data=data=>{var matches=/([a-z0-9+\\/=\\s]+)/i.exec(data);return matches?matches[1]:'';};var parseDataUri=uri=>{var[type,...rest]=uri.split(',');var data=rest.join(',');var matches=/data:([^/]+\\/[^;]+)(;.+)?/.exec(type);if(matches){var base64Encoded=matches[2]===';base64';var extractedData=base64Encoded?extractBase64Data(data):decodeURIComponent(data);return Optional.some({type:matches[1],data:extractedData,base64Encoded});}else{return Optional.none();}};var buildBlob=function buildBlob(type,data){var base64Encoded=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var str=data;if(base64Encoded){try{str=atob(data);}catch(e){return Optional.none();}}var arr=new Uint8Array(str.length);for(var i=0;i<arr.length;i++){arr[i]=str.charCodeAt(i);}return Optional.some(new Blob([arr],{type}));};var dataUriToBlob=uri=>{return new Promise((resolve,reject)=>{parseDataUri(uri).bind(_ref14=>{var{type,data,base64Encoded}=_ref14;return buildBlob(type,data,base64Encoded);}).fold(()=>reject('Invalid data URI'),resolve);});};var uriToBlob=url=>{if(startsWith(url,'blob:')){return blobUriToBlob(url);}else if(startsWith(url,'data:')){return dataUriToBlob(url);}else{return Promise.reject('Unknown URI format');}};var blobToDataUri=blob=>{return new Promise((resolve,reject)=>{var reader=new FileReader();reader.onloadend=()=>{resolve(reader.result);};reader.onerror=()=>{var _a;reject((_a=reader.error)===null||_a===void 0?void 0:_a.message);};reader.readAsDataURL(blob);});};var count$1=0;var uniqueId$1=prefix=>{return(prefix||'blobid')+count$1++;};var processDataUri=(dataUri,base64Only,generateBlobInfo)=>{return parseDataUri(dataUri).bind(_ref15=>{var{data,type,base64Encoded}=_ref15;if(base64Only&&!base64Encoded){return Optional.none();}else{var base64=base64Encoded?data:btoa(data);return generateBlobInfo(base64,type);}});};var createBlobInfo$1=(blobCache,blob,base64)=>{var blobInfo=blobCache.create(uniqueId$1(),blob,base64);blobCache.add(blobInfo);return blobInfo;};var dataUriToBlobInfo=function dataUriToBlobInfo(blobCache,dataUri){var base64Only=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return processDataUri(dataUri,base64Only,(base64,type)=>Optional.from(blobCache.getByData(base64,type)).orThunk(()=>buildBlob(type,base64).map(blob=>createBlobInfo$1(blobCache,blob,base64))));};var imageToBlobInfo=(blobCache,imageSrc)=>{var invalidDataUri=()=>Promise.reject('Invalid data URI');if(startsWith(imageSrc,'blob:')){var blobInfo=blobCache.getByUri(imageSrc);if(isNonNullable(blobInfo)){return Promise.resolve(blobInfo);}else{return uriToBlob(imageSrc).then(blob=>{return blobToDataUri(blob).then(dataUri=>{return processDataUri(dataUri,false,base64=>{return Optional.some(createBlobInfo$1(blobCache,blob,base64));}).getOrThunk(invalidDataUri);});});}}else if(startsWith(imageSrc,'data:')){return dataUriToBlobInfo(blobCache,imageSrc).fold(invalidDataUri,blobInfo=>Promise.resolve(blobInfo));}else{return Promise.reject('Unknown image data format');}};var isBogusImage=img=>isNonNullable(img.attr('data-mce-bogus'));var isInternalImageSource=img=>img.attr('src')===Env.transparentSrc||isNonNullable(img.attr('data-mce-placeholder'));var registerBase64ImageFilter=(parser,settings)=>{var{blob_cache:blobCache}=settings;if(blobCache){var processImage=img=>{var inputSrc=img.attr('src');if(isInternalImageSource(img)||isBogusImage(img)||isNullable(inputSrc)){return;}dataUriToBlobInfo(blobCache,inputSrc,true).each(blobInfo=>{img.attr('src',blobInfo.blobUri());});};parser.addAttributeFilter('src',nodes=>each$e(nodes,processImage));}};var register$4=(parser,settings)=>{var schema=parser.schema;if(settings.remove_trailing_brs){addNodeFilter(settings,parser,schema);}parser.addAttributeFilter('href',nodes=>{var i=nodes.length;var appendRel=rel=>{var parts=rel.split(' ').filter(p=>p.length>0);return parts.concat(['noopener']).sort().join(' ');};var addNoOpener=rel=>{var newRel=rel?Tools.trim(rel):'';if(!/\\b(noopener)\\b/g.test(newRel)){return appendRel(newRel);}else{return newRel;}};if(!settings.allow_unsafe_link_target){while(i--){var node=nodes[i];if(node.name==='a'&&node.attr('target')==='_blank'){node.attr('rel',addNoOpener(node.attr('rel')));}}}});if(!settings.allow_html_in_named_anchor){parser.addAttributeFilter('id,name',nodes=>{var i=nodes.length,sibling,prevSibling,parent,node;while(i--){node=nodes[i];if(node.name==='a'&&node.firstChild&&!node.attr('href')){parent=node.parent;sibling=node.lastChild;while(sibling&&parent){prevSibling=sibling.prev;parent.insert(sibling,node);sibling=prevSibling;}}}});}if(settings.fix_list_elements){parser.addNodeFilter('ul,ol',nodes=>{var i=nodes.length,node,parentNode;while(i--){node=nodes[i];parentNode=node.parent;if(parentNode&&(parentNode.name==='ul'||parentNode.name==='ol')){if(node.prev&&node.prev.name==='li'){node.prev.append(node);}else{var li=new AstNode('li',1);li.attr('style','list-style-type: none');node.wrap(li);}}}});}var validClasses=schema.getValidClasses();if(settings.validate&&validClasses){parser.addAttributeFilter('class',nodes=>{var _a;var i=nodes.length;while(i--){var node=nodes[i];var clazz=(_a=node.attr('class'))!==null&&_a!==void 0?_a:'';var classList=Tools.explode(clazz,' ');var classValue='';for(var ci=0;ci<classList.length;ci++){var className=classList[ci];var valid=false;var validClassesMap=validClasses['*'];if(validClassesMap&&validClassesMap[className]){valid=true;}validClassesMap=validClasses[node.name];if(!valid&&validClassesMap&&validClassesMap[className]){valid=true;}if(valid){if(classValue){classValue+=' ';}classValue+=className;}}if(!classValue.length){classValue=null;}node.attr('class',classValue);}});}registerBase64ImageFilter(parser,settings);};function _typeof(obj){'@babel/helpers - typeof';return _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj;},_typeof(obj);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _isNativeReflectConstruct(){if(typeof Reflect==='undefined'||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==='function')return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _iterableToArray(iter){if(typeof Symbol!=='undefined'&&iter[Symbol.iterator]!=null||iter['@@iterator']!=null)return Array.from(iter);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==='string')return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==='Object'&&o.constructor)n=o.constructor.name;if(n==='Map'||n==='Set')return Array.from(o);if(n==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _nonIterableSpread(){throw new TypeError('Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.');}var hasOwnProperty=Object.hasOwnProperty,setPrototypeOf=Object.setPrototypeOf,isFrozen=Object.isFrozen,getPrototypeOf=Object.getPrototypeOf,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var freeze=Object.freeze,seal=Object.seal,create$7=Object.create;var _ref=typeof Reflect!=='undefined'&&Reflect,apply=_ref.apply,construct=_ref.construct;if(!apply){apply=function apply(fun,thisValue,args){return fun.apply(thisValue,args);};}if(!freeze){freeze=function freeze(x){return x;};}if(!seal){seal=function seal(x){return x;};}if(!construct){construct=function construct(Func,args){return _construct(Func,_toConsumableArray(args));};}var arrayForEach=unapply(Array.prototype.forEach);var arrayPop=unapply(Array.prototype.pop);var arrayPush=unapply(Array.prototype.push);var stringToLowerCase=unapply(String.prototype.toLowerCase);var stringMatch=unapply(String.prototype.match);var stringReplace=unapply(String.prototype.replace);var stringIndexOf=unapply(String.prototype.indexOf);var stringTrim=unapply(String.prototype.trim);var regExpTest=unapply(RegExp.prototype.test);var typeErrorCreate=unconstruct(TypeError);function unapply(func){return function(thisArg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return apply(func,thisArg,args);};}function unconstruct(func){return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return construct(func,args);};}function addToSet(set,array){if(setPrototypeOf){setPrototypeOf(set,null);}var l=array.length;while(l--){var element=array[l];if(typeof element==='string'){var lcElement=stringToLowerCase(element);if(lcElement!==element){if(!isFrozen(array)){array[l]=lcElement;}element=lcElement;}}set[element]=true;}return set;}function clone(object){var newObject=create$7(null);var property;for(property in object){if(apply(hasOwnProperty,object,[property])){newObject[property]=object[property];}}return newObject;}function lookupGetter(object,prop){while(object!==null){var desc=getOwnPropertyDescriptor(object,prop);if(desc){if(desc.get){return unapply(desc.get);}if(typeof desc.value==='function'){return unapply(desc.value);}}object=getPrototypeOf(object);}function fallbackValue(element){console.warn('fallback value for',element);return null;}return fallbackValue;}var html$1=freeze(['a','abbr','acronym','address','area','article','aside','audio','b','bdi','bdo','big','blink','blockquote','body','br','button','canvas','caption','center','cite','code','col','colgroup','content','data','datalist','dd','decorator','del','details','dfn','dialog','dir','div','dl','dt','element','em','fieldset','figcaption','figure','font','footer','form','h1','h2','h3','h4','h5','h6','head','header','hgroup','hr','html','i','img','input','ins','kbd','label','legend','li','main','map','mark','marquee','menu','menuitem','meter','nav','nobr','ol','optgroup','option','output','p','picture','pre','progress','q','rp','rt','ruby','s','samp','section','select','shadow','small','source','spacer','span','strike','strong','style','sub','summary','sup','table','tbody','td','template','textarea','tfoot','th','thead','time','tr','track','tt','u','ul','var','video','wbr']);var svg$1=freeze(['svg','a','altglyph','altglyphdef','altglyphitem','animatecolor','animatemotion','animatetransform','circle','clippath','defs','desc','ellipse','filter','font','g','glyph','glyphref','hkern','image','line','lineargradient','marker','mask','metadata','mpath','path','pattern','polygon','polyline','radialgradient','rect','stop','style','switch','symbol','text','textpath','title','tref','tspan','view','vkern']);var svgFilters=freeze(['feBlend','feColorMatrix','feComponentTransfer','feComposite','feConvolveMatrix','feDiffuseLighting','feDisplacementMap','feDistantLight','feFlood','feFuncA','feFuncB','feFuncG','feFuncR','feGaussianBlur','feImage','feMerge','feMergeNode','feMorphology','feOffset','fePointLight','feSpecularLighting','feSpotLight','feTile','feTurbulence']);var svgDisallowed=freeze(['animate','color-profile','cursor','discard','fedropshadow','font-face','font-face-format','font-face-name','font-face-src','font-face-uri','foreignobject','hatch','hatchpath','mesh','meshgradient','meshpatch','meshrow','missing-glyph','script','set','solidcolor','unknown','use']);var mathMl$1=freeze(['math','menclose','merror','mfenced','mfrac','mglyph','mi','mlabeledtr','mmultiscripts','mn','mo','mover','mpadded','mphantom','mroot','mrow','ms','mspace','msqrt','mstyle','msub','msup','msubsup','mtable','mtd','mtext','mtr','munder','munderover']);var mathMlDisallowed=freeze(['maction','maligngroup','malignmark','mlongdiv','mscarries','mscarry','msgroup','mstack','msline','msrow','semantics','annotation','annotation-xml','mprescripts','none']);var text=freeze(['#text']);var html=freeze(['accept','action','align','alt','autocapitalize','autocomplete','autopictureinpicture','autoplay','background','bgcolor','border','capture','cellpadding','cellspacing','checked','cite','class','clear','color','cols','colspan','controls','controlslist','coords','crossorigin','datetime','decoding','default','dir','disabled','disablepictureinpicture','disableremoteplayback','download','draggable','enctype','enterkeyhint','face','for','headers','height','hidden','high','href','hreflang','id','inputmode','integrity','ismap','kind','label','lang','list','loading','loop','low','max','maxlength','media','method','min','minlength','multiple','muted','name','nonce','noshade','novalidate','nowrap','open','optimum','pattern','placeholder','playsinline','poster','preload','pubdate','radiogroup','readonly','rel','required','rev','reversed','role','rows','rowspan','spellcheck','scope','selected','shape','size','sizes','span','srclang','start','src','srcset','step','style','summary','tabindex','title','translate','type','usemap','valign','value','width','xmlns','slot']);var svg=freeze(['accent-height','accumulate','additive','alignment-baseline','ascent','attributename','attributetype','azimuth','basefrequency','baseline-shift','begin','bias','by','class','clip','clippathunits','clip-path','clip-rule','color','color-interpolation','color-interpolation-filters','color-profile','color-rendering','cx','cy','d','dx','dy','diffuseconstant','direction','display','divisor','dur','edgemode','elevation','end','fill','fill-opacity','fill-rule','filter','filterunits','flood-color','flood-opacity','font-family','font-size','font-size-adjust','font-stretch','font-style','font-variant','font-weight','fx','fy','g1','g2','glyph-name','glyphref','gradientunits','gradienttransform','height','href','id','image-rendering','in','in2','k','k1','k2','k3','k4','kerning','keypoints','keysplines','keytimes','lang','lengthadjust','letter-spacing','kernelmatrix','kernelunitlength','lighting-color','local','marker-end','marker-mid','marker-start','markerheight','markerunits','markerwidth','maskcontentunits','maskunits','max','mask','media','method','mode','min','name','numoctaves','offset','operator','opacity','order','orient','orientation','origin','overflow','paint-order','path','pathlength','patterncontentunits','patterntransform','patternunits','points','preservealpha','preserveaspectratio','primitiveunits','r','rx','ry','radius','refx','refy','repeatcount','repeatdur','restart','result','rotate','scale','seed','shape-rendering','specularconstant','specularexponent','spreadmethod','startoffset','stddeviation','stitchtiles','stop-color','stop-opacity','stroke-dasharray','stroke-dashoffset','stroke-linecap','stroke-linejoin','stroke-miterlimit','stroke-opacity','stroke','stroke-width','style','surfacescale','systemlanguage','tabindex','targetx','targety','transform','transform-origin','text-anchor','text-decoration','text-rendering','textlength','type','u1','u2','unicode','values','viewbox','visibility','version','vert-adv-y','vert-origin-x','vert-origin-y','width','word-spacing','wrap','writing-mode','xchannelselector','ychannelselector','x','x1','x2','xmlns','y','y1','y2','z','zoomandpan']);var mathMl=freeze(['accent','accentunder','align','bevelled','close','columnsalign','columnlines','columnspan','denomalign','depth','dir','display','displaystyle','encoding','fence','frame','height','href','id','largeop','length','linethickness','lspace','lquote','mathbackground','mathcolor','mathsize','mathvariant','maxsize','minsize','movablelimits','notation','numalign','open','rowalign','rowlines','rowspacing','rowspan','rspace','rquote','scriptlevel','scriptminsize','scriptsizemultiplier','selection','separator','separators','stretchy','subscriptshift','supscriptshift','symmetric','voffset','width','xmlns']);var xml=freeze(['xlink:href','xml:id','xlink:title','xml:space','xmlns:xlink']);var MUSTACHE_EXPR=seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm);var ERB_EXPR=seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);var DATA_ATTR=seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]/);var ARIA_ATTR=seal(/^aria-[\\-\\w]+$/);var IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i);var IS_SCRIPT_OR_DATA=seal(/^(?:\\w+script|data):/i);var ATTR_WHITESPACE=seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g);var DOCTYPE_NAME=seal(/^html$/i);var getGlobal=function getGlobal(){return typeof window==='undefined'?null:window;};var _createTrustedTypesPolicy=function _createTrustedTypesPolicy(trustedTypes,document){if(_typeof(trustedTypes)!=='object'||typeof trustedTypes.createPolicy!=='function'){return null;}var suffix=null;var ATTR_NAME='data-tt-policy-suffix';if(document.currentScript&&document.currentScript.hasAttribute(ATTR_NAME)){suffix=document.currentScript.getAttribute(ATTR_NAME);}var policyName='dompurify'+(suffix?'#'+suffix:'');try{return trustedTypes.createPolicy(policyName,{createHTML:function createHTML(html){return html;}});}catch(_){console.warn('TrustedTypes policy '+policyName+' could not be created.');return null;}};function createDOMPurify(){var window=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getGlobal();var DOMPurify=function DOMPurify(root){return createDOMPurify(root);};DOMPurify.version='2.3.8';DOMPurify.removed=[];if(!window||!window.document||window.document.nodeType!==9){DOMPurify.isSupported=false;return DOMPurify;}var originalDocument=window.document;var document=window.document;var DocumentFragment=window.DocumentFragment,HTMLTemplateElement=window.HTMLTemplateElement,Node=window.Node,Element=window.Element,NodeFilter=window.NodeFilter,_window$NamedNodeMap=window.NamedNodeMap,NamedNodeMap=_window$NamedNodeMap===void 0?window.NamedNodeMap||window.MozNamedAttrMap:_window$NamedNodeMap,HTMLFormElement=window.HTMLFormElement,DOMParser=window.DOMParser,trustedTypes=window.trustedTypes;var ElementPrototype=Element.prototype;var cloneNode=lookupGetter(ElementPrototype,'cloneNode');var getNextSibling=lookupGetter(ElementPrototype,'nextSibling');var getChildNodes=lookupGetter(ElementPrototype,'childNodes');var getParentNode=lookupGetter(ElementPrototype,'parentNode');if(typeof HTMLTemplateElement==='function'){var template=document.createElement('template');if(template.content&&template.content.ownerDocument){document=template.content.ownerDocument;}}var trustedTypesPolicy=_createTrustedTypesPolicy(trustedTypes,originalDocument);var emptyHTML=trustedTypesPolicy?trustedTypesPolicy.createHTML(''):'';var _document=document,implementation=_document.implementation,createNodeIterator=_document.createNodeIterator,createDocumentFragment=_document.createDocumentFragment,getElementsByTagName=_document.getElementsByTagName;var importNode=originalDocument.importNode;var documentMode={};try{documentMode=clone(document).documentMode?document.documentMode:{};}catch(_){}var hooks={};DOMPurify.isSupported=typeof getParentNode==='function'&&implementation&&typeof implementation.createHTMLDocument!=='undefined'&&documentMode!==9;var MUSTACHE_EXPR$1=MUSTACHE_EXPR,ERB_EXPR$1=ERB_EXPR,DATA_ATTR$1=DATA_ATTR,ARIA_ATTR$1=ARIA_ATTR,IS_SCRIPT_OR_DATA$1=IS_SCRIPT_OR_DATA,ATTR_WHITESPACE$1=ATTR_WHITESPACE;var IS_ALLOWED_URI$1=IS_ALLOWED_URI;var ALLOWED_TAGS=null;var DEFAULT_ALLOWED_TAGS=addToSet({},[].concat(_toConsumableArray(html$1),_toConsumableArray(svg$1),_toConsumableArray(svgFilters),_toConsumableArray(mathMl$1),_toConsumableArray(text)));var ALLOWED_ATTR=null;var DEFAULT_ALLOWED_ATTR=addToSet({},[].concat(_toConsumableArray(html),_toConsumableArray(svg),_toConsumableArray(mathMl),_toConsumableArray(xml)));var CUSTOM_ELEMENT_HANDLING=Object.seal(Object.create(null,{tagNameCheck:{writable:true,configurable:false,enumerable:true,value:null},attributeNameCheck:{writable:true,configurable:false,enumerable:true,value:null},allowCustomizedBuiltInElements:{writable:true,configurable:false,enumerable:true,value:false}}));var FORBID_TAGS=null;var FORBID_ATTR=null;var ALLOW_ARIA_ATTR=true;var ALLOW_DATA_ATTR=true;var ALLOW_UNKNOWN_PROTOCOLS=false;var SAFE_FOR_TEMPLATES=false;var WHOLE_DOCUMENT=false;var SET_CONFIG=false;var FORCE_BODY=false;var RETURN_DOM=false;var RETURN_DOM_FRAGMENT=false;var RETURN_TRUSTED_TYPE=false;var SANITIZE_DOM=true;var KEEP_CONTENT=true;var IN_PLACE=false;var USE_PROFILES={};var FORBID_CONTENTS=null;var DEFAULT_FORBID_CONTENTS=addToSet({},['annotation-xml','audio','colgroup','desc','foreignobject','head','iframe','math','mi','mn','mo','ms','mtext','noembed','noframes','noscript','plaintext','script','style','svg','template','thead','title','video','xmp']);var DATA_URI_TAGS=null;var DEFAULT_DATA_URI_TAGS=addToSet({},['audio','video','img','source','image','track']);var URI_SAFE_ATTRIBUTES=null;var DEFAULT_URI_SAFE_ATTRIBUTES=addToSet({},['alt','class','for','id','label','name','pattern','placeholder','role','summary','title','value','style','xmlns']);var MATHML_NAMESPACE='http://www.w3.org/1998/Math/MathML';var SVG_NAMESPACE='http://www.w3.org/2000/svg';var HTML_NAMESPACE='http://www.w3.org/1999/xhtml';var NAMESPACE=HTML_NAMESPACE;var IS_EMPTY_INPUT=false;var PARSER_MEDIA_TYPE;var SUPPORTED_PARSER_MEDIA_TYPES=['application/xhtml+xml','text/html'];var DEFAULT_PARSER_MEDIA_TYPE='text/html';var transformCaseFunc;var CONFIG=null;var formElement=document.createElement('form');var isRegexOrFunction=function isRegexOrFunction(testValue){return testValue instanceof RegExp||testValue instanceof Function;};var _parseConfig=function _parseConfig(cfg){if(CONFIG&&CONFIG===cfg){return;}if(!cfg||_typeof(cfg)!=='object'){cfg={};}cfg=clone(cfg);ALLOWED_TAGS='ALLOWED_TAGS'in cfg?addToSet({},cfg.ALLOWED_TAGS):DEFAULT_ALLOWED_TAGS;ALLOWED_ATTR='ALLOWED_ATTR'in cfg?addToSet({},cfg.ALLOWED_ATTR):DEFAULT_ALLOWED_ATTR;URI_SAFE_ATTRIBUTES='ADD_URI_SAFE_ATTR'in cfg?addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES),cfg.ADD_URI_SAFE_ATTR):DEFAULT_URI_SAFE_ATTRIBUTES;DATA_URI_TAGS='ADD_DATA_URI_TAGS'in cfg?addToSet(clone(DEFAULT_DATA_URI_TAGS),cfg.ADD_DATA_URI_TAGS):DEFAULT_DATA_URI_TAGS;FORBID_CONTENTS='FORBID_CONTENTS'in cfg?addToSet({},cfg.FORBID_CONTENTS):DEFAULT_FORBID_CONTENTS;FORBID_TAGS='FORBID_TAGS'in cfg?addToSet({},cfg.FORBID_TAGS):{};FORBID_ATTR='FORBID_ATTR'in cfg?addToSet({},cfg.FORBID_ATTR):{};USE_PROFILES='USE_PROFILES'in cfg?cfg.USE_PROFILES:false;ALLOW_ARIA_ATTR=cfg.ALLOW_ARIA_ATTR!==false;ALLOW_DATA_ATTR=cfg.ALLOW_DATA_ATTR!==false;ALLOW_UNKNOWN_PROTOCOLS=cfg.ALLOW_UNKNOWN_PROTOCOLS||false;SAFE_FOR_TEMPLATES=cfg.SAFE_FOR_TEMPLATES||false;WHOLE_DOCUMENT=cfg.WHOLE_DOCUMENT||false;RETURN_DOM=cfg.RETURN_DOM||false;RETURN_DOM_FRAGMENT=cfg.RETURN_DOM_FRAGMENT||false;RETURN_TRUSTED_TYPE=cfg.RETURN_TRUSTED_TYPE||false;FORCE_BODY=cfg.FORCE_BODY||false;SANITIZE_DOM=cfg.SANITIZE_DOM!==false;KEEP_CONTENT=cfg.KEEP_CONTENT!==false;IN_PLACE=cfg.IN_PLACE||false;IS_ALLOWED_URI$1=cfg.ALLOWED_URI_REGEXP||IS_ALLOWED_URI$1;NAMESPACE=cfg.NAMESPACE||HTML_NAMESPACE;if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)){CUSTOM_ELEMENT_HANDLING.tagNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)){CUSTOM_ELEMENT_HANDLING.attributeNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;}if(cfg.CUSTOM_ELEMENT_HANDLING&&typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements==='boolean'){CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;}PARSER_MEDIA_TYPE=SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE)===-1?PARSER_MEDIA_TYPE=DEFAULT_PARSER_MEDIA_TYPE:PARSER_MEDIA_TYPE=cfg.PARSER_MEDIA_TYPE;transformCaseFunc=PARSER_MEDIA_TYPE==='application/xhtml+xml'?function(x){return x;}:stringToLowerCase;if(SAFE_FOR_TEMPLATES){ALLOW_DATA_ATTR=false;}if(RETURN_DOM_FRAGMENT){RETURN_DOM=true;}if(USE_PROFILES){ALLOWED_TAGS=addToSet({},_toConsumableArray(text));ALLOWED_ATTR=[];if(USE_PROFILES.html===true){addToSet(ALLOWED_TAGS,html$1);addToSet(ALLOWED_ATTR,html);}if(USE_PROFILES.svg===true){addToSet(ALLOWED_TAGS,svg$1);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.svgFilters===true){addToSet(ALLOWED_TAGS,svgFilters);addToSet(ALLOWED_ATTR,svg);addToSet(ALLOWED_ATTR,xml);}if(USE_PROFILES.mathMl===true){addToSet(ALLOWED_TAGS,mathMl$1);addToSet(ALLOWED_ATTR,mathMl);addToSet(ALLOWED_ATTR,xml);}}if(cfg.ADD_TAGS){if(ALLOWED_TAGS===DEFAULT_ALLOWED_TAGS){ALLOWED_TAGS=clone(ALLOWED_TAGS);}addToSet(ALLOWED_TAGS,cfg.ADD_TAGS);}if(cfg.ADD_ATTR){if(ALLOWED_ATTR===DEFAULT_ALLOWED_ATTR){ALLOWED_ATTR=clone(ALLOWED_ATTR);}addToSet(ALLOWED_ATTR,cfg.ADD_ATTR);}if(cfg.ADD_URI_SAFE_ATTR){addToSet(URI_SAFE_ATTRIBUTES,cfg.ADD_URI_SAFE_ATTR);}if(cfg.FORBID_CONTENTS){if(FORBID_CONTENTS===DEFAULT_FORBID_CONTENTS){FORBID_CONTENTS=clone(FORBID_CONTENTS);}addToSet(FORBID_CONTENTS,cfg.FORBID_CONTENTS);}if(KEEP_CONTENT){ALLOWED_TAGS['#text']=true;}if(WHOLE_DOCUMENT){addToSet(ALLOWED_TAGS,['html','head','body']);}if(ALLOWED_TAGS.table){addToSet(ALLOWED_TAGS,['tbody']);delete FORBID_TAGS.tbody;}if(freeze){freeze(cfg);}CONFIG=cfg;};var MATHML_TEXT_INTEGRATION_POINTS=addToSet({},['mi','mo','mn','ms','mtext']);var HTML_INTEGRATION_POINTS=addToSet({},['foreignobject','desc','title','annotation-xml']);var COMMON_SVG_AND_HTML_ELEMENTS=addToSet({},['title','style','font','a','script']);var ALL_SVG_TAGS=addToSet({},svg$1);addToSet(ALL_SVG_TAGS,svgFilters);addToSet(ALL_SVG_TAGS,svgDisallowed);var ALL_MATHML_TAGS=addToSet({},mathMl$1);addToSet(ALL_MATHML_TAGS,mathMlDisallowed);var _checkValidNamespace=function _checkValidNamespace(element){var parent=getParentNode(element);if(!parent||!parent.tagName){parent={namespaceURI:HTML_NAMESPACE,tagName:'template'};}var tagName=stringToLowerCase(element.tagName);var parentTagName=stringToLowerCase(parent.tagName);if(element.namespaceURI===SVG_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='svg';}if(parent.namespaceURI===MATHML_NAMESPACE){return tagName==='svg'&&(parentTagName==='annotation-xml'||MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);}return Boolean(ALL_SVG_TAGS[tagName]);}if(element.namespaceURI===MATHML_NAMESPACE){if(parent.namespaceURI===HTML_NAMESPACE){return tagName==='math';}if(parent.namespaceURI===SVG_NAMESPACE){return tagName==='math'&&HTML_INTEGRATION_POINTS[parentTagName];}return Boolean(ALL_MATHML_TAGS[tagName]);}if(element.namespaceURI===HTML_NAMESPACE){if(parent.namespaceURI===SVG_NAMESPACE&&!HTML_INTEGRATION_POINTS[parentTagName]){return false;}if(parent.namespaceURI===MATHML_NAMESPACE&&!MATHML_TEXT_INTEGRATION_POINTS[parentTagName]){return false;}return!ALL_MATHML_TAGS[tagName]&&(COMMON_SVG_AND_HTML_ELEMENTS[tagName]||!ALL_SVG_TAGS[tagName]);}return false;};var _forceRemove=function _forceRemove(node){arrayPush(DOMPurify.removed,{element:node});try{node.parentNode.removeChild(node);}catch(_){try{node.outerHTML=emptyHTML;}catch(_){node.remove();}}};var _removeAttribute=function _removeAttribute(name,node){try{arrayPush(DOMPurify.removed,{attribute:node.getAttributeNode(name),from:node});}catch(_){arrayPush(DOMPurify.removed,{attribute:null,from:node});}node.removeAttribute(name);if(name==='is'&&!ALLOWED_ATTR[name]){if(RETURN_DOM||RETURN_DOM_FRAGMENT){try{_forceRemove(node);}catch(_){}}else{try{node.setAttribute(name,'');}catch(_){}}}};var _initDocument=function _initDocument(dirty){var doc;var leadingWhitespace;if(FORCE_BODY){dirty='<remove></remove>'+dirty;}else{var matches=stringMatch(dirty,/^[\\r\\n\\t ]+/);leadingWhitespace=matches&&matches[0];}if(PARSER_MEDIA_TYPE==='application/xhtml+xml'){dirty='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+dirty+'</body></html>';}var dirtyPayload=trustedTypesPolicy?trustedTypesPolicy.createHTML(dirty):dirty;if(NAMESPACE===HTML_NAMESPACE){try{doc=new DOMParser().parseFromString(dirtyPayload,PARSER_MEDIA_TYPE);}catch(_){}}if(!doc||!doc.documentElement){doc=implementation.createDocument(NAMESPACE,'template',null);try{doc.documentElement.innerHTML=IS_EMPTY_INPUT?'':dirtyPayload;}catch(_){}}var body=doc.body||doc.documentElement;if(dirty&&leadingWhitespace){body.insertBefore(document.createTextNode(leadingWhitespace),body.childNodes[0]||null);}if(NAMESPACE===HTML_NAMESPACE){return getElementsByTagName.call(doc,WHOLE_DOCUMENT?'html':'body')[0];}return WHOLE_DOCUMENT?doc.documentElement:body;};var _createIterator=function _createIterator(root){return createNodeIterator.call(root.ownerDocument||root,root,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,null,false);};var _isClobbered=function _isClobbered(elm){return elm instanceof HTMLFormElement&&(typeof elm.nodeName!=='string'||typeof elm.textContent!=='string'||typeof elm.removeChild!=='function'||!(elm.attributes instanceof NamedNodeMap)||typeof elm.removeAttribute!=='function'||typeof elm.setAttribute!=='function'||typeof elm.namespaceURI!=='string'||typeof elm.insertBefore!=='function');};var _isNode=function _isNode(object){return _typeof(Node)==='object'?object instanceof Node:object&&_typeof(object)==='object'&&typeof object.nodeType==='number'&&typeof object.nodeName==='string';};var _executeHook=function _executeHook(entryPoint,currentNode,data){if(!hooks[entryPoint]){return;}arrayForEach(hooks[entryPoint],function(hook){hook.call(DOMPurify,currentNode,data,CONFIG);});};var _sanitizeElements=function _sanitizeElements(currentNode){var content;_executeHook('beforeSanitizeElements',currentNode,null);if(_isClobbered(currentNode)){_forceRemove(currentNode);return true;}if(regExpTest(/[\\u0080-\\uFFFF]/,currentNode.nodeName)){_forceRemove(currentNode);return true;}var tagName=transformCaseFunc(currentNode.nodeName);_executeHook('uponSanitizeElement',currentNode,{tagName:tagName,allowedTags:ALLOWED_TAGS});if(currentNode.hasChildNodes()&&!_isNode(currentNode.firstElementChild)&&(!_isNode(currentNode.content)||!_isNode(currentNode.content.firstElementChild))&&regExpTest(/<[/\\w]/g,currentNode.innerHTML)&&regExpTest(/<[/\\w]/g,currentNode.textContent)){_forceRemove(currentNode);return true;}if(tagName==='select'&&regExpTest(/<template/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){if(!FORBID_TAGS[tagName]&&_basicCustomElementTest(tagName)){if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,tagName))return false;if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName))return false;}if(KEEP_CONTENT&&!FORBID_CONTENTS[tagName]){var parentNode=getParentNode(currentNode)||currentNode.parentNode;var childNodes=getChildNodes(currentNode)||currentNode.childNodes;if(childNodes&&parentNode){var childCount=childNodes.length;for(var i=childCount-1;i>=0;--i){parentNode.insertBefore(cloneNode(childNodes[i],true),getNextSibling(currentNode));}}}_forceRemove(currentNode);return true;}if(currentNode instanceof Element&&!_checkValidNamespace(currentNode)){_forceRemove(currentNode);return true;}if((tagName==='noscript'||tagName==='noembed')&&regExpTest(/<\\/no(script|embed)/i,currentNode.innerHTML)){_forceRemove(currentNode);return true;}if(SAFE_FOR_TEMPLATES&&currentNode.nodeType===3){content=currentNode.textContent;content=stringReplace(content,MUSTACHE_EXPR$1,' ');content=stringReplace(content,ERB_EXPR$1,' ');if(currentNode.textContent!==content){arrayPush(DOMPurify.removed,{element:currentNode.cloneNode()});currentNode.textContent=content;}}_executeHook('afterSanitizeElements',currentNode,null);return false;};var _isValidAttribute=function _isValidAttribute(lcTag,lcName,value){if(SANITIZE_DOM&&(lcName==='id'||lcName==='name')&&(value in document||value in formElement)){return false;}if(ALLOW_DATA_ATTR&&!FORBID_ATTR[lcName]&&regExpTest(DATA_ATTR$1,lcName));else if(ALLOW_ARIA_ATTR&&regExpTest(ARIA_ATTR$1,lcName));else if(!ALLOWED_ATTR[lcName]||FORBID_ATTR[lcName]){if(_basicCustomElementTest(lcTag)&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,lcTag)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))&&(CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck,lcName)||CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName))||lcName==='is'&&CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,value)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(value)));else{return false;}}else if(URI_SAFE_ATTRIBUTES[lcName]);else if(regExpTest(IS_ALLOWED_URI$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if((lcName==='src'||lcName==='xlink:href'||lcName==='href')&&lcTag!=='script'&&stringIndexOf(value,'data:')===0&&DATA_URI_TAGS[lcTag]);else if(ALLOW_UNKNOWN_PROTOCOLS&&!regExpTest(IS_SCRIPT_OR_DATA$1,stringReplace(value,ATTR_WHITESPACE$1,'')));else if(!value);else{return false;}return true;};var _basicCustomElementTest=function _basicCustomElementTest(tagName){return tagName.indexOf('-')>0;};var _sanitizeAttributes=function _sanitizeAttributes(currentNode){var attr;var value;var lcName;var l;_executeHook('beforeSanitizeAttributes',currentNode,null);var attributes=currentNode.attributes;if(!attributes){return;}var hookEvent={attrName:'',attrValue:'',keepAttr:true,allowedAttributes:ALLOWED_ATTR};l=attributes.length;while(l--){attr=attributes[l];var _attr=attr,name=_attr.name,namespaceURI=_attr.namespaceURI;value=name==='value'?attr.value:stringTrim(attr.value);lcName=transformCaseFunc(name);var initValue=value;hookEvent.attrName=lcName;hookEvent.attrValue=value;hookEvent.keepAttr=true;hookEvent.forceKeepAttr=undefined;_executeHook('uponSanitizeAttribute',currentNode,hookEvent);value=hookEvent.attrValue;if(hookEvent.forceKeepAttr){continue;}if(!hookEvent.keepAttr){_removeAttribute(name,currentNode);continue;}if(regExpTest(/\\/>/i,value)){_removeAttribute(name,currentNode);continue;}if(SAFE_FOR_TEMPLATES){value=stringReplace(value,MUSTACHE_EXPR$1,' ');value=stringReplace(value,ERB_EXPR$1,' ');}var lcTag=transformCaseFunc(currentNode.nodeName);if(!_isValidAttribute(lcTag,lcName,value)){_removeAttribute(name,currentNode);continue;}if(value!==initValue){try{if(namespaceURI){currentNode.setAttributeNS(namespaceURI,name,value);}else{currentNode.setAttribute(name,value);}}catch(_){_removeAttribute(name,currentNode);}}}_executeHook('afterSanitizeAttributes',currentNode,null);};var _sanitizeShadowDOM=function _sanitizeShadowDOM(fragment){var shadowNode;var shadowIterator=_createIterator(fragment);_executeHook('beforeSanitizeShadowDOM',fragment,null);while(shadowNode=shadowIterator.nextNode()){_executeHook('uponSanitizeShadowNode',shadowNode,null);if(_sanitizeElements(shadowNode)){continue;}if(shadowNode.content instanceof DocumentFragment){_sanitizeShadowDOM(shadowNode.content);}_sanitizeAttributes(shadowNode);}_executeHook('afterSanitizeShadowDOM',fragment,null);};DOMPurify.sanitize=function(dirty,cfg){var body;var importedNode;var currentNode;var oldNode;var returnNode;IS_EMPTY_INPUT=!dirty;if(IS_EMPTY_INPUT){dirty='<!-->';}if(typeof dirty!=='string'&&!_isNode(dirty)){if(typeof dirty.toString!=='function'){throw typeErrorCreate('toString is not a function');}else{dirty=dirty.toString();if(typeof dirty!=='string'){throw typeErrorCreate('dirty is not a string, aborting');}}}if(!DOMPurify.isSupported){if(_typeof(window.toStaticHTML)==='object'||typeof window.toStaticHTML==='function'){if(typeof dirty==='string'){return window.toStaticHTML(dirty);}if(_isNode(dirty)){return window.toStaticHTML(dirty.outerHTML);}}return dirty;}if(!SET_CONFIG){_parseConfig(cfg);}DOMPurify.removed=[];if(typeof dirty==='string'){IN_PLACE=false;}if(IN_PLACE){if(dirty.nodeName){var tagName=transformCaseFunc(dirty.nodeName);if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');}}}else if(dirty instanceof Node){body=_initDocument('<!---->');importedNode=body.ownerDocument.importNode(dirty,true);if(importedNode.nodeType===1&&importedNode.nodeName==='BODY'){body=importedNode;}else if(importedNode.nodeName==='HTML'){body=importedNode;}else{body.appendChild(importedNode);}}else{if(!RETURN_DOM&&!SAFE_FOR_TEMPLATES&&!WHOLE_DOCUMENT&&dirty.indexOf('<')===-1){return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(dirty):dirty;}body=_initDocument(dirty);if(!body){return RETURN_DOM?null:RETURN_TRUSTED_TYPE?emptyHTML:'';}}if(body&&FORCE_BODY){_forceRemove(body.firstChild);}var nodeIterator=_createIterator(IN_PLACE?dirty:body);while(currentNode=nodeIterator.nextNode()){if(currentNode.nodeType===3&&currentNode===oldNode){continue;}if(_sanitizeElements(currentNode)){continue;}if(currentNode.content instanceof DocumentFragment){_sanitizeShadowDOM(currentNode.content);}_sanitizeAttributes(currentNode);oldNode=currentNode;}oldNode=null;if(IN_PLACE){return dirty;}if(RETURN_DOM){if(RETURN_DOM_FRAGMENT){returnNode=createDocumentFragment.call(body.ownerDocument);while(body.firstChild){returnNode.appendChild(body.firstChild);}}else{returnNode=body;}if(ALLOWED_ATTR.shadowroot){returnNode=importNode.call(originalDocument,returnNode,true);}return returnNode;}var serializedHTML=WHOLE_DOCUMENT?body.outerHTML:body.innerHTML;if(WHOLE_DOCUMENT&&ALLOWED_TAGS['!doctype']&&body.ownerDocument&&body.ownerDocument.doctype&&body.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,body.ownerDocument.doctype.name)){serializedHTML='<!DOCTYPE '+body.ownerDocument.doctype.name+'>\\n'+serializedHTML;}if(SAFE_FOR_TEMPLATES){serializedHTML=stringReplace(serializedHTML,MUSTACHE_EXPR$1,' ');serializedHTML=stringReplace(serializedHTML,ERB_EXPR$1,' ');}return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(serializedHTML):serializedHTML;};DOMPurify.setConfig=function(cfg){_parseConfig(cfg);SET_CONFIG=true;};DOMPurify.clearConfig=function(){CONFIG=null;SET_CONFIG=false;};DOMPurify.isValidAttribute=function(tag,attr,value){if(!CONFIG){_parseConfig({});}var lcTag=transformCaseFunc(tag);var lcName=transformCaseFunc(attr);return _isValidAttribute(lcTag,lcName,value);};DOMPurify.addHook=function(entryPoint,hookFunction){if(typeof hookFunction!=='function'){return;}hooks[entryPoint]=hooks[entryPoint]||[];arrayPush(hooks[entryPoint],hookFunction);};DOMPurify.removeHook=function(entryPoint){if(hooks[entryPoint]){return arrayPop(hooks[entryPoint]);}};DOMPurify.removeHooks=function(entryPoint){if(hooks[entryPoint]){hooks[entryPoint]=[];}};DOMPurify.removeAllHooks=function(){hooks={};};return DOMPurify;}var purify=createDOMPurify();var each$4=Tools.each,trim=Tools.trim;var queryParts=['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'];var DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};var safeSvgDataUrlElements=['img','video'];var blockSvgDataUris=(allowSvgDataUrls,tagName)=>{if(isNonNullable(allowSvgDataUrls)){return!allowSvgDataUrls;}else{return isNonNullable(tagName)?!contains$2(safeSvgDataUrlElements,tagName):true;}};var decodeUri=encodedUri=>{try{return decodeURIComponent(encodedUri);}catch(ex){return unescape(encodedUri);}};var isInvalidUri=(settings,uri,tagName)=>{var decodedUri=decodeUri(uri).replace(/\\s/g,'');if(settings.allow_script_urls){return false;}else if(/((java|vb)script|mhtml):/i.test(decodedUri)){return true;}else if(settings.allow_html_data_urls){return false;}else if(/^data:image\\//i.test(decodedUri)){return blockSvgDataUris(settings.allow_svg_data_urls,tagName)&&/^data:image\\/svg\\+xml/i.test(decodedUri);}else{return /^data:/i.test(decodedUri);}};class URI{static parseDataUri(uri){var type;var uriComponents=decodeURIComponent(uri).split(',');var matches=/data:([^;]+)/.exec(uriComponents[0]);if(matches){type=matches[1];}return{type,data:uriComponents[1]};}static isDomSafe(uri,context){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(options.allow_script_urls){return true;}else{var decodedUri=Entities.decode(uri).replace(/[\\s\\u0000-\\u001F]+/g,'');return!isInvalidUri(options,decodedUri,context);}}static getDocumentBaseUrl(loc){var _a;var baseUrl;if(loc.protocol.indexOf('http')!==0&&loc.protocol!=='file:'){baseUrl=(_a=loc.href)!==null&&_a!==void 0?_a:'';}else{baseUrl=loc.protocol+'//'+loc.host+loc.pathname;}if(/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)){baseUrl=baseUrl.replace(/[\\?#].*$/,'').replace(/[\\/\\\\][^\\/]+$/,'');if(!/[\\/\\\\]$/.test(baseUrl)){baseUrl+='/';}}return baseUrl;}constructor(url){var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.path='';this.directory='';url=trim(url);this.settings=settings;var baseUri=settings.base_uri;var self=this;if(/^([\\w\\-]+):([^\\/]{2})/i.test(url)||/^\\s*#/.test(url)){self.source=url;return;}var isProtocolRelative=url.indexOf('//')===0;if(url.indexOf('/')===0&&!isProtocolRelative){url=(baseUri?baseUri.protocol||'http':'http')+'://mce_host'+url;}if(!/^[\\w\\-]*:?\\/\\//.test(url)){var baseUrl=baseUri?baseUri.path:new URI(document.location.href).directory;if((baseUri===null||baseUri===void 0?void 0:baseUri.protocol)===''){url='//mce_host'+self.toAbsPath(baseUrl,url);}else{var _match4=/([^#?]*)([#?]?.*)/.exec(url);if(_match4){url=(baseUri&&baseUri.protocol||'http')+'://mce_host'+self.toAbsPath(baseUrl,_match4[1])+_match4[2];}}}url=url.replace(/@@/g,'(mce_at)');var urlMatch=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?(\\[[a-zA-Z0-9:.%]+\\]|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);if(urlMatch){each$4(queryParts,(v,i)=>{var part=urlMatch[i];if(part){part=part.replace(/\\(mce_at\\)/g,'@@');}self[v]=part;});}if(baseUri){if(!self.protocol){self.protocol=baseUri.protocol;}if(!self.userInfo){self.userInfo=baseUri.userInfo;}if(!self.port&&self.host==='mce_host'){self.port=baseUri.port;}if(!self.host||self.host==='mce_host'){self.host=baseUri.host;}self.source='';}if(isProtocolRelative){self.protocol='';}}setPath(path){var pathMatch=/^(.*?)\\/?(\\w+)?$/.exec(path);if(pathMatch){this.path=pathMatch[0];this.directory=pathMatch[1];this.file=pathMatch[2];}this.source='';this.getURI();}toRelative(uri){if(uri==='./'){return uri;}var relativeUri=new URI(uri,{base_uri:this});if(relativeUri.host!=='mce_host'&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&relativeUri.protocol!==''){return relativeUri.getURI();}var tu=this.getURI(),uu=relativeUri.getURI();if(tu===uu||tu.charAt(tu.length-1)==='/'&&tu.substr(0,tu.length-1)===uu){return tu;}var output=this.toRelPath(this.path,relativeUri.path);if(relativeUri.query){output+='?'+relativeUri.query;}if(relativeUri.anchor){output+='#'+relativeUri.anchor;}return output;}toAbsolute(uri,noHost){var absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri));}isSameOrigin(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port){return true;}var defaultPort=this.protocol?DEFAULT_PORTS[this.protocol]:null;if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort)){return true;}}return false;}toRelPath(base,path){var breakPoint=0,out='',i,l;var normalizedBase=base.substring(0,base.lastIndexOf('/')).split('/');var items=path.split('/');if(normalizedBase.length>=items.length){for(i=0,l=normalizedBase.length;i<l;i++){if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break;}}}if(normalizedBase.length<items.length){for(i=0,l=items.length;i<l;i++){if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break;}}}if(breakPoint===1){return path;}for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++){out+='../';}for(i=breakPoint-1,l=items.length;i<l;i++){if(i!==breakPoint-1){out+='/'+items[i];}else{out+=items[i];}}return out;}toAbsPath(base,path){var nb=0;var tr=/\\/$/.test(path)?'/':'';var normalizedBase=base.split('/');var normalizedPath=path.split('/');var baseParts=[];each$4(normalizedBase,k=>{if(k){baseParts.push(k);}});var pathParts=[];for(var _i6=normalizedPath.length-1;_i6>=0;_i6--){if(normalizedPath[_i6].length===0||normalizedPath[_i6]==='.'){continue;}if(normalizedPath[_i6]==='..'){nb++;continue;}if(nb>0){nb--;continue;}pathParts.push(normalizedPath[_i6]);}var i=baseParts.length-nb;var outPath;if(i<=0){outPath=reverse(pathParts).join('/');}else{outPath=baseParts.slice(0,i).join('/')+'/'+reverse(pathParts).join('/');}if(outPath.indexOf('/')!==0){outPath='/'+outPath;}if(tr&&outPath.lastIndexOf('/')!==outPath.length-1){outPath+=tr;}return outPath;}getURI(){var noProtoHost=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var s;if(!this.source||noProtoHost){s='';if(!noProtoHost){if(this.protocol){s+=this.protocol+'://';}else{s+='//';}if(this.userInfo){s+=this.userInfo+'@';}if(this.host){s+=this.host;}if(this.port){s+=':'+this.port;}}if(this.path){s+=this.path;}if(this.query){s+='?'+this.query;}if(this.anchor){s+='#'+this.anchor;}this.source=s;}return this.source;}}var filteredUrlAttrs=Tools.makeMap('src,href,data,background,action,formaction,poster,xlink:href');var internalElementAttr='data-mce-type';var uid=0;var processNode=(node,settings,schema,evt)=>{var _a,_b,_c,_d;var validate=settings.validate;var specialElements=schema.getSpecialElements();if(node.nodeType===COMMENT&&!settings.allow_conditional_comments&&/^\\[if/i.test((_a=node.nodeValue)!==null&&_a!==void 0?_a:'')){node.nodeValue=' '+node.nodeValue;}var lcTagName=(_b=evt===null||evt===void 0?void 0:evt.tagName)!==null&&_b!==void 0?_b:node.nodeName.toLowerCase();if(node.nodeType!==ELEMENT||lcTagName==='body'){return;}var element=SugarElement.fromDom(node);var isInternalElement=has$1(element,internalElementAttr);var bogus=get$9(element,'data-mce-bogus');if(!isInternalElement&&isString(bogus)){if(bogus==='all'){remove$5(element);}else{unwrap(element);}return;}var rule=schema.getElementRule(lcTagName);if(validate&&!rule){if(has$2(specialElements,lcTagName)){remove$5(element);}else{unwrap(element);}return;}else{if(isNonNullable(evt)){evt.allowedTags[lcTagName]=true;}}if(validate&&rule&&!isInternalElement){each$e((_c=rule.attributesForced)!==null&&_c!==void 0?_c:[],attr=>{set$3(element,attr.name,attr.value==='{$uid}'?\"mce_\".concat(uid++):attr.value);});each$e((_d=rule.attributesDefault)!==null&&_d!==void 0?_d:[],attr=>{if(!has$1(element,attr.name)){set$3(element,attr.name,attr.value==='{$uid}'?\"mce_\".concat(uid++):attr.value);}});if(rule.attributesRequired&&!exists(rule.attributesRequired,attr=>has$1(element,attr))){unwrap(element);return;}if(rule.removeEmptyAttrs&&hasNone(element)){unwrap(element);return;}if(rule.outputName&&rule.outputName!==lcTagName){mutate(element,rule.outputName);}}};var shouldKeepAttribute=(settings,schema,tagName,attrName,attrValue)=>!(attrName in filteredUrlAttrs&&isInvalidUri(settings,attrValue,tagName))&&(!settings.validate||schema.isValid(tagName,attrName)||startsWith(attrName,'data-')||startsWith(attrName,'aria-'));var isRequiredAttributeOfInternalElement=(ele,attrName)=>ele.hasAttribute(internalElementAttr)&&(attrName==='id'||attrName==='class'||attrName==='style');var isBooleanAttribute=(attrName,schema)=>attrName in schema.getBoolAttrs();var filterAttributes=(ele,settings,schema)=>{var{attributes}=ele;for(var i=attributes.length-1;i>=0;i--){var attr=attributes[i];var attrName=attr.name;var attrValue=attr.value;if(!shouldKeepAttribute(settings,schema,ele.tagName.toLowerCase(),attrName,attrValue)&&!isRequiredAttributeOfInternalElement(ele,attrName)){ele.removeAttribute(attrName);}else if(isBooleanAttribute(attrName,schema)){ele.setAttribute(attrName,attrName);}}};var setupPurify=(settings,schema)=>{var purify$1=purify();purify$1.addHook('uponSanitizeElement',(ele,evt)=>{processNode(ele,settings,schema,evt);});purify$1.addHook('uponSanitizeAttribute',(ele,evt)=>{var tagName=ele.tagName.toLowerCase();var{attrName,attrValue}=evt;evt.keepAttr=shouldKeepAttribute(settings,schema,tagName,attrName,attrValue);if(evt.keepAttr){evt.allowedAttributes[attrName]=true;if(isBooleanAttribute(attrName,schema)){evt.attrValue=attrName;}if(settings.allow_svg_data_urls&&startsWith(attrValue,'data:image/svg+xml')){evt.forceKeepAttr=true;}}else if(isRequiredAttributeOfInternalElement(ele,attrName)){evt.forceKeepAttr=true;}});return purify$1;};var getPurifyConfig=(settings,mimeType)=>{var basePurifyConfig={IN_PLACE:true,ALLOW_UNKNOWN_PROTOCOLS:true,ALLOWED_TAGS:['#comment','#cdata-section','body'],ALLOWED_ATTR:[]};var config=_objectSpread({},basePurifyConfig);config.PARSER_MEDIA_TYPE=mimeType;if(settings.allow_script_urls){config.ALLOWED_URI_REGEXP=/.*/;}else if(settings.allow_html_data_urls){config.ALLOWED_URI_REGEXP=/^(?!(\\w+script|mhtml):)/i;}return config;};var getSanitizer=(settings,schema)=>{if(settings.sanitize){var _purify=setupPurify(settings,schema);return(body,mimeType)=>{_purify.sanitize(body,getPurifyConfig(settings,mimeType));_purify.removed=[];};}else{return(body,_)=>{var nodeIterator=document.createNodeIterator(body,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT);var node;while(node=nodeIterator.nextNode()){processNode(node,settings,schema);if(isElement$6(node)){filterAttributes(node,settings,schema);}}};}};var makeMap=Tools.makeMap,extend$1=Tools.extend;var transferChildren=(parent,nativeParent,specialElements)=>{var parentName=parent.name;var isSpecial=parentName in specialElements&&parentName!=='title'&&parentName!=='textarea';var childNodes=nativeParent.childNodes;for(var ni=0,nl=childNodes.length;ni<nl;ni++){var nativeChild=childNodes[ni];var _child6=new AstNode(nativeChild.nodeName.toLowerCase(),nativeChild.nodeType);if(isElement$6(nativeChild)){var attributes=nativeChild.attributes;for(var ai=0,al=attributes.length;ai<al;ai++){var attr=attributes[ai];_child6.attr(attr.name,attr.value);}}else if(isText$a(nativeChild)){_child6.value=nativeChild.data;if(isSpecial){_child6.raw=true;}}else if(isComment(nativeChild)||isCData(nativeChild)||isPi(nativeChild)){_child6.value=nativeChild.data;}transferChildren(_child6,nativeChild,specialElements);parent.append(_child6);}};var walkTree=(root,preprocessors,postprocessors)=>{var traverseOrder=[];var _loop2=function _loop2(_node4){var tempNode=_node4;each$e(preprocessors,preprocess=>preprocess(tempNode));if(isNullable(tempNode.parent)&&tempNode!==root){_node4=lastNode;}else{traverseOrder.push(tempNode);}node=_node4;};for(var node=root,lastNode=node;node;lastNode=node,node=node.walk()){_loop2(node);}var _loop3=function _loop3(){var node=traverseOrder[i];each$e(postprocessors,postprocess=>postprocess(node));};for(var i=traverseOrder.length-1;i>=0;i--){_loop3();}};var whitespaceCleaner=(root,schema,settings,args)=>{var validate=settings.validate;var nonEmptyElements=schema.getNonEmptyElements();var whitespaceElements=schema.getWhitespaceElements();var blockElements=extend$1(makeMap('script,style,head,html,body,title,meta,param'),schema.getBlockElements());var textRootBlockElements=getTextRootBlockElements(schema);var allWhiteSpaceRegExp=/[ \\t\\r\\n]+/g;var startWhiteSpaceRegExp=/^[ \\t\\r\\n]+/;var endWhiteSpaceRegExp=/[ \\t\\r\\n]+$/;var hasWhitespaceParent=node=>{var tempNode=node.parent;while(isNonNullable(tempNode)){if(tempNode.name in whitespaceElements){return true;}else{tempNode=tempNode.parent;}}return false;};var isTextRootBlockEmpty=node=>{var tempNode=node;while(isNonNullable(tempNode)){if(tempNode.name in textRootBlockElements){return isEmpty(schema,nonEmptyElements,whitespaceElements,tempNode);}else{tempNode=tempNode.parent;}}return false;};var isBlock=node=>node.name in blockElements||isTransparentAstBlock(schema,node);var isAtEdgeOfBlock=(node,start)=>{var neighbour=start?node.prev:node.next;if(isNonNullable(neighbour)||isNullable(node.parent)){return false;}return isBlock(node.parent)&&(node.parent!==root||args.isRootContent===true);};var preprocess=node=>{var _a;if(node.type===3){if(!hasWhitespaceParent(node)){var _text3=(_a=node.value)!==null&&_a!==void 0?_a:'';_text3=_text3.replace(allWhiteSpaceRegExp,' ');if(isLineBreakNode(node.prev,isBlock)||isAtEdgeOfBlock(node,true)){_text3=_text3.replace(startWhiteSpaceRegExp,'');}if(_text3.length===0){node.remove();}else{node.value=_text3;}}}};var postprocess=node=>{var _a;if(node.type===1){var elementRule=schema.getElementRule(node.name);if(validate&&elementRule){var isNodeEmpty=isEmpty(schema,nonEmptyElements,whitespaceElements,node);if(elementRule.paddInEmptyBlock&&isNodeEmpty&&isTextRootBlockEmpty(node)){paddEmptyNode(settings,args,isBlock,node);}else if(elementRule.removeEmpty&&isNodeEmpty){if(isBlock(node)){node.remove();}else{node.unwrap();}}else if(elementRule.paddEmpty&&(isNodeEmpty||isPaddedWithNbsp(node))){paddEmptyNode(settings,args,isBlock,node);}}}else if(node.type===3){if(!hasWhitespaceParent(node)){var _text4=(_a=node.value)!==null&&_a!==void 0?_a:'';if(node.next&&isBlock(node.next)||isAtEdgeOfBlock(node,false)){_text4=_text4.replace(endWhiteSpaceRegExp,'');}if(_text4.length===0){node.remove();}else{node.value=_text4;}}}};return[preprocess,postprocess];};var getRootBlockName=(settings,args)=>{var _a;var name=(_a=args.forced_root_block)!==null&&_a!==void 0?_a:settings.forced_root_block;if(name===false){return'';}else if(name===true){return'p';}else{return name;}};var DomParser=function DomParser(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var schema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Schema();var nodeFilterRegistry=create$8();var attributeFilterRegistry=create$8();var defaultedSettings=_objectSpread({validate:true,root_name:'body',sanitize:true},settings);var parser=new DOMParser();var sanitize=getSanitizer(defaultedSettings,schema);var parseAndSanitizeWithContext=function parseAndSanitizeWithContext(html,rootName){var format=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'html';var mimeType=format==='xhtml'?'application/xhtml+xml':'text/html';var isSpecialRoot=has$2(schema.getSpecialElements(),rootName.toLowerCase());var content=isSpecialRoot?\"<\".concat(rootName,\">\").concat(html,\"</\").concat(rootName,\">\"):html;var wrappedHtml=format==='xhtml'?\"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\"><head></head><body>\".concat(content,\"</body></html>\"):\"<body>\".concat(content,\"</body>\");var body=parser.parseFromString(wrappedHtml,mimeType).body;sanitize(body,mimeType);return isSpecialRoot?body.firstChild:body;};var addNodeFilter=nodeFilterRegistry.addFilter;var getNodeFilters=nodeFilterRegistry.getFilters;var removeNodeFilter=nodeFilterRegistry.removeFilter;var addAttributeFilter=attributeFilterRegistry.addFilter;var getAttributeFilters=attributeFilterRegistry.getFilters;var removeAttributeFilter=attributeFilterRegistry.removeFilter;var findInvalidChildren=(node,invalidChildren)=>{if(isInvalid(schema,node)){invalidChildren.push(node);}};var isWrappableNode=(blockElements,node)=>{var isInternalElement=isString(node.attr(internalElementAttr));var isInlineElement=node.type===1&&!has$2(blockElements,node.name)&&!isTransparentAstBlock(schema,node);return node.type===3||isInlineElement&&!isInternalElement;};var addRootBlocks=(rootNode,rootBlockName)=>{var blockElements=extend$1(makeMap('script,style,head,html,body,title,meta,param'),schema.getBlockElements());var startWhiteSpaceRegExp=/^[ \\t\\r\\n]+/;var endWhiteSpaceRegExp=/[ \\t\\r\\n]+$/;var node=rootNode.firstChild,rootBlockNode=null;var trim=rootBlock=>{var _a,_b;if(rootBlock){node=rootBlock.firstChild;if(node&&node.type===3){node.value=(_a=node.value)===null||_a===void 0?void 0:_a.replace(startWhiteSpaceRegExp,'');}node=rootBlock.lastChild;if(node&&node.type===3){node.value=(_b=node.value)===null||_b===void 0?void 0:_b.replace(endWhiteSpaceRegExp,'');}}};if(!schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){return;}while(node){var _next3=node.next;if(isWrappableNode(blockElements,node)){if(!rootBlockNode){rootBlockNode=new AstNode(rootBlockName,1);rootBlockNode.attr(defaultedSettings.forced_root_block_attrs);rootNode.insert(rootBlockNode,node);rootBlockNode.append(node);}else{rootBlockNode.append(node);}}else{trim(rootBlockNode);rootBlockNode=null;}node=_next3;}trim(rootBlockNode);};var parse=function parse(html){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _a;var validate=defaultedSettings.validate;var rootName=(_a=args.context)!==null&&_a!==void 0?_a:defaultedSettings.root_name;var element=parseAndSanitizeWithContext(html,rootName,args.format);updateChildren(schema,element);var rootNode=new AstNode(rootName,11);transferChildren(rootNode,element,schema.getSpecialElements());element.innerHTML='';var[whitespacePre,whitespacePost]=whitespaceCleaner(rootNode,schema,defaultedSettings,args);var invalidChildren=[];var invalidFinder=validate?node=>findInvalidChildren(node,invalidChildren):noop;var matches={nodes:{},attributes:{}};var matchFinder=node=>matchNode$1(getNodeFilters(),getAttributeFilters(),node,matches);walkTree(rootNode,[whitespacePre,matchFinder],[whitespacePost,invalidFinder]);invalidChildren.reverse();if(validate&&invalidChildren.length>0){if(args.context){var{pass:topLevelChildren,fail:otherChildren}=partition$2(invalidChildren,child=>child.parent===rootNode);cleanInvalidNodes(otherChildren,schema,rootNode,matchFinder);args.invalid=topLevelChildren.length>0;}else{cleanInvalidNodes(invalidChildren,schema,rootNode,matchFinder);}}var rootBlockName=getRootBlockName(defaultedSettings,args);if(rootBlockName&&(rootNode.name==='body'||args.isRootContent)){addRootBlocks(rootNode,rootBlockName);}if(!args.invalid){runFilters(matches,args);}return rootNode;};var exports={schema,addAttributeFilter,getAttributeFilters,removeAttributeFilter,addNodeFilter,getNodeFilters,removeNodeFilter,parse};register$4(exports,defaultedSettings);register$5(exports,defaultedSettings,schema);return exports;};var serializeContent=content=>isTreeNode(content)?HtmlSerializer({validate:false}).serialize(content):content;var withSerializedContent=(content,fireEvent,sanitize)=>{var serializedContent=serializeContent(content);var eventArgs=fireEvent(serializedContent);if(eventArgs.isDefaultPrevented()){return eventArgs;}else if(isTreeNode(content)){if(eventArgs.content!==serializedContent){var rootNode=DomParser({validate:false,forced_root_block:false,sanitize}).parse(eventArgs.content,{context:content.name});return _objectSpread(_objectSpread({},eventArgs),{},{content:rootNode});}else{return _objectSpread(_objectSpread({},eventArgs),{},{content});}}else{return eventArgs;}};var preProcessGetContent=(editor,args)=>{if(args.no_events){return Result.value(args);}else{var eventArgs=fireBeforeGetContent(editor,args);if(eventArgs.isDefaultPrevented()){return Result.error(fireGetContent(editor,_objectSpread({content:''},eventArgs)).content);}else{return Result.value(eventArgs);}}};var postProcessGetContent=(editor,content,args)=>{if(args.no_events){return content;}else{var processedEventArgs=withSerializedContent(content,content=>fireGetContent(editor,_objectSpread(_objectSpread({},args),{},{content})),shouldSanitizeXss(editor));return processedEventArgs.content;}};var preProcessSetContent=(editor,args)=>{if(args.no_events){return Result.value(args);}else{var processedEventArgs=withSerializedContent(args.content,content=>fireBeforeSetContent(editor,_objectSpread(_objectSpread({},args),{},{content})),shouldSanitizeXss(editor));if(processedEventArgs.isDefaultPrevented()){fireSetContent(editor,processedEventArgs);return Result.error(undefined);}else{return Result.value(processedEventArgs);}}};var postProcessSetContent=(editor,content,args)=>{if(!args.no_events){fireSetContent(editor,_objectSpread(_objectSpread({},args),{},{content}));}};var tableModel=(element,width,rows)=>({element,width,rows});var tableRow=(element,cells)=>({element,cells});var cellPosition=(x,y)=>({x,y});var getSpan=(td,key)=>{return getOpt(td,key).bind(toInt).getOr(1);};var fillout=(table,x,y,tr,td)=>{var rowspan=getSpan(td,'rowspan');var colspan=getSpan(td,'colspan');var rows=table.rows;for(var y2=y;y2<y+rowspan;y2++){if(!rows[y2]){rows[y2]=tableRow(deep$1(tr),[]);}for(var x2=x;x2<x+colspan;x2++){var _cells=rows[y2].cells;_cells[x2]=y2===y&&x2===x?td:shallow$1(td);}}};var cellExists=(table,x,y)=>{var rows=table.rows;var cells=rows[y]?rows[y].cells:[];return!!cells[x];};var skipCellsX=(table,x,y)=>{while(cellExists(table,x,y)){x++;}return x;};var getWidth=rows=>{return foldl(rows,(acc,row)=>{return row.cells.length>acc?row.cells.length:acc;},0);};var findElementPos=(table,element)=>{var rows=table.rows;for(var y=0;y<rows.length;y++){var _cells2=rows[y].cells;for(var x=0;x<_cells2.length;x++){if(eq(_cells2[x],element)){return Optional.some(cellPosition(x,y));}}}return Optional.none();};var extractRows=(table,sx,sy,ex,ey)=>{var newRows=[];var rows=table.rows;for(var y=sy;y<=ey;y++){var _cells3=rows[y].cells;var slice=sx<ex?_cells3.slice(sx,ex+1):_cells3.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice));}return newRows;};var subTable=(table,startPos,endPos)=>{var sx=startPos.x,sy=startPos.y;var ex=endPos.x,ey=endPos.y;var newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows);};var createDomTable=(table,rows)=>{var tableElement=shallow$1(table.element);var tableBody=SugarElement.fromTag('tbody');append(tableBody,rows);append$1(tableElement,tableBody);return tableElement;};var modelRowsToDomRows=table=>{return map$3(table.rows,row=>{var cells=map$3(row.cells,cell=>{var td=deep$1(cell);remove$a(td,'colspan');remove$a(td,'rowspan');return td;});var tr=shallow$1(row.element);append(tr,cells);return tr;});};var fromDom=tableElm=>{var table=tableModel(shallow$1(tableElm),0,[]);each$e(descendants(tableElm,'tr'),(tr,y)=>{each$e(descendants(tr,'td,th'),(td,x)=>{fillout(table,skipCellsX(table,x,y),y,tr,td);});});return tableModel(table.element,getWidth(table.rows),table.rows);};var toDom=table=>{return createDomTable(table,modelRowsToDomRows(table));};var subsection=(table,startElement,endElement)=>{return findElementPos(table,startElement).bind(startPos=>{return findElementPos(table,endElement).map(endPos=>{return subTable(table,startPos,endPos);});});};var findParentListContainer=parents=>find$2(parents,elm=>name(elm)==='ul'||name(elm)==='ol');var getFullySelectedListWrappers=(parents,rng)=>find$2(parents,elm=>name(elm)==='li'&&hasAllContentsSelected(elm,rng)).fold(constant([]),_li=>findParentListContainer(parents).map(listCont=>{var listElm=SugarElement.fromTag(name(listCont));var listStyles=filter$4(getAllRaw(listCont),(_style,name)=>startsWith(name,'list-style'));setAll(listElm,listStyles);return[SugarElement.fromTag('li'),listElm];}).getOr([]));var wrap=(innerElm,elms)=>{var wrapped=foldl(elms,(acc,elm)=>{append$1(elm,acc);return elm;},innerElm);return elms.length>0?fromElements([wrapped]):wrapped;};var directListWrappers=commonAnchorContainer=>{if(isListItem$1(commonAnchorContainer)){return parent(commonAnchorContainer).filter(isList).fold(constant([]),listElm=>[commonAnchorContainer,listElm]);}else{return isList(commonAnchorContainer)?[commonAnchorContainer]:[];}};var getWrapElements=(rootNode,rng)=>{var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer);var parents=parentsAndSelf(commonAnchorContainer,rootNode);var wrapElements=filter$5(parents,isWrapElement);var listWrappers=getFullySelectedListWrappers(parents,rng);var allWrappers=wrapElements.concat(listWrappers.length?listWrappers:directListWrappers(commonAnchorContainer));return map$3(allWrappers,shallow$1);};var emptyFragment=()=>fromElements([]);var getFragmentFromRange=(rootNode,rng)=>wrap(SugarElement.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng));var getParentTable=(rootElm,cell)=>ancestor$3(cell,'table',curry(eq,rootElm));var getTableFragment=(rootNode,selectedTableCells)=>getParentTable(rootNode,selectedTableCells[0]).bind(tableElm=>{var firstCell=selectedTableCells[0];var lastCell=selectedTableCells[selectedTableCells.length-1];var fullTableModel=fromDom(tableElm);return subsection(fullTableModel,firstCell,lastCell).map(sectionedTableModel=>fromElements([toDom(sectionedTableModel)]));}).getOrThunk(emptyFragment);var getSelectionFragment=(rootNode,ranges)=>ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0]);var read$3=(rootNode,ranges)=>{var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):getSelectionFragment(rootNode,ranges);};var isCollapsibleWhitespace=(text,index)=>index>=0&&index<text.length&&isWhiteSpace(text.charAt(index));var getInnerText=bin=>{return trim$1(bin.innerText);};var getContextNodeName=parentBlockOpt=>parentBlockOpt.map(block=>block.nodeName).getOr('div').toLowerCase();var getTextContent=editor=>Optional.from(editor.selection.getRng()).map(rng=>{var _a;var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock));var body=editor.getBody();var contextNodeName=getContextNodeName(parentBlockOpt);var rangeContentClone=SugarElement.fromDom(rng.cloneContents());cleanupBogusElements(rangeContentClone);cleanupInputNames(rangeContentClone);var bin=editor.dom.add(body,contextNodeName,{'data-mce-bogus':'all','style':'overflow: hidden; opacity: 0;'},rangeContentClone.dom);var text=getInnerText(bin);var nonRenderedText=trim$1((_a=bin.textContent)!==null&&_a!==void 0?_a:'');editor.dom.remove(bin);if(isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){var parentBlock=parentBlockOpt.getOr(body);var parentBlockText=getInnerText(parentBlock);var textIndex=parentBlockText.indexOf(text);if(textIndex===-1){return text;}else{var hasProceedingSpace=isCollapsibleWhitespace(parentBlockText,textIndex-1);var hasTrailingSpace=isCollapsibleWhitespace(parentBlockText,textIndex+text.length);return(hasProceedingSpace?' ':'')+text+(hasTrailingSpace?' ':'');}}else{return text;}}).getOr('');var getSerializedContent=(editor,args)=>{var rng=editor.selection.getRng(),tmpElm=editor.dom.create('body');var sel=editor.selection.getSel();var ranges=processRanges(editor,getRanges$1(sel));var fragment=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),ranges).dom:rng.cloneContents();if(fragment){tmpElm.appendChild(fragment);}return editor.selection.serializer.serialize(tmpElm,args);};var extractSelectedContent=(editor,args)=>{if(args.format==='text'){return getTextContent(editor);}else{var content=getSerializedContent(editor,args);if(args.format==='tree'){return content;}else{return editor.selection.isCollapsed()?'':content;}}};var setupArgs$3=(args,format)=>_objectSpread(_objectSpread({},args),{},{format,get:true,selection:true,getInner:true});var getSelectedContentInternal=function getSelectedContentInternal(editor,format){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var defaultedArgs=setupArgs$3(args,format);return preProcessGetContent(editor,defaultedArgs).fold(identity,updatedArgs=>{var content=extractSelectedContent(editor,updatedArgs);return postProcessGetContent(editor,content,updatedArgs);});};var KEEP=0,INSERT=1,DELETE=2;var diff=(left,right)=>{var size=left.length+right.length+2;var vDown=new Array(size);var vUp=new Array(size);var snake=(start,end,diag)=>{return{start,end,diag};};var buildScript=(start1,end1,start2,end2,script)=>{var middle=getMiddleSnake(start1,end1,start2,end2);if(middle===null||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2){var i=start1;var j=start2;while(i<end1||j<end2){if(i<end1&&j<end2&&left[i]===right[j]){script.push([KEEP,left[i]]);++i;++j;}else{if(end1-start1>end2-start2){script.push([DELETE,left[i]]);++i;}else{script.push([INSERT,right[j]]);++j;}}}}else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2){script.push([KEEP,left[i2]]);}buildScript(middle.end,end1,middle.end-middle.diag,end2,script);}};var buildSnake=(start,diag,end1,end2)=>{var end=start;while(end-diag<end2&&end<end1&&left[end]===right[end-diag]){++end;}return snake(start,end,diag);};var getMiddleSnake=(start1,end1,start2,end2)=>{var m=end1-start1;var n=end2-start2;if(m===0||n===0){return null;}var delta=m-n;var sum=n+m;var offset=(sum%2===0?sum:sum+1)/2;vDown[1+offset]=start1;vUp[1+offset]=end1+1;var d,k,i,x,y;for(d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){i=k+offset;if(k===-d||k!==d&&vDown[i-1]<vDown[i+1]){vDown[i]=vDown[i+1];}else{vDown[i]=vDown[i-1]+1;}x=vDown[i];y=x-start1+start2-k;while(x<end1&&y<end2&&left[x]===right[y]){vDown[i]=++x;++y;}if(delta%2!==0&&delta-d<=k&&k<=delta+d){if(vUp[i-delta]<=vDown[i]){return buildSnake(vUp[i-delta],k+start1-start2,end1,end2);}}}for(k=delta-d;k<=delta+d;k+=2){i=k+offset-delta;if(k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]){vUp[i]=vUp[i+1]-1;}else{vUp[i]=vUp[i-1];}x=vUp[i]-1;y=x-start1+start2-k;while(x>=start1&&y>=start2&&left[x]===right[y]){vUp[i]=x--;y--;}if(delta%2===0&&-d<=k&&k<=d){if(vUp[i]<=vDown[i+delta]){return buildSnake(vUp[i],k+start1-start2,end1,end2);}}}}return null;};var script=[];buildScript(0,left.length,0,right.length,script);return script;};var getOuterHtml=elm=>{if(isElement$6(elm)){return elm.outerHTML;}else if(isText$a(elm)){return Entities.encodeRaw(elm.data,false);}else if(isComment(elm)){return'<!--'+elm.data+'-->';}return'';};var createFragment=html=>{var node;var container=document.createElement('div');var frag=document.createDocumentFragment();if(html){container.innerHTML=html;}while(node=container.firstChild){frag.appendChild(node);}return frag;};var insertAt=(elm,html,index)=>{var fragment=createFragment(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];elm.insertBefore(fragment,target);}else{elm.appendChild(fragment);}};var removeAt=(elm,index)=>{if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];elm.removeChild(target);}};var applyDiff=(diff,elm)=>{var index=0;each$e(diff,action=>{if(action[0]===KEEP){index++;}else if(action[0]===INSERT){insertAt(elm,action[1],index);index++;}else if(action[0]===DELETE){removeAt(elm,index);}});};var read$2=elm=>{return filter$5(map$3(from(elm.childNodes),getOuterHtml),item=>{return item.length>0;});};var write=(fragments,elm)=>{var currentFragments=map$3(from(elm.childNodes),getOuterHtml);applyDiff(diff(currentFragments,fragments),elm);return elm;};var lazyTempDocument=cached(()=>document.implementation.createHTMLDocument('undo'));var hasIframes=html=>{return html.indexOf('</iframe>')!==-1;};var createFragmentedLevel=fragments=>{return{type:'fragmented',fragments,content:'',bookmark:null,beforeBookmark:null};};var createCompleteLevel=content=>{return{type:'complete',fragments:null,content,bookmark:null,beforeBookmark:null};};var createFromEditor=editor=>{var fragments=read$2(editor.getBody());var trimmedFragments=bind$3(fragments,html=>{var trimmed=trimInternal(editor.serializer,html);return trimmed.length>0?[trimmed]:[];});var content=trimmedFragments.join('');return hasIframes(content)?createFragmentedLevel(trimmedFragments):createCompleteLevel(content);};var applyToEditor=(editor,level,before)=>{var bookmark=before?level.beforeBookmark:level.bookmark;if(level.type==='fragmented'){write(level.fragments,editor.getBody());}else{editor.setContent(level.content,{format:'raw',no_selection:isNonNullable(bookmark)&&isPathBookmark(bookmark)?!bookmark.isFakeCaret:true});}if(bookmark){editor.selection.moveToBookmark(bookmark);editor.selection.scrollIntoView();}};var getLevelContent=level=>{return level.type==='fragmented'?level.fragments.join(''):level.content;};var getCleanLevelContent=level=>{var elm=SugarElement.fromTag('body',lazyTempDocument());set$1(elm,getLevelContent(level));each$e(descendants(elm,'*[data-mce-bogus]'),unwrap);return get$6(elm);};var hasEqualContent=(level1,level2)=>getLevelContent(level1)===getLevelContent(level2);var hasEqualCleanedContent=(level1,level2)=>getCleanLevelContent(level1)===getCleanLevelContent(level2);var isEq$1=(level1,level2)=>{if(!level1||!level2){return false;}else if(hasEqualContent(level1,level2)){return true;}else{return hasEqualCleanedContent(level1,level2);}};var isUnlocked=locks=>locks.get()===0;var setTyping=(undoManager,typing,locks)=>{if(isUnlocked(locks)){undoManager.typing=typing;}};var endTyping=(undoManager,locks)=>{if(undoManager.typing){setTyping(undoManager,false,locks);undoManager.add();}};var endTypingLevelIgnoreLocks=undoManager=>{if(undoManager.typing){undoManager.typing=false;undoManager.add();}};var beforeChange$1=(editor,locks,beforeBookmark)=>{if(isUnlocked(locks)){beforeBookmark.set(getUndoBookmark(editor.selection));}};var addUndoLevel$1=(editor,undoManager,index,locks,beforeBookmark,level,event)=>{var currentLevel=createFromEditor(editor);var newLevel=Tools.extend(level||{},currentLevel);if(!isUnlocked(locks)||editor.removed){return null;}var lastLevel=undoManager.data[index.get()];if(editor.dispatch('BeforeAddUndo',{level:newLevel,lastLevel,originalEvent:event}).isDefaultPrevented()){return null;}if(lastLevel&&isEq$1(lastLevel,newLevel)){return null;}if(undoManager.data[index.get()]){beforeBookmark.get().each(bm=>{undoManager.data[index.get()].beforeBookmark=bm;});}var customUndoRedoLevels=getCustomUndoRedoLevels(editor);if(customUndoRedoLevels){if(undoManager.data.length>customUndoRedoLevels){for(var i=0;i<undoManager.data.length-1;i++){undoManager.data[i]=undoManager.data[i+1];}undoManager.data.length--;index.set(undoManager.data.length);}}newLevel.bookmark=getUndoBookmark(editor.selection);if(index.get()<undoManager.data.length-1){undoManager.data.length=index.get()+1;}undoManager.data.push(newLevel);index.set(undoManager.data.length-1);var args={level:newLevel,lastLevel,originalEvent:event};if(index.get()>0){editor.setDirty(true);editor.dispatch('AddUndo',args);editor.dispatch('change',args);}else{editor.dispatch('AddUndo',args);}return newLevel;};var clear$1=(editor,undoManager,index)=>{undoManager.data=[];index.set(0);undoManager.typing=false;editor.dispatch('ClearUndos');};var extra$1=(editor,undoManager,index,callback1,callback2)=>{if(undoManager.transact(callback1)){var bookmark=undoManager.data[index.get()].bookmark;var lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,true);if(undoManager.transact(callback2)){undoManager.data[index.get()-1].beforeBookmark=bookmark;}}};var redo$1=(editor,index,data)=>{var level;if(index.get()<data.length-1){index.set(index.get()+1);level=data[index.get()];applyToEditor(editor,level,false);editor.setDirty(true);editor.dispatch('Redo',{level});}return level;};var undo$1=(editor,undoManager,locks,index)=>{var level;if(undoManager.typing){undoManager.add();undoManager.typing=false;setTyping(undoManager,false,locks);}if(index.get()>0){index.set(index.get()-1);level=undoManager.data[index.get()];applyToEditor(editor,level,true);editor.setDirty(true);editor.dispatch('Undo',{level});}return level;};var reset$1=undoManager=>{undoManager.clear();undoManager.add();};var hasUndo$1=(editor,undoManager,index)=>index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0]);var hasRedo$1=(undoManager,index)=>index.get()<undoManager.data.length-1&&!undoManager.typing;var transact$1=(undoManager,locks,callback)=>{endTyping(undoManager,locks);undoManager.beforeChange();undoManager.ignore(callback);return undoManager.add();};var ignore$1=(locks,callback)=>{try{locks.set(locks.get()+1);callback();}finally{locks.set(locks.get()-1);}};var addVisualInternal=(editor,elm)=>{var dom=editor.dom;var scope=isNonNullable(elm)?elm:editor.getBody();each$e(dom.select('table,a',scope),matchedElm=>{switch(matchedElm.nodeName){case'TABLE':var cls=getVisualAidsTableClass(editor);var _value11=dom.getAttrib(matchedElm,'border');if((!_value11||_value11==='0')&&editor.hasVisual){dom.addClass(matchedElm,cls);}else{dom.removeClass(matchedElm,cls);}break;case'A':if(!dom.getAttrib(matchedElm,'href')){var _value12=dom.getAttrib(matchedElm,'name')||matchedElm.id;var _cls=getVisualAidsAnchorClass(editor);if(_value12&&editor.hasVisual){dom.addClass(matchedElm,_cls);}else{dom.removeClass(matchedElm,_cls);}}break;}});editor.dispatch('VisualAid',{element:elm,hasVisual:editor.hasVisual});};var makePlainAdaptor=editor=>({init:{bindEvents:noop},undoManager:{beforeChange:(locks,beforeBookmark)=>beforeChange$1(editor,locks,beforeBookmark),add:(undoManager,index,locks,beforeBookmark,level,event)=>addUndoLevel$1(editor,undoManager,index,locks,beforeBookmark,level,event),undo:(undoManager,locks,index)=>undo$1(editor,undoManager,locks,index),redo:(index,data)=>redo$1(editor,index,data),clear:(undoManager,index)=>clear$1(editor,undoManager,index),reset:undoManager=>reset$1(undoManager),hasUndo:(undoManager,index)=>hasUndo$1(editor,undoManager,index),hasRedo:(undoManager,index)=>hasRedo$1(undoManager,index),transact:(undoManager,locks,callback)=>transact$1(undoManager,locks,callback),ignore:(locks,callback)=>ignore$1(locks,callback),extra:(undoManager,index,callback1,callback2)=>extra$1(editor,undoManager,index,callback1,callback2)},formatter:{match:(name,vars,node,similar)=>match$2(editor,name,vars,node,similar),matchAll:(names,vars)=>_matchAll(editor,names,vars),matchNode:(node,name,vars,similar)=>_matchNode(editor,node,name,vars,similar),canApply:name=>_canApply(editor,name),closest:names=>_closest(editor,names),apply:(name,vars,node)=>applyFormat$1(editor,name,vars,node),remove:(name,vars,node,similar)=>removeFormat$1(editor,name,vars,node,similar),toggle:(name,vars,node)=>_toggle(editor,name,vars,node),formatChanged:(registeredFormatListeners,formats,callback,similar,vars)=>formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars)},editor:{getContent:args=>getContentInternal(editor,args),setContent:(content,args)=>setContentInternal(editor,content,args),insertContent:(value,details)=>insertHtmlAtCaret(editor,value,details),addVisual:elm=>addVisualInternal(editor,elm)},selection:{getContent:(format,args)=>getSelectedContentInternal(editor,format,args)},autocompleter:{addDecoration:range=>create$9(editor,range),removeDecoration:()=>remove$2(editor,SugarElement.fromDom(editor.getBody()))},raw:{getModel:()=>Optional.none()}});var makeRtcAdaptor=rtcEditor=>{var defaultVars=vars=>isObject(vars)?vars:{};var{init,undoManager,formatter,editor,selection,autocompleter,raw}=rtcEditor;return{init:{bindEvents:init.bindEvents},undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:(_undoManager,_locks,fn)=>undoManager.transact(fn),ignore:(_locks,callback)=>undoManager.ignore(callback),extra:(_undoManager,_index,callback1,callback2)=>undoManager.extra(callback1,callback2)},formatter:{match:(name,vars,_node,similar)=>formatter.match(name,defaultVars(vars),similar),matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:name=>formatter.canApply(name),closest:names=>formatter.closest(names),apply:(name,vars,_node)=>formatter.apply(name,defaultVars(vars)),remove:(name,vars,_node,_similar)=>formatter.remove(name,defaultVars(vars)),toggle:(name,vars,_node)=>formatter.toggle(name,defaultVars(vars)),formatChanged:(_rfl,formats,callback,similar,vars)=>formatter.formatChanged(formats,callback,similar,vars)},editor:{getContent:args=>editor.getContent(args),setContent:(content,args)=>{return{content:editor.setContent(content,args),html:''};},insertContent:(content,_details)=>{editor.insertContent(content);return'';},addVisual:editor.addVisual},selection:{getContent:(_format,args)=>selection.getContent(args)},autocompleter:{addDecoration:autocompleter.addDecoration,removeDecoration:autocompleter.removeDecoration},raw:{getModel:()=>Optional.some(raw.getRawModel())}};};var makeNoopAdaptor=()=>{var nul=constant(null);var empty=constant('');return{init:{bindEvents:noop},undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(undefined),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:constant({content:'',html:''}),insertContent:constant(''),addVisual:noop},selection:{getContent:empty},autocompleter:{addDecoration:noop,removeDecoration:noop},raw:{getModel:constant(Optional.none())}};};var isRtc=editor=>has$2(editor.plugins,'rtc');var getRtcSetup=editor=>get$a(editor.plugins,'rtc').bind(rtcPlugin=>Optional.from(rtcPlugin.setup));var setup$s=editor=>{var editorCast=editor;return getRtcSetup(editor).fold(()=>{editorCast.rtcInstance=makePlainAdaptor(editor);return Optional.none();},setup=>{editorCast.rtcInstance=makeNoopAdaptor();return Optional.some(()=>setup().then(rtcEditor=>{editorCast.rtcInstance=makeRtcAdaptor(rtcEditor);return rtcEditor.rtc.isRemote;}));});};var getRtcInstanceWithFallback=editor=>editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor);var getRtcInstanceWithError=editor=>{var rtcInstance=editor.rtcInstance;if(!rtcInstance){throw new Error('Failed to get RTC instance not yet initialized.');}else{return rtcInstance;}};var _beforeChange=(editor,locks,beforeBookmark)=>{getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark);};var addUndoLevel=(editor,undoManager,index,locks,beforeBookmark,level,event)=>getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event);var _undo=(editor,undoManager,locks,index)=>getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index);var _redo=(editor,index,data)=>getRtcInstanceWithError(editor).undoManager.redo(index,data);var _clear=(editor,undoManager,index)=>{getRtcInstanceWithError(editor).undoManager.clear(undoManager,index);};var _reset=(editor,undoManager)=>{getRtcInstanceWithError(editor).undoManager.reset(undoManager);};var _hasUndo=(editor,undoManager,index)=>getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index);var _hasRedo=(editor,undoManager,index)=>getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index);var _transact=(editor,undoManager,locks,callback)=>getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback);var _ignore=(editor,locks,callback)=>{getRtcInstanceWithError(editor).undoManager.ignore(locks,callback);};var _extra=(editor,undoManager,index,callback1,callback2)=>{getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2);};var matchFormat=(editor,name,vars,node,similar)=>getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar);var matchAllFormats=(editor,names,vars)=>getRtcInstanceWithError(editor).formatter.matchAll(names,vars);var matchNodeFormat=(editor,node,name,vars,similar)=>getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar);var canApplyFormat=(editor,name)=>getRtcInstanceWithError(editor).formatter.canApply(name);var closestFormat=(editor,names)=>getRtcInstanceWithError(editor).formatter.closest(names);var applyFormat=(editor,name,vars,node)=>{getRtcInstanceWithError(editor).formatter.apply(name,vars,node);};var removeFormat=(editor,name,vars,node,similar)=>{getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar);};var toggleFormat=(editor,name,vars,node)=>{getRtcInstanceWithError(editor).formatter.toggle(name,vars,node);};var _formatChanged=(editor,registeredFormatListeners,formats,callback,similar,vars)=>getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars);var getContent$2=(editor,args)=>getRtcInstanceWithFallback(editor).editor.getContent(args);var setContent$2=(editor,content,args)=>getRtcInstanceWithFallback(editor).editor.setContent(content,args);var insertContent$1=(editor,value,details)=>getRtcInstanceWithFallback(editor).editor.insertContent(value,details);var getSelectedContent=(editor,format,args)=>getRtcInstanceWithError(editor).selection.getContent(format,args);var addVisual$1=(editor,elm)=>getRtcInstanceWithError(editor).editor.addVisual(elm);var bindEvents=editor=>getRtcInstanceWithError(editor).init.bindEvents();var addAutocompleterDecoration=(editor,range)=>getRtcInstanceWithError(editor).autocompleter.addDecoration(range);var removeAutocompleterDecoration=editor=>getRtcInstanceWithError(editor).autocompleter.removeDecoration();var getContent$1=function getContent$1(editor){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var format=args.format?args.format:'html';return getSelectedContent(editor,format,args);};var removeEmpty=text=>{if(text.dom.length===0){remove$5(text);return Optional.none();}else{return Optional.some(text);}};var walkPastBookmark=(node,start)=>node.filter(elm=>BookmarkManager.isBookmarkNode(elm.dom)).bind(start?nextSibling:prevSibling);var merge$1=(outer,inner,rng,start)=>{var outerElm=outer.dom;var innerElm=inner.dom;var oldLength=start?outerElm.length:innerElm.length;if(start){mergeTextNodes(outerElm,innerElm,false,!start);rng.setStart(innerElm,oldLength);}else{mergeTextNodes(innerElm,outerElm,false,!start);rng.setEnd(innerElm,oldLength);}};var normalizeTextIfRequired=(inner,start)=>{parent(inner).each(root=>{var text=inner.dom;if(start&&needsToBeNbspLeft(root,CaretPosition(text,0))){normalizeWhitespaceAfter(text,0);}else if(!start&&needsToBeNbspRight(root,CaretPosition(text,text.length))){normalizeWhitespaceBefore(text,text.length);}});};var mergeAndNormalizeText=(outerNode,innerNode,rng,start)=>{outerNode.bind(outer=>{var normalizer=start?normalizeWhitespaceBefore:normalizeWhitespaceAfter;normalizer(outer.dom,start?outer.dom.length:0);return innerNode.filter(isText$b).map(inner=>merge$1(outer,inner,rng,start));}).orThunk(()=>{var innerTextNode=walkPastBookmark(innerNode,start).or(innerNode).filter(isText$b);return innerTextNode.map(inner=>normalizeTextIfRequired(inner,start));});};var rngSetContent=(rng,fragment)=>{var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom);var lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents();rng.insertNode(fragment);var prevText=firstChild.bind(prevSibling).filter(isText$b).bind(removeEmpty);var nextText=lastChild.bind(nextSibling).filter(isText$b).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,true);mergeAndNormalizeText(nextText,lastChild,rng,false);rng.collapse(false);};var setupArgs$2=(args,content)=>_objectSpread(_objectSpread({format:'html'},args),{},{set:true,selection:true,content});var cleanContent=(editor,args)=>{if(args.format!=='raw'){var rng=editor.selection.getRng();var contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock);var contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{};var node=editor.parser.parse(args.content,_objectSpread(_objectSpread({forced_root_block:false},contextArgs),args));return HtmlSerializer({validate:false},editor.schema).serialize(node);}else{return args.content;}};var setContent$1=function setContent$1(editor,content){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var defaultedArgs=setupArgs$2(args,content);preProcessSetContent(editor,defaultedArgs).each(updatedArgs=>{var cleanedContent=cleanContent(editor,updatedArgs);var rng=editor.selection.getRng();rngSetContent(rng,rng.createContextualFragment(cleanedContent));editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);postProcessSetContent(editor,cleanedContent,updatedArgs);});};var deleteFromCallbackMap=(callbackMap,selector,callback)=>{if(has$2(callbackMap,selector)){var newCallbacks=filter$5(callbackMap[selector],cb=>cb!==callback);if(newCallbacks.length===0){delete callbackMap[selector];}else{callbackMap[selector]=newCallbacks;}}};var SelectorChanged=(dom,editor)=>{var selectorChangedData;var currentSelectors;var findMatchingNode=(selector,nodes)=>find$2(nodes,node=>dom.is(node,selector));var getParents=elem=>dom.getParents(elem,undefined,dom.getRoot());var setup=()=>{selectorChangedData={};currentSelectors={};editor.on('NodeChange',e=>{var node=e.element;var parents=getParents(node);var matchedSelectors={};each$d(selectorChangedData,(callbacks,selector)=>{findMatchingNode(selector,parents).each(node=>{if(!currentSelectors[selector]){each$e(callbacks,callback=>{callback(true,{node,selector,parents});});currentSelectors[selector]=callbacks;}matchedSelectors[selector]=callbacks;});});each$d(currentSelectors,(callbacks,selector)=>{if(!matchedSelectors[selector]){delete currentSelectors[selector];each$e(callbacks,callback=>{callback(false,{node,selector,parents});});}});});};return{selectorChangedWithUnbind:(selector,callback)=>{if(!selectorChangedData){setup();}if(!selectorChangedData[selector]){selectorChangedData[selector]=[];}selectorChangedData[selector].push(callback);findMatchingNode(selector,getParents(editor.selection.getStart())).each(()=>{currentSelectors[selector]=selectorChangedData[selector];});return{unbind:()=>{deleteFromCallbackMap(selectorChangedData,selector,callback);deleteFromCallbackMap(currentSelectors,selector,callback);}};}};};var isAttachedToDom=node=>{return!!(node&&node.ownerDocument)&&contains(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node));};var isValidRange=rng=>{if(!rng){return false;}else{return isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer);}};var EditorSelection=(dom,win,serializer,editor)=>{var selectedRange;var explicitRange;var{selectorChangedWithUnbind}=SelectorChanged(dom,editor);var setCursorLocation=(node,offset)=>{var rng=dom.createRng();if(isNonNullable(node)&&isNonNullable(offset)){rng.setStart(node,offset);rng.setEnd(node,offset);setRng(rng);collapse(false);}else{moveEndPoint(dom,rng,editor.getBody(),true);setRng(rng);}};var getContent=args=>getContent$1(editor,args);var setContent=(content,args)=>setContent$1(editor,content,args);var getStart$1=real=>getStart(editor.getBody(),getRng$1(),real);var getEnd=real=>getEnd$1(editor.getBody(),getRng$1(),real);var getBookmark=(type,normalized)=>bookmarkManager.getBookmark(type,normalized);var moveToBookmark=bookmark=>bookmarkManager.moveToBookmark(bookmark);var select$1=(node,content)=>{select(dom,node,content).each(setRng);return node;};var isCollapsed=()=>{var rng=getRng$1(),sel=getSel();if(!rng||rng.item){return false;}if(rng.compareEndPoints){return rng.compareEndPoints('StartToEnd',rng)===0;}return!sel||rng.collapsed;};var isEditable=()=>{var rng=getRng$1();var fakeSelectedElements=editor.getBody().querySelectorAll('[data-mce-selected=\"1\"]');if(fakeSelectedElements.length>0){return forall(fakeSelectedElements,el=>dom.isEditable(el.parentElement));}else if(rng.startContainer===rng.endContainer){return dom.isEditable(rng.startContainer);}else{return dom.isEditable(rng.startContainer)&&dom.isEditable(rng.endContainer);}};var collapse=toStart=>{var rng=getRng$1();rng.collapse(!!toStart);setRng(rng);};var getSel=()=>win.getSelection?win.getSelection():win.document.selection;var getRng$1=()=>{var rng;var tryCompareBoundaryPoints=(how,sourceRange,destinationRange)=>{try{return sourceRange.compareBoundaryPoints(how,destinationRange);}catch(ex){return-1;}};var doc=win.document;if(isNonNullable(editor.bookmark)&&!hasFocus(editor)){var bookmark=getRng(editor);if(bookmark.isSome()){return bookmark.map(r=>processRanges(editor,[r])[0]).getOr(doc.createRange());}}try{var selection=getSel();if(selection&&!isRestrictedNode(selection.anchorNode)){if(selection.rangeCount>0){rng=selection.getRangeAt(0);}else{rng=doc.createRange();}rng=processRanges(editor,[rng])[0];}}catch(ex){}if(!rng){rng=doc.createRange();}if(isDocument$1(rng.startContainer)&&rng.collapsed){var elm=dom.getRoot();rng.setStart(elm,0);rng.setEnd(elm,0);}if(selectedRange&&explicitRange){if(tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)===0&&tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)===0){rng=explicitRange;}else{selectedRange=null;explicitRange=null;}}return rng;};var setRng=(rng,forward)=>{if(!isValidRange(rng)){return;}var sel=getSel();var evt=editor.dispatch('SetSelectionRange',{range:rng,forward});rng=evt.range;if(sel){explicitRange=rng;try{sel.removeAllRanges();sel.addRange(rng);}catch(ex){}if(forward===false&&sel.extend){sel.collapse(rng.endContainer,rng.endOffset);sel.extend(rng.startContainer,rng.startOffset);}selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null;}if(!rng.collapsed&&rng.startContainer===rng.endContainer&&(sel===null||sel===void 0?void 0:sel.setBaseAndExtent)){if(rng.endOffset-rng.startOffset<2){if(rng.startContainer.hasChildNodes()){var node=rng.startContainer.childNodes[rng.startOffset];if(node&&node.nodeName==='IMG'){sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset);if(sel.anchorNode!==rng.startContainer||sel.focusNode!==rng.endContainer){sel.setBaseAndExtent(node,0,node,1);}}}}}editor.dispatch('AfterSetSelectionRange',{range:rng,forward});};var setNode=elm=>{setContent(dom.getOuterHTML(elm));return elm;};var getNode$1=()=>getNode(editor.getBody(),getRng$1());var getSelectedBlocks$1=(startElm,endElm)=>getSelectedBlocks(dom,getRng$1(),startElm,endElm);var isForward=()=>{var sel=getSel();var anchorNode=sel===null||sel===void 0?void 0:sel.anchorNode;var focusNode=sel===null||sel===void 0?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode)){return true;}var anchorRange=dom.createRng();var focusRange=dom.createRng();try{anchorRange.setStart(anchorNode,sel.anchorOffset);anchorRange.collapse(true);focusRange.setStart(focusNode,sel.focusOffset);focusRange.collapse(true);}catch(e){return true;}return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0;};var normalize=()=>{var rng=getRng$1();var sel=getSel();if(!hasMultipleRanges(sel)&&hasAnyRanges(editor)){var normRng=normalize$2(dom,rng);normRng.each(normRng=>{setRng(normRng,isForward());});return normRng.getOr(rng);}return rng;};var selectorChanged=(selector,callback)=>{selectorChangedWithUnbind(selector,callback);return exports;};var getScrollContainer=()=>{var scrollContainer;var node=dom.getRoot();while(node&&node.nodeName!=='BODY'){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break;}node=node.parentNode;}return scrollContainer;};var scrollIntoView=(elm,alignToTop)=>{if(isNonNullable(elm)){scrollElementIntoView(editor,elm,alignToTop);}else{scrollRangeIntoView(editor,getRng$1(),alignToTop);}};var placeCaretAt=(clientX,clientY)=>setRng(fromPoint(clientX,clientY,editor.getDoc()));var getBoundingClientRect=()=>{var rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect();};var destroy=()=>{win=selectedRange=explicitRange=null;controlSelection.destroy();};var expand=function expand(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{type:'word'};return setRng(RangeUtils(dom).expand(getRng$1(),options));};var exports={dom,win,serializer,editor,expand,collapse,setCursorLocation,getContent,setContent,getBookmark,moveToBookmark,select:select$1,isCollapsed,isEditable,isForward,setNode,getNode:getNode$1,getSel,setRng,getRng:getRng$1,getStart:getStart$1,getEnd,getSelectedBlocks:getSelectedBlocks$1,normalize,selectorChanged,selectorChangedWithUnbind,getScrollContainer,scrollIntoView,placeCaretAt,getBoundingClientRect,destroy};var bookmarkManager=BookmarkManager(exports);var controlSelection=ControlSelection(exports,editor);exports.bookmarkManager=bookmarkManager;exports.controlSelection=controlSelection;return exports;};var register$3=(htmlParser,settings,dom)=>{htmlParser.addAttributeFilter('data-mce-tabindex',(nodes,name)=>{var i=nodes.length;while(i--){var node=nodes[i];node.attr('tabindex',node.attr('data-mce-tabindex'));node.attr(name,null);}});htmlParser.addAttributeFilter('src,href,style',(nodes,name)=>{var internalName='data-mce-'+name;var urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope;var i=nodes.length;while(i--){var node=nodes[i];var _value13=node.attr(internalName);if(_value13!==undefined){node.attr(name,_value13.length>0?_value13:null);node.attr(internalName,null);}else{_value13=node.attr(name);if(name==='style'){_value13=dom.serializeStyle(dom.parseStyle(_value13),node.name);}else if(urlConverter){_value13=urlConverter.call(urlConverterScope,_value13,name,node.name);}node.attr(name,_value13.length>0?_value13:null);}}});htmlParser.addAttributeFilter('class',nodes=>{var i=nodes.length;while(i--){var node=nodes[i];var _value14=node.attr('class');if(_value14){_value14=_value14.replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g,'');node.attr('class',_value14.length>0?_value14:null);}}});htmlParser.addAttributeFilter('data-mce-type',(nodes,name,args)=>{var i=nodes.length;while(i--){var node=nodes[i];if(node.attr('data-mce-type')==='bookmark'&&!args.cleanup){var hasChildren=Optional.from(node.firstChild).exists(firstChild=>{var _a;return!isZwsp$1((_a=firstChild.value)!==null&&_a!==void 0?_a:'');});if(hasChildren){node.unwrap();}else{node.remove();}}}});htmlParser.addNodeFilter('noscript',nodes=>{var _a;var i=nodes.length;while(i--){var node=nodes[i].firstChild;if(node){node.value=Entities.decode((_a=node.value)!==null&&_a!==void 0?_a:'');}}});htmlParser.addNodeFilter('script,style',(nodes,name)=>{var _a;var trim=value=>{return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g,'\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g,'').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi,'').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g,'');};var i=nodes.length;while(i--){var node=nodes[i];var _firstChild=node.firstChild;var _value15=(_a=_firstChild===null||_firstChild===void 0?void 0:_firstChild.value)!==null&&_a!==void 0?_a:'';if(name==='script'){var _type=node.attr('type');if(_type){node.attr('type',_type==='mce-no/type'?null:_type.replace(/^mce\\-/,''));}if(settings.element_format==='xhtml'&&_firstChild&&_value15.length>0){_firstChild.value='// <![CDATA[\\n'+trim(_value15)+'\\n// ]]>';}}else{if(settings.element_format==='xhtml'&&_firstChild&&_value15.length>0){_firstChild.value='<!--\\n'+trim(_value15)+'\\n-->';}}}});htmlParser.addNodeFilter('#comment',nodes=>{var i=nodes.length;while(i--){var node=nodes[i];var _value16=node.value;if(settings.preserve_cdata&&(_value16===null||_value16===void 0?void 0:_value16.indexOf('[CDATA['))===0){node.name='#cdata';node.type=4;node.value=dom.decode(_value16.replace(/^\\[CDATA\\[|\\]\\]$/g,''));}else if((_value16===null||_value16===void 0?void 0:_value16.indexOf('mce:protected '))===0){node.name='#text';node.type=3;node.raw=true;node.value=unescape(_value16).substr(14);}}});htmlParser.addNodeFilter('xml:namespace,input',(nodes,name)=>{var i=nodes.length;while(i--){var node=nodes[i];if(node.type===7){node.remove();}else if(node.type===1){if(name==='input'&&!node.attr('type')){node.attr('type','text');}}}});htmlParser.addAttributeFilter('data-mce-type',nodes=>{each$e(nodes,node=>{if(node.attr('data-mce-type')==='format-caret'){if(node.isEmpty(htmlParser.schema.getNonEmptyElements())){node.remove();}else{node.unwrap();}}});});htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,'+'data-mce-selected,data-mce-expando,data-mce-block,'+'data-mce-type,data-mce-resize,data-mce-placeholder',(nodes,name)=>{var i=nodes.length;while(i--){nodes[i].attr(name,null);}});if(settings.remove_trailing_brs){addNodeFilter(settings,htmlParser,htmlParser.schema);}};var trimTrailingBr=rootNode=>{var isBr=node=>{return(node===null||node===void 0?void 0:node.name)==='br';};var brNode1=rootNode.lastChild;if(isBr(brNode1)){var brNode2=brNode1.prev;if(isBr(brNode2)){brNode1.remove();brNode2.remove();}}};var preProcess$1=(editor,node,args)=>{var oldDoc;var dom=editor.dom;var clonedNode=node.cloneNode(true);var impl=document.implementation;if(impl.createHTMLDocument){var doc=impl.createHTMLDocument('');Tools.each(clonedNode.nodeName==='BODY'?clonedNode.childNodes:[clonedNode],node=>{doc.body.appendChild(doc.importNode(node,true));});if(clonedNode.nodeName!=='BODY'){clonedNode=doc.body.firstChild;}else{clonedNode=doc.body;}oldDoc=dom.doc;dom.doc=doc;}firePreProcess(editor,_objectSpread(_objectSpread({},args),{},{node:clonedNode}));if(oldDoc){dom.doc=oldDoc;}return clonedNode;};var shouldFireEvent=(editor,args)=>{return isNonNullable(editor)&&editor.hasEventListeners('PreProcess')&&!args.no_events;};var process$1=(editor,node,args)=>{return shouldFireEvent(editor,args)?preProcess$1(editor,node,args):node;};var addTempAttr=(htmlParser,tempAttrs,name)=>{if(Tools.inArray(tempAttrs,name)===-1){htmlParser.addAttributeFilter(name,(nodes,name)=>{var i=nodes.length;while(i--){nodes[i].attr(name,null);}});tempAttrs.push(name);}};var postProcess=(editor,args,content)=>{if(!args.no_events&&editor){var outArgs=firePostProcess(editor,_objectSpread(_objectSpread({},args),{},{content}));return outArgs.content;}else{return content;}};var getHtmlFromNode=(dom,node,args)=>{var html=trim$1(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html);};var parseHtml=(htmlParser,html,args)=>{var parserArgs=args.selection?_objectSpread({forced_root_block:false},args):args;var rootNode=htmlParser.parse(html,parserArgs);trimTrailingBr(rootNode);return rootNode;};var serializeNode=(settings,schema,node)=>{var htmlSerializer=HtmlSerializer(settings,schema);return htmlSerializer.serialize(node);};var toHtml=(editor,settings,schema,rootNode,args)=>{var content=serializeNode(settings,schema,rootNode);return postProcess(editor,args,content);};var DomSerializerImpl=(settings,editor)=>{var tempAttrs=['data-mce-selected'];var defaultedSettings=_objectSpread({entity_encoding:'named',remove_trailing_brs:true,pad_empty_with_br:false},settings);var dom=editor&&editor.dom?editor.dom:DOMUtils.DOM;var schema=editor&&editor.schema?editor.schema:Schema(defaultedSettings);var htmlParser=DomParser(defaultedSettings,schema);register$3(htmlParser,defaultedSettings,dom);var serialize=function serialize(node){var parserArgs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var args=_objectSpread({format:'html'},parserArgs);var targetNode=process$1(editor,node,args);var html=getHtmlFromNode(dom,targetNode,args);var rootNode=parseHtml(htmlParser,html,args);return args.format==='tree'?rootNode:toHtml(editor,defaultedSettings,schema,rootNode,args);};return{schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:serialize,addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters,removeNodeFilter:htmlParser.removeNodeFilter,removeAttributeFilter:htmlParser.removeAttributeFilter};};var DomSerializer=(settings,editor)=>{var domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters,removeNodeFilter:domSerializer.removeNodeFilter,removeAttributeFilter:domSerializer.removeAttributeFilter};};var defaultFormat$1='html';var setupArgs$1=(args,format)=>_objectSpread(_objectSpread({},args),{},{format,get:true,getInner:true});var getContent=function getContent(editor){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var format=args.format?args.format:defaultFormat$1;var defaultedArgs=setupArgs$1(args,format);return preProcessGetContent(editor,defaultedArgs).fold(identity,updatedArgs=>{var content=getContent$2(editor,updatedArgs);return postProcessGetContent(editor,content,updatedArgs);});};var defaultFormat='html';var setupArgs=(args,content)=>_objectSpread(_objectSpread({format:defaultFormat},args),{},{set:true,content});var setContent=function setContent(editor,content){var args=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var defaultedArgs=setupArgs(args,content);return preProcessSetContent(editor,defaultedArgs).map(updatedArgs=>{var result=setContent$2(editor,updatedArgs.content,updatedArgs);postProcessSetContent(editor,result.html,updatedArgs);return result.content;}).getOr(content);};var removedOptions=('autoresize_on_init,content_editable_state,padd_empty_with_br,block_elements,'+'boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,'+'force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,'+'non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,'+'tab_focus,tabfocus_elements,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,'+'paste_enable_default_filters,paste_filter_drop,paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists').split(',');var deprecatedOptions='template_cdate_classes,template_mdate_classes,template_selected_content_classes,template_preview_replace_values,template_replace_values,templates,template_cdate_format,template_mdate_format'.split(',');var removedPlugins='bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor'.split(',');var deprecatedPlugins=[{name:'template',replacedWith:'Advanced Template'},{name:'rtc'}];var getMatchingOptions=(options,searchingFor)=>{var settingNames=filter$5(searchingFor,setting=>has$2(options,setting));return sort(settingNames);};var getRemovedOptions=options=>{var settingNames=getMatchingOptions(options,removedOptions);var forcedRootBlock=options.forced_root_block;if(forcedRootBlock===false||forcedRootBlock===''){settingNames.push('forced_root_block (false only)');}return sort(settingNames);};var getDeprecatedOptions=options=>getMatchingOptions(options,deprecatedOptions);var getMatchingPlugins=(options,searchingFor)=>{var plugins=Tools.makeMap(options.plugins,' ');var hasPlugin=plugin=>has$2(plugins,plugin);var pluginNames=filter$5(searchingFor,hasPlugin);return sort(pluginNames);};var getRemovedPlugins=options=>getMatchingPlugins(options,removedPlugins);var getDeprecatedPlugins=options=>getMatchingPlugins(options,deprecatedPlugins.map(entry=>entry.name));var logRemovedWarnings=(rawOptions,normalizedOptions)=>{var removedOptions=getRemovedOptions(rawOptions);var removedPlugins=getRemovedPlugins(normalizedOptions);var hasRemovedPlugins=removedPlugins.length>0;var hasRemovedOptions=removedOptions.length>0;var isLegacyMobileTheme=normalizedOptions.theme==='mobile';if(hasRemovedPlugins||hasRemovedOptions||isLegacyMobileTheme){var listJoiner='\\n- ';var themesMessage=isLegacyMobileTheme?\"\\n\\nThemes:\".concat(listJoiner,\"mobile\"):'';var pluginsMessage=hasRemovedPlugins?\"\\n\\nPlugins:\".concat(listJoiner).concat(removedPlugins.join(listJoiner)):'';var optionsMessage=hasRemovedOptions?\"\\n\\nOptions:\".concat(listJoiner).concat(removedOptions.join(listJoiner)):'';console.warn('The following deprecated features are currently enabled and have been removed in TinyMCE 6.0. These features will no longer work and should be removed from the TinyMCE configuration. '+'See https://www.tiny.cloud/docs/tinymce/6/migration-from-5x/ for more information.'+themesMessage+pluginsMessage+optionsMessage);}};var getPluginDescription=name=>find$2(deprecatedPlugins,entry=>entry.name===name).fold(()=>name,entry=>{if(entry.replacedWith){return\"\".concat(name,\", replaced by \").concat(entry.replacedWith);}else{return name;}});var logDeprecatedWarnings=(rawOptions,normalizedOptions)=>{var deprecatedOptions=getDeprecatedOptions(rawOptions);var deprecatedPlugins=getDeprecatedPlugins(normalizedOptions);var hasDeprecatedPlugins=deprecatedPlugins.length>0;var hasDeprecatedOptions=deprecatedOptions.length>0;if(hasDeprecatedPlugins||hasDeprecatedOptions){var listJoiner='\\n- ';var pluginsMessage=hasDeprecatedPlugins?\"\\n\\nPlugins:\".concat(listJoiner).concat(deprecatedPlugins.map(getPluginDescription).join(listJoiner)):'';var optionsMessage=hasDeprecatedOptions?\"\\n\\nOptions:\".concat(listJoiner).concat(deprecatedOptions.join(listJoiner)):'';console.warn('The following deprecated features are currently enabled but will be removed soon.'+pluginsMessage+optionsMessage);}};var logWarnings=(rawOptions,normalizedOptions)=>{logRemovedWarnings(rawOptions,normalizedOptions);logDeprecatedWarnings(rawOptions,normalizedOptions);};var DOM$8=DOMUtils.DOM;var restoreOriginalStyles=editor=>{DOM$8.setStyle(editor.id,'display',editor.orgDisplay);};var safeDestroy=x=>Optional.from(x).each(x=>x.destroy());var clearDomReferences=editor=>{var ed=editor;ed.contentAreaContainer=ed.formElement=ed.container=ed.editorContainer=null;ed.bodyElement=ed.contentDocument=ed.contentWindow=null;ed.iframeElement=ed.targetElm=null;var selection=editor.selection;if(selection){var _dom=selection.dom;ed.selection=selection.win=selection.dom=_dom.doc=null;}};var restoreForm=editor=>{var form=editor.formElement;if(form){if(form._mceOldSubmit){form.submit=form._mceOldSubmit;delete form._mceOldSubmit;}DOM$8.unbind(form,'submit reset',editor.formEventDelegate);}};var remove$1=editor=>{if(!editor.removed){var{_selectionOverrides,editorUpload}=editor;var body=editor.getBody();var element=editor.getElement();if(body){editor.save({is_removing:true});}editor.removed=true;editor.unbindAllNativeEvents();if(editor.hasHiddenInput&&isNonNullable(element===null||element===void 0?void 0:element.nextSibling)){DOM$8.remove(element.nextSibling);}fireRemove(editor);editor.editorManager.remove(editor);if(!editor.inline&&body){restoreOriginalStyles(editor);}fireDetach(editor);DOM$8.remove(editor.getContainer());safeDestroy(_selectionOverrides);safeDestroy(editorUpload);editor.destroy();}};var destroy=(editor,automatic)=>{var{selection,dom}=editor;if(editor.destroyed){return;}if(!automatic&&!editor.removed){editor.remove();return;}if(!automatic){editor.editorManager.off('beforeunload',editor._beforeUnload);if(editor.theme&&editor.theme.destroy){editor.theme.destroy();}safeDestroy(selection);safeDestroy(dom);}restoreForm(editor);clearDomReferences(editor);editor.destroyed=true;};var CreateIconManager=()=>{var lookup={};var add=(id,iconPack)=>{lookup[id]=iconPack;};var get=id=>{if(lookup[id]){return lookup[id];}else{return{icons:{}};}};var has=id=>has$2(lookup,id);return{add,get,has};};var IconManager=CreateIconManager();var ModelManager=AddOnManager.ModelManager;var getProp=(propName,elm)=>{var rawElm=elm.dom;return rawElm[propName];};var getComputedSizeProp=(propName,elm)=>parseInt(get$7(elm,propName),10);var getClientWidth=curry(getProp,'clientWidth');var getClientHeight=curry(getProp,'clientHeight');var getMarginTop=curry(getComputedSizeProp,'margin-top');var getMarginLeft=curry(getComputedSizeProp,'margin-left');var getBoundingClientRect=elm=>elm.dom.getBoundingClientRect();var isInsideElementContentArea=(bodyElm,clientX,clientY)=>{var clientWidth=getClientWidth(bodyElm);var clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight;};var transpose=(inline,elm,clientX,clientY)=>{var clientRect=getBoundingClientRect(elm);var deltaX=inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0;var deltaY=inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0;var x=clientX-deltaX;var y=clientY-deltaY;return{x,y};};var isXYInContentArea=(editor,clientX,clientY)=>{var bodyElm=SugarElement.fromDom(editor.getBody());var targetElm=editor.inline?bodyElm:documentElement(bodyElm);var transposedPoint=transpose(editor.inline,targetElm,clientX,clientY);return isInsideElementContentArea(targetElm,transposedPoint.x,transposedPoint.y);};var fromDomSafe=node=>Optional.from(node).map(SugarElement.fromDom);var isEditorAttachedToDom=editor=>{var rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return fromDomSafe(rawContainer).map(inBody).getOr(false);};var NotificationManagerImpl=()=>{var unimplemented=()=>{throw new Error('Theme did not provide a NotificationManager implementation.');};return{open:unimplemented,close:unimplemented,getArgs:unimplemented};};var NotificationManager=editor=>{var notifications=[];var getImplementation=()=>{var theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():NotificationManagerImpl();};var getTopNotification=()=>{return Optional.from(notifications[0]);};var isEqual=(a,b)=>{return a.type===b.type&&a.text===b.text&&!a.progressBar&&!a.timeout&&!b.progressBar&&!b.timeout;};var reposition=()=>{each$e(notifications,notification=>{notification.reposition();});};var addNotification=notification=>{notifications.push(notification);};var closeNotification=notification=>{findIndex$2(notifications,otherNotification=>{return otherNotification===notification;}).each(index=>{notifications.splice(index,1);});};var open=function open(spec){var fireEvent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(editor.removed||!isEditorAttachedToDom(editor)){return{};}if(fireEvent){editor.dispatch('BeforeOpenNotification',{notification:spec});}return find$2(notifications,notification=>{return isEqual(getImplementation().getArgs(notification),spec);}).getOrThunk(()=>{editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,()=>{closeNotification(notification);reposition();getTopNotification().fold(()=>editor.focus(),top=>focus$1(SugarElement.fromDom(top.getEl())));});addNotification(notification);reposition();editor.dispatch('OpenNotification',{notification:_objectSpread({},notification)});return notification;});};var close=()=>{getTopNotification().each(notification=>{getImplementation().close(notification);closeNotification(notification);reposition();});};var getNotifications=constant(notifications);var registerEvents=editor=>{editor.on('SkinLoaded',()=>{var serviceMessage=getServiceMessage(editor);if(serviceMessage){open({text:serviceMessage,type:'warning',timeout:0},false);}reposition();});editor.on('show ResizeEditor ResizeWindow NodeChange',()=>{requestAnimationFrame(reposition);});editor.on('remove',()=>{each$e(notifications.slice(),notification=>{getImplementation().close(notification);});});};registerEvents(editor);return{open,close,getNotifications};};var PluginManager=AddOnManager.PluginManager;var ThemeManager=AddOnManager.ThemeManager;var WindowManagerImpl=()=>{var unimplemented=()=>{throw new Error('Theme did not provide a WindowManager implementation.');};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented};};var WindowManager=editor=>{var dialogs=[];var getImplementation=()=>{var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():WindowManagerImpl();};var funcBind=(scope,f)=>{return function(){for(var _len13=arguments.length,args=new Array(_len13),_key13=0;_key13<_len13;_key13++){args[_key13]=arguments[_key13];}return f?f.apply(scope,args):undefined;};};var fireOpenEvent=dialog=>{editor.dispatch('OpenWindow',{dialog});};var fireCloseEvent=dialog=>{editor.dispatch('CloseWindow',{dialog});};var addDialog=dialog=>{dialogs.push(dialog);fireOpenEvent(dialog);};var closeDialog=dialog=>{fireCloseEvent(dialog);dialogs=filter$5(dialogs,otherDialog=>{return otherDialog!==dialog;});if(dialogs.length===0){editor.focus();}};var getTopDialog=()=>{return Optional.from(dialogs[dialogs.length-1]);};var storeSelectionAndOpenDialog=openDialog=>{editor.editorManager.setActive(editor);store(editor);editor.ui.show();var dialog=openDialog();addDialog(dialog);return dialog;};var open=(args,params)=>{return storeSelectionAndOpenDialog(()=>getImplementation().open(args,params,closeDialog));};var openUrl=args=>{return storeSelectionAndOpenDialog(()=>getImplementation().openUrl(args,closeDialog));};var alert=(message,callback,scope)=>{var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope?scope:windowManagerImpl,callback));};var confirm=(message,callback,scope)=>{var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope?scope:windowManagerImpl,callback));};var close=()=>{getTopDialog().each(dialog=>{getImplementation().close(dialog);closeDialog(dialog);});};editor.on('remove',()=>{each$e(dialogs,dialog=>{getImplementation().close(dialog);});});return{open,openUrl,alert,confirm,close};};var displayNotification=(editor,message)=>{editor.notificationManager.open({type:'error',text:message});};var displayError=(editor,message)=>{if(editor._skinLoaded){displayNotification(editor,message);}else{editor.on('SkinLoaded',()=>{displayNotification(editor,message);});}};var uploadError=(editor,message)=>{displayError(editor,I18n.translate(['Failed to upload image: {0}',message]));};var logError=(editor,errorType,msg)=>{fireError(editor,errorType,{message:msg});console.error(msg);};var createLoadError=(type,url,name)=>name?\"Failed to load \".concat(type,\": \").concat(name,\" from url \").concat(url):\"Failed to load \".concat(type,\" url: \").concat(url);var pluginLoadError=(editor,url,name)=>{logError(editor,'PluginLoadError',createLoadError('plugin',url,name));};var iconsLoadError=(editor,url,name)=>{logError(editor,'IconsLoadError',createLoadError('icons',url,name));};var languageLoadError=(editor,url,name)=>{logError(editor,'LanguageLoadError',createLoadError('language',url,name));};var themeLoadError=(editor,url,name)=>{logError(editor,'ThemeLoadError',createLoadError('theme',url,name));};var modelLoadError=(editor,url,name)=>{logError(editor,'ModelLoadError',createLoadError('model',url,name));};var pluginInitError=(editor,name,err)=>{var message=I18n.translate(['Failed to initialize plugin: {0}',name]);fireError(editor,'PluginLoadError',{message});initError(message,err);displayError(editor,message);};var initError=function initError(message){var console=window.console;if(console){for(var _len14=arguments.length,x=new Array(_len14>1?_len14-1:0),_key14=1;_key14<_len14;_key14++){x[_key14-1]=arguments[_key14];}if(console.error){console.error(message,...x);}else{console.log(message,...x);}}};var isContentCssSkinName=url=>/^[a-z0-9\\-]+$/i.test(url);var getContentCssUrls=editor=>{return transformToUrls(editor,getContentCss(editor));};var getFontCssUrls=editor=>{return transformToUrls(editor,getFontCss(editor));};var transformToUrls=(editor,cssLinks)=>{var skinUrl=editor.editorManager.baseURL+'/skins/content';var suffix=editor.editorManager.suffix;var contentCssFile=\"content\".concat(suffix,\".css\");return map$3(cssLinks,url=>{if(isContentCssSkinName(url)&&!editor.inline){return\"\".concat(skinUrl,\"/\").concat(url,\"/\").concat(contentCssFile);}else{return editor.documentBaseURI.toAbsolute(url);}});};var appendContentCssFromSettings=editor=>{editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),getFontCssUrls(editor));};var getAllImages=elm=>{return elm?from(elm.getElementsByTagName('img')):[];};var ImageScanner=(uploadStatus,blobCache)=>{var cachedPromises={};var findAll=function findAll(elm){var predicate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:always;var images=filter$5(getAllImages(elm),img=>{var src=img.src;if(img.hasAttribute('data-mce-bogus')){return false;}if(img.hasAttribute('data-mce-placeholder')){return false;}if(!src||src===Env.transparentSrc){return false;}if(startsWith(src,'blob:')){return!uploadStatus.isUploaded(src)&&predicate(img);}if(startsWith(src,'data:')){return predicate(img);}return false;});var promises=map$3(images,img=>{var imageSrc=img.src;if(has$2(cachedPromises,imageSrc)){return cachedPromises[imageSrc].then(imageInfo=>{if(isString(imageInfo)){return imageInfo;}else{return{image:img,blobInfo:imageInfo.blobInfo};}});}else{var newPromise=imageToBlobInfo(blobCache,imageSrc).then(blobInfo=>{delete cachedPromises[imageSrc];return{image:img,blobInfo};}).catch(error=>{delete cachedPromises[imageSrc];return error;});cachedPromises[imageSrc]=newPromise;return newPromise;}});return Promise.all(promises);};return{findAll};};var UploadStatus=()=>{var PENDING=1,UPLOADED=2;var blobUriStatuses={};var createStatus=(status,resultUri)=>{return{status,resultUri};};var hasBlobUri=blobUri=>{return blobUri in blobUriStatuses;};var getResultUri=blobUri=>{var result=blobUriStatuses[blobUri];return result?result.resultUri:null;};var isPending=blobUri=>{return hasBlobUri(blobUri)?blobUriStatuses[blobUri].status===PENDING:false;};var isUploaded=blobUri=>{return hasBlobUri(blobUri)?blobUriStatuses[blobUri].status===UPLOADED:false;};var markPending=blobUri=>{blobUriStatuses[blobUri]=createStatus(PENDING,null);};var markUploaded=(blobUri,resultUri)=>{blobUriStatuses[blobUri]=createStatus(UPLOADED,resultUri);};var removeFailed=blobUri=>{delete blobUriStatuses[blobUri];};var destroy=()=>{blobUriStatuses={};};return{hasBlobUri,getResultUri,isPending,isUploaded,markPending,markUploaded,removeFailed,destroy};};var count=0;var seed=()=>{var rnd=()=>{return Math.round(Math.random()*4294967295).toString(36);};var now=new Date().getTime();return's'+now.toString(36)+rnd()+rnd()+rnd();};var uuid=prefix=>{return prefix+count++ +seed();};var BlobCache=()=>{var cache=[];var mimeToExt=mime=>{var mimes={'image/jpeg':'jpg','image/jpg':'jpg','image/gif':'gif','image/png':'png','image/apng':'apng','image/avif':'avif','image/svg+xml':'svg','image/webp':'webp','image/bmp':'bmp','image/tiff':'tiff'};return mimes[mime.toLowerCase()]||'dat';};var create=(o,blob,base64,name,filename)=>{if(isString(o)){var id=o;return toBlobInfo({id,name,filename,blob:blob,base64:base64});}else if(isObject(o)){return toBlobInfo(o);}else{throw new Error('Unknown input type');}};var toBlobInfo=o=>{if(!o.blob||!o.base64){throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');}var id=o.id||uuid('blobid');var name=o.name||id;var blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+'.'+mimeToExt(blob.type)),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)};};var add=blobInfo=>{if(!get(blobInfo.id())){cache.push(blobInfo);}};var findFirst=predicate=>find$2(cache,predicate).getOrUndefined();var get=id=>findFirst(cachedBlobInfo=>cachedBlobInfo.id()===id);var getByUri=blobUri=>findFirst(blobInfo=>blobInfo.blobUri()===blobUri);var getByData=(base64,type)=>findFirst(blobInfo=>blobInfo.base64()===base64&&blobInfo.blob().type===type);var removeByUri=blobUri=>{cache=filter$5(cache,blobInfo=>{if(blobInfo.blobUri()===blobUri){URL.revokeObjectURL(blobInfo.blobUri());return false;}return true;});};var destroy=()=>{each$e(cache,cachedBlobInfo=>{URL.revokeObjectURL(cachedBlobInfo.blobUri());});cache=[];};return{create,add,get,getByUri,getByData,findFirst,removeByUri,destroy};};var Uploader=(uploadStatus,settings)=>{var pendingPromises={};var pathJoin=(path1,path2)=>{if(path1){return path1.replace(/\\/$/,'')+'/'+path2.replace(/^\\//,'');}return path2;};var defaultHandler=(blobInfo,progress)=>new Promise((success,failure)=>{var xhr=new XMLHttpRequest();xhr.open('POST',settings.url);xhr.withCredentials=settings.credentials;xhr.upload.onprogress=e=>{progress(e.loaded/e.total*100);};xhr.onerror=()=>{failure('Image upload failed due to a XHR Transport error. Code: '+xhr.status);};xhr.onload=()=>{if(xhr.status<200||xhr.status>=300){failure('HTTP Error: '+xhr.status);return;}var json=JSON.parse(xhr.responseText);if(!json||!isString(json.location)){failure('Invalid JSON: '+xhr.responseText);return;}success(pathJoin(settings.basePath,json.location));};var formData=new FormData();formData.append('file',blobInfo.blob(),blobInfo.filename());xhr.send(formData);});var uploadHandler=isFunction(settings.handler)?settings.handler:defaultHandler;var noUpload=()=>new Promise(resolve=>{resolve([]);});var handlerSuccess=(blobInfo,url)=>({url,blobInfo,status:true});var handlerFailure=(blobInfo,error)=>({url:'',blobInfo,status:false,error});var resolvePending=(blobUri,result)=>{Tools.each(pendingPromises[blobUri],resolve=>{resolve(result);});delete pendingPromises[blobUri];};var uploadBlobInfo=(blobInfo,handler,openNotification)=>{uploadStatus.markPending(blobInfo.blobUri());return new Promise(resolve=>{var notification;var progress;try{var closeNotification=()=>{if(notification){notification.close();progress=noop;}};var success=url=>{closeNotification();uploadStatus.markUploaded(blobInfo.blobUri(),url);resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url));resolve(handlerSuccess(blobInfo,url));};var failure=error=>{closeNotification();uploadStatus.removeFailed(blobInfo.blobUri());resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error));resolve(handlerFailure(blobInfo,error));};progress=percent=>{if(percent<0||percent>100){return;}Optional.from(notification).orThunk(()=>Optional.from(openNotification).map(apply$1)).each(n=>{notification=n;n.progressBar.value(percent);});};handler(blobInfo,progress).then(success,err=>{failure(isString(err)?{message:err}:err);});}catch(ex){resolve(handlerFailure(blobInfo,ex));}});};var isDefaultHandler=handler=>handler===defaultHandler;var pendingUploadBlobInfo=blobInfo=>{var blobUri=blobInfo.blobUri();return new Promise(resolve=>{pendingPromises[blobUri]=pendingPromises[blobUri]||[];pendingPromises[blobUri].push(resolve);});};var uploadBlobs=(blobInfos,openNotification)=>{blobInfos=Tools.grep(blobInfos,blobInfo=>!uploadStatus.isUploaded(blobInfo.blobUri()));return Promise.all(Tools.map(blobInfos,blobInfo=>uploadStatus.isPending(blobInfo.blobUri())?pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,uploadHandler,openNotification)));};var upload=(blobInfos,openNotification)=>!settings.url&&isDefaultHandler(uploadHandler)?noUpload():uploadBlobs(blobInfos,openNotification);return{upload};};var openNotification=editor=>()=>editor.notificationManager.open({text:editor.translate('Image uploading...'),type:'info',timeout:-1,progressBar:true});var createUploader=(editor,uploadStatus)=>Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)});var ImageUploader=editor=>{var uploadStatus=UploadStatus();var uploader=createUploader(editor,uploadStatus);return{upload:function upload(blobInfos){var showNotification=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return uploader.upload(blobInfos,showNotification?openNotification(editor):undefined);}};};var isEmptyForPadding=(editor,element)=>editor.dom.isEmpty(element.dom)&&isNonNullable(editor.schema.getTextBlockElements()[name(element)]);var addPaddingToEmpty=editor=>element=>{if(isEmptyForPadding(editor,element)){append$1(element,SugarElement.fromHtml('<br data-mce-bogus=\"1\" />'));}};var EditorUpload=editor=>{var blobCache=BlobCache();var uploader,imageScanner;var uploadStatus=UploadStatus();var urlFilters=[];var aliveGuard=callback=>{return result=>{if(editor.selection){return callback(result);}return[];};};var cacheInvalidator=url=>url+(url.indexOf('?')===-1?'?':'&')+new Date().getTime();var replaceString=(content,search,replace)=>{var index=0;do{index=content.indexOf(search,index);if(index!==-1){content=content.substring(0,index)+replace+content.substr(index+search.length);index+=replace.length-search.length+1;}}while(index!==-1);return content;};var replaceImageUrl=(content,targetUrl,replacementUrl)=>{var replacementString=\"src=\\\"\".concat(replacementUrl,\"\\\"\").concat(replacementUrl===Env.transparentSrc?' data-mce-placeholder=\"1\"':'');content=replaceString(content,\"src=\\\"\".concat(targetUrl,\"\\\"\"),replacementString);content=replaceString(content,'data-mce-src=\"'+targetUrl+'\"','data-mce-src=\"'+replacementUrl+'\"');return content;};var replaceUrlInUndoStack=(targetUrl,replacementUrl)=>{each$e(editor.undoManager.data,level=>{if(level.type==='fragmented'){level.fragments=map$3(level.fragments,fragment=>replaceImageUrl(fragment,targetUrl,replacementUrl));}else{level.content=replaceImageUrl(level.content,targetUrl,replacementUrl);}});};var replaceImageUriInView=(image,resultUri)=>{var src=editor.convertURL(resultUri,'src');replaceUrlInUndoStack(image.src,resultUri);setAll$1(SugarElement.fromDom(image),{'src':shouldReuseFileName(editor)?cacheInvalidator(resultUri):resultUri,'data-mce-src':src});};var uploadImages=()=>{if(!uploader){uploader=createUploader(editor,uploadStatus);}return scanForImages().then(aliveGuard(imageInfos=>{var blobInfos=map$3(imageInfos,imageInfo=>imageInfo.blobInfo);return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard(result=>{var imagesToRemove=[];var shouldDispatchChange=false;var filteredResult=map$3(result,(uploadInfo,index)=>{var{blobInfo,image}=imageInfos[index];var removed=false;if(uploadInfo.status&&shouldReplaceBlobUris(editor)){if(uploadInfo.url&&!contains$1(image.src,uploadInfo.url)){shouldDispatchChange=true;}blobCache.removeByUri(image.src);if(isRtc(editor));else{replaceImageUriInView(image,uploadInfo.url);}}else if(uploadInfo.error){if(uploadInfo.error.remove){replaceUrlInUndoStack(image.src,Env.transparentSrc);imagesToRemove.push(image);removed=true;}uploadError(editor,uploadInfo.error.message);}return{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo,removed};});if(imagesToRemove.length>0&&!isRtc(editor)){editor.undoManager.transact(()=>{each$e(fromDom$1(imagesToRemove),sugarElement=>{var parentOpt=parent(sugarElement);remove$5(sugarElement);parentOpt.each(addPaddingToEmpty(editor));blobCache.removeByUri(sugarElement.dom.src);});});}else if(shouldDispatchChange){editor.undoManager.dispatchChange();}return filteredResult;}));}));};var uploadImagesAuto=()=>isAutomaticUploadsEnabled(editor)?uploadImages():Promise.resolve([]);var isValidDataUriImage=imgElm=>forall(urlFilters,filter=>filter(imgElm));var addFilter=filter=>{urlFilters.push(filter);};var scanForImages=()=>{if(!imageScanner){imageScanner=ImageScanner(uploadStatus,blobCache);}return imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard(result=>{var filteredResult=filter$5(result,resultItem=>{if(isString(resultItem)){displayError(editor,resultItem);return false;}else if(resultItem.uriType==='blob'){return false;}else{return true;}});if(isRtc(editor));else{each$e(filteredResult,resultItem=>{replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri());resultItem.image.src=resultItem.blobInfo.blobUri();resultItem.image.removeAttribute('data-mce-src');});}return filteredResult;}));};var destroy=()=>{blobCache.destroy();uploadStatus.destroy();imageScanner=uploader=null;};var replaceBlobUris=content=>{return content.replace(/src=\"(blob:[^\"]+)\"/g,(match,blobUri)=>{var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri){return'src=\"'+resultUri+'\"';}var blobInfo=blobCache.getByUri(blobUri);if(!blobInfo){blobInfo=foldl(editor.editorManager.get(),(result,editor)=>{return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri);},undefined);}if(blobInfo){var blob=blobInfo.blob();return'src=\"data:'+blob.type+';base64,'+blobInfo.base64()+'\"';}return match;});};editor.on('SetContent',()=>{if(isAutomaticUploadsEnabled(editor)){uploadImagesAuto();}else{scanForImages();}});editor.on('RawSaveContent',e=>{e.content=replaceBlobUris(e.content);});editor.on('GetContent',e=>{if(e.source_view||e.format==='raw'||e.format==='tree'){return;}e.content=replaceBlobUris(e.content);});editor.on('PostRender',()=>{editor.parser.addNodeFilter('img',images=>{each$e(images,img=>{var src=img.attr('src');if(!src||blobCache.getByUri(src)){return;}var resultUri=uploadStatus.getResultUri(src);if(resultUri){img.attr('src',resultUri);}});});});return{blobCache,addFilter,uploadImages,uploadImagesAuto,scanForImages,destroy};};var get$1=editor=>{var dom=editor.dom;var schemaType=editor.schema.type;var formats={valigntop:[{selector:'td,th',styles:{verticalAlign:'top'}}],valignmiddle:[{selector:'td,th',styles:{verticalAlign:'middle'}}],valignbottom:[{selector:'td,th',styles:{verticalAlign:'bottom'}}],alignleft:[{selector:'figure.image',collapsed:false,classes:'align-left',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'left'},inherit:false,preview:false},{selector:'img,audio,video',collapsed:false,styles:{float:'left'},preview:'font-family font-size'},{selector:'table',collapsed:false,styles:{marginLeft:'0px',marginRight:'auto'},onformat:table=>{dom.setStyle(table,'float',null);},preview:'font-family font-size'},{selector:'.mce-preview-object,[data-ephox-embed-iri]',ceFalseOverride:true,styles:{float:'left'}}],aligncenter:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'center'},inherit:false,preview:'font-family font-size'},{selector:'figure.image',collapsed:false,classes:'align-center',ceFalseOverride:true,preview:'font-family font-size'},{selector:'img,audio,video',collapsed:false,styles:{display:'block',marginLeft:'auto',marginRight:'auto'},preview:false},{selector:'table',collapsed:false,styles:{marginLeft:'auto',marginRight:'auto'},preview:'font-family font-size'},{selector:'.mce-preview-object',ceFalseOverride:true,styles:{display:'table',marginLeft:'auto',marginRight:'auto'},preview:false},{selector:'[data-ephox-embed-iri]',ceFalseOverride:true,styles:{marginLeft:'auto',marginRight:'auto'},preview:false}],alignright:[{selector:'figure.image',collapsed:false,classes:'align-right',ceFalseOverride:true,preview:'font-family font-size'},{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'right'},inherit:false,preview:'font-family font-size'},{selector:'img,audio,video',collapsed:false,styles:{float:'right'},preview:'font-family font-size'},{selector:'table',collapsed:false,styles:{marginRight:'0px',marginLeft:'auto'},onformat:table=>{dom.setStyle(table,'float',null);},preview:'font-family font-size'},{selector:'.mce-preview-object,[data-ephox-embed-iri]',ceFalseOverride:true,styles:{float:'right'},preview:false}],alignjustify:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre',styles:{textAlign:'justify'},inherit:false,preview:'font-family font-size'}],bold:[{inline:'strong',remove:'all',preserve_attributes:['class','style']},{inline:'span',styles:{fontWeight:'bold'}},{inline:'b',remove:'all',preserve_attributes:['class','style']}],italic:[{inline:'em',remove:'all',preserve_attributes:['class','style']},{inline:'span',styles:{fontStyle:'italic'}},{inline:'i',remove:'all',preserve_attributes:['class','style']}],underline:[{inline:'span',styles:{textDecoration:'underline'},exact:true},{inline:'u',remove:'all',preserve_attributes:['class','style']}],strikethrough:(()=>{var span={inline:'span',styles:{textDecoration:'line-through'},exact:true};var strike={inline:'strike',remove:'all',preserve_attributes:['class','style']};var s={inline:'s',remove:'all',preserve_attributes:['class','style']};return schemaType!=='html4'?[s,span,strike]:[span,s,strike];})(),forecolor:{inline:'span',styles:{color:'%value'},links:true,remove_similar:true,clear_child_styles:true},hilitecolor:{inline:'span',styles:{backgroundColor:'%value'},links:true,remove_similar:true,clear_child_styles:true},fontname:{inline:'span',toggle:false,styles:{fontFamily:'%value'},clear_child_styles:true},fontsize:{inline:'span',toggle:false,styles:{fontSize:'%value'},clear_child_styles:true},lineheight:{selector:'h1,h2,h3,h4,h5,h6,p,li,td,th,div',styles:{lineHeight:'%value'}},fontsize_class:{inline:'span',attributes:{class:'%value'}},blockquote:{block:'blockquote',wrapper:true,remove:'all'},subscript:{inline:'sub'},superscript:{inline:'sup'},code:{inline:'code'},link:{inline:'a',selector:'a',remove:'all',split:true,deep:true,onmatch:(node,_fmt,_itemName)=>{return isElement$6(node)&&node.hasAttribute('href');},onformat:(elm,_fmt,vars)=>{Tools.each(vars,(value,key)=>{dom.setAttrib(elm,key,value);});}},lang:{inline:'span',clear_child_styles:true,remove_similar:true,attributes:{'lang':'%value','data-mce-lang':vars=>{var _a;return(_a=vars===null||vars===void 0?void 0:vars.customValue)!==null&&_a!==void 0?_a:null;}}},removeformat:[{selector:'b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small',remove:'all',split:true,expand:false,block_expand:true,deep:true},{selector:'span',attributes:['style','class'],remove:'empty',split:true,expand:false,deep:true},{selector:'*',attributes:['style','class'],split:false,expand:false,deep:true}]};Tools.each('p h1 h2 h3 h4 h5 h6 div address pre dt dd samp'.split(/\\s/),name=>{formats[name]={block:name,remove:'all'};});return formats;};var genericBase={remove_similar:true,inherit:false};var cellBase=_objectSpread({selector:'td,th'},genericBase);var cellFormats={tablecellbackgroundcolor:_objectSpread({styles:{backgroundColor:'%value'}},cellBase),tablecellverticalalign:_objectSpread({styles:{'vertical-align':'%value'}},cellBase),tablecellbordercolor:_objectSpread({styles:{borderColor:'%value'}},cellBase),tablecellclass:_objectSpread({classes:['%value']},cellBase),tableclass:_objectSpread({selector:'table',classes:['%value']},genericBase),tablecellborderstyle:_objectSpread({styles:{borderStyle:'%value'}},cellBase),tablecellborderwidth:_objectSpread({styles:{borderWidth:'%value'}},cellBase)};var get=constant(cellFormats);var FormatRegistry=editor=>{var formats={};var get$2=name=>isNonNullable(name)?formats[name]:formats;var has=name=>has$2(formats,name);var register=(name,format)=>{if(name){if(!isString(name)){each$d(name,(format,name)=>{register(name,format);});}else{if(!isArray$1(format)){format=[format];}each$e(format,format=>{if(isUndefined(format.deep)){format.deep=!isSelectorFormat(format);}if(isUndefined(format.split)){format.split=!isSelectorFormat(format)||isInlineFormat(format);}if(isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)){format.remove='none';}if(isSelectorFormat(format)&&isInlineFormat(format)){format.mixed=true;format.block_expand=true;}if(isString(format.classes)){format.classes=format.classes.split(/\\s+/);}});formats[name]=format;}}};var unregister=name=>{if(name&&formats[name]){delete formats[name];}return formats;};register(get$1(editor));register(get());register(getFormats(editor));return{get:get$2,has,register,unregister};};var each$3=Tools.each;var dom=DOMUtils.DOM;var isPreviewItem=item=>isNonNullable(item)&&isObject(item);var parsedSelectorToHtml=(ancestry,editor)=>{var schema=editor&&editor.schema||Schema({});var decorate=(elm,item)=>{if(item.classes.length>0){dom.addClass(elm,item.classes.join(' '));}dom.setAttribs(elm,item.attrs);};var createElement=sItem=>{var item=isString(sItem)?{name:sItem,classes:[],attrs:{}}:sItem;var elm=dom.create(item.name);decorate(elm,item);return elm;};var getRequiredParent=(elm,candidate)=>{var elmRule=schema.getElementRule(elm.nodeName.toLowerCase());var parentsRequired=elmRule===null||elmRule===void 0?void 0:elmRule.parentsRequired;if(parentsRequired&&parentsRequired.length){return candidate&&contains$2(parentsRequired,candidate)?candidate:parentsRequired[0];}else{return false;}};var wrapInHtml=(elm,ancestors,siblings)=>{var parentCandidate;var ancestor=ancestors[0];var ancestorName=isPreviewItem(ancestor)?ancestor.name:undefined;var parentRequired=getRequiredParent(elm,ancestorName);if(parentRequired){if(ancestorName===parentRequired){parentCandidate=ancestor;ancestors=ancestors.slice(1);}else{parentCandidate=parentRequired;}}else if(ancestor){parentCandidate=ancestor;ancestors=ancestors.slice(1);}else if(!siblings){return elm;}var parent=parentCandidate?createElement(parentCandidate):dom.create('div');parent.appendChild(elm);if(siblings){Tools.each(siblings,sibling=>{var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm);});}var parentSiblings=isPreviewItem(parentCandidate)?parentCandidate.siblings:undefined;return wrapInHtml(parent,ancestors,parentSiblings);};var fragment=dom.create('div');if(ancestry.length>0){var item=ancestry[0];var elm=createElement(item);var _siblings2=isPreviewItem(item)?item.siblings:undefined;fragment.appendChild(wrapInHtml(elm,ancestry.slice(1),_siblings2));}return fragment;};var parseSelectorItem=item=>{item=Tools.trim(item);var tagName='div';var obj={name:tagName,classes:[],attrs:{},selector:item};if(item!=='*'){tagName=item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g,($0,$1,$2,$3,$4)=>{switch($1){case'#':obj.attrs.id=$2;break;case'.':obj.classes.push($2);break;case':':if(Tools.inArray('checked disabled enabled read-only required'.split(' '),$2)!==-1){obj.attrs[$2]=$2;}break;}if($3==='['){var m=$4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);if(m){obj.attrs[m[1]]=m[2];}}return'';});}obj.name=tagName||'div';return obj;};var parseSelector=selector=>{if(!isString(selector)){return[];}selector=selector.split(/\\s*,\\s*/)[0];selector=selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g,'$1');return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/),item=>{var siblings=Tools.map(item.split(/(?:~\\+|~|\\+)/),parseSelectorItem);var obj=siblings.pop();if(siblings.length){obj.siblings=siblings;}return obj;}).reverse();};var getCssText=(editor,format)=>{var previewCss='';var previewStyles=getPreviewStyles(editor);if(previewStyles===''){return'';}var removeVars=val=>{return isString(val)?val.replace(/%(\\w+)/g,''):'';};var getComputedStyle=(name,elm)=>{return dom.getStyle(elm!==null&&elm!==void 0?elm:editor.getBody(),name,true);};if(isString(format)){var formats=editor.formatter.get(format);if(!formats){return'';}format=formats[0];}if('preview'in format){var preview=format.preview;if(preview===false){return'';}else{previewStyles=preview||previewStyles;}}var name=format.block||format.inline||'span';var previewFrag;var items=parseSelector(format.selector);if(items.length>0){if(!items[0].name){items[0].name=name;}name=format.selector;previewFrag=parsedSelectorToHtml(items,editor);}else{previewFrag=parsedSelectorToHtml([name],editor);}var previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;each$3(format.styles,(value,name)=>{var newValue=removeVars(value);if(newValue){dom.setStyle(previewElm,name,newValue);}});each$3(format.attributes,(value,name)=>{var newValue=removeVars(value);if(newValue){dom.setAttrib(previewElm,name,newValue);}});each$3(format.classes,value=>{var newValue=removeVars(value);if(!dom.hasClass(previewElm,newValue)){dom.addClass(previewElm,newValue);}});editor.dispatch('PreviewFormats');dom.setStyles(previewFrag,{position:'absolute',left:-65535});editor.getBody().appendChild(previewFrag);var rawParentFontSize=getComputedStyle('fontSize');var parentFontSize=/px$/.test(rawParentFontSize)?parseInt(rawParentFontSize,10):0;each$3(previewStyles.split(' '),name=>{var value=getComputedStyle(name,previewElm);if(name==='background-color'&&/transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)){value=getComputedStyle(name);if(rgbaToHexString(value).toLowerCase()==='#ffffff'){return;}}if(name==='color'){if(rgbaToHexString(value).toLowerCase()==='#000000'){return;}}if(name==='font-size'){if(/em|%$/.test(value)){if(parentFontSize===0){return;}var numValue=parseFloat(value)/(/%$/.test(value)?100:1);value=numValue*parentFontSize+'px';}}if(name==='border'&&value){previewCss+='padding:0 2px;';}previewCss+=name+':'+value+';';});editor.dispatch('AfterPreviewFormats');dom.remove(previewFrag);return previewCss;};var setup$r=editor=>{editor.addShortcut('meta+b','','Bold');editor.addShortcut('meta+i','','Italic');editor.addShortcut('meta+u','','Underline');for(var i=1;i<=6;i++){editor.addShortcut('access+'+i,'',['FormatBlock',false,'h'+i]);}editor.addShortcut('access+7','',['FormatBlock',false,'p']);editor.addShortcut('access+8','',['FormatBlock',false,'div']);editor.addShortcut('access+9','',['FormatBlock',false,'address']);};var Formatter=editor=>{var formats=FormatRegistry(editor);var formatChangeState=Cell({});setup$r(editor);setup$u(editor);if(!isRtc(editor)){setup$t(formatChangeState,editor);}return{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:(name,vars,node)=>{applyFormat(editor,name,vars,node);},remove:(name,vars,node,similar)=>{removeFormat(editor,name,vars,node,similar);},toggle:(name,vars,node)=>{toggleFormat(editor,name,vars,node);},match:(name,vars,node,similar)=>matchFormat(editor,name,vars,node,similar),closest:names=>closestFormat(editor,names),matchAll:(names,vars)=>matchAllFormats(editor,names,vars),matchNode:(node,name,vars,similar)=>matchNodeFormat(editor,node,name,vars,similar),canApply:name=>canApplyFormat(editor,name),formatChanged:(formats,callback,similar,vars)=>_formatChanged(editor,formatChangeState,formats,callback,similar,vars),getCssText:curry(getCssText,editor)};};var shouldIgnoreCommand=cmd=>{switch(cmd.toLowerCase()){case'undo':case'redo':case'mcefocus':return true;default:return false;}};var registerEvents=(editor,undoManager,locks)=>{var isFirstTypedCharacter=Cell(false);var addNonTypingUndoLevel=e=>{setTyping(undoManager,false,locks);undoManager.add({},e);};editor.on('init',()=>{undoManager.add();});editor.on('BeforeExecCommand',e=>{var cmd=e.command;if(!shouldIgnoreCommand(cmd)){endTyping(undoManager,locks);undoManager.beforeChange();}});editor.on('ExecCommand',e=>{var cmd=e.command;if(!shouldIgnoreCommand(cmd)){addNonTypingUndoLevel(e);}});editor.on('ObjectResizeStart cut',()=>{undoManager.beforeChange();});editor.on('SaveContent ObjectResized blur',addNonTypingUndoLevel);editor.on('dragend',addNonTypingUndoLevel);editor.on('keyup',e=>{var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}var isMeta=Env.os.isMacOS()&&e.key==='Meta';if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode===45||e.ctrlKey||isMeta){addNonTypingUndoLevel();editor.nodeChanged();}if(keyCode===46||keyCode===8){editor.nodeChanged();}if(isFirstTypedCharacter.get()&&undoManager.typing&&!isEq$1(createFromEditor(editor),undoManager.data[0])){if(!editor.isDirty()){editor.setDirty(true);}editor.dispatch('TypingUndo');isFirstTypedCharacter.set(false);editor.nodeChanged();}});editor.on('keydown',e=>{var keyCode=e.keyCode;if(e.isDefaultPrevented()){return;}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode===45){if(undoManager.typing){addNonTypingUndoLevel(e);}return;}var modKey=e.ctrlKey&&!e.altKey||e.metaKey;if((keyCode<16||keyCode>20)&&keyCode!==224&&keyCode!==91&&!undoManager.typing&&!modKey){undoManager.beforeChange();setTyping(undoManager,true,locks);undoManager.add({},e);isFirstTypedCharacter.set(true);return;}var hasOnlyMetaOrCtrlModifier=Env.os.isMacOS()?e.metaKey:e.ctrlKey&&!e.altKey;if(hasOnlyMetaOrCtrlModifier){undoManager.beforeChange();}});editor.on('mousedown',e=>{if(undoManager.typing){addNonTypingUndoLevel(e);}});var isInsertReplacementText=event=>event.inputType==='insertReplacementText';var isInsertTextDataNull=event=>event.inputType==='insertText'&&event.data===null;var isInsertFromPasteOrDrop=event=>event.inputType==='insertFromPaste'||event.inputType==='insertFromDrop';editor.on('input',e=>{if(e.inputType&&(isInsertReplacementText(e)||isInsertTextDataNull(e)||isInsertFromPasteOrDrop(e))){addNonTypingUndoLevel(e);}});editor.on('AddUndo Undo Redo ClearUndos',e=>{if(!e.isDefaultPrevented()){editor.nodeChanged();}});};var addKeyboardShortcuts=editor=>{editor.addShortcut('meta+z','','Undo');editor.addShortcut('meta+y,meta+shift+z','','Redo');};var UndoManager=editor=>{var beforeBookmark=value$2();var locks=Cell(0);var index=Cell(0);var undoManager={data:[],typing:false,beforeChange:()=>{_beforeChange(editor,locks,beforeBookmark);},add:(level,event)=>{return addUndoLevel(editor,undoManager,index,locks,beforeBookmark,level,event);},dispatchChange:()=>{editor.setDirty(true);var level=createFromEditor(editor);level.bookmark=getUndoBookmark(editor.selection);editor.dispatch('change',{level,lastLevel:get$b(undoManager.data,index.get()).getOrUndefined()});},undo:()=>{return _undo(editor,undoManager,locks,index);},redo:()=>{return _redo(editor,index,undoManager.data);},clear:()=>{_clear(editor,undoManager,index);},reset:()=>{_reset(editor,undoManager);},hasUndo:()=>{return _hasUndo(editor,undoManager,index);},hasRedo:()=>{return _hasRedo(editor,undoManager,index);},transact:callback=>{return _transact(editor,undoManager,locks,callback);},ignore:callback=>{_ignore(editor,locks,callback);},extra:(callback1,callback2)=>{_extra(editor,undoManager,index,callback1,callback2);}};if(!isRtc(editor)){registerEvents(editor,undoManager,locks);}addKeyboardShortcuts(editor);return undoManager;};var nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]);var placeholderAttr='data-mce-placeholder';var isKeyboardEvent=e=>e.type==='keydown'||e.type==='keyup';var isDeleteEvent=e=>{var keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE;};var isNonTypingKeyboardEvent=e=>{if(isKeyboardEvent(e)){var keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains$2(nonTypingKeycodes,keyCode));}else{return false;}};var isTypingKeyboardEvent=e=>isKeyboardEvent(e)&&!(isDeleteEvent(e)||e.type==='keyup'&&e.keyCode===229);var isVisuallyEmpty=(dom,rootElm,forcedRootBlock)=>{if(isEmpty$2(SugarElement.fromDom(rootElm),false)){var _firstElement=rootElm.firstElementChild;if(!_firstElement){return true;}else if(dom.getStyle(rootElm.firstElementChild,'padding-left')||dom.getStyle(rootElm.firstElementChild,'padding-right')){return false;}else{return forcedRootBlock===_firstElement.nodeName.toLowerCase();}}else{return false;}};var setup$q=editor=>{var _a;var dom=editor.dom;var rootBlock=getForcedRootBlock(editor);var placeholder=(_a=getPlaceholder(editor))!==null&&_a!==void 0?_a:'';var updatePlaceholder=(e,initial)=>{if(isNonTypingKeyboardEvent(e)){return;}var body=editor.getBody();var showPlaceholder=isTypingKeyboardEvent(e)?false:isVisuallyEmpty(dom,body,rootBlock);var isPlaceholderShown=dom.getAttrib(body,placeholderAttr)!=='';if(isPlaceholderShown!==showPlaceholder||initial){dom.setAttrib(body,placeholderAttr,showPlaceholder?placeholder:null);dom.setAttrib(body,'aria-placeholder',showPlaceholder?placeholder:null);firePlaceholderToggle(editor,showPlaceholder);editor.on(showPlaceholder?'keydown':'keyup',updatePlaceholder);editor.off(showPlaceholder?'keyup':'keydown',updatePlaceholder);}};if(isNotEmpty(placeholder)){editor.on('init',e=>{updatePlaceholder(e,true);editor.on('change SetContent ExecCommand',updatePlaceholder);editor.on('paste',e=>Delay.setEditorTimeout(editor,()=>updatePlaceholder(e)));});}};var blockPosition=(block,position)=>({block,position});var blockBoundary=(from,to)=>({from,to});var getBlockPosition=(rootNode,pos)=>{var rootElm=SugarElement.fromDom(rootNode);var containerElm=SugarElement.fromDom(pos.container());return getParentBlock$2(rootElm,containerElm).map(block=>blockPosition(block,pos));};var isDifferentBlocks=blockBoundary=>!eq(blockBoundary.from.block,blockBoundary.to.block);var getClosestHost=(root,scope)=>{var isRoot=node=>eq(node,root);var isHost=node=>isTableCell$2(node)||isContentEditableTrue$3(node.dom);return closest$4(scope,isHost,isRoot).filter(isElement$7).getOr(root);};var hasSameHost=(rootNode,blockBoundary)=>{var root=SugarElement.fromDom(rootNode);return eq(getClosestHost(root,blockBoundary.from.block),getClosestHost(root,blockBoundary.to.block));};var isEditable$1=blockBoundary=>isContentEditableFalse$b(blockBoundary.from.block.dom)===false&&isContentEditableFalse$b(blockBoundary.to.block.dom)===false;var hasValidBlocks=blockBoundary=>{var isValidBlock=block=>isTextBlock$2(block)||hasBlockAttr(block.dom);return isValidBlock(blockBoundary.from.block)&&isValidBlock(blockBoundary.to.block);};var skipLastBr=(rootNode,forward,blockPosition)=>{if(isBr$6(blockPosition.position.getNode())&&!isEmpty$2(blockPosition.block)){return positionIn(false,blockPosition.block.dom).bind(lastPositionInBlock=>{if(lastPositionInBlock.isEqual(blockPosition.position)){return fromPosition(forward,rootNode,lastPositionInBlock).bind(to=>getBlockPosition(rootNode,to));}else{return Optional.some(blockPosition);}}).getOr(blockPosition);}else{return blockPosition;}};var readFromRange=(rootNode,forward,rng)=>{var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng));var toBlockPos=fromBlockPos.bind(blockPos=>fromPosition(forward,rootNode,blockPos.position).bind(to=>getBlockPosition(rootNode,to).map(blockPos=>skipLastBr(rootNode,forward,blockPos))));return lift2(fromBlockPos,toBlockPos,blockBoundary).filter(blockBoundary=>isDifferentBlocks(blockBoundary)&&hasSameHost(rootNode,blockBoundary)&&isEditable$1(blockBoundary)&&hasValidBlocks(blockBoundary));};var read$1=(rootNode,forward,rng)=>rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none();var getChildrenUntilBlockBoundary=block=>{var children=children$1(block);return findIndex$2(children,isBlock$2).fold(constant(children),index=>children.slice(0,index));};var extractChildren=block=>{var children=getChildrenUntilBlockBoundary(block);each$e(children,remove$5);return children;};var removeEmptyRoot=(rootNode,block)=>{var parents=parentsAndSelf(block,rootNode);return find$2(parents.reverse(),element=>isEmpty$2(element)).each(remove$5);};var isEmptyBefore=el=>filter$5(prevSiblings(el),el=>!isEmpty$2(el)).length===0;var nestedBlockMerge=(rootNode,fromBlock,toBlock,insertionPoint)=>{if(isEmpty$2(toBlock)){fillWithPaddingBr(toBlock);return firstPositionIn(toBlock.dom);}if(isEmptyBefore(insertionPoint)&&isEmpty$2(fromBlock)){before$3(insertionPoint,SugarElement.fromTag('br'));}var position=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom));each$e(extractChildren(fromBlock),child=>{before$3(insertionPoint,child);});removeEmptyRoot(rootNode,fromBlock);return position;};var sidelongBlockMerge=(rootNode,fromBlock,toBlock)=>{if(isEmpty$2(toBlock)){if(isEmpty$2(fromBlock)){var getInlineToBlockDescendants=el=>{var helper=(node,elements)=>firstChild(node).fold(()=>elements,child=>isInline$1(child)?helper(child,elements.concat(shallow$1(child))):elements);return helper(el,[]);};var newFromBlockDescendants=foldr(getInlineToBlockDescendants(toBlock),(element,descendant)=>{wrap$2(element,descendant);return descendant;},createPaddingBr());empty(fromBlock);append$1(fromBlock,newFromBlockDescendants);}remove$5(toBlock);return firstPositionIn(fromBlock.dom);}var position=lastPositionIn(toBlock.dom);each$e(extractChildren(fromBlock),child=>{append$1(toBlock,child);});removeEmptyRoot(rootNode,fromBlock);return position;};var findInsertionPoint=(toBlock,block)=>{var parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1]);};var getInsertionPoint=(fromBlock,toBlock)=>contains(toBlock,fromBlock)?findInsertionPoint(toBlock,fromBlock):Optional.none();var trimBr=(first,block)=>{positionIn(first,block.dom).bind(position=>Optional.from(position.getNode())).map(SugarElement.fromDom).filter(isBr$5).each(remove$5);};var mergeBlockInto=(rootNode,fromBlock,toBlock)=>{trimBr(true,fromBlock);trimBr(false,toBlock);return getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock));};var mergeBlocks=(rootNode,forward,block1,block2)=>forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2);var backspaceDelete$9=(editor,forward)=>{var rootNode=SugarElement.fromDom(editor.getBody());var position=read$1(rootNode.dom,forward,editor.selection.getRng()).map(blockBoundary=>()=>{mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block).each(pos=>{editor.selection.setRng(pos.toRange());});});return position;};var deleteRangeMergeBlocks=(rootNode,selection)=>{var rng=selection.getRng();return lift2(getParentBlock$2(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$2(rootNode,SugarElement.fromDom(rng.endContainer)),(block1,block2)=>{if(!eq(block1,block2)){return Optional.some(()=>{rng.deleteContents();mergeBlocks(rootNode,true,block1,block2).each(pos=>{selection.setRng(pos.toRange());});});}else{return Optional.none();}}).getOr(Optional.none());};var isRawNodeInTable=(root,rawNode)=>{var node=SugarElement.fromDom(rawNode);var isRoot=curry(eq,root);return ancestor$4(node,isTableCell$2,isRoot).isSome();};var isSelectionInTable=(root,rng)=>isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer);var isEverythingSelected=(root,rng)=>{var noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone();var noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!isSelectionInTable(root,rng)&&noPrevious&&noNext;};var emptyEditor=editor=>{return Optional.some(()=>{editor.setContent('');editor.selection.setCursorLocation();});};var deleteRange$2=editor=>{var rootNode=SugarElement.fromDom(editor.getBody());var rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?emptyEditor(editor):deleteRangeMergeBlocks(rootNode,editor.selection);};var backspaceDelete$8=(editor,_forward)=>editor.selection.isCollapsed()?Optional.none():deleteRange$2(editor);var showCaret=(direction,editor,node,before,scrollIntoView)=>Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView));var getNodeRange=node=>{var rng=node.ownerDocument.createRange();rng.selectNode(node);return rng;};var selectNode=(editor,node)=>{var e=editor.dispatch('BeforeObjectSelected',{target:node});if(e.isDefaultPrevented()){return Optional.none();}return Optional.some(getNodeRange(node));};var renderCaretAtRange=(editor,range,scrollIntoView)=>{var normalizedRange=normalizeRange(1,editor.getBody(),range);var caretPosition=CaretPosition.fromRangeStart(normalizedRange);var caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode)){return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),false);}var caretPositionBeforeNode=caretPosition.getNode(true);if(isInlineFakeCaretTarget(caretPositionBeforeNode)){return showCaret(1,editor,caretPositionBeforeNode,false,false);}var ceRoot=getContentEditableRoot$1(editor.dom.getRoot(),caretPosition.getNode());if(isInlineFakeCaretTarget(ceRoot)){return showCaret(1,editor,ceRoot,false,scrollIntoView);}return Optional.none();};var renderRangeCaret=(editor,range,scrollIntoView)=>range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range;var isBeforeBoundary=pos=>isBeforeContentEditableFalse(pos)||isBeforeMedia(pos);var isAfterBoundary=pos=>isAfterContentEditableFalse(pos)||isAfterMedia(pos);var trimEmptyTextNode=(dom,node)=>{if(isText$a(node)&&node.data.length===0){dom.remove(node);}};var deleteContentAndShowCaret=(editor,range,node,direction,forward,peekCaretPosition)=>{showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,true).each(caretRange=>{if(range.collapsed){var _deleteRange=range.cloneRange();if(forward){_deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset);}else{_deleteRange.setStart(caretRange.endContainer,caretRange.endOffset);}_deleteRange.deleteContents();}else{range.deleteContents();}editor.selection.setRng(caretRange);});trimEmptyTextNode(editor.dom,node);};var deleteBoundaryText=(editor,forward)=>{var range=editor.selection.getRng();if(!isText$a(range.commonAncestorContainer)){return Optional.none();}var direction=forward?HDirection.Forwards:HDirection.Backwards;var caretWalker=CaretWalker(editor.getBody());var getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev);var isBeforeFn=forward?isBeforeBoundary:isAfterBoundary;var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);var nextCaretPosition=getNextPosFn(caretPosition);var normalizedNextCaretPosition=nextCaretPosition?normalizePosition(forward,nextCaretPosition):nextCaretPosition;if(!normalizedNextCaretPosition||!isMoveInsideSameBlock(caretPosition,normalizedNextCaretPosition)){return Optional.none();}else if(isBeforeFn(normalizedNextCaretPosition)){return Optional.some(()=>deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,normalizedNextCaretPosition));}var peekCaretPosition=getNextPosFn(normalizedNextCaretPosition);if(peekCaretPosition&&isBeforeFn(peekCaretPosition)){if(isMoveInsideSameBlock(normalizedNextCaretPosition,peekCaretPosition)){return Optional.some(()=>deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition));}}return Optional.none();};var backspaceDelete$7=(editor,forward)=>deleteBoundaryText(editor,forward);var getEdgeCefPosition=(editor,atStart)=>{var root=editor.getBody();return atStart?firstPositionIn(root).filter(isBeforeContentEditableFalse):lastPositionIn(root).filter(isAfterContentEditableFalse);};var isCefAtEdgeSelected=editor=>{var rng=editor.selection.getRng();return!rng.collapsed&&(getEdgeCefPosition(editor,true).exists(pos=>pos.isEqual(CaretPosition.fromRangeStart(rng)))||getEdgeCefPosition(editor,false).exists(pos=>pos.isEqual(CaretPosition.fromRangeEnd(rng))));};var isCompoundElement=node=>isNonNullable(node)&&(isTableCell$2(SugarElement.fromDom(node))||isListItem$1(SugarElement.fromDom(node)));var DeleteAction=Adt.generate([{remove:['element']},{moveToElement:['element']},{moveToPosition:['position']}]);var isAtContentEditableBlockCaret=(forward,from)=>{var elm=from.getNode(!forward);var caretLocation=forward?'after':'before';return isElement$6(elm)&&elm.getAttribute('data-mce-caret')===caretLocation;};var isDeleteFromCefDifferentBlocks=(root,forward,from,to)=>{var inSameBlock=elm=>isInline$1(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root);return getRelativeCefElm(!forward,from).fold(()=>getRelativeCefElm(forward,to).fold(never,inSameBlock),inSameBlock);};var deleteEmptyBlockOrMoveToCef=(root,forward,from,to)=>{var toCefElm=to.getNode(!forward);return getParentBlock$2(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map(blockElm=>isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm)).orThunk(()=>Optional.some(DeleteAction.moveToElement(toCefElm)));};var findCefPosition=(root,forward,from)=>fromPosition(forward,root,from).bind(to=>{if(isCompoundElement(to.getNode())){return Optional.none();}else if(isDeleteFromCefDifferentBlocks(root,forward,from,to)){return Optional.none();}else if(forward&&isContentEditableFalse$b(to.getNode())){return deleteEmptyBlockOrMoveToCef(root,forward,from,to);}else if(!forward&&isContentEditableFalse$b(to.getNode(true))){return deleteEmptyBlockOrMoveToCef(root,forward,from,to);}else if(forward&&isAfterContentEditableFalse(from)){return Optional.some(DeleteAction.moveToPosition(to));}else if(!forward&&isBeforeContentEditableFalse(from)){return Optional.some(DeleteAction.moveToPosition(to));}else{return Optional.none();}});var getContentEditableBlockAction=(forward,elm)=>{if(isNullable(elm)){return Optional.none();}else if(forward&&isContentEditableFalse$b(elm.nextSibling)){return Optional.some(DeleteAction.moveToElement(elm.nextSibling));}else if(!forward&&isContentEditableFalse$b(elm.previousSibling)){return Optional.some(DeleteAction.moveToElement(elm.previousSibling));}else{return Optional.none();}};var skipMoveToActionFromInlineCefToContent=(root,from,deleteAction)=>deleteAction.fold(elm=>Optional.some(DeleteAction.remove(elm)),elm=>Optional.some(DeleteAction.moveToElement(elm)),to=>{if(isInSameBlock(from,to,root)){return Optional.none();}else{return Optional.some(DeleteAction.moveToPosition(to));}});var getContentEditableAction=(root,forward,from)=>{if(isAtContentEditableBlockCaret(forward,from)){return getContentEditableBlockAction(forward,from.getNode(!forward)).orThunk(()=>findCefPosition(root,forward,from));}else{return findCefPosition(root,forward,from).bind(deleteAction=>skipMoveToActionFromInlineCefToContent(root,from,deleteAction));}};var read=(root,forward,rng)=>{var normalizedRange=normalizeRange(forward?1:-1,root,rng);var from=CaretPosition.fromRangeStart(normalizedRange);var rootElement=SugarElement.fromDom(root);if(!forward&&isAfterContentEditableFalse(from)){return Optional.some(DeleteAction.remove(from.getNode(true)));}else if(forward&&isBeforeContentEditableFalse(from)){return Optional.some(DeleteAction.remove(from.getNode()));}else if(!forward&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from)){return findPreviousBr(rootElement,from).map(br=>DeleteAction.remove(br.getNode()));}else if(forward&&isAfterContentEditableFalse(from)&&isBeforeBr$1(rootElement,from)){return findNextBr(rootElement,from).map(br=>DeleteAction.remove(br.getNode()));}else{return getContentEditableAction(root,forward,from);}};var deleteElement$1=(editor,forward)=>element=>{editor._selectionOverrides.hideFakeCaret();deleteElement$2(editor,forward,SugarElement.fromDom(element));return true;};var moveToElement=(editor,forward)=>element=>{var pos=forward?CaretPosition.before(element):CaretPosition.after(element);editor.selection.setRng(pos.toRange());return true;};var moveToPosition=editor=>pos=>{editor.selection.setRng(pos.toRange());return true;};var getAncestorCe=(editor,node)=>Optional.from(getContentEditableRoot$1(editor.getBody(),node));var backspaceDeleteCaret=(editor,forward)=>{var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold(()=>read(editor.getBody(),forward,editor.selection.getRng()).map(deleteAction=>()=>deleteAction.fold(deleteElement$1(editor,forward),moveToElement(editor,forward),moveToPosition(editor))),()=>Optional.some(noop));};var deleteOffscreenSelection=rootElement=>{each$e(descendants(rootElement,'.mce-offscreen-selection'),remove$5);};var backspaceDeleteRange=(editor,forward)=>{var selectedNode=editor.selection.getNode();if(isContentEditableFalse$b(selectedNode)&&!isTableCell$3(selectedNode)){var hasCefAncestor=getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b);return hasCefAncestor.fold(()=>Optional.some(()=>{deleteOffscreenSelection(SugarElement.fromDom(editor.getBody()));deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode()));paddEmptyBody(editor);}),()=>Optional.some(noop));}if(isCefAtEdgeSelected(editor)){return Optional.some(()=>{deleteRangeContents(editor,editor.selection.getRng(),SugarElement.fromDom(editor.getBody()));});}return Optional.none();};var paddEmptyElement=editor=>{var dom=editor.dom,selection=editor.selection;var ceRoot=getContentEditableRoot$1(editor.getBody(),selection.getNode());if(isContentEditableTrue$3(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){var br=dom.create('br',{'data-mce-bogus':'1'});dom.setHTML(ceRoot,'');ceRoot.appendChild(br);selection.setRng(CaretPosition.before(br).toRange());}return true;};var backspaceDelete$6=(editor,forward)=>{if(editor.selection.isCollapsed()){return backspaceDeleteCaret(editor,forward);}else{return backspaceDeleteRange(editor,forward);}};var deleteCaret$2=(editor,forward)=>{var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter(pos=>forward?isBeforeImageBlock(pos):isAfterImageBlock(pos)).bind(pos=>getChildNodeAtRelativeOffset(forward?0:-1,pos)).map(elm=>()=>editor.selection.select(elm));};var backspaceDelete$5=(editor,forward)=>editor.selection.isCollapsed()?deleteCaret$2(editor,forward):Optional.none();var isText$2=isText$a;var startsWithCaretContainer=node=>isText$2(node)&&node.data[0]===ZWSP$1;var endsWithCaretContainer=node=>isText$2(node)&&node.data[node.data.length-1]===ZWSP$1;var createZwsp=node=>{var _a;var doc=(_a=node.ownerDocument)!==null&&_a!==void 0?_a:document;return doc.createTextNode(ZWSP$1);};var insertBefore$1=node=>{var _a;if(isText$2(node.previousSibling)){if(endsWithCaretContainer(node.previousSibling)){return node.previousSibling;}else{node.previousSibling.appendData(ZWSP$1);return node.previousSibling;}}else if(isText$2(node)){if(startsWithCaretContainer(node)){return node;}else{node.insertData(0,ZWSP$1);return node;}}else{var newNode=createZwsp(node);(_a=node.parentNode)===null||_a===void 0?void 0:_a.insertBefore(newNode,node);return newNode;}};var insertAfter$1=node=>{var _a,_b;if(isText$2(node.nextSibling)){if(startsWithCaretContainer(node.nextSibling)){return node.nextSibling;}else{node.nextSibling.insertData(0,ZWSP$1);return node.nextSibling;}}else if(isText$2(node)){if(endsWithCaretContainer(node)){return node;}else{node.appendData(ZWSP$1);return node;}}else{var newNode=createZwsp(node);if(node.nextSibling){(_a=node.parentNode)===null||_a===void 0?void 0:_a.insertBefore(newNode,node.nextSibling);}else{(_b=node.parentNode)===null||_b===void 0?void 0:_b.appendChild(newNode);}return newNode;}};var insertInline=(before,node)=>before?insertBefore$1(node):insertAfter$1(node);var insertInlineBefore=curry(insertInline,true);var insertInlineAfter=curry(insertInline,false);var insertInlinePos=(pos,before)=>{if(isText$a(pos.container())){return insertInline(before,pos.container());}else{return insertInline(before,pos.getNode());}};var isPosCaretContainer=(pos,caret)=>{var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode);};var renderCaret=(caret,location)=>location.fold(element=>{remove$3(caret.get());var text=insertInlineBefore(element);caret.set(text);return Optional.some(CaretPosition(text,text.length-1));},element=>firstPositionIn(element).map(pos=>{if(!isPosCaretContainer(pos,caret)){remove$3(caret.get());var _text5=insertInlinePos(pos,true);caret.set(_text5);return CaretPosition(_text5,1);}else{var node=caret.get();return CaretPosition(node,1);}}),element=>lastPositionIn(element).map(pos=>{if(!isPosCaretContainer(pos,caret)){remove$3(caret.get());var _text6=insertInlinePos(pos,false);caret.set(_text6);return CaretPosition(_text6,_text6.length-1);}else{var node=caret.get();return CaretPosition(node,node.length-1);}}),element=>{remove$3(caret.get());var text=insertInlineAfter(element);caret.set(text);return Optional.some(CaretPosition(text,1));});var evaluateUntil=(fns,args)=>{for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome()){return result;}}return Optional.none();};var Location=Adt.generate([{before:['element']},{start:['element']},{end:['element']},{after:['element']}]);var rescope$1=(rootNode,node)=>{var parentBlock=getParentBlock$3(node,rootNode);return parentBlock?parentBlock:rootNode;};var before=(isInlineTarget,rootNode,pos)=>{var nPos=normalizeForwards(pos);var scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(()=>nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(inline=>Location.before(inline)),Optional.none);};var isNotInsideFormatCaretContainer=(rootNode,elm)=>getParentCaretContainer(rootNode,elm)===null;var findInsideRootInline=(isInlineTarget,rootNode,pos)=>findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode));var start$1=(isInlineTarget,rootNode,pos)=>{var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(inline=>{var prevPos=prevPosition(inline,nPos);return prevPos.isNone()?Optional.some(Location.start(inline)):Optional.none();});};var end=(isInlineTarget,rootNode,pos)=>{var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind(inline=>{var nextPos=nextPosition(inline,nPos);return nextPos.isNone()?Optional.some(Location.end(inline)):Optional.none();});};var after=(isInlineTarget,rootNode,pos)=>{var nPos=normalizeBackwards(pos);var scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold(()=>prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map(inline=>Location.after(inline)),Optional.none);};var isValidLocation=location=>!isRtl(getElement(location));var readLocation=(isInlineTarget,rootNode,pos)=>{var location=evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]);return location.filter(isValidLocation);};var getElement=location=>location.fold(identity,identity,identity,identity);var getName=location=>location.fold(constant('before'),constant('start'),constant('end'),constant('after'));var outside=location=>location.fold(Location.before,Location.before,Location.after,Location.after);var inside=location=>location.fold(Location.start,Location.start,Location.end,Location.end);var isEq=(location1,location2)=>getName(location1)===getName(location2)&&getElement(location1)===getElement(location2);var betweenInlines=(forward,isInlineTarget,rootNode,from,to,location)=>lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),(fromInline,toInline)=>{if(fromInline!==toInline&&hasSameParentBlock(rootNode,fromInline,toInline)){return Location.after(forward?fromInline:toInline);}else{return location;}}).getOr(location);var skipNoMovement=(fromLocation,toLocation)=>fromLocation.fold(always,fromLocation=>!isEq(fromLocation,toLocation));var findLocationTraverse=(forward,isInlineTarget,rootNode,fromLocation,pos)=>{var from=normalizePosition(forward,pos);var to=fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward));var location=to.fold(()=>fromLocation.map(outside),to=>readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation)));return location.filter(isValidLocation);};var findLocationSimple=(forward,location)=>{if(forward){return location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none);}else{return location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end));}};var findLocation$1=(forward,isInlineTarget,rootNode,pos)=>{var from=normalizePosition(forward,pos);var fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk(()=>findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos));};var hasSelectionModifyApi=editor=>{return isFunction(editor.selection.getSel().modify);};var moveRel=(forward,selection,pos)=>{var delta=forward?1:-1;selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange());selection.getSel().modify('move',forward?'forward':'backward','word');return true;};var moveByWord=(forward,editor)=>{var rng=editor.selection.getRng();var pos=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);if(!hasSelectionModifyApi(editor)){return false;}else if(forward&&isBeforeInline(pos)){return moveRel(true,editor.selection,pos);}else if(!forward&&isAfterInline(pos)){return moveRel(false,editor.selection,pos);}else{return false;}};var BreakType;(function(BreakType){BreakType[BreakType['Br']=0]='Br';BreakType[BreakType['Block']=1]='Block';BreakType[BreakType['Wrap']=2]='Wrap';BreakType[BreakType['Eol']=3]='Eol';})(BreakType||(BreakType={}));var flip=(direction,positions)=>direction===HDirection.Backwards?reverse(positions):positions;var walk$1=(direction,caretWalker,pos)=>direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos);var getBreakType=(scope,direction,currentPos,nextPos)=>{if(isBr$6(nextPos.getNode(direction===HDirection.Forwards))){return BreakType.Br;}else if(isInSameBlock(currentPos,nextPos)===false){return BreakType.Block;}else{return BreakType.Wrap;}};var getPositionsUntil=(predicate,direction,scope,start)=>{var caretWalker=CaretWalker(scope);var currentPos=start;var positions=[];while(currentPos){var nextPos=walk$1(direction,caretWalker,currentPos);if(!nextPos){break;}if(isBr$6(nextPos.getNode(false))){if(direction===HDirection.Forwards){return{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};}else{return{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};}}if(!nextPos.isVisible()){currentPos=nextPos;continue;}if(predicate(currentPos,nextPos)){var breakType=getBreakType(scope,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType,breakAt:Optional.some(nextPos)};}positions.push(nextPos);currentPos=nextPos;}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()};};var getAdjacentLinePositions=(direction,getPositionsUntilBreak,scope,start)=>getPositionsUntilBreak(scope,start).breakAt.map(pos=>{var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions);}).getOr([]);var findClosestHorizontalPositionFromPoint=(positions,x)=>foldl(positions,(acc,newPos)=>acc.fold(()=>Optional.some(newPos),lastPos=>lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),(lastRect,newRect)=>{var lastDist=Math.abs(x-lastRect.left);var newDist=Math.abs(x-newRect.left);return newDist<=lastDist?newPos:lastPos;}).or(acc)),Optional.none());var findClosestHorizontalPosition=(positions,pos)=>head(pos.getClientRects()).bind(targetRect=>findClosestHorizontalPositionFromPoint(positions,targetRect.left));var getPositionsUntilPreviousLine=curry(getPositionsUntil,CaretPosition.isAbove,-1);var getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1);var getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine);var getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine);var isAtFirstLine=(scope,pos)=>getPositionsUntilPreviousLine(scope,pos).breakAt.isNone();var isAtLastLine=(scope,pos)=>getPositionsUntilNextLine(scope,pos).breakAt.isNone();var getFirstLinePositions=scope=>firstPositionIn(scope).map(pos=>[pos].concat(getPositionsUntilNextLine(scope,pos).positions)).getOr([]);var getLastLinePositions=scope=>lastPositionIn(scope).map(pos=>getPositionsUntilPreviousLine(scope,pos).positions.concat(pos)).getOr([]);var getClosestPositionAbove=(scope,pos)=>findClosestHorizontalPosition(getPositionsAbove(scope,pos),pos);var getClosestPositionBelow=(scope,pos)=>findClosestHorizontalPosition(getPositionsBelow(scope,pos),pos);var isContentEditableFalse$4=isContentEditableFalse$b;var distanceToRectLeft$1=(clientRect,clientX)=>Math.abs(clientRect.left-clientX);var distanceToRectRight$1=(clientRect,clientX)=>Math.abs(clientRect.right-clientX);var isNodeClientRect=rect=>hasNonNullableKey(rect,'node');var findClosestClientRect=(clientRects,clientX)=>reduce(clientRects,(oldClientRect,clientRect)=>{var oldDistance=Math.min(distanceToRectLeft$1(oldClientRect,clientX),distanceToRectRight$1(oldClientRect,clientX));var newDistance=Math.min(distanceToRectLeft$1(clientRect,clientX),distanceToRectRight$1(clientRect,clientX));if(newDistance===oldDistance&&isNodeClientRect(clientRect)&&isContentEditableFalse$4(clientRect.node)){return clientRect;}if(newDistance<oldDistance){return clientRect;}return oldClientRect;});var getNodeClientRects=node=>{var toArrayWithNode=clientRects=>{return map$3(clientRects,rect=>{var clientRect=clone$1(rect);clientRect.node=node;return clientRect;});};if(isElement$6(node)){return toArrayWithNode(node.getClientRects());}else if(isText$a(node)){var rng=node.ownerDocument.createRange();rng.setStart(node,0);rng.setEnd(node,node.data.length);return toArrayWithNode(rng.getClientRects());}else{return[];}};var getClientRects=nodes=>bind$3(nodes,getNodeClientRects);var VDirection;(function(VDirection){VDirection[VDirection['Up']=-1]='Up';VDirection[VDirection['Down']=1]='Down';})(VDirection||(VDirection={}));var findUntil=(direction,root,predicateFn,node)=>{var currentNode=node;while(currentNode=findNode(currentNode,direction,isEditableCaretCandidate$1,root)){if(predicateFn(currentNode)){return;}}};var walkUntil=(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition)=>{var line=0;var result=[];var add=node=>{var clientRects=getClientRects([node]);if(direction===-1){clientRects=clientRects.reverse();}for(var i=0;i<clientRects.length;i++){var clientRect=clientRects[i];if(isBeflowFn(clientRect,targetClientRect)){continue;}if(result.length>0&&isAboveFn(clientRect,last$2(result))){line++;}clientRect.line=line;if(predicateFn(clientRect)){return true;}result.push(clientRect);}return false;};var targetClientRect=last$2(caretPosition.getClientRects());if(!targetClientRect){return result;}var node=caretPosition.getNode();if(node){add(node);findUntil(direction,root,add,node);}return result;};var aboveLineNumber=(lineNumber,clientRect)=>clientRect.line>lineNumber;var isLineNumber=(lineNumber,clientRect)=>clientRect.line===lineNumber;var upUntil=curry(walkUntil,VDirection.Up,isAbove$1,isBelow$1);var downUntil=curry(walkUntil,VDirection.Down,isBelow$1,isAbove$1);var getLastClientRect=caretPosition=>{return last$2(caretPosition.getClientRects());};var positionsUntil=(direction,root,predicateFn,node)=>{var caretWalker=CaretWalker(root);var walkFn;var isBelowFn;var isAboveFn;var caretPosition;var result=[];var line=0;if(direction===1){walkFn=caretWalker.next;isBelowFn=isBelow$1;isAboveFn=isAbove$1;caretPosition=CaretPosition.after(node);}else{walkFn=caretWalker.prev;isBelowFn=isAbove$1;isAboveFn=isBelow$1;caretPosition=CaretPosition.before(node);}var targetClientRect=getLastClientRect(caretPosition);do{if(!caretPosition.isVisible()){continue;}var rect=getLastClientRect(caretPosition);if(isAboveFn(rect,targetClientRect)){continue;}if(result.length>0&&isBelowFn(rect,last$2(result))){line++;}var clientRect=clone$1(rect);clientRect.position=caretPosition;clientRect.line=line;if(predicateFn(clientRect)){return result;}result.push(clientRect);}while(caretPosition=walkFn(caretPosition));return result;};var isAboveLine=lineNumber=>clientRect=>aboveLineNumber(lineNumber,clientRect);var isLine=lineNumber=>clientRect=>isLineNumber(lineNumber,clientRect);var moveToRange=(editor,rng)=>{editor.selection.setRng(rng);scrollRangeIntoView(editor,editor.selection.getRng());};var renderRangeCaretOpt=(editor,range,scrollIntoView)=>Optional.some(renderRangeCaret(editor,range,scrollIntoView));var moveHorizontally=(editor,direction,range,isBefore,isAfter,isElement)=>{var forwards=direction===HDirection.Forwards;var caretWalker=CaretWalker(editor.getBody());var getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev);var isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){var node=getSelectedNode(range);if(isElement(node)){return showCaret(direction,editor,node,direction===HDirection.Backwards,false);}else if(isCefAtEdgeSelected(editor)){var newRange=range.cloneRange();newRange.collapse(direction===HDirection.Backwards);return Optional.from(newRange);}}var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition)){return selectNode(editor,caretPosition.getNode(!forwards));}var nextCaretPosition=getNextPosFn(caretPosition);var rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition){return rangeIsInContainerBlock?Optional.some(range):Optional.none();}else{nextCaretPosition=normalizePosition(forwards,nextCaretPosition);}if(isBeforeFn(nextCaretPosition)){return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,false);}var peekCaretPosition=getNextPosFn(nextCaretPosition);if(peekCaretPosition&&isBeforeFn(peekCaretPosition)){if(isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)){return showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,false);}}if(rangeIsInContainerBlock){return renderRangeCaretOpt(editor,nextCaretPosition.toRange(),false);}return Optional.none();};var moveVertically=(editor,direction,range,isBefore,isAfter,isElement)=>{var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);var caretClientRect=last$2(caretPosition.getClientRects());var forwards=direction===VDirection.Down;var root=editor.getBody();if(!caretClientRect){return Optional.none();}if(isCefAtEdgeSelected(editor)){var _caretPosition=forwards?CaretPosition.fromRangeEnd(range):CaretPosition.fromRangeStart(range);var getClosestFn=!forwards?getClosestPositionAbove:getClosestPositionBelow;return getClosestFn(root,_caretPosition).orThunk(()=>Optional.from(_caretPosition)).map(pos=>pos.toRange());}var walkerFn=forwards?downUntil:upUntil;var linePositions=walkerFn(root,isAboveLine(1),caretPosition);var nextLinePositions=filter$5(linePositions,isLine(1));var clientX=caretClientRect.left;var nextLineRect=findClosestClientRect(nextLinePositions,clientX);if(nextLineRect&&isElement(nextLineRect.node)){var dist1=Math.abs(clientX-nextLineRect.left);var dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,false);}var currentNode;if(isBefore(caretPosition)){currentNode=caretPosition.getNode();}else if(isAfter(caretPosition)){currentNode=caretPosition.getNode(true);}else{currentNode=getSelectedNode(range);}if(currentNode){var caretPositions=positionsUntil(direction,root,isAboveLine(1),currentNode);var closestNextLineRect=findClosestClientRect(filter$5(caretPositions,isLine(1)),clientX);if(closestNextLineRect){return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),false);}closestNextLineRect=last$2(filter$5(caretPositions,isLine(0)));if(closestNextLineRect){return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),false);}}if(nextLinePositions.length===0){return getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map(pos=>renderRangeCaret(editor,pos.toRange(),false));}return Optional.none();};var getLineEndPoint=(editor,forward)=>{var rng=editor.selection.getRng();var from=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);var host=getEditingHost(from.container(),editor.getBody());if(forward){var lineInfo=getPositionsUntilNextLine(host,from);return last$3(lineInfo.positions);}else{var _lineInfo=getPositionsUntilPreviousLine(host,from);return head(_lineInfo.positions);}};var moveToLineEndPoint$3=(editor,forward,isElementPosition)=>getLineEndPoint(editor,forward).filter(isElementPosition).exists(pos=>{editor.selection.setRng(pos.toRange());return true;});var setCaretPosition=(editor,pos)=>{var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset());rng.setEnd(pos.container(),pos.offset());editor.selection.setRng(rng);};var setSelected=(state,elm)=>{if(state){elm.setAttribute('data-mce-selected','inline-boundary');}else{elm.removeAttribute('data-mce-selected');}};var renderCaretLocation=(editor,caret,location)=>renderCaret(caret,location).map(pos=>{setCaretPosition(editor,pos);return location;});var getPositionFromRange=(range,root,forward)=>{var start=CaretPosition.fromRangeStart(range);if(range.collapsed){return start;}else{var _end3=CaretPosition.fromRangeEnd(range);return forward?prevPosition(root,_end3).getOr(_end3):nextPosition(root,start).getOr(start);}};var findLocation=(editor,caret,forward)=>{var rootNode=editor.getBody();var from=getPositionFromRange(editor.selection.getRng(),rootNode,forward);var isInlineTarget$1=curry(isInlineTarget,editor);var location=findLocation$1(forward,isInlineTarget$1,rootNode,from);return location.bind(location=>renderCaretLocation(editor,caret,location));};var toggleInlines=(isInlineTarget,dom,elms)=>{var inlineBoundaries=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected=\"inline-boundary\"]'),e=>e.dom);var selectedInlines=filter$5(inlineBoundaries,isInlineTarget);var targetInlines=filter$5(elms,isInlineTarget);each$e(difference(selectedInlines,targetInlines),curry(setSelected,false));each$e(difference(targetInlines,selectedInlines),curry(setSelected,true));};var safeRemoveCaretContainer=(editor,caret)=>{var caretValue=caret.get();if(editor.selection.isCollapsed()&&!editor.composing&&caretValue){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());if(CaretPosition.isTextPosition(pos)&&!isAtZwsp(pos)){setCaretPosition(editor,removeAndReposition(caretValue,pos));caret.set(null);}}};var renderInsideInlineCaret=(isInlineTarget,editor,caret,elms)=>{if(editor.selection.isCollapsed()){var inlines=filter$5(elms,isInlineTarget);each$e(inlines,_inline=>{var pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind(location=>renderCaretLocation(editor,caret,location));});}};var move$3=(editor,caret,forward)=>isInlineBoundariesEnabled(editor)?findLocation(editor,caret,forward).isSome():false;var moveWord=(forward,editor,_caret)=>isInlineBoundariesEnabled(editor)?moveByWord(forward,editor):false;var setupSelectedState=editor=>{var caret=Cell(null);var isInlineTarget$1=curry(isInlineTarget,editor);editor.on('NodeChange',e=>{if(isInlineBoundariesEnabled(editor)){toggleInlines(isInlineTarget$1,editor.dom,e.parents);safeRemoveCaretContainer(editor,caret);renderInsideInlineCaret(isInlineTarget$1,editor,caret,e.parents);}});return caret;};var moveNextWord=curry(moveWord,true);var movePrevWord=curry(moveWord,false);var moveToLineEndPoint$2=(editor,forward,caret)=>{if(isInlineBoundariesEnabled(editor)){var linePoint=getLineEndPoint(editor,forward).getOrThunk(()=>{var rng=editor.selection.getRng();return forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);});return readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists(loc=>{var outsideLoc=outside(loc);return renderCaret(caret,outsideLoc).exists(pos=>{setCaretPosition(editor,pos);return true;});});}else{return false;}};var rangeFromPositions=(from,to)=>{var range=document.createRange();range.setStart(from.container(),from.offset());range.setEnd(to.container(),to.offset());return range;};var hasOnlyTwoOrLessPositionsLeft=elm=>lift2(firstPositionIn(elm),lastPositionIn(elm),(firstPos,lastPos)=>{var normalizedFirstPos=normalizePosition(true,firstPos);var normalizedLastPos=normalizePosition(false,lastPos);return nextPosition(elm,normalizedFirstPos).forall(pos=>pos.isEqual(normalizedLastPos));}).getOr(true);var setCaretLocation=(editor,caret)=>location=>renderCaret(caret,location).map(pos=>()=>setCaretPosition(editor,pos));var deleteFromTo=(editor,caret,from,to)=>{var rootNode=editor.getBody();var isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore(()=>{editor.selection.setRng(rangeFromPositions(from,to));execNativeDeleteCommand(editor);readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).bind(setCaretLocation(editor,caret)).each(call);});editor.nodeChanged();};var rescope=(rootNode,node)=>{var parentBlock=getParentBlock$3(node,rootNode);return parentBlock?parentBlock:rootNode;};var backspaceDeleteCollapsed=(editor,caret,forward,from)=>{var rootNode=rescope(editor.getBody(),from.container());var isInlineTarget$1=curry(isInlineTarget,editor);var fromLocation=readLocation(isInlineTarget$1,rootNode,from);var location=fromLocation.bind(location=>{if(forward){return location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none);}else{return location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))));}});return location.map(setCaretLocation(editor,caret)).getOrThunk(()=>{var toPosition=navigate(forward,rootNode,from);var toLocation=toPosition.bind(pos=>readLocation(isInlineTarget$1,rootNode,pos));return lift2(fromLocation,toLocation,()=>findRootInline(isInlineTarget$1,rootNode,from).bind(elm=>{if(hasOnlyTwoOrLessPositionsLeft(elm)){return Optional.some(()=>{deleteElement$2(editor,forward,SugarElement.fromDom(elm));});}else{return Optional.none();}})).getOrThunk(()=>toLocation.bind(()=>toPosition.map(to=>{return()=>{if(forward){deleteFromTo(editor,caret,from,to);}else{deleteFromTo(editor,caret,to,from);}};})));});};var backspaceDelete$4=(editor,caret,forward)=>{if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){var _from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,_from);}return Optional.none();};var hasMultipleChildren=elm=>childNodesCount(elm)>1;var getParentsUntil=(editor,pred)=>{var rootElm=SugarElement.fromDom(editor.getBody());var startElm=SugarElement.fromDom(editor.selection.getStart());var parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,pred).fold(constant(parents),index=>parents.slice(0,index));};var hasOnlyOneChild=elm=>childNodesCount(elm)===1;var getParentInlinesUntilMultichildInline=editor=>getParentsUntil(editor,elm=>isBlock$2(elm)||hasMultipleChildren(elm));var getParentInlines=editor=>getParentsUntil(editor,isBlock$2);var getFormatNodes=(editor,parentInlines)=>{var isFormatElement$1=curry(isFormatElement,editor);return bind$3(parentInlines,elm=>isFormatElement$1(elm)?[elm.dom]:[]);};var getFormatNodesAtStart=editor=>{var parentInlines=getParentInlines(editor);return getFormatNodes(editor,parentInlines);};var deleteLastPosition=(forward,editor,target,parentInlines)=>{var formatNodes=getFormatNodes(editor,parentInlines);if(formatNodes.length===0){deleteElement$2(editor,forward,target);}else{var pos=replaceWithCaretFormat(target.dom,formatNodes);editor.selection.setRng(pos.toRange());}};var deleteCaret$1=(editor,forward)=>{var parentInlines=filter$5(getParentInlinesUntilMultichildInline(editor),hasOnlyOneChild);return last$3(parentInlines).bind(target=>{var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());if(willDeleteLastPositionInElement(forward,fromPos,target.dom)&&!isEmptyCaretFormatElement(target)){return Optional.some(()=>deleteLastPosition(forward,editor,target,parentInlines));}else{return Optional.none();}});};var isBrInEmptyElement=(editor,elm)=>{var parentElm=elm.parentElement;return isBr$6(elm)&&!isNull(parentElm)&&editor.dom.isEmpty(parentElm);};var isEmptyCaret=elm=>isEmptyCaretFormatElement(SugarElement.fromDom(elm));var createCaretFormatAtStart=(editor,formatNodes)=>{var startElm=editor.selection.getStart();var pos=isBrInEmptyElement(editor,startElm)||isEmptyCaret(startElm)?replaceWithCaretFormat(startElm,formatNodes):createCaretFormatAtStart$1(editor.selection.getRng(),formatNodes);editor.selection.setRng(pos.toRange());};var updateCaretFormat=(editor,updateFormats)=>{var missingFormats=difference(updateFormats,getFormatNodesAtStart(editor));if(missingFormats.length>0){createCaretFormatAtStart(editor,missingFormats);}};var rangeStartsAtTextContainer=rng=>isText$a(rng.startContainer);var rangeStartsAtStartOfTextContainer=rng=>rng.startOffset===0&&rangeStartsAtTextContainer(rng);var rangeStartParentIsFormatElement=(editor,rng)=>{var startParent=rng.startContainer.parentElement;return!isNull(startParent)&&isFormatElement(editor,SugarElement.fromDom(startParent));};var rangeStartAndEndHaveSameParent=rng=>{var startParent=rng.startContainer.parentNode;var endParent=rng.endContainer.parentNode;return!isNull(startParent)&&!isNull(endParent)&&startParent.isEqualNode(endParent);};var rangeEndsAtEndOfEndContainer=rng=>{var endContainer=rng.endContainer;return rng.endOffset===(isText$a(endContainer)?endContainer.length:endContainer.childNodes.length);};var rangeEndsAtEndOfStartContainer=rng=>rangeStartAndEndHaveSameParent(rng)&&rangeEndsAtEndOfEndContainer(rng);var rangeEndsAfterEndOfStartContainer=rng=>!rng.endContainer.isEqualNode(rng.commonAncestorContainer);var rangeEndsAtOrAfterEndOfStartContainer=rng=>rangeEndsAtEndOfStartContainer(rng)||rangeEndsAfterEndOfStartContainer(rng);var requiresDeleteRangeOverride=editor=>{var rng=editor.selection.getRng();return rangeStartsAtStartOfTextContainer(rng)&&rangeStartParentIsFormatElement(editor,rng)&&rangeEndsAtOrAfterEndOfStartContainer(rng);};var deleteRange$1=editor=>{if(requiresDeleteRangeOverride(editor)){var formatNodes=getFormatNodesAtStart(editor);return Optional.some(()=>{execNativeDeleteCommand(editor);updateCaretFormat(editor,formatNodes);});}else{return Optional.none();}};var backspaceDelete$3=(editor,forward)=>editor.selection.isCollapsed()?deleteCaret$1(editor,forward):deleteRange$1(editor);var hasAncestorInlineCaret=elm=>ancestor$1(elm,node=>isCaretNode(node.dom),isBlock$2);var hasAncestorInlineCaretAtStart=editor=>hasAncestorInlineCaret(SugarElement.fromDom(editor.selection.getStart()));var requiresRefreshCaretOverride=editor=>{var rng=editor.selection.getRng();return rng.collapsed&&(rangeStartsAtTextContainer(rng)||editor.dom.isEmpty(rng.startContainer))&&!hasAncestorInlineCaretAtStart(editor);};var refreshCaret=editor=>{if(requiresRefreshCaretOverride(editor)){createCaretFormatAtStart(editor,[]);}return true;};var deleteElement=(editor,forward,element)=>{if(isNonNullable(element)){return Optional.some(()=>{editor._selectionOverrides.hideFakeCaret();deleteElement$2(editor,forward,SugarElement.fromDom(element));});}else{return Optional.none();}};var deleteCaret=(editor,forward)=>{var isNearMedia=forward?isBeforeMedia:isAfterMedia;var direction=forward?HDirection.Forwards:HDirection.Backwards;var fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());if(isNearMedia(fromPos)){return deleteElement(editor,forward,fromPos.getNode(!forward));}else{return Optional.from(normalizePosition(forward,fromPos)).filter(pos=>isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos)).bind(pos=>deleteElement(editor,forward,pos.getNode(!forward)));}};var deleteRange=(editor,forward)=>{var selectedNode=editor.selection.getNode();return isMedia$2(selectedNode)?deleteElement(editor,forward,selectedNode):Optional.none();};var backspaceDelete$2=(editor,forward)=>editor.selection.isCollapsed()?deleteCaret(editor,forward):deleteRange(editor,forward);var isEditable=target=>closest$4(target,elm=>isContentEditableTrue$3(elm.dom)||isContentEditableFalse$b(elm.dom)).exists(elm=>isContentEditableTrue$3(elm.dom));var parseIndentValue=value=>toInt(value!==null&&value!==void 0?value:'').getOr(0);var getIndentStyleName=(useMargin,element)=>{var indentStyleName=useMargin||isTable$1(element)?'margin':'padding';var suffix=get$7(element,'direction')==='rtl'?'-right':'-left';return indentStyleName+suffix;};var indentElement=(dom,command,useMargin,value,unit,element)=>{var indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element));var parsedValue=parseIndentValue(dom.getStyle(element,indentStyleName));if(command==='outdent'){var styleValue=Math.max(0,parsedValue-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:'');}else{var _styleValue=parsedValue+value+unit;dom.setStyle(element,indentStyleName,_styleValue);}};var validateBlocks=(editor,blocks)=>forall(blocks,block=>{var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block);var intentValue=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0);var contentEditable=editor.dom.getContentEditable(block.dom);return contentEditable!=='false'&&intentValue>0;});var canOutdent=editor=>{var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||validateBlocks(editor,blocks));};var isListComponent=el=>isList(el)||isListItem$1(el);var parentIsListComponent=el=>parent(el).exists(isListComponent);var getBlocksToIndent=editor=>filter$5(fromDom$1(editor.selection.getSelectedBlocks()),el=>!isListComponent(el)&&!parentIsListComponent(el)&&isEditable(el));var handle=(editor,command)=>{var _a,_b;var{dom}=editor;var indentation=getIndentation(editor);var indentUnit=(_b=(_a=/[a-z%]+$/i.exec(indentation))===null||_a===void 0?void 0:_a[0])!==null&&_b!==void 0?_b:'px';var indentValue=parseIndentValue(indentation);var useMargin=shouldIndentUseMargin(editor);each$e(getBlocksToIndent(editor),block=>{indentElement(dom,command,useMargin,indentValue,indentUnit,block.dom);});};var indent=editor=>handle(editor,'indent');var outdent=editor=>handle(editor,'outdent');var backspaceDelete$1=editor=>{if(editor.selection.isCollapsed()&&canOutdent(editor)){var _dom2=editor.dom;var rng=editor.selection.getRng();var pos=CaretPosition.fromRangeStart(rng);var block=_dom2.getParent(rng.startContainer,_dom2.isBlock);if(block!==null&&isAtStartOfBlock(SugarElement.fromDom(block),pos)){return Optional.some(()=>outdent(editor));}}return Optional.none();};var findAction=(editor,caret,forward)=>findMap([backspaceDelete$1,backspaceDelete$6,backspaceDelete$7,(editor,forward)=>backspaceDelete$4(editor,caret,forward),backspaceDelete$9,backspaceDelete$a,backspaceDelete$5,backspaceDelete$2,backspaceDelete$8,backspaceDelete$3],item=>item(editor,forward)).filter(_=>editor.selection.isEditable());var deleteCommand=(editor,caret)=>{var result=findAction(editor,caret,false);result.fold(()=>{execNativeDeleteCommand(editor);paddEmptyBody(editor);},call);};var forwardDeleteCommand=(editor,caret)=>{var result=findAction(editor,caret,true);result.fold(()=>execNativeForwardDeleteCommand(editor),call);};var setup$p=(editor,caret)=>{editor.addCommand('delete',()=>{deleteCommand(editor,caret);});editor.addCommand('forwardDelete',()=>{forwardDeleteCommand(editor,caret);});};var SIGNIFICANT_MOVE=5;var LONGPRESS_DELAY=400;var getTouch=event=>{if(event.touches===undefined||event.touches.length!==1){return Optional.none();}return Optional.some(event.touches[0]);};var isFarEnough=(touch,data)=>{var distX=Math.abs(touch.clientX-data.x);var distY=Math.abs(touch.clientY-data.y);return distX>SIGNIFICANT_MOVE||distY>SIGNIFICANT_MOVE;};var setup$o=editor=>{var startData=value$2();var longpressFired=Cell(false);var debounceLongpress=last$1(e=>{editor.dispatch('longpress',_objectSpread(_objectSpread({},e),{},{type:'longpress'}));longpressFired.set(true);},LONGPRESS_DELAY);editor.on('touchstart',e=>{getTouch(e).each(touch=>{debounceLongpress.cancel();var data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e);longpressFired.set(false);startData.set(data);});},true);editor.on('touchmove',e=>{debounceLongpress.cancel();getTouch(e).each(touch=>{startData.on(data=>{if(isFarEnough(touch,data)){startData.clear();longpressFired.set(false);editor.dispatch('longpresscancel');}});});},true);editor.on('touchend touchcancel',e=>{debounceLongpress.cancel();if(e.type==='touchcancel'){return;}startData.get().filter(data=>data.target.isEqualNode(e.target)).each(()=>{if(longpressFired.get()){e.preventDefault();}else{editor.dispatch('tap',_objectSpread(_objectSpread({},e),{},{type:'tap'}));}});},true);};var isBlockElement=(blockElements,node)=>has$2(blockElements,node.nodeName);var isValidTarget=(schema,node)=>{if(isText$a(node)){return true;}else if(isElement$6(node)){return!isBlockElement(schema.getBlockElements(),node)&&!isBookmarkNode$1(node)&&!isTransparentBlock(schema,node);}else{return false;}};var hasBlockParent=(blockElements,root,node)=>{return exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),elm=>{return isBlockElement(blockElements,elm.dom);});};var shouldRemoveTextNode=(blockElements,node)=>{if(isText$a(node)){if(node.data.length===0){return true;}else if(/^\\s+$/.test(node.data)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling))){return true;}}return false;};var createRootBlock=editor=>editor.dom.create(getForcedRootBlock(editor),getForcedRootBlockAttrs(editor));var addRootBlocks=editor=>{var dom=editor.dom,selection=editor.selection;var schema=editor.schema;var blockElements=schema.getBlockElements();var startNode=selection.getStart();var rootNode=editor.getBody();var rootBlockNode;var tempNode;var wrapped=false;var forcedRootBlock=getForcedRootBlock(editor);if(!startNode||!isElement$6(startNode)){return;}var rootNodeName=rootNode.nodeName.toLowerCase();if(!schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())||hasBlockParent(blockElements,rootNode,startNode)){return;}var rng=selection.getRng();var{startContainer,startOffset,endContainer,endOffset}=rng;var restoreSelection=hasFocus(editor);var node=rootNode.firstChild;while(node){if(isElement$6(node)){updateElement(schema,node);}if(isValidTarget(schema,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node;node=node.nextSibling;dom.remove(tempNode);continue;}if(!rootBlockNode){rootBlockNode=createRootBlock(editor);rootNode.insertBefore(rootBlockNode,node);wrapped=true;}tempNode=node;node=node.nextSibling;rootBlockNode.appendChild(tempNode);}else{rootBlockNode=null;node=node.nextSibling;}}if(wrapped&&restoreSelection){rng.setStart(startContainer,startOffset);rng.setEnd(endContainer,endOffset);selection.setRng(rng);editor.nodeChanged();}};var insertEmptyLine=(editor,root,insertBlock)=>{var block=SugarElement.fromDom(createRootBlock(editor));var br=createPaddingBr();append$1(block,br);insertBlock(root,block);var rng=document.createRange();rng.setStartBefore(br.dom);rng.setEndBefore(br.dom);return rng;};var setup$n=editor=>{editor.on('NodeChange',curry(addRootBlocks,editor));};var hasClass=checkClassName=>node=>(' '+node.attr('class')+' ').indexOf(checkClassName)!==-1;var replaceMatchWithSpan=(editor,content,cls)=>{return function(match){var args=arguments,index=args[args.length-2];var prevChar=index>0?content.charAt(index-1):'';if(prevChar==='\"'){return match;}if(prevChar==='>'){var findStartTagIndex=content.lastIndexOf('<',index);if(findStartTagIndex!==-1){var tagHtml=content.substring(findStartTagIndex,index);if(tagHtml.indexOf('contenteditable=\"false\"')!==-1){return match;}}}return'<span class=\"'+cls+'\" data-mce-content=\"'+editor.dom.encode(args[0])+'\">'+editor.dom.encode(typeof args[1]==='string'?args[1]:args[0])+'</span>';};};var convertRegExpsToNonEditable=(editor,nonEditableRegExps,e)=>{var i=nonEditableRegExps.length,content=e.content;if(e.format==='raw'){return;}while(i--){content=content.replace(nonEditableRegExps[i],replaceMatchWithSpan(editor,content,getNonEditableClass(editor)));}e.content=content;};var setup$m=editor=>{var contentEditableAttrName='contenteditable';var editClass=' '+Tools.trim(getEditableClass(editor))+' ';var nonEditClass=' '+Tools.trim(getNonEditableClass(editor))+' ';var hasEditClass=hasClass(editClass);var hasNonEditClass=hasClass(nonEditClass);var nonEditableRegExps=getNonEditableRegExps(editor);if(nonEditableRegExps.length>0){editor.on('BeforeSetContent',e=>{convertRegExpsToNonEditable(editor,nonEditableRegExps,e);});}editor.parser.addAttributeFilter('class',nodes=>{var i=nodes.length;while(i--){var node=nodes[i];if(hasEditClass(node)){node.attr(contentEditableAttrName,'true');}else if(hasNonEditClass(node)){node.attr(contentEditableAttrName,'false');}}});editor.serializer.addAttributeFilter(contentEditableAttrName,nodes=>{var i=nodes.length;while(i--){var node=nodes[i];if(!hasEditClass(node)&&!hasNonEditClass(node)){continue;}if(nonEditableRegExps.length>0&&node.attr('data-mce-content')){node.name='#text';node.type=3;node.raw=true;node.value=node.attr('data-mce-content');}else{node.attr(contentEditableAttrName,null);}}});};var findBlockCaretContainer=editor=>descendant(SugarElement.fromDom(editor.getBody()),'*[data-mce-caret]').map(elm=>elm.dom).getOrNull();var showBlockCaretContainer=(editor,blockCaretContainer)=>{if(blockCaretContainer.hasAttribute('data-mce-caret')){showCaretContainerBlock(blockCaretContainer);editor.selection.setRng(editor.selection.getRng());editor.selection.scrollIntoView(blockCaretContainer);}};var handleBlockContainer=(editor,e)=>{var blockCaretContainer=findBlockCaretContainer(editor);if(!blockCaretContainer){return;}if(e.type==='compositionstart'){e.preventDefault();e.stopPropagation();showBlockCaretContainer(editor,blockCaretContainer);return;}if(hasContent(blockCaretContainer)){showBlockCaretContainer(editor,blockCaretContainer);editor.undoManager.add();}};var setup$l=editor=>{editor.on('keyup compositionstart',curry(handleBlockContainer,editor));};var isContentEditableFalse$3=isContentEditableFalse$b;var moveToCeFalseHorizontally=(direction,editor,range)=>moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$3);var moveToCeFalseVertically=(direction,editor,range)=>{var isBefore=caretPosition=>isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition);var isAfter=caretPosition=>isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition);return moveVertically(editor,direction,range,isBefore,isAfter,isContentEditableFalse$3);};var createTextBlock=editor=>{var textBlock=editor.dom.create(getForcedRootBlock(editor));textBlock.innerHTML='<br data-mce-bogus=\"1\">';return textBlock;};var exitPreBlock=(editor,direction,range)=>{var caretWalker=CaretWalker(editor.getBody());var getVisualCaretPosition$1=curry(getVisualCaretPosition,direction===1?caretWalker.next:caretWalker.prev);if(range.collapsed){var pre=editor.dom.getParent(range.startContainer,'PRE');if(!pre){return;}var caretPos=getVisualCaretPosition$1(CaretPosition.fromRangeStart(range));if(!caretPos){var newBlock=SugarElement.fromDom(createTextBlock(editor));if(direction===1){after$4(SugarElement.fromDom(pre),newBlock);}else{before$3(SugarElement.fromDom(pre),newBlock);}editor.selection.select(newBlock.dom,true);editor.selection.collapse();}}};var getHorizontalRange=(editor,forward)=>{var direction=forward?HDirection.Forwards:HDirection.Backwards;var range=editor.selection.getRng();return moveToCeFalseHorizontally(direction,editor,range).orThunk(()=>{exitPreBlock(editor,direction,range);return Optional.none();});};var getVerticalRange=(editor,down)=>{var direction=down?1:-1;var range=editor.selection.getRng();return moveToCeFalseVertically(direction,editor,range).orThunk(()=>{exitPreBlock(editor,direction,range);return Optional.none();});};var flipDirection=(selection,forward)=>{var elm=forward?selection.getEnd(true):selection.getStart(true);return isRtl(elm)?!forward:forward;};var moveH$2=(editor,forward)=>getHorizontalRange(editor,flipDirection(editor.selection,forward)).exists(newRange=>{moveToRange(editor,newRange);return true;});var moveV$4=(editor,down)=>getVerticalRange(editor,down).exists(newRange=>{moveToRange(editor,newRange);return true;});var moveToLineEndPoint$1=(editor,forward)=>{var isCefPosition=forward?isAfterContentEditableFalse:isBeforeContentEditableFalse;return moveToLineEndPoint$3(editor,forward,isCefPosition);};var selectToEndPoint=(editor,forward)=>getEdgeCefPosition(editor,!forward).map(pos=>{var rng=pos.toRange();var curRng=editor.selection.getRng();if(forward){rng.setStart(curRng.startContainer,curRng.startOffset);}else{rng.setEnd(curRng.endContainer,curRng.endOffset);}return rng;}).exists(rng=>{moveToRange(editor,rng);return true;});var isTarget=node=>contains$2(['figcaption'],name(node));var getClosestTargetBlock=(pos,root)=>{var isRoot=curry(eq,root);return closest$4(SugarElement.fromDom(pos.container()),isBlock$2,isRoot).filter(isTarget);};var isAtFirstOrLastLine=(root,forward,pos)=>forward?isAtLastLine(root.dom,pos):isAtFirstLine(root.dom,pos);var moveCaretToNewEmptyLine=(editor,forward)=>{var root=SugarElement.fromDom(editor.getBody());var pos=CaretPosition.fromRangeStart(editor.selection.getRng());return getClosestTargetBlock(pos,root).exists(()=>{if(isAtFirstOrLastLine(root,forward,pos)){var insertFn=forward?append$1:prepend;var rng=insertEmptyLine(editor,root,insertFn);editor.selection.setRng(rng);return true;}else{return false;}});};var moveV$3=(editor,forward)=>{if(editor.selection.isCollapsed()){return moveCaretToNewEmptyLine(editor,forward);}else{return false;}};var moveUp=(editor,details,summary)=>{var rng=editor.selection.getRng();var pos=CaretPosition.fromRangeStart(rng);var root=editor.getBody();if(root.firstChild===details&&isAtFirstLine(summary,pos)){editor.execCommand('InsertNewBlockBefore');return true;}else{return false;}};var moveDown=(editor,details)=>{var rng=editor.selection.getRng();var pos=CaretPosition.fromRangeStart(rng);var root=editor.getBody();if(root.lastChild===details&&isAtLastLine(details,pos)){editor.execCommand('InsertNewBlockAfter');return true;}else{return false;}};var move$2=(editor,forward)=>{if(forward){return Optional.from(editor.dom.getParent(editor.selection.getNode(),'details')).map(details=>moveDown(editor,details)).getOr(false);}else{return Optional.from(editor.dom.getParent(editor.selection.getNode(),'summary')).bind(summary=>Optional.from(editor.dom.getParent(summary,'details')).map(details=>moveUp(editor,details,summary))).getOr(false);}};var moveV$2=(editor,forward)=>move$2(editor,forward);var baseKeyPattern={shiftKey:false,altKey:false,ctrlKey:false,metaKey:false,keyCode:0};var defaultPatterns=patterns=>map$3(patterns,pattern=>_objectSpread(_objectSpread({},baseKeyPattern),pattern));var defaultDelayedPatterns=patterns=>map$3(patterns,pattern=>_objectSpread(_objectSpread({},baseKeyPattern),pattern));var matchesEvent=(pattern,evt)=>evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey;var match$1=(patterns,evt)=>bind$3(defaultPatterns(patterns),pattern=>matchesEvent(pattern,evt)?[pattern]:[]);var matchDelayed=(patterns,evt)=>bind$3(defaultDelayedPatterns(patterns),pattern=>matchesEvent(pattern,evt)?[pattern]:[]);var action=function action(f){for(var _len15=arguments.length,x=new Array(_len15>1?_len15-1:0),_key15=1;_key15<_len15;_key15++){x[_key15-1]=arguments[_key15];}return()=>f.apply(null,x);};var execute=(patterns,evt)=>find$2(match$1(patterns,evt),pattern=>pattern.action());var executeWithDelayedAction=(patterns,evt)=>findMap(matchDelayed(patterns,evt),pattern=>pattern.action());var moveH$1=(editor,forward)=>{var direction=forward?HDirection.Forwards:HDirection.Backwards;var range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(newRange=>{moveToRange(editor,newRange);return true;});};var moveV$1=(editor,down)=>{var direction=down?1:-1;var range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists(newRange=>{moveToRange(editor,newRange);return true;});};var moveToLineEndPoint=(editor,forward)=>{var isNearMedia=forward?isAfterMedia:isBeforeMedia;return moveToLineEndPoint$3(editor,forward,isNearMedia);};var adt=Adt.generate([{none:['current']},{first:['current']},{middle:['current','target']},{last:['current']}]);var none=current=>adt.none(current);var CellLocation=_objectSpread(_objectSpread({},adt),{},{none});var firstLayer=(scope,selector)=>{return filterFirstLayer(scope,selector,always);};var filterFirstLayer=(scope,selector,predicate)=>{return bind$3(children$1(scope),x=>{if(is$1(x,selector)){return predicate(x)?[x]:[];}else{return filterFirstLayer(x,selector,predicate);}});};var lookup$1=function lookup$1(tags,element){var isRoot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:never;if(isRoot(element)){return Optional.none();}if(contains$2(tags,name(element))){return Optional.some(element);}var isRootOrUpperTable=elm=>is$1(elm,'table')||isRoot(elm);return ancestor$3(element,tags.join(','),isRootOrUpperTable);};var cell=(element,isRoot)=>lookup$1(['td','th'],element,isRoot);var cells=ancestor=>firstLayer(ancestor,'th,td');var table=(element,isRoot)=>closest$3(element,'table',isRoot);var walk=function walk(all,current,index,direction){var isEligible=arguments.length>4&&arguments[4]!==undefined?arguments[4]:always;var forwards=direction===1;if(!forwards&&index<=0){return CellLocation.first(all[0]);}else if(forwards&&index>=all.length-1){return CellLocation.last(all[all.length-1]);}else{var newIndex=index+direction;var elem=all[newIndex];return isEligible(elem)?CellLocation.middle(current,elem):walk(all,current,newIndex,direction,isEligible);}};var detect=(current,isRoot)=>{return table(current,isRoot).bind(table=>{var all=cells(table);var index=findIndex$2(all,x=>eq(current,x));return index.map(index=>({index,all}));});};var next=(current,isEligible,isRoot)=>{var detection=detect(current,isRoot);return detection.fold(()=>{return CellLocation.none(current);},info=>{return walk(info.all,current,info.index,1,isEligible);});};var prev=(current,isEligible,isRoot)=>{var detection=detect(current,isRoot);return detection.fold(()=>{return CellLocation.none();},info=>{return walk(info.all,current,info.index,-1,isEligible);});};var deflate=(rect,delta)=>({left:rect.left-delta,top:rect.top-delta,right:rect.right+delta*2,bottom:rect.bottom+delta*2,width:rect.width+delta,height:rect.height+delta});var getCorners=(getYAxisValue,tds)=>bind$3(tds,td=>{var rect=deflate(clone$1(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}];});var findClosestCorner=(corners,x,y)=>foldl(corners,(acc,newCorner)=>acc.fold(()=>Optional.some(newCorner),oldCorner=>{var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y));var newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner);}),Optional.none());var getClosestCell=(getYAxisValue,isTargetCorner,table,x,y)=>{var cells=descendants(SugarElement.fromDom(table),'td,th,caption').map(e=>e.dom);var corners=filter$5(getCorners(getYAxisValue,cells),corner=>isTargetCorner(corner,y));return findClosestCorner(corners,x,y).map(corner=>corner.cell);};var getBottomValue=rect=>rect.bottom;var getTopValue=rect=>rect.top;var isAbove=(corner,y)=>corner.y<y;var isBelow=(corner,y)=>corner.y>y;var getClosestCellAbove=curry(getClosestCell,getBottomValue,isAbove);var getClosestCellBelow=curry(getClosestCell,getTopValue,isBelow);var findClosestPositionInAboveCell=(table,pos)=>head(pos.getClientRects()).bind(rect=>getClosestCellAbove(table,rect.left,rect.top)).bind(cell=>findClosestHorizontalPosition(getLastLinePositions(cell),pos));var findClosestPositionInBelowCell=(table,pos)=>last$3(pos.getClientRects()).bind(rect=>getClosestCellBelow(table,rect.left,rect.top)).bind(cell=>findClosestHorizontalPosition(getFirstLinePositions(cell),pos));var hasNextBreak=(getPositionsUntil,scope,lineInfo)=>lineInfo.breakAt.exists(breakPos=>getPositionsUntil(scope,breakPos).breakAt.isSome());var startsWithWrapBreak=lineInfo=>lineInfo.breakType===BreakType.Wrap&&lineInfo.positions.length===0;var startsWithBrBreak=lineInfo=>lineInfo.breakType===BreakType.Br&&lineInfo.positions.length===1;var isAtTableCellLine=(getPositionsUntil,scope,pos)=>{var lineInfo=getPositionsUntil(scope,pos);if(startsWithWrapBreak(lineInfo)||!isBr$6(pos.getNode())&&startsWithBrBreak(lineInfo)){return!hasNextBreak(getPositionsUntil,scope,lineInfo);}else{return lineInfo.breakAt.isNone();}};var isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine);var isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine);var isCaretAtStartOrEndOfTable=(forward,rng,table)=>{var caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists(pos=>pos.isEqual(caretPos));};var navigateHorizontally=(editor,forward,table,_td)=>{var rng=editor.selection.getRng();var direction=forward?1:-1;if(isFakeCaretTableBrowser()&&isCaretAtStartOrEndOfTable(forward,rng,table)){showCaret(direction,editor,table,!forward,false).each(newRng=>{moveToRange(editor,newRng);});return true;}return false;};var getClosestAbovePosition=(root,table,start)=>findClosestPositionInAboveCell(table,start).orThunk(()=>head(start.getClientRects()).bind(rect=>findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left))).getOr(CaretPosition.before(table));var getClosestBelowPosition=(root,table,start)=>findClosestPositionInBelowCell(table,start).orThunk(()=>head(start.getClientRects()).bind(rect=>findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left))).getOr(CaretPosition.after(table));var getTable=(previous,pos)=>{var node=pos.getNode(previous);return isTable$2(node)?Optional.some(node):Optional.none();};var renderBlock=(down,editor,table)=>{editor.undoManager.transact(()=>{var insertFn=down?after$4:before$3;var rng=insertEmptyLine(editor,SugarElement.fromDom(table),insertFn);moveToRange(editor,rng);});};var moveCaret=(editor,down,pos)=>{var table=down?getTable(true,pos):getTable(false,pos);var last=down===false;table.fold(()=>moveToRange(editor,pos.toRange()),table=>positionIn(last,editor.getBody()).filter(lastPos=>lastPos.isEqual(pos)).fold(()=>moveToRange(editor,pos.toRange()),_=>renderBlock(down,editor,table)));};var navigateVertically=(editor,down,table,td)=>{var rng=editor.selection.getRng();var pos=CaretPosition.fromRangeStart(rng);var root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){var newPos=getClosestAbovePosition(root,table,pos);moveCaret(editor,down,newPos);return true;}else if(down&&isAtLastTableCellLine(td,pos)){var _newPos=getClosestBelowPosition(root,table,pos);moveCaret(editor,down,_newPos);return true;}else{return false;}};var move$1=(editor,forward,mover)=>Optional.from(editor.dom.getParent(editor.selection.getNode(),'td,th')).bind(td=>Optional.from(editor.dom.getParent(td,'table')).map(table=>mover(editor,forward,table,td))).getOr(false);var moveH=(editor,forward)=>move$1(editor,forward,navigateHorizontally);var moveV=(editor,forward)=>move$1(editor,forward,navigateVertically);var getCellFirstCursorPosition=cell=>{var selection=SimSelection.exact(cell,0,cell,0);return toNative(selection);};var tabGo=(editor,isRoot,cell)=>{return cell.fold(Optional.none,Optional.none,(_current,next)=>{return first(next).map(cell=>{return getCellFirstCursorPosition(cell);});},current=>{editor.execCommand('mceTableInsertRowAfter');return tabForward(editor,isRoot,current);});};var tabForward=(editor,isRoot,cell)=>tabGo(editor,isRoot,next(cell,isEditable$3));var tabBackward=(editor,isRoot,cell)=>tabGo(editor,isRoot,prev(cell,isEditable$3));var handleTab=(editor,forward)=>{var rootElements=['table','li','dl'];var body=SugarElement.fromDom(editor.getBody());var isRoot=element=>{var name$1=name(element);return eq(element,body)||contains$2(rootElements,name$1);};var rng=editor.selection.getRng();var container=SugarElement.fromDom(!forward?rng.startContainer:rng.endContainer);return cell(container,isRoot).map(cell=>{table(cell,isRoot).each(table=>{editor.model.table.clearSelectedCells(table.dom);});editor.selection.collapse(!forward);var navigation=!forward?tabBackward:tabForward;var rng=navigation(editor,isRoot,cell);rng.each(range=>{editor.selection.setRng(range);});return true;}).getOr(false);};var executeKeydownOverride$4=(editor,caret,evt)=>{var isMac=Env.os.isMacOS()||Env.os.isiOS();execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,true)},{keyCode:VK.LEFT,action:action(moveH$2,editor,false)},{keyCode:VK.UP,action:action(moveV$4,editor,false)},{keyCode:VK.DOWN,action:action(moveV$4,editor,true)},...(isMac?[{keyCode:VK.UP,action:action(selectToEndPoint,editor,false),metaKey:true,shiftKey:true},{keyCode:VK.DOWN,action:action(selectToEndPoint,editor,true),metaKey:true,shiftKey:true}]:[]),{keyCode:VK.RIGHT,action:action(moveH,editor,true)},{keyCode:VK.LEFT,action:action(moveH,editor,false)},{keyCode:VK.UP,action:action(moveV,editor,false)},{keyCode:VK.DOWN,action:action(moveV,editor,true)},{keyCode:VK.UP,action:action(moveV,editor,false)},{keyCode:VK.UP,action:action(moveV$2,editor,false)},{keyCode:VK.DOWN,action:action(moveV$2,editor,true)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,true)},{keyCode:VK.LEFT,action:action(moveH$1,editor,false)},{keyCode:VK.UP,action:action(moveV$1,editor,false)},{keyCode:VK.DOWN,action:action(moveV$1,editor,true)},{keyCode:VK.RIGHT,action:action(move$3,editor,caret,true)},{keyCode:VK.LEFT,action:action(move$3,editor,caret,false)},{keyCode:VK.RIGHT,ctrlKey:!isMac,altKey:isMac,action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!isMac,altKey:isMac,action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$3,editor,false)},{keyCode:VK.DOWN,action:action(moveV$3,editor,true)}],evt).each(_=>{evt.preventDefault();});};var setup$k=(editor,caret)=>{editor.on('keydown',evt=>{if(!evt.isDefaultPrevented()){executeKeydownOverride$4(editor,caret,evt);}});};var point=(container,offset)=>({container,offset});var DOM$7=DOMUtils.DOM;var alwaysNext=startNode=>node=>startNode===node?-1:0;var isBoundary=dom=>node=>dom.isBlock(node)||contains$2(['BR','IMG','HR','INPUT'],node.nodeName)||dom.getContentEditable(node)==='false';var textBefore=(node,offset,rootNode)=>{if(isText$a(node)&&offset>=0){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.backwards(node,offset,alwaysNext(node),rootNode)).map(prev=>point(prev.container,prev.container.data.length));}};var textAfter=(node,offset,rootNode)=>{if(isText$a(node)&&offset>=node.length){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.forwards(node,offset,alwaysNext(node),rootNode)).map(prev=>point(prev.container,0));}};var scanLeft=(node,offset,rootNode)=>{if(!isText$a(node)){return Optional.none();}var text=node.data;if(offset>=0&&offset<=text.length){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.backwards(node,offset,alwaysNext(node),rootNode)).bind(prev=>{var prevText=prev.container.data;return scanLeft(prev.container,offset+prevText.length,rootNode);});}};var scanRight=(node,offset,rootNode)=>{if(!isText$a(node)){return Optional.none();}var text=node.data;if(offset<=text.length){return Optional.some(point(node,offset));}else{var textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.forwards(node,offset,alwaysNext(node),rootNode)).bind(next=>scanRight(next.container,offset-text.length,rootNode));}};var repeatLeft=(dom,node,offset,process,rootNode)=>{var search=TextSeeker(dom,isBoundary(dom));return Optional.from(search.backwards(node,offset,process,rootNode));};var isValidTextRange=rng=>rng.collapsed&&isText$a(rng.startContainer);var getText=rng=>trim$1(rng.toString().replace(/\\u00A0/g,' '));var isWhitespace=chr=>chr!==''&&' \\xA0\\f\\n\\r\\t\\x0B'.indexOf(chr)!==-1;var stripTrigger=(text,trigger)=>text.substring(trigger.length);var findTrigger=(text,index,trigger)=>{var i;var firstChar=trigger.charAt(0);for(i=index-1;i>=0;i--){var char=text.charAt(i);if(isWhitespace(char)){return Optional.none();}if(firstChar===char&&contains$1(text,trigger,i,index)){break;}}return Optional.some(i);};var findStart=function findStart(dom,initRange,trigger){var minChars=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;if(!isValidTextRange(initRange)){return Optional.none();}var buffer={text:'',offset:0};var findTriggerIndex=(element,offset,text)=>{buffer.text=text+buffer.text;buffer.offset+=offset;return findTrigger(buffer.text,buffer.offset,trigger).getOr(offset);};var root=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,findTriggerIndex,root).bind(spot=>{var range=initRange.cloneRange();range.setStart(spot.container,spot.offset);range.setEnd(initRange.endContainer,initRange.endOffset);if(range.collapsed){return Optional.none();}var text=getText(range);var triggerIndex=text.lastIndexOf(trigger);if(triggerIndex!==0||stripTrigger(text,trigger).length<minChars){return Optional.none();}else{return Optional.some({text:stripTrigger(text,trigger),range,trigger});}});};var getContext=function getContext(dom,initRange,trigger){var minChars=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return detect$1(SugarElement.fromDom(initRange.startContainer)).fold(()=>findStart(dom,initRange,trigger,minChars),elm=>{var range=dom.createRng();range.selectNode(elm.dom);var text=getText(range);return Optional.some({range,text:stripTrigger(text,trigger),trigger});});};var isText$1=node=>node.nodeType===TEXT;var isElement=node=>node.nodeType===ELEMENT;var toLast=node=>{if(isText$1(node)){return point(node,node.data.length);}else{var _children5=node.childNodes;return _children5.length>0?toLast(_children5[_children5.length-1]):point(node,_children5.length);}};var toLeaf=(node,offset)=>{var children=node.childNodes;if(children.length>0&&offset<children.length){return toLeaf(children[offset],0);}else if(children.length>0&&isElement(node)&&children.length===offset){return toLast(children[children.length-1]);}else{return point(node,offset);}};var isPreviousCharContent=(dom,leaf)=>{var _a;var root=(_a=dom.getParent(leaf.container,dom.isBlock))!==null&&_a!==void 0?_a:dom.getRoot();return repeatLeft(dom,leaf.container,leaf.offset,(_element,offset)=>offset===0?-1:offset,root).filter(spot=>{var char=spot.container.data.charAt(spot.offset-1);return!isWhitespace(char);}).isSome();};var isStartOfWord=dom=>rng=>{var leaf=toLeaf(rng.startContainer,rng.startOffset);return!isPreviousCharContent(dom,leaf);};var getTriggerContext=(dom,initRange,database)=>findMap(database.triggers,trigger=>getContext(dom,initRange,trigger));var lookup=(editor,getDatabase)=>{var database=getDatabase();var rng=editor.selection.getRng();return getTriggerContext(editor.dom,rng,database).bind(context=>lookupWithContext(editor,getDatabase,context));};var lookupWithContext=function lookupWithContext(editor,getDatabase,context){var fetchOptions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var _a;var database=getDatabase();var rng=editor.selection.getRng();var startText=(_a=rng.startContainer.nodeValue)!==null&&_a!==void 0?_a:'';var autocompleters=filter$5(database.lookupByTrigger(context.trigger),autocompleter=>context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk(()=>isStartOfWord(editor.dom))(context.range,startText,context.text));if(autocompleters.length===0){return Optional.none();}var lookupData=Promise.all(map$3(autocompleters,ac=>{var fetchResult=ac.fetch(context.text,ac.maxResults,fetchOptions);return fetchResult.then(results=>({matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn}));}));return Optional.some({lookupData,context});};var SimpleResultType;(function(SimpleResultType){SimpleResultType[SimpleResultType['Error']=0]='Error';SimpleResultType[SimpleResultType['Value']=1]='Value';})(SimpleResultType||(SimpleResultType={}));var fold$1=(res,onError,onValue)=>res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue);var partition=results=>{var values=[];var errors=[];each$e(results,obj=>{fold$1(obj,err=>errors.push(err),val=>values.push(val));});return{values,errors};};var mapError=(res,f)=>{if(res.stype===SimpleResultType.Error){return{stype:SimpleResultType.Error,serror:f(res.serror)};}else{return res;}};var map=(res,f)=>{if(res.stype===SimpleResultType.Value){return{stype:SimpleResultType.Value,svalue:f(res.svalue)};}else{return res;}};var bind$1=(res,f)=>{if(res.stype===SimpleResultType.Value){return f(res.svalue);}else{return res;}};var bindError=(res,f)=>{if(res.stype===SimpleResultType.Error){return f(res.serror);}else{return res;}};var svalue=v=>({stype:SimpleResultType.Value,svalue:v});var serror=e=>({stype:SimpleResultType.Error,serror:e});var toResult=res=>fold$1(res,Result.error,Result.value);var fromResult=res=>res.fold(serror,svalue);var SimpleResult={fromResult,toResult,svalue,partition,serror,bind:bind$1,bindError,map,mapError,fold:fold$1};var formatObj=input=>{return isObject(input)&&keys(input).length>100?' removed due to size':JSON.stringify(input,null,2);};var formatErrors=errors=>{var es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant('... (only showing first ten failures)')}]):errors;return map$3(es,e=>{return'Failed path: ('+e.path.join(' > ')+')\\n'+e.getErrorInfo();});};var nu=(path,getErrorInfo)=>{return SimpleResult.serror([{path,getErrorInfo}]);};var missingRequired=(path,key,obj)=>nu(path,()=>'Could not find valid *required* value for \"'+key+'\" in '+formatObj(obj));var missingKey=(path,key)=>nu(path,()=>'Choice schema did not contain choice key: \"'+key+'\"');var missingBranch=(path,branches,branch)=>nu(path,()=>'The chosen schema: \"'+branch+'\" did not exist in branches: '+formatObj(branches));var custom=(path,err)=>nu(path,constant(err));var chooseFrom=(path,input,branches,ch)=>{var fields=get$a(branches,ch);return fields.fold(()=>missingBranch(path,branches,ch),vp=>vp.extract(path.concat(['branch: '+ch]),input));};var choose$1=(key,branches)=>{var extract=(path,input)=>{var choice=get$a(input,key);return choice.fold(()=>missingKey(path,key),chosen=>chooseFrom(path,input,branches,chosen));};var toString=()=>'chooseOn('+key+'). Possible values: '+keys(branches);return{extract,toString};};var shallow=(old,nu)=>{return nu;};var deep=(old,nu)=>{var bothObjects=isPlainObject(old)&&isPlainObject(nu);return bothObjects?deepMerge(old,nu):nu;};var baseMerge=merger=>{return function(){if(arguments.length===0){throw new Error(\"Can't merge zero objects\");}var ret={};for(var j=0;j<arguments.length;j++){var curObject=j<0||arguments.length<=j?undefined:arguments[j];for(var key in curObject){if(has$2(curObject,key)){ret[key]=merger(ret[key],curObject[key]);}}}return ret;};};var deepMerge=baseMerge(deep);var merge=baseMerge(shallow);var required=()=>({tag:'required',process:{}});var defaultedThunk=fallbackThunk=>({tag:'defaultedThunk',process:fallbackThunk});var defaulted$1=fallback=>defaultedThunk(constant(fallback));var asOption=()=>({tag:'option',process:{}});var mergeValues=(values,base)=>values.length>0?SimpleResult.svalue(deepMerge(base,merge.apply(undefined,values))):SimpleResult.svalue(base);var mergeErrors=errors=>compose(SimpleResult.serror,flatten)(errors);var consolidateObj=(objects,base)=>{var partition=SimpleResult.partition(objects);return partition.errors.length>0?mergeErrors(partition.errors):mergeValues(partition.values,base);};var consolidateArr=objects=>{var partitions=SimpleResult.partition(objects);return partitions.errors.length>0?mergeErrors(partitions.errors):SimpleResult.svalue(partitions.values);};var ResultCombine={consolidateObj,consolidateArr};var field$1=(key,newKey,presence,prop)=>({tag:'field',key,newKey,presence,prop});var customField$1=(newKey,instantiator)=>({tag:'custom',newKey,instantiator});var fold=(value,ifField,ifCustom)=>{switch(value.tag){case'field':return ifField(value.key,value.newKey,value.presence,value.prop);case'custom':return ifCustom(value.newKey,value.instantiator);}};var value=validator=>{var extract=(path,val)=>{return SimpleResult.bindError(validator(val),err=>custom(path,err));};var toString=constant('val');return{extract,toString};};var anyValue$1=value(SimpleResult.svalue);var requiredAccess=(path,obj,key,bundle)=>get$a(obj,key).fold(()=>missingRequired(path,key,obj),bundle);var fallbackAccess=(obj,key,fallback,bundle)=>{var v=get$a(obj,key).getOrThunk(()=>fallback(obj));return bundle(v);};var optionAccess=(obj,key,bundle)=>bundle(get$a(obj,key));var optionDefaultedAccess=(obj,key,fallback,bundle)=>{var opt=get$a(obj,key).map(val=>val===true?fallback(obj):val);return bundle(opt);};var extractField=(field,path,obj,key,prop)=>{var bundle=av=>prop.extract(path.concat([key]),av);var bundleAsOption=optValue=>optValue.fold(()=>SimpleResult.svalue(Optional.none()),ov=>{var result=prop.extract(path.concat([key]),ov);return SimpleResult.map(result,Optional.some);});switch(field.tag){case'required':return requiredAccess(path,obj,key,bundle);case'defaultedThunk':return fallbackAccess(obj,key,field.process,bundle);case'option':return optionAccess(obj,key,bundleAsOption);case'defaultedOptionThunk':return optionDefaultedAccess(obj,key,field.process,bundleAsOption);case'mergeWithThunk':{return fallbackAccess(obj,key,constant({}),v=>{var result=deepMerge(field.process(obj),v);return bundle(result);});}}};var extractFields=(path,obj,fields)=>{var success={};var errors=[];for(var _field of fields){fold(_field,(key,newKey,presence,prop)=>{var result=extractField(presence,path,obj,key,prop);SimpleResult.fold(result,err=>{errors.push(...err);},res=>{success[newKey]=res;});},(newKey,instantiator)=>{success[newKey]=instantiator(obj);});}return errors.length>0?SimpleResult.serror(errors):SimpleResult.svalue(success);};var objOf=values=>{var extract=(path,o)=>extractFields(path,o,values);var toString=()=>{var fieldStrings=map$3(values,value=>fold(value,(key,_okey,_presence,prop)=>key+' -> '+prop.toString(),(newKey,_instantiator)=>'state('+newKey+')'));return'obj{\\n'+fieldStrings.join('\\n')+'}';};return{extract,toString};};var arrOf=prop=>{var extract=(path,array)=>{var results=map$3(array,(a,i)=>prop.extract(path.concat(['['+i+']']),a));return ResultCombine.consolidateArr(results);};var toString=()=>'array('+prop.toString()+')';return{extract,toString};};var valueOf=validator=>value(v=>validator(v).fold(SimpleResult.serror,SimpleResult.svalue));var extractValue=(label,prop,obj)=>{var res=prop.extract([label],obj);return SimpleResult.mapError(res,errs=>({input:obj,errors:errs}));};var asRaw=(label,prop,obj)=>SimpleResult.toResult(extractValue(label,prop,obj));var formatError=errInfo=>{return'Errors: \\n'+formatErrors(errInfo.errors).join('\\n')+'\\n\\nInput object: '+formatObj(errInfo.input);};var choose=(key,branches)=>choose$1(key,map$2(branches,objOf));var anyValue=constant(anyValue$1);var typedValue=(validator,expectedType)=>value(a=>{var actualType=typeof a;return validator(a)?SimpleResult.svalue(a):SimpleResult.serror(\"Expected type: \".concat(expectedType,\" but got: \").concat(actualType));});var number=typedValue(isNumber,'number');var string=typedValue(isString,'string');var boolean=typedValue(isBoolean,'boolean');var functionProcessor=typedValue(isFunction,'function');var field=field$1;var customField=customField$1;var validateEnum=values=>valueOf(value=>contains$2(values,value)?Result.value(value):Result.error(\"Unsupported value: \\\"\".concat(value,\"\\\", choose one of \\\"\").concat(values.join(', '),\"\\\".\")));var requiredOf=(key,schema)=>field(key,key,required(),schema);var requiredString=key=>requiredOf(key,string);var requiredFunction=key=>requiredOf(key,functionProcessor);var requiredArrayOf=(key,schema)=>field(key,key,required(),arrOf(schema));var optionOf=(key,schema)=>field(key,key,asOption(),schema);var optionString=key=>optionOf(key,string);var optionFunction=key=>optionOf(key,functionProcessor);var defaulted=(key,fallback)=>field(key,key,defaulted$1(fallback),anyValue());var defaultedOf=(key,fallback,schema)=>field(key,key,defaulted$1(fallback),schema);var defaultedNumber=(key,fallback)=>defaultedOf(key,fallback,number);var defaultedString=(key,fallback)=>defaultedOf(key,fallback,string);var defaultedStringEnum=(key,fallback,values)=>defaultedOf(key,fallback,validateEnum(values));var defaultedBoolean=(key,fallback)=>defaultedOf(key,fallback,boolean);var defaultedFunction=(key,fallback)=>defaultedOf(key,fallback,functionProcessor);var defaultedArrayOf=(key,fallback,schema)=>defaultedOf(key,fallback,arrOf(schema));var type=requiredString('type');var fetch$1=requiredFunction('fetch');var onAction=requiredFunction('onAction');var onSetup=defaultedFunction('onSetup',()=>noop);var optionalText=optionString('text');var optionalIcon=optionString('icon');var optionalTooltip=optionString('tooltip');var optionalLabel=optionString('label');var active=defaultedBoolean('active',false);var enabled=defaultedBoolean('enabled',true);var primary=defaultedBoolean('primary',false);var defaultedColumns=num=>defaulted('columns',num);var defaultedType=type=>defaultedString('type',type);var autocompleterSchema=objOf([type,requiredString('trigger'),defaultedNumber('minChars',1),defaultedColumns(1),defaultedNumber('maxResults',10),optionFunction('matches'),fetch$1,onAction,defaultedArrayOf('highlightOn',[],string)]);var createAutocompleter=spec=>asRaw('Autocompleter',autocompleterSchema,_objectSpread({trigger:spec.ch},spec));var baseToolbarButtonFields=[enabled,optionalTooltip,optionalIcon,optionalText,onSetup];var baseToolbarToggleButtonFields=[active].concat(baseToolbarButtonFields);var contextBarFields=[defaultedFunction('predicate',never),defaultedStringEnum('scope','node',['node','editor']),defaultedStringEnum('position','selection',['node','selection','line'])];var contextButtonFields=baseToolbarButtonFields.concat([defaultedType('contextformbutton'),primary,onAction,customField('original',identity)]);var contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType('contextformbutton'),primary,onAction,customField('original',identity)]);var launchButtonFields=baseToolbarButtonFields.concat([defaultedType('contextformbutton')]);var launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType('contextformtogglebutton')]);var toggleOrNormal=choose('type',{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields});objOf([defaultedType('contextform'),defaultedFunction('initValue',constant('')),optionalLabel,requiredArrayOf('commands',toggleOrNormal),optionOf('launch',choose('type',{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields));var register$2=editor=>{var popups=editor.ui.registry.getAll().popups;var dataset=map$2(popups,popup=>createAutocompleter(popup).fold(err=>{throw new Error(formatError(err));},identity));var triggers=stringArray(mapToArray(dataset,v=>v.trigger));var datasetValues=values(dataset);var lookupByTrigger=trigger=>filter$5(datasetValues,dv=>dv.trigger===trigger);return{dataset,triggers,lookupByTrigger};};var setupEditorInput=(editor,api)=>{var update=last$1(api.load,50);editor.on('keypress compositionend',e=>{if(e.which===27){return;}update.throttle();});editor.on('keydown',e=>{var keyCode=e.which;if(keyCode===8){update.throttle();}else if(keyCode===27){api.cancelIfNecessary();}});editor.on('remove',update.cancel);};var setup$j=editor=>{var activeAutocompleter=value$2();var uiActive=Cell(false);var isActive=activeAutocompleter.isSet;var cancelIfNecessary=()=>{if(isActive()){removeAutocompleterDecoration(editor);fireAutocompleterEnd(editor);uiActive.set(false);activeAutocompleter.clear();}};var commenceIfNecessary=context=>{if(!isActive()){addAutocompleterDecoration(editor,context.range);activeAutocompleter.set({trigger:context.trigger,matchLength:context.text.length});}};var getAutocompleters=cached(()=>register$2(editor));var doLookup=fetchOptions=>activeAutocompleter.get().map(ac=>getContext(editor.dom,editor.selection.getRng(),ac.trigger).bind(newContext=>lookupWithContext(editor,getAutocompleters,newContext,fetchOptions))).getOrThunk(()=>lookup(editor,getAutocompleters));var load=fetchOptions=>{doLookup(fetchOptions).fold(cancelIfNecessary,lookupInfo=>{commenceIfNecessary(lookupInfo.context);lookupInfo.lookupData.then(lookupData=>{activeAutocompleter.get().map(ac=>{var context=lookupInfo.context;if(ac.trigger===context.trigger){if(context.text.length-ac.matchLength>=10){cancelIfNecessary();}else{activeAutocompleter.set(_objectSpread(_objectSpread({},ac),{},{matchLength:context.text.length}));if(uiActive.get()){fireAutocompleterUpdate(editor,{lookupData});}else{uiActive.set(true);fireAutocompleterStart(editor,{lookupData});}}}});});});};editor.addCommand('mceAutocompleterReload',(_ui,value)=>{var fetchOptions=isObject(value)?value.fetchOptions:{};load(fetchOptions);});editor.addCommand('mceAutocompleterClose',cancelIfNecessary);setupEditorInput(editor,{cancelIfNecessary,load});};var browser$1=detect$2().browser;var isSafari=browser$1.isSafari();var emptyNodeContents=node=>fillWithPaddingBr(SugarElement.fromDom(node));var isEntireNodeSelected=(rng,node)=>{var _a;return rng.startOffset===0&&rng.endOffset===((_a=node.textContent)===null||_a===void 0?void 0:_a.length);};var getParentDetailsElementAtPos=(dom,pos)=>Optional.from(dom.getParent(pos.container(),'details'));var isInDetailsElement=(dom,pos)=>getParentDetailsElementAtPos(dom,pos).isSome();var getDetailsElements=(dom,rng)=>{var startDetails=Optional.from(dom.getParent(rng.startContainer,'details'));var endDetails=Optional.from(dom.getParent(rng.endContainer,'details'));if(startDetails.isSome()||endDetails.isSome()){var startSummary=startDetails.bind(details=>Optional.from(dom.select('summary',details)[0]));return Optional.some({startSummary,startDetails,endDetails});}else{return Optional.none();}};var isCaretInTheBeginningOf=(caretPos,element)=>firstPositionIn(element).exists(pos=>pos.isEqual(caretPos));var isCaretInTheEndOf=(caretPos,element)=>{return lastPositionIn(element).exists(pos=>{if(isBr$6(pos.getNode())){return prevPosition(element,pos).exists(pos2=>pos2.isEqual(caretPos))||pos.isEqual(caretPos);}else{return pos.isEqual(caretPos);}});};var isCaretAtStartOfSummary=(caretPos,detailsElements)=>detailsElements.startSummary.exists(summary=>isCaretInTheBeginningOf(caretPos,summary));var isCaretAtEndOfSummary=(caretPos,detailsElements)=>detailsElements.startSummary.exists(summary=>isCaretInTheEndOf(caretPos,summary));var isCaretInFirstPositionInBody=(caretPos,detailsElements)=>detailsElements.startDetails.exists(details=>prevPosition(details,caretPos).forall(pos=>detailsElements.startSummary.exists(summary=>!summary.contains(caretPos.container())&&summary.contains(pos.container()))));var isCaretInLastPositionInBody=(root,caretPos,detailsElements)=>detailsElements.startDetails.exists(details=>nextPosition(root,caretPos).forall(pos=>!details.contains(pos.container())));var setCaretToPosition=(editor,position)=>{var node=position.getNode();if(!isUndefined(node)){editor.selection.setCursorLocation(node,position.offset());}};var moveCaretToDetailsPos=(editor,pos,forward)=>{var details=editor.dom.getParent(pos.container(),'details');if(details&&!details.open){var summary=editor.dom.select('summary',details)[0];if(summary){var newPos=forward?firstPositionIn(summary):lastPositionIn(summary);newPos.each(pos=>setCaretToPosition(editor,pos));}}else{setCaretToPosition(editor,pos);}};var isPartialDelete=(rng,detailsElements)=>{var containsStart=element=>element.contains(rng.startContainer);var containsEnd=element=>element.contains(rng.endContainer);var startInSummary=detailsElements.startSummary.exists(containsStart);var endInSummary=detailsElements.startSummary.exists(containsEnd);var isPartiallySelectedDetailsElements=detailsElements.startDetails.forall(startDetails=>detailsElements.endDetails.forall(endDetails=>startDetails!==endDetails));var isInPartiallySelectedSummary=(startInSummary||endInSummary)&&!(startInSummary&&endInSummary);return isInPartiallySelectedSummary||isPartiallySelectedDetailsElements;};var shouldPreventDeleteIntoDetails=(editor,forward,granularity)=>{var{dom,selection}=editor;var root=editor.getBody();if(granularity==='character'){var caretPos=CaretPosition.fromRangeStart(selection.getRng());var parentBlock=dom.getParent(caretPos.container(),dom.isBlock);var parentDetailsAtCaret=getParentDetailsElementAtPos(dom,caretPos);var inEmptyParentBlock=parentBlock&&dom.isEmpty(parentBlock);var isFirstBlock=isNull(parentBlock===null||parentBlock===void 0?void 0:parentBlock.previousSibling);var isLastBlock=isNull(parentBlock===null||parentBlock===void 0?void 0:parentBlock.nextSibling);if(inEmptyParentBlock){var firstOrLast=forward?isLastBlock:isFirstBlock;if(firstOrLast){var isBeforeAfterDetails=navigate(!forward,root,caretPos).exists(pos=>{return isInDetailsElement(dom,pos)&&!equals(parentDetailsAtCaret,getParentDetailsElementAtPos(dom,pos));});if(isBeforeAfterDetails){return true;}}}return navigate(forward,root,caretPos).fold(never,pos=>{var parentDetailsAtNewPos=getParentDetailsElementAtPos(dom,pos);if(isInDetailsElement(dom,pos)&&!equals(parentDetailsAtCaret,parentDetailsAtNewPos)){if(!forward){moveCaretToDetailsPos(editor,pos,false);}if(parentBlock&&inEmptyParentBlock){if(forward&&isFirstBlock){return true;}else if(!forward&&isLastBlock){return true;}moveCaretToDetailsPos(editor,pos,forward);editor.dom.remove(parentBlock);}return true;}else{return false;}});}else{return false;}};var shouldPreventDeleteSummaryAction=(editor,detailElements,forward,granularity)=>{var selection=editor.selection;var rng=selection.getRng();var caretPos=CaretPosition.fromRangeStart(rng);var root=editor.getBody();if(granularity==='selection'){return isPartialDelete(rng,detailElements);}else if(forward){return isCaretAtEndOfSummary(caretPos,detailElements)||isCaretInLastPositionInBody(root,caretPos,detailElements);}else{return isCaretAtStartOfSummary(caretPos,detailElements)||isCaretInFirstPositionInBody(caretPos,detailElements);}};var shouldPreventDeleteAction=(editor,forward,granularity)=>getDetailsElements(editor.dom,editor.selection.getRng()).fold(()=>shouldPreventDeleteIntoDetails(editor,forward,granularity),detailsElements=>shouldPreventDeleteSummaryAction(editor,detailsElements,forward,granularity)||shouldPreventDeleteIntoDetails(editor,forward,granularity));var handleDeleteActionSafari=(editor,forward,granularity)=>{var selection=editor.selection;var node=selection.getNode();var rng=selection.getRng();var caretPos=CaretPosition.fromRangeStart(rng);if(isSummary(node)){if(granularity==='selection'&&isEntireNodeSelected(rng,node)||willDeleteLastPositionInElement(forward,caretPos,node)){emptyNodeContents(node);}else{editor.undoManager.transact(()=>{var sel=selection.getSel();var{anchorNode,anchorOffset,focusNode,focusOffset}=sel!==null&&sel!==void 0?sel:{};var applySelection=()=>{if(isNonNullable(anchorNode)&&isNonNullable(anchorOffset)&&isNonNullable(focusNode)&&isNonNullable(focusOffset)){sel===null||sel===void 0?void 0:sel.setBaseAndExtent(anchorNode,anchorOffset,focusNode,focusOffset);}};var updateSelection=()=>{anchorNode=sel===null||sel===void 0?void 0:sel.anchorNode;anchorOffset=sel===null||sel===void 0?void 0:sel.anchorOffset;focusNode=sel===null||sel===void 0?void 0:sel.focusNode;focusOffset=sel===null||sel===void 0?void 0:sel.focusOffset;};var appendAllChildNodes=(from,to)=>{each$e(from.childNodes,child=>{if(isNode(child)){to.appendChild(child);}});};var container=editor.dom.create('span',{'data-mce-bogus':'1'});appendAllChildNodes(node,container);node.appendChild(container);applySelection();if(granularity==='word'||granularity==='line'){sel===null||sel===void 0?void 0:sel.modify('extend',forward?'right':'left',granularity);}if(!selection.isCollapsed()&&isEntireNodeSelected(selection.getRng(),container)){emptyNodeContents(node);}else{editor.execCommand(forward?'ForwardDelete':'Delete');updateSelection();appendAllChildNodes(container,node);applySelection();}editor.dom.remove(container);});}return true;}else{return false;}};var backspaceDelete=(editor,forward,granularity)=>shouldPreventDeleteAction(editor,forward,granularity)||isSafari&&handleDeleteActionSafari(editor,forward,granularity)?Optional.some(noop):Optional.none();var createAndFireInputEvent=eventType=>function(editor,inputType){var specifics=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var target=editor.getBody();var overrides={bubbles:true,composed:true,data:null,isComposing:false,detail:0,view:null,target,currentTarget:target,eventPhase:Event.AT_TARGET,originalTarget:target,explicitOriginalTarget:target,isTrusted:false,srcElement:target,cancelable:false,preventDefault:noop,inputType};var input=clone$3(new InputEvent(eventType));return editor.dispatch(eventType,_objectSpread(_objectSpread(_objectSpread({},input),overrides),specifics));};var fireInputEvent=createAndFireInputEvent('input');var fireBeforeInputEvent=createAndFireInputEvent('beforeinput');var platform$2=detect$2();var os=platform$2.os;var isMacOSOriOS=os.isMacOS()||os.isiOS();var browser=platform$2.browser;var isFirefox=browser.isFirefox();var executeKeydownOverride$3=(editor,caret,evt)=>{var inputType=evt.keyCode===VK.BACKSPACE?'deleteContentBackward':'deleteContentForward';var isCollapsed=editor.selection.isCollapsed();var unmodifiedGranularity=isCollapsed?'character':'selection';var getModifiedGranularity=isWord=>{if(isCollapsed){return isWord?'word':'line';}else{return'selection';}};executeWithDelayedAction([{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,caret,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,caret,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$a,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$a,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,false,unmodifiedGranularity)},{keyCode:VK.DELETE,action:action(backspaceDelete,editor,true,unmodifiedGranularity)},...(isMacOSOriOS?[{keyCode:VK.BACKSPACE,altKey:true,action:action(backspaceDelete,editor,false,getModifiedGranularity(true))},{keyCode:VK.DELETE,altKey:true,action:action(backspaceDelete,editor,true,getModifiedGranularity(true))},{keyCode:VK.BACKSPACE,metaKey:true,action:action(backspaceDelete,editor,false,getModifiedGranularity(false))}]:[{keyCode:VK.BACKSPACE,ctrlKey:true,action:action(backspaceDelete,editor,false,getModifiedGranularity(true))},{keyCode:VK.DELETE,ctrlKey:true,action:action(backspaceDelete,editor,true,getModifiedGranularity(true))}]),{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,true)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,false)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,true)}],evt).filter(_=>editor.selection.isEditable()).each(applyAction=>{evt.preventDefault();var beforeInput=fireBeforeInputEvent(editor,inputType);if(!beforeInput.isDefaultPrevented()){applyAction();fireInputEvent(editor,inputType);}});};var executeKeyupOverride=(editor,evt,isBackspaceKeydown)=>execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)},...(isMacOSOriOS?[{keyCode:VK.BACKSPACE,altKey:true,action:action(refreshCaret,editor)},{keyCode:VK.DELETE,altKey:true,action:action(refreshCaret,editor)},...(isBackspaceKeydown?[{keyCode:isFirefox?224:91,action:action(refreshCaret,editor)}]:[])]:[{keyCode:VK.BACKSPACE,ctrlKey:true,action:action(refreshCaret,editor)},{keyCode:VK.DELETE,ctrlKey:true,action:action(refreshCaret,editor)}])],evt);var setup$i=(editor,caret)=>{var isBackspaceKeydown=false;editor.on('keydown',evt=>{isBackspaceKeydown=evt.keyCode===VK.BACKSPACE;if(!evt.isDefaultPrevented()){executeKeydownOverride$3(editor,caret,evt);}});editor.on('keyup',evt=>{if(!evt.isDefaultPrevented()){executeKeyupOverride(editor,evt,isBackspaceKeydown);}isBackspaceKeydown=false;});};var firstNonWhiteSpaceNodeSibling=node=>{while(node){if(isElement$6(node)||isText$a(node)&&node.data&&/[\\r\\n\\s]/.test(node.data)){return node;}node=node.nextSibling;}return null;};var moveToCaretPosition=(editor,root)=>{var dom=editor.dom;var moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(!root){return;}if(/^(LI|DT|DD)$/.test(root.nodeName)){var _firstChild2=firstNonWhiteSpaceNodeSibling(root.firstChild);if(_firstChild2&&/^(UL|OL|DL)$/.test(_firstChild2.nodeName)){root.insertBefore(dom.doc.createTextNode(nbsp),root.firstChild);}}var rng=dom.createRng();root.normalize();if(root.hasChildNodes()){var walker=new DomTreeWalker(root,root);var lastNode=root;var node;while(node=walker.current()){if(isText$a(node)){rng.setStart(node,0);rng.setEnd(node,0);break;}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node);rng.setEndBefore(node);break;}lastNode=node;node=walker.next();}if(!node){rng.setStart(lastNode,0);rng.setEnd(lastNode,0);}}else{if(isBr$6(root)){if(root.nextSibling&&dom.isBlock(root.nextSibling)){rng.setStartBefore(root);rng.setEndBefore(root);}else{rng.setStartAfter(root);rng.setEndAfter(root);}}else{rng.setStart(root,0);rng.setEnd(root,0);}}editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);};var getEditableRoot=(dom,node)=>{var root=dom.getRoot();var editableRoot;var parent=node;while(parent!==root&&parent&&dom.getContentEditable(parent)!=='false'){if(dom.getContentEditable(parent)==='true'){editableRoot=parent;break;}parent=parent.parentNode;}return parent!==root?editableRoot:root;};var getParentBlock$1=editor=>{return Optional.from(editor.dom.getParent(editor.selection.getStart(true),editor.dom.isBlock));};var getParentBlockName=editor=>{return getParentBlock$1(editor).fold(constant(''),parentBlock=>{return parentBlock.nodeName.toUpperCase();});};var isListItemParentBlock=editor=>{return getParentBlock$1(editor).filter(elm=>{return isListItem$1(SugarElement.fromDom(elm));}).isSome();};var emptyBlock=elm=>{elm.innerHTML='<br data-mce-bogus=\"1\">';};var applyAttributes=(editor,node,forcedRootBlockAttrs)=>{var dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each(attrStyles=>{var currentStyles=getAllRaw(SugarElement.fromDom(node));var newStyles=_objectSpread(_objectSpread({},currentStyles),attrStyles);dom.setStyles(node,newStyles);});var attrClassesOpt=Optional.from(forcedRootBlockAttrs.class).map(attrClasses=>attrClasses.split(/\\s+/));var currentClassesOpt=Optional.from(node.className).map(currentClasses=>filter$5(currentClasses.split(/\\s+/),clazz=>clazz!==''));lift2(attrClassesOpt,currentClassesOpt,(attrClasses,currentClasses)=>{var filteredClasses=filter$5(currentClasses,clazz=>!contains$2(attrClasses,clazz));var newClasses=[...attrClasses,...filteredClasses];dom.setAttrib(node,'class',newClasses.join(' '));});var appliedAttrs=['style','class'];var remainingAttrs=filter$4(forcedRootBlockAttrs,(_,attrs)=>!contains$2(appliedAttrs,attrs));dom.setAttribs(node,remainingAttrs);};var setForcedBlockAttrs=(editor,node)=>{var forcedRootBlockName=getForcedRootBlock(editor);if(forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()){var forcedRootBlockAttrs=getForcedRootBlockAttrs(editor);applyAttributes(editor,node,forcedRootBlockAttrs);}};var createNewBlock=function createNewBlock(editor,container,parentBlock,editableRoot){var keepStyles=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var name=arguments.length>5?arguments[5]:undefined;var dom=editor.dom;var schema=editor.schema;var newBlockName=getForcedRootBlock(editor);var parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():'';var node=container;var textInlineElements=schema.getTextInlineElements();var block;if(name||parentBlockName==='TABLE'||parentBlockName==='HR'){block=dom.create(name||newBlockName);}else{block=parentBlock.cloneNode(false);}var caretNode=block;if(!keepStyles){dom.setAttrib(block,'style',null);dom.setAttrib(block,'class',null);}else{do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node)){continue;}var clonedNode=node.cloneNode(false);dom.setAttrib(clonedNode,'id','');if(block.hasChildNodes()){clonedNode.appendChild(block.firstChild);block.appendChild(clonedNode);}else{caretNode=clonedNode;block.appendChild(clonedNode);}}}while((node=node.parentNode)&&node!==editableRoot);}setForcedBlockAttrs(editor,block);emptyBlock(caretNode);return block;};var getDetailsRoot=(editor,element)=>editor.dom.getParent(element,isDetails);var isAtDetailsEdge=(root,element,isTextBlock)=>{var node=element;while(node&&node!==root&&isNull(node.nextSibling)){var _parent9=node.parentElement;if(!_parent9||!isTextBlock(_parent9)){return isDetails(_parent9);}node=_parent9;}return false;};var isLastEmptyBlockInDetails=(editor,shiftKey,element)=>!shiftKey&&element.nodeName.toLowerCase()===getForcedRootBlock(editor)&&editor.dom.isEmpty(element)&&isAtDetailsEdge(editor.getBody(),element,el=>has$2(editor.schema.getTextBlockElements(),el.nodeName.toLowerCase()));var insertNewLine=(editor,createNewBlock,parentBlock)=>{var _a,_b,_c;var newBlock=createNewBlock(getForcedRootBlock(editor));var root=getDetailsRoot(editor,parentBlock);if(!root){return;}editor.dom.insertAfter(newBlock,root);moveToCaretPosition(editor,newBlock);if(((_c=(_b=(_a=parentBlock.parentElement)===null||_a===void 0?void 0:_a.childNodes)===null||_b===void 0?void 0:_b.length)!==null&&_c!==void 0?_c:0)>1){editor.dom.remove(parentBlock);}};var hasFirstChild=(elm,name)=>{return elm.firstChild&&elm.firstChild.nodeName===name;};var isFirstChild=elm=>{var _a;return((_a=elm.parentNode)===null||_a===void 0?void 0:_a.firstChild)===elm;};var hasParent=(elm,parentName)=>{var parentNode=elm===null||elm===void 0?void 0:elm.parentNode;return isNonNullable(parentNode)&&parentNode.nodeName===parentName;};var isListBlock=elm=>{return isNonNullable(elm)&&/^(OL|UL|LI)$/.test(elm.nodeName);};var isListItem=elm=>{return isNonNullable(elm)&&/^(LI|DT|DD)$/.test(elm.nodeName);};var isNestedList=elm=>{return isListBlock(elm)&&isListBlock(elm.parentNode);};var getContainerBlock=containerBlock=>{var containerBlockParent=containerBlock.parentNode;return isListItem(containerBlockParent)?containerBlockParent:containerBlock;};var isFirstOrLastLi=(containerBlock,parentBlock,first)=>{var node=containerBlock[first?'firstChild':'lastChild'];while(node){if(isElement$6(node)){break;}node=node[first?'nextSibling':'previousSibling'];}return node===parentBlock;};var insert$4=(editor,createNewBlock,containerBlock,parentBlock,newBlockName)=>{var dom=editor.dom;var rng=editor.selection.getRng();var containerParent=containerBlock.parentNode;if(containerBlock===editor.getBody()||!containerParent){return;}if(isNestedList(containerBlock)){newBlockName='LI';}var newBlock=createNewBlock(newBlockName);if(isFirstOrLastLi(containerBlock,parentBlock,true)&&isFirstOrLastLi(containerBlock,parentBlock,false)){if(hasParent(containerBlock,'LI')){var containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent);if(isFirstChild(containerBlock)){dom.remove(containerBlockParent);}else{dom.remove(containerBlock);}}else{dom.replace(newBlock,containerBlock);}}else if(isFirstOrLastLi(containerBlock,parentBlock,true)){if(hasParent(containerBlock,'LI')){dom.insertAfter(newBlock,getContainerBlock(containerBlock));newBlock.appendChild(dom.doc.createTextNode(' '));newBlock.appendChild(containerBlock);}else{containerParent.insertBefore(newBlock,containerBlock);}dom.remove(parentBlock);}else if(isFirstOrLastLi(containerBlock,parentBlock,false)){dom.insertAfter(newBlock,getContainerBlock(containerBlock));dom.remove(parentBlock);}else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock);tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();if(newBlockName==='LI'&&hasFirstChild(fragment,'LI')){newBlock=fragment.firstChild;dom.insertAfter(fragment,containerBlock);}else{dom.insertAfter(fragment,containerBlock);dom.insertAfter(newBlock,containerBlock);}dom.remove(parentBlock);}moveToCaretPosition(editor,newBlock);};var trimZwsp=fragment=>{each$e(descendants$1(SugarElement.fromDom(fragment),isText$b),text=>{var rawNode=text.dom;rawNode.nodeValue=trim$1(rawNode.data);});};var isWithinNonEditableList=(editor,node)=>{var parentList=editor.dom.getParent(node,'ol,ul,dl');return parentList!==null&&editor.dom.getContentEditableParent(parentList)==='false';};var isEmptyAnchor=(dom,elm)=>{return elm&&elm.nodeName==='A'&&dom.isEmpty(elm);};var containerAndSiblingName=(container,nodeName)=>{return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName;};var canSplitBlock=(dom,node)=>{return isNonNullable(node)&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&dom.isEditable(node.parentNode)&&dom.getContentEditable(node)!=='false';};var trimInlineElementsOnLeftSideOfBlock=(dom,nonEmptyElementsMap,block)=>{var _a;var firstChilds=[];if(!block){return;}var currentNode=block;while(currentNode=currentNode.firstChild){if(dom.isBlock(currentNode)){return;}if(isElement$6(currentNode)&&!nonEmptyElementsMap[currentNode.nodeName.toLowerCase()]){firstChilds.push(currentNode);}}var i=firstChilds.length;while(i--){currentNode=firstChilds[i];if(!currentNode.hasChildNodes()||currentNode.firstChild===currentNode.lastChild&&((_a=currentNode.firstChild)===null||_a===void 0?void 0:_a.nodeValue)===''){dom.remove(currentNode);}else{if(isEmptyAnchor(dom,currentNode)){dom.remove(currentNode);}}}};var normalizeZwspOffset=(start,container,offset)=>{if(!isText$a(container)){return offset;}else if(start){return offset===1&&container.data.charAt(offset-1)===ZWSP$1?0:offset;}else{return offset===container.data.length-1&&container.data.charAt(offset)===ZWSP$1?container.data.length:offset;}};var includeZwspInRange=rng=>{var newRng=rng.cloneRange();newRng.setStart(rng.startContainer,normalizeZwspOffset(true,rng.startContainer,rng.startOffset));newRng.setEnd(rng.endContainer,normalizeZwspOffset(false,rng.endContainer,rng.endOffset));return newRng;};var trimLeadingLineBreaks=node=>{var currentNode=node;do{if(isText$a(currentNode)){currentNode.data=currentNode.data.replace(/^[\\r\\n]+/,'');}currentNode=currentNode.firstChild;}while(currentNode);};var wrapSelfAndSiblingsInDefaultBlock=(editor,newBlockName,rng,container,offset)=>{var _a,_b;var dom=editor.dom;var editableRoot=(_a=getEditableRoot(dom,container))!==null&&_a!==void 0?_a:dom.getRoot();var parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(dom,parentBlock)){parentBlock=parentBlock||editableRoot;if(!parentBlock.hasChildNodes()){var newBlock=dom.create(newBlockName);setForcedBlockAttrs(editor,newBlock);parentBlock.appendChild(newBlock);rng.setStart(newBlock,0);rng.setEnd(newBlock,0);return newBlock;}var node=container;while(node&&node.parentNode!==parentBlock){node=node.parentNode;}var startNode;while(node&&!dom.isBlock(node)){startNode=node;node=node.previousSibling;}var startNodeName=(_b=startNode===null||startNode===void 0?void 0:startNode.parentElement)===null||_b===void 0?void 0:_b.nodeName;if(startNode&&startNodeName&&editor.schema.isValidChild(startNodeName,newBlockName.toLowerCase())){var startNodeParent=startNode.parentNode;var _newBlock=dom.create(newBlockName);setForcedBlockAttrs(editor,_newBlock);startNodeParent.insertBefore(_newBlock,startNode);node=startNode;while(node&&!dom.isBlock(node)){var _next4=node.nextSibling;_newBlock.appendChild(node);node=_next4;}rng.setStart(container,offset);rng.setEnd(container,offset);}}return container;};var addBrToBlockIfNeeded=(dom,block)=>{block.normalize();var lastChild=block.lastChild;if(!lastChild||isElement$6(lastChild)&&/^(left|right)$/gi.test(dom.getStyle(lastChild,'float',true))){dom.add(block,'br');}};var shouldEndContainer=(editor,container)=>{var optionValue=shouldEndContainerOnEmptyBlock(editor);if(isNullable(container)){return false;}else if(isString(optionValue)){return contains$2(Tools.explode(optionValue),container.nodeName.toLowerCase());}else{return optionValue;}};var insert$3=(editor,evt)=>{var container;var offset;var parentBlockName;var containerBlock;var isAfterLastNodeInContainer=false;var dom=editor.dom;var schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements();var rng=editor.selection.getRng();var newBlockName=getForcedRootBlock(editor);var start=SugarElement.fromDom(rng.startContainer);var child=child$1(start,rng.startOffset);var isCef=child.exists(element=>isHTMLElement(element)&&!isEditable$3(element));var collapsedAndCef=rng.collapsed&&isCef;var createNewBlock$1=name=>{return createNewBlock(editor,container,parentBlock,editableRoot,shouldKeepStyles(editor),name);};var isCaretAtStartOrEndOfBlock=start=>{var normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$a(container)&&(start?normalizedOffset>0:normalizedOffset<container.data.length)){return false;}if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start){return true;}if(start&&isElement$6(container)&&container===parentBlock.firstChild){return true;}if(containerAndSiblingName(container,'TABLE')||containerAndSiblingName(container,'HR')){return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;}var walker=new DomTreeWalker(container,parentBlock);if(isText$a(container)){if(start&&normalizedOffset===0){walker.prev();}else if(!start&&normalizedOffset===container.data.length){walker.next();}}var node;while(node=walker.current()){if(isElement$6(node)){if(!node.getAttribute('data-mce-bogus')){var _name17=node.nodeName.toLowerCase();if(nonEmptyElementsMap[_name17]&&_name17!=='br'){return false;}}}else if(isText$a(node)&&!isWhitespaceText(node.data)){return false;}if(start){walker.prev();}else{walker.next();}}return true;};var insertNewBlockAfter=()=>{var block;if(/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&containerBlockName!=='HGROUP'){block=createNewBlock$1(newBlockName);}else{block=createNewBlock$1();}if(shouldEndContainer(editor,containerBlock)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock,undefined,{includeZwsp:true})){block=dom.split(containerBlock,parentBlock);}else{dom.insertAfter(block,parentBlock);}moveToCaretPosition(editor,block);return block;};normalize$2(dom,rng).each(normRng=>{rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});container=rng.startContainer;offset=rng.startOffset;var shiftKey=!!(evt&&evt.shiftKey);var ctrlKey=!!(evt&&evt.ctrlKey);if(isElement$6(container)&&container.hasChildNodes()&&!collapsedAndCef){isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&isText$a(container)){offset=container.data.length;}else{offset=0;}}var editableRoot=getEditableRoot(dom,container);if(!editableRoot||isWithinNonEditableList(editor,container)){return;}if(!shiftKey){container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset);}var parentBlock=dom.getParent(container,dom.isBlock)||dom.getRoot();containerBlock=isNonNullable(parentBlock===null||parentBlock===void 0?void 0:parentBlock.parentNode)?dom.getParent(parentBlock.parentNode,dom.isBlock):null;parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():'';var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';if(containerBlockName==='LI'&&!ctrlKey){var liBlock=containerBlock;parentBlock=liBlock;containerBlock=liBlock.parentNode;parentBlockName=containerBlockName;}if(isElement$6(containerBlock)&&isLastEmptyBlockInDetails(editor,shiftKey,parentBlock)){return insertNewLine(editor,createNewBlock$1,parentBlock);}if(/^(LI|DT|DD)$/.test(parentBlockName)&&isElement$6(containerBlock)){if(dom.isEmpty(parentBlock)){insert$4(editor,createNewBlock$1,containerBlock,parentBlock,newBlockName);return;}}if(!collapsedAndCef&&(parentBlock===editor.getBody()||!canSplitBlock(dom,parentBlock))){return;}var parentBlockParent=parentBlock.parentNode;var newBlock;if(collapsedAndCef){newBlock=createNewBlock$1(newBlockName);child.fold(()=>{append$1(start,SugarElement.fromDom(newBlock));},child=>{before$3(child,SugarElement.fromDom(newBlock));});editor.selection.setCursorLocation(newBlock,0);}else if(isCaretContainerBlock$1(parentBlock)){newBlock=showCaretContainerBlock(parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}setForcedBlockAttrs(editor,newBlock);moveToCaretPosition(editor,newBlock);}else if(isCaretAtStartOrEndOfBlock(false)){newBlock=insertNewBlockAfter();}else if(isCaretAtStartOrEndOfBlock(true)&&parentBlockParent){newBlock=parentBlockParent.insertBefore(createNewBlock$1(),parentBlock);var isNearChildren=hasChildNodes(SugarElement.fromDom(rng.startContainer))&&rng.collapsed;moveToCaretPosition(editor,containerAndSiblingName(parentBlock,'HR')||isNearChildren?newBlock:parentBlock);}else{var tmpRng=includeZwspInRange(rng).cloneRange();tmpRng.setEndAfter(parentBlock);var fragment=tmpRng.extractContents();trimZwsp(fragment);trimLeadingLineBreaks(fragment);newBlock=fragment.firstChild;dom.insertAfter(fragment,parentBlock);trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock);addBrToBlockIfNeeded(dom,parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock);}newBlock.normalize();if(dom.isEmpty(newBlock)){dom.remove(newBlock);insertNewBlockAfter();}else{setForcedBlockAttrs(editor,newBlock);moveToCaretPosition(editor,newBlock);}}dom.setAttrib(newBlock,'id','');editor.dispatch('NewBlock',{newBlock});};var fakeEventName$1='insertParagraph';var blockbreak={insert:insert$3,fakeEventName:fakeEventName$1};var hasRightSideContent=(schema,container,parentBlock)=>{var walker=new DomTreeWalker(container,parentBlock);var node;var nonEmptyElementsMap=schema.getNonEmptyElements();while(node=walker.next()){if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||isText$a(node)&&node.length>0){return true;}}return false;};var moveSelectionToBr=(editor,brElm,extraBr)=>{var rng=editor.dom.createRng();if(!extraBr){rng.setStartAfter(brElm);rng.setEndAfter(brElm);}else{rng.setStartBefore(brElm);rng.setEndBefore(brElm);}editor.selection.setRng(rng);scrollRangeIntoView(editor,rng);};var insertBrAtCaret=(editor,evt)=>{var selection=editor.selection;var dom=editor.dom;var rng=selection.getRng();var brElm;var extraBr=false;normalize$2(dom,rng).each(normRng=>{rng.setStart(normRng.startContainer,normRng.startOffset);rng.setEnd(normRng.endContainer,normRng.endOffset);});var offset=rng.startOffset;var container=rng.startContainer;if(isElement$6(container)&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&isText$a(container)){offset=container.data.length;}else{offset=0;}}var parentBlock=dom.getParent(container,dom.isBlock);var containerBlock=parentBlock&&parentBlock.parentNode?dom.getParent(parentBlock.parentNode,dom.isBlock):null;var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';var isControlKey=!!(evt&&evt.ctrlKey);if(containerBlockName==='LI'&&!isControlKey){parentBlock=containerBlock;}if(isText$a(container)&&offset>=container.data.length){if(!hasRightSideContent(editor.schema,container,parentBlock||dom.getRoot())){brElm=dom.create('br');rng.insertNode(brElm);rng.setStartAfter(brElm);rng.setEndAfter(brElm);extraBr=true;}}brElm=dom.create('br');rangeInsertNode(dom,rng,brElm);moveSelectionToBr(editor,brElm,extraBr);editor.undoManager.add();};var insertBrBefore=(editor,inline)=>{var br=SugarElement.fromTag('br');before$3(SugarElement.fromDom(inline),br);editor.undoManager.add();};var insertBrAfter=(editor,inline)=>{if(!hasBrAfter(editor.getBody(),inline)){after$4(SugarElement.fromDom(inline),SugarElement.fromTag('br'));}var br=SugarElement.fromTag('br');after$4(SugarElement.fromDom(inline),br);moveSelectionToBr(editor,br.dom,false);editor.undoManager.add();};var isBeforeBr=pos=>{return isBr$6(pos.getNode());};var hasBrAfter=(rootNode,startNode)=>{if(isBeforeBr(CaretPosition.after(startNode))){return true;}else{return nextPosition(rootNode,CaretPosition.after(startNode)).map(pos=>{return isBr$6(pos.getNode());}).getOr(false);}};var isAnchorLink=elm=>{return elm&&elm.nodeName==='A'&&'href'in elm;};var isInsideAnchor=location=>{return location.fold(never,isAnchorLink,isAnchorLink,never);};var readInlineAnchorLocation=editor=>{var isInlineTarget$1=curry(isInlineTarget,editor);var position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor);};var insertBrOutsideAnchor=(editor,location)=>{location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop);};var insert$2=(editor,evt)=>{var anchorLocation=readInlineAnchorLocation(editor);if(anchorLocation.isSome()){anchorLocation.each(curry(insertBrOutsideAnchor,editor));}else{insertBrAtCaret(editor,evt);}};var fakeEventName='insertLineBreak';var linebreak={insert:insert$2,fakeEventName};var matchesSelector=(editor,selector)=>{return getParentBlock$1(editor).filter(parentBlock=>{return selector.length>0&&is$1(SugarElement.fromDom(parentBlock),selector);}).isSome();};var shouldInsertBr=editor=>{return matchesSelector(editor,getBrNewLineSelector(editor));};var shouldBlockNewLine$1=editor=>{return matchesSelector(editor,getNoNewLineSelector(editor));};var newLineAction=Adt.generate([{br:[]},{block:[]},{none:[]}]);var shouldBlockNewLine=(editor,_shiftKey)=>{return shouldBlockNewLine$1(editor);};var inListBlock=requiredState=>{return(editor,_shiftKey)=>{return isListItemParentBlock(editor)===requiredState;};};var inBlock=(blockName,requiredState)=>(editor,_shiftKey)=>{var state=getParentBlockName(editor)===blockName.toUpperCase();return state===requiredState;};var inCefBlock=editor=>{var editableRoot=getEditableRoot(editor.dom,editor.selection.getStart());return isNullable(editableRoot);};var inPreBlock=requiredState=>inBlock('pre',requiredState);var inSummaryBlock=()=>inBlock('summary',true);var shouldPutBrInPre=requiredState=>{return(editor,_shiftKey)=>{return shouldPutBrInPre$1(editor)===requiredState;};};var inBrContext=(editor,_shiftKey)=>{return shouldInsertBr(editor);};var hasShiftKey=(_editor,shiftKey)=>{return shiftKey;};var canInsertIntoEditableRoot=editor=>{var forcedRootBlock=getForcedRootBlock(editor);var rootEditable=getEditableRoot(editor.dom,editor.selection.getStart());return isNonNullable(rootEditable)&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock);};var isInRootWithEmptyOrCEF=editor=>{var rng=editor.selection.getRng();var start=SugarElement.fromDom(rng.startContainer);var child=child$1(start,rng.startOffset);var isCefOpt=child.map(element=>isHTMLElement(element)&&!isEditable$3(element));return rng.collapsed&&isCefOpt.getOr(true);};var match=(predicates,action)=>{return(editor,shiftKey)=>{var isMatch=foldl(predicates,(res,p)=>{return res&&p(editor,shiftKey);},true);return isMatch?Optional.some(action):Optional.none();};};var getAction=(editor,evt)=>{return evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inPreBlock(true),inCefBlock],newLineAction.none()),match([inSummaryBlock()],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false),hasShiftKey],newLineAction.br()),match([inPreBlock(true),shouldPutBrInPre(false)],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true),hasShiftKey],newLineAction.block()),match([inPreBlock(true),shouldPutBrInPre(true)],newLineAction.br()),match([inListBlock(true),hasShiftKey],newLineAction.br()),match([inListBlock(true)],newLineAction.block()),match([inBrContext],newLineAction.br()),match([hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block()),match([isInRootWithEmptyOrCEF],newLineAction.block())],[editor,!!(evt&&evt.shiftKey)]).getOr(newLineAction.none());};var insertBreak=(breakType,editor,evt)=>{if(!editor.selection.isCollapsed()){execEditorDeleteCommand(editor);}if(isNonNullable(evt)){var event=fireBeforeInputEvent(editor,breakType.fakeEventName);if(event.isDefaultPrevented()){return;}}breakType.insert(editor,evt);if(isNonNullable(evt)){fireInputEvent(editor,breakType.fakeEventName);}};var insert$1=(editor,evt)=>{var br=()=>insertBreak(linebreak,editor,evt);var block=()=>insertBreak(blockbreak,editor,evt);var logicalAction=getAction(editor,evt);switch(getNewlineBehavior(editor)){case'linebreak':logicalAction.fold(br,br,noop);break;case'block':logicalAction.fold(block,block,noop);break;case'invert':logicalAction.fold(block,br,noop);break;default:logicalAction.fold(br,block,noop);break;}};var platform$1=detect$2();var isIOSSafari=platform$1.os.isiOS()&&platform$1.browser.isSafari();var handleEnterKeyEvent=(editor,event)=>{if(event.isDefaultPrevented()){return;}event.preventDefault();endTypingLevelIgnoreLocks(editor.undoManager);editor.undoManager.transact(()=>{insert$1(editor,event);});};var isCaretAfterKoreanCharacter=rng=>{if(!rng.collapsed){return false;}var startContainer=rng.startContainer;if(isText$a(startContainer)){var koreanCharRegex=/^[\\uAC00-\\uD7AF\\u1100-\\u11FF\\u3130-\\u318F\\uA960-\\uA97F\\uD7B0-\\uD7FF]$/;var char=startContainer.data.charAt(rng.startOffset-1);return koreanCharRegex.test(char);}else{return false;}};var setup$h=editor=>{var iOSSafariKeydownBookmark=Optional.none();var iOSSafariKeydownOverride=editor=>{iOSSafariKeydownBookmark=Optional.some(editor.selection.getBookmark());editor.undoManager.add();};var iOSSafariKeyupOverride=(editor,event)=>{editor.undoManager.undo();iOSSafariKeydownBookmark.fold(noop,b=>editor.selection.moveToBookmark(b));handleEnterKeyEvent(editor,event);iOSSafariKeydownBookmark=Optional.none();};editor.on('keydown',event=>{if(event.keyCode===VK.ENTER){if(isIOSSafari&&isCaretAfterKoreanCharacter(editor.selection.getRng())){iOSSafariKeydownOverride(editor);}else{handleEnterKeyEvent(editor,event);}}});editor.on('keyup',event=>{if(event.keyCode===VK.ENTER){iOSSafariKeydownBookmark.each(()=>iOSSafariKeyupOverride(editor,event));}});};var executeKeydownOverride$2=(editor,caret,evt)=>{var isMac=Env.os.isMacOS()||Env.os.isiOS();execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,true)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,false)},...(!isMac?[{keyCode:VK.HOME,action:action(selectToEndPoint,editor,false),ctrlKey:true,shiftKey:true},{keyCode:VK.END,action:action(selectToEndPoint,editor,true),ctrlKey:true,shiftKey:true}]:[]),{keyCode:VK.END,action:action(moveToLineEndPoint,editor,true)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,false)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,true,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,false,caret)}],evt).each(_=>{evt.preventDefault();});};var setup$g=(editor,caret)=>{editor.on('keydown',evt=>{if(!evt.isDefaultPrevented()){executeKeydownOverride$2(editor,caret,evt);}});};var setup$f=editor=>{editor.on('input',e=>{if(!e.isComposing){normalizeNbspsInEditor(editor);}});};var platform=detect$2();var executeKeyupAction=(editor,caret,evt)=>{execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,false,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,true,caret)}],evt);};var stopImmediatePropagation=e=>e.stopImmediatePropagation();var isPageUpDown=evt=>evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN;var setNodeChangeBlocker=(blocked,editor,block)=>{if(block&&!blocked.get()){editor.on('NodeChange',stopImmediatePropagation,true);}else if(!block&&blocked.get()){editor.off('NodeChange',stopImmediatePropagation);}blocked.set(block);};var setup$e=(editor,caret)=>{if(platform.os.isMacOS()){return;}var blocked=Cell(false);editor.on('keydown',evt=>{if(isPageUpDown(evt)){setNodeChangeBlocker(blocked,editor,true);}});editor.on('keyup',evt=>{if(!evt.isDefaultPrevented()){executeKeyupAction(editor,caret,evt);}if(isPageUpDown(evt)&&blocked.get()){setNodeChangeBlocker(blocked,editor,false);editor.nodeChanged();}});};var insertTextAtPosition=(text,pos)=>{var container=pos.container();var offset=pos.offset();if(isText$a(container)){container.insertData(offset,text);return Optional.some(CaretPosition(container,offset+text.length));}else{return getElementFromPosition(pos).map(elm=>{var textNode=SugarElement.fromText(text);if(pos.isAtEnd()){after$4(elm,textNode);}else{before$3(elm,textNode);}return CaretPosition(textNode.dom,text.length);});}};var insertNbspAtPosition=curry(insertTextAtPosition,nbsp);var insertSpaceAtPosition=curry(insertTextAtPosition,' ');var insertSpaceOrNbspAtPosition=(root,pos)=>needsToHaveNbsp(root,pos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos);var locationToCaretPosition=root=>location=>location.fold(element=>prevPosition(root.dom,CaretPosition.before(element)),element=>firstPositionIn(element),element=>lastPositionIn(element),element=>nextPosition(root.dom,CaretPosition.after(element)));var insertInlineBoundarySpaceOrNbsp=(root,pos)=>checkPos=>needsToHaveNbsp(root,checkPos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos);var setSelection=editor=>pos=>{editor.selection.setRng(pos.toRange());editor.nodeChanged();};var isInsideSummary=(domUtils,node)=>domUtils.isEditable(domUtils.getParent(node,'summary'));var insertSpaceOrNbspAtSelection=editor=>{var pos=CaretPosition.fromRangeStart(editor.selection.getRng());var root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){var isInlineTarget$1=curry(isInlineTarget,editor);var caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(locationToCaretPosition(root)).map(checkPos=>()=>insertInlineBoundarySpaceOrNbsp(root,pos)(checkPos).each(setSelection(editor)));}else{return Optional.none();}};var insertSpaceInSummaryAtSelectionOnFirefox=editor=>{var insertSpaceThunk=()=>{var root=SugarElement.fromDom(editor.getBody());if(!editor.selection.isCollapsed()){editor.getDoc().execCommand('Delete');}var pos=CaretPosition.fromRangeStart(editor.selection.getRng());insertSpaceOrNbspAtPosition(root,pos).each(setSelection(editor));};return someIf(Env.browser.isFirefox()&&editor.selection.isEditable()&&isInsideSummary(editor.dom,editor.selection.getRng().startContainer),insertSpaceThunk);};var executeKeydownOverride$1=(editor,evt)=>{executeWithDelayedAction([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)},{keyCode:VK.SPACEBAR,action:action(insertSpaceInSummaryAtSelectionOnFirefox,editor)}],evt).each(applyAction=>{evt.preventDefault();var event=fireBeforeInputEvent(editor,'insertText',{data:' '});if(!event.isDefaultPrevented()){applyAction();fireInputEvent(editor,'insertText',{data:' '});}});};var setup$d=editor=>{editor.on('keydown',evt=>{if(!evt.isDefaultPrevented()){executeKeydownOverride$1(editor,evt);}});};var tableTabNavigation=editor=>{if(hasTableTabNavigation(editor)){return[{keyCode:VK.TAB,action:action(handleTab,editor,true)},{keyCode:VK.TAB,shiftKey:true,action:action(handleTab,editor,false)}];}else{return[];}};var executeKeydownOverride=(editor,evt)=>{execute([...tableTabNavigation(editor)],evt).each(_=>{evt.preventDefault();});};var setup$c=editor=>{editor.on('keydown',evt=>{if(!evt.isDefaultPrevented()){executeKeydownOverride(editor,evt);}});};var setup$b=editor=>{editor.addShortcut('Meta+P','','mcePrint');setup$j(editor);if(isRtc(editor)){return Cell(null);}else{var caret=setupSelectedState(editor);setup$l(editor);setup$k(editor,caret);setup$i(editor,caret);setup$h(editor);setup$d(editor);setup$f(editor);setup$c(editor);setup$g(editor,caret);setup$e(editor,caret);return caret;}};class NodeChange{constructor(editor){this.lastPath=[];this.editor=editor;var lastRng;var self=this;if(!('onselectionchange'in editor.getDoc())){editor.on('NodeChange click mouseup keyup focus',e=>{var nativeRng=editor.selection.getRng();var fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};if(e.type==='nodechange'||!isEq$4(fakeRng,lastRng)){editor.dispatch('SelectionChange');}lastRng=fakeRng;});}editor.on('contextmenu',()=>{editor.dispatch('SelectionChange');});editor.on('SelectionChange',()=>{var startElm=editor.selection.getStart(true);if(!startElm){return;}if(hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())){editor.nodeChanged({selectionChange:true});}});editor.on('mouseup',e=>{if(!e.isDefaultPrevented()&&hasAnyRanges(editor)){if(editor.selection.getNode().nodeName==='IMG'){Delay.setEditorTimeout(editor,()=>{editor.nodeChanged();});}else{editor.nodeChanged();}}});}nodeChanged(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var selection=this.editor.selection;var node;if(this.editor.initialized&&selection&&!shouldDisableNodeChange(this.editor)&&!this.editor.mode.isReadOnly()){var root=this.editor.getBody();node=selection.getStart(true)||root;if(node.ownerDocument!==this.editor.getDoc()||!this.editor.dom.isChildOf(node,root)){node=root;}var _parents3=[];this.editor.dom.getParent(node,node=>{if(node===root){return true;}else{_parents3.push(node);return false;}});this.editor.dispatch('NodeChange',_objectSpread(_objectSpread({},args),{},{element:node,parents:_parents3}));}}isSameElementPath(startElm){var i;var editor=this.editor;var currentPath=reverse(editor.dom.getParents(startElm,always,editor.getBody()));if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0;i--){if(currentPath[i]!==this.lastPath[i]){break;}}if(i===-1){this.lastPath=currentPath;return true;}}this.lastPath=currentPath;return false;}}var imageId=generate$1('image');var getDragImage=transfer=>{var dt=transfer;return Optional.from(dt[imageId]);};var _setDragImage=(transfer,imageData)=>{var dt=transfer;dt[imageId]=imageData;};var eventId=generate$1('event');var getEvent=transfer=>{var dt=transfer;return Optional.from(dt[eventId]);};var mkSetEventFn=type=>transfer=>{var dt=transfer;dt[eventId]=type;};var setEvent=(transfer,type)=>mkSetEventFn(type)(transfer);var setDragstartEvent=mkSetEventFn(0);var setDropEvent=mkSetEventFn(2);var setDragendEvent=mkSetEventFn(1);var checkEvent=expectedType=>transfer=>{var dt=transfer;return Optional.from(dt[eventId]).exists(type=>type===expectedType);};var isInDragStartEvent=checkEvent(0);var createEmptyFileList=()=>Object.freeze({length:0,item:_=>null});var modeId=generate$1('mode');var getMode=transfer=>{var dt=transfer;return Optional.from(dt[modeId]);};var mkSetModeFn=mode=>transfer=>{var dt=transfer;dt[modeId]=mode;};var setMode$1=(transfer,mode)=>mkSetModeFn(mode)(transfer);var setReadWriteMode=mkSetModeFn(0);var setReadOnlyMode=mkSetModeFn(2);var setProtectedMode=mkSetModeFn(1);var checkMode=expectedMode=>transfer=>{var dt=transfer;return Optional.from(dt[modeId]).exists(mode=>mode===expectedMode);};var isInReadWriteMode=checkMode(0);var isInProtectedMode=checkMode(1);var normalizeItems=(dataTransfer,itemsImpl)=>_objectSpread(_objectSpread({},itemsImpl),{},{get length(){return itemsImpl.length;},add:(data,type)=>{if(isInReadWriteMode(dataTransfer)){if(isString(data)){if(!isUndefined(type)){return itemsImpl.add(data,type);}}else{return itemsImpl.add(data);}}return null;},remove:idx=>{if(isInReadWriteMode(dataTransfer)){itemsImpl.remove(idx);}},clear:()=>{if(isInReadWriteMode(dataTransfer)){itemsImpl.clear();}}});var validDropEffects=['none','copy','link','move'];var validEffectAlloweds=['none','copy','copyLink','copyMove','link','linkMove','move','all','uninitialized'];var createDataTransfer=()=>{var dataTransferImpl=new window.DataTransfer();var dropEffect='move';var effectAllowed='all';var dataTransfer={get dropEffect(){return dropEffect;},set dropEffect(effect){if(contains$2(validDropEffects,effect)){dropEffect=effect;}},get effectAllowed(){return effectAllowed;},set effectAllowed(allowed){if(isInDragStartEvent(dataTransfer)&&contains$2(validEffectAlloweds,allowed)){effectAllowed=allowed;}},get items(){return normalizeItems(dataTransfer,dataTransferImpl.items);},get files(){if(isInProtectedMode(dataTransfer)){return createEmptyFileList();}else{return dataTransferImpl.files;}},get types(){return dataTransferImpl.types;},setDragImage:(image,x,y)=>{if(isInReadWriteMode(dataTransfer)){_setDragImage(dataTransfer,{image,x,y});dataTransferImpl.setDragImage(image,x,y);}},getData:format=>{if(isInProtectedMode(dataTransfer)){return'';}else{return dataTransferImpl.getData(format);}},setData:(format,data)=>{if(isInReadWriteMode(dataTransfer)){dataTransferImpl.setData(format,data);}},clearData:format=>{if(isInReadWriteMode(dataTransfer)){dataTransferImpl.clearData(format);}}};setReadWriteMode(dataTransfer);return dataTransfer;};var cloneDataTransfer=original=>{var clone=createDataTransfer();var originalMode=getMode(original);setReadOnlyMode(original);setDragstartEvent(clone);clone.dropEffect=original.dropEffect;clone.effectAllowed=original.effectAllowed;getDragImage(original).each(imageData=>clone.setDragImage(imageData.image,imageData.x,imageData.y));each$e(original.types,type=>{if(type!=='Files'){clone.setData(type,original.getData(type));}});each$e(original.files,file=>clone.items.add(file));getEvent(original).each(type=>{setEvent(clone,type);});originalMode.each(mode=>{setMode$1(original,mode);setMode$1(clone,mode);});return clone;};var getHtmlData=dataTransfer=>{var html=dataTransfer.getData('text/html');return html===''?Optional.none():Optional.some(html);};var setHtmlData=(dataTransfer,html)=>dataTransfer.setData('text/html',html);var internalMimeType='x-tinymce/html';var internalHtmlMime=constant(internalMimeType);var internalMark='<!-- '+internalMimeType+' -->';var mark=html=>internalMark+html;var unmark=html=>html.replace(internalMark,'');var isMarked=html=>html.indexOf(internalMark)!==-1;var isPlainText=text=>{return!/<(?:\\/?(?!(?:div|p|br|span)>)\\w+|(?:(?!(?:span style=\"white-space:\\s?pre;?\">)|br\\s?\\/>))\\w+\\s[^>]+)>/i.test(text);};var openContainer=(rootTag,rootAttrs)=>{var tag='<'+rootTag;var attrs=mapToArray(rootAttrs,(value,key)=>key+'=\"'+Entities.encodeAllRaw(value)+'\"');if(attrs.length){tag+=' '+attrs.join(' ');}return tag+'>';};var toBlockElements=(text,rootTag,rootAttrs)=>{var blocks=text.split(/\\n\\n/);var tagOpen=openContainer(rootTag,rootAttrs);var tagClose='</'+rootTag+'>';var paragraphs=map$3(blocks,p=>{return p.split(/\\n/).join('<br />');});var stitch=p=>{return tagOpen+p+tagClose;};return paragraphs.length===1?paragraphs[0]:map$3(paragraphs,stitch).join('');};var pasteBinDefaultContent='%MCEPASTEBIN%';var create$6=(editor,lastRngCell)=>{var{dom,selection}=editor;var body=editor.getBody();lastRngCell.set(selection.getRng());var pasteBinElm=dom.add(editor.getBody(),'div',{'id':'mcepastebin','class':'mce-pastebin','contentEditable':true,'data-mce-bogus':'all','style':'position: fixed; top: 50%; width: 10px; height: 10px; overflow: hidden; opacity: 0'},pasteBinDefaultContent);if(Env.browser.isFirefox()){dom.setStyle(pasteBinElm,'left',dom.getStyle(body,'direction',true)==='rtl'?65535:-65535);}dom.bind(pasteBinElm,'beforedeactivate focusin focusout',e=>{e.stopPropagation();});pasteBinElm.focus();selection.select(pasteBinElm,true);};var _remove=(editor,lastRngCell)=>{var dom=editor.dom;if(_getEl(editor)){var pasteBinClone;var lastRng=lastRngCell.get();while(pasteBinClone=_getEl(editor)){dom.remove(pasteBinClone);dom.unbind(pasteBinClone);}if(lastRng){editor.selection.setRng(lastRng);}}lastRngCell.set(null);};var _getEl=editor=>editor.dom.get('mcepastebin');var isPasteBin=elm=>isNonNullable(elm)&&elm.id==='mcepastebin';var _getHtml=editor=>{var dom=editor.dom;var copyAndRemove=(toElm,fromElm)=>{toElm.appendChild(fromElm);dom.remove(fromElm,true);};var[pasteBinElm,...pasteBinClones]=filter$5(editor.getBody().childNodes,isPasteBin);each$e(pasteBinClones,pasteBinClone=>{copyAndRemove(pasteBinElm,pasteBinClone);});var dirtyWrappers=dom.select('div[id=mcepastebin]',pasteBinElm);for(var i=dirtyWrappers.length-1;i>=0;i--){var cleanWrapper=dom.create('div');pasteBinElm.insertBefore(cleanWrapper,dirtyWrappers[i]);copyAndRemove(cleanWrapper,dirtyWrappers[i]);}return pasteBinElm?pasteBinElm.innerHTML:'';};var isDefaultPasteBinContent=content=>content===pasteBinDefaultContent;var PasteBin=editor=>{var lastRng=Cell(null);return{create:()=>create$6(editor,lastRng),remove:()=>_remove(editor,lastRng),getEl:()=>_getEl(editor),getHtml:()=>_getHtml(editor),getLastRng:lastRng.get};};var filter$1=(content,items)=>{Tools.each(items,v=>{if(is$4(v,RegExp)){content=content.replace(v,'');}else{content=content.replace(v[0],v[1]);}});return content;};var innerText=html=>{var schema=Schema();var domParser=DomParser({},schema);var text='';var voidElements=schema.getVoidElements();var ignoreElements=Tools.makeMap('script noscript style textarea video audio iframe object',' ');var blockElements=schema.getBlockElements();var walk=node=>{var name=node.name,currentNode=node;if(name==='br'){text+='\\n';return;}if(name==='wbr'){return;}if(voidElements[name]){text+=' ';}if(ignoreElements[name]){text+=' ';return;}if(node.type===3){text+=node.value;}if(!(node.name in schema.getVoidElements())){var _currentNode=node.firstChild;if(_currentNode){do{walk(_currentNode);}while(_currentNode=_currentNode.next);}}if(blockElements[name]&&currentNode.next){text+='\\n';if(name==='p'){text+='\\n';}}};html=filter$1(html,[/<!\\[[^\\]]+\\]>/g]);walk(domParser.parse(html));return text;};var trimHtml=html=>{var trimSpaces=(all,s1,s2)=>{if(!s1&&!s2){return' ';}return nbsp;};html=filter$1(html,[/^[\\s\\S]*<body[^>]*>\\s*|\\s*<\\/body[^>]*>[\\s\\S]*$/ig,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class=\"Apple-converted-space\">\\u00a0<\\/span>( ?)/g,trimSpaces],/<br class=\"Apple-interchange-newline\">/g,/<br>$/i]);return html;};var createIdGenerator=prefix=>{var count=0;return()=>{return prefix+count++;};};var getImageMimeType=ext=>{var lowerExt=ext.toLowerCase();var mimeOverrides={jpg:'jpeg',jpe:'jpeg',jfi:'jpeg',jif:'jpeg',jfif:'jpeg',pjpeg:'jpeg',pjp:'jpeg',svg:'svg+xml'};return Tools.hasOwn(mimeOverrides,lowerExt)?'image/'+mimeOverrides[lowerExt]:'image/'+lowerExt;};var preProcess=(editor,html)=>{var parser=DomParser({sanitize:shouldSanitizeXss(editor)},editor.schema);parser.addNodeFilter('meta',nodes=>{Tools.each(nodes,node=>{node.remove();});});var fragment=parser.parse(html,{forced_root_block:false,isRootContent:true});return HtmlSerializer({validate:true},editor.schema).serialize(fragment);};var processResult=(content,cancelled)=>({content,cancelled});var postProcessFilter=(editor,html,internal)=>{var tempBody=editor.dom.create('div',{style:'display:none'},html);var postProcessArgs=firePastePostProcess(editor,tempBody,internal);return processResult(postProcessArgs.node.innerHTML,postProcessArgs.isDefaultPrevented());};var filterContent=(editor,content,internal)=>{var preProcessArgs=firePastePreProcess(editor,content,internal);var filteredContent=preProcess(editor,preProcessArgs.content);if(editor.hasEventListeners('PastePostProcess')&&!preProcessArgs.isDefaultPrevented()){return postProcessFilter(editor,filteredContent,internal);}else{return processResult(filteredContent,preProcessArgs.isDefaultPrevented());}};var process=(editor,html,internal)=>{return filterContent(editor,html,internal);};var pasteHtml$1=(editor,html)=>{editor.insertContent(html,{merge:shouldPasteMergeFormats(editor),paste:true});return true;};var isAbsoluteUrl=url=>/^https?:\\/\\/[\\w\\-\\/+=.,!;:&%@^~(){}?#]+$/i.test(url);var isImageUrl=(editor,url)=>{return isAbsoluteUrl(url)&&exists(getAllowedImageFileTypes(editor),type=>endsWith(url.toLowerCase(),\".\".concat(type.toLowerCase())));};var createImage=(editor,url,pasteHtmlFn)=>{editor.undoManager.extra(()=>{pasteHtmlFn(editor,url);},()=>{editor.insertContent('<img src=\"'+url+'\">');});return true;};var createLink=(editor,url,pasteHtmlFn)=>{editor.undoManager.extra(()=>{pasteHtmlFn(editor,url);},()=>{editor.execCommand('mceInsertLink',false,url);});return true;};var linkSelection=(editor,html,pasteHtmlFn)=>!editor.selection.isCollapsed()&&isAbsoluteUrl(html)?createLink(editor,html,pasteHtmlFn):false;var insertImage=(editor,html,pasteHtmlFn)=>isImageUrl(editor,html)?createImage(editor,html,pasteHtmlFn):false;var smartInsertContent=(editor,html)=>{Tools.each([linkSelection,insertImage,pasteHtml$1],action=>{return!action(editor,html,pasteHtml$1);});};var insertContent=(editor,html,pasteAsText)=>{if(pasteAsText||!isSmartPasteEnabled(editor)){pasteHtml$1(editor,html);}else{smartInsertContent(editor,html);}};var uniqueId=createIdGenerator('mceclip');var createPasteDataTransfer=html=>{var dataTransfer=createDataTransfer();setHtmlData(dataTransfer,html);setReadOnlyMode(dataTransfer);return dataTransfer;};var doPaste=(editor,content,internal,pasteAsText,shouldSimulateInputEvent)=>{var res=process(editor,content,internal);if(!res.cancelled){var _content=res.content;var doPasteAction=()=>insertContent(editor,_content,pasteAsText);if(shouldSimulateInputEvent){var args=fireBeforeInputEvent(editor,'insertFromPaste',{dataTransfer:createPasteDataTransfer(_content)});if(!args.isDefaultPrevented()){doPasteAction();fireInputEvent(editor,'insertFromPaste');}}else{doPasteAction();}}};var pasteHtml=(editor,html,internalFlag,shouldSimulateInputEvent)=>{var internal=internalFlag?internalFlag:isMarked(html);doPaste(editor,unmark(html),internal,false,shouldSimulateInputEvent);};var pasteText=(editor,text,shouldSimulateInputEvent)=>{var encodedText=editor.dom.encode(text).replace(/\\r\\n/g,'\\n');var normalizedText=normalize$4(encodedText,getPasteTabSpaces(editor));var html=toBlockElements(normalizedText,getForcedRootBlock(editor),getForcedRootBlockAttrs(editor));doPaste(editor,html,false,true,shouldSimulateInputEvent);};var getDataTransferItems=dataTransfer=>{var items={};if(dataTransfer&&dataTransfer.types){for(var i=0;i<dataTransfer.types.length;i++){var contentType=dataTransfer.types[i];try{items[contentType]=dataTransfer.getData(contentType);}catch(ex){items[contentType]='';}}}return items;};var hasContentType=(clipboardContent,mimeType)=>mimeType in clipboardContent&&clipboardContent[mimeType].length>0;var hasHtmlOrText=content=>hasContentType(content,'text/html')||hasContentType(content,'text/plain');var extractFilename=(editor,str)=>{var m=str.match(/([\\s\\S]+?)(?:\\.[a-z0-9.]+)$/i);return isNonNullable(m)?editor.dom.encode(m[1]):undefined;};var createBlobInfo=(editor,blobCache,file,base64)=>{var id=uniqueId();var useFileName=shouldReuseFileName(editor)&&isNonNullable(file.name);var name=useFileName?extractFilename(editor,file.name):id;var filename=useFileName?file.name:undefined;var blobInfo=blobCache.create(id,file,base64,name,filename);blobCache.add(blobInfo);return blobInfo;};var pasteImage=(editor,imageItem)=>{parseDataUri(imageItem.uri).each(_ref16=>{var{data,type,base64Encoded}=_ref16;var base64=base64Encoded?data:btoa(data);var file=imageItem.file;var blobCache=editor.editorUpload.blobCache;var existingBlobInfo=blobCache.getByData(base64,type);var blobInfo=existingBlobInfo!==null&&existingBlobInfo!==void 0?existingBlobInfo:createBlobInfo(editor,blobCache,file,base64);pasteHtml(editor,\"<img src=\\\"\".concat(blobInfo.blobUri(),\"\\\">\"),false,true);});};var isClipboardEvent=event=>event.type==='paste';var readFilesAsDataUris=items=>Promise.all(map$3(items,file=>{return blobToDataUri(file).then(uri=>({file,uri}));}));var isImage=editor=>{var allowedExtensions=getAllowedImageFileTypes(editor);return file=>startsWith(file.type,'image/')&&exists(allowedExtensions,extension=>{return getImageMimeType(extension)===file.type;});};var getImagesFromDataTransfer=(editor,dataTransfer)=>{var items=dataTransfer.items?bind$3(from(dataTransfer.items),item=>{return item.kind==='file'?[item.getAsFile()]:[];}):[];var files=dataTransfer.files?from(dataTransfer.files):[];return filter$5(items.length>0?items:files,isImage(editor));};var pasteImageData=(editor,e,rng)=>{var dataTransfer=isClipboardEvent(e)?e.clipboardData:e.dataTransfer;if(shouldPasteDataImages(editor)&&dataTransfer){var images=getImagesFromDataTransfer(editor,dataTransfer);if(images.length>0){e.preventDefault();readFilesAsDataUris(images).then(fileResults=>{if(rng){editor.selection.setRng(rng);}each$e(fileResults,result=>{pasteImage(editor,result);});});return true;}}return false;};var isBrokenAndroidClipboardEvent=e=>{var _a,_b;return Env.os.isAndroid()&&((_b=(_a=e.clipboardData)===null||_a===void 0?void 0:_a.items)===null||_b===void 0?void 0:_b.length)===0;};var isKeyboardPasteEvent=e=>VK.metaKeyPressed(e)&&e.keyCode===86||e.shiftKey&&e.keyCode===45;var insertClipboardContent=(editor,clipboardContent,html,plainTextMode,shouldSimulateInputEvent)=>{var content=trimHtml(html);var isInternal=hasContentType(clipboardContent,internalHtmlMime())||isMarked(html);var isPlainTextHtml=!isInternal&&isPlainText(content);var isAbsoluteUrl$1=isAbsoluteUrl(content);if(isDefaultPasteBinContent(content)||!content.length||isPlainTextHtml&&!isAbsoluteUrl$1){plainTextMode=true;}if(plainTextMode||isAbsoluteUrl$1){if(hasContentType(clipboardContent,'text/plain')&&isPlainTextHtml){content=clipboardContent['text/plain'];}else{content=innerText(content);}}if(isDefaultPasteBinContent(content)){return;}if(plainTextMode){pasteText(editor,content,shouldSimulateInputEvent);}else{pasteHtml(editor,content,isInternal,shouldSimulateInputEvent);}};var registerEventHandlers=(editor,pasteBin,pasteFormat)=>{var keyboardPastePlainTextState;var getLastRng=()=>pasteBin.getLastRng()||editor.selection.getRng();editor.on('keydown',e=>{if(isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()){keyboardPastePlainTextState=e.shiftKey&&e.keyCode===86;}});editor.on('paste',e=>{if(e.isDefaultPrevented()||isBrokenAndroidClipboardEvent(e)){return;}var plainTextMode=pasteFormat.get()==='text'||keyboardPastePlainTextState;keyboardPastePlainTextState=false;var clipboardContent=getDataTransferItems(e.clipboardData);if(!hasHtmlOrText(clipboardContent)&&pasteImageData(editor,e,getLastRng())){return;}if(hasContentType(clipboardContent,'text/html')){e.preventDefault();insertClipboardContent(editor,clipboardContent,clipboardContent['text/html'],plainTextMode,true);}else if(hasContentType(clipboardContent,'text/plain')&&hasContentType(clipboardContent,'text/uri-list')){e.preventDefault();insertClipboardContent(editor,clipboardContent,clipboardContent['text/plain'],plainTextMode,true);}else{pasteBin.create();Delay.setEditorTimeout(editor,()=>{var html=pasteBin.getHtml();pasteBin.remove();insertClipboardContent(editor,clipboardContent,html,plainTextMode,false);},0);}});};var registerDataImageFilter=editor=>{var isWebKitFakeUrl=src=>startsWith(src,'webkit-fake-url');var isDataUri=src=>startsWith(src,'data:');var isPasteInsert=args=>{var _a;return((_a=args.data)===null||_a===void 0?void 0:_a.paste)===true;};editor.parser.addNodeFilter('img',(nodes,name,args)=>{if(!shouldPasteDataImages(editor)&&isPasteInsert(args)){for(var node of nodes){var src=node.attr('src');if(isString(src)&&!node.attr('data-mce-object')&&src!==Env.transparentSrc){if(isWebKitFakeUrl(src)){node.remove();}else if(!shouldAllowHtmlDataUrls(editor)&&isDataUri(src)){node.remove();}}}}});};var registerEventsAndFilters=(editor,pasteBin,pasteFormat)=>{registerEventHandlers(editor,pasteBin,pasteFormat);registerDataImageFilter(editor);};var togglePlainTextPaste=(editor,pasteFormat)=>{if(pasteFormat.get()==='text'){pasteFormat.set('html');firePastePlainTextToggle(editor,false);}else{pasteFormat.set('text');firePastePlainTextToggle(editor,true);}editor.focus();};var register$1=(editor,pasteFormat)=>{editor.addCommand('mceTogglePlainTextPaste',()=>{togglePlainTextPaste(editor,pasteFormat);});editor.addCommand('mceInsertClipboardContent',(ui,value)=>{if(value.html){pasteHtml(editor,value.html,value.internal,false);}if(value.text){pasteText(editor,value.text,false);}});};var setHtml5Clipboard=(clipboardData,html,text)=>{if(clipboardData){try{clipboardData.clearData();clipboardData.setData('text/html',html);clipboardData.setData('text/plain',text);clipboardData.setData(internalHtmlMime(),html);return true;}catch(e){return false;}}else{return false;}};var setClipboardData=(evt,data,fallback,done)=>{if(setHtml5Clipboard(evt.clipboardData,data.html,data.text)){evt.preventDefault();done();}else{fallback(data.html,done);}};var fallback=editor=>(html,done)=>{var{dom,selection}=editor;var outer=dom.create('div',{'contenteditable':'false','data-mce-bogus':'all'});var inner=dom.create('div',{contenteditable:'true'},html);dom.setStyles(outer,{position:'fixed',top:'0',left:'-3000px',width:'1000px',overflow:'hidden'});outer.appendChild(inner);dom.add(editor.getBody(),outer);var range=selection.getRng();inner.focus();var offscreenRange=dom.createRng();offscreenRange.selectNodeContents(inner);selection.setRng(offscreenRange);Delay.setEditorTimeout(editor,()=>{selection.setRng(range);dom.remove(outer);done();},0);};var getData=editor=>({html:mark(editor.selection.getContent({contextual:true})),text:editor.selection.getContent({format:'text'})});var isTableSelection=editor=>!!editor.dom.getParent(editor.selection.getStart(),'td[data-mce-selected],th[data-mce-selected]',editor.getBody());var hasSelectedContent=editor=>!editor.selection.isCollapsed()||isTableSelection(editor);var cut=editor=>evt=>{if(!evt.isDefaultPrevented()&&hasSelectedContent(editor)){setClipboardData(evt,getData(editor),fallback(editor),()=>{if(Env.browser.isChromium()||Env.browser.isFirefox()){var rng=editor.selection.getRng();Delay.setEditorTimeout(editor,()=>{editor.selection.setRng(rng);editor.execCommand('Delete');},0);}else{editor.execCommand('Delete');}});}};var copy=editor=>evt=>{if(!evt.isDefaultPrevented()&&hasSelectedContent(editor)){setClipboardData(evt,getData(editor),fallback(editor),noop);}};var register=editor=>{editor.on('cut',cut(editor));editor.on('copy',copy(editor));};var getCaretRangeFromEvent=(editor,e)=>{var _a,_b;return RangeUtils.getCaretRangeFromPoint((_a=e.clientX)!==null&&_a!==void 0?_a:0,(_b=e.clientY)!==null&&_b!==void 0?_b:0,editor.getDoc());};var isPlainTextFileUrl=content=>{var plainTextContent=content['text/plain'];return plainTextContent?plainTextContent.indexOf('file://')===0:false;};var setFocusedRange=(editor,rng)=>{editor.focus();if(rng){editor.selection.setRng(rng);}};var hasImage=dataTransfer=>exists(dataTransfer.files,file=>/^image\\//.test(file.type));var needsCustomInternalDrop=(dom,schema,target,dropContent)=>{var parentTransparent=dom.getParent(target,node=>isTransparentBlock(schema,node));var inSummary=!isNull(dom.getParent(target,'summary'));if(inSummary){return true;}else if(parentTransparent&&has$2(dropContent,'text/html')){var fragment=new DOMParser().parseFromString(dropContent['text/html'],'text/html').body;return!isNull(fragment.querySelector(parentTransparent.nodeName.toLowerCase()));}else{return false;}};var setupSummaryDeleteByDragFix=editor=>{editor.on('input',e=>{var hasNoSummary=el=>isNull(el.querySelector('summary'));if(e.inputType==='deleteByDrag'){var brokenDetailElements=filter$5(editor.dom.select('details'),hasNoSummary);each$e(brokenDetailElements,details=>{if(isBr$6(details.firstChild)){details.firstChild.remove();}var summary=editor.dom.create('summary');summary.appendChild(createPaddingBr().dom);details.prepend(summary);});}});};var setup$a=(editor,draggingInternallyState)=>{if(shouldPasteBlockDrop(editor)){editor.on('dragend dragover draggesture dragdrop drop drag',e=>{e.preventDefault();e.stopPropagation();});}if(!shouldPasteDataImages(editor)){editor.on('drop',e=>{var dataTransfer=e.dataTransfer;if(dataTransfer&&hasImage(dataTransfer)){e.preventDefault();}});}editor.on('drop',e=>{if(e.isDefaultPrevented()){return;}var rng=getCaretRangeFromEvent(editor,e);if(isNullable(rng)){return;}var dropContent=getDataTransferItems(e.dataTransfer);var internal=hasContentType(dropContent,internalHtmlMime());if((!hasHtmlOrText(dropContent)||isPlainTextFileUrl(dropContent))&&pasteImageData(editor,e,rng)){return;}var internalContent=dropContent[internalHtmlMime()];var content=internalContent||dropContent['text/html']||dropContent['text/plain'];var needsInternalDrop=needsCustomInternalDrop(editor.dom,editor.schema,rng.startContainer,dropContent);var isInternalDrop=draggingInternallyState.get();if(isInternalDrop&&!needsInternalDrop){return;}if(content){e.preventDefault();Delay.setEditorTimeout(editor,()=>{editor.undoManager.transact(()=>{if(internalContent||isInternalDrop&&needsInternalDrop){editor.execCommand('Delete');}setFocusedRange(editor,rng);var trimmedContent=trimHtml(content);if(dropContent['text/html']){pasteHtml(editor,trimmedContent,internal,true);}else{pasteText(editor,trimmedContent,true);}});});}});editor.on('dragstart',_e=>{draggingInternallyState.set(true);});editor.on('dragover dragend',e=>{if(shouldPasteDataImages(editor)&&!draggingInternallyState.get()){e.preventDefault();setFocusedRange(editor,getCaretRangeFromEvent(editor,e));}if(e.type==='dragend'){draggingInternallyState.set(false);}});setupSummaryDeleteByDragFix(editor);};var setup$9=editor=>{var processEvent=f=>e=>{f(editor,e);};var preProcess=getPastePreProcess(editor);if(isFunction(preProcess)){editor.on('PastePreProcess',processEvent(preProcess));}var postProcess=getPastePostProcess(editor);if(isFunction(postProcess)){editor.on('PastePostProcess',processEvent(postProcess));}};var addPreProcessFilter=(editor,filterFunc)=>{editor.on('PastePreProcess',e=>{e.content=filterFunc(editor,e.content,e.internal);});};var rgbRegExp=/rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;var rgbToHex=value=>Tools.trim(value).replace(rgbRegExp,rgbaToHexString).toLowerCase();var removeWebKitStyles=(editor,content,internal)=>{var webKitStylesOption=getPasteWebkitStyles(editor);if(internal||webKitStylesOption==='all'||!shouldPasteRemoveWebKitStyles(editor)){return content;}var webKitStyles=webKitStylesOption?webKitStylesOption.split(/[, ]/):[];if(webKitStyles&&webKitStylesOption!=='none'){var _dom3=editor.dom,node=editor.selection.getNode();content=content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi,(all,before,value,after)=>{var inputStyles=_dom3.parseStyle(_dom3.decode(value));var outputStyles={};for(var i=0;i<webKitStyles.length;i++){var inputValue=inputStyles[webKitStyles[i]];var compareInput=inputValue;var currentValue=_dom3.getStyle(node,webKitStyles[i],true);if(/color/.test(webKitStyles[i])){compareInput=rgbToHex(compareInput);currentValue=rgbToHex(currentValue);}if(currentValue!==compareInput){outputStyles[webKitStyles[i]]=inputValue;}}var outputStyle=_dom3.serializeStyle(outputStyles,'span');if(outputStyle){return before+' style=\"'+outputStyle+'\"'+after;}return before+after;});}else{content=content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi,'$1$3');}content=content.replace(/(<[^>]+) data-mce-style=\"([^\"]+)\"([^>]*>)/gi,(all,before,value,after)=>{return before+' style=\"'+value+'\"'+after;});return content;};var setup$8=editor=>{if(Env.browser.isChromium()||Env.browser.isSafari()){addPreProcessFilter(editor,removeWebKitStyles);}};var setup$7=editor=>{var draggingInternallyState=Cell(false);var pasteFormat=Cell(isPasteAsTextEnabled(editor)?'text':'html');var pasteBin=PasteBin(editor);setup$8(editor);register$1(editor,pasteFormat);setup$9(editor);editor.on('PreInit',()=>{register(editor);setup$a(editor,draggingInternallyState);registerEventsAndFilters(editor,pasteBin,pasteFormat);});};var preventSummaryToggle=editor=>{editor.on('click',e=>{if(editor.dom.getParent(e.target,'details')){e.preventDefault();}});};var filterDetails=editor=>{editor.parser.addNodeFilter('details',elms=>{var initialStateOption=getDetailsInitialState(editor);each$e(elms,details=>{if(initialStateOption==='expanded'){details.attr('open','open');}else if(initialStateOption==='collapsed'){details.attr('open',null);}});});editor.serializer.addNodeFilter('details',elms=>{var serializedStateOption=getDetailsSerializedState(editor);each$e(elms,details=>{if(serializedStateOption==='expanded'){details.attr('open','open');}else if(serializedStateOption==='collapsed'){details.attr('open',null);}});});};var setup$6=editor=>{preventSummaryToggle(editor);filterDetails(editor);};var isBr=isBr$6;var isText=isText$a;var isContentEditableFalse$2=elm=>isContentEditableFalse$b(elm.dom);var isContentEditableTrue=elm=>isContentEditableTrue$3(elm.dom);var isRoot=rootNode=>elm=>eq(SugarElement.fromDom(rootNode),elm);var getClosestScope=(node,rootNode)=>closest$4(SugarElement.fromDom(node),elm=>isContentEditableTrue(elm)||isBlock$2(elm),isRoot(rootNode)).getOr(SugarElement.fromDom(rootNode)).dom;var getClosestCef=(node,rootNode)=>closest$4(SugarElement.fromDom(node),isContentEditableFalse$2,isRoot(rootNode));var findEdgeCaretCandidate=(startNode,scope,forward)=>{var walker=new DomTreeWalker(startNode,scope);var next=forward?walker.next.bind(walker):walker.prev.bind(walker);var result=startNode;for(var current=forward?startNode:next();current&&!isBr(current);current=next()){if(isCaretCandidate$3(current)){result=current;}}return result;};var findClosestBlockRange=(startRng,rootNode)=>{var startPos=CaretPosition.fromRangeStart(startRng);var clickNode=startPos.getNode();var scope=getClosestScope(clickNode,rootNode);var startNode=findEdgeCaretCandidate(clickNode,scope,false);var endNode=findEdgeCaretCandidate(clickNode,scope,true);var rng=document.createRange();getClosestCef(startNode,scope).fold(()=>{if(isText(startNode)){rng.setStart(startNode,0);}else{rng.setStartBefore(startNode);}},cef=>rng.setStartBefore(cef.dom));getClosestCef(endNode,scope).fold(()=>{if(isText(endNode)){rng.setEnd(endNode,endNode.data.length);}else{rng.setEndAfter(endNode);}},cef=>rng.setEndAfter(cef.dom));return rng;};var onTripleClickSelect=editor=>{var rng=findClosestBlockRange(editor.selection.getRng(),editor.getBody());editor.selection.setRng(normalize(rng));};var setup$5=editor=>{editor.on('mousedown',e=>{if(e.detail>=3){e.preventDefault();onTripleClickSelect(editor);}});};var FakeCaretPosition;(function(FakeCaretPosition){FakeCaretPosition['Before']='before';FakeCaretPosition['After']='after';})(FakeCaretPosition||(FakeCaretPosition={}));var distanceToRectLeft=(clientRect,clientX)=>Math.abs(clientRect.left-clientX);var distanceToRectRight=(clientRect,clientX)=>Math.abs(clientRect.right-clientX);var isInsideY=(clientY,clientRect)=>clientY>=clientRect.top&&clientY<=clientRect.bottom;var collidesY=(r1,r2)=>r1.top<r2.bottom&&r1.bottom>r2.top;var isOverlapping=(r1,r2)=>{var overlap=overlapY(r1,r2)/Math.min(r1.height,r2.height);return collidesY(r1,r2)&&overlap>0.5;};var splitRectsPerAxis=(rects,y)=>{var intersectingRects=filter$5(rects,rect=>isInsideY(y,rect));return boundingClientRectFromRects(intersectingRects).fold(()=>[[],rects],boundingRect=>{var{pass:horizontal,fail:vertical}=partition$2(rects,rect=>isOverlapping(rect,boundingRect));return[horizontal,vertical];});};var clientInfo=(rect,clientX)=>{return{node:rect.node,position:distanceToRectLeft(rect,clientX)<distanceToRectRight(rect,clientX)?FakeCaretPosition.Before:FakeCaretPosition.After};};var horizontalDistance=(rect,x,_y)=>x>rect.left&&x<rect.right?0:Math.min(Math.abs(rect.left-x),Math.abs(rect.right-x));var closestChildCaretCandidateNodeRect=(children,clientX,clientY)=>{var caretCandidateRect=rect=>{if(isCaretCandidate$3(rect.node)){return Optional.some(rect);}else if(isElement$6(rect.node)){return closestChildCaretCandidateNodeRect(from(rect.node.childNodes),clientX,clientY);}else{return Optional.none();}};var getClosestTextNode=(rects,distance)=>{if(rects.length>=2){var r1=caretCandidateRect(rects[0]).getOr(rects[0]);var r2=caretCandidateRect(rects[1]).getOr(rects[1]);var deltaDistance=Math.abs(distance(r1,clientX,clientY)-distance(r2,clientX,clientY));if(deltaDistance<2){if(isText$a(r1.node)){return Optional.some(r1);}else if(isText$a(r2.node)){return Optional.some(r2);}}}return Optional.none();};var findClosestCaretCandidateNodeRect=(rects,distance)=>{var sortedRects=sort(rects,(r1,r2)=>distance(r1,clientX,clientY)-distance(r2,clientX,clientY));return getClosestTextNode(sortedRects,distance).orThunk(()=>findMap(sortedRects,caretCandidateRect));};var[horizontalRects,verticalRects]=splitRectsPerAxis(getClientRects(children),clientY);var{pass:above,fail:below}=partition$2(verticalRects,rect=>rect.top<clientY);return findClosestCaretCandidateNodeRect(horizontalRects,horizontalDistance).orThunk(()=>findClosestCaretCandidateNodeRect(below,distanceToRectEdgeFromXY)).orThunk(()=>findClosestCaretCandidateNodeRect(above,distanceToRectEdgeFromXY));};var traverseUp=(rootElm,scope,clientX,clientY)=>{var helper=(scope,prevScope)=>{var isDragGhostContainer=node=>isElement$6(node)&&node.classList.contains('mce-drag-container');var childNodesWithoutGhost=filter$5(scope.dom.childNodes,not(isDragGhostContainer));return prevScope.fold(()=>closestChildCaretCandidateNodeRect(childNodesWithoutGhost,clientX,clientY),prevScope=>{var uncheckedChildren=filter$5(childNodesWithoutGhost,node=>node!==prevScope.dom);return closestChildCaretCandidateNodeRect(uncheckedChildren,clientX,clientY);}).orThunk(()=>{var parent=eq(scope,rootElm)?Optional.none():parentElement(scope);return parent.bind(newScope=>helper(newScope,Optional.some(scope)));});};return helper(scope,Optional.none());};var closestCaretCandidateNodeRect=(root,clientX,clientY)=>{var rootElm=SugarElement.fromDom(root);var ownerDoc=documentOrOwner(rootElm);var elementAtPoint=SugarElement.fromPoint(ownerDoc,clientX,clientY).filter(elm=>contains(rootElm,elm));var element=elementAtPoint.getOr(rootElm);return traverseUp(rootElm,element,clientX,clientY);};var closestFakeCaretCandidate=(root,clientX,clientY)=>closestCaretCandidateNodeRect(root,clientX,clientY).filter(rect=>isFakeCaretTarget(rect.node)).map(rect=>clientInfo(rect,clientX));var getAbsolutePosition=elm=>{var _a,_b;var clientRect=elm.getBoundingClientRect();var doc=elm.ownerDocument;var docElem=doc.documentElement;var win=doc.defaultView;return{top:clientRect.top+((_a=win===null||win===void 0?void 0:win.scrollY)!==null&&_a!==void 0?_a:0)-docElem.clientTop,left:clientRect.left+((_b=win===null||win===void 0?void 0:win.scrollX)!==null&&_b!==void 0?_b:0)-docElem.clientLeft};};var getBodyPosition=editor=>editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0};var getScrollPosition=editor=>{var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0};};var getBodyScroll=editor=>{var body=editor.getBody(),docElm=editor.getDoc().documentElement;var inlineScroll={left:body.scrollLeft,top:body.scrollTop};var iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll;};var getMousePosition=(editor,event)=>{if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer());var scrollPosition=getBodyScroll(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top};}return{left:event.pageX,top:event.pageY};};var calculatePosition=(bodyPosition,scrollPosition,mousePosition)=>({pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top});var calc=(editor,event)=>calculatePosition(getBodyPosition(editor),getScrollPosition(editor),getMousePosition(editor,event));var getTargetProps=target=>({target,srcElement:target});var makeDndEventFromMouseEvent=(type,mouseEvent,target,dataTransfer)=>_objectSpread(_objectSpread({},mouseEvent),{},{dataTransfer,type},getTargetProps(target));var makeDndEvent=(type,target,dataTransfer)=>{var fail=die('Function not supported on simulated event.');var event=_objectSpread({bubbles:true,cancelBubble:false,cancelable:true,composed:false,currentTarget:null,defaultPrevented:false,eventPhase:0,isTrusted:true,returnValue:false,timeStamp:0,type,composedPath:fail,initEvent:fail,preventDefault:noop,stopImmediatePropagation:noop,stopPropagation:noop,AT_TARGET:window.Event.AT_TARGET,BUBBLING_PHASE:window.Event.BUBBLING_PHASE,CAPTURING_PHASE:window.Event.CAPTURING_PHASE,NONE:window.Event.NONE,altKey:false,button:0,buttons:0,clientX:0,clientY:0,ctrlKey:false,metaKey:false,movementX:0,movementY:0,offsetX:0,offsetY:0,pageX:0,pageY:0,relatedTarget:null,screenX:0,screenY:0,shiftKey:false,x:0,y:0,detail:0,view:null,which:0,initUIEvent:fail,initMouseEvent:fail,getModifierState:fail,dataTransfer},getTargetProps(target));return event;};var makeDataTransferCopyForDragEvent=(dataTransfer,eventType)=>{var copy=cloneDataTransfer(dataTransfer);if(eventType==='dragstart'){setDragstartEvent(copy);setReadWriteMode(copy);}else if(eventType==='drop'){setDropEvent(copy);setReadOnlyMode(copy);}else{setDragendEvent(copy);setProtectedMode(copy);}return copy;};var makeDragEvent=(type,target,dataTransfer,mouseEvent)=>{var dataTransferForDispatch=makeDataTransferCopyForDragEvent(dataTransfer,type);return isUndefined(mouseEvent)?makeDndEvent(type,target,dataTransferForDispatch):makeDndEventFromMouseEvent(type,mouseEvent,target,dataTransferForDispatch);};var scrollPixelsPerInterval=32;var scrollIntervalValue=100;var mouseRangeToTriggerScrollInsideEditor=8;var mouseRangeToTriggerScrollOutsideEditor=16;var isContentEditableFalse$1=isContentEditableFalse$b;var isContentEditable=or(isContentEditableFalse$1,isContentEditableTrue$3);var isDraggable=(dom,rootElm,elm)=>isContentEditableFalse$1(elm)&&elm!==rootElm&&dom.isEditable(elm.parentElement);var isValidDropTarget=(editor,targetElement,dragElement)=>{if(isNullable(targetElement)){return false;}else if(targetElement===dragElement||editor.dom.isChildOf(targetElement,dragElement)){return false;}else{return editor.dom.isEditable(targetElement);}};var createGhost=(editor,elm,width,height)=>{var dom=editor.dom;var clonedElm=elm.cloneNode(true);dom.setStyles(clonedElm,{width,height});dom.setAttrib(clonedElm,'data-mce-selected',null);var ghostElm=dom.create('div',{'class':'mce-drag-container','data-mce-bogus':'all','unselectable':'on','contenteditable':'false'});dom.setStyles(ghostElm,{position:'absolute',opacity:0.5,overflow:'hidden',border:0,padding:0,margin:0,width,height});dom.setStyles(clonedElm,{margin:0,boxSizing:'border-box'});ghostElm.appendChild(clonedElm);return ghostElm;};var appendGhostToBody=(ghostElm,bodyElm)=>{if(ghostElm.parentNode!==bodyElm){bodyElm.appendChild(ghostElm);}};var scrollEditor=(direction,amount)=>win=>()=>{var current=direction==='left'?win.scrollX:win.scrollY;win.scroll({[direction]:current+amount,behavior:'smooth'});};var scrollLeft=scrollEditor('left',-scrollPixelsPerInterval);var scrollRight=scrollEditor('left',scrollPixelsPerInterval);var scrollUp=scrollEditor('top',-scrollPixelsPerInterval);var scrollDown=scrollEditor('top',scrollPixelsPerInterval);var moveGhost=(ghostElm,position,width,height,maxX,maxY,mouseY,mouseX,contentAreaContainer,win,state,mouseEventOriginatedFromWithinTheEditor)=>{var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+'px';ghostElm.style.top=position.pageY+'px';if(position.pageX+width>maxX){overflowX=position.pageX+width-maxX;}if(position.pageY+height>maxY){overflowY=position.pageY+height-maxY;}ghostElm.style.width=width-overflowX+'px';ghostElm.style.height=height-overflowY+'px';var clientHeight=contentAreaContainer.clientHeight;var clientWidth=contentAreaContainer.clientWidth;var outerMouseY=mouseY+contentAreaContainer.getBoundingClientRect().top;var outerMouseX=mouseX+contentAreaContainer.getBoundingClientRect().left;state.on(state=>{state.intervalId.clear();if(state.dragging&&mouseEventOriginatedFromWithinTheEditor){if(mouseY+mouseRangeToTriggerScrollInsideEditor>=clientHeight){state.intervalId.set(scrollDown(win));}else if(mouseY-mouseRangeToTriggerScrollInsideEditor<=0){state.intervalId.set(scrollUp(win));}else if(mouseX+mouseRangeToTriggerScrollInsideEditor>=clientWidth){state.intervalId.set(scrollRight(win));}else if(mouseX-mouseRangeToTriggerScrollInsideEditor<=0){state.intervalId.set(scrollLeft(win));}else if(outerMouseY+mouseRangeToTriggerScrollOutsideEditor>=window.innerHeight){state.intervalId.set(scrollDown(window));}else if(outerMouseY-mouseRangeToTriggerScrollOutsideEditor<=0){state.intervalId.set(scrollUp(window));}else if(outerMouseX+mouseRangeToTriggerScrollOutsideEditor>=window.innerWidth){state.intervalId.set(scrollRight(window));}else if(outerMouseX-mouseRangeToTriggerScrollOutsideEditor<=0){state.intervalId.set(scrollLeft(window));}}});};var removeElement=elm=>{if(elm&&elm.parentNode){elm.parentNode.removeChild(elm);}};var removeElementWithPadding=(dom,elm)=>{var parentBlock=dom.getParent(elm.parentNode,dom.isBlock);removeElement(elm);if(parentBlock&&parentBlock!==dom.getRoot()&&dom.isEmpty(parentBlock)){fillWithPaddingBr(SugarElement.fromDom(parentBlock));}};var isLeftMouseButtonPressed=e=>e.button===0;var applyRelPos=(state,position)=>({pageX:position.pageX-state.relX,pageY:position.pageY+5});var start=(state,editor)=>e=>{if(isLeftMouseButtonPressed(e)){var ceElm=find$2(editor.dom.getParents(e.target),isContentEditable).getOr(null);if(isNonNullable(ceElm)&&isDraggable(editor.dom,editor.getBody(),ceElm)){var elmPos=editor.dom.getPos(ceElm);var bodyElm=editor.getBody();var docElm=editor.getDoc().documentElement;state.set({element:ceElm,dataTransfer:createDataTransfer(),dragging:false,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight),intervalId:repeatable(scrollIntervalValue)});}}};var placeCaretAt=(editor,clientX,clientY)=>{editor._selectionOverrides.hideFakeCaret();closestFakeCaretCandidate(editor.getBody(),clientX,clientY).fold(()=>editor.selection.placeCaretAt(clientX,clientY),caretInfo=>{var range=editor._selectionOverrides.showCaret(1,caretInfo.node,caretInfo.position===FakeCaretPosition.Before,false);if(range){editor.selection.setRng(range);}else{editor.selection.placeCaretAt(clientX,clientY);}});};var dispatchDragEvent=(editor,type,target,dataTransfer,mouseEvent)=>{if(type==='dragstart'){setHtmlData(dataTransfer,editor.dom.getOuterHTML(target));}var event=makeDragEvent(type,target,dataTransfer,mouseEvent);var args=editor.dispatch(type,event);return args;};var move=(state,editor)=>{var throttledPlaceCaretAt=first$1((clientX,clientY)=>placeCaretAt(editor,clientX,clientY),0);editor.on('remove',throttledPlaceCaretAt.cancel);var state_=state;return e=>state.on(state=>{var movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){var args=dispatchDragEvent(editor,'dragstart',state.element,state.dataTransfer,e);if(isNonNullable(args.dataTransfer)){state.dataTransfer=args.dataTransfer;}if(args.isDefaultPrevented()){return;}state.dragging=true;editor.focus();}if(state.dragging){var mouseEventOriginatedFromWithinTheEditor=e.currentTarget===editor.getDoc().documentElement;var targetPos=applyRelPos(state,calc(editor,e));appendGhostToBody(state.ghost,editor.getBody());moveGhost(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY,e.clientY,e.clientX,editor.getContentAreaContainer(),editor.getWin(),state_,mouseEventOriginatedFromWithinTheEditor);throttledPlaceCaretAt.throttle(e.clientX,e.clientY);}});};var getRawTarget=selection=>{var sel=selection.getSel();if(isNonNullable(sel)){var rng=sel.getRangeAt(0);var startContainer=rng.startContainer;return isText$a(startContainer)?startContainer.parentNode:startContainer;}else{return null;}};var drop=(state,editor)=>e=>{state.on(state=>{var _a;state.intervalId.clear();if(state.dragging){if(isValidDropTarget(editor,getRawTarget(editor.selection),state.element)){var dropTarget=(_a=editor.getDoc().elementFromPoint(e.clientX,e.clientY))!==null&&_a!==void 0?_a:editor.getBody();var args=dispatchDragEvent(editor,'drop',dropTarget,state.dataTransfer,e);if(!args.isDefaultPrevented()){editor.undoManager.transact(()=>{removeElementWithPadding(editor.dom,state.element);getHtmlData(state.dataTransfer).each(content=>editor.insertContent(content));editor._selectionOverrides.hideFakeCaret();});}}dispatchDragEvent(editor,'dragend',editor.getBody(),state.dataTransfer,e);}});removeDragState(state);};var stopDragging=(state,editor,e)=>{state.on(state=>{state.intervalId.clear();if(state.dragging){e.fold(()=>dispatchDragEvent(editor,'dragend',state.element,state.dataTransfer),mouseEvent=>dispatchDragEvent(editor,'dragend',state.element,state.dataTransfer,mouseEvent));}});removeDragState(state);};var stop=(state,editor)=>e=>stopDragging(state,editor,Optional.some(e));var removeDragState=state=>{state.on(state=>{state.intervalId.clear();removeElement(state.ghost);});state.clear();};var bindFakeDragEvents=editor=>{var state=value$2();var pageDom=DOMUtils.DOM;var rootDocument=document;var dragStartHandler=start(state,editor);var dragHandler=move(state,editor);var dropHandler=drop(state,editor);var dragEndHandler=stop(state,editor);editor.on('mousedown',dragStartHandler);editor.on('mousemove',dragHandler);editor.on('mouseup',dropHandler);pageDom.bind(rootDocument,'mousemove',dragHandler);pageDom.bind(rootDocument,'mouseup',dragEndHandler);editor.on('remove',()=>{pageDom.unbind(rootDocument,'mousemove',dragHandler);pageDom.unbind(rootDocument,'mouseup',dragEndHandler);});editor.on('keydown',e=>{if(e.keyCode===VK.ESC){stopDragging(state,editor,Optional.none());}});};var blockUnsupportedFileDrop=editor=>{var preventFileDrop=e=>{if(!e.isDefaultPrevented()){var dataTransfer=e.dataTransfer;if(dataTransfer&&(contains$2(dataTransfer.types,'Files')||dataTransfer.files.length>0)){e.preventDefault();if(e.type==='drop'){displayError(editor,'Dropped file type is not supported');}}}};var preventFileDropIfUIElement=e=>{if(isUIElement(editor,e.target)){preventFileDrop(e);}};var setup=()=>{var pageDom=DOMUtils.DOM;var dom=editor.dom;var doc=document;var editorRoot=editor.inline?editor.getBody():editor.getDoc();var eventNames=['drop','dragover'];each$e(eventNames,name=>{pageDom.bind(doc,name,preventFileDropIfUIElement);dom.bind(editorRoot,name,preventFileDrop);});editor.on('remove',()=>{each$e(eventNames,name=>{pageDom.unbind(doc,name,preventFileDropIfUIElement);dom.unbind(editorRoot,name,preventFileDrop);});});};editor.on('init',()=>{Delay.setEditorTimeout(editor,setup,0);});};var init$2=editor=>{bindFakeDragEvents(editor);if(shouldBlockUnsupportedDrop(editor)){blockUnsupportedFileDrop(editor);}};var setup$4=editor=>{var renderFocusCaret=first$1(()=>{if(!editor.removed&&editor.getBody().contains(document.activeElement)){var rng=editor.selection.getRng();if(rng.collapsed){var caretRange=renderRangeCaret(editor,rng,false);editor.selection.setRng(caretRange);}}},0);editor.on('focus',()=>{renderFocusCaret.throttle();});editor.on('blur',()=>{renderFocusCaret.cancel();});};var setup$3=editor=>{editor.on('init',()=>{editor.on('focusin',e=>{var target=e.target;if(isMedia$2(target)){var ceRoot=getContentEditableRoot$1(editor.getBody(),target);var node=isContentEditableFalse$b(ceRoot)?ceRoot:target;if(editor.selection.getNode()!==node){selectNode(editor,node).each(rng=>editor.selection.setRng(rng));}}});});};var isContentEditableFalse=isContentEditableFalse$b;var getContentEditableRoot=(editor,node)=>getContentEditableRoot$1(editor.getBody(),node);var SelectionOverrides=editor=>{var selection=editor.selection,dom=editor.dom;var rootNode=editor.getBody();var fakeCaret=FakeCaret(editor,rootNode,dom.isBlock,()=>hasFocus(editor));var realSelectionId='sel-'+dom.uniqueId();var elementSelectionAttr='data-mce-selected';var selectedElement;var isFakeSelectionElement=node=>isNonNullable(node)&&dom.hasClass(node,'mce-offscreen-selection');var isFakeSelectionTargetElement=node=>node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode)&&dom.isEditable(node.parentNode);var setRange=range=>{if(range){selection.setRng(range);}};var showCaret=function showCaret(direction,node,before){var scrollIntoView=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var e=editor.dispatch('ShowCaret',{target:node,direction,before});if(e.isDefaultPrevented()){return null;}if(scrollIntoView){selection.scrollIntoView(node,direction===-1);}return fakeCaret.show(before,node);};var showBlockCaretContainer=blockCaretContainer=>{if(blockCaretContainer.hasAttribute('data-mce-caret')){showCaretContainerBlock(blockCaretContainer);selection.scrollIntoView(blockCaretContainer);}};var registerEvents=()=>{editor.on('click',e=>{if(!dom.isEditable(e.target)){e.preventDefault();editor.focus();}});editor.on('blur NewBlock',removeElementSelection);editor.on('ResizeWindow FullscreenStateChanged',fakeCaret.reposition);editor.on('tap',e=>{var targetElm=e.target;var contentEditableRoot=getContentEditableRoot(editor,targetElm);if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();selectNode(editor,contentEditableRoot).each(setElementSelection);}else if(isFakeSelectionTargetElement(targetElm)){selectNode(editor,targetElm).each(setElementSelection);}},true);editor.on('mousedown',e=>{var targetElm=e.target;if(targetElm!==rootNode&&targetElm.nodeName!=='HTML'&&!dom.isChildOf(targetElm,rootNode)){return;}if(!isXYInContentArea(editor,e.clientX,e.clientY)){return;}removeElementSelection();hideFakeCaret();var closestContentEditable=getContentEditableRoot(editor,targetElm);if(isContentEditableFalse(closestContentEditable)){e.preventDefault();selectNode(editor,closestContentEditable).each(setElementSelection);}else{closestFakeCaretCandidate(rootNode,e.clientX,e.clientY).each(caretInfo=>{e.preventDefault();var range=showCaret(1,caretInfo.node,caretInfo.position===FakeCaretPosition.Before,false);setRange(range);if(isElement$6(closestContentEditable)){closestContentEditable.focus();}else{editor.getBody().focus();}});}});editor.on('keypress',e=>{if(VK.modifierPressed(e)){return;}if(isContentEditableFalse(selection.getNode())){e.preventDefault();}});editor.on('GetSelectionRange',e=>{var rng=e.range;if(selectedElement){if(!selectedElement.parentNode){selectedElement=null;return;}rng=rng.cloneRange();rng.selectNode(selectedElement);e.range=rng;}});editor.on('SetSelectionRange',e=>{e.range=normalizeVoidElementSelection(e.range);var rng=setElementSelection(e.range,e.forward);if(rng){e.range=rng;}});var isPasteBin=node=>isElement$6(node)&&node.id==='mcepastebin';editor.on('AfterSetSelectionRange',e=>{var rng=e.range;var parent=rng.startContainer.parentElement;if(!isRangeInCaretContainer(rng)&&!isPasteBin(parent)){hideFakeCaret();}if(!isFakeSelectionElement(parent)){removeElementSelection();}});init$2(editor);setup$4(editor);setup$3(editor);};var isWithinCaretContainer=node=>isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node);var isRangeInCaretContainer=rng=>isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer);var normalizeVoidElementSelection=rng=>{var voidElements=editor.schema.getVoidElements();var newRng=dom.createRng();var startContainer=rng.startContainer;var startOffset=rng.startOffset;var endContainer=rng.endContainer;var endOffset=rng.endOffset;if(has$2(voidElements,startContainer.nodeName.toLowerCase())){if(startOffset===0){newRng.setStartBefore(startContainer);}else{newRng.setStartAfter(startContainer);}}else{newRng.setStart(startContainer,startOffset);}if(has$2(voidElements,endContainer.nodeName.toLowerCase())){if(endOffset===0){newRng.setEndBefore(endContainer);}else{newRng.setEndAfter(endContainer);}}else{newRng.setEnd(endContainer,endOffset);}return newRng;};var setupOffscreenSelection=(node,targetClone)=>{var body=SugarElement.fromDom(editor.getBody());var doc=editor.getDoc();var realSelectionContainer=descendant(body,'#'+realSelectionId).getOrThunk(()=>{var newContainer=SugarElement.fromHtml('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>',doc);set$3(newContainer,'id',realSelectionId);append$1(body,newContainer);return newContainer;});var newRange=dom.createRng();empty(realSelectionContainer);append(realSelectionContainer,[SugarElement.fromText(nbsp,doc),SugarElement.fromDom(targetClone),SugarElement.fromText(nbsp,doc)]);newRange.setStart(realSelectionContainer.dom.firstChild,1);newRange.setEnd(realSelectionContainer.dom.lastChild,0);setAll(realSelectionContainer,{top:dom.getPos(node,editor.getBody()).y+'px'});focus$1(realSelectionContainer);var sel=selection.getSel();if(sel){sel.removeAllRanges();sel.addRange(newRange);}return newRange;};var selectElement=elm=>{var targetClone=elm.cloneNode(true);var e=editor.dispatch('ObjectSelected',{target:elm,targetClone});if(e.isDefaultPrevented()){return null;}var range=setupOffscreenSelection(elm,e.targetClone);var nodeElm=SugarElement.fromDom(elm);each$e(descendants(SugarElement.fromDom(editor.getBody()),\"*[\".concat(elementSelectionAttr,\"]\")),elm=>{if(!eq(nodeElm,elm)){remove$a(elm,elementSelectionAttr);}});if(!dom.getAttrib(elm,elementSelectionAttr)){elm.setAttribute(elementSelectionAttr,'1');}selectedElement=elm;hideFakeCaret();return range;};var setElementSelection=(range,forward)=>{if(!range){return null;}if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1;var caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range);var beforeNode=caretPosition.getNode(!forward);if(isNonNullable(beforeNode)){if(isFakeCaretTarget(beforeNode)){return showCaret(dir,beforeNode,forward?!caretPosition.isAtEnd():false,false);}if(isCaretContainerInline(beforeNode)&&isContentEditableFalse$b(beforeNode.nextSibling)){var rng=dom.createRng();rng.setStart(beforeNode,0);rng.setEnd(beforeNode,0);return rng;}}var afterNode=caretPosition.getNode(forward);if(isNonNullable(afterNode)){if(isFakeCaretTarget(afterNode)){return showCaret(dir,afterNode,forward?false:!caretPosition.isAtEnd(),false);}if(isCaretContainerInline(afterNode)&&isContentEditableFalse$b(afterNode.previousSibling)){var _rng=dom.createRng();_rng.setStart(afterNode,1);_rng.setEnd(afterNode,1);return _rng;}}}return null;}var startContainer=range.startContainer;var startOffset=range.startOffset;var endOffset=range.endOffset;if(isText$a(startContainer)&&startOffset===0&&isContentEditableFalse(startContainer.parentNode)){startContainer=startContainer.parentNode;startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode;}if(!isElement$6(startContainer)){return null;}if(endOffset===startOffset+1&&startContainer===range.endContainer){var node=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(node)){return selectElement(node);}}return null;};var removeElementSelection=()=>{if(selectedElement){selectedElement.removeAttribute(elementSelectionAttr);}descendant(SugarElement.fromDom(editor.getBody()),'#'+realSelectionId).each(remove$5);selectedElement=null;};var destroy=()=>{fakeCaret.destroy();selectedElement=null;};var hideFakeCaret=()=>{fakeCaret.hide();};if(!isRtc(editor)){registerEvents();}return{showCaret,showBlockCaretContainer,hideFakeCaret,destroy};};var getNormalizedTextOffset=(container,offset)=>{var normalizedOffset=offset;for(var node=container.previousSibling;isText$a(node);node=node.previousSibling){normalizedOffset+=node.data.length;}return normalizedOffset;};var generatePath=(dom,root,node,offset,normalized)=>{if(isText$a(node)&&(offset<0||offset>node.data.length)){return[];}var p=normalized&&isText$a(node)?[getNormalizedTextOffset(node,offset)]:[offset];var current=node;while(current!==root&&current.parentNode){p.push(dom.nodeIndex(current,normalized));current=current.parentNode;}return current===root?p.reverse():[];};var generatePathRange=function generatePathRange(dom,root,startNode,startOffset,endNode,endOffset){var normalized=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var start=generatePath(dom,root,startNode,startOffset,normalized);var end=generatePath(dom,root,endNode,endOffset,normalized);return{start,end};};var resolvePath=(root,path)=>{var nodePath=path.slice();var offset=nodePath.pop();if(!isNumber(offset)){return Optional.none();}else{var resolvedNode=foldl(nodePath,(optNode,index)=>optNode.bind(node=>Optional.from(node.childNodes[index])),Optional.some(root));return resolvedNode.bind(node=>{if(isText$a(node)&&(offset<0||offset>node.data.length)){return Optional.none();}else{return Optional.some({node,offset});}});}};var resolvePathRange=(root,range)=>resolvePath(root,range.start).bind(_ref17=>{var{node:startNode,offset:startOffset}=_ref17;return resolvePath(root,range.end).map(_ref18=>{var{node:endNode,offset:endOffset}=_ref18;var rng=document.createRange();rng.setStart(startNode,startOffset);rng.setEnd(endNode,endOffset);return rng;});});var generatePathRangeFromRange=function generatePathRangeFromRange(dom,root,range){var normalized=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return generatePathRange(dom,root,range.startContainer,range.startOffset,range.endContainer,range.endOffset,normalized);};var cleanEmptyNodes=(dom,node,isRoot)=>{if(node&&dom.isEmpty(node)&&!isRoot(node)){var _parent10=node.parentNode;dom.remove(node,isText$a(node.firstChild)&&isWhitespaceText(node.firstChild.data));cleanEmptyNodes(dom,_parent10,isRoot);}};var deleteRng=function deleteRng(dom,rng,isRoot){var clean=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var startParent=rng.startContainer.parentNode;var endParent=rng.endContainer.parentNode;rng.deleteContents();if(clean&&!isRoot(rng.startContainer)){if(isText$a(rng.startContainer)&&rng.startContainer.data.length===0){dom.remove(rng.startContainer);}if(isText$a(rng.endContainer)&&rng.endContainer.data.length===0){dom.remove(rng.endContainer);}cleanEmptyNodes(dom,startParent,isRoot);if(startParent!==endParent){cleanEmptyNodes(dom,endParent,isRoot);}}};var getParentBlock=(editor,rng)=>Optional.from(editor.dom.getParent(rng.startContainer,editor.dom.isBlock));var resolveFromDynamicPatterns=(patternSet,block,beforeText)=>{var dynamicPatterns=patternSet.dynamicPatternsLookup({text:beforeText,block});return _objectSpread(_objectSpread({},patternSet),{},{blockPatterns:getBlockPatterns(dynamicPatterns).concat(patternSet.blockPatterns),inlinePatterns:getInlinePatterns(dynamicPatterns).concat(patternSet.inlinePatterns)});};var getBeforeText=(dom,block,node,offset)=>{var rng=dom.createRng();rng.setStart(block,0);rng.setEnd(node,offset);return rng.toString();};var startsWithSingleSpace=s=>/^\\s[^\\s]/.test(s);var stripPattern=(dom,block,pattern)=>{var firstTextNode=textAfter(block,0,block);firstTextNode.each(spot=>{var node=spot.container;scanRight(node,pattern.start.length,block).each(end=>{var rng=dom.createRng();rng.setStart(node,0);rng.setEnd(end.container,end.offset);deleteRng(dom,rng,e=>e===block);});var text=SugarElement.fromDom(node);var textContent=get$3(text);if(startsWithSingleSpace(textContent)){set(text,textContent.slice(1));}});};var applyPattern$1=(editor,match)=>{var dom=editor.dom;var pattern=match.pattern;var rng=resolvePathRange(dom.getRoot(),match.range).getOrDie('Unable to resolve path range');var isBlockFormatName=(name,formatter)=>{var formatSet=formatter.get(name);return isArray$1(formatSet)&&head(formatSet).exists(format=>has$2(format,'block'));};getParentBlock(editor,rng).each(block=>{if(pattern.type==='block-format'){if(isBlockFormatName(pattern.format,editor.formatter)){editor.undoManager.transact(()=>{stripPattern(editor.dom,block,pattern);editor.formatter.apply(pattern.format);});}}else if(pattern.type==='block-command'){editor.undoManager.transact(()=>{stripPattern(editor.dom,block,pattern);editor.execCommand(pattern.cmd,false,pattern.value);});}});return true;};var sortPatterns$1=patterns=>sort(patterns,(a,b)=>b.start.length-a.start.length);var findPattern$1=(patterns,text)=>{var sortedPatterns=sortPatterns$1(patterns);var nuText=text.replace(nbsp,' ');return find$2(sortedPatterns,pattern=>text.indexOf(pattern.start)===0||nuText.indexOf(pattern.start)===0);};var findPatterns$1=(editor,block,patternSet,normalizedMatches)=>{var _a;var dom=editor.dom;var forcedRootBlock=getForcedRootBlock(editor);if(!dom.is(block,forcedRootBlock)){return[];}var blockText=(_a=block.textContent)!==null&&_a!==void 0?_a:'';return findPattern$1(patternSet.blockPatterns,blockText).map(pattern=>{if(Tools.trim(blockText).length===pattern.start.length){return[];}return[{pattern,range:generatePathRange(dom,dom.getRoot(),block,0,block,0,normalizedMatches)}];}).getOr([]);};var applyMatches$1=(editor,matches)=>{if(matches.length===0){return;}var bookmark=editor.selection.getBookmark();each$e(matches,match=>applyPattern$1(editor,match));editor.selection.moveToBookmark(bookmark);};var newMarker=(dom,id)=>dom.create('span',{'data-mce-type':'bookmark',id});var rangeFromMarker=(dom,marker)=>{var rng=dom.createRng();rng.setStartAfter(marker.start);rng.setEndBefore(marker.end);return rng;};var createMarker=(dom,markerPrefix,pathRange)=>{var rng=resolvePathRange(dom.getRoot(),pathRange).getOrDie('Unable to resolve path range');var startNode=rng.startContainer;var endNode=rng.endContainer;var textEnd=rng.endOffset===0?endNode:endNode.splitText(rng.endOffset);var textStart=rng.startOffset===0?startNode:startNode.splitText(rng.startOffset);var startParentNode=textStart.parentNode;var endParentNode=textEnd.parentNode;return{prefix:markerPrefix,end:endParentNode.insertBefore(newMarker(dom,markerPrefix+'-end'),textEnd),start:startParentNode.insertBefore(newMarker(dom,markerPrefix+'-start'),textStart)};};var removeMarker=(dom,marker,isRoot)=>{cleanEmptyNodes(dom,dom.get(marker.prefix+'-end'),isRoot);cleanEmptyNodes(dom,dom.get(marker.prefix+'-start'),isRoot);};var isReplacementPattern=pattern=>pattern.start.length===0;var matchesPattern=patternContent=>(element,offset)=>{var text=element.data;var searchText=text.substring(0,offset);var startEndIndex=searchText.lastIndexOf(patternContent.charAt(patternContent.length-1));var startIndex=searchText.lastIndexOf(patternContent);if(startIndex!==-1){return startIndex+patternContent.length;}else if(startEndIndex!==-1){return startEndIndex+1;}else{return-1;}};var findPatternStartFromSpot=(dom,pattern,block,spot)=>{var startPattern=pattern.start;var startSpot=repeatLeft(dom,spot.container,spot.offset,matchesPattern(startPattern),block);return startSpot.bind(spot=>{var _a,_b;var startPatternIndex=(_b=(_a=block.textContent)===null||_a===void 0?void 0:_a.indexOf(startPattern))!==null&&_b!==void 0?_b:-1;var isCompleteMatch=startPatternIndex!==-1&&spot.offset>=startPatternIndex+startPattern.length;if(isCompleteMatch){var rng=dom.createRng();rng.setStart(spot.container,spot.offset-startPattern.length);rng.setEnd(spot.container,spot.offset);return Optional.some(rng);}else{var offset=spot.offset-startPattern.length;return scanLeft(spot.container,offset,block).map(nextSpot=>{var rng=dom.createRng();rng.setStart(nextSpot.container,nextSpot.offset);rng.setEnd(spot.container,spot.offset);return rng;}).filter(rng=>rng.toString()===startPattern).orThunk(()=>findPatternStartFromSpot(dom,pattern,block,point(spot.container,0)));}});};var findPatternStart=function findPatternStart(dom,pattern,node,offset,block){var requireGap=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(pattern.start.length===0&&!requireGap){var rng=dom.createRng();rng.setStart(node,offset);rng.setEnd(node,offset);return Optional.some(rng);}return textBefore(node,offset,block).bind(spot=>{var start=findPatternStartFromSpot(dom,pattern,block,spot);return start.bind(startRange=>{var _a;if(requireGap){if(startRange.endContainer===spot.container&&startRange.endOffset===spot.offset){return Optional.none();}else if(spot.offset===0&&((_a=startRange.endContainer.textContent)===null||_a===void 0?void 0:_a.length)===startRange.endOffset){return Optional.none();}}return Optional.some(startRange);});});};var findPattern=(editor,block,details,normalizedMatches)=>{var dom=editor.dom;var root=dom.getRoot();var pattern=details.pattern;var endNode=details.position.container;var endOffset=details.position.offset;return scanLeft(endNode,endOffset-details.pattern.end.length,block).bind(spot=>{var endPathRng=generatePathRange(dom,root,spot.container,spot.offset,endNode,endOffset,normalizedMatches);if(isReplacementPattern(pattern)){return Optional.some({matches:[{pattern,startRng:endPathRng,endRng:endPathRng}],position:spot});}else{var resultsOpt=findPatternsRec(editor,details.remainingPatterns,spot.container,spot.offset,block,normalizedMatches);var results=resultsOpt.getOr({matches:[],position:spot});var pos=results.position;var _start2=findPatternStart(dom,pattern,pos.container,pos.offset,block,resultsOpt.isNone());return _start2.map(startRng=>{var startPathRng=generatePathRangeFromRange(dom,root,startRng,normalizedMatches);return{matches:results.matches.concat([{pattern,startRng:startPathRng,endRng:endPathRng}]),position:point(startRng.startContainer,startRng.startOffset)};});}});};var findPatternsRec=(editor,patterns,node,offset,block,normalizedMatches)=>{var dom=editor.dom;return textBefore(node,offset,dom.getRoot()).bind(endSpot=>{var text=getBeforeText(dom,block,node,offset);for(var i=0;i<patterns.length;i++){var pattern=patterns[i];if(!endsWith(text,pattern.end)){continue;}var patternsWithoutCurrent=patterns.slice();patternsWithoutCurrent.splice(i,1);var result=findPattern(editor,block,{pattern,remainingPatterns:patternsWithoutCurrent,position:endSpot},normalizedMatches);if(result.isNone()&&offset>0){return findPatternsRec(editor,patterns,node,offset-1,block,normalizedMatches);}if(result.isSome()){return result;}}return Optional.none();});};var applyPattern=(editor,pattern,patternRange)=>{editor.selection.setRng(patternRange);if(pattern.type==='inline-format'){each$e(pattern.format,format=>{editor.formatter.apply(format);});}else{editor.execCommand(pattern.cmd,false,pattern.value);}};var applyReplacementPattern=(editor,pattern,marker,isRoot)=>{var markerRange=rangeFromMarker(editor.dom,marker);deleteRng(editor.dom,markerRange,isRoot);applyPattern(editor,pattern,markerRange);};var applyPatternWithContent=(editor,pattern,startMarker,endMarker,isRoot)=>{var dom=editor.dom;var markerEndRange=rangeFromMarker(dom,endMarker);var markerStartRange=rangeFromMarker(dom,startMarker);deleteRng(dom,markerStartRange,isRoot);deleteRng(dom,markerEndRange,isRoot);var patternMarker={prefix:startMarker.prefix,start:startMarker.end,end:endMarker.start};var patternRange=rangeFromMarker(dom,patternMarker);applyPattern(editor,pattern,patternRange);};var addMarkers=(dom,matches)=>{var markerPrefix=generate$1('mce_textpattern');var matchesWithEnds=foldr(matches,(acc,match)=>{var endMarker=createMarker(dom,markerPrefix+\"_end\".concat(acc.length),match.endRng);return acc.concat([_objectSpread(_objectSpread({},match),{},{endMarker})]);},[]);return foldr(matchesWithEnds,(acc,match)=>{var idx=matchesWithEnds.length-acc.length-1;var startMarker=isReplacementPattern(match.pattern)?match.endMarker:createMarker(dom,markerPrefix+\"_start\".concat(idx),match.startRng);return acc.concat([_objectSpread(_objectSpread({},match),{},{startMarker})]);},[]);};var sortPatterns=patterns=>sort(patterns,(a,b)=>b.end.length-a.end.length);var getBestMatches=(matches,matchesWithSortedPatterns)=>{var hasSameMatches=forall(matches,match=>exists(matchesWithSortedPatterns,sortedMatch=>match.pattern.start===sortedMatch.pattern.start&&match.pattern.end===sortedMatch.pattern.end));if(matches.length===matchesWithSortedPatterns.length){if(hasSameMatches){return matches;}else{return matchesWithSortedPatterns;}}return matches.length>matchesWithSortedPatterns.length?matches:matchesWithSortedPatterns;};var findPatterns=(editor,block,node,offset,patternSet,normalizedMatches)=>{var matches=findPatternsRec(editor,patternSet.inlinePatterns,node,offset,block,normalizedMatches).fold(()=>[],result=>result.matches);var matchesWithSortedPatterns=findPatternsRec(editor,sortPatterns(patternSet.inlinePatterns),node,offset,block,normalizedMatches).fold(()=>[],result=>result.matches);return getBestMatches(matches,matchesWithSortedPatterns);};var applyMatches=(editor,matches)=>{if(matches.length===0){return;}var dom=editor.dom;var bookmark=editor.selection.getBookmark();var matchesWithMarkers=addMarkers(dom,matches);each$e(matchesWithMarkers,match=>{var block=dom.getParent(match.startMarker.start,dom.isBlock);var isRoot=node=>node===block;if(isReplacementPattern(match.pattern)){applyReplacementPattern(editor,match.pattern,match.endMarker,isRoot);}else{applyPatternWithContent(editor,match.pattern,match.startMarker,match.endMarker,isRoot);}removeMarker(dom,match.endMarker,isRoot);removeMarker(dom,match.startMarker,isRoot);});editor.selection.moveToBookmark(bookmark);};var handleEnter=(editor,patternSet)=>{var rng=editor.selection.getRng();return getParentBlock(editor,rng).map(block=>{var _a;var offset=Math.max(0,rng.startOffset);var dynamicPatternSet=resolveFromDynamicPatterns(patternSet,block,(_a=block.textContent)!==null&&_a!==void 0?_a:'');var inlineMatches=findPatterns(editor,block,rng.startContainer,offset,dynamicPatternSet,true);var blockMatches=findPatterns$1(editor,block,dynamicPatternSet,true);if(blockMatches.length>0||inlineMatches.length>0){editor.undoManager.add();editor.undoManager.extra(()=>{editor.execCommand('mceInsertNewLine');},()=>{editor.insertContent(zeroWidth);applyMatches(editor,inlineMatches);applyMatches$1(editor,blockMatches);var range=editor.selection.getRng();var spot=textBefore(range.startContainer,range.startOffset,editor.dom.getRoot());editor.execCommand('mceInsertNewLine');spot.each(s=>{var node=s.container;if(node.data.charAt(s.offset-1)===zeroWidth){node.deleteData(s.offset-1,1);cleanEmptyNodes(editor.dom,node.parentNode,e=>e===editor.dom.getRoot());}});});return true;}return false;}).getOr(false);};var handleInlineKey=(editor,patternSet)=>{var rng=editor.selection.getRng();getParentBlock(editor,rng).map(block=>{var offset=Math.max(0,rng.startOffset-1);var beforeText=getBeforeText(editor.dom,block,rng.startContainer,offset);var dynamicPatternSet=resolveFromDynamicPatterns(patternSet,block,beforeText);var inlineMatches=findPatterns(editor,block,rng.startContainer,offset,dynamicPatternSet,false);if(inlineMatches.length>0){editor.undoManager.transact(()=>{applyMatches(editor,inlineMatches);});}});};var checkKeyEvent=(codes,event,predicate)=>{for(var i=0;i<codes.length;i++){if(predicate(codes[i],event)){return true;}}return false;};var checkKeyCode=(codes,event)=>checkKeyEvent(codes,event,(code,event)=>{return code===event.keyCode&&!VK.modifierPressed(event);});var checkCharCode=(chars,event)=>checkKeyEvent(chars,event,(chr,event)=>{return chr.charCodeAt(0)===event.charCode;});var setup$2=editor=>{var charCodes=[',','.',';',':','!','?'];var keyCodes=[32];var getPatternSet=()=>createPatternSet(getTextPatterns(editor),getTextPatternsLookup(editor));var hasDynamicPatterns=()=>hasTextPatternsLookup(editor);editor.on('keydown',e=>{if(e.keyCode===13&&!VK.modifierPressed(e)&&editor.selection.isCollapsed()){var patternSet=getPatternSet();var hasPatterns=patternSet.inlinePatterns.length>0||patternSet.blockPatterns.length>0||hasDynamicPatterns();if(hasPatterns&&handleEnter(editor,patternSet)){e.preventDefault();}}},true);var handleInlineTrigger=()=>{if(editor.selection.isCollapsed()){var patternSet=getPatternSet();var hasPatterns=patternSet.inlinePatterns.length>0||hasDynamicPatterns();if(hasPatterns){handleInlineKey(editor,patternSet);}}};editor.on('keyup',e=>{if(checkKeyCode(keyCodes,e)){handleInlineTrigger();}});editor.on('keypress',e=>{if(checkCharCode(charCodes,e)){Delay.setEditorTimeout(editor,handleInlineTrigger);}});};var setup$1=editor=>{setup$2(editor);};var Quirks=editor=>{var each=Tools.each;var BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser;var browser=Env.browser;var isGecko=browser.isFirefox();var isWebKit=browser.isChromium()||browser.isSafari();var isiOS=Env.deviceType.isiPhone()||Env.deviceType.isiPad();var isMac=Env.os.isMacOS()||Env.os.isiOS();var setEditorCommandState=(cmd,state)=>{try{editor.getDoc().execCommand(cmd,false,String(state));}catch(ex){}};var isDefaultPrevented=e=>{return e.isDefaultPrevented();};var emptyEditorWhenDeleting=()=>{var serializeRng=rng=>{var body=dom.create('body');var contents=rng.cloneContents();body.appendChild(contents);return selection.serializer.serialize(body,{format:'html'});};var allContentsSelected=rng=>{var selection=serializeRng(rng);var allRng=dom.createRng();allRng.selectNode(editor.getBody());var allSelection=serializeRng(allRng);return selection===allSelection;};var hasPreservedEmptyElements=elm=>{var scope=SugarElement.fromDom(elm);var isEditableHost=elm=>parentElement(elm).exists(elm=>!isEditable$3(elm));return exists(descendants(scope,'[contenteditable=\"true\"]'),isEditableHost);};editor.on('keydown',e=>{var keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)&&editor.selection.isEditable()){var isCollapsed=editor.selection.isCollapsed();var body=editor.getBody();if(isCollapsed&&(!dom.isEmpty(body)||hasPreservedEmptyElements(body))){return;}if(!isCollapsed&&!allContentsSelected(editor.selection.getRng())){return;}e.preventDefault();editor.setContent('');if(body.firstChild&&dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0);}else{editor.selection.setCursorLocation(body,0);}editor.nodeChanged();}});};var selectAll=()=>{editor.shortcuts.add('meta+a',null,'SelectAll');};var documentElementEditingFocus=()=>{if(!editor.inline){dom.bind(editor.getDoc(),'mousedown mouseup',e=>{var rng;if(e.target===editor.getDoc().documentElement){rng=selection.getRng();editor.getBody().focus();if(e.type==='mousedown'){if(isCaretContainer$2(rng.startContainer)){return;}selection.placeCaretAt(e.clientX,e.clientY);}else{selection.setRng(rng);}}});}};var removeHrOnBackspace=()=>{editor.on('keydown',e=>{if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName('hr').length){return;}if(selection.isCollapsed()&&selection.getRng().startOffset===0){var node=selection.getNode();var previousSibling=node.previousSibling;if(node.nodeName==='HR'){dom.remove(node);e.preventDefault();return;}if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==='hr'){dom.remove(previousSibling);e.preventDefault();}}}});};var focusBody=()=>{if(!Range.prototype.getClientRects){editor.on('mousedown',e=>{if(!isDefaultPrevented(e)&&e.target.nodeName==='HTML'){var body=editor.getBody();body.blur();Delay.setEditorTimeout(editor,()=>{body.focus();});}});}};var selectControlElements=()=>{var visualAidsAnchorClass=getVisualAidsAnchorClass(editor);editor.on('click',e=>{var target=e.target;if(/^(IMG|HR)$/.test(target.nodeName)&&dom.isEditable(target.parentNode)){e.preventDefault();editor.selection.select(target);editor.nodeChanged();}if(target.nodeName==='A'&&dom.hasClass(target,visualAidsAnchorClass)&&target.childNodes.length===0&&dom.isEditable(target.parentNode)){e.preventDefault();selection.select(target);}});};var removeStylesWhenDeletingAcrossBlockElements=()=>{var getAttributeApplyFunction=()=>{var template=dom.getAttribs(selection.getStart().cloneNode(false));return()=>{var target=selection.getStart();if(target!==editor.getBody()){dom.setAttrib(target,'style',null);each(template,attr=>{target.setAttributeNode(attr.cloneNode(true));});}};};var isSelectionAcrossElements=()=>{return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock);};editor.on('keypress',e=>{var applyAttributes;if(!isDefaultPrevented(e)&&(e.keyCode===8||e.keyCode===46)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();editor.getDoc().execCommand('delete',false);applyAttributes();e.preventDefault();return false;}else{return true;}});dom.bind(editor.getDoc(),'cut',e=>{if(!isDefaultPrevented(e)&&isSelectionAcrossElements()){var _applyAttributes=getAttributeApplyFunction();Delay.setEditorTimeout(editor,()=>{_applyAttributes();});}});};var disableBackspaceIntoATable=()=>{editor.on('keydown',e=>{if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(selection.isCollapsed()&&selection.getRng().startOffset===0){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==='table'){e.preventDefault();return false;}}}return true;});};var removeBlockQuoteOnBackSpace=()=>{editor.on('keydown',e=>{if(isDefaultPrevented(e)||e.keyCode!==VK.BACKSPACE){return;}var rng=selection.getRng();var container=rng.startContainer;var offset=rng.startOffset;var root=dom.getRoot();var parent=container;if(!rng.collapsed||offset!==0){return;}while(parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root){parent=parent.parentNode;}if(parent.nodeName==='BLOCKQUOTE'){editor.formatter.toggle('blockquote',undefined,parent);rng=dom.createRng();rng.setStart(container,0);rng.setEnd(container,0);selection.setRng(rng);}});};var setGeckoEditingOptions=()=>{var setOpts=()=>{setEditorCommandState('StyleWithCSS',false);setEditorCommandState('enableInlineTableEditing',false);if(!getObjectResizing(editor)){setEditorCommandState('enableObjectResizing',false);}};if(!isReadOnly$1(editor)){editor.on('BeforeExecCommand mousedown',setOpts);}};var addBrAfterLastLinks=()=>{var fixLinks=()=>{each(dom.select('a:not([data-mce-block])'),node=>{var _a;var parentNode=node.parentNode;var root=dom.getRoot();if((parentNode===null||parentNode===void 0?void 0:parentNode.lastChild)===node){while(parentNode&&!dom.isBlock(parentNode)){if(((_a=parentNode.parentNode)===null||_a===void 0?void 0:_a.lastChild)!==parentNode||parentNode===root){return;}parentNode=parentNode.parentNode;}dom.add(parentNode,'br',{'data-mce-bogus':1});}});};editor.on('SetContent ExecCommand',e=>{if(e.type==='setcontent'||e.command==='mceInsertLink'){fixLinks();}});};var setDefaultBlockType=()=>{editor.on('init',()=>{setEditorCommandState('DefaultParagraphSeparator',getForcedRootBlock(editor));});};var isAllContentSelected=editor=>{var body=editor.getBody();var rng=editor.selection.getRng();return rng.startContainer===rng.endContainer&&rng.startContainer===body&&rng.startOffset===0&&rng.endOffset===body.childNodes.length;};var normalizeSelection=()=>{editor.on('keyup focusin mouseup',e=>{if(!VK.modifierPressed(e)&&!isAllContentSelected(editor)){selection.normalize();}},true);};var showBrokenImageIcon=()=>{editor.contentStyles.push('img:-moz-broken {'+'-moz-force-broken-image-icon:1;'+'min-width:24px;'+'min-height:24px'+'}');};var restoreFocusOnKeyDown=()=>{if(!editor.inline){editor.on('keydown',()=>{if(document.activeElement===document.body){editor.getWin().focus();}});}};var bodyHeight=()=>{if(!editor.inline){editor.contentStyles.push('body {min-height: 150px}');editor.on('click',e=>{var rng;if(e.target.nodeName==='HTML'){rng=editor.selection.getRng();editor.getBody().focus();editor.selection.setRng(rng);editor.selection.normalize();editor.nodeChanged();}});}};var blockCmdArrowNavigation=()=>{if(isMac){editor.on('keydown',e=>{if(VK.metaKeyPressed(e)&&!e.shiftKey&&(e.keyCode===37||e.keyCode===39)){e.preventDefault();var _selection=editor.selection.getSel();_selection.modify('move',e.keyCode===37?'backward':'forward','lineboundary');}});}};var tapLinksAndImages=()=>{editor.on('click',e=>{var elm=e.target;do{if(elm.tagName==='A'){e.preventDefault();return;}}while(elm=elm.parentNode);});editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');};var blockFormSubmitInsideEditor=()=>{editor.on('init',()=>{editor.dom.bind(editor.getBody(),'submit',e=>{e.preventDefault();});});};var removeAppleInterchangeBrs=()=>{parser.addNodeFilter('br',nodes=>{var i=nodes.length;while(i--){if(nodes[i].attr('class')==='Apple-interchange-newline'){nodes[i].remove();}}});};var refreshContentEditable=noop;var isHidden=()=>{if(!isGecko||editor.removed){return false;}var sel=editor.selection.getSel();return!sel||!sel.rangeCount||sel.rangeCount===0;};var setupRtc=()=>{if(isWebKit){documentElementEditingFocus();selectControlElements();blockFormSubmitInsideEditor();selectAll();if(isiOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}}if(isGecko){focusBody();setGeckoEditingOptions();showBrokenImageIcon();blockCmdArrowNavigation();}};var dropDragEndEvent=()=>{editor.on('drop',event=>{var _a;var data=(_a=event.dataTransfer)===null||_a===void 0?void 0:_a.getData('text/html');if(isString(data)&&/^<img[^>]*>$/.test(data)){editor.dispatch('dragend',new window.DragEvent('dragend',event));}});};var setup=()=>{removeBlockQuoteOnBackSpace();emptyEditorWhenDeleting();if(!Env.windowsPhone){normalizeSelection();}if(isWebKit){documentElementEditingFocus();selectControlElements();setDefaultBlockType();blockFormSubmitInsideEditor();disableBackspaceIntoATable();removeAppleInterchangeBrs();if(isiOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages();}else{selectAll();}}if(isGecko){removeHrOnBackspace();focusBody();removeStylesWhenDeletingAcrossBlockElements();setGeckoEditingOptions();addBrAfterLastLinks();showBrokenImageIcon();blockCmdArrowNavigation();disableBackspaceIntoATable();dropDragEndEvent();}};if(isRtc(editor)){setupRtc();}else{setup();}return{refreshContentEditable,isHidden};};var DOM$6=DOMUtils.DOM;var appendStyle=(editor,text)=>{var body=SugarElement.fromDom(editor.getBody());var container=getStyleContainer(getRootNode(body));var style=SugarElement.fromTag('style');set$3(style,'type','text/css');append$1(style,SugarElement.fromText(text));append$1(container,style);editor.on('remove',()=>{remove$5(style);});};var getRootName=editor=>editor.inline?editor.getElement().nodeName.toLowerCase():undefined;var removeUndefined=obj=>filter$4(obj,v=>isUndefined(v)===false);var mkParserSettings=editor=>{var getOption=editor.options.get;var blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:getOption('allow_conditional_comments'),allow_html_data_urls:getOption('allow_html_data_urls'),allow_svg_data_urls:getOption('allow_svg_data_urls'),allow_html_in_named_anchor:getOption('allow_html_in_named_anchor'),allow_script_urls:getOption('allow_script_urls'),allow_unsafe_link_target:getOption('allow_unsafe_link_target'),convert_fonts_to_spans:getOption('convert_fonts_to_spans'),fix_list_elements:getOption('fix_list_elements'),font_size_legacy_values:getOption('font_size_legacy_values'),forced_root_block:getOption('forced_root_block'),forced_root_block_attrs:getOption('forced_root_block_attrs'),preserve_cdata:getOption('preserve_cdata'),inline_styles:getOption('inline_styles'),root_name:getRootName(editor),sanitize:getOption('xss_sanitization'),validate:true,blob_cache:blobCache,document:editor.getDoc()});};var mkSchemaSettings=editor=>{var getOption=editor.options.get;return removeUndefined({custom_elements:getOption('custom_elements'),extended_valid_elements:getOption('extended_valid_elements'),invalid_elements:getOption('invalid_elements'),invalid_styles:getOption('invalid_styles'),schema:getOption('schema'),valid_children:getOption('valid_children'),valid_classes:getOption('valid_classes'),valid_elements:getOption('valid_elements'),valid_styles:getOption('valid_styles'),verify_html:getOption('verify_html'),padd_empty_block_inline_children:getOption('format_empty_lines')});};var mkSerializerSettings=editor=>{var getOption=editor.options.get;return _objectSpread(_objectSpread(_objectSpread({},mkParserSettings(editor)),mkSchemaSettings(editor)),removeUndefined({remove_trailing_brs:getOption('remove_trailing_brs'),pad_empty_with_br:getOption('pad_empty_with_br'),url_converter:getOption('url_converter'),url_converter_scope:getOption('url_converter_scope'),element_format:getOption('element_format'),entities:getOption('entities'),entity_encoding:getOption('entity_encoding'),indent:getOption('indent'),indent_after:getOption('indent_after'),indent_before:getOption('indent_before')}));};var createParser=editor=>{var parser=DomParser(mkParserSettings(editor),editor.schema);parser.addAttributeFilter('src,href,style,tabindex',(nodes,name)=>{var dom=editor.dom;var internalName='data-mce-'+name;var i=nodes.length;while(i--){var node=nodes[i];var _value17=node.attr(name);if(_value17&&!node.attr(internalName)){if(_value17.indexOf('data:')===0||_value17.indexOf('blob:')===0){continue;}if(name==='style'){_value17=dom.serializeStyle(dom.parseStyle(_value17),node.name);if(!_value17.length){_value17=null;}node.attr(internalName,_value17);node.attr(name,_value17);}else if(name==='tabindex'){node.attr(internalName,_value17);node.attr(name,null);}else{node.attr(internalName,editor.convertURL(_value17,name,node.name));}}}});parser.addNodeFilter('script',nodes=>{var i=nodes.length;while(i--){var node=nodes[i];var _type2=node.attr('type')||'no/type';if(_type2.indexOf('mce-')!==0){node.attr('type','mce-'+_type2);}}});if(shouldPreserveCData(editor)){parser.addNodeFilter('#cdata',nodes=>{var _a;var i=nodes.length;while(i--){var node=nodes[i];node.type=8;node.name='#comment';node.value='[CDATA['+editor.dom.encode((_a=node.value)!==null&&_a!==void 0?_a:'')+']]';}});}parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div',nodes=>{var i=nodes.length;var nonEmptyElements=editor.schema.getNonEmptyElements();while(i--){var node=nodes[i];if(node.isEmpty(nonEmptyElements)&&node.getAll('br').length===0){node.append(new AstNode('br',1));}}});return parser;};var autoFocus=editor=>{var autoFocus=getAutoFocus(editor);if(autoFocus){Delay.setEditorTimeout(editor,()=>{var focusEditor;if(autoFocus===true){focusEditor=editor;}else{focusEditor=editor.editorManager.get(autoFocus);}if(focusEditor&&!focusEditor.destroyed){focusEditor.focus();focusEditor.selection.scrollIntoView();}},100);}};var moveSelectionToFirstCaretPosition=editor=>{var root=editor.dom.getRoot();if(!editor.inline&&(!hasAnyRanges(editor)||editor.selection.getStart(true)===root)){firstPositionIn(root).each(pos=>{var node=pos.getNode();var caretPos=isTable$2(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange());});}};var initEditor=editor=>{editor.bindPendingEventDelegates();editor.initialized=true;fireInit(editor);editor.focus(true);moveSelectionToFirstCaretPosition(editor);editor.nodeChanged({initial:true});var initInstanceCallback=getInitInstanceCallback(editor);if(isFunction(initInstanceCallback)){initInstanceCallback.call(editor,editor);}autoFocus(editor);};var getStyleSheetLoader$1=editor=>editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader;var makeStylesheetLoadingPromises=(editor,css,framedFonts)=>{var promises=[getStyleSheetLoader$1(editor).loadAll(css)];if(editor.inline){return promises;}else{return promises.concat([editor.ui.styleSheetLoader.loadAll(framedFonts)]);}};var loadContentCss=editor=>{var styleSheetLoader=getStyleSheetLoader$1(editor);var fontCss=getFontCss(editor);var css=editor.contentCSS;var removeCss=()=>{styleSheetLoader.unloadAll(css);if(!editor.inline){editor.ui.styleSheetLoader.unloadAll(fontCss);}};var loaded=()=>{if(editor.removed){removeCss();}else{editor.on('remove',removeCss);}};if(editor.contentStyles.length>0){var contentCssText='';Tools.each(editor.contentStyles,style=>{contentCssText+=style+'\\r\\n';});editor.dom.addStyle(contentCssText);}var allStylesheets=Promise.all(makeStylesheetLoadingPromises(editor,css,fontCss)).then(loaded).catch(loaded);var contentStyle=getContentStyle(editor);if(contentStyle){appendStyle(editor,contentStyle);}return allStylesheets;};var preInit=editor=>{var doc=editor.getDoc(),body=editor.getBody();firePreInit(editor);if(!shouldBrowserSpellcheck(editor)){doc.body.spellcheck=false;DOM$6.setAttrib(body,'spellcheck','false');}editor.quirks=Quirks(editor);firePostRender(editor);var directionality=getDirectionality(editor);if(directionality!==undefined){body.dir=directionality;}var protect=getProtect(editor);if(protect){editor.on('BeforeSetContent',e=>{Tools.each(protect,pattern=>{e.content=e.content.replace(pattern,str=>{return'<!--mce:protected '+escape(str)+'-->';});});});}editor.on('SetContent',()=>{editor.addVisual(editor.getBody());});editor.on('compositionstart compositionend',e=>{editor.composing=e.type==='compositionstart';});};var loadInitialContent=editor=>{if(!isRtc(editor)){editor.load({initial:true,format:'html'});}editor.startContent=editor.getContent({format:'raw'});};var initEditorWithInitialContent=editor=>{if(editor.removed!==true){loadInitialContent(editor);initEditor(editor);}};var startProgress=editor=>{var canceled=false;var progressTimeout=setTimeout(()=>{if(!canceled){editor.setProgressState(true);}},500);return()=>{clearTimeout(progressTimeout);canceled=true;editor.setProgressState(false);};};var contentBodyLoaded=editor=>{var targetElm=editor.getElement();var doc=editor.getDoc();if(editor.inline){DOM$6.addClass(targetElm,'mce-content-body');editor.contentDocument=doc=document;editor.contentWindow=window;editor.bodyElement=targetElm;editor.contentAreaContainer=targetElm;}var body=editor.getBody();body.disabled=true;editor.readonly=isReadOnly$1(editor);editor._editableRoot=hasEditableRoot$1(editor);if(!editor.readonly&&editor.hasEditableRoot()){if(editor.inline&&DOM$6.getStyle(body,'position',true)==='static'){body.style.position='relative';}body.contentEditable='true';}body.disabled=false;editor.editorUpload=EditorUpload(editor);editor.schema=Schema(mkSchemaSettings(editor));editor.dom=DOMUtils(doc,{keep_values:true,url_converter:editor.convertURL,url_converter_scope:editor,update_styles:true,root_element:editor.inline?editor.getBody():null,collect:editor.inline,schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:e=>{editor.dispatch('SetAttrib',e);}});editor.parser=createParser(editor);editor.serializer=DomSerializer(mkSerializerSettings(editor),editor);editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor);editor.annotator=Annotator(editor);editor.formatter=Formatter(editor);editor.undoManager=UndoManager(editor);editor._nodeChangeDispatcher=new NodeChange(editor);editor._selectionOverrides=SelectionOverrides(editor);setup$o(editor);setup$6(editor);setup$m(editor);if(!isRtc(editor)){setup$5(editor);setup$1(editor);}var caret=setup$b(editor);setup$p(editor,caret);setup$n(editor);setup$q(editor);setup$7(editor);var setupRtcThunk=setup$s(editor);preInit(editor);setupRtcThunk.fold(()=>{var cancelProgress=startProgress(editor);loadContentCss(editor).then(()=>{initEditorWithInitialContent(editor);cancelProgress();});},setupRtc=>{editor.setProgressState(true);loadContentCss(editor).then(()=>{setupRtc().then(_rtcMode=>{editor.setProgressState(false);initEditorWithInitialContent(editor);bindEvents(editor);},err=>{editor.notificationManager.open({type:'error',text:String(err)});initEditorWithInitialContent(editor);bindEvents(editor);});});});};var filter=always;var bind=(element,event,handler)=>bind$2(element,event,filter,handler);var DOM$5=DOMUtils.DOM;var createIframeElement=(id,title,customAttrs,tabindex)=>{var iframe=SugarElement.fromTag('iframe');tabindex.each(t=>set$3(iframe,'tabindex',t));setAll$1(iframe,customAttrs);setAll$1(iframe,{id:id+'_ifr',frameBorder:'0',allowTransparency:'true',title});add$2(iframe,'tox-edit-area__iframe');return iframe;};var getIframeHtml=editor=>{var iframeHTML=getDocType(editor)+'<html><head>';if(getDocumentBaseUrl(editor)!==editor.documentBaseUrl){iframeHTML+='<base href=\"'+editor.documentBaseURI.getURI()+'\" />';}iframeHTML+='<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';var bodyId=getBodyId(editor);var bodyClass=getBodyClass(editor);var translatedAriaText=editor.translate(getIframeAriaText(editor));if(getContentSecurityPolicy(editor)){iframeHTML+='<meta http-equiv=\"Content-Security-Policy\" content=\"'+getContentSecurityPolicy(editor)+'\" />';}iframeHTML+='</head>'+\"<body id=\\\"\".concat(bodyId,\"\\\" class=\\\"mce-content-body \").concat(bodyClass,\"\\\" data-id=\\\"\").concat(editor.id,\"\\\" aria-label=\\\"\").concat(translatedAriaText,\"\\\">\")+'<br>'+'</body></html>';return iframeHTML;};var createIframe=(editor,boxInfo)=>{var iframeTitle=editor.translate('Rich Text Area');var tabindex=getOpt(SugarElement.fromDom(editor.getElement()),'tabindex').bind(toInt);var ifr=createIframeElement(editor.id,iframeTitle,getIframeAttrs(editor),tabindex).dom;ifr.onload=()=>{ifr.onload=null;editor.dispatch('load');};editor.contentAreaContainer=boxInfo.iframeContainer;editor.iframeElement=ifr;editor.iframeHTML=getIframeHtml(editor);DOM$5.add(boxInfo.iframeContainer,ifr);};var setupIframeBody=editor=>{var iframe=editor.iframeElement;var ready=()=>{editor.contentDocument=iframe.contentDocument;contentBodyLoaded(editor);};if(shouldUseDocumentWrite(editor)||Env.browser.isFirefox()){var doc=editor.getDoc();doc.open();doc.write(editor.iframeHTML);doc.close();ready();}else{var _binder=bind(SugarElement.fromDom(iframe),'load',()=>{_binder.unbind();ready();});iframe.srcdoc=editor.iframeHTML;}};var init$1=(editor,boxInfo)=>{createIframe(editor,boxInfo);if(boxInfo.editorContainer){boxInfo.editorContainer.style.display=editor.orgDisplay;editor.hidden=DOM$5.isHidden(boxInfo.editorContainer);}editor.getElement().style.display='none';DOM$5.setAttrib(editor.id,'aria-hidden','true');editor.getElement().style.visibility=editor.orgVisibility;setupIframeBody(editor);};var DOM$4=DOMUtils.DOM;var initPlugin=(editor,initializedPlugins,plugin)=>{var Plugin=PluginManager.get(plugin);var pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\\/$/,'');plugin=Tools.trim(plugin);if(Plugin&&Tools.inArray(initializedPlugins,plugin)===-1){if(editor.plugins[plugin]){return;}try{var pluginInstance=Plugin(editor,pluginUrl)||{};editor.plugins[plugin]=pluginInstance;if(isFunction(pluginInstance.init)){pluginInstance.init(editor,pluginUrl);initializedPlugins.push(plugin);}}catch(e){pluginInitError(editor,plugin,e);}}};var trimLegacyPrefix=name=>{return name.replace(/^\\-/,'');};var initPlugins=editor=>{var initializedPlugins=[];each$e(getPlugins(editor),name=>{initPlugin(editor,initializedPlugins,trimLegacyPrefix(name));});};var initIcons=editor=>{var iconPackName=Tools.trim(getIconPackName(editor));var currentIcons=editor.ui.registry.getAll().icons;var loadIcons=_objectSpread(_objectSpread({},IconManager.get('default').icons),IconManager.get(iconPackName).icons);each$d(loadIcons,(svgData,icon)=>{if(!has$2(currentIcons,icon)){editor.ui.registry.addIcon(icon,svgData);}});};var initTheme=editor=>{var theme=getTheme(editor);if(isString(theme)){var Theme=ThemeManager.get(theme);editor.theme=Theme(editor,ThemeManager.urls[theme])||{};if(isFunction(editor.theme.init)){editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\\/$/,''));}}else{editor.theme={};}};var initModel=editor=>{var model=getModel(editor);var Model=ModelManager.get(model);editor.model=Model(editor,ModelManager.urls[model]);};var renderFromLoadedTheme=editor=>{var render=editor.theme.renderUI;return render?render():renderThemeFalse(editor);};var renderFromThemeFunc=editor=>{var elm=editor.getElement();var theme=getTheme(editor);var info=theme(editor,elm);if(info.editorContainer.nodeType){info.editorContainer.id=info.editorContainer.id||editor.id+'_parent';}if(info.iframeContainer&&info.iframeContainer.nodeType){info.iframeContainer.id=info.iframeContainer.id||editor.id+'_iframecontainer';}info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight;return info;};var createThemeFalseResult=(element,iframe)=>{return{editorContainer:element,iframeContainer:iframe,api:{}};};var renderThemeFalseIframe=targetElement=>{var iframeContainer=DOM$4.create('div');DOM$4.insertAfter(iframeContainer,targetElement);return createThemeFalseResult(iframeContainer,iframeContainer);};var renderThemeFalse=editor=>{var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):renderThemeFalseIframe(targetElement);};var renderThemeUi=editor=>{var elm=editor.getElement();editor.orgDisplay=elm.style.display;if(isString(getTheme(editor))){return renderFromLoadedTheme(editor);}else if(isFunction(getTheme(editor))){return renderFromThemeFunc(editor);}else{return renderThemeFalse(editor);}};var augmentEditorUiApi=(editor,api)=>{var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),isEnabled:Optional.from(api.isEnabled).getOr(always),setEnabled:state=>{if(!editor.mode.isReadOnly()){Optional.from(api.setEnabled).each(f=>f(state));}}};editor.ui=_objectSpread(_objectSpread({},editor.ui),uiApiFacade);};var init=/*#__PURE__*/function(){var _ref19=_asyncToGenerator(function*(editor){editor.dispatch('ScriptsLoaded');initIcons(editor);initTheme(editor);initModel(editor);initPlugins(editor);var renderInfo=yield renderThemeUi(editor);augmentEditorUiApi(editor,Optional.from(renderInfo.api).getOr({}));editor.editorContainer=renderInfo.editorContainer;appendContentCssFromSettings(editor);if(editor.inline){contentBodyLoaded(editor);}else{init$1(editor,{editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer});}});return function init(_x){return _ref19.apply(this,arguments);};}();var DOM$3=DOMUtils.DOM;var hasSkipLoadPrefix=name=>name.charAt(0)==='-';var loadLanguage=(scriptLoader,editor)=>{var languageCode=getLanguageCode(editor);var languageUrl=getLanguageUrl(editor);if(!I18n.hasCode(languageCode)&&languageCode!=='en'){var url=isNotEmpty(languageUrl)?languageUrl:\"\".concat(editor.editorManager.baseURL,\"/langs/\").concat(languageCode,\".js\");scriptLoader.add(url).catch(()=>{languageLoadError(editor,url,languageCode);});}};var loadTheme=(editor,suffix)=>{var theme=getTheme(editor);if(isString(theme)&&!hasSkipLoadPrefix(theme)&&!has$2(ThemeManager.urls,theme)){var themeUrl=getThemeUrl(editor);var url=themeUrl?editor.documentBaseURI.toAbsolute(themeUrl):\"themes/\".concat(theme,\"/theme\").concat(suffix,\".js\");ThemeManager.load(theme,url).catch(()=>{themeLoadError(editor,url,theme);});}};var loadModel=(editor,suffix)=>{var model=getModel(editor);if(model!=='plugin'&&!has$2(ModelManager.urls,model)){var modelUrl=getModelUrl(editor);var url=isString(modelUrl)?editor.documentBaseURI.toAbsolute(modelUrl):\"models/\".concat(model,\"/model\").concat(suffix,\".js\");ModelManager.load(model,url).catch(()=>{modelLoadError(editor,url,model);});}};var getIconsUrlMetaFromUrl=editor=>Optional.from(getIconsUrl(editor)).filter(isNotEmpty).map(url=>({url,name:Optional.none()}));var getIconsUrlMetaFromName=(editor,name,suffix)=>Optional.from(name).filter(name=>isNotEmpty(name)&&!IconManager.has(name)).map(name=>({url:\"\".concat(editor.editorManager.baseURL,\"/icons/\").concat(name,\"/icons\").concat(suffix,\".js\"),name:Optional.some(name)}));var loadIcons=(scriptLoader,editor,suffix)=>{var defaultIconsUrl=getIconsUrlMetaFromName(editor,'default',suffix);var customIconsUrl=getIconsUrlMetaFromUrl(editor).orThunk(()=>getIconsUrlMetaFromName(editor,getIconPackName(editor),''));each$e(cat([defaultIconsUrl,customIconsUrl]),urlMeta=>{scriptLoader.add(urlMeta.url).catch(()=>{iconsLoadError(editor,urlMeta.url,urlMeta.name.getOrUndefined());});});};var loadPlugins=(editor,suffix)=>{var loadPlugin=(name,url)=>{PluginManager.load(name,url).catch(()=>{pluginLoadError(editor,url,name);});};each$d(getExternalPlugins$1(editor),(url,name)=>{loadPlugin(name,url);editor.options.set('plugins',getPlugins(editor).concat(name));});each$e(getPlugins(editor),plugin=>{plugin=Tools.trim(plugin);if(plugin&&!PluginManager.urls[plugin]&&!hasSkipLoadPrefix(plugin)){loadPlugin(plugin,\"plugins/\".concat(plugin,\"/plugin\").concat(suffix,\".js\"));}});};var isThemeLoaded=editor=>{var theme=getTheme(editor);return!isString(theme)||isNonNullable(ThemeManager.get(theme));};var isModelLoaded=editor=>{var model=getModel(editor);return isNonNullable(ModelManager.get(model));};var loadScripts=(editor,suffix)=>{var scriptLoader=ScriptLoader.ScriptLoader;var initEditor=()=>{if(!editor.removed&&isThemeLoaded(editor)&&isModelLoaded(editor)){init(editor);}};loadTheme(editor,suffix);loadModel(editor,suffix);loadLanguage(scriptLoader,editor);loadIcons(scriptLoader,editor,suffix);loadPlugins(editor,suffix);scriptLoader.loadQueue().then(initEditor,initEditor);};var getStyleSheetLoader=(element,editor)=>instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)});var render=editor=>{var id=editor.id;I18n.setCode(getLanguageCode(editor));var readyHandler=()=>{DOM$3.unbind(window,'ready',readyHandler);editor.render();};if(!EventUtils.Event.domLoaded){DOM$3.bind(window,'ready',readyHandler);return;}if(!editor.getElement()){return;}var element=SugarElement.fromDom(editor.getElement());var snapshot=clone$4(element);editor.on('remove',()=>{eachr(element.dom.attributes,attr=>remove$a(element,attr.name));setAll$1(element,snapshot);});editor.ui.styleSheetLoader=getStyleSheetLoader(element,editor);if(!isInline(editor)){editor.orgVisibility=editor.getElement().style.visibility;editor.getElement().style.visibility='hidden';}else{editor.inline=true;}var form=editor.getElement().form||DOM$3.getParent(id,'form');if(form){editor.formElement=form;if(hasHiddenInput(editor)&&!isTextareaOrInput(editor.getElement())){DOM$3.insertAfter(DOM$3.create('input',{type:'hidden',name:id}),id);editor.hasHiddenInput=true;}editor.formEventDelegate=e=>{editor.dispatch(e.type,e);};DOM$3.bind(form,'submit reset',editor.formEventDelegate);editor.on('reset',()=>{editor.resetContent();});if(shouldPatchSubmit(editor)&&!form.submit.nodeType&&!form.submit.length&&!form._mceOldSubmit){form._mceOldSubmit=form.submit;form.submit=()=>{editor.editorManager.triggerSave();editor.setDirty(false);return form._mceOldSubmit(form);};}}editor.windowManager=WindowManager(editor);editor.notificationManager=NotificationManager(editor);if(isEncodingXml(editor)){editor.on('GetContent',e=>{if(e.save){e.content=DOM$3.encode(e.content);}});}if(shouldAddFormSubmitTrigger(editor)){editor.on('submit',()=>{if(editor.initialized){editor.save();}});}if(shouldAddUnloadTrigger(editor)){editor._beforeUnload=()=>{if(editor.initialized&&!editor.destroyed&&!editor.isHidden()){editor.save({format:'raw',no_events:true,set_dirty:false});}};editor.editorManager.on('BeforeUnload',editor._beforeUnload);}editor.editorManager.add(editor);loadScripts(editor,editor.suffix);};var setEditableRoot=(editor,state)=>{if(editor._editableRoot!==state){editor._editableRoot=state;if(!editor.readonly){editor.getBody().contentEditable=String(editor.hasEditableRoot());editor.nodeChanged();}fireEditableRootStateChange(editor,state);}};var hasEditableRoot=editor=>editor._editableRoot;var sectionResult=(sections,settings)=>({sections:constant(sections),options:constant(settings)});var deviceDetection=detect$2().deviceType;var isPhone=deviceDetection.isPhone();var isTablet=deviceDetection.isTablet();var normalizePlugins=plugins=>{if(isNullable(plugins)){return[];}else{var pluginNames=isArray$1(plugins)?plugins:plugins.split(/[ ,]/);var trimmedPlugins=map$3(pluginNames,trim$3);return filter$5(trimmedPlugins,isNotEmpty);}};var extractSections=(keys,options)=>{var result=bifilter(options,(value,key)=>{return contains$2(keys,key);});return sectionResult(result.t,result.f);};var getSection=function getSection(sectionResult,name){var defaults=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var sections=sectionResult.sections();var sectionOptions=get$a(sections,name).getOr({});return Tools.extend({},defaults,sectionOptions);};var hasSection=(sectionResult,name)=>{return has$2(sectionResult.sections(),name);};var getSectionConfig=(sectionResult,name)=>{return hasSection(sectionResult,name)?sectionResult.sections()[name]:{};};var getMobileOverrideOptions=(mobileOptions,isPhone)=>{var defaultMobileOptions={table_grid:false,object_resizing:false,resize:false,toolbar_mode:get$a(mobileOptions,'toolbar_mode').getOr('scrolling'),toolbar_sticky:false};var defaultPhoneOptions={menubar:false};return _objectSpread(_objectSpread({},defaultMobileOptions),isPhone?defaultPhoneOptions:{});};var getExternalPlugins=(overrideOptions,options)=>{var _a;var userDefinedExternalPlugins=(_a=options.external_plugins)!==null&&_a!==void 0?_a:{};if(overrideOptions&&overrideOptions.external_plugins){return Tools.extend({},overrideOptions.external_plugins,userDefinedExternalPlugins);}else{return userDefinedExternalPlugins;}};var combinePlugins=(forcedPlugins,plugins)=>[...normalizePlugins(forcedPlugins),...normalizePlugins(plugins)];var getPlatformPlugins=(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins)=>{if(isMobileDevice&&hasSection(sectionResult,'mobile')){return mobilePlugins;}else{return desktopPlugins;}};var processPlugins=(isMobileDevice,sectionResult,defaultOverrideOptions,options)=>{var forcedPlugins=normalizePlugins(defaultOverrideOptions.forced_plugins);var desktopPlugins=normalizePlugins(options.plugins);var mobileConfig=getSectionConfig(sectionResult,'mobile');var mobilePlugins=mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins;var platformPlugins=getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins);var combinedPlugins=combinePlugins(forcedPlugins,platformPlugins);return Tools.extend(options,{forced_plugins:forcedPlugins,plugins:combinedPlugins});};var isOnMobile=(isMobileDevice,sectionResult)=>{return isMobileDevice&&hasSection(sectionResult,'mobile');};var combineOptions=(isMobileDevice,isPhone,defaultOptions,defaultOverrideOptions,options)=>{var _a;var deviceOverrideOptions=isMobileDevice?{mobile:getMobileOverrideOptions((_a=options.mobile)!==null&&_a!==void 0?_a:{},isPhone)}:{};var sectionResult=extractSections(['mobile'],deepMerge(deviceOverrideOptions,options));var extendedOptions=Tools.extend(defaultOptions,defaultOverrideOptions,sectionResult.options(),isOnMobile(isMobileDevice,sectionResult)?getSection(sectionResult,'mobile'):{},{external_plugins:getExternalPlugins(defaultOverrideOptions,sectionResult.options())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideOptions,extendedOptions);};var normalizeOptions=(defaultOverrideOptions,options)=>combineOptions(isPhone||isTablet,isPhone,options,defaultOverrideOptions,options);var addVisual=(editor,elm)=>addVisual$1(editor,elm);var registerExecCommands$3=editor=>{var toggleFormat=(name,value)=>{editor.formatter.toggle(name,value);editor.nodeChanged();};var toggleAlign=align=>()=>{each$e('left,center,right,justify'.split(','),name=>{if(align!==name){editor.formatter.remove('align'+name);}});if(align!=='none'){toggleFormat('align'+align);}};editor.editorCommands.addCommands({JustifyLeft:toggleAlign('left'),JustifyCenter:toggleAlign('center'),JustifyRight:toggleAlign('right'),JustifyFull:toggleAlign('justify'),JustifyNone:toggleAlign('none')});};var registerQueryStateCommands$1=editor=>{var alignStates=name=>()=>{var selection=editor.selection;var nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks();return exists(nodes,node=>isNonNullable(editor.formatter.matchNode(node,name)));};editor.editorCommands.addCommands({JustifyLeft:alignStates('alignleft'),JustifyCenter:alignStates('aligncenter'),JustifyRight:alignStates('alignright'),JustifyFull:alignStates('alignjustify')},'state');};var registerCommands$b=editor=>{registerExecCommands$3(editor);registerQueryStateCommands$1(editor);};var registerCommands$a=editor=>{editor.editorCommands.addCommands({'Cut,Copy,Paste':command=>{var doc=editor.getDoc();var failed;try{doc.execCommand(command);}catch(ex){failed=true;}if(command==='paste'&&!doc.queryCommandEnabled(command)){failed=true;}if(failed||!doc.queryCommandSupported(command)){var msg=editor.translate(\"Your browser doesn't support direct access to the clipboard. \"+'Please use the Ctrl+X/C/V keyboard shortcuts instead.');if(Env.os.isMacOS()||Env.os.isiOS()){msg=msg.replace(/Ctrl\\+/g,'\\u2318+');}editor.notificationManager.open({text:msg,type:'error'});}}});};var trimOrPadLeftRight=(dom,rng,html)=>{var root=SugarElement.fromDom(dom.getRoot());if(needsToBeNbspLeft(root,CaretPosition.fromRangeStart(rng))){html=html.replace(/^ /,'&nbsp;');}else{html=html.replace(/^&nbsp;/,' ');}if(needsToBeNbspRight(root,CaretPosition.fromRangeEnd(rng))){html=html.replace(/(&nbsp;| )(<br( \\/)>)?$/,'&nbsp;');}else{html=html.replace(/&nbsp;(<br( \\/)?>)?$/,' ');}return html;};var processValue$1=value=>{if(typeof value!=='string'){var details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details};}return{content:value,details:{}};};var trimOrPad=(editor,value)=>{var selection=editor.selection;var dom=editor.dom;if(/^ | $/.test(value)){return trimOrPadLeftRight(dom,selection.getRng(),value);}else{return value;}};var insertAtCaret=(editor,value)=>{if(editor.selection.isEditable()){var{content,details}=processValue$1(value);preProcessSetContent(editor,_objectSpread(_objectSpread({},details),{},{content:trimOrPad(editor,content),format:'html',set:false,selection:true})).each(args=>{var insertedContent=insertContent$1(editor,args.content,details);postProcessSetContent(editor,insertedContent,args);editor.addVisual();});}};var registerCommands$9=editor=>{editor.editorCommands.addCommands({mceCleanup:()=>{var bm=editor.selection.getBookmark();editor.setContent(editor.getContent());editor.selection.moveToBookmark(bm);},insertImage:(_command,_ui,value)=>{insertAtCaret(editor,editor.dom.createHTML('img',{src:value}));},insertHorizontalRule:()=>{editor.execCommand('mceInsertContent',false,'<hr>');},insertText:(_command,_ui,value)=>{insertAtCaret(editor,editor.dom.encode(value));},insertHTML:(_command,_ui,value)=>{insertAtCaret(editor,value);},mceInsertContent:(_command,_ui,value)=>{insertAtCaret(editor,value);},mceSetContent:(_command,_ui,value)=>{editor.setContent(value);},mceReplaceContent:(_command,_ui,value)=>{editor.execCommand('mceInsertContent',false,value.replace(/\\{\\$selection\\}/g,editor.selection.getContent({format:'text'})));},mceNewDocument:()=>{editor.setContent(getNewDocumentContent(editor));}});};var legacyPropNames={'font-size':'size','font-family':'face'};var isFont=isTag('font');var getSpecifiedFontProp=(propName,rootElm,elm)=>{var getProperty=elm=>getRaw(elm,propName).orThunk(()=>{if(isFont(elm)){return get$a(legacyPropNames,propName).bind(legacyPropName=>getOpt(elm,legacyPropName));}else{return Optional.none();}});var isRoot=elm=>eq(SugarElement.fromDom(rootElm),elm);return closest$1(SugarElement.fromDom(elm),elm=>getProperty(elm),isRoot);};var normalizeFontFamily=fontFamily=>fontFamily.replace(/[\\'\\\"\\\\]/g,'').replace(/,\\s+/g,',');var getComputedFontProp=(propName,elm)=>Optional.from(DOMUtils.DOM.getStyle(elm,propName,true));var getFontProp=propName=>(rootElm,elm)=>Optional.from(elm).map(SugarElement.fromDom).filter(isElement$7).bind(element=>getSpecifiedFontProp(propName,rootElm,element.dom).or(getComputedFontProp(propName,element.dom))).getOr('');var getFontSize=getFontProp('font-size');var getFontFamily=compose(normalizeFontFamily,getFontProp('font-family'));var findFirstCaretElement=editor=>firstPositionIn(editor.getBody()).bind(caret=>{var container=caret.container();return Optional.from(isText$a(container)?container.parentNode:container);});var getCaretElement=editor=>Optional.from(editor.selection.getRng()).bind(rng=>{var root=editor.getBody();var atStartOfNode=rng.startContainer===root&&rng.startOffset===0;return atStartOfNode?Optional.none():Optional.from(editor.selection.getStart(true));});var bindRange=(editor,binder)=>getCaretElement(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$7).bind(binder);var mapRange=(editor,mapper)=>bindRange(editor,compose1(Optional.some,mapper));var fromFontSizeNumber=(editor,value)=>{if(/^[0-9.]+$/.test(value)){var fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){var fontSizes=getFontStyleValues(editor);var fontClasses=getFontSizeClasses(editor);if(fontClasses.length>0){return fontClasses[fontSizeNumber-1]||value;}else{return fontSizes[fontSizeNumber-1]||value;}}else{return value;}}else{return value;}};var normalizeFontNames=font=>{var fonts=font.split(/\\s*,\\s*/);return map$3(fonts,font=>{if(font.indexOf(' ')!==-1&&!(startsWith(font,'\"')||startsWith(font,\"'\"))){return\"'\".concat(font,\"'\");}else{return font;}}).join(',');};var fontNameAction=(editor,value)=>{var font=fromFontSizeNumber(editor,value);editor.formatter.toggle('fontname',{value:normalizeFontNames(font)});editor.nodeChanged();};var fontNameQuery=editor=>mapRange(editor,elm=>getFontFamily(editor.getBody(),elm.dom)).getOr('');var fontSizeAction=(editor,value)=>{editor.formatter.toggle('fontsize',{value:fromFontSizeNumber(editor,value)});editor.nodeChanged();};var fontSizeQuery=editor=>mapRange(editor,elm=>getFontSize(editor.getBody(),elm.dom)).getOr('');var lineHeightQuery=editor=>mapRange(editor,elm=>{var root=SugarElement.fromDom(editor.getBody());var specifiedStyle=closest$1(elm,elm=>getRaw(elm,'line-height'),curry(eq,root));var computedStyle=()=>{var lineHeight=parseFloat(get$7(elm,'line-height'));var fontSize=parseFloat(get$7(elm,'font-size'));return String(lineHeight/fontSize);};return specifiedStyle.getOrThunk(computedStyle);}).getOr('');var lineHeightAction=(editor,lineHeight)=>{editor.formatter.toggle('lineheight',{value:String(lineHeight)});editor.nodeChanged();};var registerExecCommands$2=editor=>{var toggleFormat=(name,value)=>{editor.formatter.toggle(name,value);editor.nodeChanged();};editor.editorCommands.addCommands({'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':command=>{toggleFormat(command);},'ForeColor,HiliteColor':(command,_ui,value)=>{toggleFormat(command,{value});},'BackColor':(_command,_ui,value)=>{toggleFormat('hilitecolor',{value});},'FontName':(_command,_ui,value)=>{fontNameAction(editor,value);},'FontSize':(_command,_ui,value)=>{fontSizeAction(editor,value);},'LineHeight':(_command,_ui,value)=>{lineHeightAction(editor,value);},'Lang':(command,_ui,lang)=>{var _a;toggleFormat(command,{value:lang.code,customValue:(_a=lang.customCode)!==null&&_a!==void 0?_a:null});},'RemoveFormat':command=>{editor.formatter.remove(command);},'mceBlockQuote':()=>{toggleFormat('blockquote');},'FormatBlock':(_command,_ui,value)=>{toggleFormat(isString(value)?value:'p');},'mceToggleFormat':(_command,_ui,value)=>{toggleFormat(value);}});};var registerQueryValueCommands=editor=>{var isFormatMatch=name=>editor.formatter.match(name);editor.editorCommands.addCommands({'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':command=>isFormatMatch(command),'mceBlockQuote':()=>isFormatMatch('blockquote')},'state');editor.editorCommands.addQueryValueHandler('FontName',()=>fontNameQuery(editor));editor.editorCommands.addQueryValueHandler('FontSize',()=>fontSizeQuery(editor));editor.editorCommands.addQueryValueHandler('LineHeight',()=>lineHeightQuery(editor));};var registerCommands$8=editor=>{registerExecCommands$2(editor);registerQueryValueCommands(editor);};var registerCommands$7=editor=>{editor.editorCommands.addCommands({mceAddUndoLevel:()=>{editor.undoManager.add();},mceEndUndoLevel:()=>{editor.undoManager.add();},Undo:()=>{editor.undoManager.undo();},Redo:()=>{editor.undoManager.redo();}});};var registerCommands$6=editor=>{editor.editorCommands.addCommands({Indent:()=>{indent(editor);},Outdent:()=>{outdent(editor);}});editor.editorCommands.addCommands({Outdent:()=>canOutdent(editor)},'state');};var registerCommands$5=editor=>{var applyLinkToSelection=(_command,_ui,value)=>{var linkDetails=isString(value)?{href:value}:value;var anchor=editor.dom.getParent(editor.selection.getNode(),'a');if(isObject(linkDetails)&&isString(linkDetails.href)){linkDetails.href=linkDetails.href.replace(/ /g,'%20');if(!anchor||!linkDetails.href){editor.formatter.remove('link');}if(linkDetails.href){editor.formatter.apply('link',linkDetails,anchor);}}};editor.editorCommands.addCommands({unlink:()=>{if(editor.selection.isEditable()){if(editor.selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),'a');if(elm){editor.dom.remove(elm,true);}return;}editor.formatter.remove('link');}},mceInsertLink:applyLinkToSelection,createLink:applyLinkToSelection});};var registerExecCommands$1=editor=>{editor.editorCommands.addCommands({'InsertUnorderedList,InsertOrderedList':command=>{editor.getDoc().execCommand(command);var listElm=editor.dom.getParent(editor.selection.getNode(),'ol,ul');if(listElm){var listParent=listElm.parentNode;if(listParent&&/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){var bm=editor.selection.getBookmark();editor.dom.split(listParent,listElm);editor.selection.moveToBookmark(bm);}}}});};var registerQueryStateCommands=editor=>{editor.editorCommands.addCommands({'InsertUnorderedList,InsertOrderedList':command=>{var list=editor.dom.getParent(editor.selection.getNode(),'ul,ol');return list&&(command==='insertunorderedlist'&&list.tagName==='UL'||command==='insertorderedlist'&&list.tagName==='OL');}},'state');};var registerCommands$4=editor=>{registerExecCommands$1(editor);registerQueryStateCommands(editor);};var getTopParentBlock=(editor,node,root,container)=>{var dom=editor.dom;var selector=node=>dom.isBlock(node)&&node.parentElement===root;var topParentBlock=selector(node)?node:dom.getParent(container,selector,root);return Optional.from(topParentBlock).map(SugarElement.fromDom);};var insert=(editor,before)=>{var dom=editor.dom;var rng=editor.selection.getRng();var node=before?editor.selection.getStart():editor.selection.getEnd();var container=before?rng.startContainer:rng.endContainer;var root=getEditableRoot(dom,container);if(!root||!root.isContentEditable){return;}var insertFn=before?before$3:after$4;var newBlockName=getForcedRootBlock(editor);getTopParentBlock(editor,node,root,container).each(parentBlock=>{var newBlock=createNewBlock(editor,container,parentBlock.dom,root,false,newBlockName);insertFn(parentBlock,SugarElement.fromDom(newBlock));editor.selection.setCursorLocation(newBlock,0);editor.dispatch('NewBlock',{newBlock});fireInputEvent(editor,'insertParagraph');});};var insertBefore=editor=>insert(editor,true);var insertAfter=editor=>insert(editor,false);var registerCommands$3=editor=>{editor.editorCommands.addCommands({InsertNewBlockBefore:()=>{insertBefore(editor);},InsertNewBlockAfter:()=>{insertAfter(editor);}});};var registerCommands$2=editor=>{editor.editorCommands.addCommands({insertParagraph:()=>{insertBreak(blockbreak,editor);},mceInsertNewLine:(_command,_ui,value)=>{insert$1(editor,value);},InsertLineBreak:(_command,_ui,_value)=>{insertBreak(linebreak,editor);}});};var registerCommands$1=editor=>{editor.editorCommands.addCommands({mceSelectNodeDepth:(_command,_ui,value)=>{var counter=0;editor.dom.getParent(editor.selection.getNode(),node=>{if(isElement$6(node)&&counter++===value){editor.selection.select(node);return false;}else{return true;}},editor.getBody());},mceSelectNode:(_command,_ui,value)=>{editor.selection.select(value);},selectAll:()=>{var editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$3);if(editingHost){var rng=editor.dom.createRng();rng.selectNodeContents(editingHost);editor.selection.setRng(rng);}}});};var registerExecCommands=editor=>{editor.editorCommands.addCommands({mceRemoveNode:(_command,_ui,value)=>{var node=value!==null&&value!==void 0?value:editor.selection.getNode();if(node!==editor.getBody()){var bm=editor.selection.getBookmark();editor.dom.remove(node,true);editor.selection.moveToBookmark(bm);}},mcePrint:()=>{editor.getWin().print();},mceFocus:(_command,_ui,value)=>{focus(editor,value===true);},mceToggleVisualAid:()=>{editor.hasVisual=!editor.hasVisual;editor.addVisual();}});};var registerCommands=editor=>{registerCommands$b(editor);registerCommands$a(editor);registerCommands$7(editor);registerCommands$1(editor);registerCommands$9(editor);registerCommands$5(editor);registerCommands$6(editor);registerCommands$3(editor);registerCommands$2(editor);registerCommands$4(editor);registerCommands$8(editor);registerExecCommands(editor);};var selectionSafeCommands=['toggleview'];var isSelectionSafeCommand=command=>contains$2(selectionSafeCommands,command.toLowerCase());class EditorCommands{constructor(editor){this.commands={state:{},exec:{},value:{}};this.editor=editor;}execCommand(command){var ui=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var value=arguments.length>2?arguments[2]:undefined;var args=arguments.length>3?arguments[3]:undefined;var editor=this.editor;var lowerCaseCommand=command.toLowerCase();var skipFocus=args===null||args===void 0?void 0:args.skip_focus;if(editor.removed){return false;}if(lowerCaseCommand!=='mcefocus'){if(!/^(mceAddUndoLevel|mceEndUndoLevel)$/i.test(lowerCaseCommand)&&!skipFocus){editor.focus();}else{restore(editor);}}var eventArgs=editor.dispatch('BeforeExecCommand',{command,ui,value});if(eventArgs.isDefaultPrevented()){return false;}var func=this.commands.exec[lowerCaseCommand];if(isFunction(func)){func(lowerCaseCommand,ui,value);editor.dispatch('ExecCommand',{command,ui,value});return true;}return false;}queryCommandState(command){if(!isSelectionSafeCommand(command)&&this.editor.quirks.isHidden()||this.editor.removed){return false;}var lowerCaseCommand=command.toLowerCase();var func=this.commands.state[lowerCaseCommand];if(isFunction(func)){return func(lowerCaseCommand);}return false;}queryCommandValue(command){if(!isSelectionSafeCommand(command)&&this.editor.quirks.isHidden()||this.editor.removed){return'';}var lowerCaseCommand=command.toLowerCase();var func=this.commands.value[lowerCaseCommand];if(isFunction(func)){return func(lowerCaseCommand);}return'';}addCommands(commandList){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'exec';var commands=this.commands;each$d(commandList,(callback,command)=>{each$e(command.toLowerCase().split(','),command=>{commands[type][command]=callback;});});}addCommand(command,callback,scope){var lowerCaseCommand=command.toLowerCase();this.commands.exec[lowerCaseCommand]=(_command,ui,value)=>callback.call(scope!==null&&scope!==void 0?scope:this.editor,ui,value);}queryCommandSupported(command){var lowerCaseCommand=command.toLowerCase();if(this.commands.exec[lowerCaseCommand]){return true;}else{return false;}}addQueryStateHandler(command,callback,scope){this.commands.state[command.toLowerCase()]=()=>callback.call(scope!==null&&scope!==void 0?scope:this.editor);}addQueryValueHandler(command,callback,scope){this.commands.value[command.toLowerCase()]=()=>callback.call(scope!==null&&scope!==void 0?scope:this.editor);}}var internalContentEditableAttr='data-mce-contenteditable';var toggleClass=(elm,cls,state)=>{if(has(elm,cls)&&!state){remove$7(elm,cls);}else if(state){add$2(elm,cls);}};var setEditorCommandState=(editor,cmd,state)=>{try{editor.getDoc().execCommand(cmd,false,String(state));}catch(ex){}};var setContentEditable=(elm,state)=>{elm.dom.contentEditable=state?'true':'false';};var switchOffContentEditableTrue=elm=>{each$e(descendants(elm,'*[contenteditable=\"true\"]'),elm=>{set$3(elm,internalContentEditableAttr,'true');setContentEditable(elm,false);});};var switchOnContentEditableTrue=elm=>{each$e(descendants(elm,\"*[\".concat(internalContentEditableAttr,\"=\\\"true\\\"]\")),elm=>{remove$a(elm,internalContentEditableAttr);setContentEditable(elm,true);});};var removeFakeSelection=editor=>{Optional.from(editor.selection.getNode()).each(elm=>{elm.removeAttribute('data-mce-selected');});};var restoreFakeSelection=editor=>{editor.selection.setRng(editor.selection.getRng());};var toggleReadOnly=(editor,state)=>{var body=SugarElement.fromDom(editor.getBody());toggleClass(body,'mce-content-readonly',state);if(state){editor.selection.controlSelection.hideResizeRect();editor._selectionOverrides.hideFakeCaret();removeFakeSelection(editor);editor.readonly=true;setContentEditable(body,false);switchOffContentEditableTrue(body);}else{editor.readonly=false;if(editor.hasEditableRoot()){setContentEditable(body,true);}switchOnContentEditableTrue(body);setEditorCommandState(editor,'StyleWithCSS',false);setEditorCommandState(editor,'enableInlineTableEditing',false);setEditorCommandState(editor,'enableObjectResizing',false);if(hasEditorOrUiFocus(editor)){editor.focus();}restoreFakeSelection(editor);editor.nodeChanged();}};var _isReadOnly=editor=>editor.readonly;var registerFilters=editor=>{editor.parser.addAttributeFilter('contenteditable',nodes=>{if(_isReadOnly(editor)){each$e(nodes,node=>{node.attr(internalContentEditableAttr,node.attr('contenteditable'));node.attr('contenteditable','false');});}});editor.serializer.addAttributeFilter(internalContentEditableAttr,nodes=>{if(_isReadOnly(editor)){each$e(nodes,node=>{node.attr('contenteditable',node.attr(internalContentEditableAttr));});}});editor.serializer.addTempAttr(internalContentEditableAttr);};var registerReadOnlyContentFilters=editor=>{if(editor.serializer){registerFilters(editor);}else{editor.on('PreInit',()=>{registerFilters(editor);});}};var isClickEvent=e=>e.type==='click';var allowedEvents=['copy'];var isReadOnlyAllowedEvent=e=>contains$2(allowedEvents,e.type);var getAnchorHrefOpt=(editor,elm)=>{var isRoot=elm=>eq(elm,SugarElement.fromDom(editor.getBody()));return closest$3(elm,'a',isRoot).bind(a=>getOpt(a,'href'));};var processReadonlyEvents=(editor,e)=>{if(isClickEvent(e)&&!VK.metaKeyPressed(e)){var elm=SugarElement.fromDom(e.target);getAnchorHrefOpt(editor,elm).each(href=>{e.preventDefault();if(/^#/.test(href)){var targetEl=editor.dom.select(\"\".concat(href,\",[name=\\\"\").concat(removeLeading(href,'#'),\"\\\"]\"));if(targetEl.length){editor.selection.scrollIntoView(targetEl[0],true);}}else{window.open(href,'_blank','rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');}});}else if(isReadOnlyAllowedEvent(e)){editor.dispatch(e.type,e);}};var registerReadOnlySelectionBlockers=editor=>{editor.on('ShowCaret',e=>{if(_isReadOnly(editor)){e.preventDefault();}});editor.on('ObjectSelected',e=>{if(_isReadOnly(editor)){e.preventDefault();}});};var nativeEvents=Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange '+'mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover '+'draggesture dragdrop drop drag submit '+'compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel',' ');class EventDispatcher{static isNative(name){return!!nativeEvents[name.toLowerCase()];}constructor(settings){this.bindings={};this.settings=settings||{};this.scope=this.settings.scope||this;this.toggleEvent=this.settings.toggleEvent||never;}fire(name,args){return this.dispatch(name,args);}dispatch(name,args){var lcName=name.toLowerCase();var event=normalize$3(lcName,args!==null&&args!==void 0?args:{},this.scope);if(this.settings.beforeFire){this.settings.beforeFire(event);}var handlers=this.bindings[lcName];if(handlers){for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(callback.removed){continue;}if(callback.once){this.off(lcName,callback.func);}if(event.isImmediatePropagationStopped()){return event;}if(callback.func.call(this.scope,event)===false){event.preventDefault();return event;}}}return event;}on(name,callback,prepend,extra){if(callback===false){callback=never;}if(callback){var wrappedCallback={func:callback,removed:false};if(extra){Tools.extend(wrappedCallback,extra);}var names=name.toLowerCase().split(' ');var i=names.length;while(i--){var currentName=names[i];var handlers=this.bindings[currentName];if(!handlers){handlers=[];this.toggleEvent(currentName,true);}if(prepend){handlers=[wrappedCallback,...handlers];}else{handlers=[...handlers,wrappedCallback];}this.bindings[currentName]=handlers;}}return this;}off(name,callback){if(name){var names=name.toLowerCase().split(' ');var i=names.length;while(i--){var currentName=names[i];var handlers=this.bindings[currentName];if(!currentName){each$d(this.bindings,(_value,bindingName)=>{this.toggleEvent(bindingName,false);delete this.bindings[bindingName];});return this;}if(handlers){if(!callback){handlers.length=0;}else{var filteredHandlers=partition$2(handlers,handler=>handler.func===callback);handlers=filteredHandlers.fail;this.bindings[currentName]=handlers;each$e(filteredHandlers.pass,handler=>{handler.removed=true;});}if(!handlers.length){this.toggleEvent(name,false);delete this.bindings[currentName];}}}}else{each$d(this.bindings,(_value,name)=>{this.toggleEvent(name,false);});this.bindings={};}return this;}once(name,callback,prepend){return this.on(name,callback,prepend,{once:true});}has(name){name=name.toLowerCase();var binding=this.bindings[name];return!(!binding||binding.length===0);}}var getEventDispatcher=obj=>{if(!obj._eventDispatcher){obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:(name,state)=>{if(EventDispatcher.isNative(name)&&obj.toggleNativeEvent){obj.toggleNativeEvent(name,state);}}});}return obj._eventDispatcher;};var Observable={fire(name,args,bubble){return this.dispatch(name,args,bubble);},dispatch(name,args,bubble){var self=this;if(self.removed&&name!=='remove'&&name!=='detach'){return normalize$3(name.toLowerCase(),args!==null&&args!==void 0?args:{},self);}var dispatcherArgs=getEventDispatcher(self).dispatch(name,args);if(bubble!==false&&self.parent){var _parent11=self.parent();while(_parent11&&!dispatcherArgs.isPropagationStopped()){_parent11.dispatch(name,dispatcherArgs,false);_parent11=_parent11.parent?_parent11.parent():undefined;}}return dispatcherArgs;},on(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend);},off(name,callback){return getEventDispatcher(this).off(name,callback);},once(name,callback){return getEventDispatcher(this).once(name,callback);},hasEventListeners(name){return getEventDispatcher(this).has(name);}};var DOM$2=DOMUtils.DOM;var customEventRootDelegates;var getEventTarget=(editor,eventName)=>{if(eventName==='selectionchange'){return editor.getDoc();}if(!editor.inline&&/^(?:mouse|touch|click|contextmenu|drop|dragover|dragend)/.test(eventName)){return editor.getDoc().documentElement;}var eventRoot=getEventRoot(editor);if(eventRoot){if(!editor.eventRoot){editor.eventRoot=DOM$2.select(eventRoot)[0];}return editor.eventRoot;}return editor.getBody();};var isListening=editor=>!editor.hidden&&!_isReadOnly(editor);var fireEvent=(editor,eventName,e)=>{if(isListening(editor)){editor.dispatch(eventName,e);}else if(_isReadOnly(editor)){processReadonlyEvents(editor,e);}};var bindEventDelegate=(editor,eventName)=>{if(!editor.delegates){editor.delegates={};}if(editor.delegates[eventName]||editor.removed){return;}var eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(!customEventRootDelegates){customEventRootDelegates={};editor.editorManager.on('removeEditor',()=>{if(!editor.editorManager.activeEditor){if(customEventRootDelegates){each$d(customEventRootDelegates,(_value,name)=>{editor.dom.unbind(getEventTarget(editor,name));});customEventRootDelegates=null;}}});}if(customEventRootDelegates[eventName]){return;}var delegate=e=>{var target=e.target;var editors=editor.editorManager.get();var i=editors.length;while(i--){var body=editors[i].getBody();if(body===target||DOM$2.isChildOf(target,body)){fireEvent(editors[i],eventName,e);}}};customEventRootDelegates[eventName]=delegate;DOM$2.bind(eventRootElm,eventName,delegate);}else{var _delegate=e=>{fireEvent(editor,eventName,e);};DOM$2.bind(eventRootElm,eventName,_delegate);editor.delegates[eventName]=_delegate;}};var EditorObservable=_objectSpread(_objectSpread({},Observable),{},{bindPendingEventDelegates(){var self=this;Tools.each(self._pendingNativeEvents,name=>{bindEventDelegate(self,name);});},toggleNativeEvent(name,state){var self=this;if(name==='focus'||name==='blur'){return;}if(self.removed){return;}if(state){if(self.initialized){bindEventDelegate(self,name);}else{if(!self._pendingNativeEvents){self._pendingNativeEvents=[name];}else{self._pendingNativeEvents.push(name);}}}else if(self.initialized&&self.delegates){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates[name];}},unbindAllNativeEvents(){var self=this;var body=self.getBody();var dom=self.dom;if(self.delegates){each$d(self.delegates,(value,name)=>{self.dom.unbind(getEventTarget(self,name),name,value);});delete self.delegates;}if(!self.inline&&body&&dom){body.onload=null;dom.unbind(self.getWin());dom.unbind(self.getDoc());}if(dom){dom.unbind(body);dom.unbind(self.getContainer());}}});var stringListProcessor=value=>{if(isString(value)){return{value:value.split(/[ ,]/),valid:true};}else if(isArrayOf(value,isString)){return{value,valid:true};}else{return{valid:false,message:\"The value must be a string[] or a comma/space separated string.\"};}};var getBuiltInProcessor=type=>{var validator=(()=>{switch(type){case'array':return isArray$1;case'boolean':return isBoolean;case'function':return isFunction;case'number':return isNumber;case'object':return isObject;case'string':return isString;case'string[]':return stringListProcessor;case'object[]':return val=>isArrayOf(val,isObject);case'regexp':return val=>is$4(val,RegExp);default:return always;}})();return value=>processValue(value,validator,\"The value must be a \".concat(type,\".\"));};var isBuiltInSpec=spec=>isString(spec.processor);var getErrorMessage=(message,result)=>{var additionalText=isEmpty$3(result.message)?'':\". \".concat(result.message);return message+additionalText;};var isValidResult=result=>result.valid;var processValue=function processValue(value,processor){var message=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var result=processor(value);if(isBoolean(result)){return result?{value:value,valid:true}:{valid:false,message};}else{return result;}};var processDefaultValue=(name,defaultValue,processor)=>{if(!isUndefined(defaultValue)){var result=processValue(defaultValue,processor);if(isValidResult(result)){return result.value;}else{console.error(getErrorMessage(\"Invalid default value passed for the \\\"\".concat(name,\"\\\" option\"),result));}}return undefined;};var create$5=(editor,initialOptions)=>{var registry={};var values={};var setValue=(name,value,processor)=>{var result=processValue(value,processor);if(isValidResult(result)){values[name]=result.value;return true;}else{console.warn(getErrorMessage(\"Invalid value passed for the \".concat(name,\" option\"),result));return false;}};var register=(name,spec)=>{var processor=isBuiltInSpec(spec)?getBuiltInProcessor(spec.processor):spec.processor;var defaultValue=processDefaultValue(name,spec.default,processor);registry[name]=_objectSpread(_objectSpread({},spec),{},{default:defaultValue,processor});var initValue=get$a(values,name).orThunk(()=>get$a(initialOptions,name));initValue.each(value=>setValue(name,value,processor));};var isRegistered=name=>has$2(registry,name);var get=name=>get$a(values,name).orThunk(()=>get$a(registry,name).map(spec=>spec.default)).getOrUndefined();var set=(name,value)=>{if(!isRegistered(name)){console.warn(\"\\\"\".concat(name,\"\\\" is not a registered option. Ensure the option has been registered before setting a value.\"));return false;}else{var spec=registry[name];if(spec.immutable){console.error(\"\\\"\".concat(name,\"\\\" is an immutable option and cannot be updated\"));return false;}else{return setValue(name,value,spec.processor);}}};var unset=name=>{var registered=isRegistered(name);if(registered){delete values[name];}return registered;};var isSet=name=>has$2(values,name);return{register,isRegistered,get,set,unset,isSet};};var defaultModes=['design','readonly'];var switchToMode=(editor,activeMode,availableModes,mode)=>{var oldMode=availableModes[activeMode.get()];var newMode=availableModes[mode];try{newMode.activate();}catch(e){console.error(\"problem while activating editor mode \".concat(mode,\":\"),e);return;}oldMode.deactivate();if(oldMode.editorReadOnly!==newMode.editorReadOnly){toggleReadOnly(editor,newMode.editorReadOnly);}activeMode.set(mode);fireSwitchMode(editor,mode);};var setMode=(editor,availableModes,activeMode,mode)=>{if(mode===activeMode.get()){return;}else if(!has$2(availableModes,mode)){throw new Error(\"Editor mode '\".concat(mode,\"' is invalid\"));}if(editor.initialized){switchToMode(editor,activeMode,availableModes,mode);}else{editor.on('init',()=>switchToMode(editor,activeMode,availableModes,mode));}};var registerMode=(availableModes,mode,api)=>{if(contains$2(defaultModes,mode)){throw new Error(\"Cannot override default mode \".concat(mode));}return _objectSpread(_objectSpread({},availableModes),{},{[mode]:_objectSpread(_objectSpread({},api),{},{deactivate:()=>{try{api.deactivate();}catch(e){console.error(\"problem while deactivating editor mode \".concat(mode,\":\"),e);}}})});};var create$4=editor=>{var activeMode=Cell('design');var availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:false},readonly:{activate:noop,deactivate:noop,editorReadOnly:true}});registerReadOnlyContentFilters(editor);registerReadOnlySelectionBlockers(editor);return{isReadOnly:()=>_isReadOnly(editor),set:mode=>setMode(editor,availableModes.get(),activeMode,mode),get:()=>activeMode.get(),register:(mode,api)=>{availableModes.set(registerMode(availableModes.get(),mode,api));}};};var each$2=Tools.each,explode=Tools.explode;var keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var modifierNames=Tools.makeMap('alt,ctrl,shift,meta,access');var isModifier=key=>key in modifierNames;var parseShortcut=pattern=>{var shortcut={};var isMac=Env.os.isMacOS()||Env.os.isiOS();each$2(explode(pattern.toLowerCase(),'+'),value=>{if(isModifier(value)){shortcut[value]=true;}else{if(/^[0-9]{2,}$/.test(value)){shortcut.keyCode=parseInt(value,10);}else{shortcut.charCode=value.charCodeAt(0);shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0);}}});var id=[shortcut.keyCode];var key;for(key in modifierNames){if(shortcut[key]){id.push(key);}else{shortcut[key]=false;}}shortcut.id=id.join(',');if(shortcut.access){shortcut.alt=true;if(isMac){shortcut.ctrl=true;}else{shortcut.shift=true;}}if(shortcut.meta){if(isMac){shortcut.meta=true;}else{shortcut.ctrl=true;shortcut.meta=false;}}return shortcut;};class Shortcuts{constructor(editor){this.shortcuts={};this.pendingPatterns=[];this.editor=editor;var self=this;editor.on('keyup keypress keydown',e=>{if((self.hasModifier(e)||self.isFunctionKey(e))&&!e.isDefaultPrevented()){each$2(self.shortcuts,shortcut=>{if(self.matchShortcut(e,shortcut)){self.pendingPatterns=shortcut.subpatterns.slice(0);if(e.type==='keydown'){self.executeShortcutAction(shortcut);}}});if(self.matchShortcut(e,self.pendingPatterns[0])){if(self.pendingPatterns.length===1){if(e.type==='keydown'){self.executeShortcutAction(self.pendingPatterns[0]);}}self.pendingPatterns.shift();}}});}add(pattern,desc,cmdFunc,scope){var self=this;var func=self.normalizeCommandFunc(cmdFunc);each$2(explode(Tools.trim(pattern)),pattern=>{var shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut;});return true;}remove(pattern){var shortcut=this.createShortcut(pattern);if(this.shortcuts[shortcut.id]){delete this.shortcuts[shortcut.id];return true;}return false;}normalizeCommandFunc(cmdFunc){var self=this;var cmd=cmdFunc;if(typeof cmd==='string'){return()=>{self.editor.execCommand(cmd,false,null);};}else if(Tools.isArray(cmd)){return()=>{self.editor.execCommand(cmd[0],cmd[1],cmd[2]);};}else{return cmd;}}createShortcut(pattern,desc,cmdFunc,scope){var shortcuts=Tools.map(explode(pattern,'>'),parseShortcut);shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor});return Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)});}hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey;}isFunctionKey(e){return e.type==='keydown'&&e.keyCode>=112&&e.keyCode<=123;}matchShortcut(e,shortcut){if(!shortcut){return false;}if(shortcut.ctrl!==e.ctrlKey||shortcut.meta!==e.metaKey){return false;}if(shortcut.alt!==e.altKey||shortcut.shift!==e.shiftKey){return false;}if(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode){e.preventDefault();return true;}return false;}executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null;}}var create$3=()=>{var buttons={};var menuItems={};var popups={};var icons={};var contextMenus={};var contextToolbars={};var sidebars={};var views={};var add=(collection,type)=>(name,spec)=>{collection[name.toLowerCase()]=_objectSpread(_objectSpread({},spec),{},{type});};var addIcon=(name,svgData)=>icons[name.toLowerCase()]=svgData;return{addButton:add(buttons,'button'),addGroupToolbarButton:add(buttons,'grouptoolbarbutton'),addToggleButton:add(buttons,'togglebutton'),addMenuButton:add(buttons,'menubutton'),addSplitButton:add(buttons,'splitbutton'),addMenuItem:add(menuItems,'menuitem'),addNestedMenuItem:add(menuItems,'nestedmenuitem'),addToggleMenuItem:add(menuItems,'togglemenuitem'),addAutocompleter:add(popups,'autocompleter'),addContextMenu:add(contextMenus,'contextmenu'),addContextToolbar:add(contextToolbars,'contexttoolbar'),addContextForm:add(contextToolbars,'contextform'),addSidebar:add(sidebars,'sidebar'),addView:add(views,'views'),addIcon,getAll:()=>({buttons,menuItems,icons,popups,contextMenus,contextToolbars,sidebars,views})};};var registry=()=>{var bridge=create$3();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,addView:bridge.addView,getAll:bridge.getAll};};var DOM$1=DOMUtils.DOM;var extend=Tools.extend,each$1=Tools.each;class Editor{constructor(id,options,editorManager){this.plugins={};this.contentCSS=[];this.contentStyles=[];this.loadedCSS={};this.isNotDirty=false;this.composing=false;this.destroyed=false;this.hasHiddenInput=false;this.iframeElement=null;this.initialized=false;this.readonly=false;this.removed=false;this.startContent='';this._pendingNativeEvents=[];this._skinLoaded=false;this._editableRoot=true;this.editorManager=editorManager;this.documentBaseUrl=editorManager.documentBaseURL;extend(this,EditorObservable);var self=this;this.id=id;this.hidden=false;var normalizedOptions=normalizeOptions(editorManager.defaultOptions,options);this.options=create$5(self,normalizedOptions);register$7(self);var getOption=this.options.get;if(getOption('deprecation_warnings')){logWarnings(options,normalizedOptions);}var suffix=getOption('suffix');if(suffix){editorManager.suffix=suffix;}this.suffix=editorManager.suffix;var baseUrl=getOption('base_url');if(baseUrl){editorManager._setBaseUrl(baseUrl);}this.baseUri=editorManager.baseURI;var referrerPolicy=getReferrerPolicy(self);if(referrerPolicy){ScriptLoader.ScriptLoader._setReferrerPolicy(referrerPolicy);DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(referrerPolicy);}var contentCssCors=hasContentCssCors(self);if(isNonNullable(contentCssCors)){DOMUtils.DOM.styleSheetLoader._setContentCssCors(contentCssCors);}AddOnManager.languageLoad=getOption('language_load');AddOnManager.baseURL=editorManager.baseURL;this.setDirty(false);this.documentBaseURI=new URI(getDocumentBaseUrl(self),{base_uri:this.baseUri});this.baseURI=this.baseUri;this.inline=isInline(self);this.hasVisual=isVisualAidsEnabled(self);this.shortcuts=new Shortcuts(this);this.editorCommands=new EditorCommands(this);registerCommands(this);var cacheSuffix=getOption('cache_suffix');if(cacheSuffix){Env.cacheSuffix=cacheSuffix.replace(/^[\\?\\&]+/,'');}this.ui={registry:registry(),styleSheetLoader:undefined,show:noop,hide:noop,setEnabled:noop,isEnabled:always};this.mode=create$4(self);editorManager.dispatch('SetupEditor',{editor:this});var setupCallback=getSetupCallback(self);if(isFunction(setupCallback)){setupCallback.call(self,self);}}render(){render(this);}focus(skipFocus){this.execCommand('mceFocus',false,skipFocus);}hasFocus(){return hasFocus(this);}translate(text){return I18n.translate(text);}getParam(name,defaultVal,type){var options=this.options;if(!options.isRegistered(name)){if(isNonNullable(type)){options.register(name,{processor:type,default:defaultVal});}else{options.register(name,{processor:always,default:defaultVal});}}return!options.isSet(name)&&!isUndefined(defaultVal)?defaultVal:options.get(name);}hasPlugin(name,loaded){var hasPlugin=contains$2(getPlugins(this),name);if(hasPlugin){return loaded?PluginManager.get(name)!==undefined:true;}else{return false;}}nodeChanged(args){this._nodeChangeDispatcher.nodeChanged(args);}addCommand(name,callback,scope){this.editorCommands.addCommand(name,callback,scope);}addQueryStateHandler(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope);}addQueryValueHandler(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope);}addShortcut(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope);}execCommand(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args);}queryCommandState(cmd){return this.editorCommands.queryCommandState(cmd);}queryCommandValue(cmd){return this.editorCommands.queryCommandValue(cmd);}queryCommandSupported(cmd){return this.editorCommands.queryCommandSupported(cmd);}show(){var self=this;if(self.hidden){self.hidden=false;if(self.inline){self.getBody().contentEditable='true';}else{DOM$1.show(self.getContainer());DOM$1.hide(self.id);}self.load();self.dispatch('show');}}hide(){var self=this;if(!self.hidden){self.save();if(self.inline){self.getBody().contentEditable='false';if(self===self.editorManager.focusedEditor){self.editorManager.focusedEditor=null;}}else{DOM$1.hide(self.getContainer());DOM$1.setStyle(self.id,'display',self.orgDisplay);}self.hidden=true;self.dispatch('hide');}}isHidden(){return this.hidden;}setProgressState(state,time){this.dispatch('ProgressState',{state,time});}load(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var self=this;var elm=self.getElement();if(self.removed){return'';}if(elm){var loadArgs=_objectSpread(_objectSpread({},args),{},{load:true});var _value18=isTextareaOrInput(elm)?elm.value:elm.innerHTML;var _html=self.setContent(_value18,loadArgs);if(!loadArgs.no_events){self.dispatch('LoadContent',_objectSpread(_objectSpread({},loadArgs),{},{element:elm}));}return _html;}else{return'';}}save(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var self=this;var elm=self.getElement();if(!elm||!self.initialized||self.removed){return'';}var getArgs=_objectSpread(_objectSpread({},args),{},{save:true,element:elm});var html=self.getContent(getArgs);var saveArgs=_objectSpread(_objectSpread({},getArgs),{},{content:html});if(!saveArgs.no_events){self.dispatch('SaveContent',saveArgs);}if(saveArgs.format==='raw'){self.dispatch('RawSaveContent',saveArgs);}html=saveArgs.content;if(!isTextareaOrInput(elm)){if(args.is_removing||!self.inline){elm.innerHTML=html;}var form=DOM$1.getParent(self.id,'form');if(form){each$1(form.elements,elm=>{if(elm.name===self.id){elm.value=html;return false;}else{return true;}});}}else{elm.value=html;}saveArgs.element=getArgs.element=elm=null;if(saveArgs.set_dirty!==false){self.setDirty(false);}return html;}setContent(content,args){return setContent(this,content,args);}getContent(args){return getContent(this,args);}insertContent(content,args){if(args){content=extend({content},args);}this.execCommand('mceInsertContent',false,content);}resetContent(initialContent){if(initialContent===undefined){setContent(this,this.startContent,{format:'raw'});}else{setContent(this,initialContent);}this.undoManager.reset();this.setDirty(false);this.nodeChanged();}isDirty(){return!this.isNotDirty;}setDirty(state){var oldState=!this.isNotDirty;this.isNotDirty=!state;if(state&&state!==oldState){this.dispatch('dirty');}}getContainer(){var self=this;if(!self.container){self.container=self.editorContainer||DOM$1.get(self.id+'_parent');}return self.container;}getContentAreaContainer(){return this.contentAreaContainer;}getElement(){if(!this.targetElm){this.targetElm=DOM$1.get(this.id);}return this.targetElm;}getWin(){var self=this;if(!self.contentWindow){var elm=self.iframeElement;if(elm){self.contentWindow=elm.contentWindow;}}return self.contentWindow;}getDoc(){var self=this;if(!self.contentDocument){var win=self.getWin();if(win){self.contentDocument=win.document;}}return self.contentDocument;}getBody(){var _a,_b;var doc=this.getDoc();return(_b=(_a=this.bodyElement)!==null&&_a!==void 0?_a:doc===null||doc===void 0?void 0:doc.body)!==null&&_b!==void 0?_b:null;}convertURL(url,name,elm){var self=this,getOption=self.options.get;var urlConverterCallback=getUrlConverterCallback(self);if(isFunction(urlConverterCallback)){return urlConverterCallback.call(self,url,elm,true,name);}if(!getOption('convert_urls')||elm==='link'||isObject(elm)&&elm.nodeName==='LINK'||url.indexOf('file:')===0||url.length===0){return url;}if(getOption('relative_urls')){return self.documentBaseURI.toRelative(url);}url=self.documentBaseURI.toAbsolute(url,getOption('remove_script_host'));return url;}addVisual(elm){addVisual(this,elm);}setEditableRoot(state){setEditableRoot(this,state);}hasEditableRoot(){return hasEditableRoot(this);}remove(){remove$1(this);}destroy(automatic){destroy(this,automatic);}uploadImages(){return this.editorUpload.uploadImages();}_scanForImages(){return this.editorUpload.scanForImages();}}var DOM=DOMUtils.DOM;var each=Tools.each;var boundGlobalEvents=false;var beforeUnloadDelegate;var editors=[];var globalEventDelegate=e=>{var type=e.type;each(EditorManager.get(),editor=>{switch(type){case'scroll':editor.dispatch('ScrollWindow',e);break;case'resize':editor.dispatch('ResizeWindow',e);break;}});};var toggleGlobalEvents=state=>{if(state!==boundGlobalEvents){var _DOM=DOMUtils.DOM;if(state){_DOM.bind(window,'resize',globalEventDelegate);_DOM.bind(window,'scroll',globalEventDelegate);}else{_DOM.unbind(window,'resize',globalEventDelegate);_DOM.unbind(window,'scroll',globalEventDelegate);}boundGlobalEvents=state;}};var removeEditorFromList=targetEditor=>{var oldEditors=editors;editors=filter$5(editors,editor=>{return targetEditor!==editor;});if(EditorManager.activeEditor===targetEditor){EditorManager.activeEditor=editors.length>0?editors[0]:null;}if(EditorManager.focusedEditor===targetEditor){EditorManager.focusedEditor=null;}return oldEditors.length!==editors.length;};var purgeDestroyedEditor=editor=>{if(editor&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode){removeEditorFromList(editor);editor.unbindAllNativeEvents();editor.destroy(true);editor.removed=true;}};var isQuirksMode=document.compatMode!=='CSS1Compat';var EditorManager=_objectSpread(_objectSpread({},Observable),{},{baseURI:null,baseURL:null,defaultOptions:{},documentBaseURL:null,suffix:null,majorVersion:'6',minorVersion:'7.0',releaseDate:'2023-08-30',i18n:I18n,activeEditor:null,focusedEditor:null,setup(){var self=this;var baseURL='';var suffix='';var documentBaseURL=URI.getDocumentBaseUrl(document.location);if(/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)){documentBaseURL=documentBaseURL.replace(/[\\?#].*$/,'').replace(/[\\/\\\\][^\\/]+$/,'');if(!/[\\/\\\\]$/.test(documentBaseURL)){documentBaseURL+='/';}}var preInit=window.tinymce||window.tinyMCEPreInit;if(preInit){baseURL=preInit.base||preInit.baseURL;suffix=preInit.suffix;}else{var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var src=scripts[i].src||'';if(src===''){continue;}var srcScript=src.substring(src.lastIndexOf('/'));if(/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)){if(srcScript.indexOf('.min')!==-1){suffix='.min';}baseURL=src.substring(0,src.lastIndexOf('/'));break;}}if(!baseURL&&document.currentScript){var _src=document.currentScript.src;if(_src.indexOf('.min')!==-1){suffix='.min';}baseURL=_src.substring(0,_src.lastIndexOf('/'));}}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL);self.documentBaseURL=documentBaseURL;self.baseURI=new URI(self.baseURL);self.suffix=suffix;setup$v(self);},overrideDefaults(defaultOptions){var baseUrl=defaultOptions.base_url;if(baseUrl){this._setBaseUrl(baseUrl);}var suffix=defaultOptions.suffix;if(suffix){this.suffix=suffix;}this.defaultOptions=defaultOptions;var pluginBaseUrls=defaultOptions.plugin_base_urls;if(pluginBaseUrls!==undefined){each$d(pluginBaseUrls,(pluginBaseUrl,pluginName)=>{AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl;});}},init(options){var self=this;var result;var invalidInlineTargets=Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track '+'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu',' ');var isInvalidInlineTarget=(options,elm)=>options.inline&&elm.tagName.toLowerCase()in invalidInlineTargets;var createId=elm=>{var id=elm.id;if(!id){id=get$a(elm,'name').filter(name=>!DOM.get(name)).getOrThunk(DOM.uniqueId);elm.setAttribute('id',id);}return id;};var execCallback=name=>{var callback=options[name];if(!callback){return;}return callback.apply(self,[]);};var findTargets=options=>{if(Env.browser.isIE()||Env.browser.isEdge()){initError('TinyMCE does not support the browser you are using. For a list of supported'+' browsers please see: https://www.tiny.cloud/docs/tinymce/6/support/#supportedwebbrowsers');return[];}else if(isQuirksMode){initError('Failed to initialize the editor as the document is not in standards mode. '+'TinyMCE requires standards mode.');return[];}else if(isString(options.selector)){return DOM.select(options.selector);}else if(isNonNullable(options.target)){return[options.target];}else{return[];}};var provideResults=editors=>{result=editors;};var initEditors=()=>{var initCount=0;var editors=[];var targets;var createEditor=(id,options,targetElm)=>{var editor=new Editor(id,options,self);editors.push(editor);editor.on('init',()=>{if(++initCount===targets.length){provideResults(editors);}});editor.targetElm=editor.targetElm||targetElm;editor.render();};DOM.unbind(window,'ready',initEditors);execCallback('onpageload');targets=unique$1(findTargets(options));Tools.each(targets,elm=>{purgeDestroyedEditor(self.get(elm.id));});targets=Tools.grep(targets,elm=>{return!self.get(elm.id);});if(targets.length===0){provideResults([]);}else{each(targets,elm=>{if(isInvalidInlineTarget(options,elm)){initError('Could not initialize inline editor on invalid inline target element',elm);}else{createEditor(createId(elm),options,elm);}});}};DOM.bind(window,'ready',initEditors);return new Promise(resolve=>{if(result){resolve(result);}else{provideResults=editors=>{resolve(editors);};}});},get(id){if(arguments.length===0){return editors.slice(0);}else if(isString(id)){return find$2(editors,editor=>{return editor.id===id;}).getOr(null);}else if(isNumber(id)){return editors[id]?editors[id]:null;}else{return null;}},add(editor){var self=this;var existingEditor=self.get(editor.id);if(existingEditor===editor){return editor;}if(existingEditor===null){editors.push(editor);}toggleGlobalEvents(true);self.activeEditor=editor;self.dispatch('AddEditor',{editor});if(!beforeUnloadDelegate){beforeUnloadDelegate=e=>{var event=self.dispatch('BeforeUnload');if(event.returnValue){e.preventDefault();e.returnValue=event.returnValue;return event.returnValue;}};window.addEventListener('beforeunload',beforeUnloadDelegate);}return editor;},createEditor(id,options){return this.add(new Editor(id,options,this));},remove(selector){var self=this;var editor;if(!selector){for(var i=editors.length-1;i>=0;i--){self.remove(editors[i]);}return;}if(isString(selector)){each(DOM.select(selector),elm=>{editor=self.get(elm.id);if(editor){self.remove(editor);}});return;}editor=selector;if(isNull(self.get(editor.id))){return null;}if(removeEditorFromList(editor)){self.dispatch('RemoveEditor',{editor});}if(editors.length===0){window.removeEventListener('beforeunload',beforeUnloadDelegate);}editor.remove();toggleGlobalEvents(editors.length>0);return editor;},execCommand(cmd,ui,value){var _a;var self=this;var editorId=isObject(value)?(_a=value.id)!==null&&_a!==void 0?_a:value.index:value;switch(cmd){case'mceAddEditor':{if(!self.get(editorId)){var editorOptions=value.options;new Editor(editorId,editorOptions,self).render();}return true;}case'mceRemoveEditor':{var editor=self.get(editorId);if(editor){editor.remove();}return true;}case'mceToggleEditor':{var _editor2=self.get(editorId);if(!_editor2){self.execCommand('mceAddEditor',false,value);return true;}if(_editor2.isHidden()){_editor2.show();}else{_editor2.hide();}return true;}}if(self.activeEditor){return self.activeEditor.execCommand(cmd,ui,value);}return false;},triggerSave:()=>{each(editors,editor=>{editor.save();});},addI18n:(code,items)=>{I18n.add(code,items);},translate:text=>{return I18n.translate(text);},setActive(editor){var activeEditor=this.activeEditor;if(this.activeEditor!==editor){if(activeEditor){activeEditor.dispatch('deactivate',{relatedTarget:editor});}editor.dispatch('activate',{relatedTarget:activeEditor});}this.activeEditor=editor;},_setBaseUrl(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/,''));this.baseURI=new URI(this.baseURL);}});EditorManager.setup();var setup=()=>{var dataValue=value$2();var FakeClipboardItem=items=>({items,types:keys(items),getType:type=>get$a(items,type).getOrUndefined()});var write=data=>{dataValue.set(data);};var read=()=>dataValue.get().getOrUndefined();var clear=dataValue.clear;return{FakeClipboardItem,write,read,clear};};var FakeClipboard=setup();var min=Math.min,max=Math.max,round=Math.round;var relativePosition=(rect,targetRect,rel)=>{var x=targetRect.x;var y=targetRect.y;var w=rect.w;var h=rect.h;var targetW=targetRect.w;var targetH=targetRect.h;var relChars=(rel||'').split('');if(relChars[0]==='b'){y+=targetH;}if(relChars[1]==='r'){x+=targetW;}if(relChars[0]==='c'){y+=round(targetH/2);}if(relChars[1]==='c'){x+=round(targetW/2);}if(relChars[3]==='b'){y-=h;}if(relChars[4]==='r'){x-=w;}if(relChars[3]==='c'){y-=round(h/2);}if(relChars[4]==='c'){x-=round(w/2);}return create$2(x,y,w,h);};var findBestRelativePosition=(rect,targetRect,constrainRect,rels)=>{for(var i=0;i<rels.length;i++){var pos=relativePosition(rect,targetRect,rels[i]);if(pos.x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y){return rels[i];}}return null;};var inflate=(rect,w,h)=>{return create$2(rect.x-w,rect.y-h,rect.w+w*2,rect.h+h*2);};var intersect=(rect,cropRect)=>{var x1=max(rect.x,cropRect.x);var y1=max(rect.y,cropRect.y);var x2=min(rect.x+rect.w,cropRect.x+cropRect.w);var y2=min(rect.y+rect.h,cropRect.y+cropRect.h);if(x2-x1<0||y2-y1<0){return null;}return create$2(x1,y1,x2-x1,y2-y1);};var clamp=(rect,clampRect,fixedSize)=>{var x1=rect.x;var y1=rect.y;var x2=rect.x+rect.w;var y2=rect.y+rect.h;var cx2=clampRect.x+clampRect.w;var cy2=clampRect.y+clampRect.h;var underflowX1=max(0,clampRect.x-x1);var underflowY1=max(0,clampRect.y-y1);var overflowX2=max(0,x2-cx2);var overflowY2=max(0,y2-cy2);x1+=underflowX1;y1+=underflowY1;if(fixedSize){x2+=underflowX1;y2+=underflowY1;x1-=overflowX2;y1-=overflowY2;}x2-=overflowX2;y2-=overflowY2;return create$2(x1,y1,x2-x1,y2-y1);};var create$2=(x,y,w,h)=>{return{x,y,w,h};};var fromClientRect=clientRect=>{return create$2(clientRect.left,clientRect.top,clientRect.width,clientRect.height);};var Rect={inflate,relativePosition,findBestRelativePosition,intersect,clamp,create:create$2,fromClientRect};var awaiter=function awaiter(resolveCb,rejectCb){var timeout=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1000;var done=false;var timer=null;var complete=completer=>function(){if(!done){done=true;if(timer!==null){clearTimeout(timer);timer=null;}for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++){args[_key16]=arguments[_key16];}completer.apply(null,args);}};var resolve=complete(resolveCb);var reject=complete(rejectCb);var start=function start(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++){args[_key17]=arguments[_key17];}if(!done&&timer===null){timer=setTimeout(()=>reject.apply(null,args),timeout);}};return{start,resolve,reject};};var create$1=()=>{var tasks={};var resultFns={};var load=(id,url)=>{var loadErrMsg=\"Script at URL \\\"\".concat(url,\"\\\" failed to load\");var runErrMsg=\"Script at URL \\\"\".concat(url,\"\\\" did not call `tinymce.Resource.add('\").concat(id,\"', data)` within 1 second\");if(tasks[id]!==undefined){return tasks[id];}else{var task=new Promise((resolve,reject)=>{var waiter=awaiter(resolve,reject);resultFns[id]=waiter.resolve;ScriptLoader.ScriptLoader.loadScript(url).then(()=>waiter.start(runErrMsg),()=>waiter.reject(loadErrMsg));});tasks[id]=task;return task;}};var add=(id,data)=>{if(resultFns[id]!==undefined){resultFns[id](data);delete resultFns[id];}tasks[id]=Promise.resolve(data);};var unload=id=>{delete tasks[id];};return{load,add,unload};};var Resource=create$1();var create=()=>(()=>{var data={};var keys=[];var storage={getItem:key=>{var item=data[key];return item?item:null;},setItem:(key,value)=>{keys.push(key);data[key]=String(value);},key:index=>{return keys[index];},removeItem:key=>{keys=keys.filter(k=>k===key);delete data[key];},clear:()=>{keys=[];data={};},length:0};Object.defineProperty(storage,'length',{get:()=>keys.length,configurable:false,enumerable:false});return storage;})();var localStorage;try{var test='__storage_test__';localStorage=window.localStorage;localStorage.setItem(test,test);localStorage.removeItem(test);}catch(e){localStorage=create();}var LocalStorage=localStorage;var publicApi={geom:{Rect},util:{Delay,Tools,VK,URI,EventDispatcher,Observable,I18n,LocalStorage,ImageUploader},dom:{EventUtils,TreeWalker:DomTreeWalker,TextSeeker,DOMUtils,ScriptLoader,RangeUtils,Serializer:DomSerializer,StyleSheetLoader,ControlSelection,BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles,Entities,Node:AstNode,Schema,DomParser,Writer,Serializer:HtmlSerializer},Env,AddOnManager,Annotator,Formatter,UndoManager,EditorCommands,WindowManager,NotificationManager,EditorObservable,Shortcuts,Editor,FocusManager,EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager,ThemeManager,ModelManager,IconManager,Resource,FakeClipboard,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,walk:Tools.walk,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix};var tinymce=Tools.extend(EditorManager,publicApi);var exportToModuleLoaders=tinymce=>{if(true){try{module.exports=tinymce;}catch(_){}}};var exportToWindowGlobal=tinymce=>{window.tinymce=tinymce;window.tinyMCE=tinymce;};exportToWindowGlobal(tinymce);exportToModuleLoaders(tinymce);})();\n\n//# sourceURL=webpack://pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad/./node_modules/tinymce/tinymce.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./RichTextTinyMCE6/index.ts");
/******/ 	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = __webpack_exports__;
/******/ 	
/******/ })()
;
if (window.ComponentFramework && window.ComponentFramework.registerControl) {
	ComponentFramework.registerControl('rysock.RichTextTinyMCE6', pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.RichTextTinyMCE6);
} else {
	var rysock = rysock || {};
	rysock.RichTextTinyMCE6 = pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad.RichTextTinyMCE6;
	pcf_tools_652ac3f36e1e4bca82eb3c1dc44e6fad = undefined;
}